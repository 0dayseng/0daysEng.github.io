<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/x86/kvm/vmx/vmx.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_c21774f8bc9f0de15163573e5f5fa2b5.html">x86</a></li><li class="navelem"><a class="el" href="dir_fde450fd4b58e2560c53a1e73bfa4d6d.html">kvm</a></li><li class="navelem"><a class="el" href="dir_9793580f8dab032f23ee1d591e6cafd6.html">vmx</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">vmx.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &lt;asm/kvm.h&gt;</code><br />
<code>#include &lt;asm/intel_pt.h&gt;</code><br />
<code>#include &lt;asm/perf_event.h&gt;</code><br />
<code>#include &quot;<a class="el" href="capabilities_8h_source.html">capabilities.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="kvm__cache__regs_8h_source.html">../kvm_cache_regs.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="posted__intr_8h_source.html">posted_intr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="vmcs_8h_source.html">vmcs.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="vmx__ops_8h_source.html">vmx_ops.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="cpuid_8h_source.html">../cpuid.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="run__flags_8h_source.html">run_flags.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for vmx.h:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h__incl.png" border="0" usemap="#aarch_2x86_2kvm_2vmx_2vmx_8h" alt=""/></div>
<map name="aarch_2x86_2kvm_2vmx_2vmx_8h" id="aarch_2x86_2kvm_2vmx_2vmx_8h">
<area shape="rect" title=" " alt="" coords="448,5,637,32"/>
<area shape="rect" title=" " alt="" coords="861,827,995,853"/>
<area shape="rect" title=" " alt="" coords="94,453,189,480"/>
<area shape="rect" title=" " alt="" coords="147,80,261,107"/>
<area shape="rect" title=" " alt="" coords="285,80,421,107"/>
<area shape="rect" href="capabilities_8h.html" title=" " alt="" coords="779,453,888,480"/>
<area shape="rect" href="kvm__cache__regs_8h.html" title=" " alt="" coords="857,752,999,779"/>
<area shape="rect" href="cpuid_8h.html" title=" " alt="" coords="1370,528,1451,555"/>
<area shape="rect" href="posted__intr_8h.html" title=" " alt="" coords="1248,80,1355,107"/>
<area shape="rect" href="vmcs_8h.html" title=" " alt="" coords="395,379,464,405"/>
<area shape="rect" href="vmx__ops_8h.html" title=" " alt="" coords="496,80,589,107"/>
<area shape="rect" href="run__flags_8h.html" title=" " alt="" coords="2023,80,2116,107"/>
<area shape="rect" title=" " alt="" coords="494,528,589,555"/>
<area shape="rect" href="lapic_8h.html" title=" " alt="" coords="795,528,872,555"/>
<area shape="rect" href="x86_8h.html" title=" " alt="" coords="1083,677,1141,704"/>
<area shape="rect" href="pmu_8h.html" title=" " alt="" coords="685,528,760,555"/>
<area shape="rect" title=" " alt="" coords="909,603,1011,629"/>
<area shape="rect" href="hyperv_8h.html" title=" " alt="" coords="806,603,885,629"/>
<area shape="rect" href="smm_8h.html" title=" " alt="" coords="664,603,731,629"/>
<area shape="rect" title=" " alt="" coords="1334,752,1466,779"/>
<area shape="rect" title=" " alt="" coords="1075,752,1170,779"/>
<area shape="rect" title=" " alt="" coords="1194,752,1310,779"/>
<area shape="rect" href="kvm__emulate_8h.html" title=" " alt="" coords="2023,752,2147,779"/>
<area shape="rect" title=" " alt="" coords="2079,827,2209,853"/>
<area shape="rect" href="fpu_8h.html" title=" " alt="" coords="1999,827,2054,853"/>
<area shape="rect" title=" " alt="" coords="1971,901,2082,928"/>
<area shape="rect" title=" " alt="" coords="579,677,712,704"/>
<area shape="rect" title=" " alt="" coords="169,603,285,629"/>
<area shape="rect" href="reverse__cpuid_8h.html" title=" " alt="" coords="1708,603,1833,629"/>
<area shape="rect" title=" " alt="" coords="1858,603,1947,629"/>
<area shape="rect" title=" " alt="" coords="1188,603,1316,629"/>
<area shape="rect" title=" " alt="" coords="1340,603,1503,629"/>
<area shape="rect" href="governed__features_8h.html" title=" " alt="" coords="1527,603,1683,629"/>
<area shape="rect" title=" " alt="" coords="1661,677,1787,704"/>
<area shape="rect" title=" " alt="" coords="1812,677,1948,704"/>
<area shape="rect" title=" " alt="" coords="1494,677,1637,704"/>
<area shape="rect" title=" " alt="" coords="315,453,423,480"/>
<area shape="rect" title=" " alt="" coords="448,453,539,480"/>
<area shape="rect" href="vmx__onhyperv_8h.html" title=" " alt="" coords="721,155,852,181"/>
<area shape="rect" title=" " alt="" coords="729,304,866,331"/>
<area shape="rect" title=" " alt="" coords="875,229,1005,256"/>
<area shape="rect" title=" " alt="" coords="1030,229,1173,256"/>
<area shape="rect" href="hyperv__evmcs_8h.html" title=" " alt="" coords="619,229,749,256"/>
<area shape="rect" href="vmcs12_8h.html" title=" " alt="" coords="568,304,653,331"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h__dep__incl.png" border="0" usemap="#aarch_2x86_2kvm_2vmx_2vmx_8hdep" alt=""/></div>
<map name="aarch_2x86_2kvm_2vmx_2vmx_8hdep" id="aarch_2x86_2kvm_2vmx_2vmx_8hdep">
<area shape="rect" title=" " alt="" coords="453,5,642,32"/>
<area shape="rect" href="kvm-asm-offsets_8c.html" title=" " alt="" coords="60,80,237,121"/>
<area shape="rect" href="vmx_2hyperv_8h.html" title=" " alt="" coords="516,87,720,114"/>
<area shape="rect" href="nested_8h.html" title=" " alt="" coords="415,169,619,196"/>
<area shape="rect" href="vmx_2hyperv_8c.html" title=" " alt="" coords="213,251,415,278"/>
<area shape="rect" href="sgx_8c.html" title=" " alt="" coords="5,251,188,278"/>
<area shape="rect" href="vmx_2nested_8c.html" title=" " alt="" coords="642,251,845,278"/>
<area shape="rect" href="vmx_8c.html" title=" " alt="" coords="869,251,1057,278"/>
<area shape="rect" href="posted__intr_8c.html" title=" " alt="" coords="846,80,1038,121"/>
<area shape="rect" href="pmu__intel_8c.html" title=" " alt="" coords="440,244,617,285"/>
</map>
</div>
</div>
<p><a href="vmx_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvmx__msrs.html">vmx_msrs</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvmx__uret__msr.html">vmx_uret_msr</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpt__ctx.html">pt_ctx</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpt__desc.html">pt_desc</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">union &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="unionvmx__exit__reason.html">vmx_exit_reason</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlbr__desc.html">lbr_desc</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnested__vmx.html">nested_vmx</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvcpu__vmx.html">vcpu_vmx</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvcpu__vmx_1_1msr__autoload.html">vcpu_vmx::msr_autoload</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvcpu__vmx_1_1msr__autostore.html">vcpu_vmx::msr_autostore</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkvm__vmx.html">kvm_vmx</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a2c8d9fefd4a15747f3f7f38c15ec6919"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a2c8d9fefd4a15747f3f7f38c15ec6919">MSR_TYPE_R</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a2c8d9fefd4a15747f3f7f38c15ec6919"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1ba03357f1a299c69fbaf2c5a9d9e96"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ab1ba03357f1a299c69fbaf2c5a9d9e96">MSR_TYPE_W</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:ab1ba03357f1a299c69fbaf2c5a9d9e96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a511b7b2ce3b986ba2ed692fbc0f79bbc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a511b7b2ce3b986ba2ed692fbc0f79bbc">MSR_TYPE_RW</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a511b7b2ce3b986ba2ed692fbc0f79bbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42f09aaa2a9a2400562edd68086fa30c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a42f09aaa2a9a2400562edd68086fa30c">X2APIC_MSR</a>(r)&#160;&#160;&#160;(APIC_BASE_MSR + ((r) &gt;&gt; 4))</td></tr>
<tr class="separator:a42f09aaa2a9a2400562edd68086fa30c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57f539d75457e1ff3a3df61794beb728"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a57f539d75457e1ff3a3df61794beb728">MAX_NR_USER_RETURN_MSRS</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a57f539d75457e1ff3a3df61794beb728"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5c4970b0ed8ffa02838f71ab250234c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#af5c4970b0ed8ffa02838f71ab250234c">MAX_NR_LOADSTORE_MSRS</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:af5c4970b0ed8ffa02838f71ab250234c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e134079db013b8754acf7236e7ea909"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a4e134079db013b8754acf7236e7ea909">RTIT_ADDR_RANGE</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a4e134079db013b8754acf7236e7ea909"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeea1ef922b70c27f5f28e362fee0976c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#aeea1ef922b70c27f5f28e362fee0976c">PML_ENTITY_NUM</a>&#160;&#160;&#160;512</td></tr>
<tr class="separator:aeea1ef922b70c27f5f28e362fee0976c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a977e4f4c09ed5b257a5c68d08249dc09"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a977e4f4c09ed5b257a5c68d08249dc09">MAX_POSSIBLE_PASSTHROUGH_MSRS</a>&#160;&#160;&#160;16</td></tr>
<tr class="separator:a977e4f4c09ed5b257a5c68d08249dc09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a757a1e161942ada247245d3c0101345f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a757a1e161942ada247245d3c0101345f">__BUILD_VMX_MSR_BITMAP_HELPER</a>(rtype,  action,  bitop,  access,  base)</td></tr>
<tr class="separator:a757a1e161942ada247245d3c0101345f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7da7480f780ee285d71dad733f518f29"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a7da7480f780ee285d71dad733f518f29">BUILD_VMX_MSR_BITMAP_HELPERS</a>(ret_type,  action,  bitop)</td></tr>
<tr class="separator:a7da7480f780ee285d71dad733f518f29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a440ec36a8bb2a1f972b685a0f890e2bf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a440ec36a8bb2a1f972b685a0f890e2bf">__KVM_REQUIRED_VMX_VM_ENTRY_CONTROLS</a>&#160;&#160;&#160;	(VM_ENTRY_LOAD_DEBUG_CONTROLS)</td></tr>
<tr class="separator:a440ec36a8bb2a1f972b685a0f890e2bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d23742153f95ca3ff720ac1aeb24455"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a2d23742153f95ca3ff720ac1aeb24455">KVM_REQUIRED_VMX_VM_ENTRY_CONTROLS</a>&#160;&#160;&#160;		<a class="el" href="vmx_8h.html#a440ec36a8bb2a1f972b685a0f890e2bf">__KVM_REQUIRED_VMX_VM_ENTRY_CONTROLS</a></td></tr>
<tr class="separator:a2d23742153f95ca3ff720ac1aeb24455"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62a5468c0dba5052102571083ce5673b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a62a5468c0dba5052102571083ce5673b">KVM_OPTIONAL_VMX_VM_ENTRY_CONTROLS</a></td></tr>
<tr class="separator:a62a5468c0dba5052102571083ce5673b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3226148db9313f3562dccd09e360283d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a3226148db9313f3562dccd09e360283d">__KVM_REQUIRED_VMX_VM_EXIT_CONTROLS</a></td></tr>
<tr class="separator:a3226148db9313f3562dccd09e360283d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad834a55c1ff6de9ea73667a13f661e18"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ad834a55c1ff6de9ea73667a13f661e18">KVM_REQUIRED_VMX_VM_EXIT_CONTROLS</a>&#160;&#160;&#160;		<a class="el" href="vmx_8h.html#a3226148db9313f3562dccd09e360283d">__KVM_REQUIRED_VMX_VM_EXIT_CONTROLS</a></td></tr>
<tr class="separator:ad834a55c1ff6de9ea73667a13f661e18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3756b66be4125133efa559f2f0d5db79"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a3756b66be4125133efa559f2f0d5db79">KVM_OPTIONAL_VMX_VM_EXIT_CONTROLS</a></td></tr>
<tr class="separator:a3756b66be4125133efa559f2f0d5db79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6469fb2dfb90a978b1a07606c1213b8a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a6469fb2dfb90a978b1a07606c1213b8a">KVM_REQUIRED_VMX_PIN_BASED_VM_EXEC_CONTROL</a></td></tr>
<tr class="separator:a6469fb2dfb90a978b1a07606c1213b8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a666a64693d276ce33938c2b4fdd26e7d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a666a64693d276ce33938c2b4fdd26e7d">KVM_OPTIONAL_VMX_PIN_BASED_VM_EXEC_CONTROL</a></td></tr>
<tr class="separator:a666a64693d276ce33938c2b4fdd26e7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48c820479e00d43028d492e5c465d420"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a48c820479e00d43028d492e5c465d420">__KVM_REQUIRED_VMX_CPU_BASED_VM_EXEC_CONTROL</a></td></tr>
<tr class="separator:a48c820479e00d43028d492e5c465d420"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6a5137271527c181fff5a32a2e513ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ae6a5137271527c181fff5a32a2e513ca">KVM_REQUIRED_VMX_CPU_BASED_VM_EXEC_CONTROL</a>&#160;&#160;&#160;		<a class="el" href="vmx_8h.html#a48c820479e00d43028d492e5c465d420">__KVM_REQUIRED_VMX_CPU_BASED_VM_EXEC_CONTROL</a></td></tr>
<tr class="separator:ae6a5137271527c181fff5a32a2e513ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39e788631b8bf99e289ca2d10dc2dbae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a39e788631b8bf99e289ca2d10dc2dbae">KVM_OPTIONAL_VMX_CPU_BASED_VM_EXEC_CONTROL</a></td></tr>
<tr class="separator:a39e788631b8bf99e289ca2d10dc2dbae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5511081ac96d7fb9cd276c1522153dcd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a5511081ac96d7fb9cd276c1522153dcd">KVM_REQUIRED_VMX_SECONDARY_VM_EXEC_CONTROL</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a5511081ac96d7fb9cd276c1522153dcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a703910050e1b6c8935b18df585c6e481"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a703910050e1b6c8935b18df585c6e481">KVM_OPTIONAL_VMX_SECONDARY_VM_EXEC_CONTROL</a></td></tr>
<tr class="separator:a703910050e1b6c8935b18df585c6e481"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82751de8c057906d070c4bce6f894f0d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a82751de8c057906d070c4bce6f894f0d">KVM_REQUIRED_VMX_TERTIARY_VM_EXEC_CONTROL</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a82751de8c057906d070c4bce6f894f0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae80ea124e02d58c368631dad25647f67"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ae80ea124e02d58c368631dad25647f67">KVM_OPTIONAL_VMX_TERTIARY_VM_EXEC_CONTROL</a>&#160;&#160;&#160;	(TERTIARY_EXEC_IPI_VIRT)</td></tr>
<tr class="separator:ae80ea124e02d58c368631dad25647f67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa12d0fff156ac955575d4183ffb98fe2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#aa12d0fff156ac955575d4183ffb98fe2">BUILD_CONTROLS_SHADOW</a>(lname,  uname,  bits)</td></tr>
<tr class="separator:aa12d0fff156ac955575d4183ffb98fe2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1518215c28d01df17342d860c4ecdd0a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a1518215c28d01df17342d860c4ecdd0a">VMX_REGS_LAZY_LOAD_SET</a></td></tr>
<tr class="separator:a1518215c28d01df17342d860c4ecdd0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a0a7449d6e0e68d0bb0f25374e3a40153"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153">segment_cache_field</a> { <br />
&#160;&#160;<a class="el" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153a2dd907feb7877dc961e2edd92bc83c27">SEG_FIELD_SEL</a> = 0
, <a class="el" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153a2817166247d61c4cfed655cd57a17c18">SEG_FIELD_BASE</a> = 1
, <a class="el" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153ade751405f8b5a5ef6013193f27643c05">SEG_FIELD_LIMIT</a> = 2
, <a class="el" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153aa33dfa2adf3a5648924eceeacc373b01">SEG_FIELD_AR</a> = 3
, <br />
&#160;&#160;<a class="el" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153a99727657808cbc565ee2d43ad4c2ba6c">SEG_FIELD_NR</a> = 4
<br />
 }</td></tr>
<tr class="separator:a0a7449d6e0e68d0bb0f25374e3a40153"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7b282a828cac2d1ae55bb522a0c42c1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a7b282a828cac2d1ae55bb522a0c42c1f">vmx_vcpu_load_vmcs</a> (struct kvm_vcpu *vcpu, int cpu, struct <a class="el" href="structloaded__vmcs.html">loaded_vmcs</a> *buddy)</td></tr>
<tr class="separator:a7b282a828cac2d1ae55bb522a0c42c1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f734e0eaceeaebc218934ab82543dc1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a0f734e0eaceeaebc218934ab82543dc1">allocate_vpid</a> (void)</td></tr>
<tr class="separator:a0f734e0eaceeaebc218934ab82543dc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af37bc0d4747f28913c3ba1da2468a563"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#af37bc0d4747f28913c3ba1da2468a563">free_vpid</a> (int vpid)</td></tr>
<tr class="separator:af37bc0d4747f28913c3ba1da2468a563"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a4575290ae63d65de3dd41895fea152"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a1a4575290ae63d65de3dd41895fea152">vmx_set_constant_host_state</a> (struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx)</td></tr>
<tr class="separator:a1a4575290ae63d65de3dd41895fea152"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85334c5190ac8bc72072279809aee495"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a85334c5190ac8bc72072279809aee495">vmx_prepare_switch_to_guest</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a85334c5190ac8bc72072279809aee495"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a632e0045640f1fb4b490db30ca2baabf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a632e0045640f1fb4b490db30ca2baabf">vmx_set_host_fs_gs</a> (struct <a class="el" href="structvmcs__host__state.html">vmcs_host_state</a> *host, u16 fs_sel, u16 gs_sel, unsigned long fs_base, unsigned long gs_base)</td></tr>
<tr class="separator:a632e0045640f1fb4b490db30ca2baabf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a850feb9bcc4348296adc0b819ef69b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a9a850feb9bcc4348296adc0b819ef69b">vmx_get_cpl</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a9a850feb9bcc4348296adc0b819ef69b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3227ce57b73a94120917f2065d22b6b5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a3227ce57b73a94120917f2065d22b6b5">vmx_emulation_required</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a3227ce57b73a94120917f2065d22b6b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf1cae1921d1492c7e06115012eb48e3"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#adf1cae1921d1492c7e06115012eb48e3">vmx_get_rflags</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:adf1cae1921d1492c7e06115012eb48e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae81f31c4be3384219d11e767cca4da94"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ae81f31c4be3384219d11e767cca4da94">vmx_set_rflags</a> (struct kvm_vcpu *vcpu, unsigned long rflags)</td></tr>
<tr class="separator:ae81f31c4be3384219d11e767cca4da94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bec7af421bd0dc5f26cbf0209a81390"><td class="memItemLeft" align="right" valign="top">u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a2bec7af421bd0dc5f26cbf0209a81390">vmx_get_interrupt_shadow</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a2bec7af421bd0dc5f26cbf0209a81390"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2d73f838a404b569a5c51da5ee2ce68"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ae2d73f838a404b569a5c51da5ee2ce68">vmx_set_interrupt_shadow</a> (struct kvm_vcpu *vcpu, int mask)</td></tr>
<tr class="separator:ae2d73f838a404b569a5c51da5ee2ce68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a346ce99d92706d6a8ffb9bb331fe768a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a346ce99d92706d6a8ffb9bb331fe768a">vmx_set_efer</a> (struct kvm_vcpu *vcpu, u64 efer)</td></tr>
<tr class="separator:a346ce99d92706d6a8ffb9bb331fe768a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf9f5acdb0b2a5b2778c853846cfa09f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#acf9f5acdb0b2a5b2778c853846cfa09f">vmx_set_cr0</a> (struct kvm_vcpu *vcpu, unsigned long cr0)</td></tr>
<tr class="separator:acf9f5acdb0b2a5b2778c853846cfa09f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adda41e5ad7d9839a1fd3e01efc608c37"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#adda41e5ad7d9839a1fd3e01efc608c37">vmx_set_cr4</a> (struct kvm_vcpu *vcpu, unsigned long cr4)</td></tr>
<tr class="separator:adda41e5ad7d9839a1fd3e01efc608c37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f870aba1430166e5fc5609b4c71de1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a7f870aba1430166e5fc5609b4c71de1a">set_cr4_guest_host_mask</a> (struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx)</td></tr>
<tr class="separator:a7f870aba1430166e5fc5609b4c71de1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a127240567687a7433409baa441cb3c03"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a127240567687a7433409baa441cb3c03">ept_save_pdptrs</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a127240567687a7433409baa441cb3c03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfb1910d98db4bcd82dd9a96eb069ce9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#acfb1910d98db4bcd82dd9a96eb069ce9">vmx_get_segment</a> (struct kvm_vcpu *vcpu, struct kvm_segment *var, int seg)</td></tr>
<tr class="separator:acfb1910d98db4bcd82dd9a96eb069ce9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02a5a7a2c625e52874076332ecc41ace"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a02a5a7a2c625e52874076332ecc41ace">__vmx_set_segment</a> (struct kvm_vcpu *vcpu, struct kvm_segment *var, int seg)</td></tr>
<tr class="separator:a02a5a7a2c625e52874076332ecc41ace"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bf9ef0bfb4569903417b52d6eb09d41"><td class="memItemLeft" align="right" valign="top">u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a8bf9ef0bfb4569903417b52d6eb09d41">construct_eptp</a> (struct kvm_vcpu *vcpu, hpa_t root_hpa, int root_level)</td></tr>
<tr class="separator:a8bf9ef0bfb4569903417b52d6eb09d41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab47d0d344e1a78767df9a1521c52f3e7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ab47d0d344e1a78767df9a1521c52f3e7">vmx_guest_inject_ac</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ab47d0d344e1a78767df9a1521c52f3e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ddb2979d2cb226fe63f24b99f88a99e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a6ddb2979d2cb226fe63f24b99f88a99e">vmx_update_exception_bitmap</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a6ddb2979d2cb226fe63f24b99f88a99e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae92f23c5709cc4f9fe4fe2d794deef50"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ae92f23c5709cc4f9fe4fe2d794deef50">vmx_nmi_blocked</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ae92f23c5709cc4f9fe4fe2d794deef50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a368d7a25f0cc51f62229282a5d2550d3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a368d7a25f0cc51f62229282a5d2550d3">vmx_interrupt_blocked</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a368d7a25f0cc51f62229282a5d2550d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62c6e72fbfaa38594860584e7afaa4ac"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a62c6e72fbfaa38594860584e7afaa4ac">vmx_get_nmi_mask</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a62c6e72fbfaa38594860584e7afaa4ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7d363f044f24b98c355e1400a52b6ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ab7d363f044f24b98c355e1400a52b6ac">vmx_set_nmi_mask</a> (struct kvm_vcpu *vcpu, bool masked)</td></tr>
<tr class="separator:ab7d363f044f24b98c355e1400a52b6ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f6e91eedb4d7eefd8f4007389aaac7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a3f6e91eedb4d7eefd8f4007389aaac7b">vmx_set_virtual_apic_mode</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a3f6e91eedb4d7eefd8f4007389aaac7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a938b0ca5314d7ac2f8549065a4444df9"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structvmx__uret__msr.html">vmx_uret_msr</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a938b0ca5314d7ac2f8549065a4444df9">vmx_find_uret_msr</a> (struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx, u32 msr)</td></tr>
<tr class="separator:a938b0ca5314d7ac2f8549065a4444df9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4ef65eed70b84eba92be5567feebf84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ac4ef65eed70b84eba92be5567feebf84">pt_update_intercept_for_msr</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ac4ef65eed70b84eba92be5567feebf84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae503a24f01885d9e4044034cf2e709cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ae503a24f01885d9e4044034cf2e709cb">vmx_update_host_rsp</a> (struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx, unsigned long host_rsp)</td></tr>
<tr class="separator:ae503a24f01885d9e4044034cf2e709cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b6c0e9c7b484761a132ec953d096492"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a0b6c0e9c7b484761a132ec953d096492">vmx_spec_ctrl_restore_host</a> (struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx, unsigned int <a class="el" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>)</td></tr>
<tr class="separator:a0b6c0e9c7b484761a132ec953d096492"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5df6340b2d76095776b7bedf0e7e90cb"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a5df6340b2d76095776b7bedf0e7e90cb">__vmx_vcpu_run_flags</a> (struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx)</td></tr>
<tr class="separator:a5df6340b2d76095776b7bedf0e7e90cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a145b5141f4cc5bbd36fb4082e96bbeee"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a145b5141f4cc5bbd36fb4082e96bbeee">__vmx_vcpu_run</a> (struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx, unsigned long *regs, unsigned int <a class="el" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>)</td></tr>
<tr class="separator:a145b5141f4cc5bbd36fb4082e96bbeee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07cb8535d5c63fe54c6233e78b47d6c7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a07cb8535d5c63fe54c6233e78b47d6c7">vmx_find_loadstore_msr_slot</a> (struct <a class="el" href="structvmx__msrs.html">vmx_msrs</a> *m, u32 msr)</td></tr>
<tr class="separator:a07cb8535d5c63fe54c6233e78b47d6c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a930d1b832fa3d556aafacb4fea12e0a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a930d1b832fa3d556aafacb4fea12e0a8">vmx_ept_load_pdptrs</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a930d1b832fa3d556aafacb4fea12e0a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96f48e7f7fd7a33ba502bea65d7a94d8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a96f48e7f7fd7a33ba502bea65d7a94d8">vmx_disable_intercept_for_msr</a> (struct kvm_vcpu *vcpu, u32 msr, int type)</td></tr>
<tr class="separator:a96f48e7f7fd7a33ba502bea65d7a94d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3db9d3d67497234d969c753d0b1093ab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a3db9d3d67497234d969c753d0b1093ab">vmx_enable_intercept_for_msr</a> (struct kvm_vcpu *vcpu, u32 msr, int type)</td></tr>
<tr class="separator:a3db9d3d67497234d969c753d0b1093ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46c1e27ec7a8197f1194b6cc37db30ef"><td class="memItemLeft" align="right" valign="top">u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a46c1e27ec7a8197f1194b6cc37db30ef">vmx_get_l2_tsc_offset</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a46c1e27ec7a8197f1194b6cc37db30ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac02364004e8e3f247ba9a3c3ca79a460"><td class="memItemLeft" align="right" valign="top">u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ac02364004e8e3f247ba9a3c3ca79a460">vmx_get_l2_tsc_multiplier</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ac02364004e8e3f247ba9a3c3ca79a460"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac53159f102e6a5dacbc90a2c4666ac71"><td class="memItemLeft" align="right" valign="top">gva_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ac53159f102e6a5dacbc90a2c4666ac71">vmx_get_untagged_addr</a> (struct kvm_vcpu *vcpu, gva_t gva, unsigned int <a class="el" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>)</td></tr>
<tr class="separator:ac53159f102e6a5dacbc90a2c4666ac71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f203a8d867ee0e3830ee06de5fbea20"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20">vmx_set_intercept_for_msr</a> (struct kvm_vcpu *vcpu, u32 msr, int type, bool value)</td></tr>
<tr class="separator:a5f203a8d867ee0e3830ee06de5fbea20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab423eb4ed8f021a4985f4f471c891ba3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ab423eb4ed8f021a4985f4f471c891ba3">vmx_update_cpu_dirty_logging</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ab423eb4ed8f021a4985f4f471c891ba3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2c26b0506cde250d95325afcf0518b7"><td class="memItemLeft" align="right" valign="top">static u8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ad2c26b0506cde250d95325afcf0518b7">vmx_get_rvi</a> (void)</td></tr>
<tr class="separator:ad2c26b0506cde250d95325afcf0518b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a913cb1eefe82444089f3acdd68ba512d"><td class="memItemLeft" align="right" valign="top">static unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a913cb1eefe82444089f3acdd68ba512d">vmx_l1_guest_owned_cr0_bits</a> (void)</td></tr>
<tr class="separator:a913cb1eefe82444089f3acdd68ba512d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0100af676b8116ac3f8cc0ba1ed54f4c"><td class="memItemLeft" align="right" valign="top">static __always_inline struct <a class="el" href="structkvm__vmx.html">kvm_vmx</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a0100af676b8116ac3f8cc0ba1ed54f4c">to_kvm_vmx</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a0100af676b8116ac3f8cc0ba1ed54f4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e0cb34c77519a9be4432b4dd4ec11b4"><td class="memItemLeft" align="right" valign="top">static __always_inline struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a6e0cb34c77519a9be4432b4dd4ec11b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3f9a4735e6ff00497c0086664b433bd"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlbr__desc.html">lbr_desc</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#aa3f9a4735e6ff00497c0086664b433bd">vcpu_to_lbr_desc</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aa3f9a4735e6ff00497c0086664b433bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a499f1757999ae37f448bbadf72448fa4"><td class="memItemLeft" align="right" valign="top">static struct x86_pmu_lbr *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a499f1757999ae37f448bbadf72448fa4">vcpu_to_lbr_records</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a499f1757999ae37f448bbadf72448fa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf2d6801dce444c2f2592a0942780f59"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#aaf2d6801dce444c2f2592a0942780f59">intel_pmu_lbr_is_enabled</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aaf2d6801dce444c2f2592a0942780f59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a739a0fdd09980536bf444456a0b1e5e1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a739a0fdd09980536bf444456a0b1e5e1">intel_pmu_cross_mapped_check</a> (struct kvm_pmu *pmu)</td></tr>
<tr class="separator:a739a0fdd09980536bf444456a0b1e5e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed2f5a4c9080d0316ad30f8a74ddefcc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#aed2f5a4c9080d0316ad30f8a74ddefcc">intel_pmu_create_guest_lbr_event</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aed2f5a4c9080d0316ad30f8a74ddefcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafa008ad34eb88ebd13aa2f76375cad2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#aafa008ad34eb88ebd13aa2f76375cad2">vmx_passthrough_lbr_msrs</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aafa008ad34eb88ebd13aa2f76375cad2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a400cebafa368592c80e344bb3f18eaa2"><td class="memItemLeft" align="right" valign="top">static __always_inline unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a400cebafa368592c80e344bb3f18eaa2">vmx_get_exit_qual</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a400cebafa368592c80e344bb3f18eaa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7e940dce21b0a53e1eadac452b8ddf1"><td class="memItemLeft" align="right" valign="top">static __always_inline u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#af7e940dce21b0a53e1eadac452b8ddf1">vmx_get_intr_info</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:af7e940dce21b0a53e1eadac452b8ddf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaed5367f4fedc1d1bc3d6b140bf0f2da"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structvmcs.html">vmcs</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#aaed5367f4fedc1d1bc3d6b140bf0f2da">alloc_vmcs_cpu</a> (bool shadow, int cpu, gfp_t <a class="el" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>)</td></tr>
<tr class="separator:aaed5367f4fedc1d1bc3d6b140bf0f2da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a171771cf05868f64b6e6491889a842e1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a171771cf05868f64b6e6491889a842e1">free_vmcs</a> (struct <a class="el" href="structvmcs.html">vmcs</a> *<a class="el" href="structvmcs.html">vmcs</a>)</td></tr>
<tr class="separator:a171771cf05868f64b6e6491889a842e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4323cda8d4cdaaa4a5f9188abd36a4b7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a4323cda8d4cdaaa4a5f9188abd36a4b7">alloc_loaded_vmcs</a> (struct <a class="el" href="structloaded__vmcs.html">loaded_vmcs</a> *<a class="el" href="structloaded__vmcs.html">loaded_vmcs</a>)</td></tr>
<tr class="separator:a4323cda8d4cdaaa4a5f9188abd36a4b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af92910217dcc55da03421a552d174080"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#af92910217dcc55da03421a552d174080">free_loaded_vmcs</a> (struct <a class="el" href="structloaded__vmcs.html">loaded_vmcs</a> *<a class="el" href="structloaded__vmcs.html">loaded_vmcs</a>)</td></tr>
<tr class="separator:af92910217dcc55da03421a552d174080"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acffc6d01ff543c9abee613b5fe1b1bd4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#acffc6d01ff543c9abee613b5fe1b1bd4">loaded_vmcs_clear</a> (struct <a class="el" href="structloaded__vmcs.html">loaded_vmcs</a> *<a class="el" href="structloaded__vmcs.html">loaded_vmcs</a>)</td></tr>
<tr class="separator:acffc6d01ff543c9abee613b5fe1b1bd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31f4e36482819bc92965589b265b9be6"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvmcs.html">vmcs</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a31f4e36482819bc92965589b265b9be6">alloc_vmcs</a> (bool shadow)</td></tr>
<tr class="separator:a31f4e36482819bc92965589b265b9be6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30a85cb14e27b953155d81e64a74e8f5"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a30a85cb14e27b953155d81e64a74e8f5">vmx_has_waitpkg</a> (struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx)</td></tr>
<tr class="separator:a30a85cb14e27b953155d81e64a74e8f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a046cd100cd1f1b77bfa5ba028dcd52ff"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a046cd100cd1f1b77bfa5ba028dcd52ff">vmx_need_pf_intercept</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a046cd100cd1f1b77bfa5ba028dcd52ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78db067c5ddef5481cee88243a0937ec"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec">is_unrestricted_guest</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a78db067c5ddef5481cee88243a0937ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77b0ca4dac426b317965746a6bec345e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a77b0ca4dac426b317965746a6bec345e">__vmx_guest_state_valid</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a77b0ca4dac426b317965746a6bec345e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf810bd0c2816f1b62bf2a79296358cf"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf">vmx_guest_state_valid</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:abf810bd0c2816f1b62bf2a79296358cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac39cca04dec7bf494bf2e19ee9f765fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#ac39cca04dec7bf494bf2e19ee9f765fe">dump_vmcs</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ac39cca04dec7bf494bf2e19ee9f765fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70be8e9321dc97600b63443befb6641a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a70be8e9321dc97600b63443befb6641a">vmx_get_instr_info_reg2</a> (u32 vmx_instr_info)</td></tr>
<tr class="separator:a70be8e9321dc97600b63443befb6641a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f6186445deafb0e6b3f6ffa22db11ef"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmx_8h.html#a1f6186445deafb0e6b3f6ffa22db11ef">vmx_can_use_ipiv</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a1f6186445deafb0e6b3f6ffa22db11ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a757a1e161942ada247245d3c0101345f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a757a1e161942ada247245d3c0101345f">&#9670;&nbsp;</a></span>__BUILD_VMX_MSR_BITMAP_HELPER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __BUILD_VMX_MSR_BITMAP_HELPER</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">rtype, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">action, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">bitop, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">access, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">base&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> rtype vmx_##action##_msr_bitmap_##access(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *bitmap,  \</div>
<div class="line">                               u32 msr)            \</div>
<div class="line">{                                          \</div>
<div class="line">    int f = <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> long);                         \</div>
<div class="line">                                           \</div>
<div class="line">    if (msr &lt;= 0x1fff)                             \</div>
<div class="line">        return bitop##_bit(msr, bitmap + base / f);            \</div>
<div class="line">    else <span class="keywordflow">if</span> ((msr &gt;= 0xc0000000) &amp;&amp; (msr &lt;= 0xc0001fff))               \</div>
<div class="line">        return bitop##_bit(msr &amp; 0x1fff, bitmap + (base + 0x400) / f); \</div>
<div class="line">    return (rtype)<span class="keyword">true</span>;                            \</div>
<div class="line">}</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00446">446</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a48c820479e00d43028d492e5c465d420"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48c820479e00d43028d492e5c465d420">&#9670;&nbsp;</a></span>__KVM_REQUIRED_VMX_CPU_BASED_VM_EXEC_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __KVM_REQUIRED_VMX_CPU_BASED_VM_EXEC_CONTROL</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    (CPU_BASED_HLT_EXITING |                    \</div>
<div class="line">     CPU_BASED_CR3_LOAD_EXITING |                   \</div>
<div class="line">     CPU_BASED_CR3_STORE_EXITING |                  \</div>
<div class="line">     CPU_BASED_UNCOND_IO_EXITING |                  \</div>
<div class="line">     CPU_BASED_MOV_DR_EXITING |                 \</div>
<div class="line">     CPU_BASED_USE_TSC_OFFSETTING |                 \</div>
<div class="line">     CPU_BASED_MWAIT_EXITING |                  \</div>
<div class="line">     CPU_BASED_MONITOR_EXITING |                    \</div>
<div class="line">     CPU_BASED_INVLPG_EXITING |                 \</div>
<div class="line">     CPU_BASED_RDPMC_EXITING |                  \</div>
<div class="line">     CPU_BASED_INTR_WINDOW_EXITING)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00519">519</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a440ec36a8bb2a1f972b685a0f890e2bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a440ec36a8bb2a1f972b685a0f890e2bf">&#9670;&nbsp;</a></span>__KVM_REQUIRED_VMX_VM_ENTRY_CONTROLS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __KVM_REQUIRED_VMX_VM_ENTRY_CONTROLS&#160;&#160;&#160;	(VM_ENTRY_LOAD_DEBUG_CONTROLS)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00471">471</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a3226148db9313f3562dccd09e360283d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3226148db9313f3562dccd09e360283d">&#9670;&nbsp;</a></span>__KVM_REQUIRED_VMX_VM_EXIT_CONTROLS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __KVM_REQUIRED_VMX_VM_EXIT_CONTROLS</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    (VM_EXIT_SAVE_DEBUG_CONTROLS |                  \</div>
<div class="line">     VM_EXIT_ACK_INTR_ON_EXIT)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00489">489</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="aa12d0fff156ac955575d4183ffb98fe2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa12d0fff156ac955575d4183ffb98fe2">&#9670;&nbsp;</a></span>BUILD_CONTROLS_SHADOW</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUILD_CONTROLS_SHADOW</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">lname, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">uname, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">bits&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> lname##_controls_set(<span class="keyword">struct</span> <a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx, u##bits val)          \</div>
<div class="line">{                                               \</div>
<div class="line">    if (vmx-&gt;loaded_vmcs-&gt;controls_shadow.lname != val) {                   \</div>
<div class="line">        vmcs_write##bits(uname, val);                           \</div>
<div class="line">        vmx-&gt;loaded_vmcs-&gt;controls_shadow.lname = val;                  \</div>
<div class="line">    }                                           \</div>
<div class="line">}                                               \</div>
<div class="line">static <span class="keyword">inline</span> u##bits __##lname##_controls_get(<span class="keyword">struct</span> <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a> *<a class="code" href="structvmcs.html">vmcs</a>)            \</div>
<div class="line">{                                               \</div>
<div class="line">    return <a class="code" href="structvmcs.html">vmcs</a>-&gt;controls_shadow.lname;                         \</div>
<div class="line">}                                               \</div>
<div class="line">static <span class="keyword">inline</span> u##bits lname##_controls_get(<span class="keyword">struct</span> <a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx)                \</div>
<div class="line">{                                               \</div>
<div class="line">    return __##lname##_controls_get(vmx-&gt;loaded_vmcs);                  \</div>
<div class="line">}                                               \</div>
<div class="line">static __always_inline <span class="keywordtype">void</span> lname##_controls_setbit(<span class="keyword">struct</span> <a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx, u##bits val)      \</div>
<div class="line">{                                               \</div>
<div class="line">    BUILD_BUG_ON(!(val &amp; (KVM_REQUIRED_VMX_##uname | KVM_OPTIONAL_VMX_##uname)));       \</div>
<div class="line">    lname##_controls_set(vmx, lname##_controls_get(vmx) | val);             \</div>
<div class="line">}                                               \</div>
<div class="line">static __always_inline <span class="keywordtype">void</span> lname##_controls_clearbit(<span class="keyword">struct</span> <a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx, u##bits val)    \</div>
<div class="line">{                                               \</div>
<div class="line">    BUILD_BUG_ON(!(val &amp; (KVM_REQUIRED_VMX_##uname | KVM_OPTIONAL_VMX_##uname)));       \</div>
<div class="line">    lname##_controls_set(vmx, lname##_controls_get(vmx) &amp; ~val);                \</div>
<div class="line">}</div>
<div class="ttc" id="astructloaded__vmcs_html"><div class="ttname"><a href="structloaded__vmcs.html">loaded_vmcs</a></div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00061">vmcs.h:61</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html"><div class="ttname"><a href="structvcpu__vmx.html">vcpu_vmx</a></div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00251">vmx.h:251</a></div></div>
<div class="ttc" id="astructvmcs_html"><div class="ttname"><a href="structvmcs.html">vmcs</a></div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00021">vmcs.h:21</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00585">585</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a7da7480f780ee285d71dad733f518f29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7da7480f780ee285d71dad733f518f29">&#9670;&nbsp;</a></span>BUILD_VMX_MSR_BITMAP_HELPERS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUILD_VMX_MSR_BITMAP_HELPERS</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ret_type, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">action, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">bitop&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <a class="code" href="vmx_8h.html#a757a1e161942ada247245d3c0101345f">__BUILD_VMX_MSR_BITMAP_HELPER</a>(ret_type, action, bitop, read,  0x0)     \</div>
<div class="line">    __BUILD_VMX_MSR_BITMAP_HELPER(ret_type, action, bitop, write, 0x800)</div>
<div class="ttc" id="avmx_8h_html_a757a1e161942ada247245d3c0101345f"><div class="ttname"><a href="vmx_8h.html#a757a1e161942ada247245d3c0101345f">__BUILD_VMX_MSR_BITMAP_HELPER</a></div><div class="ttdeci">#define __BUILD_VMX_MSR_BITMAP_HELPER(rtype, action, bitop, access, base)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00446">vmx.h:446</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00458">458</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a39e788631b8bf99e289ca2d10dc2dbae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39e788631b8bf99e289ca2d10dc2dbae">&#9670;&nbsp;</a></span>KVM_OPTIONAL_VMX_CPU_BASED_VM_EXEC_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_OPTIONAL_VMX_CPU_BASED_VM_EXEC_CONTROL</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    (CPU_BASED_RDTSC_EXITING |                  \</div>
<div class="line">     CPU_BASED_TPR_SHADOW |                     \</div>
<div class="line">     CPU_BASED_USE_IO_BITMAPS |                 \</div>
<div class="line">     CPU_BASED_MONITOR_TRAP_FLAG |                  \</div>
<div class="line">     CPU_BASED_USE_MSR_BITMAPS |                    \</div>
<div class="line">     CPU_BASED_NMI_WINDOW_EXITING |                 \</div>
<div class="line">     CPU_BASED_PAUSE_EXITING |                  \</div>
<div class="line">     CPU_BASED_ACTIVATE_SECONDARY_CONTROLS |            \</div>
<div class="line">     CPU_BASED_ACTIVATE_TERTIARY_CONTROLS)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00542">542</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a666a64693d276ce33938c2b4fdd26e7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a666a64693d276ce33938c2b4fdd26e7d">&#9670;&nbsp;</a></span>KVM_OPTIONAL_VMX_PIN_BASED_VM_EXEC_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_OPTIONAL_VMX_PIN_BASED_VM_EXEC_CONTROL</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    (PIN_BASED_VIRTUAL_NMIS |                   \</div>
<div class="line">     PIN_BASED_POSTED_INTR |                    \</div>
<div class="line">     PIN_BASED_VMX_PREEMPTION_TIMER)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00514">514</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a703910050e1b6c8935b18df585c6e481"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a703910050e1b6c8935b18df585c6e481">&#9670;&nbsp;</a></span>KVM_OPTIONAL_VMX_SECONDARY_VM_EXEC_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_OPTIONAL_VMX_SECONDARY_VM_EXEC_CONTROL</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    (SECONDARY_EXEC_VIRTUALIZE_APIC_ACCESSES |          \</div>
<div class="line">     SECONDARY_EXEC_VIRTUALIZE_X2APIC_MODE |            \</div>
<div class="line">     SECONDARY_EXEC_WBINVD_EXITING |                \</div>
<div class="line">     SECONDARY_EXEC_ENABLE_VPID |                   \</div>
<div class="line">     SECONDARY_EXEC_ENABLE_EPT |                    \</div>
<div class="line">     SECONDARY_EXEC_UNRESTRICTED_GUEST |                \</div>
<div class="line">     SECONDARY_EXEC_PAUSE_LOOP_EXITING |                \</div>
<div class="line">     SECONDARY_EXEC_DESC |                      \</div>
<div class="line">     SECONDARY_EXEC_ENABLE_RDTSCP |                 \</div>
<div class="line">     SECONDARY_EXEC_ENABLE_INVPCID |                \</div>
<div class="line">     SECONDARY_EXEC_APIC_REGISTER_VIRT |                \</div>
<div class="line">     SECONDARY_EXEC_VIRTUAL_INTR_DELIVERY |             \</div>
<div class="line">     SECONDARY_EXEC_SHADOW_VMCS |                   \</div>
<div class="line">     SECONDARY_EXEC_ENABLE_XSAVES |                 \</div>
<div class="line">     SECONDARY_EXEC_RDSEED_EXITING |                \</div>
<div class="line">     SECONDARY_EXEC_RDRAND_EXITING |                \</div>
<div class="line">     SECONDARY_EXEC_ENABLE_PML |                    \</div>
<div class="line">     SECONDARY_EXEC_TSC_SCALING |                   \</div>
<div class="line">     SECONDARY_EXEC_ENABLE_USR_WAIT_PAUSE |             \</div>
<div class="line">     SECONDARY_EXEC_PT_USE_GPA |                    \</div>
<div class="line">     SECONDARY_EXEC_PT_CONCEAL_VMX |                \</div>
<div class="line">     SECONDARY_EXEC_ENABLE_VMFUNC |                 \</div>
<div class="line">     SECONDARY_EXEC_BUS_LOCK_DETECTION |                \</div>
<div class="line">     SECONDARY_EXEC_NOTIFY_VM_EXITING |             \</div>
<div class="line">     SECONDARY_EXEC_ENCLS_EXITING)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00554">554</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="ae80ea124e02d58c368631dad25647f67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae80ea124e02d58c368631dad25647f67">&#9670;&nbsp;</a></span>KVM_OPTIONAL_VMX_TERTIARY_VM_EXEC_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_OPTIONAL_VMX_TERTIARY_VM_EXEC_CONTROL&#160;&#160;&#160;	(TERTIARY_EXEC_IPI_VIRT)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00582">582</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a62a5468c0dba5052102571083ce5673b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62a5468c0dba5052102571083ce5673b">&#9670;&nbsp;</a></span>KVM_OPTIONAL_VMX_VM_ENTRY_CONTROLS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_OPTIONAL_VMX_VM_ENTRY_CONTROLS</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    (VM_ENTRY_LOAD_IA32_PERF_GLOBAL_CTRL |              \</div>
<div class="line">     VM_ENTRY_LOAD_IA32_PAT |                   \</div>
<div class="line">     VM_ENTRY_LOAD_IA32_EFER |                  \</div>
<div class="line">     VM_ENTRY_LOAD_BNDCFGS |                    \</div>
<div class="line">     VM_ENTRY_PT_CONCEAL_PIP |                  \</div>
<div class="line">     VM_ENTRY_LOAD_IA32_RTIT_CTL)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00481">481</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a3756b66be4125133efa559f2f0d5db79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3756b66be4125133efa559f2f0d5db79">&#9670;&nbsp;</a></span>KVM_OPTIONAL_VMX_VM_EXIT_CONTROLS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_OPTIONAL_VMX_VM_EXIT_CONTROLS</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">          (VM_EXIT_LOAD_IA32_PERF_GLOBAL_CTRL |         \</div>
<div class="line">           VM_EXIT_SAVE_IA32_PAT |                  \</div>
<div class="line">           VM_EXIT_LOAD_IA32_PAT |                  \</div>
<div class="line">           VM_EXIT_SAVE_IA32_EFER |                 \</div>
<div class="line">           VM_EXIT_SAVE_VMX_PREEMPTION_TIMER |          \</div>
<div class="line">           VM_EXIT_LOAD_IA32_EFER |                 \</div>
<div class="line">           VM_EXIT_CLEAR_BNDCFGS |                  \</div>
<div class="line">           VM_EXIT_PT_CONCEAL_PIP |                 \</div>
<div class="line">           VM_EXIT_CLEAR_IA32_RTIT_CTL)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00500">500</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="ae6a5137271527c181fff5a32a2e513ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6a5137271527c181fff5a32a2e513ca">&#9670;&nbsp;</a></span>KVM_REQUIRED_VMX_CPU_BASED_VM_EXEC_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_REQUIRED_VMX_CPU_BASED_VM_EXEC_CONTROL&#160;&#160;&#160;		<a class="el" href="vmx_8h.html#a48c820479e00d43028d492e5c465d420">__KVM_REQUIRED_VMX_CPU_BASED_VM_EXEC_CONTROL</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00538">538</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a6469fb2dfb90a978b1a07606c1213b8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6469fb2dfb90a978b1a07606c1213b8a">&#9670;&nbsp;</a></span>KVM_REQUIRED_VMX_PIN_BASED_VM_EXEC_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_REQUIRED_VMX_PIN_BASED_VM_EXEC_CONTROL</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    (PIN_BASED_EXT_INTR_MASK |                  \</div>
<div class="line">     PIN_BASED_NMI_EXITING)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00511">511</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a5511081ac96d7fb9cd276c1522153dcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5511081ac96d7fb9cd276c1522153dcd">&#9670;&nbsp;</a></span>KVM_REQUIRED_VMX_SECONDARY_VM_EXEC_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_REQUIRED_VMX_SECONDARY_VM_EXEC_CONTROL&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00553">553</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a82751de8c057906d070c4bce6f894f0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82751de8c057906d070c4bce6f894f0d">&#9670;&nbsp;</a></span>KVM_REQUIRED_VMX_TERTIARY_VM_EXEC_CONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_REQUIRED_VMX_TERTIARY_VM_EXEC_CONTROL&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00581">581</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a2d23742153f95ca3ff720ac1aeb24455"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d23742153f95ca3ff720ac1aeb24455">&#9670;&nbsp;</a></span>KVM_REQUIRED_VMX_VM_ENTRY_CONTROLS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_REQUIRED_VMX_VM_ENTRY_CONTROLS&#160;&#160;&#160;		<a class="el" href="vmx_8h.html#a440ec36a8bb2a1f972b685a0f890e2bf">__KVM_REQUIRED_VMX_VM_ENTRY_CONTROLS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00478">478</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="ad834a55c1ff6de9ea73667a13f661e18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad834a55c1ff6de9ea73667a13f661e18">&#9670;&nbsp;</a></span>KVM_REQUIRED_VMX_VM_EXIT_CONTROLS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_REQUIRED_VMX_VM_EXIT_CONTROLS&#160;&#160;&#160;		<a class="el" href="vmx_8h.html#a3226148db9313f3562dccd09e360283d">__KVM_REQUIRED_VMX_VM_EXIT_CONTROLS</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00497">497</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="af5c4970b0ed8ffa02838f71ab250234c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5c4970b0ed8ffa02838f71ab250234c">&#9670;&nbsp;</a></span>MAX_NR_LOADSTORE_MSRS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_NR_LOADSTORE_MSRS&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00031">31</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a57f539d75457e1ff3a3df61794beb728"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57f539d75457e1ff3a3df61794beb728">&#9670;&nbsp;</a></span>MAX_NR_USER_RETURN_MSRS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_NR_USER_RETURN_MSRS&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00028">28</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a977e4f4c09ed5b257a5c68d08249dc09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a977e4f4c09ed5b257a5c68d08249dc09">&#9670;&nbsp;</a></span>MAX_POSSIBLE_PASSTHROUGH_MSRS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_POSSIBLE_PASSTHROUGH_MSRS&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00362">362</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a2c8d9fefd4a15747f3f7f38c15ec6919"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c8d9fefd4a15747f3f7f38c15ec6919">&#9670;&nbsp;</a></span>MSR_TYPE_R</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSR_TYPE_R&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00019">19</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a511b7b2ce3b986ba2ed692fbc0f79bbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a511b7b2ce3b986ba2ed692fbc0f79bbc">&#9670;&nbsp;</a></span>MSR_TYPE_RW</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSR_TYPE_RW&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00021">21</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="ab1ba03357f1a299c69fbaf2c5a9d9e96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1ba03357f1a299c69fbaf2c5a9d9e96">&#9670;&nbsp;</a></span>MSR_TYPE_W</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSR_TYPE_W&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00020">20</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="aeea1ef922b70c27f5f28e362fee0976c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeea1ef922b70c27f5f28e362fee0976c">&#9670;&nbsp;</a></span>PML_ENTITY_NUM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PML_ENTITY_NUM&#160;&#160;&#160;512</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00338">338</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a4e134079db013b8754acf7236e7ea909"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e134079db013b8754acf7236e7ea909">&#9670;&nbsp;</a></span>RTIT_ADDR_RANGE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RTIT_ADDR_RANGE&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00053">53</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a1518215c28d01df17342d860c4ecdd0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1518215c28d01df17342d860c4ecdd0a">&#9670;&nbsp;</a></span>VMX_REGS_LAZY_LOAD_SET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VMX_REGS_LAZY_LOAD_SET</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">                ((1 &lt;&lt; VCPU_REGS_RIP) |         \</div>
<div class="line">                (1 &lt;&lt; VCPU_REGS_RSP) |          \</div>
<div class="line">                (1 &lt;&lt; VCPU_EXREG_RFLAGS) |      \</div>
<div class="line">                (1 &lt;&lt; VCPU_EXREG_PDPTR) |       \</div>
<div class="line">                (1 &lt;&lt; VCPU_EXREG_SEGMENTS) |    \</div>
<div class="line">                (1 &lt;&lt; VCPU_EXREG_CR0) |         \</div>
<div class="line">                (1 &lt;&lt; VCPU_EXREG_CR3) |         \</div>
<div class="line">                (1 &lt;&lt; VCPU_EXREG_CR4) |         \</div>
<div class="line">                (1 &lt;&lt; VCPU_EXREG_EXIT_INFO_1) | \</div>
<div class="line">                (1 &lt;&lt; VCPU_EXREG_EXIT_INFO_2))</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00623">623</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<a id="a42f09aaa2a9a2400562edd68086fa30c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42f09aaa2a9a2400562edd68086fa30c">&#9670;&nbsp;</a></span>X2APIC_MSR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X2APIC_MSR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">r</td><td>)</td>
          <td>&#160;&#160;&#160;(APIC_BASE_MSR + ((r) &gt;&gt; 4))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00023">23</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a0a7449d6e0e68d0bb0f25374e3a40153"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a7449d6e0e68d0bb0f25374e3a40153">&#9670;&nbsp;</a></span>segment_cache_field</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153">segment_cache_field</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a0a7449d6e0e68d0bb0f25374e3a40153a2dd907feb7877dc961e2edd92bc83c27"></a>SEG_FIELD_SEL&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a0a7449d6e0e68d0bb0f25374e3a40153a2817166247d61c4cfed655cd57a17c18"></a>SEG_FIELD_BASE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a0a7449d6e0e68d0bb0f25374e3a40153ade751405f8b5a5ef6013193f27643c05"></a>SEG_FIELD_LIMIT&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a0a7449d6e0e68d0bb0f25374e3a40153aa33dfa2adf3a5648924eceeacc373b01"></a>SEG_FIELD_AR&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a0a7449d6e0e68d0bb0f25374e3a40153a99727657808cbc565ee2d43ad4c2ba6c"></a>SEG_FIELD_NR&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00044">44</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                         {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153a2dd907feb7877dc961e2edd92bc83c27">SEG_FIELD_SEL</a> = 0,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153a2817166247d61c4cfed655cd57a17c18">SEG_FIELD_BASE</a> = 1,</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153ade751405f8b5a5ef6013193f27643c05">SEG_FIELD_LIMIT</a> = 2,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153aa33dfa2adf3a5648924eceeacc373b01">SEG_FIELD_AR</a> = 3,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153a99727657808cbc565ee2d43ad4c2ba6c">SEG_FIELD_NR</a> = 4</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;};</div>
<div class="ttc" id="avmx_8h_html_a0a7449d6e0e68d0bb0f25374e3a40153a2817166247d61c4cfed655cd57a17c18"><div class="ttname"><a href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153a2817166247d61c4cfed655cd57a17c18">SEG_FIELD_BASE</a></div><div class="ttdeci">@ SEG_FIELD_BASE</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00046">vmx.h:46</a></div></div>
<div class="ttc" id="avmx_8h_html_a0a7449d6e0e68d0bb0f25374e3a40153a2dd907feb7877dc961e2edd92bc83c27"><div class="ttname"><a href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153a2dd907feb7877dc961e2edd92bc83c27">SEG_FIELD_SEL</a></div><div class="ttdeci">@ SEG_FIELD_SEL</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00045">vmx.h:45</a></div></div>
<div class="ttc" id="avmx_8h_html_a0a7449d6e0e68d0bb0f25374e3a40153a99727657808cbc565ee2d43ad4c2ba6c"><div class="ttname"><a href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153a99727657808cbc565ee2d43ad4c2ba6c">SEG_FIELD_NR</a></div><div class="ttdeci">@ SEG_FIELD_NR</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00051">vmx.h:50</a></div></div>
<div class="ttc" id="avmx_8h_html_a0a7449d6e0e68d0bb0f25374e3a40153aa33dfa2adf3a5648924eceeacc373b01"><div class="ttname"><a href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153aa33dfa2adf3a5648924eceeacc373b01">SEG_FIELD_AR</a></div><div class="ttdeci">@ SEG_FIELD_AR</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00048">vmx.h:48</a></div></div>
<div class="ttc" id="avmx_8h_html_a0a7449d6e0e68d0bb0f25374e3a40153ade751405f8b5a5ef6013193f27643c05"><div class="ttname"><a href="vmx_8h.html#a0a7449d6e0e68d0bb0f25374e3a40153ade751405f8b5a5ef6013193f27643c05">SEG_FIELD_LIMIT</a></div><div class="ttdeci">@ SEG_FIELD_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00047">vmx.h:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a77b0ca4dac426b317965746a6bec345e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77b0ca4dac426b317965746a6bec345e">&#9670;&nbsp;</a></span>__vmx_guest_state_valid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool __vmx_guest_state_valid </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03796">3796</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;{</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;    <span class="comment">/* real mode guest state checks */</span></div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="x86_8h.html#a134b4e55e4ea92a3519e9538f05d4e6b">is_protmode</a>(vcpu) || (<a class="code" href="vmx_8c.html#adf1cae1921d1492c7e06115012eb48e3">vmx_get_rflags</a>(vcpu) &amp; X86_EFLAGS_VM)) {</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f">rmode_segment_valid</a>(vcpu, VCPU_SREG_CS))</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f">rmode_segment_valid</a>(vcpu, VCPU_SREG_SS))</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f">rmode_segment_valid</a>(vcpu, VCPU_SREG_DS))</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f">rmode_segment_valid</a>(vcpu, VCPU_SREG_ES))</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f">rmode_segment_valid</a>(vcpu, VCPU_SREG_FS))</div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f">rmode_segment_valid</a>(vcpu, VCPU_SREG_GS))</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;    <span class="comment">/* protected mode guest state checks */</span></div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#ad56726eeac472ac5b038651ccffbb6f4">cs_ss_rpl_check</a>(vcpu))</div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a53b41b0e13efa39a027845ff9af21ed6">code_segment_valid</a>(vcpu))</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#abdb19ee07646c48c401dad49fae9c607">stack_segment_valid</a>(vcpu))</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d">data_segment_valid</a>(vcpu, VCPU_SREG_DS))</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d">data_segment_valid</a>(vcpu, VCPU_SREG_ES))</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d">data_segment_valid</a>(vcpu, VCPU_SREG_FS))</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d">data_segment_valid</a>(vcpu, VCPU_SREG_GS))</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#ae22de32cadb09c91caa1acb52293f01f">tr_valid</a>(vcpu))</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a1c712b1524bbb5ba769fb529614d5c35">ldtr_valid</a>(vcpu))</div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;    }</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;    <span class="comment">/* TODO:</span></div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;<span class="comment">     * - Add checks on RIP</span></div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;<span class="comment">     * - Add checks on RFLAGS</span></div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160; </div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;}</div>
<div class="ttc" id="avmx_8c_html_a1c712b1524bbb5ba769fb529614d5c35"><div class="ttname"><a href="vmx_8c.html#a1c712b1524bbb5ba769fb529614d5c35">ldtr_valid</a></div><div class="ttdeci">static bool ldtr_valid(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03762">vmx.c:3762</a></div></div>
<div class="ttc" id="avmx_8c_html_a335c8d8645c4e9d64ffcf6d5bc52b10f"><div class="ttname"><a href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f">rmode_segment_valid</a></div><div class="ttdeci">static bool rmode_segment_valid(struct kvm_vcpu *vcpu, int seg)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03648">vmx.c:3648</a></div></div>
<div class="ttc" id="avmx_8c_html_a53b41b0e13efa39a027845ff9af21ed6"><div class="ttname"><a href="vmx_8c.html#a53b41b0e13efa39a027845ff9af21ed6">code_segment_valid</a></div><div class="ttdeci">static bool code_segment_valid(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03669">vmx.c:3669</a></div></div>
<div class="ttc" id="avmx_8c_html_abdb19ee07646c48c401dad49fae9c607"><div class="ttname"><a href="vmx_8c.html#abdb19ee07646c48c401dad49fae9c607">stack_segment_valid</a></div><div class="ttdeci">static bool stack_segment_valid(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03697">vmx.c:3697</a></div></div>
<div class="ttc" id="avmx_8c_html_ad10e667d050b2631c4b70247f8931c7d"><div class="ttname"><a href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d">data_segment_valid</a></div><div class="ttdeci">static bool data_segment_valid(struct kvm_vcpu *vcpu, int seg)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03719">vmx.c:3719</a></div></div>
<div class="ttc" id="avmx_8c_html_ad56726eeac472ac5b038651ccffbb6f4"><div class="ttname"><a href="vmx_8c.html#ad56726eeac472ac5b038651ccffbb6f4">cs_ss_rpl_check</a></div><div class="ttdeci">static bool cs_ss_rpl_check(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03780">vmx.c:3780</a></div></div>
<div class="ttc" id="avmx_8c_html_adf1cae1921d1492c7e06115012eb48e3"><div class="ttname"><a href="vmx_8c.html#adf1cae1921d1492c7e06115012eb48e3">vmx_get_rflags</a></div><div class="ttdeci">unsigned long vmx_get_rflags(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l01509">vmx.c:1509</a></div></div>
<div class="ttc" id="avmx_8c_html_ae22de32cadb09c91caa1acb52293f01f"><div class="ttname"><a href="vmx_8c.html#ae22de32cadb09c91caa1acb52293f01f">tr_valid</a></div><div class="ttdeci">static bool tr_valid(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03744">vmx.c:3744</a></div></div>
<div class="ttc" id="ax86_8h_html_a134b4e55e4ea92a3519e9538f05d4e6b"><div class="ttname"><a href="x86_8h.html#a134b4e55e4ea92a3519e9538f05d4e6b">is_protmode</a></div><div class="ttdeci">static bool is_protmode(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00138">x86.h:138</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a77b0ca4dac426b317965746a6bec345e_cgraph.png" border="0" usemap="#avmx_8h_a77b0ca4dac426b317965746a6bec345e_cgraph" alt=""/></div>
<map name="avmx_8h_a77b0ca4dac426b317965746a6bec345e_cgraph" id="avmx_8h_a77b0ca4dac426b317965746a6bec345e_cgraph">
<area shape="rect" title=" " alt="" coords="5,309,192,336"/>
<area shape="rect" href="vmx_8c.html#a53b41b0e13efa39a027845ff9af21ed6" title=" " alt="" coords="245,259,401,285"/>
<area shape="rect" href="vmx_8c.html#ad56726eeac472ac5b038651ccffbb6f4" title=" " alt="" coords="260,309,387,336"/>
<area shape="rect" href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d" title=" " alt="" coords="246,360,401,387"/>
<area shape="rect" href="x86_8h.html#a134b4e55e4ea92a3519e9538f05d4e6b" title=" " alt="" coords="272,512,375,539"/>
<area shape="rect" href="vmx_8c.html#a1c712b1524bbb5ba769fb529614d5c35" title=" " alt="" coords="282,107,365,133"/>
<area shape="rect" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f" title=" " alt="" coords="240,411,407,437"/>
<area shape="rect" href="vmx_8c.html#abdb19ee07646c48c401dad49fae9c607" title=" " alt="" coords="243,157,403,184"/>
<area shape="rect" href="vmx_8c.html#ae22de32cadb09c91caa1acb52293f01f" title=" " alt="" coords="288,208,359,235"/>
<area shape="rect" href="vmx_8c.html#adf1cae1921d1492c7e06115012eb48e3" title=" " alt="" coords="707,411,830,437"/>
<area shape="rect" href="vmx_8c.html#acfb1910d98db4bcd82dd9a96eb069ce9" title=" " alt="" coords="467,259,609,285"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="990,360,1061,387"/>
<area shape="rect" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977" title=" " alt="" coords="679,259,859,285"/>
<area shape="rect" href="vmx_8c.html#a911b88947099c0d21f8fbeca202ea30f" title=" " alt="" coords="669,309,868,336"/>
<area shape="rect" href="vmx_8c.html#ab9185adefc641ff428164a7fcab15c45" title=" " alt="" coords="689,193,849,234"/>
<area shape="rect" href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc" title=" " alt="" coords="689,127,849,169"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="971,204,1080,231"/>
<area shape="rect" href="vmx_8c.html#a69771798b92b67f275b9be73a17f6353" title=" " alt="" coords="916,309,1135,336"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="1235,157,1346,184"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="1232,208,1349,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="1210,107,1371,133"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="1231,259,1350,285"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="1447,132,1597,159"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="1467,183,1577,209"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1194,461,1387,488"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="1183,411,1399,437"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="977,259,1074,285"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="1232,360,1349,387"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="1237,309,1344,336"/>
<area shape="rect" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7" title=" " alt="" coords="971,107,1080,133"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a77b65dd311c34381a8508de99e9b8543" title=" " alt="" coords="1232,5,1349,32"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="1231,56,1350,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="465,512,611,539"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="953,512,1098,539"/>
<area shape="rect" href="vmx_8c.html#a0a4bc0d90ba4aa4d6e9758f35cd84261" title=" " alt="" coords="455,395,621,437"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a77b0ca4dac426b317965746a6bec345e_icgraph.png" border="0" usemap="#avmx_8h_a77b0ca4dac426b317965746a6bec345e_icgraph" alt=""/></div>
<map name="avmx_8h_a77b0ca4dac426b317965746a6bec345e_icgraph" id="avmx_8h_a77b0ca4dac426b317965746a6bec345e_icgraph">
<area shape="rect" title=" " alt="" coords="1988,43,2175,69"/>
<area shape="rect" href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf" title=" " alt="" coords="1767,43,1940,69"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,68,138,95"/>
<area shape="rect" href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5" title=" " alt="" coords="1533,93,1719,120"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="1112,144,1295,171"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1361,93,1467,120"/>
<area shape="rect" href="vmx_8c.html#ae81f31c4be3384219d11e767cca4da94" title=" " alt="" coords="1353,595,1475,621"/>
<area shape="rect" href="vmx_8c.html#a9e72f6be0ed4dafcb17b8fb874a39d58" title=" " alt="" coords="1343,43,1485,69"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,357,853,384"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,533,361,560"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,613,604,640"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,145,631,186"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,379,651,421"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,437,387,464"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,497,618,538"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,211,633,237"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,262,635,303"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,328,615,355"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,533,140,560"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,885,373,926"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,892,136,919"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,145,369,186"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,379,374,405"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,277,343,304"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,328,372,355"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,379,134,405"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="905,262,1060,303"/>
<area shape="rect" href="sgx_8c.html#ad3394313e85a46c8e1bc4880ddde7fc9" title=" " alt="" coords="1132,595,1275,621"/>
<area shape="rect" href="vmx_2nested_8c.html#a46021f02931b3001ef00a526b56448a8" title=" " alt="" coords="1116,777,1291,804"/>
<area shape="rect" href="vmx_2nested_8c.html#aec3ff66d7b1e9086f727ebe6b9b1a0cf" title=" " alt="" coords="1122,853,1285,880"/>
<area shape="rect" href="vmx_2nested_8c.html#a3c80ece98832af9587ecff9947817449" title=" " alt="" coords="901,968,1064,995"/>
<area shape="rect" href="sgx_8c.html#a34e5ee57c3e7c3172f8ae6ed981d703d" title=" " alt="" coords="929,595,1036,621"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="715,816,837,843"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="713,867,839,893"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="717,765,835,792"/>
<area shape="rect" href="vmx_2nested_8c.html#a4d1da86d40e5c09521979006a05a35e4" title=" " alt="" coords="917,917,1048,944"/>
<area shape="rect" href="vmx_2nested_8c.html#add1e82c32385142c0fca04a1db8cbc3a" title=" " alt="" coords="711,715,841,741"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="719,968,833,995"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="715,1019,837,1045"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="713,1069,839,1096"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="714,917,838,944"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fecee9010894e3a1513a0924e24dd6" title=" " alt="" coords="474,664,611,691"/>
<area shape="rect" href="vmx_2nested_8c.html#a23e3de8c964e87404eea818be6f70154" title=" " alt="" coords="471,715,614,741"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="481,1120,605,1147"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="717,1171,835,1197"/>
</map>
</div>

</div>
</div>
<a id="a02a5a7a2c625e52874076332ecc41ace"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02a5a7a2c625e52874076332ecc41ace">&#9670;&nbsp;</a></span>__vmx_set_segment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __vmx_set_segment </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_segment *&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>seg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03572">3572</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;{</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structkvm__vmx__segment__field.html">kvm_vmx_segment_field</a> *sf = &amp;<a class="code" href="vmx_8c.html#a62f407b4a232a19c805bc4e89f2159cd">kvm_vmx_segment_fields</a>[seg];</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160; </div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;    <a class="code" href="vmx_8c.html#addb62cc2799bab41b7029f93bf448b1c">vmx_segment_cache_clear</a>(vmx);</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160; </div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;    <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vm86_active</a> &amp;&amp; seg != VCPU_SREG_LDTR) {</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#a352cbdef95e01037931fc528039ba483">segs</a>[seg] = *var;</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;        <span class="keywordflow">if</span> (seg == VCPU_SREG_TR)</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;            <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(sf-&gt;<a class="code" href="structkvm__vmx__segment__field.html#ab2b527cd4e03dd0d48ffb434d8ec0966">selector</a>, var-&gt;selector);</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var-&gt;s)</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;            <a class="code" href="vmx_8c.html#ad451ebc6caea05e6b8efad3669027247">fix_rmode_seg</a>(seg, &amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#a352cbdef95e01037931fc528039ba483">segs</a>[seg]);</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;    }</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160; </div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(sf-&gt;<a class="code" href="structkvm__vmx__segment__field.html#a88c544a5dc483b1f835d6f36a2952692">base</a>, var-&gt;base);</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;    <a class="code" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9">vmcs_write32</a>(sf-&gt;<a class="code" href="structkvm__vmx__segment__field.html#aad11b9bcf959478bad6a5ca6d62b6416">limit</a>, var-&gt;limit);</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(sf-&gt;<a class="code" href="structkvm__vmx__segment__field.html#ab2b527cd4e03dd0d48ffb434d8ec0966">selector</a>, var-&gt;selector);</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160; </div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;<span class="comment">     *   Fix the &quot;Accessed&quot; bit in AR field of segment registers for older</span></div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;<span class="comment">     * qemu binaries.</span></div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;<span class="comment">     *   IA32 arch specifies that at the time of processor reset the</span></div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;<span class="comment">     * &quot;Accessed&quot; bit in the AR field of segment registers is 1. And qemu</span></div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;<span class="comment">     * is setting it to 0 in the userland code. This causes invalid guest</span></div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;<span class="comment">     * state vmexit when &quot;unrestricted guest&quot; mode is turned on.</span></div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;<span class="comment">     *    Fix for this setup issue in cpu_reset is being pushed in the qemu</span></div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;<span class="comment">     * tree. Newer qemu binaries with that qemu fix would not need this</span></div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;<span class="comment">     * kvm hack.</span></div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec">is_unrestricted_guest</a>(vcpu) &amp;&amp; (seg != VCPU_SREG_LDTR))</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;        var-&gt;type |= 0x1; <span class="comment">/* Accessed */</span></div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160; </div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;    <a class="code" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9">vmcs_write32</a>(sf-&gt;<a class="code" href="structkvm__vmx__segment__field.html#a3f8b2c3886933f8421f7d499889403b8">ar_bytes</a>, <a class="code" href="vmx_8c.html#a0a4bc0d90ba4aa4d6e9758f35cd84261">vmx_segment_access_rights</a>(var));</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;}</div>
<div class="ttc" id="astructkvm__vmx__segment__field_html"><div class="ttname"><a href="structkvm__vmx__segment__field.html">kvm_vmx_segment_field</a></div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00504">vmx.c:504</a></div></div>
<div class="ttc" id="astructkvm__vmx__segment__field_html_a3f8b2c3886933f8421f7d499889403b8"><div class="ttname"><a href="structkvm__vmx__segment__field.html#a3f8b2c3886933f8421f7d499889403b8">kvm_vmx_segment_field::ar_bytes</a></div><div class="ttdeci">unsigned ar_bytes</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00508">vmx.c:508</a></div></div>
<div class="ttc" id="astructkvm__vmx__segment__field_html_a88c544a5dc483b1f835d6f36a2952692"><div class="ttname"><a href="structkvm__vmx__segment__field.html#a88c544a5dc483b1f835d6f36a2952692">kvm_vmx_segment_field::base</a></div><div class="ttdeci">unsigned base</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00506">vmx.c:506</a></div></div>
<div class="ttc" id="astructkvm__vmx__segment__field_html_aad11b9bcf959478bad6a5ca6d62b6416"><div class="ttname"><a href="structkvm__vmx__segment__field.html#aad11b9bcf959478bad6a5ca6d62b6416">kvm_vmx_segment_field::limit</a></div><div class="ttdeci">unsigned limit</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00507">vmx.c:507</a></div></div>
<div class="ttc" id="astructkvm__vmx__segment__field_html_ab2b527cd4e03dd0d48ffb434d8ec0966"><div class="ttname"><a href="structkvm__vmx__segment__field.html#ab2b527cd4e03dd0d48ffb434d8ec0966">kvm_vmx_segment_field::selector</a></div><div class="ttdeci">unsigned selector</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00505">vmx.c:505</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_a352cbdef95e01037931fc528039ba483"><div class="ttname"><a href="structvcpu__vmx.html#a352cbdef95e01037931fc528039ba483">vcpu_vmx::segs</a></div><div class="ttdeci">struct kvm_segment segs[8]</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00305">vmx.h:306</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_a681de6c7b77c3ea7dc1957773c87b753"><div class="ttname"><a href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">vcpu_vmx::rmode</a></div><div class="ttdeci">struct vcpu_vmx::@40 rmode</div></div>
<div class="ttc" id="astructvcpu__vmx_html_a8a60fad06a6c03c5cc25e80d9a5b0203"><div class="ttname"><a href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu_vmx::vcpu</a></div><div class="ttdeci">struct kvm_vcpu vcpu</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00241">vmx.h:252</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_aaa63f71d9d8f2379dcbd33365383f22e"><div class="ttname"><a href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vcpu_vmx::vm86_active</a></div><div class="ttdeci">int vm86_active</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00304">vmx.h:304</a></div></div>
<div class="ttc" id="avmx_8c_html_a0a4bc0d90ba4aa4d6e9758f35cd84261"><div class="ttname"><a href="vmx_8c.html#a0a4bc0d90ba4aa4d6e9758f35cd84261">vmx_segment_access_rights</a></div><div class="ttdeci">static u32 vmx_segment_access_rights(struct kvm_segment *var)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03555">vmx.c:3555</a></div></div>
<div class="ttc" id="avmx_8c_html_a62f407b4a232a19c805bc4e89f2159cd"><div class="ttname"><a href="vmx_8c.html#a62f407b4a232a19c805bc4e89f2159cd">kvm_vmx_segment_fields</a></div><div class="ttdeci">static const struct kvm_vmx_segment_field kvm_vmx_segment_fields[]</div></div>
<div class="ttc" id="avmx_8c_html_ad451ebc6caea05e6b8efad3669027247"><div class="ttname"><a href="vmx_8c.html#ad451ebc6caea05e6b8efad3669027247">fix_rmode_seg</a></div><div class="ttdeci">static void fix_rmode_seg(int seg, struct kvm_segment *save)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03035">vmx.c:3035</a></div></div>
<div class="ttc" id="avmx_8c_html_addb62cc2799bab41b7029f93bf448b1c"><div class="ttname"><a href="vmx_8c.html#addb62cc2799bab41b7029f93bf448b1c">vmx_segment_cache_clear</a></div><div class="ttdeci">static void vmx_segment_cache_clear(struct vcpu_vmx *vmx)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00520">vmx.c:520</a></div></div>
<div class="ttc" id="avmx_8h_html_a6e0cb34c77519a9be4432b4dd4ec11b4"><div class="ttname"><a href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a></div><div class="ttdeci">static __always_inline struct vcpu_vmx * to_vmx(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00657">vmx.h:657</a></div></div>
<div class="ttc" id="avmx_8h_html_a78db067c5ddef5481cee88243a0937ec"><div class="ttname"><a href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec">is_unrestricted_guest</a></div><div class="ttdeci">static bool is_unrestricted_guest(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00727">vmx.h:727</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_a053ad90862efca58007aa2827f072fe8"><div class="ttname"><a href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a></div><div class="ttdeci">static __always_inline void vmcs_writel(unsigned long field, unsigned long value)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00258">vmx_ops.h:258</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_a25c2200a7bcdc61f46fc40df2aa25a6a"><div class="ttname"><a href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a></div><div class="ttdeci">static __always_inline void vmcs_write16(unsigned long field, u16 value)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00228">vmx_ops.h:228</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_a2a7e7c5e8ee913ae1811b078174df0c9"><div class="ttname"><a href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9">vmcs_write32</a></div><div class="ttdeci">static __always_inline void vmcs_write32(unsigned long field, u32 value)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00237">vmx_ops.h:237</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a02a5a7a2c625e52874076332ecc41ace_cgraph.png" border="0" usemap="#avmx_8h_a02a5a7a2c625e52874076332ecc41ace_cgraph" alt=""/></div>
<map name="avmx_8h_a02a5a7a2c625e52874076332ecc41ace_cgraph" id="avmx_8h_a02a5a7a2c625e52874076332ecc41ace_cgraph">
<area shape="rect" title=" " alt="" coords="5,328,161,355"/>
<area shape="rect" href="vmx_8c.html#ad451ebc6caea05e6b8efad3669027247" title=" " alt="" coords="250,252,367,279"/>
<area shape="rect" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a" title=" " alt="" coords="483,207,596,233"/>
<area shape="rect" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9" title=" " alt="" coords="483,261,596,288"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="489,152,590,179"/>
<area shape="rect" href="vmx_8c.html#a0a4bc0d90ba4aa4d6e9758f35cd84261" title=" " alt="" coords="456,321,623,362"/>
<area shape="rect" href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec" title=" " alt="" coords="228,404,389,431"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="504,455,575,481"/>
<area shape="rect" href="vmx_8c.html#addb62cc2799bab41b7029f93bf448b1c" title=" " alt="" coords="209,505,408,532"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="694,208,809,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a1a97474a0e736504a7f46d37606d354d" title=" " alt="" coords="691,107,812,133"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="671,259,832,285"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="692,157,811,184"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a76f5e23936d63b1aa1a525e7f4181cf0" title=" " alt="" coords="691,309,812,336"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="692,360,811,387"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="691,5,812,32"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="698,56,805,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="479,404,599,431"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a02a5a7a2c625e52874076332ecc41ace_icgraph.png" border="0" usemap="#avmx_8h_a02a5a7a2c625e52874076332ecc41ace_icgraph" alt=""/></div>
<map name="avmx_8h_a02a5a7a2c625e52874076332ecc41ace_icgraph" id="avmx_8h_a02a5a7a2c625e52874076332ecc41ace_icgraph">
<area shape="rect" title=" " alt="" coords="1632,231,1788,257"/>
<area shape="rect" href="vmx_8c.html#a5b0ffadb6f1bbf0fe42d6cf7a17490bb" title=" " alt="" coords="1285,197,1393,224"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,256,1084,283"/>
<area shape="rect" href="vmx_8c.html#a091adfc5844f05cea3f378cbf167a236" title=" " alt="" coords="1453,205,1573,232"/>
<area shape="rect" href="vmx_8c.html#a9e72f6be0ed4dafcb17b8fb874a39d58" title=" " alt="" coords="1441,307,1584,333"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1132,197,1237,224"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,21,138,48"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,190,1070,231"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,256,853,283"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,139,361,165"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,227,604,253"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,43,631,85"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,278,651,319"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,315,387,341"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,161,618,202"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,395,633,421"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,446,635,487"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,512,615,539"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,139,140,165"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,219,373,261"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,227,136,253"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,43,369,85"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,512,374,539"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,563,343,589"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,461,372,488"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,512,134,539"/>
</map>
</div>

</div>
</div>
<a id="a145b5141f4cc5bbd36fb4082e96bbeee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a145b5141f4cc5bbd36fb4082e96bbeee">&#9670;&nbsp;</a></span>__vmx_vcpu_run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool __vmx_vcpu_run </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *&#160;</td>
          <td class="paramname"><em>vmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>regs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a145b5141f4cc5bbd36fb4082e96bbeee_icgraph.png" border="0" usemap="#avmx_8h_a145b5141f4cc5bbd36fb4082e96bbeee_icgraph" alt=""/></div>
<map name="avmx_8h_a145b5141f4cc5bbd36fb4082e96bbeee_icgraph" id="avmx_8h_a145b5141f4cc5bbd36fb4082e96bbeee_icgraph">
<area shape="rect" title=" " alt="" coords="453,31,584,57"/>
<area shape="rect" href="vmx_2nested_8c.html#a9ceb985086e9efc0f1d85362d8d65d64" title=" " alt="" coords="171,5,405,32"/>
<area shape="rect" href="vmx_8c.html#ad87eb585004fc744f3b2e93528576962" title=" " alt="" coords="207,56,369,83"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="5,56,123,83"/>
</map>
</div>

</div>
</div>
<a id="a5df6340b2d76095776b7bedf0e7e90cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5df6340b2d76095776b7bedf0e7e90cb">&#9670;&nbsp;</a></span>__vmx_vcpu_run_flags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int __vmx_vcpu_run_flags </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *&#160;</td>
          <td class="paramname"><em>vmx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l00944">944</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;{</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> = 0;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a8c2a029261e560523dd59cece65d3c97">launched</a>)</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= <a class="code" href="run__flags_8h.html#ad63062b2d5a54132bd36627f5ae01f5a">VMX_RUN_VMRESUME</a>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">     * If writes to the SPEC_CTRL MSR aren&#39;t intercepted, the guest is free</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">     * to change it directly without causing a vmexit.  In that case read</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">     * it after vmexit and store it in vmx-&gt;spec_ctrl.</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a29d65e7f07aa9940551aa04bc5f6888a">msr_write_intercepted</a>(vmx, MSR_IA32_SPEC_CTRL))</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= <a class="code" href="run__flags_8h.html#a5d3ba313b977949c46fbac49f895ddc7">VMX_RUN_SAVE_SPEC_CTRL</a>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160; </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;}</div>
<div class="ttc" id="arun__flags_8h_html_a5d3ba313b977949c46fbac49f895ddc7"><div class="ttname"><a href="run__flags_8h.html#a5d3ba313b977949c46fbac49f895ddc7">VMX_RUN_SAVE_SPEC_CTRL</a></div><div class="ttdeci">#define VMX_RUN_SAVE_SPEC_CTRL</div><div class="ttdef"><b>Definition:</b> <a href="run__flags_8h_source.html#l00009">run_flags.h:9</a></div></div>
<div class="ttc" id="arun__flags_8h_html_ad63062b2d5a54132bd36627f5ae01f5a"><div class="ttname"><a href="run__flags_8h.html#ad63062b2d5a54132bd36627f5ae01f5a">VMX_RUN_VMRESUME</a></div><div class="ttdeci">#define VMX_RUN_VMRESUME</div><div class="ttdef"><b>Definition:</b> <a href="run__flags_8h_source.html#l00008">run_flags.h:8</a></div></div>
<div class="ttc" id="astructloaded__vmcs_html_a8c2a029261e560523dd59cece65d3c97"><div class="ttname"><a href="structloaded__vmcs.html#a8c2a029261e560523dd59cece65d3c97">loaded_vmcs::launched</a></div><div class="ttdeci">bool launched</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00065">vmcs.h:65</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_a69374d46755703c6bf50a48eb2c2807e"><div class="ttname"><a href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">vcpu_vmx::loaded_vmcs</a></div><div class="ttdeci">struct loaded_vmcs * loaded_vmcs</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00292">vmx.h:292</a></div></div>
<div class="ttc" id="avmx_8c_html_a29d65e7f07aa9940551aa04bc5f6888a"><div class="ttname"><a href="vmx_8c.html#a29d65e7f07aa9940551aa04bc5f6888a">msr_write_intercepted</a></div><div class="ttdeci">static bool msr_write_intercepted(struct vcpu_vmx *vmx, u32 msr)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00936">vmx.c:936</a></div></div>
<div class="ttc" id="axen_8c_html_a773b39d480759f67926cb18ae2219281"><div class="ttname"><a href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a></div><div class="ttdeci">uint32_t flags</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00001">xen.c:1</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a5df6340b2d76095776b7bedf0e7e90cb_cgraph.png" border="0" usemap="#avmx_8h_a5df6340b2d76095776b7bedf0e7e90cb_cgraph" alt=""/></div>
<map name="avmx_8h_a5df6340b2d76095776b7bedf0e7e90cb_cgraph" id="avmx_8h_a5df6340b2d76095776b7bedf0e7e90cb_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,175,32"/>
<area shape="rect" href="vmx_8c.html#a29d65e7f07aa9940551aa04bc5f6888a" title=" " alt="" coords="223,5,391,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a5df6340b2d76095776b7bedf0e7e90cb_icgraph.png" border="0" usemap="#avmx_8h_a5df6340b2d76095776b7bedf0e7e90cb_icgraph" alt=""/></div>
<map name="avmx_8h_a5df6340b2d76095776b7bedf0e7e90cb_icgraph" id="avmx_8h_a5df6340b2d76095776b7bedf0e7e90cb_icgraph">
<area shape="rect" title=" " alt="" coords="288,31,457,57"/>
<area shape="rect" href="vmx_2nested_8c.html#a9ceb985086e9efc0f1d85362d8d65d64" title=" " alt="" coords="5,5,240,32"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="64,56,181,83"/>
</map>
</div>

</div>
</div>
<a id="a4323cda8d4cdaaa4a5f9188abd36a4b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4323cda8d4cdaaa4a5f9188abd36a4b7">&#9670;&nbsp;</a></span>alloc_loaded_vmcs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int alloc_loaded_vmcs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structloaded__vmcs.html">loaded_vmcs</a> *&#160;</td>
          <td class="paramname"><em>loaded_vmcs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l02905">2905</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;{</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a> = <a class="code" href="vmx_8h.html#a31f4e36482819bc92965589b265b9be6">alloc_vmcs</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a>)</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160; </div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;    <a class="code" href="vmx__ops_8h.html#adefc7dc8e1885fe973b3e8d58e23e0aa">vmcs_clear</a>(<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a>);</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160; </div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;    <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#ac39ebb8d8757b3fc7c52ac264b2ca1c7">shadow_vmcs</a> = NULL;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a4e3854e4aa79c341e1363ff71c998df2">hv_timer_soft_disabled</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a41190e00a22fb0388ba36b9bb5cc3bdd">cpu</a> = -1;</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a8c2a029261e560523dd59cece65d3c97">launched</a> = 0;</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160; </div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b">cpu_has_vmx_msr_bitmap</a>()) {</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a5553ab2c0ac0996950eeba41ec05a48f">msr_bitmap</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;                __get_free_page(GFP_KERNEL_ACCOUNT);</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a5553ab2c0ac0996950eeba41ec05a48f">msr_bitmap</a>)</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;            <span class="keywordflow">goto</span> out_vmcs;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        memset(<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a5553ab2c0ac0996950eeba41ec05a48f">msr_bitmap</a>, 0xff, PAGE_SIZE);</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    }</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160; </div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    memset(&amp;<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a058c58b6c534321752261fcb9271bd74">host_state</a>, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structvmcs__host__state.html">vmcs_host_state</a>));</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    memset(&amp;<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#aeb9b28dcd5fe6c1f23321647f15ef670">controls_shadow</a>, 0,</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;        <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structvmcs__controls__shadow.html">vmcs_controls_shadow</a>));</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160; </div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160; </div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;out_vmcs:</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    <a class="code" href="vmx_8c.html#af92910217dcc55da03421a552d174080">free_loaded_vmcs</a>(<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>);</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;    <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;}</div>
<div class="ttc" id="acapabilities_8h_html_ab417100ad999a4402c4b0698ada5dc9b"><div class="ttname"><a href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b">cpu_has_vmx_msr_bitmap</a></div><div class="ttdeci">static bool cpu_has_vmx_msr_bitmap(void)</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00124">capabilities.h:124</a></div></div>
<div class="ttc" id="astructloaded__vmcs_html_a058c58b6c534321752261fcb9271bd74"><div class="ttname"><a href="structloaded__vmcs.html#a058c58b6c534321752261fcb9271bd74">loaded_vmcs::host_state</a></div><div class="ttdeci">struct vmcs_host_state host_state</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00072">vmcs.h:74</a></div></div>
<div class="ttc" id="astructloaded__vmcs_html_a41190e00a22fb0388ba36b9bb5cc3bdd"><div class="ttname"><a href="structloaded__vmcs.html#a41190e00a22fb0388ba36b9bb5cc3bdd">loaded_vmcs::cpu</a></div><div class="ttdeci">int cpu</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00064">vmcs.h:64</a></div></div>
<div class="ttc" id="astructloaded__vmcs_html_a4e3854e4aa79c341e1363ff71c998df2"><div class="ttname"><a href="structloaded__vmcs.html#a4e3854e4aa79c341e1363ff71c998df2">loaded_vmcs::hv_timer_soft_disabled</a></div><div class="ttdeci">bool hv_timer_soft_disabled</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00067">vmcs.h:67</a></div></div>
<div class="ttc" id="astructloaded__vmcs_html_a5553ab2c0ac0996950eeba41ec05a48f"><div class="ttname"><a href="structloaded__vmcs.html#a5553ab2c0ac0996950eeba41ec05a48f">loaded_vmcs::msr_bitmap</a></div><div class="ttdeci">unsigned long * msr_bitmap</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00072">vmcs.h:72</a></div></div>
<div class="ttc" id="astructloaded__vmcs_html_a7ad4f334c47135f357d1e4fe338676b5"><div class="ttname"><a href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">loaded_vmcs::vmcs</a></div><div class="ttdeci">struct vmcs * vmcs</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00062">vmcs.h:62</a></div></div>
<div class="ttc" id="astructloaded__vmcs_html_ac39ebb8d8757b3fc7c52ac264b2ca1c7"><div class="ttname"><a href="structloaded__vmcs.html#ac39ebb8d8757b3fc7c52ac264b2ca1c7">loaded_vmcs::shadow_vmcs</a></div><div class="ttdeci">struct vmcs * shadow_vmcs</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00063">vmcs.h:63</a></div></div>
<div class="ttc" id="astructloaded__vmcs_html_aeb9b28dcd5fe6c1f23321647f15ef670"><div class="ttname"><a href="structloaded__vmcs.html#aeb9b28dcd5fe6c1f23321647f15ef670">loaded_vmcs::controls_shadow</a></div><div class="ttdeci">struct vmcs_controls_shadow controls_shadow</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00072">vmcs.h:75</a></div></div>
<div class="ttc" id="astructvmcs__controls__shadow_html"><div class="ttname"><a href="structvmcs__controls__shadow.html">vmcs_controls_shadow</a></div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00047">vmcs.h:47</a></div></div>
<div class="ttc" id="astructvmcs__host__state_html"><div class="ttname"><a href="structvmcs__host__state.html">vmcs_host_state</a></div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00034">vmcs.h:34</a></div></div>
<div class="ttc" id="avmx_8c_html_af92910217dcc55da03421a552d174080"><div class="ttname"><a href="vmx_8c.html#af92910217dcc55da03421a552d174080">free_loaded_vmcs</a></div><div class="ttdeci">void free_loaded_vmcs(struct loaded_vmcs *loaded_vmcs)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l02893">vmx.c:2893</a></div></div>
<div class="ttc" id="avmx_8h_html_a31f4e36482819bc92965589b265b9be6"><div class="ttname"><a href="vmx_8h.html#a31f4e36482819bc92965589b265b9be6">alloc_vmcs</a></div><div class="ttdeci">static struct vmcs * alloc_vmcs(bool shadow)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00707">vmx.h:707</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_adefc7dc8e1885fe973b3e8d58e23e0aa"><div class="ttname"><a href="vmx__ops_8h.html#adefc7dc8e1885fe973b3e8d58e23e0aa">vmcs_clear</a></div><div class="ttdeci">static void vmcs_clear(struct vmcs *vmcs)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00287">vmx_ops.h:287</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a4323cda8d4cdaaa4a5f9188abd36a4b7_cgraph.png" border="0" usemap="#avmx_8h_a4323cda8d4cdaaa4a5f9188abd36a4b7_cgraph" alt=""/></div>
<map name="avmx_8h_a4323cda8d4cdaaa4a5f9188abd36a4b7_cgraph" id="avmx_8h_a4323cda8d4cdaaa4a5f9188abd36a4b7_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,152,108"/>
<area shape="rect" href="vmx_8h.html#a31f4e36482819bc92965589b265b9be6" title=" " alt="" coords="251,5,345,32"/>
<area shape="rect" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b" title=" " alt="" coords="200,56,396,83"/>
<area shape="rect" href="vmx_8c.html#af92910217dcc55da03421a552d174080" title=" " alt="" coords="227,107,369,133"/>
<area shape="rect" href="vmx__ops_8h.html#adefc7dc8e1885fe973b3e8d58e23e0aa" title=" " alt="" coords="848,132,944,159"/>
<area shape="rect" href="vmx_8h.html#aaed5367f4fedc1d1bc3d6b140bf0f2da" title=" " alt="" coords="455,5,580,32"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="639,5,800,32"/>
<area shape="rect" href="vmx_8c.html#a171771cf05868f64b6e6491889a842e1" title=" " alt="" coords="472,56,563,83"/>
<area shape="rect" href="vmx_8c.html#acffc6d01ff543c9abee613b5fe1b1bd4" title=" " alt="" coords="444,107,591,133"/>
<area shape="rect" href="vmx_8c.html#a70760e20007fba075a5170ffbdc80fa6" title=" " alt="" coords="639,107,800,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a4323cda8d4cdaaa4a5f9188abd36a4b7_icgraph.png" border="0" usemap="#avmx_8h_a4323cda8d4cdaaa4a5f9188abd36a4b7_icgraph" alt=""/></div>
<map name="avmx_8h_a4323cda8d4cdaaa4a5f9188abd36a4b7_icgraph" id="avmx_8h_a4323cda8d4cdaaa4a5f9188abd36a4b7_icgraph">
<area shape="rect" title=" " alt="" coords="825,63,972,90"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="616,38,777,65"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="628,89,765,115"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="425,13,542,39"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="399,63,568,90"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,5,351,47"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,13,132,39"/>
</map>
</div>

</div>
</div>
<a id="a31f4e36482819bc92965589b265b9be6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31f4e36482819bc92965589b265b9be6">&#9670;&nbsp;</a></span>alloc_vmcs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structvmcs.html">vmcs</a>* alloc_vmcs </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shadow</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00707">707</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;{</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="vmx_8h.html#aaed5367f4fedc1d1bc3d6b140bf0f2da">alloc_vmcs_cpu</a>(shadow, raw_smp_processor_id(),</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                  GFP_KERNEL_ACCOUNT);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;}</div>
<div class="ttc" id="avmx_8h_html_aaed5367f4fedc1d1bc3d6b140bf0f2da"><div class="ttname"><a href="vmx_8h.html#aaed5367f4fedc1d1bc3d6b140bf0f2da">alloc_vmcs_cpu</a></div><div class="ttdeci">struct vmcs * alloc_vmcs_cpu(bool shadow, int cpu, gfp_t flags)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l02862">vmx.c:2862</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a31f4e36482819bc92965589b265b9be6_cgraph.png" border="0" usemap="#avmx_8h_a31f4e36482819bc92965589b265b9be6_cgraph" alt=""/></div>
<map name="avmx_8h_a31f4e36482819bc92965589b265b9be6_cgraph" id="avmx_8h_a31f4e36482819bc92965589b265b9be6_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,100,32"/>
<area shape="rect" href="vmx_8h.html#aaed5367f4fedc1d1bc3d6b140bf0f2da" title=" " alt="" coords="148,5,273,32"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="321,5,483,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a31f4e36482819bc92965589b265b9be6_icgraph.png" border="0" usemap="#avmx_8h_a31f4e36482819bc92965589b265b9be6_icgraph" alt=""/></div>
<map name="avmx_8h_a31f4e36482819bc92965589b265b9be6_icgraph" id="avmx_8h_a31f4e36482819bc92965589b265b9be6_icgraph">
<area shape="rect" title=" " alt="" coords="1025,63,1120,90"/>
<area shape="rect" href="vmx_8c.html#a4323cda8d4cdaaa4a5f9188abd36a4b7" title=" " alt="" coords="828,89,975,115"/>
<area shape="rect" href="vmx_2nested_8c.html#aab4ffa143510eb3f7759e1b6856eb2e2" title=" " alt="" coords="825,38,977,65"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="616,38,777,65"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="628,89,765,115"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="425,13,542,39"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="399,63,568,90"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,5,351,47"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,13,132,39"/>
</map>
</div>

</div>
</div>
<a id="aaed5367f4fedc1d1bc3d6b140bf0f2da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaed5367f4fedc1d1bc3d6b140bf0f2da">&#9670;&nbsp;</a></span>alloc_vmcs_cpu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structvmcs.html">vmcs</a>* alloc_vmcs_cpu </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shadow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfp_t&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l02862">2862</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;{</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <span class="keywordtype">int</span> node = cpu_to_node(cpu);</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    <span class="keyword">struct </span>page *pages;</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvmcs.html">vmcs</a> *<a class="code" href="structvmcs.html">vmcs</a>;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160; </div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    pages = __alloc_pages_node(node, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>, 0);</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    <span class="keywordflow">if</span> (!pages)</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <a class="code" href="structvmcs.html">vmcs</a> = page_address(pages);</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    memset(<a class="code" href="structvmcs.html">vmcs</a>, 0, <a class="code" href="structvmcs__config.html">vmcs_config</a>.<a class="code" href="structvmcs__config.html#a9b7bf29b2ee9106ff22c4dcc7cb26b8e">size</a>);</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160; </div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <span class="comment">/* KVM supports Enlightened VMCS v1 only */</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11">kvm_is_using_evmcs</a>())</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;        <a class="code" href="structvmcs.html">vmcs</a>-&gt;<a class="code" href="structvmcs.html#a06ff2b94ee17a6aeec6f8a3d25744186">hdr</a>.<a class="code" href="structvmcs__hdr.html#a7cce0260585b7778cb5a03635005d6c7">revision_id</a> = <a class="code" href="hyperv__evmcs_8h.html#ae216de59ee217d9cad5dcdcb28e48568">KVM_EVMCS_VERSION</a>;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        <a class="code" href="structvmcs.html">vmcs</a>-&gt;<a class="code" href="structvmcs.html#a06ff2b94ee17a6aeec6f8a3d25744186">hdr</a>.<a class="code" href="structvmcs__hdr.html#a7cce0260585b7778cb5a03635005d6c7">revision_id</a> = <a class="code" href="structvmcs__config.html">vmcs_config</a>.<a class="code" href="structvmcs__config.html#a09716d27d44333a0e23dd18ad8e80a5e">revision_id</a>;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160; </div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    <span class="keywordflow">if</span> (shadow)</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;        <a class="code" href="structvmcs.html">vmcs</a>-&gt;<a class="code" href="structvmcs.html#a06ff2b94ee17a6aeec6f8a3d25744186">hdr</a>.<a class="code" href="structvmcs__hdr.html#a42fd4de9f54edf5d5cc03084eac881eb">shadow_vmcs</a> = 1;</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structvmcs.html">vmcs</a>;</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;}</div>
<div class="ttc" id="ahyperv__evmcs_8h_html_ae216de59ee217d9cad5dcdcb28e48568"><div class="ttname"><a href="hyperv__evmcs_8h.html#ae216de59ee217d9cad5dcdcb28e48568">KVM_EVMCS_VERSION</a></div><div class="ttdeci">#define KVM_EVMCS_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="hyperv__evmcs_8h_source.html#l00014">hyperv_evmcs.h:14</a></div></div>
<div class="ttc" id="astructvmcs__config_html"><div class="ttname"><a href="structvmcs__config.html">vmcs_config</a></div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00056">capabilities.h:56</a></div></div>
<div class="ttc" id="astructvmcs__config_html_a09716d27d44333a0e23dd18ad8e80a5e"><div class="ttname"><a href="structvmcs__config.html#a09716d27d44333a0e23dd18ad8e80a5e">vmcs_config::revision_id</a></div><div class="ttdeci">u32 revision_id</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00059">capabilities.h:59</a></div></div>
<div class="ttc" id="astructvmcs__config_html_a9b7bf29b2ee9106ff22c4dcc7cb26b8e"><div class="ttname"><a href="structvmcs__config.html#a9b7bf29b2ee9106ff22c4dcc7cb26b8e">vmcs_config::size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00057">capabilities.h:57</a></div></div>
<div class="ttc" id="astructvmcs__hdr_html_a42fd4de9f54edf5d5cc03084eac881eb"><div class="ttname"><a href="structvmcs__hdr.html#a42fd4de9f54edf5d5cc03084eac881eb">vmcs_hdr::shadow_vmcs</a></div><div class="ttdeci">u32 shadow_vmcs</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00018">vmcs.h:18</a></div></div>
<div class="ttc" id="astructvmcs__hdr_html_a7cce0260585b7778cb5a03635005d6c7"><div class="ttname"><a href="structvmcs__hdr.html#a7cce0260585b7778cb5a03635005d6c7">vmcs_hdr::revision_id</a></div><div class="ttdeci">u32 revision_id</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00017">vmcs.h:17</a></div></div>
<div class="ttc" id="astructvmcs_html_a06ff2b94ee17a6aeec6f8a3d25744186"><div class="ttname"><a href="structvmcs.html#a06ff2b94ee17a6aeec6f8a3d25744186">vmcs::hdr</a></div><div class="ttdeci">struct vmcs_hdr hdr</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00018">vmcs.h:22</a></div></div>
<div class="ttc" id="avmx__onhyperv_8h_html_ab35d8d7479c3c62d461012dcabc04b11"><div class="ttname"><a href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11">kvm_is_using_evmcs</a></div><div class="ttdeci">static __always_inline bool kvm_is_using_evmcs(void)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__onhyperv_8h_source.html#l00115">vmx_onhyperv.h:115</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aaed5367f4fedc1d1bc3d6b140bf0f2da_cgraph.png" border="0" usemap="#avmx_8h_aaed5367f4fedc1d1bc3d6b140bf0f2da_cgraph" alt=""/></div>
<map name="avmx_8h_aaed5367f4fedc1d1bc3d6b140bf0f2da_cgraph" id="avmx_8h_aaed5367f4fedc1d1bc3d6b140bf0f2da_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,131,32"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="179,5,340,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aaed5367f4fedc1d1bc3d6b140bf0f2da_icgraph.png" border="0" usemap="#avmx_8h_aaed5367f4fedc1d1bc3d6b140bf0f2da_icgraph" alt=""/></div>
<map name="avmx_8h_aaed5367f4fedc1d1bc3d6b140bf0f2da_icgraph" id="avmx_8h_aaed5367f4fedc1d1bc3d6b140bf0f2da_icgraph">
<area shape="rect" title=" " alt="" coords="1168,36,1293,63"/>
<area shape="rect" href="vmx_8c.html#a6096b0ce5dacb759a7fdfb2ba651bdf6" title=" " alt="" coords="203,5,328,32"/>
<area shape="rect" href="vmx_8h.html#a31f4e36482819bc92965589b265b9be6" title=" " alt="" coords="1025,61,1120,88"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,35,132,61"/>
<area shape="rect" href="vmx_8c.html#a4323cda8d4cdaaa4a5f9188abd36a4b7" title=" " alt="" coords="828,112,975,139"/>
<area shape="rect" href="vmx_2nested_8c.html#aab4ffa143510eb3f7759e1b6856eb2e2" title=" " alt="" coords="825,61,977,88"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="616,63,777,89"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="628,113,765,140"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="425,63,542,89"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="399,113,568,140"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,57,351,98"/>
</map>
</div>

</div>
</div>
<a id="a0f734e0eaceeaebc218934ab82543dc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f734e0eaceeaebc218934ab82543dc1">&#9670;&nbsp;</a></span>allocate_vpid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int allocate_vpid </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03919">3919</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;{</div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;    <span class="keywordtype">int</span> vpid;</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160; </div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#ac72dec1b9f135b5d53c436112ff2b73b">enable_vpid</a>)</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;    spin_lock(&amp;vmx_vpid_lock);</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;    vpid = find_first_zero_bit(vmx_vpid_bitmap, VMX_NR_VPIDS);</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;    <span class="keywordflow">if</span> (vpid &lt; VMX_NR_VPIDS)</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;        __set_bit(vpid, vmx_vpid_bitmap);</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;        vpid = 0;</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;    spin_unlock(&amp;vmx_vpid_lock);</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;    <span class="keywordflow">return</span> vpid;</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;}</div>
<div class="ttc" id="avmx_8c_html_ac72dec1b9f135b5d53c436112ff2b73b"><div class="ttname"><a href="vmx_8c.html#ac72dec1b9f135b5d53c436112ff2b73b">enable_vpid</a></div><div class="ttdeci">bool __read_mostly enable_vpid</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00082">vmx.c:82</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a0f734e0eaceeaebc218934ab82543dc1_icgraph.png" border="0" usemap="#avmx_8h_a0f734e0eaceeaebc218934ab82543dc1_icgraph" alt=""/></div>
<map name="avmx_8h_a0f734e0eaceeaebc218934ab82543dc1_icgraph" id="avmx_8h_a0f734e0eaceeaebc218934ab82543dc1_icgraph">
<area shape="rect" title=" " alt="" coords="825,63,935,90"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="616,38,777,65"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="628,89,765,115"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="425,13,542,39"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="399,63,568,90"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,5,351,47"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,13,132,39"/>
</map>
</div>

</div>
</div>
<a id="a8bf9ef0bfb4569903417b52d6eb09d41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8bf9ef0bfb4569903417b52d6eb09d41">&#9670;&nbsp;</a></span>construct_eptp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64 construct_eptp </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">hpa_t&#160;</td>
          <td class="paramname"><em>root_hpa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root_level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03371">3371</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;{</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;    u64 eptp = VMX_EPTP_MT_WB;</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160; </div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;    eptp |= (root_level == 5) ? VMX_EPTP_PWL_5 : VMX_EPTP_PWL_4;</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160; </div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx_8c.html#a57d3f38baf0578bfc43456c8f0513d10">enable_ept_ad_bits</a> &amp;&amp;</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;        (!<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(vcpu) || <a class="code" href="nested_8h.html#a7c0f72e13a3ded68fa556ef3c504c541">nested_ept_ad_enabled</a>(vcpu)))</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;        eptp |= VMX_EPTP_AD_ENABLE_BIT;</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;    eptp |= root_hpa;</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160; </div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;    <span class="keywordflow">return</span> eptp;</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_afbcfc413ceedb460734eb5fd7c5c4fbc"><div class="ttname"><a href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a></div><div class="ttdeci">static bool is_guest_mode(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00226">kvm_cache_regs.h:226</a></div></div>
<div class="ttc" id="anested_8h_html_a7c0f72e13a3ded68fa556ef3c504c541"><div class="ttname"><a href="nested_8h.html#a7c0f72e13a3ded68fa556ef3c504c541">nested_ept_ad_enabled</a></div><div class="ttdeci">static bool nested_ept_ad_enabled(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="nested_8h_source.html#l00077">nested.h:77</a></div></div>
<div class="ttc" id="avmx_8c_html_a57d3f38baf0578bfc43456c8f0513d10"><div class="ttname"><a href="vmx_8c.html#a57d3f38baf0578bfc43456c8f0513d10">enable_ept_ad_bits</a></div><div class="ttdeci">bool __read_mostly enable_ept_ad_bits</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00098">vmx.c:98</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a8bf9ef0bfb4569903417b52d6eb09d41_cgraph.png" border="0" usemap="#avmx_8h_a8bf9ef0bfb4569903417b52d6eb09d41_cgraph" alt=""/></div>
<map name="avmx_8h_a8bf9ef0bfb4569903417b52d6eb09d41_cgraph" id="avmx_8h_a8bf9ef0bfb4569903417b52d6eb09d41_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,124,57"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="200,5,320,32"/>
<area shape="rect" href="nested_8h.html#a7c0f72e13a3ded68fa556ef3c504c541" title=" " alt="" coords="172,56,348,83"/>
<area shape="rect" href="nested_8h.html#ac2fb246c295b9e93765508e05fd6a333" title=" " alt="" coords="396,56,555,83"/>
<area shape="rect" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497" title=" " alt="" coords="603,56,704,83"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="752,56,823,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a8bf9ef0bfb4569903417b52d6eb09d41_icgraph.png" border="0" usemap="#avmx_8h_a8bf9ef0bfb4569903417b52d6eb09d41_icgraph" alt=""/></div>
<map name="avmx_8h_a8bf9ef0bfb4569903417b52d6eb09d41_icgraph" id="avmx_8h_a8bf9ef0bfb4569903417b52d6eb09d41_icgraph">
<area shape="rect" title=" " alt="" coords="716,71,835,98"/>
<area shape="rect" href="vmx_2nested_8c.html#ad2e9898adf303e2ea0d485adb616ec20" title=" " alt="" coords="475,5,668,47"/>
<area shape="rect" href="vmx_8c.html#af3ac981365567f8e3f172ebb9b42febe" title=" " alt="" coords="488,71,655,98"/>
<area shape="rect" href="vmx_8c.html#a074416f44b1e2949a96f85e0579c8aeb" title=" " alt="" coords="492,122,651,149"/>
<area shape="rect" href="vmx_2nested_8c.html#a85ce368c81cbe80d9e13c1873fce03b3" title=" " alt="" coords="224,13,427,39"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e4432d8f2321361c7b0b88e7237511c" title=" " alt="" coords="5,13,176,39"/>
</map>
</div>

</div>
</div>
<a id="ac39cca04dec7bf494bf2e19ee9f765fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac39cca04dec7bf494bf2e19ee9f765fe">&#9670;&nbsp;</a></span>dump_vmcs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dump_vmcs </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l06232">6232</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;{</div>
<div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;    u32 vmentry_ctl, vmexit_ctl;</div>
<div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;    u32 cpu_based_exec_ctrl, pin_based_exec_ctrl, secondary_exec_control;</div>
<div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;    u64 tertiary_exec_control;</div>
<div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cr4;</div>
<div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;    <span class="keywordtype">int</span> efer_slot;</div>
<div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160; </div>
<div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a5938e0d9c5df909b3ed2bb2269b1d79c">dump_invalid_vmcs</a>) {</div>
<div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;        pr_warn_ratelimited(<span class="stringliteral">&quot;set kvm_intel.dump_invalid_vmcs=1 to dump internal KVM state.\n&quot;</span>);</div>
<div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;    }</div>
<div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160; </div>
<div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;    vmentry_ctl = <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_ENTRY_CONTROLS);</div>
<div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;    vmexit_ctl = <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_EXIT_CONTROLS);</div>
<div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;    cpu_based_exec_ctrl = <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(CPU_BASED_VM_EXEC_CONTROL);</div>
<div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;    pin_based_exec_ctrl = <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(PIN_BASED_VM_EXEC_CONTROL);</div>
<div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;    cr4 = <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_CR4);</div>
<div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160; </div>
<div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="capabilities_8h.html#a7dc840840c570386f3265751dbcd8b41">cpu_has_secondary_exec_ctrls</a>())</div>
<div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;        secondary_exec_control = <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(SECONDARY_VM_EXEC_CONTROL);</div>
<div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;        secondary_exec_control = 0;</div>
<div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160; </div>
<div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="capabilities_8h.html#af254f84e2513a22e3c7ba836179b9548">cpu_has_tertiary_exec_ctrls</a>())</div>
<div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;        tertiary_exec_control = <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(TERTIARY_VM_EXEC_CONTROL);</div>
<div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;        tertiary_exec_control = 0;</div>
<div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160; </div>
<div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;    pr_err(<span class="stringliteral">&quot;VMCS %p, last attempted VM-entry on CPU %d\n&quot;</span>,</div>
<div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;           vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a>, <a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>-&gt;arch.last_vmentry_cpu);</div>
<div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;    pr_err(<span class="stringliteral">&quot;*** Guest State ***\n&quot;</span>);</div>
<div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;    pr_err(<span class="stringliteral">&quot;CR0: actual=0x%016lx, shadow=0x%016lx, gh_mask=%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_CR0), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(CR0_READ_SHADOW),</div>
<div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(CR0_GUEST_HOST_MASK));</div>
<div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;    pr_err(<span class="stringliteral">&quot;CR4: actual=0x%016lx, shadow=0x%016lx, gh_mask=%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;           cr4, <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(CR4_READ_SHADOW), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(CR4_GUEST_HOST_MASK));</div>
<div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;    pr_err(<span class="stringliteral">&quot;CR3 = 0x%016lx\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_CR3));</div>
<div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="capabilities_8h.html#a60e1ec528bbaedd1eeb87d928827415b">cpu_has_vmx_ept</a>()) {</div>
<div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;        pr_err(<span class="stringliteral">&quot;PDPTR0 = 0x%016llx  PDPTR1 = 0x%016llx\n&quot;</span>,</div>
<div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;               <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_PDPTR0), <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_PDPTR1));</div>
<div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;        pr_err(<span class="stringliteral">&quot;PDPTR2 = 0x%016llx  PDPTR3 = 0x%016llx\n&quot;</span>,</div>
<div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;               <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_PDPTR2), <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_PDPTR3));</div>
<div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;    }</div>
<div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;    pr_err(<span class="stringliteral">&quot;RSP = 0x%016lx  RIP = 0x%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_RSP), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_RIP));</div>
<div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;    pr_err(<span class="stringliteral">&quot;RFLAGS=0x%08lx         DR7 = 0x%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_RFLAGS), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_DR7));</div>
<div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;    pr_err(<span class="stringliteral">&quot;Sysenter RSP=%016lx CS:RIP=%04x:%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_SYSENTER_ESP),</div>
<div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(GUEST_SYSENTER_CS), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_SYSENTER_EIP));</div>
<div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;    <a class="code" href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f">vmx_dump_sel</a>(<span class="stringliteral">&quot;CS:  &quot;</span>, GUEST_CS_SELECTOR);</div>
<div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;    <a class="code" href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f">vmx_dump_sel</a>(<span class="stringliteral">&quot;DS:  &quot;</span>, GUEST_DS_SELECTOR);</div>
<div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;    <a class="code" href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f">vmx_dump_sel</a>(<span class="stringliteral">&quot;SS:  &quot;</span>, GUEST_SS_SELECTOR);</div>
<div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;    <a class="code" href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f">vmx_dump_sel</a>(<span class="stringliteral">&quot;ES:  &quot;</span>, GUEST_ES_SELECTOR);</div>
<div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;    <a class="code" href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f">vmx_dump_sel</a>(<span class="stringliteral">&quot;FS:  &quot;</span>, GUEST_FS_SELECTOR);</div>
<div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;    <a class="code" href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f">vmx_dump_sel</a>(<span class="stringliteral">&quot;GS:  &quot;</span>, GUEST_GS_SELECTOR);</div>
<div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;    <a class="code" href="vmx_8c.html#a15bb194d07dae718cd11236afe343d69">vmx_dump_dtsel</a>(<span class="stringliteral">&quot;GDTR:&quot;</span>, GUEST_GDTR_LIMIT);</div>
<div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;    <a class="code" href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f">vmx_dump_sel</a>(<span class="stringliteral">&quot;LDTR:&quot;</span>, GUEST_LDTR_SELECTOR);</div>
<div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;    <a class="code" href="vmx_8c.html#a15bb194d07dae718cd11236afe343d69">vmx_dump_dtsel</a>(<span class="stringliteral">&quot;IDTR:&quot;</span>, GUEST_IDTR_LIMIT);</div>
<div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;    <a class="code" href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f">vmx_dump_sel</a>(<span class="stringliteral">&quot;TR:  &quot;</span>, GUEST_TR_SELECTOR);</div>
<div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;    efer_slot = <a class="code" href="vmx_8c.html#a07cb8535d5c63fe54c6233e78b47d6c7">vmx_find_loadstore_msr_slot</a>(&amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#aa2342c4a9744bc32d82ac6297fb9327c">msr_autoload</a>.<a class="code" href="structvcpu__vmx_1_1msr__autoload.html#aa85a2800d89b05867169870c50c33665">guest</a>, MSR_EFER);</div>
<div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;    <span class="keywordflow">if</span> (vmentry_ctl &amp; VM_ENTRY_LOAD_IA32_EFER)</div>
<div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;        pr_err(<span class="stringliteral">&quot;EFER= 0x%016llx\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_IA32_EFER));</div>
<div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (efer_slot &gt;= 0)</div>
<div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;        pr_err(<span class="stringliteral">&quot;EFER= 0x%016llx (autoload)\n&quot;</span>,</div>
<div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;               vmx-&gt;<a class="code" href="structvcpu__vmx.html#aa2342c4a9744bc32d82ac6297fb9327c">msr_autoload</a>.<a class="code" href="structvcpu__vmx_1_1msr__autoload.html#aa85a2800d89b05867169870c50c33665">guest</a>.<a class="code" href="structvmx__msrs.html#ab2a7da3278820cc5bce9ac08b5b9cea4">val</a>[efer_slot].value);</div>
<div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vmentry_ctl &amp; VM_ENTRY_IA32E_MODE)</div>
<div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;        pr_err(<span class="stringliteral">&quot;EFER= 0x%016llx (effective)\n&quot;</span>,</div>
<div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;               <a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>-&gt;arch.efer | (EFER_LMA | EFER_LME));</div>
<div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;        pr_err(<span class="stringliteral">&quot;EFER= 0x%016llx (effective)\n&quot;</span>,</div>
<div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;               <a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>-&gt;arch.efer &amp; ~(EFER_LMA | EFER_LME));</div>
<div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;    <span class="keywordflow">if</span> (vmentry_ctl &amp; VM_ENTRY_LOAD_IA32_PAT)</div>
<div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;        pr_err(<span class="stringliteral">&quot;PAT = 0x%016llx\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_IA32_PAT));</div>
<div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;    pr_err(<span class="stringliteral">&quot;DebugCtl = 0x%016llx  DebugExceptions = 0x%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;           <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_IA32_DEBUGCTL),</div>
<div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_PENDING_DBG_EXCEPTIONS));</div>
<div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="capabilities_8h.html#a920302b2e36959afed4b793d45d26f40">cpu_has_load_perf_global_ctrl</a>() &amp;&amp;</div>
<div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;        vmentry_ctl &amp; VM_ENTRY_LOAD_IA32_PERF_GLOBAL_CTRL)</div>
<div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;        pr_err(<span class="stringliteral">&quot;PerfGlobCtl = 0x%016llx\n&quot;</span>,</div>
<div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;               <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_IA32_PERF_GLOBAL_CTRL));</div>
<div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;    <span class="keywordflow">if</span> (vmentry_ctl &amp; VM_ENTRY_LOAD_BNDCFGS)</div>
<div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;        pr_err(<span class="stringliteral">&quot;BndCfgS = 0x%016llx\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_BNDCFGS));</div>
<div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;    pr_err(<span class="stringliteral">&quot;Interruptibility = %08x  ActivityState = %08x\n&quot;</span>,</div>
<div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(GUEST_INTERRUPTIBILITY_INFO),</div>
<div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(GUEST_ACTIVITY_STATE));</div>
<div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;    <span class="keywordflow">if</span> (secondary_exec_control &amp; SECONDARY_EXEC_VIRTUAL_INTR_DELIVERY)</div>
<div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;        pr_err(<span class="stringliteral">&quot;InterruptStatus = %04x\n&quot;</span>,</div>
<div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;               <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(GUEST_INTR_STATUS));</div>
<div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_ENTRY_MSR_LOAD_COUNT) &gt; 0)</div>
<div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;        <a class="code" href="vmx_8c.html#a541151ce2151a85e333a048b2624c76b">vmx_dump_msrs</a>(<span class="stringliteral">&quot;guest autoload&quot;</span>, &amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#aa2342c4a9744bc32d82ac6297fb9327c">msr_autoload</a>.<a class="code" href="structvcpu__vmx_1_1msr__autoload.html#aa85a2800d89b05867169870c50c33665">guest</a>);</div>
<div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_EXIT_MSR_STORE_COUNT) &gt; 0)</div>
<div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;        <a class="code" href="vmx_8c.html#a541151ce2151a85e333a048b2624c76b">vmx_dump_msrs</a>(<span class="stringliteral">&quot;guest autostore&quot;</span>, &amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#a2bfaa8dae08466864892966a16176e3b">msr_autostore</a>.<a class="code" href="structvcpu__vmx_1_1msr__autostore.html#a0886390d509879e5e49b9b73834160ee">guest</a>);</div>
<div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160; </div>
<div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;    pr_err(<span class="stringliteral">&quot;*** Host State ***\n&quot;</span>);</div>
<div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;    pr_err(<span class="stringliteral">&quot;RIP = 0x%016lx  RSP = 0x%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_RIP), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_RSP));</div>
<div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;    pr_err(<span class="stringliteral">&quot;CS=%04x SS=%04x DS=%04x ES=%04x FS=%04x GS=%04x TR=%04x\n&quot;</span>,</div>
<div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;           <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(HOST_CS_SELECTOR), <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(HOST_SS_SELECTOR),</div>
<div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;           <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(HOST_DS_SELECTOR), <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(HOST_ES_SELECTOR),</div>
<div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;           <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(HOST_FS_SELECTOR), <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(HOST_GS_SELECTOR),</div>
<div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;           <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(HOST_TR_SELECTOR));</div>
<div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;    pr_err(<span class="stringliteral">&quot;FSBase=%016lx GSBase=%016lx TRBase=%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_FS_BASE), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_GS_BASE),</div>
<div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_TR_BASE));</div>
<div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;    pr_err(<span class="stringliteral">&quot;GDTBase=%016lx IDTBase=%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_GDTR_BASE), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_IDTR_BASE));</div>
<div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;    pr_err(<span class="stringliteral">&quot;CR0=%016lx CR3=%016lx CR4=%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_CR0), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_CR3),</div>
<div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_CR4));</div>
<div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;    pr_err(<span class="stringliteral">&quot;Sysenter RSP=%016lx CS:RIP=%04x:%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_IA32_SYSENTER_ESP),</div>
<div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(HOST_IA32_SYSENTER_CS),</div>
<div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;           <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(HOST_IA32_SYSENTER_EIP));</div>
<div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;    <span class="keywordflow">if</span> (vmexit_ctl &amp; VM_EXIT_LOAD_IA32_EFER)</div>
<div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;        pr_err(<span class="stringliteral">&quot;EFER= 0x%016llx\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(HOST_IA32_EFER));</div>
<div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;    <span class="keywordflow">if</span> (vmexit_ctl &amp; VM_EXIT_LOAD_IA32_PAT)</div>
<div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;        pr_err(<span class="stringliteral">&quot;PAT = 0x%016llx\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(HOST_IA32_PAT));</div>
<div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="capabilities_8h.html#a920302b2e36959afed4b793d45d26f40">cpu_has_load_perf_global_ctrl</a>() &amp;&amp;</div>
<div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;        vmexit_ctl &amp; VM_EXIT_LOAD_IA32_PERF_GLOBAL_CTRL)</div>
<div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;        pr_err(<span class="stringliteral">&quot;PerfGlobCtl = 0x%016llx\n&quot;</span>,</div>
<div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;               <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(HOST_IA32_PERF_GLOBAL_CTRL));</div>
<div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_EXIT_MSR_LOAD_COUNT) &gt; 0)</div>
<div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;        <a class="code" href="vmx_8c.html#a541151ce2151a85e333a048b2624c76b">vmx_dump_msrs</a>(<span class="stringliteral">&quot;host autoload&quot;</span>, &amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#aa2342c4a9744bc32d82ac6297fb9327c">msr_autoload</a>.<a class="code" href="structvcpu__vmx_1_1msr__autoload.html#a19dc6f076638fe7c99fcd85b0306872e">host</a>);</div>
<div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160; </div>
<div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;    pr_err(<span class="stringliteral">&quot;*** Control State ***\n&quot;</span>);</div>
<div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;    pr_err(<span class="stringliteral">&quot;CPUBased=0x%08x SecondaryExec=0x%08x TertiaryExec=0x%016llx\n&quot;</span>,</div>
<div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;           cpu_based_exec_ctrl, secondary_exec_control, tertiary_exec_control);</div>
<div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;    pr_err(<span class="stringliteral">&quot;PinBased=0x%08x EntryControls=%08x ExitControls=%08x\n&quot;</span>,</div>
<div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;           pin_based_exec_ctrl, vmentry_ctl, vmexit_ctl);</div>
<div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;    pr_err(<span class="stringliteral">&quot;ExceptionBitmap=%08x PFECmask=%08x PFECmatch=%08x\n&quot;</span>,</div>
<div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(EXCEPTION_BITMAP),</div>
<div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(PAGE_FAULT_ERROR_CODE_MASK),</div>
<div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(PAGE_FAULT_ERROR_CODE_MATCH));</div>
<div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;    pr_err(<span class="stringliteral">&quot;VMEntry: intr_info=%08x errcode=%08x ilen=%08x\n&quot;</span>,</div>
<div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_ENTRY_INTR_INFO_FIELD),</div>
<div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_ENTRY_EXCEPTION_ERROR_CODE),</div>
<div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_ENTRY_INSTRUCTION_LEN));</div>
<div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;    pr_err(<span class="stringliteral">&quot;VMExit: intr_info=%08x errcode=%08x ilen=%08x\n&quot;</span>,</div>
<div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_EXIT_INTR_INFO),</div>
<div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_EXIT_INTR_ERROR_CODE),</div>
<div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_EXIT_INSTRUCTION_LEN));</div>
<div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;    pr_err(<span class="stringliteral">&quot;        reason=%08x qualification=%016lx\n&quot;</span>,</div>
<div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_EXIT_REASON), <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(EXIT_QUALIFICATION));</div>
<div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;    pr_err(<span class="stringliteral">&quot;IDTVectoring: info=%08x errcode=%08x\n&quot;</span>,</div>
<div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(IDT_VECTORING_INFO_FIELD),</div>
<div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;           <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(IDT_VECTORING_ERROR_CODE));</div>
<div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;    pr_err(<span class="stringliteral">&quot;TSC Offset = 0x%016llx\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(TSC_OFFSET));</div>
<div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;    <span class="keywordflow">if</span> (secondary_exec_control &amp; SECONDARY_EXEC_TSC_SCALING)</div>
<div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;        pr_err(<span class="stringliteral">&quot;TSC Multiplier = 0x%016llx\n&quot;</span>,</div>
<div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;               <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(TSC_MULTIPLIER));</div>
<div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;    <span class="keywordflow">if</span> (cpu_based_exec_ctrl &amp; CPU_BASED_TPR_SHADOW) {</div>
<div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;        <span class="keywordflow">if</span> (secondary_exec_control &amp; SECONDARY_EXEC_VIRTUAL_INTR_DELIVERY) {</div>
<div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;            u16 status = <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(GUEST_INTR_STATUS);</div>
<div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;            pr_err(<span class="stringliteral">&quot;SVI|RVI = %02x|%02x &quot;</span>, status &gt;&gt; 8, status &amp; 0xff);</div>
<div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;        }</div>
<div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;        pr_cont(<span class="stringliteral">&quot;TPR Threshold = 0x%02x\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(TPR_THRESHOLD));</div>
<div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;        <span class="keywordflow">if</span> (secondary_exec_control &amp; SECONDARY_EXEC_VIRTUALIZE_APIC_ACCESSES)</div>
<div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;            pr_err(<span class="stringliteral">&quot;APIC-access addr = 0x%016llx &quot;</span>, <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(APIC_ACCESS_ADDR));</div>
<div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;        pr_cont(<span class="stringliteral">&quot;virt-APIC addr = 0x%016llx\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(VIRTUAL_APIC_PAGE_ADDR));</div>
<div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;    }</div>
<div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;    <span class="keywordflow">if</span> (pin_based_exec_ctrl &amp; PIN_BASED_POSTED_INTR)</div>
<div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;        pr_err(<span class="stringliteral">&quot;PostedIntrVec = 0x%02x\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(POSTED_INTR_NV));</div>
<div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;    <span class="keywordflow">if</span> ((secondary_exec_control &amp; SECONDARY_EXEC_ENABLE_EPT))</div>
<div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;        pr_err(<span class="stringliteral">&quot;EPT pointer = 0x%016llx\n&quot;</span>, <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(EPT_POINTER));</div>
<div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;    <span class="keywordflow">if</span> (secondary_exec_control &amp; SECONDARY_EXEC_PAUSE_LOOP_EXITING)</div>
<div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;        pr_err(<span class="stringliteral">&quot;PLE Gap=%08x Window=%08x\n&quot;</span>,</div>
<div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;               <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(PLE_GAP), <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(PLE_WINDOW));</div>
<div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;    <span class="keywordflow">if</span> (secondary_exec_control &amp; SECONDARY_EXEC_ENABLE_VPID)</div>
<div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;        pr_err(<span class="stringliteral">&quot;Virtual processor ID = 0x%04x\n&quot;</span>,</div>
<div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;               <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(VIRTUAL_PROCESSOR_ID));</div>
<div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;}</div>
<div class="ttc" id="acapabilities_8h_html_a60e1ec528bbaedd1eeb87d928827415b"><div class="ttname"><a href="capabilities_8h.html#a60e1ec528bbaedd1eeb87d928827415b">cpu_has_vmx_ept</a></div><div class="ttdeci">static bool cpu_has_vmx_ept(void)</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00147">capabilities.h:147</a></div></div>
<div class="ttc" id="acapabilities_8h_html_a7dc840840c570386f3265751dbcd8b41"><div class="ttname"><a href="capabilities_8h.html#a7dc840840c570386f3265751dbcd8b41">cpu_has_secondary_exec_ctrls</a></div><div class="ttdeci">static bool cpu_has_secondary_exec_ctrls(void)</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00129">capabilities.h:129</a></div></div>
<div class="ttc" id="acapabilities_8h_html_a920302b2e36959afed4b793d45d26f40"><div class="ttname"><a href="capabilities_8h.html#a920302b2e36959afed4b793d45d26f40">cpu_has_load_perf_global_ctrl</a></div><div class="ttdeci">static bool cpu_has_load_perf_global_ctrl(void)</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00104">capabilities.h:104</a></div></div>
<div class="ttc" id="acapabilities_8h_html_af254f84e2513a22e3c7ba836179b9548"><div class="ttname"><a href="capabilities_8h.html#af254f84e2513a22e3c7ba836179b9548">cpu_has_tertiary_exec_ctrls</a></div><div class="ttdeci">static bool cpu_has_tertiary_exec_ctrls(void)</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00135">capabilities.h:135</a></div></div>
<div class="ttc" id="astructvcpu__vmx_1_1msr__autoload_html_a19dc6f076638fe7c99fcd85b0306872e"><div class="ttname"><a href="structvcpu__vmx_1_1msr__autoload.html#a19dc6f076638fe7c99fcd85b0306872e">vcpu_vmx::msr_autoload::host</a></div><div class="ttdeci">struct vmx_msrs host</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00356">vmx.h:296</a></div></div>
<div class="ttc" id="astructvcpu__vmx_1_1msr__autoload_html_aa85a2800d89b05867169870c50c33665"><div class="ttname"><a href="structvcpu__vmx_1_1msr__autoload.html#aa85a2800d89b05867169870c50c33665">vcpu_vmx::msr_autoload::guest</a></div><div class="ttdeci">struct vmx_msrs guest</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00356">vmx.h:295</a></div></div>
<div class="ttc" id="astructvcpu__vmx_1_1msr__autostore_html_a0886390d509879e5e49b9b73834160ee"><div class="ttname"><a href="structvcpu__vmx_1_1msr__autostore.html#a0886390d509879e5e49b9b73834160ee">vcpu_vmx::msr_autostore::guest</a></div><div class="ttdeci">struct vmx_msrs guest</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00356">vmx.h:300</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_a2bfaa8dae08466864892966a16176e3b"><div class="ttname"><a href="structvcpu__vmx.html#a2bfaa8dae08466864892966a16176e3b">vcpu_vmx::msr_autostore</a></div><div class="ttdeci">struct vcpu_vmx::msr_autostore msr_autostore</div></div>
<div class="ttc" id="astructvcpu__vmx_html_aa2342c4a9744bc32d82ac6297fb9327c"><div class="ttname"><a href="structvcpu__vmx.html#aa2342c4a9744bc32d82ac6297fb9327c">vcpu_vmx::msr_autoload</a></div><div class="ttdeci">struct vcpu_vmx::msr_autoload msr_autoload</div></div>
<div class="ttc" id="astructvmx__msrs_html_ab2a7da3278820cc5bce9ac08b5b9cea4"><div class="ttname"><a href="structvmx__msrs.html#ab2a7da3278820cc5bce9ac08b5b9cea4">vmx_msrs::val</a></div><div class="ttdeci">struct vmx_msr_entry val[MAX_NR_LOADSTORE_MSRS]</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00034">vmx.h:35</a></div></div>
<div class="ttc" id="avmx_8c_html_a07cb8535d5c63fe54c6233e78b47d6c7"><div class="ttname"><a href="vmx_8c.html#a07cb8535d5c63fe54c6233e78b47d6c7">vmx_find_loadstore_msr_slot</a></div><div class="ttdeci">int vmx_find_loadstore_msr_slot(struct vmx_msrs *m, u32 msr)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00969">vmx.c:969</a></div></div>
<div class="ttc" id="avmx_8c_html_a15bb194d07dae718cd11236afe343d69"><div class="ttname"><a href="vmx_8c.html#a15bb194d07dae718cd11236afe343d69">vmx_dump_dtsel</a></div><div class="ttdeci">static void vmx_dump_dtsel(char *name, uint32_t limit)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l06215">vmx.c:6215</a></div></div>
<div class="ttc" id="avmx_8c_html_a283c11409f38c5370746a05b2419a23f"><div class="ttname"><a href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f">vmx_dump_sel</a></div><div class="ttdeci">static void vmx_dump_sel(char *name, uint32_t sel)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l06206">vmx.c:6206</a></div></div>
<div class="ttc" id="avmx_8c_html_a541151ce2151a85e333a048b2624c76b"><div class="ttname"><a href="vmx_8c.html#a541151ce2151a85e333a048b2624c76b">vmx_dump_msrs</a></div><div class="ttdeci">static void vmx_dump_msrs(char *name, struct vmx_msrs *m)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l06222">vmx.c:6222</a></div></div>
<div class="ttc" id="avmx_8c_html_a5938e0d9c5df909b3ed2bb2269b1d79c"><div class="ttname"><a href="vmx_8c.html#a5938e0d9c5df909b3ed2bb2269b1d79c">dump_invalid_vmcs</a></div><div class="ttdeci">static bool __read_mostly dump_invalid_vmcs</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00126">vmx.c:126</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_a2088262a71496c55f21ddab30c364663"><div class="ttname"><a href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a></div><div class="ttdeci">static __always_inline u64 vmcs_read64(unsigned long field)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00169">vmx_ops.h:169</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_a8e451d9fa742dfde330958372b978485"><div class="ttname"><a href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a></div><div class="ttdeci">static __always_inline u32 vmcs_read32(unsigned long field)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00161">vmx_ops.h:161</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_aefa9026aa63362d2c8205086f646e956"><div class="ttname"><a href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a></div><div class="ttdeci">static __always_inline unsigned long vmcs_readl(unsigned long field)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00181">vmx_ops.h:181</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_af65cbcf47ab58f0ae9a713ebf50f03a7"><div class="ttname"><a href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a></div><div class="ttdeci">static __always_inline u16 vmcs_read16(unsigned long field)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00153">vmx_ops.h:153</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ac39cca04dec7bf494bf2e19ee9f765fe_cgraph.png" border="0" usemap="#avmx_8h_ac39cca04dec7bf494bf2e19ee9f765fe_cgraph" alt=""/></div>
<map name="avmx_8h_ac39cca04dec7bf494bf2e19ee9f765fe_cgraph" id="avmx_8h_ac39cca04dec7bf494bf2e19ee9f765fe_cgraph">
<area shape="rect" title=" " alt="" coords="5,340,107,367"/>
<area shape="rect" href="capabilities_8h.html#a920302b2e36959afed4b793d45d26f40" title=" " alt="" coords="155,5,373,32"/>
<area shape="rect" href="capabilities_8h.html#a7dc840840c570386f3265751dbcd8b41" title=" " alt="" coords="171,57,357,98"/>
<area shape="rect" href="capabilities_8h.html#af254f84e2513a22e3c7ba836179b9548" title=" " alt="" coords="181,122,347,163"/>
<area shape="rect" href="capabilities_8h.html#a60e1ec528bbaedd1eeb87d928827415b" title=" " alt="" coords="195,188,333,215"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="229,239,299,265"/>
<area shape="rect" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7" title=" " alt="" coords="421,315,531,341"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="421,492,531,519"/>
<area shape="rect" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663" title=" " alt="" coords="421,441,531,468"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="427,391,525,417"/>
<area shape="rect" href="vmx_8c.html#a15bb194d07dae718cd11236afe343d69" title=" " alt="" coords="197,492,331,519"/>
<area shape="rect" href="vmx_8c.html#a541151ce2151a85e333a048b2624c76b" title=" " alt="" coords="197,593,331,620"/>
<area shape="rect" href="vmx_8c.html#a283c11409f38c5370746a05b2419a23f" title=" " alt="" coords="203,340,325,367"/>
<area shape="rect" href="vmx_8c.html#a07cb8535d5c63fe54c6233e78b47d6c7" title=" " alt="" coords="189,645,339,686"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="604,441,715,468"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a77b65dd311c34381a8508de99e9b8543" title=" " alt="" coords="601,239,718,265"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="579,340,740,367"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="600,188,719,215"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="788,416,939,443"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="808,467,919,493"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="601,593,718,620"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="600,543,719,569"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="601,391,718,417"/>
<area shape="rect" href="vmx__ops_8h.html#a482358473ceab579ad9c93b46e13fe25" title=" " alt="" coords="600,492,719,519"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="606,289,713,316"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ac39cca04dec7bf494bf2e19ee9f765fe_icgraph.png" border="0" usemap="#avmx_8h_ac39cca04dec7bf494bf2e19ee9f765fe_icgraph" alt=""/></div>
<map name="avmx_8h_ac39cca04dec7bf494bf2e19ee9f765fe_icgraph" id="avmx_8h_ac39cca04dec7bf494bf2e19ee9f765fe_icgraph">
<area shape="rect" title=" " alt="" coords="384,5,485,32"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="188,5,336,32"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,5,140,32"/>
</map>
</div>

</div>
</div>
<a id="a127240567687a7433409baa441cb3c03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a127240567687a7433409baa441cb3c03">&#9670;&nbsp;</a></span>ept_save_pdptrs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ept_save_pdptrs </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03246">3246</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;{</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;    <span class="keyword">struct </span>kvm_mmu *mmu = vcpu-&gt;arch.walk_mmu;</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160; </div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;    <span class="keywordflow">if</span> (WARN_ON_ONCE(!<a class="code" href="x86_8h.html#aaa36cdb43bbf6ed6af3b10deed46a436">is_pae_paging</a>(vcpu)))</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160; </div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    mmu-&gt;pdptrs[0] = <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_PDPTR0);</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;    mmu-&gt;pdptrs[1] = <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_PDPTR1);</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;    mmu-&gt;pdptrs[2] = <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_PDPTR2);</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    mmu-&gt;pdptrs[3] = <a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_PDPTR3);</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160; </div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    <a class="code" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f">kvm_register_mark_available</a>(vcpu, VCPU_EXREG_PDPTR);</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_a02b01f3ac97e70ca6457508f8dd94b2f"><div class="ttname"><a href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f">kvm_register_mark_available</a></div><div class="ttdeci">static void kvm_register_mark_available(struct kvm_vcpu *vcpu, enum kvm_reg reg)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00065">kvm_cache_regs.h:65</a></div></div>
<div class="ttc" id="ax86_8h_html_aaa36cdb43bbf6ed6af3b10deed46a436"><div class="ttname"><a href="x86_8h.html#aaa36cdb43bbf6ed6af3b10deed46a436">is_pae_paging</a></div><div class="ttdeci">static bool is_pae_paging(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00203">x86.h:203</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a127240567687a7433409baa441cb3c03_cgraph.png" border="0" usemap="#avmx_8h_a127240567687a7433409baa441cb3c03_cgraph" alt=""/></div>
<map name="avmx_8h_a127240567687a7433409baa441cb3c03_cgraph" id="avmx_8h_a127240567687a7433409baa441cb3c03_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,135,159"/>
<area shape="rect" href="x86_8h.html#aaa36cdb43bbf6ed6af3b10deed46a436" title=" " alt="" coords="233,69,348,96"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="183,132,399,159"/>
<area shape="rect" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663" title=" " alt="" coords="236,208,345,235"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="471,5,583,32"/>
<area shape="rect" href="x86_8h.html#abc2ffd79aced13c24f0c4143465d3d51" title=" " alt="" coords="495,56,559,83"/>
<area shape="rect" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878" title=" " alt="" coords="485,107,569,133"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65" title=" " alt="" coords="658,56,805,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a24ffc81fe5ed7998e29134351275b4dd" title=" " alt="" coords="855,56,1000,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1048,81,1241,108"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="658,107,805,133"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="855,107,1000,133"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="472,157,583,184"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="469,208,586,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="447,259,608,285"/>
<area shape="rect" href="vmx__ops_8h.html#a482358473ceab579ad9c93b46e13fe25" title=" " alt="" coords="468,309,587,336"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="656,157,807,184"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="676,208,787,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a127240567687a7433409baa441cb3c03_icgraph.png" border="0" usemap="#avmx_8h_a127240567687a7433409baa441cb3c03_icgraph" alt=""/></div>
<map name="avmx_8h_a127240567687a7433409baa441cb3c03_icgraph" id="avmx_8h_a127240567687a7433409baa441cb3c03_icgraph">
<area shape="rect" title=" " alt="" coords="1457,344,1587,371"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,309,1070,350"/>
<area shape="rect" href="vmx_8c.html#a2c4d6e59c045e49243d6c4a2812999b8" title=" " alt="" coords="1285,369,1409,396"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,316,853,343"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,161,361,188"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,224,604,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,275,631,317"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,341,651,382"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,392,387,419"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,158,618,199"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,457,633,484"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,509,635,550"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,56,615,83"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,161,140,188"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,217,373,258"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,224,136,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,311,369,353"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,461,138,488"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,107,374,133"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,5,343,32"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,56,372,83"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,107,134,133"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1132,371,1237,397"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,375,1084,401"/>
</map>
</div>

</div>
</div>
<a id="af92910217dcc55da03421a552d174080"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af92910217dcc55da03421a552d174080">&#9670;&nbsp;</a></span>free_loaded_vmcs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_loaded_vmcs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structloaded__vmcs.html">loaded_vmcs</a> *&#160;</td>
          <td class="paramname"><em>loaded_vmcs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l02893">2893</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;{</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a>)</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    <a class="code" href="vmx_8c.html#acffc6d01ff543c9abee613b5fe1b1bd4">loaded_vmcs_clear</a>(<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>);</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <a class="code" href="vmx_8c.html#a171771cf05868f64b6e6491889a842e1">free_vmcs</a>(<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a>);</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a> = NULL;</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a5553ab2c0ac0996950eeba41ec05a48f">msr_bitmap</a>)</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        free_page((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a5553ab2c0ac0996950eeba41ec05a48f">msr_bitmap</a>);</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    WARN_ON(<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#ac39ebb8d8757b3fc7c52ac264b2ca1c7">shadow_vmcs</a> != NULL);</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;}</div>
<div class="ttc" id="avmx_8c_html_a171771cf05868f64b6e6491889a842e1"><div class="ttname"><a href="vmx_8c.html#a171771cf05868f64b6e6491889a842e1">free_vmcs</a></div><div class="ttdeci">void free_vmcs(struct vmcs *vmcs)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l02885">vmx.c:2885</a></div></div>
<div class="ttc" id="avmx_8c_html_acffc6d01ff543c9abee613b5fe1b1bd4"><div class="ttname"><a href="vmx_8c.html#acffc6d01ff543c9abee613b5fe1b1bd4">loaded_vmcs_clear</a></div><div class="ttdeci">void loaded_vmcs_clear(struct loaded_vmcs *loaded_vmcs)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00814">vmx.c:814</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_af92910217dcc55da03421a552d174080_cgraph.png" border="0" usemap="#avmx_8h_af92910217dcc55da03421a552d174080_cgraph" alt=""/></div>
<map name="avmx_8h_af92910217dcc55da03421a552d174080_cgraph" id="avmx_8h_af92910217dcc55da03421a552d174080_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,147,57"/>
<area shape="rect" href="vmx_8c.html#a171771cf05868f64b6e6491889a842e1" title=" " alt="" coords="223,5,313,32"/>
<area shape="rect" href="vmx_8c.html#acffc6d01ff543c9abee613b5fe1b1bd4" title=" " alt="" coords="195,56,341,83"/>
<area shape="rect" href="vmx_8c.html#a70760e20007fba075a5170ffbdc80fa6" title=" " alt="" coords="389,56,551,83"/>
<area shape="rect" href="vmx__ops_8h.html#adefc7dc8e1885fe973b3e8d58e23e0aa" title=" " alt="" coords="599,56,695,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_af92910217dcc55da03421a552d174080_icgraph.png" border="0" usemap="#avmx_8h_af92910217dcc55da03421a552d174080_icgraph" alt=""/></div>
<map name="avmx_8h_af92910217dcc55da03421a552d174080_icgraph" id="avmx_8h_af92910217dcc55da03421a552d174080_icgraph">
<area shape="rect" title=" " alt="" coords="1024,107,1165,133"/>
<area shape="rect" href="vmx_8c.html#a4323cda8d4cdaaa4a5f9188abd36a4b7" title=" " alt="" coords="829,56,976,83"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="620,5,781,32"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="632,56,769,83"/>
<area shape="rect" href="vmx_2nested_8c.html#ad9920ec1586ae352fbc272ed93cf7b38" title=" " alt="" coords="853,157,952,184"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="204,185,327,212"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="427,5,544,32"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="401,56,570,83"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,73,351,114"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,80,132,107"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="641,107,760,133"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="628,157,773,184"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="399,157,572,184"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="430,208,541,235"/>
</map>
</div>

</div>
</div>
<a id="a171771cf05868f64b6e6491889a842e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a171771cf05868f64b6e6491889a842e1">&#9670;&nbsp;</a></span>free_vmcs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_vmcs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvmcs.html">vmcs</a> *&#160;</td>
          <td class="paramname"><em>vmcs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l02885">2885</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;{</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    free_page((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="structvmcs.html">vmcs</a>);</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a171771cf05868f64b6e6491889a842e1_icgraph.png" border="0" usemap="#avmx_8h_a171771cf05868f64b6e6491889a842e1_icgraph" alt=""/></div>
<map name="avmx_8h_a171771cf05868f64b6e6491889a842e1_icgraph" id="avmx_8h_a171771cf05868f64b6e6491889a842e1_icgraph">
<area shape="rect" title=" " alt="" coords="1245,259,1336,285"/>
<area shape="rect" href="vmx_8c.html#abf434f12d6b169dddf7dc693ee3d0ddf" title=" " alt="" coords="1067,56,1187,83"/>
<area shape="rect" href="vmx_8c.html#af92910217dcc55da03421a552d174080" title=" " alt="" coords="1056,233,1197,260"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="632,208,769,235"/>
<area shape="rect" href="vmx_2nested_8c.html#ad9920ec1586ae352fbc272ed93cf7b38" title=" " alt="" coords="869,360,968,387"/>
<area shape="rect" href="vmx_8c.html#a6096b0ce5dacb759a7fdfb2ba651bdf6" title=" " alt="" coords="203,77,328,104"/>
<area shape="rect" href="vmx_8c.html#ac5d3e368f1f75567ecc165bd39159199" title=" " alt="" coords="829,5,1008,32"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,117,132,144"/>
<area shape="rect" href="vmx_8c.html#a4323cda8d4cdaaa4a5f9188abd36a4b7" title=" " alt="" coords="845,157,992,184"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="620,157,781,184"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="204,335,327,361"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="427,157,544,184"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="401,360,570,387"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,150,351,191"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="641,321,760,348"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="628,385,773,412"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="399,411,572,437"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="430,461,541,488"/>
</map>
</div>

</div>
</div>
<a id="af37bc0d4747f28913c3ba1da2468a563"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af37bc0d4747f28913c3ba1da2468a563">&#9670;&nbsp;</a></span>free_vpid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_vpid </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>vpid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03935">3935</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;{</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#ac72dec1b9f135b5d53c436112ff2b73b">enable_vpid</a> || vpid == 0)</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;    spin_lock(&amp;vmx_vpid_lock);</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;    __clear_bit(vpid, vmx_vpid_bitmap);</div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;    spin_unlock(&amp;vmx_vpid_lock);</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_af37bc0d4747f28913c3ba1da2468a563_icgraph.png" border="0" usemap="#avmx_8h_af37bc0d4747f28913c3ba1da2468a563_icgraph" alt=""/></div>
<map name="avmx_8h_af37bc0d4747f28913c3ba1da2468a563_icgraph" id="avmx_8h_af37bc0d4747f28913c3ba1da2468a563_icgraph">
<area shape="rect" title=" " alt="" coords="780,223,863,250"/>
<area shape="rect" href="vmx_2nested_8c.html#ad9920ec1586ae352fbc272ed93cf7b38" title=" " alt="" coords="614,122,713,149"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="7,147,130,174"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="595,274,732,301"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="415,42,533,69"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="401,122,547,149"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="181,5,352,47"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,13,132,39"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="180,71,353,98"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="211,122,322,149"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="182,173,351,199"/>
</map>
</div>

</div>
</div>
<a id="aed2f5a4c9080d0316ad30f8a74ddefcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed2f5a4c9080d0316ad30f8a74ddefcc">&#9670;&nbsp;</a></span>intel_pmu_create_guest_lbr_event()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int intel_pmu_create_guest_lbr_event </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu__intel_8c_source.html#l00254">254</a> of file <a class="el" href="pmu__intel_8c_source.html">pmu_intel.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;{</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keyword">struct </span><a class="code" href="structlbr__desc.html">lbr_desc</a> *<a class="code" href="structlbr__desc.html">lbr_desc</a> = <a class="code" href="vmx_8h.html#aa3f9a4735e6ff00497c0086664b433bd">vcpu_to_lbr_desc</a>(vcpu);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keyword">struct </span>kvm_pmu *pmu = <a class="code" href="pmu_8h.html#ac1c6bc4b1435215c1bd1b1b9583c6441">vcpu_to_pmu</a>(vcpu);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keyword">struct </span>perf_event *event;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">     * The perf_event_attr is constructed in the minimum efficient way:</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">     * - set &#39;pinned = true&#39; to make it task pinned so that if another</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">     *   cpu pinned event reclaims LBR, the event-&gt;oncpu will be set to -1;</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">     * - set &#39;.exclude_host = true&#39; to record guest branches behavior;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">     * - set &#39;.config = INTEL_FIXED_VLBR_EVENT&#39; to indicates host perf</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">     *   schedule the event without a real HW counter but a fake one;</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">     *   check is_guest_lbr_event() and __intel_get_event_constraints();</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">     * - set &#39;sample_type = PERF_SAMPLE_BRANCH_STACK&#39; and</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">     *   &#39;branch_sample_type = PERF_SAMPLE_BRANCH_CALL_STACK |</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">     *   PERF_SAMPLE_BRANCH_USER&#39; to configure it as a LBR callstack</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">     *   event, which helps KVM to save/restore guest LBR records</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">     *   during host context switches and reduces quite a lot overhead,</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">     *   check branch_user_callstack() and intel_pmu_lbr_sched_task();</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keyword">struct </span>perf_event_attr attr = {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        .type = PERF_TYPE_RAW,</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        .size = <span class="keyword">sizeof</span>(attr),</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        .config = INTEL_FIXED_VLBR_EVENT,</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        .sample_type = PERF_SAMPLE_BRANCH_STACK,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        .pinned = <span class="keyword">true</span>,</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        .exclude_host = <span class="keyword">true</span>,</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        .branch_sample_type = PERF_SAMPLE_BRANCH_CALL_STACK |</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    PERF_SAMPLE_BRANCH_USER,</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    };</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (unlikely(<a class="code" href="structlbr__desc.html">lbr_desc</a>-&gt;<a class="code" href="structlbr__desc.html#a385c74465d1b6562bbb44cd6b9149b13">event</a>)) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        __set_bit(INTEL_PMC_IDX_FIXED_VLBR, pmu-&gt;pmc_in_use);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keyword">event</span> = perf_event_create_kernel_counter(&amp;attr, -1,</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                        current, NULL, NULL);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span> (IS_ERR(event)) {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        pr_debug_ratelimited(<span class="stringliteral">&quot;%s: failed %ld\n&quot;</span>,</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                    __func__, PTR_ERR(event));</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordflow">return</span> PTR_ERR(event);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="structlbr__desc.html">lbr_desc</a>-&gt;<a class="code" href="structlbr__desc.html#a385c74465d1b6562bbb44cd6b9149b13">event</a> = event;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    pmu-&gt;event_count++;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    __set_bit(INTEL_PMC_IDX_FIXED_VLBR, pmu-&gt;pmc_in_use);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;}</div>
<div class="ttc" id="apmu_8h_html_ac1c6bc4b1435215c1bd1b1b9583c6441"><div class="ttname"><a href="pmu_8h.html#ac1c6bc4b1435215c1bd1b1b9583c6441">vcpu_to_pmu</a></div><div class="ttdeci">#define vcpu_to_pmu(vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu_8h_source.html#l00007">pmu.h:7</a></div></div>
<div class="ttc" id="astructlbr__desc_html"><div class="ttname"><a href="structlbr__desc.html">lbr_desc</a></div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00096">vmx.h:96</a></div></div>
<div class="ttc" id="astructlbr__desc_html_a385c74465d1b6562bbb44cd6b9149b13"><div class="ttname"><a href="structlbr__desc.html#a385c74465d1b6562bbb44cd6b9149b13">lbr_desc::event</a></div><div class="ttdeci">struct perf_event * event</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00106">vmx.h:106</a></div></div>
<div class="ttc" id="avmx_8h_html_aa3f9a4735e6ff00497c0086664b433bd"><div class="ttname"><a href="vmx_8h.html#aa3f9a4735e6ff00497c0086664b433bd">vcpu_to_lbr_desc</a></div><div class="ttdeci">static struct lbr_desc * vcpu_to_lbr_desc(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00662">vmx.h:662</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aed2f5a4c9080d0316ad30f8a74ddefcc_cgraph.png" border="0" usemap="#avmx_8h_aed2f5a4c9080d0316ad30f8a74ddefcc_cgraph" alt=""/></div>
<map name="avmx_8h_aed2f5a4c9080d0316ad30f8a74ddefcc_cgraph" id="avmx_8h_aed2f5a4c9080d0316ad30f8a74ddefcc_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,184,47"/>
<area shape="rect" href="vmx_8h.html#aa3f9a4735e6ff00497c0086664b433bd" title=" " alt="" coords="232,13,367,39"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="415,13,485,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aed2f5a4c9080d0316ad30f8a74ddefcc_icgraph.png" border="0" usemap="#avmx_8h_aed2f5a4c9080d0316ad30f8a74ddefcc_icgraph" alt=""/></div>
<map name="avmx_8h_aed2f5a4c9080d0316ad30f8a74ddefcc_icgraph" id="avmx_8h_aed2f5a4c9080d0316ad30f8a74ddefcc_icgraph">
<area shape="rect" title=" " alt="" coords="411,53,589,94"/>
<area shape="rect" href="pmu__intel_8c.html#aa518f17a337585c3c6e12c054c2cec59" title=" " alt="" coords="200,23,363,65"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="226,89,337,116"/>
<area shape="rect" href="pmu__intel_8c.html#a7bb7e7c2288534cee8bdee7f3c05126e" title=" " alt="" coords="5,5,152,32"/>
<area shape="rect" href="pmu__intel_8c.html#aa0eaa27ec4bacea0eb28d3055fb3d4b8" title=" " alt="" coords="5,56,152,83"/>
</map>
</div>

</div>
</div>
<a id="a739a0fdd09980536bf444456a0b1e5e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a739a0fdd09980536bf444456a0b1e5e1">&#9670;&nbsp;</a></span>intel_pmu_cross_mapped_check()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void intel_pmu_cross_mapped_check </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmu *&#160;</td>
          <td class="paramname"><em>pmu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu__intel_8c_source.html#l00746">746</a> of file <a class="el" href="pmu__intel_8c_source.html">pmu_intel.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;{</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keyword">struct </span>kvm_pmc *pmc = NULL;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordtype">int</span> bit, hw_idx;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    for_each_set_bit(bit, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;pmu-&gt;global_ctrl,</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;             X86_PMC_IDX_MAX) {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        pmc = <a class="code" href="pmu__intel_8c.html#ac632f6b4385eeb80a954248723aaebbc">intel_pmc_idx_to_pmc</a>(pmu, bit);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <span class="keywordflow">if</span> (!pmc || !<a class="code" href="pmu_8h.html#a276700643eefb3c6911a7ae0dc0e3809">pmc_speculative_in_use</a>(pmc) ||</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            !<a class="code" href="pmu_8h.html#a156ede05e2f3b40ccf7a68f471f574b2">pmc_is_globally_enabled</a>(pmc) || !pmc-&gt;perf_event)</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">         * A negative index indicates the event isn&#39;t mapped to a</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">         * physical counter in the host, e.g. due to contention.</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        hw_idx = pmc-&gt;perf_event-&gt;hw.idx;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">if</span> (hw_idx != pmc-&gt;idx &amp;&amp; hw_idx &gt; -1)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            pmu-&gt;host_cross_mapped_mask |= BIT_ULL(hw_idx);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;}</div>
<div class="ttc" id="apmu_8h_html_a156ede05e2f3b40ccf7a68f471f574b2"><div class="ttname"><a href="pmu_8h.html#a156ede05e2f3b40ccf7a68f471f574b2">pmc_is_globally_enabled</a></div><div class="ttdeci">static bool pmc_is_globally_enabled(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu_8h_source.html#l00206">pmu.h:206</a></div></div>
<div class="ttc" id="apmu_8h_html_a276700643eefb3c6911a7ae0dc0e3809"><div class="ttname"><a href="pmu_8h.html#a276700643eefb3c6911a7ae0dc0e3809">pmc_speculative_in_use</a></div><div class="ttdeci">static bool pmc_speculative_in_use(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu_8h_source.html#l00128">pmu.h:128</a></div></div>
<div class="ttc" id="apmu__intel_8c_html_ac632f6b4385eeb80a954248723aaebbc"><div class="ttname"><a href="pmu__intel_8c.html#ac632f6b4385eeb80a954248723aaebbc">intel_pmc_idx_to_pmc</a></div><div class="ttdeci">static struct kvm_pmc * intel_pmc_idx_to_pmc(struct kvm_pmu *pmu, int pmc_idx)</div><div class="ttdef"><b>Definition:</b> <a href="pmu__intel_8c_source.html#l00092">pmu_intel.c:92</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a739a0fdd09980536bf444456a0b1e5e1_icgraph.png" border="0" usemap="#avmx_8h_a739a0fdd09980536bf444456a0b1e5e1_icgraph" alt=""/></div>
<map name="avmx_8h_a739a0fdd09980536bf444456a0b1e5e1_icgraph" id="avmx_8h_a739a0fdd09980536bf444456a0b1e5e1_icgraph">
<area shape="rect" title=" " alt="" coords="407,5,595,47"/>
<area shape="rect" href="vmx_8c.html#ae2f61d4cf1902304d2ecb05317e452f5" title=" " alt="" coords="171,13,359,39"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="5,13,123,39"/>
</map>
</div>

</div>
</div>
<a id="aaf2d6801dce444c2f2592a0942780f59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf2d6801dce444c2f2592a0942780f59">&#9670;&nbsp;</a></span>intel_pmu_lbr_is_enabled()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool intel_pmu_lbr_is_enabled </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00672">672</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;{</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordflow">return</span> !!<a class="code" href="vmx_8h.html#a499f1757999ae37f448bbadf72448fa4">vcpu_to_lbr_records</a>(vcpu)-&gt;nr;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;}</div>
<div class="ttc" id="avmx_8h_html_a499f1757999ae37f448bbadf72448fa4"><div class="ttname"><a href="vmx_8h.html#a499f1757999ae37f448bbadf72448fa4">vcpu_to_lbr_records</a></div><div class="ttdeci">static struct x86_pmu_lbr * vcpu_to_lbr_records(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00667">vmx.h:667</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aaf2d6801dce444c2f2592a0942780f59_cgraph.png" border="0" usemap="#avmx_8h_aaf2d6801dce444c2f2592a0942780f59_cgraph" alt=""/></div>
<map name="avmx_8h_aaf2d6801dce444c2f2592a0942780f59_cgraph" id="avmx_8h_aaf2d6801dce444c2f2592a0942780f59_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,193,32"/>
<area shape="rect" href="vmx_8h.html#a499f1757999ae37f448bbadf72448fa4" title=" " alt="" coords="241,5,393,32"/>
<area shape="rect" href="vmx_8h.html#aa3f9a4735e6ff00497c0086664b433bd" title=" " alt="" coords="441,5,576,32"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="624,5,695,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aaf2d6801dce444c2f2592a0942780f59_icgraph.png" border="0" usemap="#avmx_8h_aaf2d6801dce444c2f2592a0942780f59_icgraph" alt=""/></div>
<map name="avmx_8h_aaf2d6801dce444c2f2592a0942780f59_icgraph" id="avmx_8h_aaf2d6801dce444c2f2592a0942780f59_icgraph">
<area shape="rect" title=" " alt="" coords="673,123,861,149"/>
<area shape="rect" href="pmu__intel_8c.html#aebec0fe217b3fa5a80715120eb39a341" title=" " alt="" coords="433,5,603,32"/>
<area shape="rect" href="pmu__intel_8c.html#a8bff30f14b582aa13a6a9263d09ff44b" title=" " alt="" coords="446,57,590,98"/>
<area shape="rect" href="vmx_8c.html#a906eacca38431629c007c813de2ee658" title=" " alt="" coords="411,123,625,149"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="226,148,337,175"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="459,224,577,251"/>
<area shape="rect" href="pmu__intel_8c.html#a732847faae93b3f95f904168b42add71" title=" " alt="" coords="211,19,351,45"/>
<area shape="rect" href="pmu__intel_8c.html#aa518f17a337585c3c6e12c054c2cec59" title=" " alt="" coords="200,70,363,111"/>
<area shape="rect" href="pmu__intel_8c.html#a7bb7e7c2288534cee8bdee7f3c05126e" title=" " alt="" coords="5,52,152,79"/>
<area shape="rect" href="pmu__intel_8c.html#aa0eaa27ec4bacea0eb28d3055fb3d4b8" title=" " alt="" coords="5,103,152,129"/>
</map>
</div>

</div>
</div>
<a id="a78db067c5ddef5481cee88243a0937ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78db067c5ddef5481cee88243a0937ec">&#9670;&nbsp;</a></span>is_unrestricted_guest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool is_unrestricted_guest </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00727">727</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;{</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="capabilities_8h.html#acf6dd90f84c7ca02141ad0b64538fb16">enable_unrestricted_guest</a> &amp;&amp; (!<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(vcpu) ||</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        (secondary_exec_controls_get(<a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(vcpu)) &amp;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        SECONDARY_EXEC_UNRESTRICTED_GUEST));</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;}</div>
<div class="ttc" id="acapabilities_8h_html_acf6dd90f84c7ca02141ad0b64538fb16"><div class="ttname"><a href="capabilities_8h.html#acf6dd90f84c7ca02141ad0b64538fb16">enable_unrestricted_guest</a></div><div class="ttdeci">bool __read_mostly enable_unrestricted_guest</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00094">vmx.c:94</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a78db067c5ddef5481cee88243a0937ec_cgraph.png" border="0" usemap="#avmx_8h_a78db067c5ddef5481cee88243a0937ec_cgraph" alt=""/></div>
<map name="avmx_8h_a78db067c5ddef5481cee88243a0937ec_cgraph" id="avmx_8h_a78db067c5ddef5481cee88243a0937ec_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,167,57"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="215,5,335,32"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="239,56,310,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a78db067c5ddef5481cee88243a0937ec_icgraph.png" border="0" usemap="#avmx_8h_a78db067c5ddef5481cee88243a0937ec_icgraph" alt=""/></div>
<map name="avmx_8h_a78db067c5ddef5481cee88243a0937ec_icgraph" id="avmx_8h_a78db067c5ddef5481cee88243a0937ec_icgraph">
<area shape="rect" title=" " alt="" coords="2000,779,2161,806"/>
<area shape="rect" href="vmx_8c.html#a02a5a7a2c625e52874076332ecc41ace" title=" " alt="" coords="1787,526,1943,552"/>
<area shape="rect" href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf" title=" " alt="" coords="1779,830,1952,856"/>
<area shape="rect" href="vmx_8c.html#ae81f31c4be3384219d11e767cca4da94" title=" " alt="" coords="1365,804,1487,831"/>
<area shape="rect" href="vmx_8c.html#a5b0ffadb6f1bbf0fe42d6cf7a17490bb" title=" " alt="" coords="1372,450,1480,476"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,526,1084,552"/>
<area shape="rect" href="vmx_8c.html#a091adfc5844f05cea3f378cbf167a236" title=" " alt="" coords="1578,424,1698,451"/>
<area shape="rect" href="vmx_8c.html#a9e72f6be0ed4dafcb17b8fb874a39d58" title=" " alt="" coords="1355,576,1497,603"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1167,450,1272,476"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,982,138,1008"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,384,1070,425"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,383,853,410"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,94,361,120"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,526,604,552"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,460,631,501"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,174,651,216"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,244,387,271"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,57,618,98"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,240,633,267"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,292,635,333"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,408,615,435"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,94,140,120"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,797,373,838"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,804,136,831"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,633,369,674"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,358,374,384"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,459,343,486"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,408,372,435"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,358,134,384"/>
<area shape="rect" href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5" title=" " alt="" coords="1545,678,1731,704"/>
<area shape="rect" href="sgx_8c.html#ad3394313e85a46c8e1bc4880ddde7fc9" title=" " alt="" coords="1148,1159,1291,1186"/>
<area shape="rect" href="vmx_2nested_8c.html#a46021f02931b3001ef00a526b56448a8" title=" " alt="" coords="1132,779,1307,806"/>
<area shape="rect" href="vmx_2nested_8c.html#aec3ff66d7b1e9086f727ebe6b9b1a0cf" title=" " alt="" coords="1138,830,1301,856"/>
<area shape="rect" href="vmx_2nested_8c.html#a3c80ece98832af9587ecff9947817449" title=" " alt="" coords="911,880,1074,907"/>
<area shape="rect" href="sgx_8c.html#a34e5ee57c3e7c3172f8ae6ed981d703d" title=" " alt="" coords="939,1159,1046,1186"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="715,678,837,704"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="713,728,839,755"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="717,779,835,806"/>
<area shape="rect" href="vmx_2nested_8c.html#a4d1da86d40e5c09521979006a05a35e4" title=" " alt="" coords="927,830,1058,856"/>
<area shape="rect" href="vmx_2nested_8c.html#add1e82c32385142c0fca04a1db8cbc3a" title=" " alt="" coords="711,627,841,654"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="719,982,833,1008"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="715,830,837,856"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="713,880,839,907"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="714,931,838,958"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fecee9010894e3a1513a0924e24dd6" title=" " alt="" coords="474,627,611,654"/>
<area shape="rect" href="vmx_2nested_8c.html#a23e3de8c964e87404eea818be6f70154" title=" " alt="" coords="471,576,614,603"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="481,1083,605,1110"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="717,1032,835,1059"/>
</map>
</div>

</div>
</div>
<a id="acffc6d01ff543c9abee613b5fe1b1bd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acffc6d01ff543c9abee613b5fe1b1bd4">&#9670;&nbsp;</a></span>loaded_vmcs_clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loaded_vmcs_clear </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structloaded__vmcs.html">loaded_vmcs</a> *&#160;</td>
          <td class="paramname"><em>loaded_vmcs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l00814">814</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;{</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordtype">int</span> cpu = <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a41190e00a22fb0388ba36b9bb5cc3bdd">cpu</a>;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">if</span> (cpu != -1)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        smp_call_function_single(cpu,</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;             <a class="code" href="vmx_8c.html#a70760e20007fba075a5170ffbdc80fa6">__loaded_vmcs_clear</a>, <a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>, 1);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;}</div>
<div class="ttc" id="avmx_8c_html_a70760e20007fba075a5170ffbdc80fa6"><div class="ttname"><a href="vmx_8c.html#a70760e20007fba075a5170ffbdc80fa6">__loaded_vmcs_clear</a></div><div class="ttdeci">static void __loaded_vmcs_clear(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00785">vmx.c:785</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_acffc6d01ff543c9abee613b5fe1b1bd4_cgraph.png" border="0" usemap="#avmx_8h_acffc6d01ff543c9abee613b5fe1b1bd4_cgraph" alt=""/></div>
<map name="avmx_8h_acffc6d01ff543c9abee613b5fe1b1bd4_cgraph" id="avmx_8h_acffc6d01ff543c9abee613b5fe1b1bd4_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,152,32"/>
<area shape="rect" href="vmx_8c.html#a70760e20007fba075a5170ffbdc80fa6" title=" " alt="" coords="200,5,361,32"/>
<area shape="rect" href="vmx__ops_8h.html#adefc7dc8e1885fe973b3e8d58e23e0aa" title=" " alt="" coords="409,5,505,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_acffc6d01ff543c9abee613b5fe1b1bd4_icgraph.png" border="0" usemap="#avmx_8h_acffc6d01ff543c9abee613b5fe1b1bd4_icgraph" alt=""/></div>
<map name="avmx_8h_acffc6d01ff543c9abee613b5fe1b1bd4_icgraph" id="avmx_8h_acffc6d01ff543c9abee613b5fe1b1bd4_icgraph">
<area shape="rect" title=" " alt="" coords="1411,245,1557,272"/>
<area shape="rect" href="vmx_8c.html#af92910217dcc55da03421a552d174080" title=" " alt="" coords="1209,144,1350,171"/>
<area shape="rect" href="vmx_8c.html#a7b282a828cac2d1ae55bb522a0c42c1f" title=" " alt="" coords="1196,271,1363,297"/>
<area shape="rect" href="vmx_8c.html#a4323cda8d4cdaaa4a5f9188abd36a4b7" title=" " alt="" coords="963,119,1110,145"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="707,68,869,95"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="719,119,857,145"/>
<area shape="rect" href="vmx_2nested_8c.html#ad9920ec1586ae352fbc272ed93cf7b38" title=" " alt="" coords="739,372,837,399"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,341,134,368"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="484,43,601,69"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,315,372,341"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,238,373,279"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,245,136,272"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="483,347,602,373"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,448,615,475"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,387,374,413"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,448,343,475"/>
<area shape="rect" href="vmx_2nested_8c.html#a6e7c1f08ddd44344917e3bdc534d97de" title=" " alt="" coords="925,220,1148,247"/>
<area shape="rect" href="vmx_2nested_8c.html#a5b55a1eda2dc47d6d1a238d483e6ce36" title=" " alt="" coords="965,372,1108,399"/>
<area shape="rect" href="vmx_8c.html#aa3c244b12b83c2a97122b94343131bb1" title=" " alt="" coords="975,321,1099,348"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="727,220,849,247"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="725,321,851,348"/>
<area shape="rect" href="vmx_2nested_8c.html#a5a5df09c88b5fad9a716109f9917e9a5" title=" " alt="" coords="699,169,877,196"/>
<area shape="rect" href="vmx_2nested_8c.html#ac436bd43f9cd48511bdf54c6e36fd31d" title=" " alt="" coords="703,271,873,297"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="479,93,606,120"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="481,195,605,221"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="711,601,865,628"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,601,361,628"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,397,604,424"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,499,631,541"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,850,651,891"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,803,387,829"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,565,618,606"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,799,633,825"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,682,635,723"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,601,140,628"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,499,369,541"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,507,138,533"/>
</map>
</div>

</div>
</div>
<a id="ac4ef65eed70b84eba92be5567feebf84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4ef65eed70b84eba92be5567feebf84">&#9670;&nbsp;</a></span>pt_update_intercept_for_msr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pt_update_intercept_for_msr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l04098">4098</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;{</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;    <span class="keywordtype">bool</span> flag = !(vmx-&gt;<a class="code" href="structvcpu__vmx.html#a44aacd4dfbe67cb7cc9fe90f3cce114a">pt_desc</a>.<a class="code" href="structpt__desc.html#afc5f99621d219cd3884d6e9756b8c9cd">guest</a>.<a class="code" href="structpt__ctx.html#a16f90cac66284ec351284964a4a74956">ctl</a> &amp; RTIT_CTL_TRACEEN);</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;    u32 i;</div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160; </div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;    <a class="code" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20">vmx_set_intercept_for_msr</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, MSR_IA32_RTIT_STATUS, <a class="code" href="vmx_8h.html#a511b7b2ce3b986ba2ed692fbc0f79bbc">MSR_TYPE_RW</a>, flag);</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;    <a class="code" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20">vmx_set_intercept_for_msr</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, MSR_IA32_RTIT_OUTPUT_BASE, <a class="code" href="vmx_8h.html#a511b7b2ce3b986ba2ed692fbc0f79bbc">MSR_TYPE_RW</a>, flag);</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;    <a class="code" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20">vmx_set_intercept_for_msr</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, MSR_IA32_RTIT_OUTPUT_MASK, <a class="code" href="vmx_8h.html#a511b7b2ce3b986ba2ed692fbc0f79bbc">MSR_TYPE_RW</a>, flag);</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;    <a class="code" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20">vmx_set_intercept_for_msr</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, MSR_IA32_RTIT_CR3_MATCH, <a class="code" href="vmx_8h.html#a511b7b2ce3b986ba2ed692fbc0f79bbc">MSR_TYPE_RW</a>, flag);</div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; vmx-&gt;<a class="code" href="structvcpu__vmx.html#a44aacd4dfbe67cb7cc9fe90f3cce114a">pt_desc</a>.<a class="code" href="structpt__desc.html#afe579149e7e1cc07b7a7247e5ac083f6">num_address_ranges</a>; i++) {</div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;        <a class="code" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20">vmx_set_intercept_for_msr</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, MSR_IA32_RTIT_ADDR0_A + i * 2, <a class="code" href="vmx_8h.html#a511b7b2ce3b986ba2ed692fbc0f79bbc">MSR_TYPE_RW</a>, flag);</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;        <a class="code" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20">vmx_set_intercept_for_msr</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, MSR_IA32_RTIT_ADDR0_B + i * 2, <a class="code" href="vmx_8h.html#a511b7b2ce3b986ba2ed692fbc0f79bbc">MSR_TYPE_RW</a>, flag);</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;    }</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;}</div>
<div class="ttc" id="astructpt__ctx_html_a16f90cac66284ec351284964a4a74956"><div class="ttname"><a href="structpt__ctx.html#a16f90cac66284ec351284964a4a74956">pt_ctx::ctl</a></div><div class="ttdeci">u64 ctl</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00056">vmx.h:56</a></div></div>
<div class="ttc" id="astructpt__desc_html_afc5f99621d219cd3884d6e9756b8c9cd"><div class="ttname"><a href="structpt__desc.html#afc5f99621d219cd3884d6e9756b8c9cd">pt_desc::guest</a></div><div class="ttdeci">struct pt_ctx guest</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00068">vmx.h:70</a></div></div>
<div class="ttc" id="astructpt__desc_html_afe579149e7e1cc07b7a7247e5ac083f6"><div class="ttname"><a href="structpt__desc.html#afe579149e7e1cc07b7a7247e5ac083f6">pt_desc::num_address_ranges</a></div><div class="ttdeci">u32 num_address_ranges</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00067">vmx.h:67</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_a44aacd4dfbe67cb7cc9fe90f3cce114a"><div class="ttname"><a href="structvcpu__vmx.html#a44aacd4dfbe67cb7cc9fe90f3cce114a">vcpu_vmx::pt_desc</a></div><div class="ttdeci">struct pt_desc pt_desc</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00356">vmx.h:358</a></div></div>
<div class="ttc" id="avmx_8h_html_a511b7b2ce3b986ba2ed692fbc0f79bbc"><div class="ttname"><a href="vmx_8h.html#a511b7b2ce3b986ba2ed692fbc0f79bbc">MSR_TYPE_RW</a></div><div class="ttdeci">#define MSR_TYPE_RW</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00021">vmx.h:21</a></div></div>
<div class="ttc" id="avmx_8h_html_a5f203a8d867ee0e3830ee06de5fbea20"><div class="ttname"><a href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20">vmx_set_intercept_for_msr</a></div><div class="ttdeci">static void vmx_set_intercept_for_msr(struct kvm_vcpu *vcpu, u32 msr, int type, bool value)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00427">vmx.h:427</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ac4ef65eed70b84eba92be5567feebf84_cgraph.png" border="0" usemap="#avmx_8h_ac4ef65eed70b84eba92be5567feebf84_cgraph" alt=""/></div>
<map name="avmx_8h_ac4ef65eed70b84eba92be5567feebf84_cgraph" id="avmx_8h_ac4ef65eed70b84eba92be5567feebf84_cgraph">
<area shape="rect" title=" " alt="" coords="5,67,157,109"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="735,5,805,32"/>
<area shape="rect" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20" title=" " alt="" coords="205,104,405,131"/>
<area shape="rect" href="vmx_8h.html#a96f48e7f7fd7a33ba502bea65d7a94d8" title=" " alt="" coords="453,162,624,203"/>
<area shape="rect" href="vmx_8h.html#a3db9d3d67497234d969c753d0b1093ab" title=" " alt="" coords="455,97,622,138"/>
<area shape="rect" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b" title=" " alt="" coords="672,224,868,251"/>
<area shape="rect" href="vmx_8c.html#a5742d1df3fb94e98dd1a0f0443b529a4" title=" " alt="" coords="675,107,865,133"/>
<area shape="rect" href="vmx_8c.html#aa4973cf70be6e2559648a74eab4987a5" title=" " alt="" coords="916,99,1079,141"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="699,325,841,352"/>
<area shape="rect" href="vmx_8c.html#a4322412ccf65775174621cab858dd234" title=" " alt="" coords="689,158,851,199"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="917,165,1078,192"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ac4ef65eed70b84eba92be5567feebf84_icgraph.png" border="0" usemap="#avmx_8h_ac4ef65eed70b84eba92be5567feebf84_icgraph" alt=""/></div>
<map name="avmx_8h_ac4ef65eed70b84eba92be5567feebf84_icgraph" id="avmx_8h_ac4ef65eed70b84eba92be5567feebf84_icgraph">
<area shape="rect" title=" " alt="" coords="847,81,999,123"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="627,38,788,65"/>
<area shape="rect" href="vmx_8c.html#a198d25dc5afdf259e877818b94cb5e1b" title=" " alt="" coords="616,89,799,115"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="652,139,763,166"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="425,13,542,39"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="399,63,568,90"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,5,351,47"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,13,132,39"/>
</map>
</div>

</div>
</div>
<a id="a7f870aba1430166e5fc5609b4c71de1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f870aba1430166e5fc5609b4c71de1a">&#9670;&nbsp;</a></span>set_cr4_guest_host_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_cr4_guest_host_mask </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *&#160;</td>
          <td class="paramname"><em>vmx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l04363">4363</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;{</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = &amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>;</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160; </div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;    vcpu-&gt;arch.cr4_guest_owned_bits = <a class="code" href="kvm__cache__regs_8h.html#a37a4ebdba5e6c0d9438a0976d5261d36">KVM_POSSIBLE_CR4_GUEST_BITS</a> &amp;</div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;                      ~vcpu-&gt;arch.cr4_guest_rsvd_bits;</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#abf08136dbf993f207b5536a18082c6ed">enable_ept</a>) {</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;        vcpu-&gt;arch.cr4_guest_owned_bits &amp;= ~<a class="code" href="kvm__cache__regs_8h.html#a92ee07ace210c902c7bae486f7d6648e">X86_CR4_TLBFLUSH_BITS</a>;</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;        vcpu-&gt;arch.cr4_guest_owned_bits &amp;= ~<a class="code" href="kvm__cache__regs_8h.html#a0e6e0eaac8d276d26fb9beb7d9839bff">X86_CR4_PDPTR_BITS</a>;</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;    }</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(&amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>))</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;        vcpu-&gt;arch.cr4_guest_owned_bits &amp;=</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;            ~<a class="code" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497">get_vmcs12</a>(vcpu)-&gt;<a class="code" href="structvmcs12.html#ace2f595e50717b4f5d11b6310f87167f">cr4_guest_host_mask</a>;</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(CR4_GUEST_HOST_MASK, ~vcpu-&gt;arch.cr4_guest_owned_bits);</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_a0e6e0eaac8d276d26fb9beb7d9839bff"><div class="ttname"><a href="kvm__cache__regs_8h.html#a0e6e0eaac8d276d26fb9beb7d9839bff">X86_CR4_PDPTR_BITS</a></div><div class="ttdeci">#define X86_CR4_PDPTR_BITS</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00014">kvm_cache_regs.h:14</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_a37a4ebdba5e6c0d9438a0976d5261d36"><div class="ttname"><a href="kvm__cache__regs_8h.html#a37a4ebdba5e6c0d9438a0976d5261d36">KVM_POSSIBLE_CR4_GUEST_BITS</a></div><div class="ttdeci">#define KVM_POSSIBLE_CR4_GUEST_BITS</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00008">kvm_cache_regs.h:8</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_a92ee07ace210c902c7bae486f7d6648e"><div class="ttname"><a href="kvm__cache__regs_8h.html#a92ee07ace210c902c7bae486f7d6648e">X86_CR4_TLBFLUSH_BITS</a></div><div class="ttdeci">#define X86_CR4_TLBFLUSH_BITS</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00013">kvm_cache_regs.h:13</a></div></div>
<div class="ttc" id="anested_8h_html_a65c62b59f6be374d9da24feaef363497"><div class="ttname"><a href="nested_8h.html#a65c62b59f6be374d9da24feaef363497">get_vmcs12</a></div><div class="ttdeci">static struct vmcs12 * get_vmcs12(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="nested_8h_source.html#l00040">nested.h:40</a></div></div>
<div class="ttc" id="astructvmcs12_html_ace2f595e50717b4f5d11b6310f87167f"><div class="ttname"><a href="structvmcs12.html#ace2f595e50717b4f5d11b6310f87167f">vmcs12::cr4_guest_host_mask</a></div><div class="ttdeci">natural_width cr4_guest_host_mask</div><div class="ttdef"><b>Definition:</b> <a href="vmcs12_8h_source.html#l00082">vmcs12.h:82</a></div></div>
<div class="ttc" id="avmx_8c_html_abf08136dbf993f207b5536a18082c6ed"><div class="ttname"><a href="vmx_8c.html#abf08136dbf993f207b5536a18082c6ed">enable_ept</a></div><div class="ttdeci">bool __read_mostly enable_ept</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00091">vmx.c:91</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a7f870aba1430166e5fc5609b4c71de1a_cgraph.png" border="0" usemap="#avmx_8h_a7f870aba1430166e5fc5609b4c71de1a_cgraph" alt=""/></div>
<map name="avmx_8h_a7f870aba1430166e5fc5609b4c71de1a_cgraph" id="avmx_8h_a7f870aba1430166e5fc5609b4c71de1a_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,196,83"/>
<area shape="rect" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497" title=" " alt="" coords="253,5,355,32"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="244,56,364,83"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="253,107,355,133"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="457,5,528,32"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="435,56,550,83"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="432,107,553,133"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="412,157,573,184"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="439,208,546,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a7f870aba1430166e5fc5609b4c71de1a_icgraph.png" border="0" usemap="#avmx_8h_a7f870aba1430166e5fc5609b4c71de1a_icgraph" alt=""/></div>
<map name="avmx_8h_a7f870aba1430166e5fc5609b4c71de1a_icgraph" id="avmx_8h_a7f870aba1430166e5fc5609b4c71de1a_icgraph">
<area shape="rect" title=" " alt="" coords="584,56,775,83"/>
<area shape="rect" href="vmx_8c.html#ad9c0f9053e0fe647a367166a4b6a0c6f" title=" " alt="" coords="412,5,497,32"/>
<area shape="rect" href="vmx_2nested_8c.html#aa9419b385a2c58c246195d3106c57afc" title=" " alt="" coords="373,56,536,83"/>
<area shape="rect" href="vmx_8c.html#a8ff77baa2f28fd717210bcac02a13434" title=" " alt="" coords="378,107,531,149"/>
<area shape="rect" href="vmx_8c.html#abd63cf398d1b18c9be4e9c4eae17c64c" title=" " alt="" coords="183,5,325,32"/>
<area shape="rect" href="vmx_8c.html#a8d0fa5e317cbd0eb67ebdc9fa5ec70ce" title=" " alt="" coords="5,5,135,32"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="189,56,319,83"/>
</map>
</div>

</div>
</div>
<a id="a0100af676b8116ac3f8cc0ba1ed54f4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0100af676b8116ac3f8cc0ba1ed54f4c">&#9670;&nbsp;</a></span>to_kvm_vmx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __always_inline struct <a class="el" href="structkvm__vmx.html">kvm_vmx</a>* to_kvm_vmx </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00652">652</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;{</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">return</span> container_of(kvm, <span class="keyword">struct</span> <a class="code" href="structkvm__vmx.html">kvm_vmx</a>, kvm);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;}</div>
<div class="ttc" id="astructkvm__vmx_html"><div class="ttname"><a href="structkvm__vmx.html">kvm_vmx</a></div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00369">vmx.h:369</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a0100af676b8116ac3f8cc0ba1ed54f4c_icgraph.png" border="0" usemap="#avmx_8h_a0100af676b8116ac3f8cc0ba1ed54f4c_icgraph" alt=""/></div>
<map name="avmx_8h_a0100af676b8116ac3f8cc0ba1ed54f4c_icgraph" id="avmx_8h_a0100af676b8116ac3f8cc0ba1ed54f4c_icgraph">
<area shape="rect" title=" " alt="" coords="1581,692,1688,719"/>
<area shape="rect" href="vmx_8c.html#ac744bdcb0b42778132eaeb180e29e70c" title=" " alt="" coords="1377,436,1483,463"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1337,515,1523,541"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="1137,540,1274,567"/>
<area shape="rect" href="vmx_8c.html#ad9c0f9053e0fe647a367166a4b6a0c6f" title=" " alt="" coords="1387,616,1473,643"/>
<area shape="rect" href="vmx_8c.html#aedc92a1ef6b997475c61b81f64db8033" title=" " alt="" coords="1132,677,1279,718"/>
<area shape="rect" href="vmx_8c.html#a393561ca276a555871b2d0aa15f61a9f" title=" " alt="" coords="1337,717,1523,744"/>
<area shape="rect" href="vmx_8c.html#a4f9929c7344531daf129668422c68561" title=" " alt="" coords="1138,751,1273,777"/>
<area shape="rect" href="vmx_8c.html#a074416f44b1e2949a96f85e0579c8aeb" title=" " alt="" coords="1351,819,1509,845"/>
<area shape="rect" href="vmx_8c.html#a5fb828ef1ffa8c6dcc1fdcbfc93996a9" title=" " alt="" coords="1327,869,1533,896"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1360,920,1500,947"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1153,421,1258,448"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,415,1084,441"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,461,138,488"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,345,1070,386"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,348,853,375"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,161,361,188"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,224,604,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,275,631,317"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,341,651,382"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,392,387,419"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,158,618,199"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,457,633,484"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,509,635,550"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,56,615,83"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,161,140,188"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,217,373,258"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,224,136,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,311,369,353"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,107,374,133"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,5,343,32"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,56,372,83"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,107,134,133"/>
<area shape="rect" href="vmx_8c.html#abd63cf398d1b18c9be4e9c4eae17c64c" title=" " alt="" coords="1134,620,1277,647"/>
<area shape="rect" href="vmx_8c.html#a8d0fa5e317cbd0eb67ebdc9fa5ec70ce" title=" " alt="" coords="928,625,1057,652"/>
<area shape="rect" href="vmx_8c.html#a5d63548e346674b73fdb02207add458b" title=" " alt="" coords="913,684,1072,711"/>
</map>
</div>

</div>
</div>
<a id="a6e0cb34c77519a9be4432b4dd4ec11b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e0cb34c77519a9be4432b4dd4ec11b4">&#9670;&nbsp;</a></span>to_vmx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __always_inline struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a>* to_vmx </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00657">657</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;{</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">return</span> container_of(vcpu, <span class="keyword">struct</span> <a class="code" href="structvcpu__vmx.html">vcpu_vmx</a>, vcpu);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3f9a4735e6ff00497c0086664b433bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3f9a4735e6ff00497c0086664b433bd">&#9670;&nbsp;</a></span>vcpu_to_lbr_desc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlbr__desc.html">lbr_desc</a>* vcpu_to_lbr_desc </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00662">662</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;{</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">return</span> &amp;<a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(vcpu)-&gt;<a class="code" href="structvcpu__vmx.html#a8cf2b100797f69c29cdea2fae3892c5b">lbr_desc</a>;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;}</div>
<div class="ttc" id="astructvcpu__vmx_html_a8cf2b100797f69c29cdea2fae3892c5b"><div class="ttname"><a href="structvcpu__vmx.html#a8cf2b100797f69c29cdea2fae3892c5b">vcpu_vmx::lbr_desc</a></div><div class="ttdeci">struct lbr_desc lbr_desc</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00356">vmx.h:359</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aa3f9a4735e6ff00497c0086664b433bd_cgraph.png" border="0" usemap="#avmx_8h_aa3f9a4735e6ff00497c0086664b433bd_cgraph" alt=""/></div>
<map name="avmx_8h_aa3f9a4735e6ff00497c0086664b433bd_cgraph" id="avmx_8h_aa3f9a4735e6ff00497c0086664b433bd_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,140,32"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="188,5,259,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aa3f9a4735e6ff00497c0086664b433bd_icgraph.png" border="0" usemap="#avmx_8h_aa3f9a4735e6ff00497c0086664b433bd_icgraph" alt=""/></div>
<map name="avmx_8h_aa3f9a4735e6ff00497c0086664b433bd_icgraph" id="avmx_8h_aa3f9a4735e6ff00497c0086664b433bd_icgraph">
<area shape="rect" title=" " alt="" coords="1181,391,1316,417"/>
<area shape="rect" href="pmu__intel_8c.html#aed2f5a4c9080d0316ad30f8a74ddefcc" title=" " alt="" coords="467,29,646,70"/>
<area shape="rect" href="pmu__intel_8c.html#aa518f17a337585c3c6e12c054c2cec59" title=" " alt="" coords="219,29,382,70"/>
<area shape="rect" href="pmu__intel_8c.html#a13a3160dda511044764046bbcc2b0000" title=" " alt="" coords="983,496,1098,523"/>
<area shape="rect" href="pmu__intel_8c.html#aef55e73b4b7ac8d0841b17310fc92297" title=" " alt="" coords="971,547,1111,573"/>
<area shape="rect" href="pmu__intel_8c.html#a062c0b628c72336025d0c3b5e1f0229f" title=" " alt="" coords="948,598,1133,639"/>
<area shape="rect" href="vmx_8h.html#a499f1757999ae37f448bbadf72448fa4" title=" " alt="" coords="965,287,1117,313"/>
<area shape="rect" href="pmu__intel_8c.html#af9cb9956f1ba92178a027529a50d711d" title=" " alt="" coords="473,414,641,455"/>
<area shape="rect" href="pmu__intel_8c.html#aafa008ad34eb88ebd13aa2f76375cad2" title=" " alt="" coords="200,392,401,419"/>
<area shape="rect" href="pmu__intel_8c.html#a5f05da2ad8fa10c5a20b5c9daa506b71" title=" " alt="" coords="474,479,639,521"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="245,160,356,187"/>
<area shape="rect" href="pmu__intel_8c.html#a7bb7e7c2288534cee8bdee7f3c05126e" title=" " alt="" coords="5,61,152,88"/>
<area shape="rect" href="pmu__intel_8c.html#aa0eaa27ec4bacea0eb28d3055fb3d4b8" title=" " alt="" coords="5,11,152,37"/>
<area shape="rect" href="pmu__intel_8c.html#aa2c98072bc3b5a3932234dee0b55414b" title=" " alt="" coords="733,581,879,608"/>
<area shape="rect" href="pmu__intel_8c.html#a039eacd38753b7783645645212105d31" title=" " alt="" coords="743,632,869,659"/>
<area shape="rect" href="pmu__intel_8c.html#a8bff30f14b582aa13a6a9263d09ff44b" title=" " alt="" coords="485,94,629,135"/>
<area shape="rect" href="vmx_8h.html#aaf2d6801dce444c2f2592a0942780f59" title=" " alt="" coords="712,244,900,271"/>
<area shape="rect" href="pmu__intel_8c.html#a95acf04271d030c775698a08e8b498ff" title=" " alt="" coords="722,442,890,483"/>
<area shape="rect" href="pmu__intel_8c.html#a732847faae93b3f95f904168b42add71" title=" " alt="" coords="231,101,371,128"/>
<area shape="rect" href="pmu__intel_8c.html#aebec0fe217b3fa5a80715120eb39a341" title=" " alt="" coords="471,261,642,288"/>
<area shape="rect" href="vmx_8c.html#a906eacca38431629c007c813de2ee658" title=" " alt="" coords="449,211,664,237"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="20,337,137,364"/>
</map>
</div>

</div>
</div>
<a id="a499f1757999ae37f448bbadf72448fa4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a499f1757999ae37f448bbadf72448fa4">&#9670;&nbsp;</a></span>vcpu_to_lbr_records()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct x86_pmu_lbr* vcpu_to_lbr_records </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00667">667</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;{</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">return</span> &amp;<a class="code" href="vmx_8h.html#aa3f9a4735e6ff00497c0086664b433bd">vcpu_to_lbr_desc</a>(vcpu)-&gt;<a class="code" href="structlbr__desc.html#a3eaee29364926d159894dcfd81cca7d9">records</a>;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;}</div>
<div class="ttc" id="astructlbr__desc_html_a3eaee29364926d159894dcfd81cca7d9"><div class="ttname"><a href="structlbr__desc.html#a3eaee29364926d159894dcfd81cca7d9">lbr_desc::records</a></div><div class="ttdeci">struct x86_pmu_lbr records</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00091">vmx.h:98</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a499f1757999ae37f448bbadf72448fa4_cgraph.png" border="0" usemap="#avmx_8h_a499f1757999ae37f448bbadf72448fa4_cgraph" alt=""/></div>
<map name="avmx_8h_a499f1757999ae37f448bbadf72448fa4_cgraph" id="avmx_8h_a499f1757999ae37f448bbadf72448fa4_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,157,32"/>
<area shape="rect" href="vmx_8h.html#aa3f9a4735e6ff00497c0086664b433bd" title=" " alt="" coords="205,5,340,32"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="388,5,459,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a499f1757999ae37f448bbadf72448fa4_icgraph.png" border="0" usemap="#avmx_8h_a499f1757999ae37f448bbadf72448fa4_icgraph" alt=""/></div>
<map name="avmx_8h_a499f1757999ae37f448bbadf72448fa4_icgraph" id="avmx_8h_a499f1757999ae37f448bbadf72448fa4_icgraph">
<area shape="rect" title=" " alt="" coords="948,129,1100,156"/>
<area shape="rect" href="pmu__intel_8c.html#a8bff30f14b582aa13a6a9263d09ff44b" title=" " alt="" coords="485,13,629,54"/>
<area shape="rect" href="vmx_8h.html#aaf2d6801dce444c2f2592a0942780f59" title=" " alt="" coords="712,129,900,156"/>
<area shape="rect" href="pmu__intel_8c.html#a95acf04271d030c775698a08e8b498ff" title=" " alt="" coords="722,282,890,323"/>
<area shape="rect" href="pmu__intel_8c.html#a732847faae93b3f95f904168b42add71" title=" " alt="" coords="231,5,371,32"/>
<area shape="rect" href="pmu__intel_8c.html#aa518f17a337585c3c6e12c054c2cec59" title=" " alt="" coords="219,57,382,98"/>
<area shape="rect" href="pmu__intel_8c.html#a7bb7e7c2288534cee8bdee7f3c05126e" title=" " alt="" coords="5,39,152,65"/>
<area shape="rect" href="pmu__intel_8c.html#aa0eaa27ec4bacea0eb28d3055fb3d4b8" title=" " alt="" coords="5,89,152,116"/>
<area shape="rect" href="pmu__intel_8c.html#aebec0fe217b3fa5a80715120eb39a341" title=" " alt="" coords="471,79,642,105"/>
<area shape="rect" href="vmx_8c.html#a906eacca38431629c007c813de2ee658" title=" " alt="" coords="449,129,664,156"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="245,144,356,171"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="20,260,137,287"/>
<area shape="rect" href="pmu__intel_8c.html#af9cb9956f1ba92178a027529a50d711d" title=" " alt="" coords="473,282,641,323"/>
<area shape="rect" href="pmu__intel_8c.html#a5f05da2ad8fa10c5a20b5c9daa506b71" title=" " alt="" coords="474,347,639,389"/>
<area shape="rect" href="pmu__intel_8c.html#aafa008ad34eb88ebd13aa2f76375cad2" title=" " alt="" coords="200,289,401,316"/>
</map>
</div>

</div>
</div>
<a id="a1f6186445deafb0e6b3f6ffa22db11ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f6186445deafb0e6b3f6ffa22db11ef">&#9670;&nbsp;</a></span>vmx_can_use_ipiv()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool vmx_can_use_ipiv </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00747">747</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;{</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">return</span>  <a class="code" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4">lapic_in_kernel</a>(vcpu) &amp;&amp; <a class="code" href="capabilities_8h.html#ad548c85ff0f645533698fc5a597b63dc">enable_ipiv</a>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;}</div>
<div class="ttc" id="acapabilities_8h_html_ad548c85ff0f645533698fc5a597b63dc"><div class="ttname"><a href="capabilities_8h.html#ad548c85ff0f645533698fc5a597b63dc">enable_ipiv</a></div><div class="ttdeci">bool __read_mostly enable_ipiv</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00109">vmx.c:109</a></div></div>
<div class="ttc" id="alapic_8h_html_a1d8c9378fcbf62390a89dc3b7f0bdbd4"><div class="ttname"><a href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4">lapic_in_kernel</a></div><div class="ttdeci">static bool lapic_in_kernel(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00186">lapic.h:186</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a1f6186445deafb0e6b3f6ffa22db11ef_cgraph.png" border="0" usemap="#avmx_8h_a1f6186445deafb0e6b3f6ffa22db11ef_cgraph" alt=""/></div>
<map name="avmx_8h_a1f6186445deafb0e6b3f6ffa22db11ef_cgraph" id="avmx_8h_a1f6186445deafb0e6b3f6ffa22db11ef_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,148,32"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="196,5,315,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a1f6186445deafb0e6b3f6ffa22db11ef_icgraph.png" border="0" usemap="#avmx_8h_a1f6186445deafb0e6b3f6ffa22db11ef_icgraph" alt=""/></div>
<map name="avmx_8h_a1f6186445deafb0e6b3f6ffa22db11ef_icgraph" id="avmx_8h_a1f6186445deafb0e6b3f6ffa22db11ef_icgraph">
<area shape="rect" title=" " alt="" coords="595,56,737,83"/>
<area shape="rect" href="vmx_8c.html#ad9c0f9053e0fe647a367166a4b6a0c6f" title=" " alt="" coords="417,5,503,32"/>
<area shape="rect" href="posted__intr_8c.html#a1ac88cefc219cac7155a9b532ce5ace3" title=" " alt="" coords="373,56,547,83"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="391,107,529,133"/>
<area shape="rect" href="vmx_8c.html#abd63cf398d1b18c9be4e9c4eae17c64c" title=" " alt="" coords="183,5,325,32"/>
<area shape="rect" href="vmx_8c.html#a8d0fa5e317cbd0eb67ebdc9fa5ec70ce" title=" " alt="" coords="5,5,135,32"/>
<area shape="rect" href="posted__intr_8c.html#aa59b00f36d985abaa19009096d1f66a4" title=" " alt="" coords="186,56,322,83"/>
<area shape="rect" href="vmx_8c.html#a65248f7343c2ee3dfdfeb6388e80ab9b" title=" " alt="" coords="11,56,129,83"/>
</map>
</div>

</div>
</div>
<a id="a96f48e7f7fd7a33ba502bea65d7a94d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96f48e7f7fd7a33ba502bea65d7a94d8">&#9670;&nbsp;</a></span>vmx_disable_intercept_for_msr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_disable_intercept_for_msr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>msr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03962">3962</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;{</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *msr_bitmap = vmx-&gt;<a class="code" href="structvcpu__vmx.html#a5696a2167411da0ab4c04f1300baf285">vmcs01</a>.<a class="code" href="structloaded__vmcs.html#a5553ab2c0ac0996950eeba41ec05a48f">msr_bitmap</a>;</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160; </div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b">cpu_has_vmx_msr_bitmap</a>())</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160; </div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;    <a class="code" href="vmx_8c.html#a4322412ccf65775174621cab858dd234">vmx_msr_bitmap_l01_changed</a>(vmx);</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160; </div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;<span class="comment">     * Mark the desired intercept state in shadow bitmap, this is needed</span></div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;<span class="comment">     * for resync when the MSR filters change.</span></div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx_8c.html#a5742d1df3fb94e98dd1a0f0443b529a4">is_valid_passthrough_msr</a>(msr)) {</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;        <span class="keywordtype">int</span> idx = <a class="code" href="vmx_8c.html#aa4973cf70be6e2559648a74eab4987a5">possible_passthrough_msr_slot</a>(msr);</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160; </div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;        <span class="keywordflow">if</span> (idx != -ENOENT) {</div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;            <span class="keywordflow">if</span> (type &amp; <a class="code" href="vmx_8h.html#a2c8d9fefd4a15747f3f7f38c15ec6919">MSR_TYPE_R</a>)</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;                clear_bit(idx, vmx-&gt;<a class="code" href="structvcpu__vmx.html#aad9b013410934e0db330f0b3887db295">shadow_msr_intercept</a>.read);</div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;            <span class="keywordflow">if</span> (type &amp; <a class="code" href="vmx_8h.html#ab1ba03357f1a299c69fbaf2c5a9d9e96">MSR_TYPE_W</a>)</div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;                clear_bit(idx, vmx-&gt;<a class="code" href="structvcpu__vmx.html#aad9b013410934e0db330f0b3887db295">shadow_msr_intercept</a>.write);</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;        }</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;    }</div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160; </div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;    <span class="keywordflow">if</span> ((type &amp; <a class="code" href="vmx_8h.html#a2c8d9fefd4a15747f3f7f38c15ec6919">MSR_TYPE_R</a>) &amp;&amp;</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;        !<a class="code" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940">kvm_msr_allowed</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, msr, KVM_MSR_FILTER_READ)) {</div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;        vmx_set_msr_bitmap_read(msr_bitmap, msr);</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;        type &amp;= ~<a class="code" href="vmx_8h.html#a2c8d9fefd4a15747f3f7f38c15ec6919">MSR_TYPE_R</a>;</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;    }</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160; </div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;    <span class="keywordflow">if</span> ((type &amp; <a class="code" href="vmx_8h.html#ab1ba03357f1a299c69fbaf2c5a9d9e96">MSR_TYPE_W</a>) &amp;&amp;</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;        !<a class="code" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940">kvm_msr_allowed</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, msr, KVM_MSR_FILTER_WRITE)) {</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;        vmx_set_msr_bitmap_write(msr_bitmap, msr);</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;        type &amp;= ~<a class="code" href="vmx_8h.html#ab1ba03357f1a299c69fbaf2c5a9d9e96">MSR_TYPE_W</a>;</div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;    }</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160; </div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;    <span class="keywordflow">if</span> (type &amp; <a class="code" href="vmx_8h.html#a2c8d9fefd4a15747f3f7f38c15ec6919">MSR_TYPE_R</a>)</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;        vmx_clear_msr_bitmap_read(msr_bitmap, msr);</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160; </div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    <span class="keywordflow">if</span> (type &amp; <a class="code" href="vmx_8h.html#ab1ba03357f1a299c69fbaf2c5a9d9e96">MSR_TYPE_W</a>)</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;        vmx_clear_msr_bitmap_write(msr_bitmap, msr);</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;}</div>
<div class="ttc" id="astructvcpu__vmx_html_a5696a2167411da0ab4c04f1300baf285"><div class="ttname"><a href="structvcpu__vmx.html#a5696a2167411da0ab4c04f1300baf285">vcpu_vmx::vmcs01</a></div><div class="ttdeci">struct loaded_vmcs vmcs01</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00284">vmx.h:291</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_aad9b013410934e0db330f0b3887db295"><div class="ttname"><a href="structvcpu__vmx.html#aad9b013410934e0db330f0b3887db295">vcpu_vmx::shadow_msr_intercept</a></div><div class="ttdeci">struct vcpu_vmx::@42 shadow_msr_intercept</div></div>
<div class="ttc" id="avmx_8c_html_a4322412ccf65775174621cab858dd234"><div class="ttname"><a href="vmx_8c.html#a4322412ccf65775174621cab858dd234">vmx_msr_bitmap_l01_changed</a></div><div class="ttdeci">static void vmx_msr_bitmap_l01_changed(struct vcpu_vmx *vmx)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03944">vmx.c:3944</a></div></div>
<div class="ttc" id="avmx_8c_html_a5742d1df3fb94e98dd1a0f0443b529a4"><div class="ttname"><a href="vmx_8c.html#a5742d1df3fb94e98dd1a0f0443b529a4">is_valid_passthrough_msr</a></div><div class="ttdeci">static bool is_valid_passthrough_msr(u32 msr)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00681">vmx.c:681</a></div></div>
<div class="ttc" id="avmx_8c_html_aa4973cf70be6e2559648a74eab4987a5"><div class="ttname"><a href="vmx_8c.html#aa4973cf70be6e2559648a74eab4987a5">possible_passthrough_msr_slot</a></div><div class="ttdeci">static int possible_passthrough_msr_slot(u32 msr)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00670">vmx.c:670</a></div></div>
<div class="ttc" id="avmx_8h_html_a2c8d9fefd4a15747f3f7f38c15ec6919"><div class="ttname"><a href="vmx_8h.html#a2c8d9fefd4a15747f3f7f38c15ec6919">MSR_TYPE_R</a></div><div class="ttdeci">#define MSR_TYPE_R</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00019">vmx.h:19</a></div></div>
<div class="ttc" id="avmx_8h_html_ab1ba03357f1a299c69fbaf2c5a9d9e96"><div class="ttname"><a href="vmx_8h.html#ab1ba03357f1a299c69fbaf2c5a9d9e96">MSR_TYPE_W</a></div><div class="ttdeci">#define MSR_TYPE_W</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00020">vmx.h:20</a></div></div>
<div class="ttc" id="ax86_8c_html_aea310c0e4f695bd1c6b5d96aa1dbd940"><div class="ttname"><a href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940">kvm_msr_allowed</a></div><div class="ttdeci">bool kvm_msr_allowed(struct kvm_vcpu *vcpu, u32 index, u32 type)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l01796">x86.c:1796</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a96f48e7f7fd7a33ba502bea65d7a94d8_cgraph.png" border="0" usemap="#avmx_8h_a96f48e7f7fd7a33ba502bea65d7a94d8_cgraph" alt=""/></div>
<map name="avmx_8h_a96f48e7f7fd7a33ba502bea65d7a94d8_cgraph" id="avmx_8h_a96f48e7f7fd7a33ba502bea65d7a94d8_cgraph">
<area shape="rect" title=" " alt="" coords="5,125,176,166"/>
<area shape="rect" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b" title=" " alt="" coords="224,5,420,32"/>
<area shape="rect" href="vmx_8c.html#a5742d1df3fb94e98dd1a0f0443b529a4" title=" " alt="" coords="227,56,417,83"/>
<area shape="rect" href="vmx_8c.html#aa4973cf70be6e2559648a74eab4987a5" title=" " alt="" coords="468,74,631,115"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="251,157,393,184"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="287,208,357,235"/>
<area shape="rect" href="vmx_8c.html#a4322412ccf65775174621cab858dd234" title=" " alt="" coords="241,259,403,301"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="469,267,630,293"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a96f48e7f7fd7a33ba502bea65d7a94d8_icgraph.png" border="0" usemap="#avmx_8h_a96f48e7f7fd7a33ba502bea65d7a94d8_icgraph" alt=""/></div>
<map name="avmx_8h_a96f48e7f7fd7a33ba502bea65d7a94d8_icgraph" id="avmx_8h_a96f48e7f7fd7a33ba502bea65d7a94d8_icgraph">
<area shape="rect" title=" " alt="" coords="1691,567,1861,608"/>
<area shape="rect" href="vmx_8c.html#a198d25dc5afdf259e877818b94cb5e1b" title=" " alt="" coords="708,490,891,517"/>
<area shape="rect" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20" title=" " alt="" coords="1443,574,1643,601"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,625,343,651"/>
<area shape="rect" href="vmx_8c.html#a60eaab2d29aa87878b8dd9b43dadb779" title=" " alt="" coords="1207,420,1395,461"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="1474,785,1611,811"/>
<area shape="rect" href="vmx_8c.html#ac4ef65eed70b84eba92be5567feebf84" title=" " alt="" coords="977,537,1129,579"/>
<area shape="rect" href="pmu__intel_8c.html#a95acf04271d030c775698a08e8b498ff" title=" " alt="" coords="1217,655,1385,696"/>
<area shape="rect" href="vmx_8c.html#a8ff77baa2f28fd717210bcac02a13434" title=" " alt="" coords="1224,537,1377,579"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="719,545,880,571"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="484,473,601,499"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,574,372,601"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,352,373,393"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,359,136,386"/>
<area shape="rect" href="pmu__intel_8c.html#af9cb9956f1ba92178a027529a50d711d" title=" " alt="" coords="969,668,1137,709"/>
<area shape="rect" href="pmu__intel_8c.html#a5f05da2ad8fa10c5a20b5c9daa506b71" title=" " alt="" coords="971,603,1136,644"/>
<area shape="rect" href="pmu__intel_8c.html#aafa008ad34eb88ebd13aa2f76375cad2" title=" " alt="" coords="699,675,900,702"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="484,675,601,702"/>
<area shape="rect" href="vmx_8c.html#a19fa2c2eb871655a497c1c0c73bd0553" title=" " alt="" coords="948,377,1159,403"/>
<area shape="rect" href="vmx_8c.html#a3f6e91eedb4d7eefd8f4007389aaac7b" title=" " alt="" coords="951,427,1156,454"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="722,279,877,306"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,42,361,69"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,305,604,331"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,123,631,164"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,188,651,229"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,225,387,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,5,618,47"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,355,633,382"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,407,635,448"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,523,615,550"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,42,140,69"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,123,369,164"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,130,138,157"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,523,374,550"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,523,134,550"/>
</map>
</div>

</div>
</div>
<a id="a3227ce57b73a94120917f2065d22b6b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3227ce57b73a94120917f2065d22b6b5">&#9670;&nbsp;</a></span>vmx_emulation_required()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool vmx_emulation_required </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01504">1504</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;{</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="vmx_8c.html#aad7688c50e1123bd4ebf72429c71bb2b">emulate_invalid_guest_state</a> &amp;&amp; !<a class="code" href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf">vmx_guest_state_valid</a>(vcpu);</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;}</div>
<div class="ttc" id="avmx_8c_html_aad7688c50e1123bd4ebf72429c71bb2b"><div class="ttname"><a href="vmx_8c.html#aad7688c50e1123bd4ebf72429c71bb2b">emulate_invalid_guest_state</a></div><div class="ttdeci">static bool __read_mostly emulate_invalid_guest_state</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00101">vmx.c:101</a></div></div>
<div class="ttc" id="avmx_8h_html_abf810bd0c2816f1b62bf2a79296358cf"><div class="ttname"><a href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf">vmx_guest_state_valid</a></div><div class="ttdeci">static bool vmx_guest_state_valid(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00735">vmx.h:735</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a3227ce57b73a94120917f2065d22b6b5_cgraph.png" border="0" usemap="#avmx_8h_a3227ce57b73a94120917f2065d22b6b5_cgraph" alt=""/></div>
<map name="avmx_8h_a3227ce57b73a94120917f2065d22b6b5_cgraph" id="avmx_8h_a3227ce57b73a94120917f2065d22b6b5_cgraph">
<area shape="rect" title=" " alt="" coords="5,411,191,437"/>
<area shape="rect" href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf" title=" " alt="" coords="239,411,412,437"/>
<area shape="rect" href="vmx_8h.html#a77b0ca4dac426b317965746a6bec345e" title=" " alt="" coords="460,284,647,311"/>
<area shape="rect" href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec" title=" " alt="" coords="473,512,634,539"/>
<area shape="rect" href="vmx_8c.html#a53b41b0e13efa39a027845ff9af21ed6" title=" " alt="" coords="700,360,856,387"/>
<area shape="rect" href="vmx_8c.html#ad56726eeac472ac5b038651ccffbb6f4" title=" " alt="" coords="715,411,841,437"/>
<area shape="rect" href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d" title=" " alt="" coords="701,461,855,488"/>
<area shape="rect" href="x86_8h.html#a134b4e55e4ea92a3519e9538f05d4e6b" title=" " alt="" coords="727,43,829,69"/>
<area shape="rect" href="vmx_8c.html#a1c712b1524bbb5ba769fb529614d5c35" title=" " alt="" coords="737,208,819,235"/>
<area shape="rect" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f" title=" " alt="" coords="695,157,861,184"/>
<area shape="rect" href="vmx_8c.html#abdb19ee07646c48c401dad49fae9c607" title=" " alt="" coords="698,259,858,285"/>
<area shape="rect" href="vmx_8c.html#ae22de32cadb09c91caa1acb52293f01f" title=" " alt="" coords="743,309,813,336"/>
<area shape="rect" href="vmx_8c.html#adf1cae1921d1492c7e06115012eb48e3" title=" " alt="" coords="931,107,1054,133"/>
<area shape="rect" href="vmx_8c.html#acfb1910d98db4bcd82dd9a96eb069ce9" title=" " alt="" coords="921,313,1064,340"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="1188,208,1259,235"/>
<area shape="rect" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977" title=" " alt="" coords="1133,376,1313,403"/>
<area shape="rect" href="vmx_8c.html#a911b88947099c0d21f8fbeca202ea30f" title=" " alt="" coords="1124,259,1323,285"/>
<area shape="rect" href="vmx_8c.html#ab9185adefc641ff428164a7fcab15c45" title=" " alt="" coords="1143,310,1303,351"/>
<area shape="rect" href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc" title=" " alt="" coords="1143,427,1303,469"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="1425,341,1535,368"/>
<area shape="rect" href="vmx_8c.html#a69771798b92b67f275b9be73a17f6353" title=" " alt="" coords="1371,212,1589,239"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="1690,416,1801,443"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="1687,315,1804,341"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="1665,365,1826,392"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="1686,264,1805,291"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="1901,391,2052,417"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="1921,441,2032,468"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1649,56,1842,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="1637,108,1853,135"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="1431,263,1529,289"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="1687,163,1804,189"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="1692,213,1799,240"/>
<area shape="rect" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7" title=" " alt="" coords="1425,435,1535,461"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a77b65dd311c34381a8508de99e9b8543" title=" " alt="" coords="1687,467,1804,493"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="1686,517,1805,544"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="919,31,1066,57"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="1407,5,1553,32"/>
<area shape="rect" href="vmx_8c.html#a0a4bc0d90ba4aa4d6e9758f35cd84261" title=" " alt="" coords="909,158,1076,199"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="718,563,838,589"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a3227ce57b73a94120917f2065d22b6b5_icgraph.png" border="0" usemap="#avmx_8h_a3227ce57b73a94120917f2065d22b6b5_icgraph" alt=""/></div>
<map name="avmx_8h_a3227ce57b73a94120917f2065d22b6b5_icgraph" id="avmx_8h_a3227ce57b73a94120917f2065d22b6b5_icgraph">
<area shape="rect" title=" " alt="" coords="1533,759,1719,785"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="1112,673,1295,700"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1361,664,1467,691"/>
<area shape="rect" href="vmx_8c.html#ae81f31c4be3384219d11e767cca4da94" title=" " alt="" coords="1353,784,1475,811"/>
<area shape="rect" href="vmx_8c.html#a9e72f6be0ed4dafcb17b8fb874a39d58" title=" " alt="" coords="1343,835,1485,861"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,368,853,395"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,265,361,292"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,509,604,536"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,327,631,369"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,393,651,434"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,429,387,456"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,262,618,303"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,43,633,69"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,94,635,135"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,160,615,187"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,265,140,292"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,781,373,822"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,788,136,815"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,327,369,369"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,335,138,361"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,211,374,237"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,109,343,136"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,160,372,187"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,211,134,237"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="905,386,1060,427"/>
<area shape="rect" href="sgx_8c.html#ad3394313e85a46c8e1bc4880ddde7fc9" title=" " alt="" coords="1132,1168,1275,1195"/>
<area shape="rect" href="vmx_2nested_8c.html#a46021f02931b3001ef00a526b56448a8" title=" " alt="" coords="1116,724,1291,751"/>
<area shape="rect" href="vmx_2nested_8c.html#aec3ff66d7b1e9086f727ebe6b9b1a0cf" title=" " alt="" coords="1122,785,1285,812"/>
<area shape="rect" href="vmx_2nested_8c.html#a3c80ece98832af9587ecff9947817449" title=" " alt="" coords="901,864,1064,891"/>
<area shape="rect" href="sgx_8c.html#a34e5ee57c3e7c3172f8ae6ed981d703d" title=" " alt="" coords="929,1168,1036,1195"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="715,661,837,688"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="713,712,839,739"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="717,763,835,789"/>
<area shape="rect" href="vmx_2nested_8c.html#a4d1da86d40e5c09521979006a05a35e4" title=" " alt="" coords="917,813,1048,840"/>
<area shape="rect" href="vmx_2nested_8c.html#add1e82c32385142c0fca04a1db8cbc3a" title=" " alt="" coords="711,611,841,637"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="719,813,833,840"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="715,864,837,891"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="713,915,839,941"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="714,965,838,992"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fecee9010894e3a1513a0924e24dd6" title=" " alt="" coords="474,560,611,587"/>
<area shape="rect" href="vmx_2nested_8c.html#a23e3de8c964e87404eea818be6f70154" title=" " alt="" coords="471,611,614,637"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="481,1067,605,1093"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="717,1016,835,1043"/>
</map>
</div>

</div>
</div>
<a id="a3db9d3d67497234d969c753d0b1093ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3db9d3d67497234d969c753d0b1093ab">&#9670;&nbsp;</a></span>vmx_enable_intercept_for_msr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_enable_intercept_for_msr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>msr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l04006">4006</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;{</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *msr_bitmap = vmx-&gt;<a class="code" href="structvcpu__vmx.html#a5696a2167411da0ab4c04f1300baf285">vmcs01</a>.<a class="code" href="structloaded__vmcs.html#a5553ab2c0ac0996950eeba41ec05a48f">msr_bitmap</a>;</div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160; </div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b">cpu_has_vmx_msr_bitmap</a>())</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160; </div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;    <a class="code" href="vmx_8c.html#a4322412ccf65775174621cab858dd234">vmx_msr_bitmap_l01_changed</a>(vmx);</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160; </div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="comment">     * Mark the desired intercept state in shadow bitmap, this is needed</span></div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="comment">     * for resync when the MSR filter changes.</span></div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx_8c.html#a5742d1df3fb94e98dd1a0f0443b529a4">is_valid_passthrough_msr</a>(msr)) {</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;        <span class="keywordtype">int</span> idx = <a class="code" href="vmx_8c.html#aa4973cf70be6e2559648a74eab4987a5">possible_passthrough_msr_slot</a>(msr);</div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160; </div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;        <span class="keywordflow">if</span> (idx != -ENOENT) {</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;            <span class="keywordflow">if</span> (type &amp; <a class="code" href="vmx_8h.html#a2c8d9fefd4a15747f3f7f38c15ec6919">MSR_TYPE_R</a>)</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;                set_bit(idx, vmx-&gt;<a class="code" href="structvcpu__vmx.html#aad9b013410934e0db330f0b3887db295">shadow_msr_intercept</a>.read);</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;            <span class="keywordflow">if</span> (type &amp; <a class="code" href="vmx_8h.html#ab1ba03357f1a299c69fbaf2c5a9d9e96">MSR_TYPE_W</a>)</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;                set_bit(idx, vmx-&gt;<a class="code" href="structvcpu__vmx.html#aad9b013410934e0db330f0b3887db295">shadow_msr_intercept</a>.write);</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;        }</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;    }</div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160; </div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;    <span class="keywordflow">if</span> (type &amp; <a class="code" href="vmx_8h.html#a2c8d9fefd4a15747f3f7f38c15ec6919">MSR_TYPE_R</a>)</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        vmx_set_msr_bitmap_read(msr_bitmap, msr);</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160; </div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;    <span class="keywordflow">if</span> (type &amp; <a class="code" href="vmx_8h.html#ab1ba03357f1a299c69fbaf2c5a9d9e96">MSR_TYPE_W</a>)</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;        vmx_set_msr_bitmap_write(msr_bitmap, msr);</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a3db9d3d67497234d969c753d0b1093ab_cgraph.png" border="0" usemap="#avmx_8h_a3db9d3d67497234d969c753d0b1093ab_cgraph" alt=""/></div>
<map name="avmx_8h_a3db9d3d67497234d969c753d0b1093ab_cgraph" id="avmx_8h_a3db9d3d67497234d969c753d0b1093ab_cgraph">
<area shape="rect" title=" " alt="" coords="5,99,172,141"/>
<area shape="rect" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b" title=" " alt="" coords="220,5,416,32"/>
<area shape="rect" href="vmx_8c.html#a5742d1df3fb94e98dd1a0f0443b529a4" title=" " alt="" coords="223,56,413,83"/>
<area shape="rect" href="vmx_8c.html#aa4973cf70be6e2559648a74eab4987a5" title=" " alt="" coords="464,74,627,115"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="283,157,353,184"/>
<area shape="rect" href="vmx_8c.html#a4322412ccf65775174621cab858dd234" title=" " alt="" coords="237,209,399,250"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="465,216,626,243"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a3db9d3d67497234d969c753d0b1093ab_icgraph.png" border="0" usemap="#avmx_8h_a3db9d3d67497234d969c753d0b1093ab_icgraph" alt=""/></div>
<map name="avmx_8h_a3db9d3d67497234d969c753d0b1093ab_icgraph" id="avmx_8h_a3db9d3d67497234d969c753d0b1093ab_icgraph">
<area shape="rect" title=" " alt="" coords="1691,533,1857,575"/>
<area shape="rect" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20" title=" " alt="" coords="1443,566,1643,593"/>
<area shape="rect" href="vmx_8c.html#a60eaab2d29aa87878b8dd9b43dadb779" title=" " alt="" coords="1207,500,1395,541"/>
<area shape="rect" href="vmx_8c.html#ac4ef65eed70b84eba92be5567feebf84" title=" " alt="" coords="977,559,1129,600"/>
<area shape="rect" href="pmu__intel_8c.html#a95acf04271d030c775698a08e8b498ff" title=" " alt="" coords="1217,620,1385,661"/>
<area shape="rect" href="vmx_8c.html#a8ff77baa2f28fd717210bcac02a13434" title=" " alt="" coords="1224,685,1377,727"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="719,625,880,651"/>
<area shape="rect" href="vmx_8c.html#a198d25dc5afdf259e877818b94cb5e1b" title=" " alt="" coords="708,574,891,601"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,478,343,505"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="484,625,601,651"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,539,372,566"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,612,373,653"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,619,136,646"/>
<area shape="rect" href="pmu__intel_8c.html#af9cb9956f1ba92178a027529a50d711d" title=" " alt="" coords="969,689,1137,731"/>
<area shape="rect" href="pmu__intel_8c.html#a5f05da2ad8fa10c5a20b5c9daa506b71" title=" " alt="" coords="971,624,1136,665"/>
<area shape="rect" href="pmu__intel_8c.html#aafa008ad34eb88ebd13aa2f76375cad2" title=" " alt="" coords="699,682,900,709"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="484,682,601,709"/>
<area shape="rect" href="vmx_8c.html#a19fa2c2eb871655a497c1c0c73bd0553" title=" " alt="" coords="948,507,1159,534"/>
<area shape="rect" href="vmx_8c.html#a3f6e91eedb4d7eefd8f4007389aaac7b" title=" " alt="" coords="951,366,1156,393"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="722,275,877,302"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,107,361,134"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,473,604,499"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,5,631,47"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,239,651,280"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,217,387,243"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,71,618,112"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,305,633,331"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,356,635,397"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,422,615,449"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,107,140,134"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,5,369,47"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,13,138,39"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,422,374,449"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,422,134,449"/>
</map>
</div>

</div>
</div>
<a id="a930d1b832fa3d556aafacb4fea12e0a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a930d1b832fa3d556aafacb4fea12e0a8">&#9670;&nbsp;</a></span>vmx_ept_load_pdptrs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_ept_load_pdptrs </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03231">3231</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;{</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;    <span class="keyword">struct </span>kvm_mmu *mmu = vcpu-&gt;arch.walk_mmu;</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160; </div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="kvm__cache__regs_8h.html#a10c4ebec1259c5e2ea91e5b321647dab">kvm_register_is_dirty</a>(vcpu, VCPU_EXREG_PDPTR))</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160; </div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="x86_8h.html#aaa36cdb43bbf6ed6af3b10deed46a436">is_pae_paging</a>(vcpu)) {</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;        <a class="code" href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3">vmcs_write64</a>(GUEST_PDPTR0, mmu-&gt;pdptrs[0]);</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        <a class="code" href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3">vmcs_write64</a>(GUEST_PDPTR1, mmu-&gt;pdptrs[1]);</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;        <a class="code" href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3">vmcs_write64</a>(GUEST_PDPTR2, mmu-&gt;pdptrs[2]);</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <a class="code" href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3">vmcs_write64</a>(GUEST_PDPTR3, mmu-&gt;pdptrs[3]);</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    }</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_a10c4ebec1259c5e2ea91e5b321647dab"><div class="ttname"><a href="kvm__cache__regs_8h.html#a10c4ebec1259c5e2ea91e5b321647dab">kvm_register_is_dirty</a></div><div class="ttdeci">static bool kvm_register_is_dirty(struct kvm_vcpu *vcpu, enum kvm_reg reg)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00059">kvm_cache_regs.h:59</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_adaa0eecfb8c7ab44b2f50999c3f65bd3"><div class="ttname"><a href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3">vmcs_write64</a></div><div class="ttdeci">static __always_inline void vmcs_write64(unsigned long field, u64 value)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00246">vmx_ops.h:246</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a930d1b832fa3d556aafacb4fea12e0a8_cgraph.png" border="0" usemap="#avmx_8h_a930d1b832fa3d556aafacb4fea12e0a8_cgraph" alt=""/></div>
<map name="avmx_8h_a930d1b832fa3d556aafacb4fea12e0a8_cgraph" id="avmx_8h_a930d1b832fa3d556aafacb4fea12e0a8_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,168,159"/>
<area shape="rect" href="x86_8h.html#aaa36cdb43bbf6ed6af3b10deed46a436" title=" " alt="" coords="240,69,355,96"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a10c4ebec1259c5e2ea91e5b321647dab" title=" " alt="" coords="216,132,379,159"/>
<area shape="rect" href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3" title=" " alt="" coords="241,208,354,235"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="451,5,563,32"/>
<area shape="rect" href="x86_8h.html#abc2ffd79aced13c24f0c4143465d3d51" title=" " alt="" coords="475,56,539,83"/>
<area shape="rect" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878" title=" " alt="" coords="465,107,549,133"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65" title=" " alt="" coords="636,56,783,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a24ffc81fe5ed7998e29134351275b4dd" title=" " alt="" coords="831,56,976,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1024,81,1217,108"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="636,107,783,133"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="831,107,976,133"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="450,157,565,184"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="447,208,568,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="427,259,588,285"/>
<area shape="rect" href="vmx__ops_8h.html#a482358473ceab579ad9c93b46e13fe25" title=" " alt="" coords="448,309,567,336"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a930d1b832fa3d556aafacb4fea12e0a8_icgraph.png" border="0" usemap="#avmx_8h_a930d1b832fa3d556aafacb4fea12e0a8_icgraph" alt=""/></div>
<map name="avmx_8h_a930d1b832fa3d556aafacb4fea12e0a8_icgraph" id="avmx_8h_a930d1b832fa3d556aafacb4fea12e0a8_icgraph">
<area shape="rect" title=" " alt="" coords="905,269,1068,295"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="701,243,855,270"/>
<area shape="rect" href="vmx_8c.html#a074416f44b1e2949a96f85e0579c8aeb" title=" " alt="" coords="699,294,857,321"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,29,361,55"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,119,604,146"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,171,631,212"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,236,651,277"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,273,387,299"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,53,618,95"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,353,633,379"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,404,635,445"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,470,615,497"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,29,140,55"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,109,373,151"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,117,136,143"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,175,369,216"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,182,138,209"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,419,374,446"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,470,343,497"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,521,372,547"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,419,134,446"/>
</map>
</div>

</div>
</div>
<a id="a07cb8535d5c63fe54c6233e78b47d6c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07cb8535d5c63fe54c6233e78b47d6c7">&#9670;&nbsp;</a></span>vmx_find_loadstore_msr_slot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vmx_find_loadstore_msr_slot </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvmx__msrs.html">vmx_msrs</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>msr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l00969">969</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;{</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; m-&gt;<a class="code" href="structvmx__msrs.html#a342e6ba12c924601827052beab0afcff">nr</a>; ++i) {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">if</span> (m-&gt;<a class="code" href="structvmx__msrs.html#ab2a7da3278820cc5bce9ac08b5b9cea4">val</a>[i].index == msr)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <span class="keywordflow">return</span> i;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    }</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;}</div>
<div class="ttc" id="astructvmx__msrs_html_a342e6ba12c924601827052beab0afcff"><div class="ttname"><a href="structvmx__msrs.html#a342e6ba12c924601827052beab0afcff">vmx_msrs::nr</a></div><div class="ttdeci">unsigned int nr</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00034">vmx.h:34</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a07cb8535d5c63fe54c6233e78b47d6c7_icgraph.png" border="0" usemap="#avmx_8h_a07cb8535d5c63fe54c6233e78b47d6c7_icgraph" alt=""/></div>
<map name="avmx_8h_a07cb8535d5c63fe54c6233e78b47d6c7_icgraph" id="avmx_8h_a07cb8535d5c63fe54c6233e78b47d6c7_icgraph">
<area shape="rect" title=" " alt="" coords="2068,243,2219,285"/>
<area shape="rect" href="vmx_8c.html#aeb316cbfe515e42e70db84117c3b4caf" title=" " alt="" coords="1813,251,1991,277"/>
<area shape="rect" href="vmx_8c.html#a98c20ad3920e3fa725a0808397b818f6" title=" " alt="" coords="1809,200,1995,227"/>
<area shape="rect" href="vmx_8c.html#ac39cca04dec7bf494bf2e19ee9f765fe" title=" " alt="" coords="725,507,827,533"/>
<area shape="rect" href="vmx_2nested_8c.html#a9e3809a89b660365a4b9bc838ca7b23f" title=" " alt="" coords="1811,302,1993,343"/>
<area shape="rect" href="vmx_2nested_8c.html#a1c217e166229d60849cc37e1ac2c8f67" title=" " alt="" coords="1784,149,2020,176"/>
<area shape="rect" href="vmx_8c.html#ae2f61d4cf1902304d2ecb05317e452f5" title=" " alt="" coords="1548,251,1736,277"/>
<area shape="rect" href="vmx_8c.html#a5bac2e04f4ca67f437e13e8badca8351" title=" " alt="" coords="1557,200,1727,227"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="1358,251,1475,277"/>
<area shape="rect" href="vmx_8c.html#a4343fdffe519a935254346af832af2c9" title=" " alt="" coords="1333,167,1500,193"/>
<area shape="rect" href="vmx_8c.html#ad9c0f9053e0fe647a367166a4b6a0c6f" title=" " alt="" coords="1166,55,1251,81"/>
<area shape="rect" href="vmx_8c.html#a346ce99d92706d6a8ffb9bb331fe768a" title=" " alt="" coords="1153,196,1264,223"/>
<area shape="rect" href="vmx_8c.html#a8ff77baa2f28fd717210bcac02a13434" title=" " alt="" coords="1132,130,1285,171"/>
<area shape="rect" href="vmx_8c.html#abd63cf398d1b18c9be4e9c4eae17c64c" title=" " alt="" coords="921,43,1064,69"/>
<area shape="rect" href="vmx_8c.html#a8d0fa5e317cbd0eb67ebdc9fa5ec70ce" title=" " alt="" coords="711,43,841,69"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,196,1084,223"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,80,138,107"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,247,1070,289"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,313,853,340"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,597,361,624"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,364,604,391"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,247,631,289"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,466,651,507"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,464,387,491"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,531,618,573"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,131,633,157"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,182,635,223"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,313,615,340"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,597,140,624"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,377,373,418"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,384,136,411"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,141,369,182"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,325,374,352"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,224,343,251"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,275,372,301"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,325,134,352"/>
<area shape="rect" href="vmx_2nested_8c.html#a8cb9490bcfa88e80bec76c0268a967e0" title=" " alt="" coords="1555,311,1729,337"/>
<area shape="rect" href="vmx_2nested_8c.html#a89a2a8ba1ff927d83a706469ef8e7214" title=" " alt="" coords="1143,312,1274,339"/>
<area shape="rect" href="vmx_2nested_8c.html#aa9419b385a2c58c246195d3106c57afc" title=" " alt="" coords="1335,55,1498,81"/>
</map>
</div>

</div>
</div>
<a id="a938b0ca5314d7ac2f8549065a4444df9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a938b0ca5314d7ac2f8549065a4444df9">&#9670;&nbsp;</a></span>vmx_find_uret_msr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structvmx__uret__msr.html">vmx_uret_msr</a>* vmx_find_uret_msr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *&#160;</td>
          <td class="paramname"><em>vmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>msr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l00713">713</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;{</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    i = <a class="code" href="x86_8c.html#a0ee58c2f580a2b01aaa9534feb15bcc8">kvm_find_user_return_msr</a>(msr);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">if</span> (i &gt;= 0)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">return</span> &amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#a194feb51e54aef61ef56078dfe5b2dae">guest_uret_msrs</a>[i];</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div>
<div class="ttc" id="astructvcpu__vmx_html_a194feb51e54aef61ef56078dfe5b2dae"><div class="ttname"><a href="structvcpu__vmx.html#a194feb51e54aef61ef56078dfe5b2dae">vcpu_vmx::guest_uret_msrs</a></div><div class="ttdeci">struct vmx_uret_msr guest_uret_msrs[MAX_NR_USER_RETURN_MSRS]</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00268">vmx.h:276</a></div></div>
<div class="ttc" id="ax86_8c_html_a0ee58c2f580a2b01aaa9534feb15bcc8"><div class="ttname"><a href="x86_8c.html#a0ee58c2f580a2b01aaa9534feb15bcc8">kvm_find_user_return_msr</a></div><div class="ttdeci">int kvm_find_user_return_msr(u32 msr)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l00416">x86.c:416</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a938b0ca5314d7ac2f8549065a4444df9_cgraph.png" border="0" usemap="#avmx_8h_a938b0ca5314d7ac2f8549065a4444df9_cgraph" alt=""/></div>
<map name="avmx_8h_a938b0ca5314d7ac2f8549065a4444df9_cgraph" id="avmx_8h_a938b0ca5314d7ac2f8549065a4444df9_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,152,32"/>
<area shape="rect" href="x86_8c.html#a0ee58c2f580a2b01aaa9534feb15bcc8" title=" " alt="" coords="200,5,395,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a938b0ca5314d7ac2f8549065a4444df9_icgraph.png" border="0" usemap="#avmx_8h_a938b0ca5314d7ac2f8549065a4444df9_icgraph" alt=""/></div>
<map name="avmx_8h_a938b0ca5314d7ac2f8549065a4444df9_icgraph" id="avmx_8h_a938b0ca5314d7ac2f8549065a4444df9_icgraph">
<area shape="rect" title=" " alt="" coords="1776,423,1923,449"/>
<area shape="rect" href="vmx_2nested_8c.html#ab69bc9b424dd50b3170a2c3a88913857" title=" " alt="" coords="1333,306,1521,347"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,24,343,51"/>
<area shape="rect" href="vmx_8c.html#ab6b2c94ee2868acf5be3ac9b3e02e441" title=" " alt="" coords="1593,524,1704,551"/>
<area shape="rect" href="vmx_8c.html#a346ce99d92706d6a8ffb9bb331fe768a" title=" " alt="" coords="1153,372,1264,399"/>
<area shape="rect" href="vmx_8c.html#a2973ee57fbdff5c4d029a8787dd3bb97" title=" " alt="" coords="1569,423,1728,449"/>
<area shape="rect" href="vmx_8c.html#a8ff77baa2f28fd717210bcac02a13434" title=" " alt="" coords="1132,474,1285,515"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="1580,575,1717,601"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,306,1070,347"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,313,853,340"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,331,361,357"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,393,604,420"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,445,631,486"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,159,651,201"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,136,387,163"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,277,618,318"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,511,633,537"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,94,635,135"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,225,615,252"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,331,140,357"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,386,373,427"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,393,136,420"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,473,369,514"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,531,138,557"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,207,374,233"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,257,372,284"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,207,134,233"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,372,1084,399"/>
<area shape="rect" href="vmx_8c.html#a4343fdffe519a935254346af832af2c9" title=" " alt="" coords="1344,423,1511,449"/>
<area shape="rect" href="vmx_8c.html#ad9c0f9053e0fe647a367166a4b6a0c6f" title=" " alt="" coords="1166,423,1251,449"/>
<area shape="rect" href="vmx_8c.html#abd63cf398d1b18c9be4e9c4eae17c64c" title=" " alt="" coords="921,612,1064,639"/>
<area shape="rect" href="vmx_8c.html#a8d0fa5e317cbd0eb67ebdc9fa5ec70ce" title=" " alt="" coords="711,612,841,639"/>
</map>
</div>

</div>
</div>
<a id="a9a850feb9bcc4348296adc0b819ef69b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a850feb9bcc4348296adc0b819ef69b">&#9670;&nbsp;</a></span>vmx_get_cpl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vmx_get_cpl </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03543">3543</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;{</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160; </div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;    <span class="keywordflow">if</span> (unlikely(vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vm86_active</a>))</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> = <a class="code" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977">vmx_read_guest_seg_ar</a>(vmx, VCPU_SREG_SS);</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;        <span class="keywordflow">return</span> VMX_AR_DPL(<a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a>);</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;    }</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;}</div>
<div class="ttc" id="astructvcpu__vmx_html_a56511b20f87b7ddc6410ed27d00e04e7"><div class="ttname"><a href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">vcpu_vmx::ar</a></div><div class="ttdeci">u32 ar</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00314">vmx.h:314</a></div></div>
<div class="ttc" id="avmx_8c_html_ae978f1764c6b6e466c1547927fa5f977"><div class="ttname"><a href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977">vmx_read_guest_seg_ar</a></div><div class="ttdeci">static u32 vmx_read_guest_seg_ar(struct vcpu_vmx *vmx, unsigned seg)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00865">vmx.c:865</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a9a850feb9bcc4348296adc0b819ef69b_cgraph.png" border="0" usemap="#avmx_8h_a9a850feb9bcc4348296adc0b819ef69b_cgraph" alt=""/></div>
<map name="avmx_8h_a9a850feb9bcc4348296adc0b819ef69b_cgraph" id="avmx_8h_a9a850feb9bcc4348296adc0b819ef69b_cgraph">
<area shape="rect" title=" " alt="" coords="5,157,111,184"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="213,132,284,159"/>
<area shape="rect" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977" title=" " alt="" coords="159,183,339,209"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="441,132,551,159"/>
<area shape="rect" href="vmx_8c.html#a69771798b92b67f275b9be73a17f6353" title=" " alt="" coords="387,233,605,260"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="706,31,817,57"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="703,81,820,108"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="681,132,842,159"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="702,183,821,209"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="917,5,1068,32"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="937,56,1048,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="665,233,858,260"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="653,284,869,311"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a9a850feb9bcc4348296adc0b819ef69b_icgraph.png" border="0" usemap="#avmx_8h_a9a850feb9bcc4348296adc0b819ef69b_icgraph" alt=""/></div>
<map name="avmx_8h_a9a850feb9bcc4348296adc0b819ef69b_icgraph" id="avmx_8h_a9a850feb9bcc4348296adc0b819ef69b_icgraph">
<area shape="rect" title=" " alt="" coords="1127,157,1232,184"/>
<area shape="rect" href="vmx_8c.html#a2a3c6dbf484f2cb8256f87f8a6713e0d" title=" " alt="" coords="922,5,1009,32"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="423,56,541,83"/>
<area shape="rect" href="vmx_2nested_8c.html#ae5fd7276beb55126f84dc95b178a6bb0" title=" " alt="" coords="852,284,1079,311"/>
<area shape="rect" href="vmx_8c.html#ab47d0d344e1a78767df9a1521c52f3e7" title=" " alt="" coords="886,564,1045,591"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="188,302,359,343"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,309,136,336"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="425,107,539,133"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="421,157,543,184"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="419,208,545,235"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="420,259,544,285"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="643,309,767,336"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="643,360,766,387"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="641,411,768,437"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="645,461,764,488"/>
<area shape="rect" href="vmx_2nested_8c.html#add1e82c32385142c0fca04a1db8cbc3a" title=" " alt="" coords="639,512,770,539"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fecee9010894e3a1513a0924e24dd6" title=" " alt="" coords="413,512,551,539"/>
<area shape="rect" href="vmx_2nested_8c.html#a23e3de8c964e87404eea818be6f70154" title=" " alt="" coords="411,563,553,589"/>
<area shape="rect" href="vmx_8c.html#a7a38ddbd01bec99bf94ab4868ad4c6ea" title=" " alt="" coords="620,564,789,591"/>
<area shape="rect" href="vmx_2nested_8c.html#ad83a41b6ce947fa24f8accde49c38aa0" title=" " alt="" coords="605,619,804,645"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="407,614,557,655"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="199,621,347,648"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,621,140,648"/>
</map>
</div>

</div>
</div>
<a id="a400cebafa368592c80e344bb3f18eaa2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a400cebafa368592c80e344bb3f18eaa2">&#9670;&nbsp;</a></span>vmx_get_exit_qual()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __always_inline unsigned long vmx_get_exit_qual </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00681">681</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;{</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="kvm__cache__regs_8h.html#a0e798337bfa740bfba93e6552b0f6465">kvm_register_test_and_mark_available</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_EXIT_INFO_1))</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#ae187f4df953af5b4218b7a88b61b5928">exit_qualification</a> = <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(EXIT_QUALIFICATION);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">return</span> vmx-&gt;<a class="code" href="structvcpu__vmx.html#ae187f4df953af5b4218b7a88b61b5928">exit_qualification</a>;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_a0e798337bfa740bfba93e6552b0f6465"><div class="ttname"><a href="kvm__cache__regs_8h.html#a0e798337bfa740bfba93e6552b0f6465">kvm_register_test_and_mark_available</a></div><div class="ttdeci">static __always_inline bool kvm_register_test_and_mark_available(struct kvm_vcpu *vcpu, enum kvm_reg reg)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00084">kvm_cache_regs.h:84</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_ae187f4df953af5b4218b7a88b61b5928"><div class="ttname"><a href="structvcpu__vmx.html#ae187f4df953af5b4218b7a88b61b5928">vcpu_vmx::exit_qualification</a></div><div class="ttdeci">unsigned long exit_qualification</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00265">vmx.h:265</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a400cebafa368592c80e344bb3f18eaa2_cgraph.png" border="0" usemap="#avmx_8h_a400cebafa368592c80e344bb3f18eaa2_cgraph" alt=""/></div>
<map name="avmx_8h_a400cebafa368592c80e344bb3f18eaa2_cgraph" id="avmx_8h_a400cebafa368592c80e344bb3f18eaa2_cgraph">
<area shape="rect" title=" " alt="" coords="5,71,152,98"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a0e798337bfa740bfba93e6552b0f6465" title=" " alt="" coords="200,5,371,47"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="250,71,321,98"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="237,122,334,149"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="444,46,555,73"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="441,97,558,123"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="419,147,580,174"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="446,198,553,225"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="628,21,779,47"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="648,71,759,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a400cebafa368592c80e344bb3f18eaa2_icgraph.png" border="0" usemap="#avmx_8h_a400cebafa368592c80e344bb3f18eaa2_icgraph" alt=""/></div>
<map name="avmx_8h_a400cebafa368592c80e344bb3f18eaa2_icgraph" id="avmx_8h_a400cebafa368592c80e344bb3f18eaa2_icgraph">
<area shape="rect" title=" " alt="" coords="1109,588,1256,615"/>
<area shape="rect" href="vmx_8c.html#adc5f600eadc84c85aa0b9982dc6fb210" title=" " alt="" coords="880,5,1031,32"/>
<area shape="rect" href="vmx_8c.html#aa6d0d83d48d1737ca7aa8b2b5a6f066a" title=" " alt="" coords="863,56,1048,83"/>
<area shape="rect" href="vmx_8c.html#aa25166160931e80a671ab6f919d64760" title=" " alt="" coords="885,107,1025,133"/>
<area shape="rect" href="vmx_8c.html#aa55ace9429e6e94042e6602716222805" title=" " alt="" coords="913,157,998,184"/>
<area shape="rect" href="vmx_8c.html#a2a3c6dbf484f2cb8256f87f8a6713e0d" title=" " alt="" coords="912,208,999,235"/>
<area shape="rect" href="vmx_8c.html#a55a56c6fe3cbee7ead4da26de4074000" title=" " alt="" coords="876,259,1035,285"/>
<area shape="rect" href="vmx_8c.html#a7a38ddbd01bec99bf94ab4868ad4c6ea" title=" " alt="" coords="871,309,1040,336"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="645,613,759,640"/>
<area shape="rect" href="vmx_8c.html#a2961a21c1d410bdc92b2a70b881dd3df" title=" " alt="" coords="899,411,1012,437"/>
<area shape="rect" href="vmx_8c.html#af3a69581bc36e5dd88f3c37334df214d" title=" " alt="" coords="895,461,1015,488"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="641,765,763,792"/>
<area shape="rect" href="vmx_8c.html#aa7cfba4207d0e1e93c9257e5ea0ae384" title=" " alt="" coords="913,563,998,589"/>
<area shape="rect" href="vmx_8c.html#ae84388d51663fe634ee7696308491024" title=" " alt="" coords="900,613,1011,640"/>
<area shape="rect" href="vmx_8c.html#ac7111c02b170639c1e8b90e7131f8472" title=" " alt="" coords="892,664,1019,691"/>
<area shape="rect" href="vmx_8c.html#a0c4eb3bfc0efb0cc319b3d4b076b3c84" title=" " alt="" coords="880,715,1031,741"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="641,816,763,843"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="640,867,764,893"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="641,917,763,944"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="639,968,765,995"/>
<area shape="rect" href="vmx_2nested_8c.html#a05813a3b9f1f5f947997a81267e52389" title=" " alt="" coords="849,1069,1061,1096"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="394,1087,545,1129"/>
<area shape="rect" href="vmx_2nested_8c.html#aa737b0ad266ca0532ad72b956726ad7c" title=" " alt="" coords="849,1019,1061,1045"/>
<area shape="rect" href="vmx_2nested_8c.html#a6777a6616a2ebdcc07f60286e276d841" title=" " alt="" coords="867,360,1043,387"/>
<area shape="rect" href="vmx_8c.html#aafb1e163083a2ac5f0acdf3eb7ace5de" title=" " alt="" coords="884,1171,1027,1197"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="384,758,555,799"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="199,765,325,792"/>
<area shape="rect" href="vmx_2nested_8c.html#a877b148ab3be256ff208a4d0c0136809" title=" " alt="" coords="603,1069,801,1096"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="188,1095,336,1121"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,1095,140,1121"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="639,436,765,463"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="640,512,764,539"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="643,373,761,400"/>
</map>
</div>

</div>
</div>
<a id="a70be8e9321dc97600b63443befb6641a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70be8e9321dc97600b63443befb6641a">&#9670;&nbsp;</a></span>vmx_get_instr_info_reg2()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int vmx_get_instr_info_reg2 </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>vmx_instr_info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00742">742</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;{</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordflow">return</span> (vmx_instr_info &gt;&gt; 28) &amp; 0xf;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a70be8e9321dc97600b63443befb6641a_icgraph.png" border="0" usemap="#avmx_8h_a70be8e9321dc97600b63443befb6641a_icgraph" alt=""/></div>
<map name="avmx_8h_a70be8e9321dc97600b63443befb6641a_icgraph" id="avmx_8h_a70be8e9321dc97600b63443befb6641a_icgraph">
<area shape="rect" title=" " alt="" coords="568,56,751,83"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="402,5,517,32"/>
<area shape="rect" href="vmx_8c.html#af3a69581bc36e5dd88f3c37334df214d" title=" " alt="" coords="399,56,519,83"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="399,107,520,133"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,49,351,90"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,56,132,83"/>
</map>
</div>

</div>
</div>
<a id="a2bec7af421bd0dc5f26cbf0209a81390"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bec7af421bd0dc5f26cbf0209a81390">&#9670;&nbsp;</a></span>vmx_get_interrupt_shadow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u32 vmx_get_interrupt_shadow </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01561">1561</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;{</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    u32 interruptibility = <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(GUEST_INTERRUPTIBILITY_INFO);</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160; </div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">if</span> (interruptibility &amp; GUEST_INTR_STATE_STI)</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        ret |= KVM_X86_SHADOW_INT_STI;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">if</span> (interruptibility &amp; GUEST_INTR_STATE_MOV_SS)</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        ret |= KVM_X86_SHADOW_INT_MOV_SS;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160; </div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a2bec7af421bd0dc5f26cbf0209a81390_cgraph.png" border="0" usemap="#avmx_8h_a2bec7af421bd0dc5f26cbf0209a81390_cgraph" alt=""/></div>
<map name="avmx_8h_a2bec7af421bd0dc5f26cbf0209a81390_cgraph" id="avmx_8h_a2bec7af421bd0dc5f26cbf0209a81390_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,204,133"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="252,107,361,133"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="435,31,545,57"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="431,81,549,108"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="409,132,571,159"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="431,183,549,209"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="619,5,769,32"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="639,56,749,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a2bec7af421bd0dc5f26cbf0209a81390_icgraph.png" border="0" usemap="#avmx_8h_a2bec7af421bd0dc5f26cbf0209a81390_icgraph" alt=""/></div>
<map name="avmx_8h_a2bec7af421bd0dc5f26cbf0209a81390_icgraph" id="avmx_8h_a2bec7af421bd0dc5f26cbf0209a81390_icgraph">
<area shape="rect" title=" " alt="" coords="768,31,967,57"/>
<area shape="rect" href="vmx_2nested_8c.html#add1e82c32385142c0fca04a1db8cbc3a" title=" " alt="" coords="589,31,720,57"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fecee9010894e3a1513a0924e24dd6" title=" " alt="" coords="401,5,539,32"/>
<area shape="rect" href="vmx_2nested_8c.html#a23e3de8c964e87404eea818be6f70154" title=" " alt="" coords="399,56,541,83"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,23,351,65"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,31,132,57"/>
</map>
</div>

</div>
</div>
<a id="af7e940dce21b0a53e1eadac452b8ddf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7e940dce21b0a53e1eadac452b8ddf1">&#9670;&nbsp;</a></span>vmx_get_intr_info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __always_inline u32 vmx_get_intr_info </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00691">691</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;{</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="kvm__cache__regs_8h.html#a0e798337bfa740bfba93e6552b0f6465">kvm_register_test_and_mark_available</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_EXIT_INFO_2))</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a0f756a7b3430c589aa4e9952b75f063b">exit_intr_info</a> = <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(VM_EXIT_INTR_INFO);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">return</span> vmx-&gt;<a class="code" href="structvcpu__vmx.html#a0f756a7b3430c589aa4e9952b75f063b">exit_intr_info</a>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;}</div>
<div class="ttc" id="astructvcpu__vmx_html_a0f756a7b3430c589aa4e9952b75f063b"><div class="ttname"><a href="structvcpu__vmx.html#a0f756a7b3430c589aa4e9952b75f063b">vcpu_vmx::exit_intr_info</a></div><div class="ttdeci">u32 exit_intr_info</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00266">vmx.h:266</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_af7e940dce21b0a53e1eadac452b8ddf1_cgraph.png" border="0" usemap="#avmx_8h_af7e940dce21b0a53e1eadac452b8ddf1_cgraph" alt=""/></div>
<map name="avmx_8h_af7e940dce21b0a53e1eadac452b8ddf1_cgraph" id="avmx_8h_af7e940dce21b0a53e1eadac452b8ddf1_cgraph">
<area shape="rect" title=" " alt="" coords="5,71,145,98"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a0e798337bfa740bfba93e6552b0f6465" title=" " alt="" coords="193,5,364,47"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="243,71,314,98"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="224,122,333,149"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="437,46,548,73"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="434,97,551,123"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="412,147,573,174"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="433,198,552,225"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="621,21,772,47"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="641,71,752,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_af7e940dce21b0a53e1eadac452b8ddf1_icgraph.png" border="0" usemap="#avmx_8h_af7e940dce21b0a53e1eadac452b8ddf1_icgraph" alt=""/></div>
<map name="avmx_8h_af7e940dce21b0a53e1eadac452b8ddf1_icgraph" id="avmx_8h_af7e940dce21b0a53e1eadac452b8ddf1_icgraph">
<area shape="rect" title=" " alt="" coords="856,249,996,276"/>
<area shape="rect" href="vmx_8c.html#a6d0db88868b73d46e5509d4d0bebb3ec" title=" " alt="" coords="618,5,797,32"/>
<area shape="rect" href="vmx_8c.html#a7a38ddbd01bec99bf94ab4868ad4c6ea" title=" " alt="" coords="623,56,792,83"/>
<area shape="rect" href="vmx_8c.html#a93b8a2512af2a4e4fd30bcbc29e0751a" title=" " alt="" coords="612,107,803,149"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="646,173,769,200"/>
<area shape="rect" href="vmx_2nested_8c.html#ad83a41b6ce947fa24f8accde49c38aa0" title=" " alt="" coords="608,224,807,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="396,267,547,309"/>
<area shape="rect" href="vmx_2nested_8c.html#a877b148ab3be256ff208a4d0c0136809" title=" " alt="" coords="608,325,807,352"/>
<area shape="rect" href="vmx_8c.html#aafb1e163083a2ac5f0acdf3eb7ace5de" title=" " alt="" coords="636,376,779,403"/>
<area shape="rect" href="vmx_8c.html#a843da623936031fbeebf6207f21891fb" title=" " alt="" coords="607,427,808,453"/>
<area shape="rect" href="vmx_8c.html#ad87eb585004fc744f3b2e93528576962" title=" " alt="" coords="626,477,789,504"/>
<area shape="rect" href="vmx_8c.html#ad674cc8f7dfb181ace5f76dded311f63" title=" " alt="" coords="384,60,559,87"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="386,166,557,207"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="199,173,325,200"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="188,275,336,301"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,275,140,301"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="413,452,530,479"/>
</map>
</div>

</div>
</div>
<a id="ac02364004e8e3f247ba9a3c3ca79a460"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac02364004e8e3f247ba9a3c3ca79a460">&#9670;&nbsp;</a></span>vmx_get_l2_tsc_multiplier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64 vmx_get_l2_tsc_multiplier </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01907">1907</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;{</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvmcs12.html">vmcs12</a> *<a class="code" href="structvmcs12.html">vmcs12</a> = <a class="code" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497">get_vmcs12</a>(vcpu);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160; </div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nested_8h.html#ae8f95597e49047619366cbf8f1a63449">nested_cpu_has</a>(<a class="code" href="structvmcs12.html">vmcs12</a>, CPU_BASED_USE_TSC_OFFSETTING) &amp;&amp;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        <a class="code" href="nested_8h.html#aa997cf53b86844ddc4f230369935239e">nested_cpu_has2</a>(<a class="code" href="structvmcs12.html">vmcs12</a>, SECONDARY_EXEC_TSC_SCALING))</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="structvmcs12.html">vmcs12</a>-&gt;<a class="code" href="structvmcs12.html#a8b69ab9a05ef9beed4180353f27e4d9f">tsc_multiplier</a>;</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structkvm__caps.html">kvm_caps</a>.<a class="code" href="structkvm__caps.html#a4f8f01ced32ac7e2bbdea0fcf6406a76">default_tsc_scaling_ratio</a>;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;}</div>
<div class="ttc" id="anested_8h_html_aa997cf53b86844ddc4f230369935239e"><div class="ttname"><a href="nested_8h.html#aa997cf53b86844ddc4f230369935239e">nested_cpu_has2</a></div><div class="ttdeci">static bool nested_cpu_has2(struct vmcs12 *vmcs12, u32 bit)</div><div class="ttdef"><b>Definition:</b> <a href="nested_8h_source.html#l00137">nested.h:137</a></div></div>
<div class="ttc" id="anested_8h_html_ae8f95597e49047619366cbf8f1a63449"><div class="ttname"><a href="nested_8h.html#ae8f95597e49047619366cbf8f1a63449">nested_cpu_has</a></div><div class="ttdeci">static bool nested_cpu_has(struct vmcs12 *vmcs12, u32 bit)</div><div class="ttdef"><b>Definition:</b> <a href="nested_8h_source.html#l00132">nested.h:132</a></div></div>
<div class="ttc" id="astructkvm__caps_html"><div class="ttname"><a href="structkvm__caps.html">kvm_caps</a></div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00012">x86.h:12</a></div></div>
<div class="ttc" id="astructkvm__caps_html_a4f8f01ced32ac7e2bbdea0fcf6406a76"><div class="ttname"><a href="structkvm__caps.html#a4f8f01ced32ac7e2bbdea0fcf6406a76">kvm_caps::default_tsc_scaling_ratio</a></div><div class="ttdeci">u64 default_tsc_scaling_ratio</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00022">x86.h:22</a></div></div>
<div class="ttc" id="astructvmcs12_html"><div class="ttname"><a href="structvmcs12.html">vmcs12</a></div><div class="ttdef"><b>Definition:</b> <a href="vmcs12_8h_source.html#l00027">vmcs12.h:27</a></div></div>
<div class="ttc" id="astructvmcs12_html_a8b69ab9a05ef9beed4180353f27e4d9f"><div class="ttname"><a href="structvmcs12.html#a8b69ab9a05ef9beed4180353f27e4d9f">vmcs12::tsc_multiplier</a></div><div class="ttdeci">u64 tsc_multiplier</div><div class="ttdef"><b>Definition:</b> <a href="vmcs12_8h_source.html#l00073">vmcs12.h:73</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ac02364004e8e3f247ba9a3c3ca79a460_cgraph.png" border="0" usemap="#avmx_8h_ac02364004e8e3f247ba9a3c3ca79a460_cgraph" alt=""/></div>
<map name="avmx_8h_ac02364004e8e3f247ba9a3c3ca79a460_cgraph" id="avmx_8h_ac02364004e8e3f247ba9a3c3ca79a460_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,200,83"/>
<area shape="rect" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497" title=" " alt="" coords="265,5,366,32"/>
<area shape="rect" href="nested_8h.html#ae8f95597e49047619366cbf8f1a63449" title=" " alt="" coords="252,56,379,83"/>
<area shape="rect" href="nested_8h.html#aa997cf53b86844ddc4f230369935239e" title=" " alt="" coords="248,107,383,133"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="431,5,501,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ac02364004e8e3f247ba9a3c3ca79a460_icgraph.png" border="0" usemap="#avmx_8h_ac02364004e8e3f247ba9a3c3ca79a460_icgraph" alt=""/></div>
<map name="avmx_8h_ac02364004e8e3f247ba9a3c3ca79a460_icgraph" id="avmx_8h_ac02364004e8e3f247ba9a3c3ca79a460_icgraph">
<area shape="rect" title=" " alt="" coords="184,5,379,32"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="5,5,136,32"/>
</map>
</div>

</div>
</div>
<a id="a46c1e27ec7a8197f1194b6cc37db30ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46c1e27ec7a8197f1194b6cc37db30ef">&#9670;&nbsp;</a></span>vmx_get_l2_tsc_offset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64 vmx_get_l2_tsc_offset </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01897">1897</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;{</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvmcs12.html">vmcs12</a> *<a class="code" href="structvmcs12.html">vmcs12</a> = <a class="code" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497">get_vmcs12</a>(vcpu);</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160; </div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nested_8h.html#ae8f95597e49047619366cbf8f1a63449">nested_cpu_has</a>(<a class="code" href="structvmcs12.html">vmcs12</a>, CPU_BASED_USE_TSC_OFFSETTING))</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="structvmcs12.html">vmcs12</a>-&gt;<a class="code" href="structvmcs12.html#aebe12e3e33936512baab6ff0b6606eb7">tsc_offset</a>;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160; </div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;}</div>
<div class="ttc" id="astructvmcs12_html_aebe12e3e33936512baab6ff0b6606eb7"><div class="ttname"><a href="structvmcs12.html#aebe12e3e33936512baab6ff0b6606eb7">vmcs12::tsc_offset</a></div><div class="ttdeci">u64 tsc_offset</div><div class="ttdef"><b>Definition:</b> <a href="vmcs12_8h_source.html#l00043">vmcs12.h:43</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a46c1e27ec7a8197f1194b6cc37db30ef_cgraph.png" border="0" usemap="#avmx_8h_a46c1e27ec7a8197f1194b6cc37db30ef_cgraph" alt=""/></div>
<map name="avmx_8h_a46c1e27ec7a8197f1194b6cc37db30ef_cgraph" id="avmx_8h_a46c1e27ec7a8197f1194b6cc37db30ef_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,173,57"/>
<area shape="rect" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497" title=" " alt="" coords="234,5,335,32"/>
<area shape="rect" href="nested_8h.html#ae8f95597e49047619366cbf8f1a63449" title=" " alt="" coords="221,56,348,83"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="396,5,467,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a46c1e27ec7a8197f1194b6cc37db30ef_icgraph.png" border="0" usemap="#avmx_8h_a46c1e27ec7a8197f1194b6cc37db30ef_icgraph" alt=""/></div>
<map name="avmx_8h_a46c1e27ec7a8197f1194b6cc37db30ef_icgraph" id="avmx_8h_a46c1e27ec7a8197f1194b6cc37db30ef_icgraph">
<area shape="rect" title=" " alt="" coords="184,5,352,32"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="5,5,136,32"/>
</map>
</div>

</div>
</div>
<a id="a62c6e72fbfaa38594860584e7afaa4ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62c6e72fbfaa38594860584e7afaa4ac">&#9670;&nbsp;</a></span>vmx_get_nmi_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool vmx_get_nmi_mask </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l04991">4991</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;{</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;    <span class="keywordtype">bool</span> masked;</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160; </div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a6c57cc8c0f93a3ea3e5dc56c0092a71c">enable_vnmi</a>)</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;        <span class="keywordflow">return</span> vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#abee15264dfc3d58548c9c9e2a7db3b93">soft_vnmi_blocked</a>;</div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;    <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a8453552850c308ff95692d198bdaeaff">nmi_known_unmasked</a>)</div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;    masked = <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(GUEST_INTERRUPTIBILITY_INFO) &amp; GUEST_INTR_STATE_NMI;</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;    vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a8453552850c308ff95692d198bdaeaff">nmi_known_unmasked</a> = !masked;</div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;    <span class="keywordflow">return</span> masked;</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;}</div>
<div class="ttc" id="astructloaded__vmcs_html_a8453552850c308ff95692d198bdaeaff"><div class="ttname"><a href="structloaded__vmcs.html#a8453552850c308ff95692d198bdaeaff">loaded_vmcs::nmi_known_unmasked</a></div><div class="ttdeci">bool nmi_known_unmasked</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00066">vmcs.h:66</a></div></div>
<div class="ttc" id="astructloaded__vmcs_html_abee15264dfc3d58548c9c9e2a7db3b93"><div class="ttname"><a href="structloaded__vmcs.html#abee15264dfc3d58548c9c9e2a7db3b93">loaded_vmcs::soft_vnmi_blocked</a></div><div class="ttdeci">int soft_vnmi_blocked</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00069">vmcs.h:69</a></div></div>
<div class="ttc" id="avmx_8c_html_a6c57cc8c0f93a3ea3e5dc56c0092a71c"><div class="ttname"><a href="vmx_8c.html#a6c57cc8c0f93a3ea3e5dc56c0092a71c">enable_vnmi</a></div><div class="ttdeci">static bool __read_mostly enable_vnmi</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00085">vmx.c:85</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a62c6e72fbfaa38594860584e7afaa4ac_cgraph.png" border="0" usemap="#avmx_8h_a62c6e72fbfaa38594860584e7afaa4ac_cgraph" alt=""/></div>
<map name="avmx_8h_a62c6e72fbfaa38594860584e7afaa4ac_cgraph" id="avmx_8h_a62c6e72fbfaa38594860584e7afaa4ac_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,160,108"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="227,56,298,83"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="208,107,317,133"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="391,31,501,57"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="387,81,505,108"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="365,132,527,159"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="387,183,505,209"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="575,5,725,32"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="595,56,705,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a62c6e72fbfaa38594860584e7afaa4ac_icgraph.png" border="0" usemap="#avmx_8h_a62c6e72fbfaa38594860584e7afaa4ac_icgraph" alt=""/></div>
<map name="avmx_8h_a62c6e72fbfaa38594860584e7afaa4ac_icgraph" id="avmx_8h_a62c6e72fbfaa38594860584e7afaa4ac_icgraph">
<area shape="rect" title=" " alt="" coords="516,13,671,39"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="252,5,468,47"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="5,13,204,39"/>
</map>
</div>

</div>
</div>
<a id="adf1cae1921d1492c7e06115012eb48e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf1cae1921d1492c7e06115012eb48e3">&#9670;&nbsp;</a></span>vmx_get_rflags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long vmx_get_rflags </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01509">1509</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;{</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a>, <a class="code" href="structvcpu__vmx.html#a5ac2787e395fb30b00c54884f37deafd">save_rflags</a>;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160; </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9">kvm_register_is_available</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_RFLAGS)) {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        <a class="code" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f">kvm_register_mark_available</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_RFLAGS);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a> = <a class="code" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956">vmcs_readl</a>(GUEST_RFLAGS);</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vm86_active</a>) {</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a> &amp;= <a class="code" href="vmx_8c.html#a6a1616d53f65fe2046622df15c300f0b">RMODE_GUEST_OWNED_EFLAGS_BITS</a>;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;            <a class="code" href="structvcpu__vmx.html#a5ac2787e395fb30b00c54884f37deafd">save_rflags</a> = vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#a5ac2787e395fb30b00c54884f37deafd">save_rflags</a>;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a> |= <a class="code" href="structvcpu__vmx.html#a5ac2787e395fb30b00c54884f37deafd">save_rflags</a> &amp; ~<a class="code" href="vmx_8c.html#a6a1616d53f65fe2046622df15c300f0b">RMODE_GUEST_OWNED_EFLAGS_BITS</a>;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        }</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a> = <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a>;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    }</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="keywordflow">return</span> vmx-&gt;<a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a>;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_a6b9ea8c019490183db2a81569aad2bf9"><div class="ttname"><a href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9">kvm_register_is_available</a></div><div class="ttdeci">static bool kvm_register_is_available(struct kvm_vcpu *vcpu, enum kvm_reg reg)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00053">kvm_cache_regs.h:53</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_a260ff06130ff61794b5711e321655624"><div class="ttname"><a href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">vcpu_vmx::rflags</a></div><div class="ttdeci">ulong rflags</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00268">vmx.h:268</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_a5ac2787e395fb30b00c54884f37deafd"><div class="ttname"><a href="structvcpu__vmx.html#a5ac2787e395fb30b00c54884f37deafd">vcpu_vmx::save_rflags</a></div><div class="ttdeci">ulong save_rflags</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00305">vmx.h:305</a></div></div>
<div class="ttc" id="avmx_8c_html_a6a1616d53f65fe2046622df15c300f0b"><div class="ttname"><a href="vmx_8c.html#a6a1616d53f65fe2046622df15c300f0b">RMODE_GUEST_OWNED_EFLAGS_BITS</a></div><div class="ttdeci">#define RMODE_GUEST_OWNED_EFLAGS_BITS</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00153">vmx.c:153</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_adf1cae1921d1492c7e06115012eb48e3_cgraph.png" border="0" usemap="#avmx_8h_adf1cae1921d1492c7e06115012eb48e3_cgraph" alt=""/></div>
<map name="avmx_8h_adf1cae1921d1492c7e06115012eb48e3_cgraph" id="avmx_8h_adf1cae1921d1492c7e06115012eb48e3_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,128,108"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="187,5,381,32"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="176,56,392,83"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="249,107,319,133"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="235,157,333,184"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="465,81,576,108"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="462,132,579,159"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="440,183,601,209"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="467,233,574,260"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="649,56,800,83"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="669,107,780,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_adf1cae1921d1492c7e06115012eb48e3_icgraph.png" border="0" usemap="#avmx_8h_adf1cae1921d1492c7e06115012eb48e3_icgraph" alt=""/></div>
<map name="avmx_8h_adf1cae1921d1492c7e06115012eb48e3_icgraph" id="avmx_8h_adf1cae1921d1492c7e06115012eb48e3_icgraph">
<area shape="rect" title=" " alt="" coords="2239,1091,2361,1117"/>
<area shape="rect" href="vmx_8c.html#a77b0ca4dac426b317965746a6bec345e" title=" " alt="" coords="2004,580,2191,607"/>
<area shape="rect" href="vmx_8c.html#ae81f31c4be3384219d11e767cca4da94" title=" " alt="" coords="1369,989,1491,1016"/>
<area shape="rect" href="sgx_8c.html#ad3394313e85a46c8e1bc4880ddde7fc9" title=" " alt="" coords="1148,1141,1291,1168"/>
<area shape="rect" href="vmx_2nested_8c.html#a46021f02931b3001ef00a526b56448a8" title=" " alt="" coords="1132,989,1307,1016"/>
<area shape="rect" href="vmx_2nested_8c.html#aec3ff66d7b1e9086f727ebe6b9b1a0cf" title=" " alt="" coords="1138,1040,1301,1067"/>
<area shape="rect" href="vmx_2nested_8c.html#a3c80ece98832af9587ecff9947817449" title=" " alt="" coords="917,1192,1080,1219"/>
<area shape="rect" href="vmx_8c.html#a7a38ddbd01bec99bf94ab4868ad4c6ea" title=" " alt="" coords="2013,1243,2182,1269"/>
<area shape="rect" href="vmx_8c.html#a28bf1767581e6d34f59d632761f8bd35" title=" " alt="" coords="2034,1293,2161,1320"/>
<area shape="rect" href="vmx_8c.html#a368d7a25f0cc51f62229282a5d2550d3" title=" " alt="" coords="699,757,869,784"/>
<area shape="rect" href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf" title=" " alt="" coords="1783,425,1956,452"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,160,138,187"/>
<area shape="rect" href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5" title=" " alt="" coords="1549,425,1735,452"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="1128,451,1311,477"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1377,400,1483,427"/>
<area shape="rect" href="vmx_8c.html#a9e72f6be0ed4dafcb17b8fb874a39d58" title=" " alt="" coords="1359,349,1501,376"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="707,392,861,419"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,589,361,616"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,669,604,696"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,267,631,309"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,202,651,243"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,209,387,236"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,553,618,594"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,333,633,360"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,385,635,426"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,100,615,127"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,589,140,616"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,1159,373,1201"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,1167,136,1193"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,265,369,306"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,100,374,127"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="921,385,1076,426"/>
<area shape="rect" href="sgx_8c.html#a34e5ee57c3e7c3172f8ae6ed981d703d" title=" " alt="" coords="945,1243,1052,1269"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="723,1141,845,1168"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="721,1040,847,1067"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="725,1091,843,1117"/>
<area shape="rect" href="vmx_2nested_8c.html#a4d1da86d40e5c09521979006a05a35e4" title=" " alt="" coords="933,1141,1064,1168"/>
<area shape="rect" href="vmx_2nested_8c.html#add1e82c32385142c0fca04a1db8cbc3a" title=" " alt="" coords="719,964,849,991"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="727,1293,841,1320"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="723,1344,845,1371"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="721,1192,847,1219"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="722,1243,846,1269"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fecee9010894e3a1513a0924e24dd6" title=" " alt="" coords="474,989,611,1016"/>
<area shape="rect" href="vmx_2nested_8c.html#a23e3de8c964e87404eea818be6f70154" title=" " alt="" coords="471,939,614,965"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="722,1395,846,1421"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="725,1445,843,1472"/>
<area shape="rect" href="vmx_8c.html#a826652b83d0f8797a169f7839596c178" title=" " alt="" coords="463,721,623,762"/>
<area shape="rect" href="vmx_8c.html#a8b92a5c83267fa843483b8277bc73f30" title=" " alt="" coords="457,787,629,813"/>
<area shape="rect" href="posted__intr_8c.html#aa59b00f36d985abaa19009096d1f66a4" title=" " alt="" coords="475,837,611,864"/>
<area shape="rect" href="vmx_8c.html#a65248f7343c2ee3dfdfeb6388e80ab9b" title=" " alt="" coords="229,837,346,864"/>
</map>
</div>

</div>
</div>
<a id="ad2c26b0506cde250d95325afcf0518b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2c26b0506cde250d95325afcf0518b7">&#9670;&nbsp;</a></span>vmx_get_rvi()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u8 vmx_get_rvi </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00466">466</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;{</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7">vmcs_read16</a>(GUEST_INTR_STATUS) &amp; 0xff;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ad2c26b0506cde250d95325afcf0518b7_cgraph.png" border="0" usemap="#avmx_8h_ad2c26b0506cde250d95325afcf0518b7_cgraph" alt=""/></div>
<map name="avmx_8h_ad2c26b0506cde250d95325afcf0518b7_cgraph" id="avmx_8h_ad2c26b0506cde250d95325afcf0518b7_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,108,133"/>
<area shape="rect" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7" title=" " alt="" coords="156,107,265,133"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="339,31,449,57"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a77b65dd311c34381a8508de99e9b8543" title=" " alt="" coords="335,81,453,108"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="313,132,475,159"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="335,183,453,209"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="523,5,673,32"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="543,56,653,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ad2c26b0506cde250d95325afcf0518b7_icgraph.png" border="0" usemap="#avmx_8h_ad2c26b0506cde250d95325afcf0518b7_icgraph" alt=""/></div>
<map name="avmx_8h_ad2c26b0506cde250d95325afcf0518b7_icgraph" id="avmx_8h_ad2c26b0506cde250d95325afcf0518b7_icgraph">
<area shape="rect" title=" " alt="" coords="240,42,343,69"/>
<area shape="rect" href="vmx_8c.html#a4b7bce685b675217949fe87872d9a121" title=" " alt="" coords="19,5,178,47"/>
<area shape="rect" href="vmx_2nested_8c.html#ace6032a8bf541cd49984bb572529dd68" title=" " alt="" coords="5,71,192,98"/>
</map>
</div>

</div>
</div>
<a id="acfb1910d98db4bcd82dd9a96eb069ce9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfb1910d98db4bcd82dd9a96eb069ce9">&#9670;&nbsp;</a></span>vmx_get_segment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_get_segment </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_segment *&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>seg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03496">3496</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;{</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;    u32 <a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a>;</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160; </div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;    <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vm86_active</a> &amp;&amp; <a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a> != VCPU_SREG_LDTR) {</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;        *var = vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#a352cbdef95e01037931fc528039ba483">segs</a>[<a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a>];</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a> == VCPU_SREG_TR</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;            || var-&gt;selector == <a class="code" href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc">vmx_read_guest_seg_selector</a>(vmx, <a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a>))</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;        var-&gt;base = <a class="code" href="vmx_8c.html#a911b88947099c0d21f8fbeca202ea30f">vmx_read_guest_seg_base</a>(vmx, <a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a>);</div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;        var-&gt;selector = <a class="code" href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc">vmx_read_guest_seg_selector</a>(vmx, <a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a>);</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;    }</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    var-&gt;base = <a class="code" href="vmx_8c.html#a911b88947099c0d21f8fbeca202ea30f">vmx_read_guest_seg_base</a>(vmx, <a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a>);</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    var-&gt;limit = <a class="code" href="vmx_8c.html#ab9185adefc641ff428164a7fcab15c45">vmx_read_guest_seg_limit</a>(vmx, <a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a>);</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;    var-&gt;selector = <a class="code" href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc">vmx_read_guest_seg_selector</a>(vmx, <a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a>);</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    <a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> = <a class="code" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977">vmx_read_guest_seg_ar</a>(vmx, <a class="code" href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">seg</a>);</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;    var-&gt;unusable = (<a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> &gt;&gt; 16) &amp; 1;</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;    var-&gt;type = <a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> &amp; 15;</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;    var-&gt;s = (<a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> &gt;&gt; 4) &amp; 1;</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;    var-&gt;dpl = (<a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> &gt;&gt; 5) &amp; 3;</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;<span class="comment">     * Some userspaces do not preserve unusable property. Since usable</span></div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;<span class="comment">     * segment has to be present according to VMX spec we can use present</span></div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;<span class="comment">     * property to amend userspace bug by making unusable segment always</span></div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;<span class="comment">     * nonpresent. vmx_segment_access_rights() already marks nonpresent</span></div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;<span class="comment">     * segment as unusable.</span></div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;    var-&gt;present = !var-&gt;unusable;</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;    var-&gt;avl = (<a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> &gt;&gt; 12) &amp; 1;</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;    var-&gt;l = (<a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> &gt;&gt; 13) &amp; 1;</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;    var-&gt;db = (<a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> &gt;&gt; 14) &amp; 1;</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    var-&gt;g = (<a class="code" href="structvcpu__vmx.html#a56511b20f87b7ddc6410ed27d00e04e7">ar</a> &gt;&gt; 15) &amp; 1;</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;}</div>
<div class="ttc" id="astructvcpu__vmx_html_abeea6cdf1d15518184ed907e71405a31"><div class="ttname"><a href="structvcpu__vmx.html#abeea6cdf1d15518184ed907e71405a31">vcpu_vmx::seg</a></div><div class="ttdeci">struct vcpu_vmx::@41::kvm_save_segment seg[8]</div></div>
<div class="ttc" id="avmx_8c_html_a911b88947099c0d21f8fbeca202ea30f"><div class="ttname"><a href="vmx_8c.html#a911b88947099c0d21f8fbeca202ea30f">vmx_read_guest_seg_base</a></div><div class="ttdeci">static ulong vmx_read_guest_seg_base(struct vcpu_vmx *vmx, unsigned seg)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00847">vmx.c:847</a></div></div>
<div class="ttc" id="avmx_8c_html_ab9185adefc641ff428164a7fcab15c45"><div class="ttname"><a href="vmx_8c.html#ab9185adefc641ff428164a7fcab15c45">vmx_read_guest_seg_limit</a></div><div class="ttdeci">static u32 vmx_read_guest_seg_limit(struct vcpu_vmx *vmx, unsigned seg)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00856">vmx.c:856</a></div></div>
<div class="ttc" id="avmx_8c_html_ae1134559a10e8db36f8d2dabc07f78fc"><div class="ttname"><a href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc">vmx_read_guest_seg_selector</a></div><div class="ttdeci">static u16 vmx_read_guest_seg_selector(struct vcpu_vmx *vmx, unsigned seg)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00838">vmx.c:838</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_acfb1910d98db4bcd82dd9a96eb069ce9_cgraph.png" border="0" usemap="#avmx_8h_acfb1910d98db4bcd82dd9a96eb069ce9_cgraph" alt=""/></div>
<map name="avmx_8h_acfb1910d98db4bcd82dd9a96eb069ce9_cgraph" id="avmx_8h_acfb1910d98db4bcd82dd9a96eb069ce9_cgraph">
<area shape="rect" title=" " alt="" coords="5,169,148,196"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="260,52,331,79"/>
<area shape="rect" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977" title=" " alt="" coords="205,169,385,196"/>
<area shape="rect" href="vmx_8c.html#a911b88947099c0d21f8fbeca202ea30f" title=" " alt="" coords="196,220,395,247"/>
<area shape="rect" href="vmx_8c.html#ab9185adefc641ff428164a7fcab15c45" title=" " alt="" coords="215,103,375,145"/>
<area shape="rect" href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc" title=" " alt="" coords="215,271,375,313"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="497,113,607,140"/>
<area shape="rect" href="vmx_8c.html#a69771798b92b67f275b9be73a17f6353" title=" " alt="" coords="443,168,661,195"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="762,208,873,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="759,5,876,32"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="737,259,898,285"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="758,56,877,83"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="973,183,1124,209"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="993,233,1104,260"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="721,107,914,133"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="709,157,925,184"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="503,249,601,276"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="759,309,876,336"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="764,360,871,387"/>
<area shape="rect" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7" title=" " alt="" coords="497,300,607,327"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a77b65dd311c34381a8508de99e9b8543" title=" " alt="" coords="759,411,876,437"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="758,461,877,488"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_acfb1910d98db4bcd82dd9a96eb069ce9_icgraph.png" border="0" usemap="#avmx_8h_acfb1910d98db4bcd82dd9a96eb069ce9_icgraph" alt=""/></div>
<map name="avmx_8h_acfb1910d98db4bcd82dd9a96eb069ce9_icgraph" id="avmx_8h_acfb1910d98db4bcd82dd9a96eb069ce9_icgraph">
<area shape="rect" title=" " alt="" coords="2257,548,2400,574"/>
<area shape="rect" href="vmx_8c.html#a53b41b0e13efa39a027845ff9af21ed6" title=" " alt="" coords="2041,573,2197,600"/>
<area shape="rect" href="vmx_8c.html#ad56726eeac472ac5b038651ccffbb6f4" title=" " alt="" coords="2055,624,2182,650"/>
<area shape="rect" href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d" title=" " alt="" coords="2041,674,2196,701"/>
<area shape="rect" href="vmx_8c.html#a5b0ffadb6f1bbf0fe42d6cf7a17490bb" title=" " alt="" coords="1833,269,1941,296"/>
<area shape="rect" href="vmx_8c.html#ac744bdcb0b42778132eaeb180e29e70c" title=" " alt="" coords="1606,320,1711,346"/>
<area shape="rect" href="vmx_2nested_8c.html#a8f92d0cdc8257a39a1360af576ff3b1a" title=" " alt="" coords="917,725,1095,752"/>
<area shape="rect" href="vmx_8c.html#a1c712b1524bbb5ba769fb529614d5c35" title=" " alt="" coords="2077,370,2160,397"/>
<area shape="rect" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f" title=" " alt="" coords="2035,421,2202,448"/>
<area shape="rect" href="sgx_8c.html#a3db54dfc9dd26f3369c2a67756013cff" title=" " alt="" coords="1145,801,1291,828"/>
<area shape="rect" href="vmx_8c.html#abdb19ee07646c48c401dad49fae9c607" title=" " alt="" coords="2039,472,2199,498"/>
<area shape="rect" href="vmx_8c.html#ae22de32cadb09c91caa1acb52293f01f" title=" " alt="" coords="2083,522,2154,549"/>
<area shape="rect" href="vmx_8c.html#aa5562a2eba71818690925eb1d150d317" title=" " alt="" coords="2028,826,2209,853"/>
<area shape="rect" href="vmx_8c.html#a77b0ca4dac426b317965746a6bec345e" title=" " alt="" coords="1793,497,1980,524"/>
<area shape="rect" href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf" title=" " alt="" coords="1572,472,1745,498"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="941,446,1071,473"/>
<area shape="rect" href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5" title=" " alt="" coords="1339,421,1524,448"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="915,368,1097,394"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1165,320,1271,346"/>
<area shape="rect" href="vmx_8c.html#ae81f31c4be3384219d11e767cca4da94" title=" " alt="" coords="1157,522,1279,549"/>
<area shape="rect" href="vmx_8c.html#a9e72f6be0ed4dafcb17b8fb874a39d58" title=" " alt="" coords="1147,421,1289,448"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="701,304,856,330"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="205,33,353,60"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="473,472,596,498"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="447,172,623,214"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="427,238,643,279"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="180,182,379,209"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="459,55,610,96"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="445,304,625,330"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="443,355,627,396"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="462,421,607,448"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="194,667,365,708"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,674,132,701"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="929,300,1083,342"/>
<area shape="rect" href="sgx_8c.html#ad3394313e85a46c8e1bc4880ddde7fc9" title=" " alt="" coords="935,801,1077,828"/>
<area shape="rect" href="vmx_2nested_8c.html#a46021f02931b3001ef00a526b56448a8" title=" " alt="" coords="691,522,866,549"/>
<area shape="rect" href="vmx_2nested_8c.html#aec3ff66d7b1e9086f727ebe6b9b1a0cf" title=" " alt="" coords="925,497,1087,524"/>
<area shape="rect" href="vmx_2nested_8c.html#a3c80ece98832af9587ecff9947817449" title=" " alt="" coords="697,674,860,701"/>
<area shape="rect" href="sgx_8c.html#a34e5ee57c3e7c3172f8ae6ed981d703d" title=" " alt="" coords="725,928,832,954"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="473,573,596,600"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="471,522,598,549"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="476,624,593,650"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="477,826,592,853"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="474,877,595,904"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="471,725,598,752"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="473,674,597,701"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="473,776,597,802"/>
<area shape="rect" href="vmx_8c.html#af3a69581bc36e5dd88f3c37334df214d" title=" " alt="" coords="719,776,839,802"/>
<area shape="rect" href="vmx_2nested_8c.html#a6777a6616a2ebdcc07f60286e276d841" title=" " alt="" coords="691,624,867,650"/>
<area shape="rect" href="sgx_8c.html#a64209d7a6548174cb6fae30a7a26a194" title=" " alt="" coords="925,877,1087,904"/>
</map>
</div>

</div>
</div>
<a id="ac53159f102e6a5dacbc90a2c4666ac71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac53159f102e6a5dacbc90a2c4666ac71">&#9670;&nbsp;</a></span>vmx_get_untagged_addr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gva_t vmx_get_untagged_addr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gva_t&#160;</td>
          <td class="paramname"><em>gva</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l08250">8250</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l08251"></a><span class="lineno"> 8251</span>&#160;{</div>
<div class="line"><a name="l08252"></a><span class="lineno"> 8252</span>&#160;    <span class="keywordtype">int</span> lam_bit;</div>
<div class="line"><a name="l08253"></a><span class="lineno"> 8253</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cr3_bits;</div>
<div class="line"><a name="l08254"></a><span class="lineno"> 8254</span>&#160; </div>
<div class="line"><a name="l08255"></a><span class="lineno"> 8255</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &amp; (<a class="code" href="kvm__emulate_8h.html#a6f878927bcff7757f8f673c881f19312">X86EMUL_F_FETCH</a> | <a class="code" href="kvm__emulate_8h.html#a171469346422bf35786f9bcb5385750e">X86EMUL_F_IMPLICIT</a> | <a class="code" href="kvm__emulate_8h.html#a00f73791266b9ffb8bc1394134096864">X86EMUL_F_INVLPG</a>))</div>
<div class="line"><a name="l08256"></a><span class="lineno"> 8256</span>&#160;        <span class="keywordflow">return</span> gva;</div>
<div class="line"><a name="l08257"></a><span class="lineno"> 8257</span>&#160; </div>
<div class="line"><a name="l08258"></a><span class="lineno"> 8258</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="x86_8h.html#ada9d5e605374059a5e34c42817ed5118">is_64_bit_mode</a>(vcpu))</div>
<div class="line"><a name="l08259"></a><span class="lineno"> 8259</span>&#160;        <span class="keywordflow">return</span> gva;</div>
<div class="line"><a name="l08260"></a><span class="lineno"> 8260</span>&#160; </div>
<div class="line"><a name="l08261"></a><span class="lineno"> 8261</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l08262"></a><span class="lineno"> 8262</span>&#160;<span class="comment">     * Bit 63 determines if the address should be treated as user address</span></div>
<div class="line"><a name="l08263"></a><span class="lineno"> 8263</span>&#160;<span class="comment">     * or a supervisor address.</span></div>
<div class="line"><a name="l08264"></a><span class="lineno"> 8264</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l08265"></a><span class="lineno"> 8265</span>&#160;    <span class="keywordflow">if</span> (!(gva &amp; BIT_ULL(63))) {</div>
<div class="line"><a name="l08266"></a><span class="lineno"> 8266</span>&#160;        cr3_bits = <a class="code" href="mmu_8h.html#a4e90e07b62b255d32f17cdb19ba6d1d1">kvm_get_active_cr3_lam_bits</a>(vcpu);</div>
<div class="line"><a name="l08267"></a><span class="lineno"> 8267</span>&#160;        <span class="keywordflow">if</span> (!(cr3_bits &amp; (X86_CR3_LAM_U57 | X86_CR3_LAM_U48)))</div>
<div class="line"><a name="l08268"></a><span class="lineno"> 8268</span>&#160;            <span class="keywordflow">return</span> gva;</div>
<div class="line"><a name="l08269"></a><span class="lineno"> 8269</span>&#160; </div>
<div class="line"><a name="l08270"></a><span class="lineno"> 8270</span>&#160;        <span class="comment">/* LAM_U48 is ignored if LAM_U57 is set. */</span></div>
<div class="line"><a name="l08271"></a><span class="lineno"> 8271</span>&#160;        lam_bit = cr3_bits &amp; X86_CR3_LAM_U57 ? 56 : 47;</div>
<div class="line"><a name="l08272"></a><span class="lineno"> 8272</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08273"></a><span class="lineno"> 8273</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65">kvm_is_cr4_bit_set</a>(vcpu, X86_CR4_LAM_SUP))</div>
<div class="line"><a name="l08274"></a><span class="lineno"> 8274</span>&#160;            <span class="keywordflow">return</span> gva;</div>
<div class="line"><a name="l08275"></a><span class="lineno"> 8275</span>&#160; </div>
<div class="line"><a name="l08276"></a><span class="lineno"> 8276</span>&#160;        lam_bit = <a class="code" href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65">kvm_is_cr4_bit_set</a>(vcpu, X86_CR4_LA57) ? 56 : 47;</div>
<div class="line"><a name="l08277"></a><span class="lineno"> 8277</span>&#160;    }</div>
<div class="line"><a name="l08278"></a><span class="lineno"> 8278</span>&#160; </div>
<div class="line"><a name="l08279"></a><span class="lineno"> 8279</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l08280"></a><span class="lineno"> 8280</span>&#160;<span class="comment">     * Untag the address by sign-extending the lam_bit, but NOT to bit 63.</span></div>
<div class="line"><a name="l08281"></a><span class="lineno"> 8281</span>&#160;<span class="comment">     * Bit 63 is retained from the raw virtual address so that untagging</span></div>
<div class="line"><a name="l08282"></a><span class="lineno"> 8282</span>&#160;<span class="comment">     * doesn&#39;t change a user access to a supervisor access, and vice versa.</span></div>
<div class="line"><a name="l08283"></a><span class="lineno"> 8283</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l08284"></a><span class="lineno"> 8284</span>&#160;    <span class="keywordflow">return</span> (sign_extend64(gva, lam_bit) &amp; ~BIT_ULL(63)) | (gva &amp; BIT_ULL(63));</div>
<div class="line"><a name="l08285"></a><span class="lineno"> 8285</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_a2b779657b20f7afa44c0172b1478ac65"><div class="ttname"><a href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65">kvm_is_cr4_bit_set</a></div><div class="ttdeci">static __always_inline bool kvm_is_cr4_bit_set(struct kvm_vcpu *vcpu, unsigned long cr4_bit)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00182">kvm_cache_regs.h:182</a></div></div>
<div class="ttc" id="akvm__emulate_8h_html_a00f73791266b9ffb8bc1394134096864"><div class="ttname"><a href="kvm__emulate_8h.html#a00f73791266b9ffb8bc1394134096864">X86EMUL_F_INVLPG</a></div><div class="ttdeci">#define X86EMUL_F_INVLPG</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00095">kvm_emulate.h:95</a></div></div>
<div class="ttc" id="akvm__emulate_8h_html_a171469346422bf35786f9bcb5385750e"><div class="ttname"><a href="kvm__emulate_8h.html#a171469346422bf35786f9bcb5385750e">X86EMUL_F_IMPLICIT</a></div><div class="ttdeci">#define X86EMUL_F_IMPLICIT</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00094">kvm_emulate.h:94</a></div></div>
<div class="ttc" id="akvm__emulate_8h_html_a6f878927bcff7757f8f673c881f19312"><div class="ttname"><a href="kvm__emulate_8h.html#a6f878927bcff7757f8f673c881f19312">X86EMUL_F_FETCH</a></div><div class="ttdeci">#define X86EMUL_F_FETCH</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00093">kvm_emulate.h:93</a></div></div>
<div class="ttc" id="ammu_8h_html_a4e90e07b62b255d32f17cdb19ba6d1d1"><div class="ttname"><a href="mmu_8h.html#a4e90e07b62b255d32f17cdb19ba6d1d1">kvm_get_active_cr3_lam_bits</a></div><div class="ttdeci">static unsigned long kvm_get_active_cr3_lam_bits(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8h_source.html#l00149">mmu.h:149</a></div></div>
<div class="ttc" id="ax86_8h_html_ada9d5e605374059a5e34c42817ed5118"><div class="ttname"><a href="x86_8h.html#ada9d5e605374059a5e34c42817ed5118">is_64_bit_mode</a></div><div class="ttdeci">static bool is_64_bit_mode(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00152">x86.h:152</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ac53159f102e6a5dacbc90a2c4666ac71_icgraph.png" border="0" usemap="#avmx_8h_ac53159f102e6a5dacbc90a2c4666ac71_icgraph" alt=""/></div>
<map name="avmx_8h_ac53159f102e6a5dacbc90a2c4666ac71_icgraph" id="avmx_8h_ac53159f102e6a5dacbc90a2c4666ac71_icgraph">
<area shape="rect" title=" " alt="" coords="1024,294,1207,321"/>
<area shape="rect" href="vmx_2nested_8c.html#a8f92d0cdc8257a39a1360af576ff3b1a" title=" " alt="" coords="797,167,976,194"/>
<area shape="rect" href="sgx_8c.html#a3db54dfc9dd26f3369c2a67756013cff" title=" " alt="" coords="814,395,959,422"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="405,15,519,42"/>
<area shape="rect" href="vmx_8c.html#af3a69581bc36e5dd88f3c37334df214d" title=" " alt="" coords="601,41,721,67"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="401,91,523,118"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="400,142,524,169"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="600,193,723,219"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="598,243,725,270"/>
<area shape="rect" href="vmx_2nested_8c.html#a6777a6616a2ebdcc07f60286e276d841" title=" " alt="" coords="573,319,749,346"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="180,211,351,252"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="5,218,132,245"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="399,294,525,321"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="400,345,524,371"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="403,395,521,422"/>
<area shape="rect" href="sgx_8c.html#a64209d7a6548174cb6fae30a7a26a194" title=" " alt="" coords="580,395,743,422"/>
<area shape="rect" href="sgx_8c.html#ad3394313e85a46c8e1bc4880ddde7fc9" title=" " alt="" coords="590,446,733,473"/>
<area shape="rect" href="sgx_8c.html#a34e5ee57c3e7c3172f8ae6ed981d703d" title=" " alt="" coords="409,446,515,473"/>
</map>
</div>

</div>
</div>
<a id="ab47d0d344e1a78767df9a1521c52f3e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab47d0d344e1a78767df9a1521c52f3e7">&#9670;&nbsp;</a></span>vmx_guest_inject_ac()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool vmx_guest_inject_ac </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l05174">5174</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;{</div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;    <span class="keywordflow">if</span> (!boot_cpu_has(X86_FEATURE_SPLIT_LOCK_DETECT))</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160; </div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="vmx_8c.html#a9a850feb9bcc4348296adc0b819ef69b">vmx_get_cpl</a>(vcpu) == 3 &amp;&amp; <a class="code" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3">kvm_is_cr0_bit_set</a>(vcpu, X86_CR0_AM) &amp;&amp;</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;           (<a class="code" href="x86_8c.html#aeca964de04721f39e3ec34f195707b5c">kvm_get_rflags</a>(vcpu) &amp; X86_EFLAGS_AC);</div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_a16b29ca8796e3da212a8faf1b2dc7ff3"><div class="ttname"><a href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3">kvm_is_cr0_bit_set</a></div><div class="ttdeci">static __always_inline bool kvm_is_cr0_bit_set(struct kvm_vcpu *vcpu, unsigned long cr0_bit)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00160">kvm_cache_regs.h:160</a></div></div>
<div class="ttc" id="avmx_8c_html_a9a850feb9bcc4348296adc0b819ef69b"><div class="ttname"><a href="vmx_8c.html#a9a850feb9bcc4348296adc0b819ef69b">vmx_get_cpl</a></div><div class="ttdeci">int vmx_get_cpl(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03543">vmx.c:3543</a></div></div>
<div class="ttc" id="ax86_8c_html_aeca964de04721f39e3ec34f195707b5c"><div class="ttname"><a href="x86_8c.html#aeca964de04721f39e3ec34f195707b5c">kvm_get_rflags</a></div><div class="ttdeci">unsigned long kvm_get_rflags(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l13170">x86.c:13170</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ab47d0d344e1a78767df9a1521c52f3e7_cgraph.png" border="0" usemap="#avmx_8h_ab47d0d344e1a78767df9a1521c52f3e7_cgraph" alt=""/></div>
<map name="avmx_8h_ab47d0d344e1a78767df9a1521c52f3e7_cgraph" id="avmx_8h_ab47d0d344e1a78767df9a1521c52f3e7_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,164,83"/>
<area shape="rect" href="x86_8c.html#aeca964de04721f39e3ec34f195707b5c" title=" " alt="" coords="224,5,347,32"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="212,56,359,83"/>
<area shape="rect" href="vmx_8c.html#a9a850feb9bcc4348296adc0b819ef69b" title=" " alt="" coords="233,107,338,133"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="671,56,817,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="913,56,1106,83"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="461,157,532,184"/>
<area shape="rect" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977" title=" " alt="" coords="407,107,587,133"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="689,208,799,235"/>
<area shape="rect" href="vmx_8c.html#a69771798b92b67f275b9be73a17f6353" title=" " alt="" coords="635,107,853,133"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="954,208,1065,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="951,259,1068,285"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="929,309,1090,336"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="950,157,1069,184"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="1165,183,1316,209"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="1185,233,1296,260"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="901,107,1117,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ab47d0d344e1a78767df9a1521c52f3e7_icgraph.png" border="0" usemap="#avmx_8h_ab47d0d344e1a78767df9a1521c52f3e7_icgraph" alt=""/></div>
<map name="avmx_8h_ab47d0d344e1a78767df9a1521c52f3e7_icgraph" id="avmx_8h_ab47d0d344e1a78767df9a1521c52f3e7_icgraph">
<area shape="rect" title=" " alt="" coords="829,31,988,57"/>
<area shape="rect" href="vmx_8c.html#a7a38ddbd01bec99bf94ab4868ad4c6ea" title=" " alt="" coords="597,5,767,32"/>
<area shape="rect" href="vmx_2nested_8c.html#ad83a41b6ce947fa24f8accde49c38aa0" title=" " alt="" coords="583,56,781,83"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="384,49,535,90"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="188,56,336,83"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,56,140,83"/>
</map>
</div>

</div>
</div>
<a id="abf810bd0c2816f1b62bf2a79296358cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf810bd0c2816f1b62bf2a79296358cf">&#9670;&nbsp;</a></span>vmx_guest_state_valid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool vmx_guest_state_valid </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00735">735</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;{</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec">is_unrestricted_guest</a>(vcpu) || <a class="code" href="vmx_8h.html#a77b0ca4dac426b317965746a6bec345e">__vmx_guest_state_valid</a>(vcpu);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;}</div>
<div class="ttc" id="avmx_8h_html_a77b0ca4dac426b317965746a6bec345e"><div class="ttname"><a href="vmx_8h.html#a77b0ca4dac426b317965746a6bec345e">__vmx_guest_state_valid</a></div><div class="ttdeci">bool __vmx_guest_state_valid(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03796">vmx.c:3796</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_abf810bd0c2816f1b62bf2a79296358cf_cgraph.png" border="0" usemap="#avmx_8h_abf810bd0c2816f1b62bf2a79296358cf_cgraph" alt=""/></div>
<map name="avmx_8h_abf810bd0c2816f1b62bf2a79296358cf_cgraph" id="avmx_8h_abf810bd0c2816f1b62bf2a79296358cf_cgraph">
<area shape="rect" title=" " alt="" coords="5,411,179,437"/>
<area shape="rect" href="vmx_8h.html#a77b0ca4dac426b317965746a6bec345e" title=" " alt="" coords="227,284,413,311"/>
<area shape="rect" href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec" title=" " alt="" coords="239,512,401,539"/>
<area shape="rect" href="vmx_8c.html#a53b41b0e13efa39a027845ff9af21ed6" title=" " alt="" coords="467,360,623,387"/>
<area shape="rect" href="vmx_8c.html#ad56726eeac472ac5b038651ccffbb6f4" title=" " alt="" coords="481,411,608,437"/>
<area shape="rect" href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d" title=" " alt="" coords="467,461,622,488"/>
<area shape="rect" href="x86_8h.html#a134b4e55e4ea92a3519e9538f05d4e6b" title=" " alt="" coords="493,43,596,69"/>
<area shape="rect" href="vmx_8c.html#a1c712b1524bbb5ba769fb529614d5c35" title=" " alt="" coords="503,208,586,235"/>
<area shape="rect" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f" title=" " alt="" coords="461,157,628,184"/>
<area shape="rect" href="vmx_8c.html#abdb19ee07646c48c401dad49fae9c607" title=" " alt="" coords="465,259,625,285"/>
<area shape="rect" href="vmx_8c.html#ae22de32cadb09c91caa1acb52293f01f" title=" " alt="" coords="509,309,580,336"/>
<area shape="rect" href="vmx_8c.html#adf1cae1921d1492c7e06115012eb48e3" title=" " alt="" coords="698,107,821,133"/>
<area shape="rect" href="vmx_8c.html#acfb1910d98db4bcd82dd9a96eb069ce9" title=" " alt="" coords="688,313,831,340"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="955,208,1025,235"/>
<area shape="rect" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977" title=" " alt="" coords="900,376,1080,403"/>
<area shape="rect" href="vmx_8c.html#a911b88947099c0d21f8fbeca202ea30f" title=" " alt="" coords="891,259,1089,285"/>
<area shape="rect" href="vmx_8c.html#ab9185adefc641ff428164a7fcab15c45" title=" " alt="" coords="910,310,1070,351"/>
<area shape="rect" href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc" title=" " alt="" coords="910,427,1070,469"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="1192,341,1301,368"/>
<area shape="rect" href="vmx_8c.html#a69771798b92b67f275b9be73a17f6353" title=" " alt="" coords="1137,212,1356,239"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="1457,416,1567,443"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="1453,315,1571,341"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="1431,365,1593,392"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="1453,264,1571,291"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="1668,391,1819,417"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="1688,441,1799,468"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1415,56,1609,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="1404,108,1620,135"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="1198,263,1295,289"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="1453,163,1571,189"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="1459,213,1565,240"/>
<area shape="rect" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7" title=" " alt="" coords="1192,435,1301,461"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a77b65dd311c34381a8508de99e9b8543" title=" " alt="" coords="1453,467,1571,493"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="1453,517,1571,544"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="686,31,833,57"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="1174,5,1319,32"/>
<area shape="rect" href="vmx_8c.html#a0a4bc0d90ba4aa4d6e9758f35cd84261" title=" " alt="" coords="676,158,843,199"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="485,563,605,589"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_abf810bd0c2816f1b62bf2a79296358cf_icgraph.png" border="0" usemap="#avmx_8h_abf810bd0c2816f1b62bf2a79296358cf_icgraph" alt=""/></div>
<map name="avmx_8h_abf810bd0c2816f1b62bf2a79296358cf_icgraph" id="avmx_8h_abf810bd0c2816f1b62bf2a79296358cf_icgraph">
<area shape="rect" title=" " alt="" coords="1767,43,1940,69"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,68,138,95"/>
<area shape="rect" href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5" title=" " alt="" coords="1533,93,1719,120"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="1112,144,1295,171"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1361,93,1467,120"/>
<area shape="rect" href="vmx_8c.html#ae81f31c4be3384219d11e767cca4da94" title=" " alt="" coords="1353,595,1475,621"/>
<area shape="rect" href="vmx_8c.html#a9e72f6be0ed4dafcb17b8fb874a39d58" title=" " alt="" coords="1343,43,1485,69"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,357,853,384"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,533,361,560"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,613,604,640"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,145,631,186"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,379,651,421"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,437,387,464"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,497,618,538"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,211,633,237"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,262,635,303"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,328,615,355"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,533,140,560"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,885,373,926"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,892,136,919"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,145,369,186"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,379,374,405"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,277,343,304"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,328,372,355"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,379,134,405"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="905,262,1060,303"/>
<area shape="rect" href="sgx_8c.html#ad3394313e85a46c8e1bc4880ddde7fc9" title=" " alt="" coords="1132,595,1275,621"/>
<area shape="rect" href="vmx_2nested_8c.html#a46021f02931b3001ef00a526b56448a8" title=" " alt="" coords="1116,777,1291,804"/>
<area shape="rect" href="vmx_2nested_8c.html#aec3ff66d7b1e9086f727ebe6b9b1a0cf" title=" " alt="" coords="1122,853,1285,880"/>
<area shape="rect" href="vmx_2nested_8c.html#a3c80ece98832af9587ecff9947817449" title=" " alt="" coords="901,968,1064,995"/>
<area shape="rect" href="sgx_8c.html#a34e5ee57c3e7c3172f8ae6ed981d703d" title=" " alt="" coords="929,595,1036,621"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="715,816,837,843"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="713,867,839,893"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="717,765,835,792"/>
<area shape="rect" href="vmx_2nested_8c.html#a4d1da86d40e5c09521979006a05a35e4" title=" " alt="" coords="917,917,1048,944"/>
<area shape="rect" href="vmx_2nested_8c.html#add1e82c32385142c0fca04a1db8cbc3a" title=" " alt="" coords="711,715,841,741"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="719,968,833,995"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="715,1019,837,1045"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="713,1069,839,1096"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="714,917,838,944"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fecee9010894e3a1513a0924e24dd6" title=" " alt="" coords="474,664,611,691"/>
<area shape="rect" href="vmx_2nested_8c.html#a23e3de8c964e87404eea818be6f70154" title=" " alt="" coords="471,715,614,741"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="481,1120,605,1147"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="717,1171,835,1197"/>
</map>
</div>

</div>
</div>
<a id="a30a85cb14e27b953155d81e64a74e8f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30a85cb14e27b953155d81e64a74e8f5">&#9670;&nbsp;</a></span>vmx_has_waitpkg()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool vmx_has_waitpkg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *&#160;</td>
          <td class="paramname"><em>vmx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00713">713</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;{</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">return</span> secondary_exec_controls_get(vmx) &amp;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        SECONDARY_EXEC_ENABLE_USR_WAIT_PAUSE;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a30a85cb14e27b953155d81e64a74e8f5_icgraph.png" border="0" usemap="#avmx_8h_a30a85cb14e27b953155d81e64a74e8f5_icgraph" alt=""/></div>
<map name="avmx_8h_a30a85cb14e27b953155d81e64a74e8f5_icgraph" id="avmx_8h_a30a85cb14e27b953155d81e64a74e8f5_icgraph">
<area shape="rect" title=" " alt="" coords="164,31,304,57"/>
<area shape="rect" href="vmx_8c.html#ab6b2c94ee2868acf5be3ac9b3e02e441" title=" " alt="" coords="5,5,116,32"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="5,56,116,83"/>
</map>
</div>

</div>
</div>
<a id="a368d7a25f0cc51f62229282a5d2550d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a368d7a25f0cc51f62229282a5d2550d3">&#9670;&nbsp;</a></span>vmx_interrupt_blocked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool vmx_interrupt_blocked </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l05050">5050</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;{</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(vcpu) &amp;&amp; <a class="code" href="svm_8h.html#a13cbed806a9638fcaab4d01cb926d141">nested_exit_on_intr</a>(vcpu))</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160; </div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;    <span class="keywordflow">return</span> !(<a class="code" href="vmx_8c.html#adf1cae1921d1492c7e06115012eb48e3">vmx_get_rflags</a>(vcpu) &amp; X86_EFLAGS_IF) ||</div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;           (<a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(GUEST_INTERRUPTIBILITY_INFO) &amp;</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;        (GUEST_INTR_STATE_STI | GUEST_INTR_STATE_MOV_SS));</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;}</div>
<div class="ttc" id="asvm_8h_html_a13cbed806a9638fcaab4d01cb926d141"><div class="ttname"><a href="svm_8h.html#a13cbed806a9638fcaab4d01cb926d141">nested_exit_on_intr</a></div><div class="ttdeci">static bool nested_exit_on_intr(struct vcpu_svm *svm)</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00581">svm.h:581</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a368d7a25f0cc51f62229282a5d2550d3_cgraph.png" border="0" usemap="#avmx_8h_a368d7a25f0cc51f62229282a5d2550d3_cgraph" alt=""/></div>
<map name="avmx_8h_a368d7a25f0cc51f62229282a5d2550d3_cgraph" id="avmx_8h_a368d7a25f0cc51f62229282a5d2550d3_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,176,108"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="239,5,359,32"/>
<area shape="rect" href="svm_8h.html#a13cbed806a9638fcaab4d01cb926d141" title=" " alt="" coords="224,56,375,83"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="476,107,585,133"/>
<area shape="rect" href="vmx_8c.html#adf1cae1921d1492c7e06115012eb48e3" title=" " alt="" coords="238,208,361,235"/>
<area shape="rect" href="svm_8h.html#a5deff43556f8c807c64def073cd548e4" title=" " alt="" coords="452,56,609,83"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="712,132,823,159"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="709,31,826,57"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="687,183,848,209"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="708,81,827,108"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="896,107,1047,133"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="916,157,1027,184"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="434,309,627,336"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="423,157,639,184"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="495,259,566,285"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="482,208,579,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="709,233,826,260"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="714,284,821,311"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a368d7a25f0cc51f62229282a5d2550d3_icgraph.png" border="0" usemap="#avmx_8h_a368d7a25f0cc51f62229282a5d2550d3_icgraph" alt=""/></div>
<map name="avmx_8h_a368d7a25f0cc51f62229282a5d2550d3_icgraph" id="avmx_8h_a368d7a25f0cc51f62229282a5d2550d3_icgraph">
<area shape="rect" title=" " alt="" coords="631,102,801,129"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="188,14,336,41"/>
<area shape="rect" href="vmx_8c.html#a826652b83d0f8797a169f7839596c178" title=" " alt="" coords="403,36,563,77"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="384,102,583,129"/>
<area shape="rect" href="vmx_8c.html#a8b92a5c83267fa843483b8277bc73f30" title=" " alt="" coords="397,153,569,179"/>
<area shape="rect" href="posted__intr_8c.html#aa59b00f36d985abaa19009096d1f66a4" title=" " alt="" coords="415,203,551,230"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,14,140,41"/>
<area shape="rect" href="vmx_8c.html#a65248f7343c2ee3dfdfeb6388e80ab9b" title=" " alt="" coords="203,203,321,230"/>
</map>
</div>

</div>
</div>
<a id="a913cb1eefe82444089f3acdd68ba512d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a913cb1eefe82444089f3acdd68ba512d">&#9670;&nbsp;</a></span>vmx_l1_guest_owned_cr0_bits()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned long vmx_l1_guest_owned_cr0_bits </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00634">634</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;{</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> bits = <a class="code" href="kvm__cache__regs_8h.html#a88f7cbc42fe5bd05205a6cdec3e4f42c">KVM_POSSIBLE_CR0_GUEST_BITS</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">     * CR0.WP needs to be intercepted when KVM is shadowing legacy paging</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">     * in order to construct shadow PTEs with the correct protections.</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">     * Note!  CR0.WP technically can be passed through to the guest if</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">     * paging is disabled, but checking CR0.PG would generate a cyclical</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">     * dependency of sorts due to forcing the caller to ensure CR0 holds</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">     * the correct value prior to determining which CR0 bits can be owned</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">     * by L1.  Keep it simple and limit the optimization to EPT.</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="capabilities_8h.html#abf08136dbf993f207b5536a18082c6ed">enable_ept</a>)</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        bits &amp;= ~X86_CR0_WP;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">return</span> bits;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;}</div>
<div class="ttc" id="acapabilities_8h_html_abf08136dbf993f207b5536a18082c6ed"><div class="ttname"><a href="capabilities_8h.html#abf08136dbf993f207b5536a18082c6ed">enable_ept</a></div><div class="ttdeci">bool __read_mostly enable_ept</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00091">vmx.c:91</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_a88f7cbc42fe5bd05205a6cdec3e4f42c"><div class="ttname"><a href="kvm__cache__regs_8h.html#a88f7cbc42fe5bd05205a6cdec3e4f42c">KVM_POSSIBLE_CR0_GUEST_BITS</a></div><div class="ttdeci">#define KVM_POSSIBLE_CR0_GUEST_BITS</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00007">kvm_cache_regs.h:7</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a913cb1eefe82444089f3acdd68ba512d_icgraph.png" border="0" usemap="#avmx_8h_a913cb1eefe82444089f3acdd68ba512d_icgraph" alt=""/></div>
<map name="avmx_8h_a913cb1eefe82444089f3acdd68ba512d_icgraph" id="avmx_8h_a913cb1eefe82444089f3acdd68ba512d_icgraph">
<area shape="rect" title=" " alt="" coords="1132,199,1295,241"/>
<area shape="rect" href="vmx_8c.html#ad9c0f9053e0fe647a367166a4b6a0c6f" title=" " alt="" coords="950,65,1035,92"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,207,1084,233"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,258,1070,299"/>
<area shape="rect" href="vmx_8c.html#abd63cf398d1b18c9be4e9c4eae17c64c" title=" " alt="" coords="705,36,847,63"/>
<area shape="rect" href="vmx_8c.html#a8d0fa5e317cbd0eb67ebdc9fa5ec70ce" title=" " alt="" coords="478,5,607,32"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,265,853,292"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,83,361,109"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,173,604,200"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,225,631,266"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,290,651,331"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,327,387,353"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,107,618,149"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,407,633,433"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,458,635,499"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,524,615,551"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,83,140,109"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,163,373,205"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,171,136,197"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,229,369,270"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,236,138,263"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,473,374,500"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,524,343,551"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,575,372,601"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,473,134,500"/>
</map>
</div>

</div>
</div>
<a id="a046cd100cd1f1b77bfa5ba028dcd52ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a046cd100cd1f1b77bfa5ba028dcd52ff">&#9670;&nbsp;</a></span>vmx_need_pf_intercept()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool vmx_need_pf_intercept </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00719">719</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;{</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="capabilities_8h.html#abf08136dbf993f207b5536a18082c6ed">enable_ept</a>)</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="vmx_8c.html#a81470553890562f7758333794b26f1ec">allow_smaller_maxphyaddr</a> &amp;&amp; <a class="code" href="cpuid_8h.html#a1678e00b10264045277c1abfcb6eec3e">cpuid_maxphyaddr</a>(vcpu) &lt; boot_cpu_data.x86_phys_bits;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;}</div>
<div class="ttc" id="acpuid_8h_html_a1678e00b10264045277c1abfcb6eec3e"><div class="ttname"><a href="cpuid_8h.html#a1678e00b10264045277c1abfcb6eec3e">cpuid_maxphyaddr</a></div><div class="ttdeci">static int cpuid_maxphyaddr(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="cpuid_8h_source.html#l00040">cpuid.h:40</a></div></div>
<div class="ttc" id="avmx_8c_html_a81470553890562f7758333794b26f1ec"><div class="ttname"><a href="vmx_8c.html#a81470553890562f7758333794b26f1ec">allow_smaller_maxphyaddr</a></div><div class="ttdeci">bool __read_mostly allow_smaller_maxphyaddr</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l00232">x86.c:232</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a046cd100cd1f1b77bfa5ba028dcd52ff_cgraph.png" border="0" usemap="#avmx_8h_a046cd100cd1f1b77bfa5ba028dcd52ff_cgraph" alt=""/></div>
<map name="avmx_8h_a046cd100cd1f1b77bfa5ba028dcd52ff_cgraph" id="avmx_8h_a046cd100cd1f1b77bfa5ba028dcd52ff_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,180,32"/>
<area shape="rect" href="cpuid_8h.html#a1678e00b10264045277c1abfcb6eec3e" title=" " alt="" coords="228,5,375,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a046cd100cd1f1b77bfa5ba028dcd52ff_icgraph.png" border="0" usemap="#avmx_8h_a046cd100cd1f1b77bfa5ba028dcd52ff_icgraph" alt=""/></div>
<map name="avmx_8h_a046cd100cd1f1b77bfa5ba028dcd52ff_icgraph" id="avmx_8h_a046cd100cd1f1b77bfa5ba028dcd52ff_icgraph">
<area shape="rect" title=" " alt="" coords="1811,560,1985,587"/>
<area shape="rect" href="vmx_2nested_8c.html#ad83a41b6ce947fa24f8accde49c38aa0" title=" " alt="" coords="1140,5,1339,32"/>
<area shape="rect" href="vmx_2nested_8c.html#aa9419b385a2c58c246195d3106c57afc" title=" " alt="" coords="699,760,861,787"/>
<area shape="rect" href="vmx_8c.html#a6ddb2979d2cb226fe63f24b99f88a99e" title=" " alt="" coords="1588,553,1763,594"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,158,618,199"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,212,361,239"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,212,140,239"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,651,138,677"/>
<area shape="rect" href="vmx_8c.html#a5b0ffadb6f1bbf0fe42d6cf7a17490bb" title=" " alt="" coords="1409,560,1517,587"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,56,343,83"/>
<area shape="rect" href="vmx_8c.html#ac744bdcb0b42778132eaeb180e29e70c" title=" " alt="" coords="1411,509,1516,536"/>
<area shape="rect" href="vmx_8c.html#a8ff77baa2f28fd717210bcac02a13434" title=" " alt="" coords="1387,694,1540,735"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1187,509,1292,536"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="909,400,1092,427"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="923,485,1078,526"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="703,384,857,411"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,275,604,301"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,442,631,483"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,377,651,418"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,359,387,385"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,508,633,535"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,559,635,601"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,107,615,133"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,267,373,309"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,275,136,301"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,501,369,542"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,107,374,133"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,157,372,184"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,107,134,133"/>
</map>
</div>

</div>
</div>
<a id="ae92f23c5709cc4f9fe4fe2d794deef50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae92f23c5709cc4f9fe4fe2d794deef50">&#9670;&nbsp;</a></span>vmx_nmi_blocked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool vmx_nmi_blocked </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l05025">5025</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;{</div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(vcpu) &amp;&amp; <a class="code" href="svm_8h.html#aefa7c9e670f5a86519f40b06f5277346">nested_exit_on_nmi</a>(vcpu))</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160; </div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a6c57cc8c0f93a3ea3e5dc56c0092a71c">enable_vnmi</a> &amp;&amp; <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(vcpu)-&gt;<a class="code" href="structloaded__vmcs.html">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#abee15264dfc3d58548c9c9e2a7db3b93">soft_vnmi_blocked</a>)</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160; </div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(GUEST_INTERRUPTIBILITY_INFO) &amp;</div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;        (GUEST_INTR_STATE_MOV_SS | GUEST_INTR_STATE_STI |</div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;         GUEST_INTR_STATE_NMI));</div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;}</div>
<div class="ttc" id="asvm_8h_html_aefa7c9e670f5a86519f40b06f5277346"><div class="ttname"><a href="svm_8h.html#aefa7c9e670f5a86519f40b06f5277346">nested_exit_on_nmi</a></div><div class="ttdeci">static bool nested_exit_on_nmi(struct vcpu_svm *svm)</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00586">svm.h:586</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ae92f23c5709cc4f9fe4fe2d794deef50_cgraph.png" border="0" usemap="#avmx_8h_ae92f23c5709cc4f9fe4fe2d794deef50_cgraph" alt=""/></div>
<map name="avmx_8h_ae92f23c5709cc4f9fe4fe2d794deef50_cgraph" id="avmx_8h_ae92f23c5709cc4f9fe4fe2d794deef50_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,145,108"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="210,5,330,32"/>
<area shape="rect" href="svm_8h.html#aefa7c9e670f5a86519f40b06f5277346" title=" " alt="" coords="193,56,347,83"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="235,107,305,133"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="215,157,325,184"/>
<area shape="rect" href="svm_8h.html#a5deff43556f8c807c64def073cd548e4" title=" " alt="" coords="397,56,554,83"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="420,107,531,133"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="417,157,534,184"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="395,208,556,235"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="416,259,535,285"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="604,81,755,108"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="624,132,735,159"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ae92f23c5709cc4f9fe4fe2d794deef50_icgraph.png" border="0" usemap="#avmx_8h_ae92f23c5709cc4f9fe4fe2d794deef50_icgraph" alt=""/></div>
<map name="avmx_8h_ae92f23c5709cc4f9fe4fe2d794deef50_icgraph" id="avmx_8h_ae92f23c5709cc4f9fe4fe2d794deef50_icgraph">
<area shape="rect" title=" " alt="" coords="252,31,392,57"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="5,5,204,32"/>
<area shape="rect" href="vmx_8c.html#a4546be655e5968c462322858ecf68c49" title=" " alt="" coords="34,56,175,83"/>
</map>
</div>

</div>
</div>
<a id="aafa008ad34eb88ebd13aa2f76375cad2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafa008ad34eb88ebd13aa2f76375cad2">&#9670;&nbsp;</a></span>vmx_passthrough_lbr_msrs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_passthrough_lbr_msrs </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu__intel_8c_source.html#l00713">713</a> of file <a class="el" href="pmu__intel_8c_source.html">pmu_intel.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;{</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keyword">struct </span>kvm_pmu *pmu = <a class="code" href="pmu_8h.html#ac1c6bc4b1435215c1bd1b1b9583c6441">vcpu_to_pmu</a>(vcpu);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keyword">struct </span><a class="code" href="structlbr__desc.html">lbr_desc</a> *<a class="code" href="structlbr__desc.html">lbr_desc</a> = <a class="code" href="vmx_8h.html#aa3f9a4735e6ff00497c0086664b433bd">vcpu_to_lbr_desc</a>(vcpu);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structlbr__desc.html">lbr_desc</a>-&gt;<a class="code" href="structlbr__desc.html#a385c74465d1b6562bbb44cd6b9149b13">event</a>) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <a class="code" href="pmu__intel_8c.html#af9cb9956f1ba92178a027529a50d711d">vmx_disable_lbr_msrs_passthrough</a>(vcpu);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663">vmcs_read64</a>(GUEST_IA32_DEBUGCTL) &amp; DEBUGCTLMSR_LBR)</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <span class="keywordflow">goto</span> warn;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">if</span> (test_bit(INTEL_PMC_IDX_FIXED_VLBR, pmu-&gt;pmc_in_use))</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="keywordflow">goto</span> warn;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structlbr__desc.html">lbr_desc</a>-&gt;<a class="code" href="structlbr__desc.html#a385c74465d1b6562bbb44cd6b9149b13">event</a>-&gt;state &lt; PERF_EVENT_STATE_ACTIVE) {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <a class="code" href="pmu__intel_8c.html#af9cb9956f1ba92178a027529a50d711d">vmx_disable_lbr_msrs_passthrough</a>(vcpu);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        __clear_bit(INTEL_PMC_IDX_FIXED_VLBR, pmu-&gt;pmc_in_use);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="keywordflow">goto</span> warn;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <a class="code" href="pmu__intel_8c.html#a5f05da2ad8fa10c5a20b5c9daa506b71">vmx_enable_lbr_msrs_passthrough</a>(vcpu);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;warn:</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    pr_warn_ratelimited(<span class="stringliteral">&quot;vcpu-%d: fail to passthrough LBR.\n&quot;</span>, vcpu-&gt;vcpu_id);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;}</div>
<div class="ttc" id="apmu__intel_8c_html_a5f05da2ad8fa10c5a20b5c9daa506b71"><div class="ttname"><a href="pmu__intel_8c.html#a5f05da2ad8fa10c5a20b5c9daa506b71">vmx_enable_lbr_msrs_passthrough</a></div><div class="ttdeci">static void vmx_enable_lbr_msrs_passthrough(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu__intel_8c_source.html#l00692">pmu_intel.c:692</a></div></div>
<div class="ttc" id="apmu__intel_8c_html_af9cb9956f1ba92178a027529a50d711d"><div class="ttname"><a href="pmu__intel_8c.html#af9cb9956f1ba92178a027529a50d711d">vmx_disable_lbr_msrs_passthrough</a></div><div class="ttdeci">static void vmx_disable_lbr_msrs_passthrough(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu__intel_8c_source.html#l00681">pmu_intel.c:681</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aafa008ad34eb88ebd13aa2f76375cad2_cgraph.png" border="0" usemap="#avmx_8h_aafa008ad34eb88ebd13aa2f76375cad2_cgraph" alt=""/></div>
<map name="avmx_8h_aafa008ad34eb88ebd13aa2f76375cad2_cgraph" id="avmx_8h_aafa008ad34eb88ebd13aa2f76375cad2_cgraph">
<area shape="rect" title=" " alt="" coords="5,85,207,112"/>
<area shape="rect" href="vmx_8h.html#aa3f9a4735e6ff00497c0086664b433bd" title=" " alt="" coords="953,43,1087,69"/>
<area shape="rect" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663" title=" " alt="" coords="284,413,393,440"/>
<area shape="rect" href="pmu__intel_8c.html#af9cb9956f1ba92178a027529a50d711d" title=" " alt="" coords="255,45,423,86"/>
<area shape="rect" href="pmu__intel_8c.html#a5f05da2ad8fa10c5a20b5c9daa506b71" title=" " alt="" coords="256,110,421,151"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="1216,43,1287,69"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="499,413,610,440"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="496,464,613,491"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="1398,257,1559,284"/>
<area shape="rect" href="vmx__ops_8h.html#a482358473ceab579ad9c93b46e13fe25" title=" " alt="" coords="495,515,614,541"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="711,413,862,440"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="731,464,842,491"/>
<area shape="rect" href="pmu__intel_8c.html#a95acf04271d030c775698a08e8b498ff" title=" " alt="" coords="471,73,639,114"/>
<area shape="rect" href="vmx_8h.html#a499f1757999ae37f448bbadf72448fa4" title=" " alt="" coords="711,76,863,103"/>
<area shape="rect" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20" title=" " alt="" coords="687,189,887,216"/>
<area shape="rect" href="vmx_8h.html#a96f48e7f7fd7a33ba502bea65d7a94d8" title=" " alt="" coords="935,182,1105,223"/>
<area shape="rect" href="vmx_8h.html#a3db9d3d67497234d969c753d0b1093ab" title=" " alt="" coords="937,106,1103,147"/>
<area shape="rect" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b" title=" " alt="" coords="1153,211,1349,237"/>
<area shape="rect" href="vmx_8c.html#a5742d1df3fb94e98dd1a0f0443b529a4" title=" " alt="" coords="1156,93,1347,120"/>
<area shape="rect" href="vmx_8c.html#aa4973cf70be6e2559648a74eab4987a5" title=" " alt="" coords="1397,86,1560,127"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="1181,312,1322,339"/>
<area shape="rect" href="vmx_8c.html#a4322412ccf65775174621cab858dd234" title=" " alt="" coords="1170,145,1333,186"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_aafa008ad34eb88ebd13aa2f76375cad2_icgraph.png" border="0" usemap="#avmx_8h_aafa008ad34eb88ebd13aa2f76375cad2_icgraph" alt=""/></div>
<map name="avmx_8h_aafa008ad34eb88ebd13aa2f76375cad2_icgraph" id="avmx_8h_aafa008ad34eb88ebd13aa2f76375cad2_icgraph">
<area shape="rect" title=" " alt="" coords="171,5,372,32"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="5,5,123,32"/>
</map>
</div>

</div>
</div>
<a id="a85334c5190ac8bc72072279809aee495"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85334c5190ac8bc72072279809aee495">&#9670;&nbsp;</a></span>vmx_prepare_switch_to_guest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_prepare_switch_to_guest </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01282">1282</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;{</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvmcs__host__state.html">vmcs_host_state</a> *host_state;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keywordtype">int</span> cpu = raw_smp_processor_id();</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structvmcs__host__state.html#a8a54b9cfa2cc63748a07f013841ddf5b">fs_base</a>, <a class="code" href="structvmcs__host__state.html#aa3421c5111f5ebfcf6fb0b52125a6d2a">gs_base</a>;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    u16 <a class="code" href="structvmcs__host__state.html#a068e39a58f72db1f2f6733813a86eee1">fs_sel</a>, <a class="code" href="structvmcs__host__state.html#adc2cf053f2b5cec448b349479e399b20">gs_sel</a>;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160; </div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    vmx-&gt;<a class="code" href="structvcpu__vmx.html#abb1e1fef2da94abf9b00991b626dca95">req_immediate_exit</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160; </div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">     * Note that guest MSRs to be saved/restored can also be changed</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment">     * when guest state is loaded. This happens when guest transitions</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">     * to/from long-mode by setting MSR_EFER.LMA.</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">if</span> (!vmx-&gt;<a class="code" href="structvcpu__vmx.html#aaf9fce1f0be34d4c38353849054fa37d">guest_uret_msrs_loaded</a>) {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#aaf9fce1f0be34d4c38353849054fa37d">guest_uret_msrs_loaded</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="x86_8c.html#a86e3ff5e39a75facecd859a8c16f2740">kvm_nr_uret_msrs</a>; ++i) {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="keywordflow">if</span> (!vmx-&gt;<a class="code" href="structvcpu__vmx.html#a194feb51e54aef61ef56078dfe5b2dae">guest_uret_msrs</a>[i].<a class="code" href="structvmx__uret__msr.html#a811b76f607850bacd80c71ac5151cfba">load_into_hardware</a>)</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160; </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <a class="code" href="x86_8c.html#af6db8fdfb7625ba5b530e59102ab2520">kvm_set_user_return_msr</a>(i,</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a194feb51e54aef61ef56078dfe5b2dae">guest_uret_msrs</a>[i].<a class="code" href="structvmx__uret__msr.html#a82094ef35edea8b2512790fda85d803e">data</a>,</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a194feb51e54aef61ef56078dfe5b2dae">guest_uret_msrs</a>[i].<a class="code" href="structvmx__uret__msr.html#a075609250cf77684ebfd96c70faff7a2">mask</a>);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    }</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160; </div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a8c239bf06e666ec62b7ff19f1e2966bf">nested</a>.<a class="code" href="structnested__vmx.html#abce6aeda58a1627a5f0c29cf5815343e">need_vmcs12_to_shadow_sync</a>)</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <a class="code" href="vmx_2nested_8c.html#aafc435d13c9681dd613719dc3c209e02">nested_sync_vmcs12_to_shadow</a>(vcpu);</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160; </div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#ac58808325c1cf34fcb9e68195742894c">guest_state_loaded</a>)</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    host_state = &amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a058c58b6c534321752261fcb9271bd74">host_state</a>;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160; </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">     * Set host fs and gs selectors.  Unfortunately, 22.2.3 does not</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">     * allow segment selectors with cpl &gt; 0 or ti == 1.</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    host_state-&gt;<a class="code" href="structvmcs__host__state.html#a9d80b1c5e88c649561f417644da9e6a8">ldt_sel</a> = kvm_read_ldt();</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; </div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    savesegment(ds, host_state-&gt;ds_sel);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    savesegment(es, host_state-&gt;es_sel);</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <a class="code" href="structvmcs__host__state.html#aa3421c5111f5ebfcf6fb0b52125a6d2a">gs_base</a> = cpu_kernelmode_gs_base(cpu);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordflow">if</span> (likely(is_64bit_mm(current-&gt;mm))) {</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        current_save_fsgs();</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <a class="code" href="structvmcs__host__state.html#a068e39a58f72db1f2f6733813a86eee1">fs_sel</a> = current-&gt;thread.fsindex;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <a class="code" href="structvmcs__host__state.html#adc2cf053f2b5cec448b349479e399b20">gs_sel</a> = current-&gt;thread.gsindex;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <a class="code" href="structvmcs__host__state.html#a8a54b9cfa2cc63748a07f013841ddf5b">fs_base</a> = current-&gt;thread.fsbase;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        vmx-&gt;msr_host_kernel_gs_base = current-&gt;thread.gsbase;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        savesegment(fs, <a class="code" href="structvmcs__host__state.html#a068e39a58f72db1f2f6733813a86eee1">fs_sel</a>);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        savesegment(gs, <a class="code" href="structvmcs__host__state.html#adc2cf053f2b5cec448b349479e399b20">gs_sel</a>);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        <a class="code" href="structvmcs__host__state.html#a8a54b9cfa2cc63748a07f013841ddf5b">fs_base</a> = read_msr(MSR_FS_BASE);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        vmx-&gt;msr_host_kernel_gs_base = read_msr(MSR_KERNEL_GS_BASE);</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    }</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    wrmsrl(MSR_KERNEL_GS_BASE, vmx-&gt;msr_guest_kernel_gs_base);</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    savesegment(fs, <a class="code" href="structvmcs__host__state.html#a068e39a58f72db1f2f6733813a86eee1">fs_sel</a>);</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    savesegment(gs, <a class="code" href="structvmcs__host__state.html#adc2cf053f2b5cec448b349479e399b20">gs_sel</a>);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <a class="code" href="structvmcs__host__state.html#a8a54b9cfa2cc63748a07f013841ddf5b">fs_base</a> = segment_base(<a class="code" href="structvmcs__host__state.html#a068e39a58f72db1f2f6733813a86eee1">fs_sel</a>);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <a class="code" href="structvmcs__host__state.html#aa3421c5111f5ebfcf6fb0b52125a6d2a">gs_base</a> = segment_base(<a class="code" href="structvmcs__host__state.html#adc2cf053f2b5cec448b349479e399b20">gs_sel</a>);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160; </div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <a class="code" href="vmx_8c.html#a632e0045640f1fb4b490db30ca2baabf">vmx_set_host_fs_gs</a>(host_state, <a class="code" href="structvmcs__host__state.html#a068e39a58f72db1f2f6733813a86eee1">fs_sel</a>, <a class="code" href="structvmcs__host__state.html#adc2cf053f2b5cec448b349479e399b20">gs_sel</a>, <a class="code" href="structvmcs__host__state.html#a8a54b9cfa2cc63748a07f013841ddf5b">fs_base</a>, <a class="code" href="structvmcs__host__state.html#aa3421c5111f5ebfcf6fb0b52125a6d2a">gs_base</a>);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    vmx-&gt;<a class="code" href="structvcpu__vmx.html#ac58808325c1cf34fcb9e68195742894c">guest_state_loaded</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;}</div>
<div class="ttc" id="astructnested__vmx_html_abce6aeda58a1627a5f0c29cf5815343e"><div class="ttname"><a href="structnested__vmx.html#abce6aeda58a1627a5f0c29cf5815343e">nested_vmx::need_vmcs12_to_shadow_sync</a></div><div class="ttdeci">bool need_vmcs12_to_shadow_sync</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00151">vmx.h:151</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_a8c239bf06e666ec62b7ff19f1e2966bf"><div class="ttname"><a href="structvcpu__vmx.html#a8c239bf06e666ec62b7ff19f1e2966bf">vcpu_vmx::nested</a></div><div class="ttdeci">struct nested_vmx nested</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00318">vmx.h:329</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_aaf9fce1f0be34d4c38353849054fa37d"><div class="ttname"><a href="structvcpu__vmx.html#aaf9fce1f0be34d4c38353849054fa37d">vcpu_vmx::guest_uret_msrs_loaded</a></div><div class="ttdeci">bool guest_uret_msrs_loaded</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00277">vmx.h:277</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_abb1e1fef2da94abf9b00991b626dca95"><div class="ttname"><a href="structvcpu__vmx.html#abb1e1fef2da94abf9b00991b626dca95">vcpu_vmx::req_immediate_exit</a></div><div class="ttdeci">bool req_immediate_exit</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00335">vmx.h:335</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_ac58808325c1cf34fcb9e68195742894c"><div class="ttname"><a href="structvcpu__vmx.html#ac58808325c1cf34fcb9e68195742894c">vcpu_vmx::guest_state_loaded</a></div><div class="ttdeci">bool guest_state_loaded</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00263">vmx.h:263</a></div></div>
<div class="ttc" id="astructvmcs__host__state_html_a068e39a58f72db1f2f6733813a86eee1"><div class="ttname"><a href="structvmcs__host__state.html#a068e39a58f72db1f2f6733813a86eee1">vmcs_host_state::fs_sel</a></div><div class="ttdeci">u16 fs_sel</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00041">vmcs.h:41</a></div></div>
<div class="ttc" id="astructvmcs__host__state_html_a8a54b9cfa2cc63748a07f013841ddf5b"><div class="ttname"><a href="structvmcs__host__state.html#a8a54b9cfa2cc63748a07f013841ddf5b">vmcs_host_state::fs_base</a></div><div class="ttdeci">unsigned long fs_base</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00038">vmcs.h:38</a></div></div>
<div class="ttc" id="astructvmcs__host__state_html_a9d80b1c5e88c649561f417644da9e6a8"><div class="ttname"><a href="structvmcs__host__state.html#a9d80b1c5e88c649561f417644da9e6a8">vmcs_host_state::ldt_sel</a></div><div class="ttdeci">u16 ldt_sel</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00041">vmcs.h:41</a></div></div>
<div class="ttc" id="astructvmcs__host__state_html_aa3421c5111f5ebfcf6fb0b52125a6d2a"><div class="ttname"><a href="structvmcs__host__state.html#aa3421c5111f5ebfcf6fb0b52125a6d2a">vmcs_host_state::gs_base</a></div><div class="ttdeci">unsigned long gs_base</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00037">vmcs.h:37</a></div></div>
<div class="ttc" id="astructvmcs__host__state_html_adc2cf053f2b5cec448b349479e399b20"><div class="ttname"><a href="structvmcs__host__state.html#adc2cf053f2b5cec448b349479e399b20">vmcs_host_state::gs_sel</a></div><div class="ttdeci">u16 gs_sel</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00041">vmcs.h:41</a></div></div>
<div class="ttc" id="astructvmx__uret__msr_html_a075609250cf77684ebfd96c70faff7a2"><div class="ttname"><a href="structvmx__uret__msr.html#a075609250cf77684ebfd96c70faff7a2">vmx_uret_msr::mask</a></div><div class="ttdeci">u64 mask</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00041">vmx.h:41</a></div></div>
<div class="ttc" id="astructvmx__uret__msr_html_a811b76f607850bacd80c71ac5151cfba"><div class="ttname"><a href="structvmx__uret__msr.html#a811b76f607850bacd80c71ac5151cfba">vmx_uret_msr::load_into_hardware</a></div><div class="ttdeci">bool load_into_hardware</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00039">vmx.h:39</a></div></div>
<div class="ttc" id="astructvmx__uret__msr_html_a82094ef35edea8b2512790fda85d803e"><div class="ttname"><a href="structvmx__uret__msr.html#a82094ef35edea8b2512790fda85d803e">vmx_uret_msr::data</a></div><div class="ttdeci">u64 data</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00040">vmx.h:40</a></div></div>
<div class="ttc" id="avmx_2nested_8c_html_aafc435d13c9681dd613719dc3c209e02"><div class="ttname"><a href="vmx_2nested_8c.html#aafc435d13c9681dd613719dc3c209e02">nested_sync_vmcs12_to_shadow</a></div><div class="ttdeci">void nested_sync_vmcs12_to_shadow(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_2nested_8c_source.html#l02124">nested.c:2124</a></div></div>
<div class="ttc" id="avmx_8c_html_a632e0045640f1fb4b490db30ca2baabf"><div class="ttname"><a href="vmx_8c.html#a632e0045640f1fb4b490db30ca2baabf">vmx_set_host_fs_gs</a></div><div class="ttdeci">void vmx_set_host_fs_gs(struct vmcs_host_state *host, u16 fs_sel, u16 gs_sel, unsigned long fs_base, unsigned long gs_base)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l01255">vmx.c:1255</a></div></div>
<div class="ttc" id="ax86_8c_html_a86e3ff5e39a75facecd859a8c16f2740"><div class="ttname"><a href="x86_8c.html#a86e3ff5e39a75facecd859a8c16f2740">kvm_nr_uret_msrs</a></div><div class="ttdeci">u32 __read_mostly kvm_nr_uret_msrs</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l00219">x86.c:219</a></div></div>
<div class="ttc" id="ax86_8c_html_af6db8fdfb7625ba5b530e59102ab2520"><div class="ttname"><a href="x86_8c.html#af6db8fdfb7625ba5b530e59102ab2520">kvm_set_user_return_msr</a></div><div class="ttdeci">int kvm_set_user_return_msr(unsigned slot, u64 value, u64 mask)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l00442">x86.c:442</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a85334c5190ac8bc72072279809aee495_cgraph.png" border="0" usemap="#avmx_8h_a85334c5190ac8bc72072279809aee495_cgraph" alt=""/></div>
<map name="avmx_8h_a85334c5190ac8bc72072279809aee495_cgraph" id="avmx_8h_a85334c5190ac8bc72072279809aee495_cgraph">
<area shape="rect" title=" " alt="" coords="5,311,163,352"/>
<area shape="rect" href="x86_8c.html#af6db8fdfb7625ba5b530e59102ab2520" title=" " alt="" coords="211,141,401,168"/>
<area shape="rect" href="vmx_2nested_8c.html#aafc435d13c9681dd613719dc3c209e02" title=" " alt="" coords="225,412,387,454"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="957,546,1028,573"/>
<area shape="rect" href="vmx_8c.html#a632e0045640f1fb4b490db30ca2baabf" title=" " alt="" coords="229,217,383,244"/>
<area shape="rect" href="x86_8c.html#a5b48d629cc7cd7f1016e42f036f60159" title=" " alt="" coords="479,65,634,92"/>
<area shape="rect" href="vmx_2nested_8c.html#a79f91c211f10383b59afbc22986f82f4" title=" " alt="" coords="449,597,664,624"/>
<area shape="rect" href="vmx_2nested_8c.html#a6913302cb499706580c7efc3f9e8be40" title=" " alt="" coords="463,420,651,446"/>
<area shape="rect" href="vmx_2hyperv_8h.html#a806f1554b2846e31ad5a2e3bfbb272a0" title=" " alt="" coords="461,354,652,395"/>
<area shape="rect" href="vmx_2hyperv_8h.html#ab8cd0308e0d8ff8bcc08af1e192790c4" title=" " alt="" coords="712,597,864,624"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="731,192,845,218"/>
<area shape="rect" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497" title=" " alt="" coords="737,445,839,472"/>
<area shape="rect" href="vmcs12_8h.html#ac28c20c69d1b722359c36df6651d40ec" title=" " alt="" coords="718,496,858,522"/>
<area shape="rect" href="vmx__ops_8h.html#adefc7dc8e1885fe973b3e8d58e23e0aa" title=" " alt="" coords="740,394,836,421"/>
<area shape="rect" href="vmx__ops_8h.html#a33ef2cd0708406b39123ddd368eeb996" title=" " alt="" coords="742,344,834,370"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ae52cbc37c9ad5d2d3ce269912ae976da" title=" " alt="" coords="943,344,1043,370"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="912,141,1073,168"/>
<area shape="rect" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a" title=" " alt="" coords="500,217,613,244"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="506,116,607,142"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a1a97474a0e736504a7f46d37606d354d" title=" " alt="" coords="727,242,849,269"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="729,293,847,320"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="727,40,849,66"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="735,90,841,117"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a85334c5190ac8bc72072279809aee495_icgraph.png" border="0" usemap="#avmx_8h_a85334c5190ac8bc72072279809aee495_icgraph" alt=""/></div>
<map name="avmx_8h_a85334c5190ac8bc72072279809aee495_icgraph" id="avmx_8h_a85334c5190ac8bc72072279809aee495_icgraph">
<area shape="rect" title=" " alt="" coords="288,5,445,47"/>
<area shape="rect" href="vmx_2nested_8c.html#a9ceb985086e9efc0f1d85362d8d65d64" title=" " alt="" coords="5,13,240,39"/>
</map>
</div>

</div>
</div>
<a id="a1a4575290ae63d65de3dd41895fea152"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a4575290ae63d65de3dd41895fea152">&#9670;&nbsp;</a></span>vmx_set_constant_host_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_set_constant_host_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *&#160;</td>
          <td class="paramname"><em>vmx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l04296">4296</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;{</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;    u32 low32, high32;</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tmpl;</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cr0, cr3, cr4;</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160; </div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;    cr0 = read_cr0();</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;    WARN_ON(cr0 &amp; X86_CR0_TS);</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_CR0, cr0);  <span class="comment">/* 22.2.3 */</span></div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160; </div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;<span class="comment">     * Save the most likely value for this task&#39;s CR3 in the VMCS.</span></div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;<span class="comment">     * We can&#39;t use __get_current_cr3_fast() because we&#39;re not atomic.</span></div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;    cr3 = __read_cr3();</div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_CR3, cr3);     <span class="comment">/* 22.2.3  FIXME: shadow tables */</span></div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;    vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a058c58b6c534321752261fcb9271bd74">host_state</a>.<a class="code" href="structvmcs__host__state.html#a08ca16473aacc7dcf1a3b73adf48d7ee">cr3</a> = cr3;</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160; </div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;    <span class="comment">/* Save the most likely value for this task&#39;s CR4 in the VMCS. */</span></div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;    cr4 = cr4_read_shadow();</div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_CR4, cr4);         <span class="comment">/* 22.2.3, 22.2.5 */</span></div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;    vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a058c58b6c534321752261fcb9271bd74">host_state</a>.<a class="code" href="structvmcs__host__state.html#a5e6a23df1586510dceab7edb7a079913">cr4</a> = cr4;</div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160; </div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;    <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_CS_SELECTOR, __KERNEL_CS);  <span class="comment">/* 22.2.4 */</span></div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;<span class="comment">     * Load null selectors, so we can avoid reloading them in</span></div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;<span class="comment">     * vmx_prepare_switch_to_host(), in case userspace uses</span></div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;<span class="comment">     * the null selectors too (the expected case).</span></div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;    <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_DS_SELECTOR, 0);</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;    <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_ES_SELECTOR, 0);</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;    <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_DS_SELECTOR, __KERNEL_DS);  <span class="comment">/* 22.2.4 */</span></div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;    <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_ES_SELECTOR, __KERNEL_DS);  <span class="comment">/* 22.2.4 */</span></div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;    <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_SS_SELECTOR, __KERNEL_DS);  <span class="comment">/* 22.2.4 */</span></div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;    <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_TR_SELECTOR, GDT_ENTRY_TSS*8);  <span class="comment">/* 22.2.4 */</span></div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160; </div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_IDTR_BASE, <a class="code" href="vmx_8c.html#aea8030703650d7af11ff439bf201eb5b">host_idt_base</a>);   <span class="comment">/* 22.2.4 */</span></div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160; </div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_RIP, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="vmx_8c.html#a28001c5866b8d8db1fb4d8b1dcf39a82">vmx_vmexit</a>); <span class="comment">/* 22.2.5 */</span></div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160; </div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;    rdmsr(MSR_IA32_SYSENTER_CS, low32, high32);</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;    <a class="code" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9">vmcs_write32</a>(HOST_IA32_SYSENTER_CS, low32);</div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160; </div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;<span class="comment">     * SYSENTER is used for 32-bit system calls on either 32-bit or</span></div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;<span class="comment">     * 64-bit kernels.  It is always zero If neither is allowed, otherwise</span></div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;<span class="comment">     * vmx_vcpu_load_vmcs loads it with the per-CPU entry stack (and may</span></div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;<span class="comment">     * have already done so!).</span></div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;    <span class="keywordflow">if</span> (!IS_ENABLED(CONFIG_IA32_EMULATION) &amp;&amp; !IS_ENABLED(CONFIG_X86_32))</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;        <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_IA32_SYSENTER_ESP, 0);</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160; </div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;    rdmsrl(MSR_IA32_SYSENTER_EIP, tmpl);</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_IA32_SYSENTER_EIP, tmpl);   <span class="comment">/* 22.2.3 */</span></div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160; </div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structvmcs__config.html">vmcs_config</a>.<a class="code" href="structvmcs__config.html#a788f4e3cf6a55b56131f2d5b7d94c7b5">vmexit_ctrl</a> &amp; VM_EXIT_LOAD_IA32_PAT) {</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;        rdmsr(MSR_IA32_CR_PAT, low32, high32);</div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;        <a class="code" href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3">vmcs_write64</a>(HOST_IA32_PAT, low32 | ((u64) high32 &lt;&lt; 32));</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;    }</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160; </div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="capabilities_8h.html#a72419f3f04d86aae14d6dbdbc6073cb2">cpu_has_load_ia32_efer</a>())</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;        <a class="code" href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3">vmcs_write64</a>(HOST_IA32_EFER, <a class="code" href="x86_8c.html#a8b51b07f7ad8c95defd94f17f6768ae5">host_efer</a>);</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;}</div>
<div class="ttc" id="acapabilities_8h_html_a72419f3f04d86aae14d6dbdbc6073cb2"><div class="ttname"><a href="capabilities_8h.html#a72419f3f04d86aae14d6dbdbc6073cb2">cpu_has_load_ia32_efer</a></div><div class="ttdeci">static bool cpu_has_load_ia32_efer(void)</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00099">capabilities.h:99</a></div></div>
<div class="ttc" id="astructvmcs__config_html_a788f4e3cf6a55b56131f2d5b7d94c7b5"><div class="ttname"><a href="structvmcs__config.html#a788f4e3cf6a55b56131f2d5b7d94c7b5">vmcs_config::vmexit_ctrl</a></div><div class="ttdeci">u32 vmexit_ctrl</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00064">capabilities.h:64</a></div></div>
<div class="ttc" id="astructvmcs__host__state_html_a08ca16473aacc7dcf1a3b73adf48d7ee"><div class="ttname"><a href="structvmcs__host__state.html#a08ca16473aacc7dcf1a3b73adf48d7ee">vmcs_host_state::cr3</a></div><div class="ttdeci">unsigned long cr3</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00035">vmcs.h:35</a></div></div>
<div class="ttc" id="astructvmcs__host__state_html_a5e6a23df1586510dceab7edb7a079913"><div class="ttname"><a href="structvmcs__host__state.html#a5e6a23df1586510dceab7edb7a079913">vmcs_host_state::cr4</a></div><div class="ttdeci">unsigned long cr4</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00036">vmcs.h:36</a></div></div>
<div class="ttc" id="avmx_8c_html_a28001c5866b8d8db1fb4d8b1dcf39a82"><div class="ttname"><a href="vmx_8c.html#a28001c5866b8d8db1fb4d8b1dcf39a82">vmx_vmexit</a></div><div class="ttdeci">void vmx_vmexit(void)</div></div>
<div class="ttc" id="avmx_8c_html_aea8030703650d7af11ff439bf201eb5b"><div class="ttname"><a href="vmx_8c.html#aea8030703650d7af11ff439bf201eb5b">host_idt_base</a></div><div class="ttdeci">static unsigned long host_idt_base</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00525">vmx.c:525</a></div></div>
<div class="ttc" id="ax86_8c_html_a8b51b07f7ad8c95defd94f17f6768ae5"><div class="ttname"><a href="x86_8c.html#a8b51b07f7ad8c95defd94f17f6768ae5">host_efer</a></div><div class="ttdeci">u64 __read_mostly host_efer</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l00229">x86.c:229</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a1a4575290ae63d65de3dd41895fea152_cgraph.png" border="0" usemap="#avmx_8h_a1a4575290ae63d65de3dd41895fea152_cgraph" alt=""/></div>
<map name="avmx_8h_a1a4575290ae63d65de3dd41895fea152_cgraph" id="avmx_8h_a1a4575290ae63d65de3dd41895fea152_cgraph">
<area shape="rect" title=" " alt="" coords="5,175,181,217"/>
<area shape="rect" href="capabilities_8h.html#a72419f3f04d86aae14d6dbdbc6073cb2" title=" " alt="" coords="229,56,408,83"/>
<area shape="rect" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a" title=" " alt="" coords="262,208,375,235"/>
<area shape="rect" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9" title=" " alt="" coords="262,259,375,285"/>
<area shape="rect" href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3" title=" " alt="" coords="262,157,375,184"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="268,107,369,133"/>
<area shape="rect" href="vmx_8c.html#a28001c5866b8d8db1fb4d8b1dcf39a82" title=" " alt="" coords="267,309,371,336"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="479,208,594,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a1a97474a0e736504a7f46d37606d354d" title=" " alt="" coords="476,309,597,336"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="456,157,617,184"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="477,259,596,285"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a76f5e23936d63b1aa1a525e7f4181cf0" title=" " alt="" coords="476,411,597,437"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="477,360,596,387"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="476,56,597,83"/>
<area shape="rect" href="vmx__ops_8h.html#a482358473ceab579ad9c93b46e13fe25" title=" " alt="" coords="477,107,596,133"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="483,5,590,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a1a4575290ae63d65de3dd41895fea152_icgraph.png" border="0" usemap="#avmx_8h_a1a4575290ae63d65de3dd41895fea152_icgraph" alt=""/></div>
<map name="avmx_8h_a1a4575290ae63d65de3dd41895fea152_icgraph" id="avmx_8h_a1a4575290ae63d65de3dd41895fea152_icgraph">
<area shape="rect" title=" " alt="" coords="716,27,892,69"/>
<area shape="rect" href="vmx_8c.html#ad9c0f9053e0fe647a367166a4b6a0c6f" title=" " alt="" coords="529,5,614,32"/>
<area shape="rect" href="vmx_2nested_8c.html#ad2e9898adf303e2ea0d485adb616ec20" title=" " alt="" coords="475,57,668,98"/>
<area shape="rect" href="vmx_8c.html#abd63cf398d1b18c9be4e9c4eae17c64c" title=" " alt="" coords="254,5,397,32"/>
<area shape="rect" href="vmx_8c.html#a8d0fa5e317cbd0eb67ebdc9fa5ec70ce" title=" " alt="" coords="26,5,155,32"/>
<area shape="rect" href="vmx_2nested_8c.html#a85ce368c81cbe80d9e13c1873fce03b3" title=" " alt="" coords="224,64,427,91"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e4432d8f2321361c7b0b88e7237511c" title=" " alt="" coords="5,64,176,91"/>
</map>
</div>

</div>
</div>
<a id="acf9f5acdb0b2a5b2778c853846cfa09f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf9f5acdb0b2a5b2778c853846cfa09f">&#9670;&nbsp;</a></span>vmx_set_cr0()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_set_cr0 </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>cr0</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03275">3275</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;{</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> hw_cr0, old_cr0_pg;</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    u32 tmp;</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160; </div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;    old_cr0_pg = <a class="code" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378">kvm_read_cr0_bits</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, X86_CR0_PG);</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160; </div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    hw_cr0 = (cr0 &amp; ~<a class="code" href="vmx_8c.html#ab1882bbc45c3fbf7e487a927434c6a9d">KVM_VM_CR0_ALWAYS_OFF</a>);</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx_8c.html#acf6dd90f84c7ca02141ad0b64538fb16">enable_unrestricted_guest</a>)</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;        hw_cr0 |= <a class="code" href="vmx_8c.html#aa15ea31fe0ee3cdc167d85a7d1f09d76">KVM_VM_CR0_ALWAYS_ON_UNRESTRICTED_GUEST</a>;</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;        hw_cr0 |= <a class="code" href="vmx_8c.html#aff07e4d6ffe97ef1e04343b626f53b7c">KVM_VM_CR0_ALWAYS_ON</a>;</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#abf08136dbf993f207b5536a18082c6ed">enable_ept</a>)</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;            hw_cr0 |= X86_CR0_WP;</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160; </div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;        <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vm86_active</a> &amp;&amp; (cr0 &amp; X86_CR0_PE))</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;            <a class="code" href="vmx_8c.html#a5b0ffadb6f1bbf0fe42d6cf7a17490bb">enter_pmode</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160; </div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;        <span class="keywordflow">if</span> (!vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vm86_active</a> &amp;&amp; !(cr0 &amp; X86_CR0_PE))</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;            <a class="code" href="vmx_8c.html#ac744bdcb0b42778132eaeb180e29e70c">enter_rmode</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    }</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160; </div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(CR0_READ_SHADOW, cr0);</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(GUEST_CR0, hw_cr0);</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;    <a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>-&gt;arch.cr0 = cr0;</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;    <a class="code" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f">kvm_register_mark_available</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_CR0);</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160; </div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>-&gt;arch.efer &amp; EFER_LME) {</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;        <span class="keywordflow">if</span> (!old_cr0_pg &amp;&amp; (cr0 &amp; X86_CR0_PG))</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;            enter_lmode(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (old_cr0_pg &amp;&amp; !(cr0 &amp; X86_CR0_PG))</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;            exit_lmode(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;    }</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160; </div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx_8c.html#abf08136dbf993f207b5536a18082c6ed">enable_ept</a> &amp;&amp; !<a class="code" href="vmx_8c.html#acf6dd90f84c7ca02141ad0b64538fb16">enable_unrestricted_guest</a>) {</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;<span class="comment">         * Ensure KVM has an up-to-date snapshot of the guest&#39;s CR3.  If</span></div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;<span class="comment">         * the below code _enables_ CR3 exiting, vmx_cache_reg() will</span></div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="comment">         * (correctly) stop reading vmcs.GUEST_CR3 because it thinks</span></div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;<span class="comment">         * KVM&#39;s CR3 is installed.</span></div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9">kvm_register_is_available</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_CR3))</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;            <a class="code" href="vmx_8c.html#a2c4d6e59c045e49243d6c4a2812999b8">vmx_cache_reg</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_CR3);</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160; </div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;<span class="comment">         * When running with EPT but not unrestricted guest, KVM must</span></div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;<span class="comment">         * intercept CR3 accesses when paging is _disabled_.  This is</span></div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;<span class="comment">         * necessary because restricted guests can&#39;t actually run with</span></div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;<span class="comment">         * paging disabled, and so KVM stuffs its own CR3 in order to</span></div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;<span class="comment">         * run the guest when identity mapped page tables.</span></div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;<span class="comment">         * Do _NOT_ check the old CR0.PG, e.g. to optimize away the</span></div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;<span class="comment">         * update, it may be stale with respect to CR3 interception,</span></div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;<span class="comment">         * e.g. after nested VM-Enter.</span></div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;<span class="comment">         * Lastly, honor L1&#39;s desires, i.e. intercept CR3 loads and/or</span></div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;<span class="comment">         * stores to forward them to L1, even if KVM does not need to</span></div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;<span class="comment">         * intercept them to preserve its identity mapped page tables.</span></div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;        <span class="keywordflow">if</span> (!(cr0 &amp; X86_CR0_PG)) {</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;            exec_controls_setbit(vmx, <a class="code" href="vmx_8c.html#a731714d744de59f50cd706ac9a499347">CR3_EXITING_BITS</a>);</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>)) {</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            exec_controls_clearbit(vmx, <a class="code" href="vmx_8c.html#a731714d744de59f50cd706ac9a499347">CR3_EXITING_BITS</a>);</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;            tmp = exec_controls_get(vmx);</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;            tmp &amp;= ~<a class="code" href="vmx_8c.html#a731714d744de59f50cd706ac9a499347">CR3_EXITING_BITS</a>;</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;            tmp |= <a class="code" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497">get_vmcs12</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>)-&gt;<a class="code" href="structvmcs12.html#a34631a3acec2f8e1db398bc77e12b3c3">cpu_based_vm_exec_control</a> &amp; <a class="code" href="vmx_8c.html#a731714d744de59f50cd706ac9a499347">CR3_EXITING_BITS</a>;</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;            exec_controls_set(vmx, tmp);</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;        }</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160; </div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;        <span class="comment">/* Note, vmx_set_cr4() consumes the new vcpu-&gt;arch.cr0. */</span></div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;        <span class="keywordflow">if</span> ((old_cr0_pg ^ cr0) &amp; X86_CR0_PG)</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;            <a class="code" href="vmx_8c.html#adda41e5ad7d9839a1fd3e01efc608c37">vmx_set_cr4</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, <a class="code" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba">kvm_read_cr4</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>));</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160; </div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;<span class="comment">         * When !CR0_PG -&gt; CR0_PG, vcpu-&gt;arch.cr3 becomes active, but</span></div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;<span class="comment">         * GUEST_CR3 is still vmx-&gt;ept_identity_map_addr if EPT + !URG.</span></div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;        <span class="keywordflow">if</span> (!(old_cr0_pg &amp; X86_CR0_PG) &amp;&amp; (cr0 &amp; X86_CR0_PG))</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;            <a class="code" href="kvm__cache__regs_8h.html#a0f6830d8a03ec49d8ac457e2a9c1d687">kvm_register_mark_dirty</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_CR3);</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;    }</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160; </div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;    <span class="comment">/* depends on vcpu-&gt;arch.cr0 to be set to a new value */</span></div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;    vmx-&gt;<a class="code" href="structvcpu__vmx.html#a76afd8401fbca6792da2e0720bcbae5a">emulation_required</a> = <a class="code" href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5">vmx_emulation_required</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_a0f6830d8a03ec49d8ac457e2a9c1d687"><div class="ttname"><a href="kvm__cache__regs_8h.html#a0f6830d8a03ec49d8ac457e2a9c1d687">kvm_register_mark_dirty</a></div><div class="ttdeci">static void kvm_register_mark_dirty(struct kvm_vcpu *vcpu, enum kvm_reg reg)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00071">kvm_cache_regs.h:71</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_a5fbb40e1f7661ccfd5accdaef3d8c378"><div class="ttname"><a href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378">kvm_read_cr0_bits</a></div><div class="ttdeci">static ulong kvm_read_cr0_bits(struct kvm_vcpu *vcpu, ulong mask)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00151">kvm_cache_regs.h:151</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_ad479d598f0b5de90bd6062237ccb9eba"><div class="ttname"><a href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba">kvm_read_cr4</a></div><div class="ttdeci">static ulong kvm_read_cr4(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00197">kvm_cache_regs.h:197</a></div></div>
<div class="ttc" id="astructvcpu__vmx_html_a76afd8401fbca6792da2e0720bcbae5a"><div class="ttname"><a href="structvcpu__vmx.html#a76afd8401fbca6792da2e0720bcbae5a">vcpu_vmx::emulation_required</a></div><div class="ttdeci">bool emulation_required</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00318">vmx.h:318</a></div></div>
<div class="ttc" id="astructvmcs12_html_a34631a3acec2f8e1db398bc77e12b3c3"><div class="ttname"><a href="structvmcs12.html#a34631a3acec2f8e1db398bc77e12b3c3">vmcs12::cpu_based_vm_exec_control</a></div><div class="ttdeci">u32 cpu_based_vm_exec_control</div><div class="ttdef"><b>Definition:</b> <a href="vmcs12_8h_source.html#l00122">vmcs12.h:122</a></div></div>
<div class="ttc" id="avmx_8c_html_a2c4d6e59c045e49243d6c4a2812999b8"><div class="ttname"><a href="vmx_8c.html#a2c4d6e59c045e49243d6c4a2812999b8">vmx_cache_reg</a></div><div class="ttdeci">static void vmx_cache_reg(struct kvm_vcpu *vcpu, enum kvm_reg reg)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l02467">vmx.c:2467</a></div></div>
<div class="ttc" id="avmx_8c_html_a3227ce57b73a94120917f2065d22b6b5"><div class="ttname"><a href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5">vmx_emulation_required</a></div><div class="ttdeci">bool vmx_emulation_required(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l01504">vmx.c:1504</a></div></div>
<div class="ttc" id="avmx_8c_html_a5b0ffadb6f1bbf0fe42d6cf7a17490bb"><div class="ttname"><a href="vmx_8c.html#a5b0ffadb6f1bbf0fe42d6cf7a17490bb">enter_pmode</a></div><div class="ttdeci">static void enter_pmode(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l02997">vmx.c:2997</a></div></div>
<div class="ttc" id="avmx_8c_html_a731714d744de59f50cd706ac9a499347"><div class="ttname"><a href="vmx_8c.html#a731714d744de59f50cd706ac9a499347">CR3_EXITING_BITS</a></div><div class="ttdeci">#define CR3_EXITING_BITS</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03261">vmx.c:3261</a></div></div>
<div class="ttc" id="avmx_8c_html_aa15ea31fe0ee3cdc167d85a7d1f09d76"><div class="ttname"><a href="vmx_8c.html#aa15ea31fe0ee3cdc167d85a7d1f09d76">KVM_VM_CR0_ALWAYS_ON_UNRESTRICTED_GUEST</a></div><div class="ttdeci">#define KVM_VM_CR0_ALWAYS_ON_UNRESTRICTED_GUEST</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00145">vmx.c:145</a></div></div>
<div class="ttc" id="avmx_8c_html_ab1882bbc45c3fbf7e487a927434c6a9d"><div class="ttname"><a href="vmx_8c.html#ab1882bbc45c3fbf7e487a927434c6a9d">KVM_VM_CR0_ALWAYS_OFF</a></div><div class="ttdeci">#define KVM_VM_CR0_ALWAYS_OFF</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00144">vmx.c:144</a></div></div>
<div class="ttc" id="avmx_8c_html_ac744bdcb0b42778132eaeb180e29e70c"><div class="ttname"><a href="vmx_8c.html#ac744bdcb0b42778132eaeb180e29e70c">enter_rmode</a></div><div class="ttdeci">static void enter_rmode(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03067">vmx.c:3067</a></div></div>
<div class="ttc" id="avmx_8c_html_acf6dd90f84c7ca02141ad0b64538fb16"><div class="ttname"><a href="vmx_8c.html#acf6dd90f84c7ca02141ad0b64538fb16">enable_unrestricted_guest</a></div><div class="ttdeci">bool __read_mostly enable_unrestricted_guest</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00094">vmx.c:94</a></div></div>
<div class="ttc" id="avmx_8c_html_adda41e5ad7d9839a1fd3e01efc608c37"><div class="ttname"><a href="vmx_8c.html#adda41e5ad7d9839a1fd3e01efc608c37">vmx_set_cr4</a></div><div class="ttdeci">void vmx_set_cr4(struct kvm_vcpu *vcpu, unsigned long cr4)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03432">vmx.c:3432</a></div></div>
<div class="ttc" id="avmx_8c_html_aff07e4d6ffe97ef1e04343b626f53b7c"><div class="ttname"><a href="vmx_8c.html#aff07e4d6ffe97ef1e04343b626f53b7c">KVM_VM_CR0_ALWAYS_ON</a></div><div class="ttdeci">#define KVM_VM_CR0_ALWAYS_ON</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00146">vmx.c:146</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_acf9f5acdb0b2a5b2778c853846cfa09f_cgraph.png" border="0" usemap="#avmx_8h_acf9f5acdb0b2a5b2778c853846cfa09f_cgraph" alt=""/></div>
<map name="avmx_8h_acf9f5acdb0b2a5b2778c853846cfa09f_cgraph" id="avmx_8h_acf9f5acdb0b2a5b2778c853846cfa09f_cgraph">
<area shape="rect" title=" " alt="" coords="5,1619,111,1645"/>
<area shape="rect" href="vmx_8c.html#a5b0ffadb6f1bbf0fe42d6cf7a17490bb" title=" " alt="" coords="198,808,306,835"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="1146,179,1247,205"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="1137,1543,1257,1569"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="1161,1264,1232,1291"/>
<area shape="rect" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497" title=" " alt="" coords="907,1340,1008,1367"/>
<area shape="rect" href="vmx_8c.html#ac744bdcb0b42778132eaeb180e29e70c" title=" " alt="" coords="427,935,533,961"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="179,2201,325,2228"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1328,2151,1521,2177"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba" title=" " alt="" coords="900,2100,1015,2127"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="849,1644,1065,1671"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a0f6830d8a03ec49d8ac457e2a9c1d687" title=" " alt="" coords="159,2252,345,2279"/>
<area shape="rect" href="vmx_8c.html#a2c4d6e59c045e49243d6c4a2812999b8" title=" " alt="" coords="418,1492,542,1519"/>
<area shape="rect" href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5" title=" " alt="" coords="159,1593,345,1620"/>
<area shape="rect" href="vmx_8c.html#adda41e5ad7d9839a1fd3e01efc608c37" title=" " alt="" coords="655,1745,761,1772"/>
<area shape="rect" href="vmx_8c.html#a02a5a7a2c625e52874076332ecc41ace" title=" " alt="" coords="630,372,786,399"/>
<area shape="rect" href="vmx_8c.html#a091adfc5844f05cea3f378cbf167a236" title=" " alt="" coords="420,513,540,540"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="1148,935,1245,961"/>
<area shape="rect" href="vmx_8c.html#acfb1910d98db4bcd82dd9a96eb069ce9" title=" " alt="" coords="637,783,779,809"/>
<area shape="rect" href="vmx_8c.html#a6ddb2979d2cb226fe63f24b99f88a99e" title=" " alt="" coords="621,1189,795,1230"/>
<area shape="rect" href="vmx_8c.html#ad451ebc6caea05e6b8efad3669027247" title=" " alt="" coords="899,195,1016,221"/>
<area shape="rect" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a" title=" " alt="" coords="1140,296,1253,323"/>
<area shape="rect" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9" title=" " alt="" coords="1140,381,1253,408"/>
<area shape="rect" href="vmx_8c.html#a0a4bc0d90ba4aa4d6e9758f35cd84261" title=" " alt="" coords="1113,230,1280,271"/>
<area shape="rect" href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec" title=" " alt="" coords="877,1441,1038,1468"/>
<area shape="rect" href="vmx_8c.html#addb62cc2799bab41b7029f93bf448b1c" title=" " alt="" coords="858,448,1057,475"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="1367,263,1482,289"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="1344,415,1505,441"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a76f5e23936d63b1aa1a525e7f4181cf0" title=" " alt="" coords="1364,313,1485,340"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="1365,465,1484,492"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="1364,179,1485,205"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="1371,364,1478,391"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="1369,1757,1480,1784"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="1366,1175,1483,1201"/>
<area shape="rect" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977" title=" " alt="" coords="867,499,1047,525"/>
<area shape="rect" href="vmx_8c.html#a911b88947099c0d21f8fbeca202ea30f" title=" " alt="" coords="858,783,1057,809"/>
<area shape="rect" href="vmx_8c.html#ab9185adefc641ff428164a7fcab15c45" title=" " alt="" coords="877,550,1037,591"/>
<area shape="rect" href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc" title=" " alt="" coords="877,615,1037,657"/>
<area shape="rect" href="vmx_8h.html#a046cd100cd1f1b77bfa5ba028dcd52ff" title=" " alt="" coords="870,1188,1045,1215"/>
<area shape="rect" href="vmx_8h.html#a0100af676b8116ac3f8cc0ba1ed54f4c" title=" " alt="" coords="655,985,761,1012"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a24ffc81fe5ed7998e29134351275b4dd" title=" " alt="" coords="1124,2100,1269,2127"/>
<area shape="rect" href="vmx_8c.html#a127240567687a7433409baa441cb3c03" title=" " alt="" coords="643,1897,773,1924"/>
<area shape="rect" href="x86_8h.html#aaa36cdb43bbf6ed6af3b10deed46a436" title=" " alt="" coords="900,1999,1015,2025"/>
<area shape="rect" href="vmx__ops_8h.html#a2088262a71496c55f21ddab30c364663" title=" " alt="" coords="1142,1879,1251,1905"/>
<area shape="rect" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878" title=" " alt="" coords="1155,1828,1239,1855"/>
<area shape="rect" href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf" title=" " alt="" coords="393,1593,567,1620"/>
<area shape="rect" href="vmx_8h.html#a77b0ca4dac426b317965746a6bec345e" title=" " alt="" coords="615,1593,801,1620"/>
<area shape="rect" href="cpuid_8c.html#a537512099e11c7ab0553aeae5e38d9ea" title=" " alt="" coords="856,1796,1059,1823"/>
<area shape="rect" href="nested_8h.html#aa997cf53b86844ddc4f230369935239e" title=" " alt="" coords="890,1847,1025,1873"/>
<area shape="rect" href="capabilities_8h.html#a81362ab692cae81056c187075fe34c10" title=" " alt="" coords="877,1897,1037,1924"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_acf9f5acdb0b2a5b2778c853846cfa09f_icgraph.png" border="0" usemap="#avmx_8h_acf9f5acdb0b2a5b2778c853846cfa09f_icgraph" alt=""/></div>
<map name="avmx_8h_acf9f5acdb0b2a5b2778c853846cfa09f_icgraph" id="avmx_8h_acf9f5acdb0b2a5b2778c853846cfa09f_icgraph">
<area shape="rect" title=" " alt="" coords="1132,375,1237,401"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,316,1084,343"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,461,138,488"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,367,1070,409"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,316,853,343"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,161,361,188"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,224,604,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,275,631,317"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,341,651,382"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,392,387,419"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,158,618,199"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,457,633,484"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,509,635,550"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,56,615,83"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,161,140,188"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,217,373,258"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,224,136,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,311,369,353"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,107,374,133"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,5,343,32"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,56,372,83"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,107,134,133"/>
</map>
</div>

</div>
</div>
<a id="adda41e5ad7d9839a1fd3e01efc608c37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adda41e5ad7d9839a1fd3e01efc608c37">&#9670;&nbsp;</a></span>vmx_set_cr4()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_set_cr4 </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>cr4</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03432">3432</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;{</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> old_cr4 = <a class="code" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba">kvm_read_cr4</a>(vcpu);</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> hw_cr4;</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160; </div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;<span class="comment">     * Pass through host&#39;s Machine Check Enable value to hw_cr4, which</span></div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;<span class="comment">     * is in force while we are in guest mode.  Do not let guests control</span></div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<span class="comment">     * this bit, even if host CR4.MCE == 0.</span></div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;    hw_cr4 = (cr4_read_shadow() &amp; X86_CR4_MCE) | (cr4 &amp; ~X86_CR4_MCE);</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx_8c.html#acf6dd90f84c7ca02141ad0b64538fb16">enable_unrestricted_guest</a>)</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;        hw_cr4 |= <a class="code" href="vmx_8c.html#aa7c99aa51c993c1236845e42a2bcb0eb">KVM_VM_CR4_ALWAYS_ON_UNRESTRICTED_GUEST</a>;</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vm86_active</a>)</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;        hw_cr4 |= <a class="code" href="vmx_8c.html#a3bbb4f55805cbd0b4060b3c16d7d9a7f">KVM_RMODE_VM_CR4_ALWAYS_ON</a>;</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;        hw_cr4 |= <a class="code" href="vmx_8c.html#a8b04d05096df8bf2fcb8a440ed99975a">KVM_PMODE_VM_CR4_ALWAYS_ON</a>;</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160; </div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="capabilities_8h.html#a81362ab692cae81056c187075fe34c10">vmx_umip_emulated</a>()) {</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;        <span class="keywordflow">if</span> (cr4 &amp; X86_CR4_UMIP) {</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;            secondary_exec_controls_setbit(vmx, SECONDARY_EXEC_DESC);</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            hw_cr4 &amp;= ~X86_CR4_UMIP;</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>) ||</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;            !<a class="code" href="nested_8h.html#aa997cf53b86844ddc4f230369935239e">nested_cpu_has2</a>(<a class="code" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497">get_vmcs12</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>), SECONDARY_EXEC_DESC)) {</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;            secondary_exec_controls_clearbit(vmx, SECONDARY_EXEC_DESC);</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;        }</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;    }</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160; </div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    <a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>-&gt;arch.cr4 = cr4;</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <a class="code" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f">kvm_register_mark_available</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_CR4);</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160; </div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#acf6dd90f84c7ca02141ad0b64538fb16">enable_unrestricted_guest</a>) {</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="vmx_8c.html#abf08136dbf993f207b5536a18082c6ed">enable_ept</a>) {</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878">is_paging</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>)) {</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;                hw_cr4 &amp;= ~X86_CR4_PAE;</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;                hw_cr4 |= X86_CR4_PSE;</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(cr4 &amp; X86_CR4_PAE)) {</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                hw_cr4 &amp;= ~X86_CR4_PAE;</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;            }</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;        }</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160; </div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;<span class="comment">         * SMEP/SMAP/PKU is disabled if CPU is in non-paging mode in</span></div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;<span class="comment">         * hardware.  To emulate this behavior, SMEP/SMAP/PKU needs</span></div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;<span class="comment">         * to be manually disabled when guest switches to non-paging</span></div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;<span class="comment">         * mode.</span></div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;<span class="comment">         * If !enable_unrestricted_guest, the CPU is always running</span></div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;<span class="comment">         * with CR0.PG=1 and CR4 needs to be modified.</span></div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;<span class="comment">         * If enable_unrestricted_guest, the CPU automatically</span></div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;<span class="comment">         * disables SMEP/SMAP/PKU when the guest sets CR0.PG=0.</span></div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878">is_paging</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>))</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;            hw_cr4 &amp;= ~(X86_CR4_SMEP | X86_CR4_SMAP | X86_CR4_PKE);</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;    }</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160; </div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(CR4_READ_SHADOW, cr4);</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(GUEST_CR4, hw_cr4);</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160; </div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;    <span class="keywordflow">if</span> ((cr4 ^ old_cr4) &amp; (X86_CR4_OSXSAVE | X86_CR4_PKE))</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;        <a class="code" href="cpuid_8c.html#a537512099e11c7ab0553aeae5e38d9ea">kvm_update_cpuid_runtime</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;}</div>
<div class="ttc" id="acapabilities_8h_html_a81362ab692cae81056c187075fe34c10"><div class="ttname"><a href="capabilities_8h.html#a81362ab692cae81056c187075fe34c10">vmx_umip_emulated</a></div><div class="ttdeci">static bool vmx_umip_emulated(void)</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00153">capabilities.h:153</a></div></div>
<div class="ttc" id="acpuid_8c_html_a537512099e11c7ab0553aeae5e38d9ea"><div class="ttname"><a href="cpuid_8c.html#a537512099e11c7ab0553aeae5e38d9ea">kvm_update_cpuid_runtime</a></div><div class="ttdeci">void kvm_update_cpuid_runtime(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="cpuid_8c_source.html#l00309">cpuid.c:309</a></div></div>
<div class="ttc" id="avmx_8c_html_a3bbb4f55805cbd0b4060b3c16d7d9a7f"><div class="ttname"><a href="vmx_8c.html#a3bbb4f55805cbd0b4060b3c16d7d9a7f">KVM_RMODE_VM_CR4_ALWAYS_ON</a></div><div class="ttdeci">#define KVM_RMODE_VM_CR4_ALWAYS_ON</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00151">vmx.c:151</a></div></div>
<div class="ttc" id="avmx_8c_html_a8b04d05096df8bf2fcb8a440ed99975a"><div class="ttname"><a href="vmx_8c.html#a8b04d05096df8bf2fcb8a440ed99975a">KVM_PMODE_VM_CR4_ALWAYS_ON</a></div><div class="ttdeci">#define KVM_PMODE_VM_CR4_ALWAYS_ON</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00150">vmx.c:150</a></div></div>
<div class="ttc" id="avmx_8c_html_aa7c99aa51c993c1236845e42a2bcb0eb"><div class="ttname"><a href="vmx_8c.html#aa7c99aa51c993c1236845e42a2bcb0eb">KVM_VM_CR4_ALWAYS_ON_UNRESTRICTED_GUEST</a></div><div class="ttdeci">#define KVM_VM_CR4_ALWAYS_ON_UNRESTRICTED_GUEST</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00149">vmx.c:149</a></div></div>
<div class="ttc" id="ax86_8h_html_a716c9d1b6fc76fd454097cf39d640878"><div class="ttname"><a href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878">is_paging</a></div><div class="ttdeci">static bool is_paging(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00198">x86.h:198</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_adda41e5ad7d9839a1fd3e01efc608c37_cgraph.png" border="0" usemap="#avmx_8h_adda41e5ad7d9839a1fd3e01efc608c37_cgraph" alt=""/></div>
<map name="avmx_8h_adda41e5ad7d9839a1fd3e01efc608c37_cgraph" id="avmx_8h_adda41e5ad7d9839a1fd3e01efc608c37_cgraph">
<area shape="rect" title=" " alt="" coords="5,231,111,257"/>
<area shape="rect" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497" title=" " alt="" coords="216,53,317,80"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="468,28,539,55"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="207,104,327,131"/>
<area shape="rect" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878" title=" " alt="" coords="225,155,309,181"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba" title=" " alt="" coords="446,167,561,193"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="159,307,375,333"/>
<area shape="rect" href="cpuid_8c.html#a537512099e11c7ab0553aeae5e38d9ea" title=" " alt="" coords="165,256,368,283"/>
<area shape="rect" href="nested_8h.html#aa997cf53b86844ddc4f230369935239e" title=" " alt="" coords="199,357,334,384"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="216,408,317,435"/>
<area shape="rect" href="capabilities_8h.html#a81362ab692cae81056c187075fe34c10" title=" " alt="" coords="187,459,347,485"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="430,91,577,117"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="858,59,1003,85"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1055,84,1248,111"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a24ffc81fe5ed7998e29134351275b4dd" title=" " alt="" coords="858,109,1003,136"/>
<area shape="rect" href="cpuid_8c.html#aba2a2f99dbe3b8848b6ffc19effa6294" title=" " alt="" coords="424,291,583,333"/>
<area shape="rect" href="cpuid_8c.html#a57e37154fafc08d4400cac72d0a0b91d" title=" " alt="" coords="632,262,807,303"/>
<area shape="rect" href="cpuid_8c.html#a7220f0f9a6d0047aef7619e272fa9518" title=" " alt="" coords="862,375,999,401"/>
<area shape="rect" href="reverse__cpuid_8h.html#a9ca8b41f0d18f3dac63b62e545077db4" title=" " alt="" coords="855,324,1007,351"/>
<area shape="rect" href="reverse__cpuid_8h.html#a748960fccca789bf432536205fdf9826" title=" " alt="" coords="655,531,783,557"/>
<area shape="rect" href="x86_8h.html#adf8330176a8805826ed4711a51ce93cf" title=" " alt="" coords="636,328,803,355"/>
<area shape="rect" href="x86_8h.html#ace4ed625ac4852e54db110fde28d3231" title=" " alt="" coords="651,379,788,405"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65" title=" " alt="" coords="646,160,793,187"/>
<area shape="rect" href="cpuid_8c.html#aad06d21707fd0abb109028612ea7514c" title=" " alt="" coords="641,429,798,456"/>
<area shape="rect" href="reverse__cpuid_8h.html#aeac4cdaa1c8b53f46ea791f355b1d08c" title=" " alt="" coords="1327,349,1433,376"/>
<area shape="rect" href="reverse__cpuid_8h.html#a08df87ae84991c96655f367379fad9b1" title=" " alt="" coords="1074,425,1229,452"/>
<area shape="rect" href="reverse__cpuid_8h.html#a76ac51b62ef170b755204cb8b958e585" title=" " alt="" coords="1719,400,1867,427"/>
<area shape="rect" href="reverse__cpuid_8h.html#ae10c1644e90cb8443e5a32554acfd700" title=" " alt="" coords="1512,400,1671,427"/>
<area shape="rect" href="reverse__cpuid_8h.html#adf3299d46978c685ba9b46ebb1536680" title=" " alt="" coords="1296,400,1464,427"/>
<area shape="rect" href="reverse__cpuid_8h.html#a3f7e53c68e5610be44d760fd4854f892" title=" " alt="" coords="1309,451,1451,477"/>
<area shape="rect" href="reverse__cpuid_8h.html#a8f6dc89865c6af98e621e1ddcf401cae" title=" " alt="" coords="1534,451,1649,477"/>
<area shape="rect" href="reverse__cpuid_8h.html#a5c0c9322094b13d5fff76b5ab593339a" title=" " alt="" coords="867,425,994,452"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="446,357,561,384"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="443,408,564,435"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="423,459,584,485"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="450,509,557,536"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_adda41e5ad7d9839a1fd3e01efc608c37_icgraph.png" border="0" usemap="#avmx_8h_adda41e5ad7d9839a1fd3e01efc608c37_icgraph" alt=""/></div>
<map name="avmx_8h_adda41e5ad7d9839a1fd3e01efc608c37_icgraph" id="avmx_8h_adda41e5ad7d9839a1fd3e01efc608c37_icgraph">
<area shape="rect" title=" " alt="" coords="1285,70,1391,97"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,94,1084,121"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,44,138,70"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,146,1070,187"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1132,45,1237,72"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,262,853,289"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,533,361,560"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,161,604,188"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,95,631,136"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,314,651,355"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,412,387,438"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,496,618,538"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,212,633,238"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,379,635,420"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,262,615,289"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,533,140,560"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,160,373,202"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,168,136,194"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,95,369,136"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,328,374,354"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,277,343,304"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,226,372,253"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,328,134,354"/>
</map>
</div>

</div>
</div>
<a id="a346ce99d92706d6a8ffb9bb331fe768a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a346ce99d92706d6a8ffb9bb331fe768a">&#9670;&nbsp;</a></span>vmx_set_efer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vmx_set_efer </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>efer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l03115">3115</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;{</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160; </div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;    <span class="comment">/* Nothing to do if hardware doesn&#39;t support EFER. */</span></div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a938b0ca5314d7ac2f8549065a4444df9">vmx_find_uret_msr</a>(vmx, MSR_EFER))</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160; </div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;    <a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>-&gt;arch.efer = efer;</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="keywordflow">if</span> (efer &amp; EFER_LMA)</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        vm_entry_controls_setbit(vmx, VM_ENTRY_IA32E_MODE);</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;        vm_entry_controls_clearbit(vmx, VM_ENTRY_IA32E_MODE);</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;    <span class="keywordflow">if</span> (KVM_BUG_ON(efer &amp; EFER_LMA, <a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>-&gt;kvm))</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160; </div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;    <a class="code" href="vmx_8c.html#a4343fdffe519a935254346af832af2c9">vmx_setup_uret_msrs</a>(vmx);</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;}</div>
<div class="ttc" id="avmx_8c_html_a4343fdffe519a935254346af832af2c9"><div class="ttname"><a href="vmx_8c.html#a4343fdffe519a935254346af832af2c9">vmx_setup_uret_msrs</a></div><div class="ttdeci">static void vmx_setup_uret_msrs(struct vcpu_vmx *vmx)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l01860">vmx.c:1860</a></div></div>
<div class="ttc" id="avmx_8c_html_a938b0ca5314d7ac2f8549065a4444df9"><div class="ttname"><a href="vmx_8c.html#a938b0ca5314d7ac2f8549065a4444df9">vmx_find_uret_msr</a></div><div class="ttdeci">struct vmx_uret_msr * vmx_find_uret_msr(struct vcpu_vmx *vmx, u32 msr)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00713">vmx.c:713</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a346ce99d92706d6a8ffb9bb331fe768a_cgraph.png" border="0" usemap="#avmx_8h_a346ce99d92706d6a8ffb9bb331fe768a_cgraph" alt=""/></div>
<map name="avmx_8h_a346ce99d92706d6a8ffb9bb331fe768a_cgraph" id="avmx_8h_a346ce99d92706d6a8ffb9bb331fe768a_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,116,83"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="212,5,283,32"/>
<area shape="rect" href="vmx_8c.html#a938b0ca5314d7ac2f8549065a4444df9" title=" " alt="" coords="616,56,763,83"/>
<area shape="rect" href="vmx_8c.html#a4343fdffe519a935254346af832af2c9" title=" " alt="" coords="164,157,331,184"/>
<area shape="rect" href="x86_8c.html#a0ee58c2f580a2b01aaa9534feb15bcc8" title=" " alt="" coords="843,16,1037,43"/>
<area shape="rect" href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9" title=" " alt="" coords="398,477,529,504"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="407,157,519,184"/>
<area shape="rect" href="vmx_8c.html#a5bac2e04f4ca67f437e13e8badca8351" title=" " alt="" coords="379,208,548,235"/>
<area shape="rect" href="vmx_8c.html#a2973ee57fbdff5c4d029a8787dd3bb97" title=" " alt="" coords="384,107,543,133"/>
<area shape="rect" href="reverse__cpuid_8h.html#aeac4cdaa1c8b53f46ea791f355b1d08c" title=" " alt="" coords="887,587,993,613"/>
<area shape="rect" href="cpuid_8h.html#af2af2645f203b5d9bad2088af0da5c1e" title=" " alt="" coords="597,477,782,504"/>
<area shape="rect" href="reverse__cpuid_8h.html#a76ac51b62ef170b755204cb8b958e585" title=" " alt="" coords="1311,583,1459,609"/>
<area shape="rect" href="reverse__cpuid_8h.html#ae10c1644e90cb8443e5a32554acfd700" title=" " alt="" coords="1097,583,1256,609"/>
<area shape="rect" href="reverse__cpuid_8h.html#adf3299d46978c685ba9b46ebb1536680" title=" " alt="" coords="856,419,1024,445"/>
<area shape="rect" href="cpuid_8h.html#a638557b30255883157acafa55a351d0d" title=" " alt="" coords="857,470,1023,511"/>
<area shape="rect" href="reverse__cpuid_8h.html#a3f7e53c68e5610be44d760fd4854f892" title=" " alt="" coords="869,536,1011,563"/>
<area shape="rect" href="cpuid_8c.html#a7220f0f9a6d0047aef7619e272fa9518" title=" " alt="" coords="1108,477,1245,504"/>
<area shape="rect" href="reverse__cpuid_8h.html#a8f6dc89865c6af98e621e1ddcf401cae" title=" " alt="" coords="1119,532,1234,559"/>
<area shape="rect" href="vmx_8c.html#aeb316cbfe515e42e70db84117c3b4caf" title=" " alt="" coords="600,195,779,221"/>
<area shape="rect" href="capabilities_8h.html#a72419f3f04d86aae14d6dbdbc6073cb2" title=" " alt="" coords="851,301,1029,328"/>
<area shape="rect" href="vmx_8c.html#a98c20ad3920e3fa725a0808397b818f6" title=" " alt="" coords="596,249,783,276"/>
<area shape="rect" href="vmx_8c.html#a36fb6fff1423b7ed12db837d2539bfed" title=" " alt="" coords="851,67,1029,109"/>
<area shape="rect" href="capabilities_8h.html#a920302b2e36959afed4b793d45d26f40" title=" " alt="" coords="831,133,1049,160"/>
<area shape="rect" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9" title=" " alt="" coords="883,251,997,277"/>
<area shape="rect" href="vmx_8c.html#a07cb8535d5c63fe54c6233e78b47d6c7" title=" " alt="" coords="865,185,1015,226"/>
<area shape="rect" href="vmx__ops_8h.html#adaa0eecfb8c7ab44b2f50999c3f65bd3" title=" " alt="" coords="1120,99,1233,125"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="1327,149,1442,176"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="1324,99,1445,125"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="1304,225,1465,252"/>
<area shape="rect" href="vmx__ops_8h.html#a482358473ceab579ad9c93b46e13fe25" title=" " alt="" coords="1325,48,1444,75"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a76f5e23936d63b1aa1a525e7f4181cf0" title=" " alt="" coords="1116,301,1237,328"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="1117,200,1236,227"/>
<area shape="rect" href="vmx_8c.html#a7f85cc51c16578af4dddf214877fa9f7" title=" " alt="" coords="863,353,1017,394"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a346ce99d92706d6a8ffb9bb331fe768a_icgraph.png" border="0" usemap="#avmx_8h_a346ce99d92706d6a8ffb9bb331fe768a_icgraph" alt=""/></div>
<map name="avmx_8h_a346ce99d92706d6a8ffb9bb331fe768a_icgraph" id="avmx_8h_a346ce99d92706d6a8ffb9bb331fe768a_icgraph">
<area shape="rect" title=" " alt="" coords="1132,375,1243,401"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,316,1084,343"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,461,138,488"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,367,1070,409"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,316,853,343"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,161,361,188"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,224,604,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,275,631,317"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,341,651,382"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,392,387,419"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,158,618,199"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,457,633,484"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,509,635,550"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,56,615,83"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,161,140,188"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,217,373,258"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,224,136,251"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,311,369,353"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,107,374,133"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,5,343,32"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,56,372,83"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,107,134,133"/>
</map>
</div>

</div>
</div>
<a id="a632e0045640f1fb4b490db30ca2baabf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a632e0045640f1fb4b490db30ca2baabf">&#9670;&nbsp;</a></span>vmx_set_host_fs_gs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_set_host_fs_gs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvmcs__host__state.html">vmcs_host_state</a> *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u16&#160;</td>
          <td class="paramname"><em>fs_sel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u16&#160;</td>
          <td class="paramname"><em>gs_sel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>fs_base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>gs_base</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01255">1255</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;{</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordflow">if</span> (unlikely(fs_sel != host-&gt;<a class="code" href="structvmcs__host__state.html#a068e39a58f72db1f2f6733813a86eee1">fs_sel</a>)) {</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        <span class="keywordflow">if</span> (!(fs_sel &amp; 7))</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_FS_SELECTOR, fs_sel);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;            <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_FS_SELECTOR, 0);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        host-&gt;<a class="code" href="structvmcs__host__state.html#a068e39a58f72db1f2f6733813a86eee1">fs_sel</a> = fs_sel;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    }</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordflow">if</span> (unlikely(gs_sel != host-&gt;<a class="code" href="structvmcs__host__state.html#adc2cf053f2b5cec448b349479e399b20">gs_sel</a>)) {</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <span class="keywordflow">if</span> (!(gs_sel &amp; 7))</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;            <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_GS_SELECTOR, gs_sel);</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;            <a class="code" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a">vmcs_write16</a>(HOST_GS_SELECTOR, 0);</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        host-&gt;<a class="code" href="structvmcs__host__state.html#adc2cf053f2b5cec448b349479e399b20">gs_sel</a> = gs_sel;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    }</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordflow">if</span> (unlikely(fs_base != host-&gt;<a class="code" href="structvmcs__host__state.html#a8a54b9cfa2cc63748a07f013841ddf5b">fs_base</a>)) {</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_FS_BASE, fs_base);</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        host-&gt;<a class="code" href="structvmcs__host__state.html#a8a54b9cfa2cc63748a07f013841ddf5b">fs_base</a> = fs_base;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    }</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">if</span> (unlikely(gs_base != host-&gt;<a class="code" href="structvmcs__host__state.html#aa3421c5111f5ebfcf6fb0b52125a6d2a">gs_base</a>)) {</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_GS_BASE, gs_base);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        host-&gt;<a class="code" href="structvmcs__host__state.html#aa3421c5111f5ebfcf6fb0b52125a6d2a">gs_base</a> = gs_base;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    }</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a632e0045640f1fb4b490db30ca2baabf_cgraph.png" border="0" usemap="#avmx_8h_a632e0045640f1fb4b490db30ca2baabf_cgraph" alt=""/></div>
<map name="avmx_8h_a632e0045640f1fb4b490db30ca2baabf_cgraph" id="avmx_8h_a632e0045640f1fb4b490db30ca2baabf_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,160,159"/>
<area shape="rect" href="vmx__ops_8h.html#a25c2200a7bcdc61f46fc40df2aa25a6a" title=" " alt="" coords="208,157,321,184"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="214,107,315,133"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="393,107,507,133"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a1a97474a0e736504a7f46d37606d354d" title=" " alt="" coords="389,208,511,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="369,157,531,184"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="391,259,509,285"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="389,5,511,32"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="397,56,503,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a632e0045640f1fb4b490db30ca2baabf_icgraph.png" border="0" usemap="#avmx_8h_a632e0045640f1fb4b490db30ca2baabf_icgraph" alt=""/></div>
<map name="avmx_8h_a632e0045640f1fb4b490db30ca2baabf_icgraph" id="avmx_8h_a632e0045640f1fb4b490db30ca2baabf_icgraph">
<area shape="rect" title=" " alt="" coords="1397,203,1552,229"/>
<area shape="rect" href="vmx_8c.html#a85334c5190ac8bc72072279809aee495" title=" " alt="" coords="1188,162,1345,203"/>
<area shape="rect" href="vmx_2nested_8c.html#a502237213cfe23fdbe2ec0468f6b06de" title=" " alt="" coords="1184,227,1349,269"/>
<area shape="rect" href="vmx_2nested_8c.html#a9ceb985086e9efc0f1d85362d8d65d64" title=" " alt="" coords="901,169,1136,196"/>
<area shape="rect" href="vmx_2nested_8c.html#a5b55a1eda2dc47d6d1a238d483e6ce36" title=" " alt="" coords="947,235,1090,261"/>
<area shape="rect" href="vmx_2nested_8c.html#ad9920ec1586ae352fbc272ed93cf7b38" title=" " alt="" coords="727,117,825,144"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,321,853,348"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="483,117,602,144"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,67,615,93"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,158,373,199"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,165,136,192"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,5,374,32"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,56,343,83"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,107,372,133"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,5,134,32"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,513,361,540"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,168,604,195"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,219,631,261"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,285,651,326"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,321,387,348"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,569,618,610"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,401,633,428"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,503,635,545"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,513,140,540"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,223,369,265"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,231,138,257"/>
</map>
</div>

</div>
</div>
<a id="a5f203a8d867ee0e3830ee06de5fbea20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f203a8d867ee0e3830ee06de5fbea20">&#9670;&nbsp;</a></span>vmx_set_intercept_for_msr()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void vmx_set_intercept_for_msr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>msr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8h_source.html#l00427">427</a> of file <a class="el" href="vmx_8h_source.html">vmx.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;{</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">if</span> (value)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <a class="code" href="vmx_8h.html#a3db9d3d67497234d969c753d0b1093ab">vmx_enable_intercept_for_msr</a>(vcpu, msr, type);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <a class="code" href="vmx_8h.html#a96f48e7f7fd7a33ba502bea65d7a94d8">vmx_disable_intercept_for_msr</a>(vcpu, msr, type);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;}</div>
<div class="ttc" id="avmx_8h_html_a3db9d3d67497234d969c753d0b1093ab"><div class="ttname"><a href="vmx_8h.html#a3db9d3d67497234d969c753d0b1093ab">vmx_enable_intercept_for_msr</a></div><div class="ttdeci">void vmx_enable_intercept_for_msr(struct kvm_vcpu *vcpu, u32 msr, int type)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l04006">vmx.c:4006</a></div></div>
<div class="ttc" id="avmx_8h_html_a96f48e7f7fd7a33ba502bea65d7a94d8"><div class="ttname"><a href="vmx_8h.html#a96f48e7f7fd7a33ba502bea65d7a94d8">vmx_disable_intercept_for_msr</a></div><div class="ttdeci">void vmx_disable_intercept_for_msr(struct kvm_vcpu *vcpu, u32 msr, int type)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l03962">vmx.c:3962</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a5f203a8d867ee0e3830ee06de5fbea20_cgraph.png" border="0" usemap="#avmx_8h_a5f203a8d867ee0e3830ee06de5fbea20_cgraph" alt=""/></div>
<map name="avmx_8h_a5f203a8d867ee0e3830ee06de5fbea20_cgraph" id="avmx_8h_a5f203a8d867ee0e3830ee06de5fbea20_cgraph">
<area shape="rect" title=" " alt="" coords="5,123,205,150"/>
<area shape="rect" href="vmx_8h.html#a96f48e7f7fd7a33ba502bea65d7a94d8" title=" " alt="" coords="253,148,424,189"/>
<area shape="rect" href="vmx_8h.html#a3db9d3d67497234d969c753d0b1093ab" title=" " alt="" coords="255,82,422,124"/>
<area shape="rect" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b" title=" " alt="" coords="472,199,668,226"/>
<area shape="rect" href="vmx_8c.html#a5742d1df3fb94e98dd1a0f0443b529a4" title=" " alt="" coords="475,31,665,58"/>
<area shape="rect" href="vmx_8c.html#aa4973cf70be6e2559648a74eab4987a5" title=" " alt="" coords="716,24,879,65"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="499,300,641,327"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="535,148,605,175"/>
<area shape="rect" href="vmx_8c.html#a4322412ccf65775174621cab858dd234" title=" " alt="" coords="489,82,651,124"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="717,90,878,116"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a5f203a8d867ee0e3830ee06de5fbea20_icgraph.png" border="0" usemap="#avmx_8h_a5f203a8d867ee0e3830ee06de5fbea20_icgraph" alt=""/></div>
<map name="avmx_8h_a5f203a8d867ee0e3830ee06de5fbea20_icgraph" id="avmx_8h_a5f203a8d867ee0e3830ee06de5fbea20_icgraph">
<area shape="rect" title=" " alt="" coords="1443,467,1643,494"/>
<area shape="rect" href="vmx_8c.html#ac4ef65eed70b84eba92be5567feebf84" title=" " alt="" coords="977,76,1129,117"/>
<area shape="rect" href="pmu__intel_8c.html#a95acf04271d030c775698a08e8b498ff" title=" " alt="" coords="1217,492,1385,533"/>
<area shape="rect" href="vmx_8c.html#a60eaab2d29aa87878b8dd9b43dadb779" title=" " alt="" coords="1207,427,1395,468"/>
<area shape="rect" href="vmx_8c.html#a8ff77baa2f28fd717210bcac02a13434" title=" " alt="" coords="1224,557,1377,599"/>
<area shape="rect" href="vmx_2nested_8c.html#a6fcf9bdb9a96a46ee1a4561e0eee903d" title=" " alt="" coords="719,7,880,34"/>
<area shape="rect" href="vmx_8c.html#a198d25dc5afdf259e877818b94cb5e1b" title=" " alt="" coords="708,58,891,85"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,138,343,165"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="484,7,601,34"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,77,372,103"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,5,373,47"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,13,136,39"/>
<area shape="rect" href="pmu__intel_8c.html#af9cb9956f1ba92178a027529a50d711d" title=" " alt="" coords="969,492,1137,533"/>
<area shape="rect" href="pmu__intel_8c.html#a5f05da2ad8fa10c5a20b5c9daa506b71" title=" " alt="" coords="971,557,1136,599"/>
<area shape="rect" href="pmu__intel_8c.html#aafa008ad34eb88ebd13aa2f76375cad2" title=" " alt="" coords="699,565,900,591"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="484,679,601,706"/>
<area shape="rect" href="vmx_8c.html#a19fa2c2eb871655a497c1c0c73bd0553" title=" " alt="" coords="948,437,1159,463"/>
<area shape="rect" href="vmx_8c.html#a3f6e91eedb4d7eefd8f4007389aaac7b" title=" " alt="" coords="951,386,1156,413"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="722,386,877,413"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,591,361,618"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,159,604,186"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,261,631,303"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,379,651,420"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,357,387,383"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,613,618,655"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,445,633,471"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,496,635,537"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,210,615,237"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,591,140,618"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,261,369,303"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,269,138,295"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,210,374,237"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,210,134,237"/>
</map>
</div>

</div>
</div>
<a id="ae2d73f838a404b569a5c51da5ee2ce68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2d73f838a404b569a5c51da5ee2ce68">&#9670;&nbsp;</a></span>vmx_set_interrupt_shadow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_set_interrupt_shadow </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01574">1574</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;{</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    u32 interruptibility_old = <a class="code" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485">vmcs_read32</a>(GUEST_INTERRUPTIBILITY_INFO);</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    u32 interruptibility = interruptibility_old;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160; </div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    interruptibility &amp;= ~(GUEST_INTR_STATE_STI | GUEST_INTR_STATE_MOV_SS);</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160; </div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keywordflow">if</span> (mask &amp; KVM_X86_SHADOW_INT_MOV_SS)</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        interruptibility |= GUEST_INTR_STATE_MOV_SS;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mask &amp; KVM_X86_SHADOW_INT_STI)</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        interruptibility |= GUEST_INTR_STATE_STI;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160; </div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keywordflow">if</span> ((interruptibility != interruptibility_old))</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <a class="code" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9">vmcs_write32</a>(GUEST_INTERRUPTIBILITY_INFO, interruptibility);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ae2d73f838a404b569a5c51da5ee2ce68_cgraph.png" border="0" usemap="#avmx_8h_ae2d73f838a404b569a5c51da5ee2ce68_cgraph" alt=""/></div>
<map name="avmx_8h_ae2d73f838a404b569a5c51da5ee2ce68_cgraph" id="avmx_8h_ae2d73f838a404b569a5c51da5ee2ce68_cgraph">
<area shape="rect" title=" " alt="" coords="5,157,204,184"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="254,132,363,159"/>
<area shape="rect" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9" title=" " alt="" coords="252,183,365,209"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="439,31,549,57"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="435,81,553,108"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="413,132,575,159"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="435,183,553,209"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="623,5,773,32"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="643,56,753,83"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="437,233,551,260"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a76f5e23936d63b1aa1a525e7f4181cf0" title=" " alt="" coords="433,284,555,311"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ae2d73f838a404b569a5c51da5ee2ce68_icgraph.png" border="0" usemap="#avmx_8h_ae2d73f838a404b569a5c51da5ee2ce68_icgraph" alt=""/></div>
<map name="avmx_8h_ae2d73f838a404b569a5c51da5ee2ce68_icgraph" id="avmx_8h_ae2d73f838a404b569a5c51da5ee2ce68_icgraph">
<area shape="rect" title=" " alt="" coords="1220,329,1419,356"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="983,253,1166,280"/>
<area shape="rect" href="vmx_8c.html#aee810f513145efc9286ee40258552a85" title=" " alt="" coords="977,329,1172,356"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="1016,380,1133,406"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="737,240,891,266"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,25,361,52"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,116,604,142"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,167,631,208"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,232,651,274"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,269,387,296"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,50,618,91"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,349,633,376"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,400,635,442"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,466,615,493"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,25,140,52"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,106,373,147"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,113,136,140"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,171,369,212"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,178,138,205"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,416,374,442"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,466,343,493"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,517,372,544"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,416,134,442"/>
<area shape="rect" href="vmx_8c.html#a7a38ddbd01bec99bf94ab4868ad4c6ea" title=" " alt="" coords="729,290,899,317"/>
<area shape="rect" href="vmx_8c.html#a0c4eb3bfc0efb0cc319b3d4b076b3c84" title=" " alt="" coords="739,341,889,368"/>
<area shape="rect" href="vmx_8c.html#a2036cf325e433da555987b14058374f2" title=" " alt="" coords="699,392,929,418"/>
</map>
</div>

</div>
</div>
<a id="ab7d363f044f24b98c355e1400a52b6ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7d363f044f24b98c355e1400a52b6ac">&#9670;&nbsp;</a></span>vmx_set_nmi_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_set_nmi_mask </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>masked</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l05005">5005</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;{</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160; </div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#a6c57cc8c0f93a3ea3e5dc56c0092a71c">enable_vnmi</a>) {</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;        <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#abee15264dfc3d58548c9c9e2a7db3b93">soft_vnmi_blocked</a> != masked) {</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;            vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#abee15264dfc3d58548c9c9e2a7db3b93">soft_vnmi_blocked</a> = masked;</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;            vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a71f5e6f27a26821f7e3a45fd01fb31bf">vnmi_blocked_time</a> = 0;</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;        }</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a8453552850c308ff95692d198bdaeaff">nmi_known_unmasked</a> = !masked;</div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;        <span class="keywordflow">if</span> (masked)</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;            <a class="code" href="vmx__ops_8h.html#ac276578ab10dd519c10d8da65a230cb5">vmcs_set_bits</a>(GUEST_INTERRUPTIBILITY_INFO,</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;                      GUEST_INTR_STATE_NMI);</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;            <a class="code" href="vmx__ops_8h.html#adc8982ecabf434efc37ef4eaf019945f">vmcs_clear_bits</a>(GUEST_INTERRUPTIBILITY_INFO,</div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;                    GUEST_INTR_STATE_NMI);</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;    }</div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;}</div>
<div class="ttc" id="astructloaded__vmcs_html_a71f5e6f27a26821f7e3a45fd01fb31bf"><div class="ttname"><a href="structloaded__vmcs.html#a71f5e6f27a26821f7e3a45fd01fb31bf">loaded_vmcs::vnmi_blocked_time</a></div><div class="ttdeci">s64 vnmi_blocked_time</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00071">vmcs.h:71</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_ac276578ab10dd519c10d8da65a230cb5"><div class="ttname"><a href="vmx__ops_8h.html#ac276578ab10dd519c10d8da65a230cb5">vmcs_set_bits</a></div><div class="ttdeci">static __always_inline void vmcs_set_bits(unsigned long field, u32 mask)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00277">vmx_ops.h:277</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_adc8982ecabf434efc37ef4eaf019945f"><div class="ttname"><a href="vmx__ops_8h.html#adc8982ecabf434efc37ef4eaf019945f">vmcs_clear_bits</a></div><div class="ttdeci">static __always_inline void vmcs_clear_bits(unsigned long field, u32 mask)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00267">vmx_ops.h:267</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ab7d363f044f24b98c355e1400a52b6ac_cgraph.png" border="0" usemap="#avmx_8h_ab7d363f044f24b98c355e1400a52b6ac_cgraph" alt=""/></div>
<map name="avmx_8h_ab7d363f044f24b98c355e1400a52b6ac_cgraph" id="avmx_8h_ab7d363f044f24b98c355e1400a52b6ac_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,159,108"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="235,31,305,57"/>
<area shape="rect" href="vmx__ops_8h.html#adc8982ecabf434efc37ef4eaf019945f" title=" " alt="" coords="207,132,333,159"/>
<area shape="rect" href="vmx__ops_8h.html#ac276578ab10dd519c10d8da65a230cb5" title=" " alt="" coords="213,81,327,108"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="407,56,517,83"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="405,107,519,133"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="403,157,521,184"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a76f5e23936d63b1aa1a525e7f4181cf0" title=" " alt="" coords="401,208,523,235"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="381,5,543,32"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="591,31,741,57"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="611,81,721,108"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ab7d363f044f24b98c355e1400a52b6ac_icgraph.png" border="0" usemap="#avmx_8h_ab7d363f044f24b98c355e1400a52b6ac_icgraph" alt=""/></div>
<map name="avmx_8h_ab7d363f044f24b98c355e1400a52b6ac_icgraph" id="avmx_8h_ab7d363f044f24b98c355e1400a52b6ac_icgraph">
<area shape="rect" title=" " alt="" coords="659,81,812,108"/>
<area shape="rect" href="vmx_8c.html#a56c05c3c3a588002f567fc26940e2cc8" title=" " alt="" coords="408,31,611,57"/>
<area shape="rect" href="vmx_8c.html#a0c4eb3bfc0efb0cc319b3d4b076b3c84" title=" " alt="" coords="434,81,585,108"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="410,132,609,159"/>
<area shape="rect" href="vmx_8c.html#a38687420b1a948e29e988ef785d94cfc" title=" " alt="" coords="184,5,347,32"/>
<area shape="rect" href="vmx_8c.html#a29c1984ee4757fbec240b3652988b916" title=" " alt="" coords="171,56,360,83"/>
<area shape="rect" href="vmx_8c.html#a909291866931c22138fd3ba80f0a7651" title=" " alt="" coords="5,56,123,83"/>
</map>
</div>

</div>
</div>
<a id="ae81f31c4be3384219d11e767cca4da94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae81f31c4be3384219d11e767cca4da94">&#9670;&nbsp;</a></span>vmx_set_rflags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_set_rflags </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>rflags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01527">1527</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;{</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> old_rflags;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160; </div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment">     * Unlike CR0 and CR4, RFLAGS handling requires checking if the vCPU</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="comment">     * is an unrestricted guest in order to mark L2 as needing emulation</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment">     * if L1 runs L2 as a restricted guest.</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec">is_unrestricted_guest</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>)) {</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <a class="code" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f">kvm_register_mark_available</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>, VCPU_EXREG_RFLAGS);</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a> = <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a>;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(GUEST_RFLAGS, <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a>);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    old_rflags = <a class="code" href="vmx_8c.html#adf1cae1921d1492c7e06115012eb48e3">vmx_get_rflags</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    vmx-&gt;<a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a> = <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a>;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keywordflow">if</span> (vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vm86_active</a>) {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#a5ac2787e395fb30b00c54884f37deafd">save_rflags</a> = <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a>;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a> |= X86_EFLAGS_IOPL | X86_EFLAGS_VM;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    }</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(GUEST_RFLAGS, <a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a>);</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160; </div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="keywordflow">if</span> ((old_rflags ^ vmx-&gt;<a class="code" href="structvcpu__vmx.html#a260ff06130ff61794b5711e321655624">rflags</a>) &amp; X86_EFLAGS_VM)</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a76afd8401fbca6792da2e0720bcbae5a">emulation_required</a> = <a class="code" href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5">vmx_emulation_required</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ae81f31c4be3384219d11e767cca4da94_cgraph.png" border="0" usemap="#avmx_8h_ae81f31c4be3384219d11e767cca4da94_cgraph" alt=""/></div>
<map name="avmx_8h_ae81f31c4be3384219d11e767cca4da94_cgraph" id="avmx_8h_ae81f31c4be3384219d11e767cca4da94_cgraph">
<area shape="rect" title=" " alt="" coords="5,385,127,412"/>
<area shape="rect" href="vmx_8h.html#a78db067c5ddef5481cee88243a0937ec" title=" " alt="" coords="642,56,803,83"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="1357,192,1428,219"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a02b01f3ac97e70ca6457508f8dd94b2f" title=" " alt="" coords="1807,707,2023,733"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="1599,301,1700,328"/>
<area shape="rect" href="vmx_8c.html#a3227ce57b73a94120917f2065d22b6b5" title=" " alt="" coords="175,95,360,121"/>
<area shape="rect" href="vmx_8c.html#adf1cae1921d1492c7e06115012eb48e3" title=" " alt="" coords="1101,531,1223,557"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="887,5,1007,32"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="1857,200,1972,227"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="1854,251,1975,277"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="1834,403,1995,429"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="1861,301,1968,328"/>
<area shape="rect" href="vmx_8h.html#abf810bd0c2816f1b62bf2a79296358cf" title=" " alt="" coords="408,95,581,121"/>
<area shape="rect" href="vmx_8h.html#a77b0ca4dac426b317965746a6bec345e" title=" " alt="" coords="629,335,816,361"/>
<area shape="rect" href="vmx_8c.html#a53b41b0e13efa39a027845ff9af21ed6" title=" " alt="" coords="869,157,1025,184"/>
<area shape="rect" href="vmx_8c.html#ad56726eeac472ac5b038651ccffbb6f4" title=" " alt="" coords="884,208,1011,235"/>
<area shape="rect" href="vmx_8c.html#ad10e667d050b2631c4b70247f8931c7d" title=" " alt="" coords="870,259,1025,285"/>
<area shape="rect" href="x86_8h.html#a134b4e55e4ea92a3519e9538f05d4e6b" title=" " alt="" coords="896,727,999,753"/>
<area shape="rect" href="vmx_8c.html#a1c712b1524bbb5ba769fb529614d5c35" title=" " alt="" coords="906,309,989,336"/>
<area shape="rect" href="vmx_8c.html#a335c8d8645c4e9d64ffcf6d5bc52b10f" title=" " alt="" coords="864,461,1031,488"/>
<area shape="rect" href="vmx_8c.html#abdb19ee07646c48c401dad49fae9c607" title=" " alt="" coords="867,360,1027,387"/>
<area shape="rect" href="vmx_8c.html#ae22de32cadb09c91caa1acb52293f01f" title=" " alt="" coords="912,411,983,437"/>
<area shape="rect" href="vmx_8c.html#acfb1910d98db4bcd82dd9a96eb069ce9" title=" " alt="" coords="1091,369,1233,396"/>
<area shape="rect" href="vmx_8c.html#ae978f1764c6b6e466c1547927fa5f977" title=" " alt="" coords="1303,547,1483,573"/>
<area shape="rect" href="vmx_8c.html#a911b88947099c0d21f8fbeca202ea30f" title=" " alt="" coords="1293,379,1492,405"/>
<area shape="rect" href="vmx_8c.html#ab9185adefc641ff428164a7fcab15c45" title=" " alt="" coords="1313,598,1473,639"/>
<area shape="rect" href="vmx_8c.html#ae1134559a10e8db36f8d2dabc07f78fc" title=" " alt="" coords="1313,481,1473,522"/>
<area shape="rect" href="vmx__ops_8h.html#a8e451d9fa742dfde330958372b978485" title=" " alt="" coords="1595,551,1704,577"/>
<area shape="rect" href="vmx_8c.html#a69771798b92b67f275b9be73a17f6353" title=" " alt="" coords="1540,604,1759,631"/>
<area shape="rect" href="vmx__ops_8h.html#a4e53c9e55e0e6a94f7304f0f672e1168" title=" " alt="" coords="1859,453,1970,480"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ad90d48badc854d1cdc59509cece943a5" title=" " alt="" coords="1856,605,1973,632"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="1855,656,1974,683"/>
<area shape="rect" href="x86_8c.html#aa600a8b690e74e45d1ce6b590b74a60b" title=" " alt="" coords="2071,428,2221,455"/>
<area shape="rect" href="vmx__ops_8h.html#a5bd8b5279566f5cedece56ca03955271" title=" " alt="" coords="2091,479,2201,505"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1818,765,2011,792"/>
<area shape="rect" href="vmx__ops_8h.html#aefa9026aa63362d2c8205086f646e956" title=" " alt="" coords="1601,387,1698,413"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab02646b06f78249d1315b2affdeb6572" title=" " alt="" coords="1856,352,1973,379"/>
<area shape="rect" href="vmx__ops_8h.html#af65cbcf47ab58f0ae9a713ebf50f03a7" title=" " alt="" coords="1595,488,1704,515"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a77b65dd311c34381a8508de99e9b8543" title=" " alt="" coords="1856,504,1973,531"/>
<area shape="rect" href="vmx__ops_8h.html#a99d3cd27b0b9d3e69fcc2e1cae4225fa" title=" " alt="" coords="1855,555,1974,581"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="1089,740,1235,767"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="1577,765,1722,792"/>
<area shape="rect" href="vmx_8c.html#a0a4bc0d90ba4aa4d6e9758f35cd84261" title=" " alt="" coords="1079,454,1245,495"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ae81f31c4be3384219d11e767cca4da94_icgraph.png" border="0" usemap="#avmx_8h_ae81f31c4be3384219d11e767cca4da94_icgraph" alt=""/></div>
<map name="avmx_8h_ae81f31c4be3384219d11e767cca4da94_icgraph" id="avmx_8h_ae81f31c4be3384219d11e767cca4da94_icgraph">
<area shape="rect" title=" " alt="" coords="1355,564,1476,591"/>
<area shape="rect" href="sgx_8c.html#ad3394313e85a46c8e1bc4880ddde7fc9" title=" " alt="" coords="1148,5,1291,32"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,445,1084,472"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,85,138,112"/>
<area shape="rect" href="vmx_2nested_8c.html#a46021f02931b3001ef00a526b56448a8" title=" " alt="" coords="1132,753,1307,780"/>
<area shape="rect" href="vmx_2nested_8c.html#aec3ff66d7b1e9086f727ebe6b9b1a0cf" title=" " alt="" coords="1138,816,1301,843"/>
<area shape="rect" href="vmx_2nested_8c.html#a3c80ece98832af9587ecff9947817449" title=" " alt="" coords="911,929,1074,956"/>
<area shape="rect" href="sgx_8c.html#a34e5ee57c3e7c3172f8ae6ed981d703d" title=" " alt="" coords="939,5,1046,32"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,399,853,425"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,209,361,236"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,575,604,601"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,107,631,149"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,391,651,433"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,323,387,349"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,173,618,214"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,340,633,367"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,509,635,550"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,457,615,484"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,209,140,236"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,846,373,887"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,853,136,880"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,107,369,149"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,457,374,484"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,407,343,433"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,508,372,535"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,457,134,484"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="715,828,837,855"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="713,727,839,753"/>
<area shape="rect" href="vmx_2nested_8c.html#acfc614b787620aa3ea5f48ed247cfe30" title=" " alt="" coords="717,777,835,804"/>
<area shape="rect" href="vmx_2nested_8c.html#a4d1da86d40e5c09521979006a05a35e4" title=" " alt="" coords="927,879,1058,905"/>
<area shape="rect" href="vmx_2nested_8c.html#add1e82c32385142c0fca04a1db8cbc3a" title=" " alt="" coords="711,676,841,703"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="719,1031,833,1057"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="715,879,837,905"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="713,929,839,956"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="714,980,838,1007"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fecee9010894e3a1513a0924e24dd6" title=" " alt="" coords="474,676,611,703"/>
<area shape="rect" href="vmx_2nested_8c.html#a23e3de8c964e87404eea818be6f70154" title=" " alt="" coords="471,625,614,652"/>
<area shape="rect" href="vmx_2nested_8c.html#a0597b7f483c8cc06841f463e5dd3203d" title=" " alt="" coords="481,1081,605,1108"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="717,1132,835,1159"/>
</map>
</div>

</div>
</div>
<a id="a3f6e91eedb4d7eefd8f4007389aaac7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f6e91eedb4d7eefd8f4007389aaac7b">&#9670;&nbsp;</a></span>vmx_set_virtual_apic_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_set_virtual_apic_mode </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l06694">6694</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;{</div>
<div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;    u32 sec_exec_control;</div>
<div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160; </div>
<div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4">lapic_in_kernel</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>))</div>
<div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160; </div>
<div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8c.html#adb3897769bf0e68e748a91e67814aba0">flexpriority_enabled</a> &amp;&amp;</div>
<div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;        !<a class="code" href="capabilities_8h.html#a5f82fbdd2448e4da3bc04f3a24394db4">cpu_has_vmx_virtualize_x2apic_mode</a>())</div>
<div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160; </div>
<div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;    <span class="comment">/* Postpone execution until vmcs01 is the current VMCS. */</span></div>
<div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>)) {</div>
<div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a8c239bf06e666ec62b7ff19f1e2966bf">nested</a>.<a class="code" href="structnested__vmx.html#ae2614c41bfc1b399f4b3642318e36d31">change_vmcs01_virtual_apic_mode</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;    }</div>
<div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160; </div>
<div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;    sec_exec_control = secondary_exec_controls_get(vmx);</div>
<div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;    sec_exec_control &amp;= ~(SECONDARY_EXEC_VIRTUALIZE_APIC_ACCESSES |</div>
<div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;                  SECONDARY_EXEC_VIRTUALIZE_X2APIC_MODE);</div>
<div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160; </div>
<div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="lapic_8h.html#a8415cd1d2d30e65d505adb5ba75a0338">kvm_get_apic_mode</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>)) {</div>
<div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="lapic_8h.html#a0c04991fb862ed18aaf962dc5eae9dffacc7944d9d7dbe606acabbf39f2fd9358">LAPIC_MODE_INVALID</a>:</div>
<div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;        WARN_ONCE(<span class="keyword">true</span>, <span class="stringliteral">&quot;Invalid local APIC state&quot;</span>);</div>
<div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="lapic_8h.html#a0c04991fb862ed18aaf962dc5eae9dffaa085aa594329c377d85feca3872e9d38">LAPIC_MODE_DISABLED</a>:</div>
<div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="lapic_8h.html#a0c04991fb862ed18aaf962dc5eae9dffaaf077cffd5b7a15d27225db34a95b56c">LAPIC_MODE_XAPIC</a>:</div>
<div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="vmx_8c.html#adb3897769bf0e68e748a91e67814aba0">flexpriority_enabled</a>) {</div>
<div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;            sec_exec_control |=</div>
<div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;                SECONDARY_EXEC_VIRTUALIZE_APIC_ACCESSES;</div>
<div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;            kvm_make_request(KVM_REQ_APIC_PAGE_RELOAD, <a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160; </div>
<div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;<span class="comment">             * Flush the TLB, reloading the APIC access page will</span></div>
<div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;<span class="comment">             * only do so if its physical address has changed, but</span></div>
<div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;<span class="comment">             * the guest may have inserted a non-APIC mapping into</span></div>
<div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;<span class="comment">             * the TLB while the APIC access page was disabled.</span></div>
<div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160;            kvm_make_request(KVM_REQ_TLB_FLUSH_CURRENT, <a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;        }</div>
<div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="lapic_8h.html#a0c04991fb862ed18aaf962dc5eae9dffa995b62067c99e3263b6615a6b44bf092">LAPIC_MODE_X2APIC</a>:</div>
<div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="capabilities_8h.html#a5f82fbdd2448e4da3bc04f3a24394db4">cpu_has_vmx_virtualize_x2apic_mode</a>())</div>
<div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;            sec_exec_control |=</div>
<div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;                SECONDARY_EXEC_VIRTUALIZE_X2APIC_MODE;</div>
<div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160;    }</div>
<div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;    secondary_exec_controls_set(vmx, sec_exec_control);</div>
<div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160; </div>
<div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;    <a class="code" href="vmx_8c.html#a60eaab2d29aa87878b8dd9b43dadb779">vmx_update_msr_bitmap_x2apic</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;}</div>
<div class="ttc" id="acapabilities_8h_html_a5f82fbdd2448e4da3bc04f3a24394db4"><div class="ttname"><a href="capabilities_8h.html#a5f82fbdd2448e4da3bc04f3a24394db4">cpu_has_vmx_virtualize_x2apic_mode</a></div><div class="ttdeci">static bool cpu_has_vmx_virtualize_x2apic_mode(void)</div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8h_source.html#l00165">capabilities.h:165</a></div></div>
<div class="ttc" id="alapic_8h_html_a0c04991fb862ed18aaf962dc5eae9dffa995b62067c99e3263b6615a6b44bf092"><div class="ttname"><a href="lapic_8h.html#a0c04991fb862ed18aaf962dc5eae9dffa995b62067c99e3263b6615a6b44bf092">LAPIC_MODE_X2APIC</a></div><div class="ttdeci">@ LAPIC_MODE_X2APIC</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00029">lapic.h:29</a></div></div>
<div class="ttc" id="alapic_8h_html_a0c04991fb862ed18aaf962dc5eae9dffaa085aa594329c377d85feca3872e9d38"><div class="ttname"><a href="lapic_8h.html#a0c04991fb862ed18aaf962dc5eae9dffaa085aa594329c377d85feca3872e9d38">LAPIC_MODE_DISABLED</a></div><div class="ttdeci">@ LAPIC_MODE_DISABLED</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00026">lapic.h:26</a></div></div>
<div class="ttc" id="alapic_8h_html_a0c04991fb862ed18aaf962dc5eae9dffaaf077cffd5b7a15d27225db34a95b56c"><div class="ttname"><a href="lapic_8h.html#a0c04991fb862ed18aaf962dc5eae9dffaaf077cffd5b7a15d27225db34a95b56c">LAPIC_MODE_XAPIC</a></div><div class="ttdeci">@ LAPIC_MODE_XAPIC</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00028">lapic.h:28</a></div></div>
<div class="ttc" id="alapic_8h_html_a0c04991fb862ed18aaf962dc5eae9dffacc7944d9d7dbe606acabbf39f2fd9358"><div class="ttname"><a href="lapic_8h.html#a0c04991fb862ed18aaf962dc5eae9dffacc7944d9d7dbe606acabbf39f2fd9358">LAPIC_MODE_INVALID</a></div><div class="ttdeci">@ LAPIC_MODE_INVALID</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00027">lapic.h:27</a></div></div>
<div class="ttc" id="alapic_8h_html_a8415cd1d2d30e65d505adb5ba75a0338"><div class="ttname"><a href="lapic_8h.html#a8415cd1d2d30e65d505adb5ba75a0338">kvm_get_apic_mode</a></div><div class="ttdeci">enum lapic_mode kvm_get_apic_mode(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l00474">x86.c:479</a></div></div>
<div class="ttc" id="astructnested__vmx_html_ae2614c41bfc1b399f4b3642318e36d31"><div class="ttname"><a href="structnested__vmx.html#ae2614c41bfc1b399f4b3642318e36d31">nested_vmx::change_vmcs01_virtual_apic_mode</a></div><div class="ttdeci">bool change_vmcs01_virtual_apic_mode</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00176">vmx.h:176</a></div></div>
<div class="ttc" id="avmx_8c_html_a60eaab2d29aa87878b8dd9b43dadb779"><div class="ttname"><a href="vmx_8c.html#a60eaab2d29aa87878b8dd9b43dadb779">vmx_update_msr_bitmap_x2apic</a></div><div class="ttdeci">static void vmx_update_msr_bitmap_x2apic(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l04038">vmx.c:4038</a></div></div>
<div class="ttc" id="avmx_8c_html_adb3897769bf0e68e748a91e67814aba0"><div class="ttname"><a href="vmx_8c.html#adb3897769bf0e68e748a91e67814aba0">flexpriority_enabled</a></div><div class="ttdeci">bool __read_mostly flexpriority_enabled</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00088">vmx.c:88</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a3f6e91eedb4d7eefd8f4007389aaac7b_cgraph.png" border="0" usemap="#avmx_8h_a3f6e91eedb4d7eefd8f4007389aaac7b_cgraph" alt=""/></div>
<map name="avmx_8h_a3f6e91eedb4d7eefd8f4007389aaac7b_cgraph" id="avmx_8h_a3f6e91eedb4d7eefd8f4007389aaac7b_cgraph">
<area shape="rect" title=" " alt="" coords="5,147,211,174"/>
<area shape="rect" href="capabilities_8h.html#a5f82fbdd2448e4da3bc04f3a24394db4" title=" " alt="" coords="263,5,442,47"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="293,71,413,98"/>
<area shape="rect" href="lapic_8h.html#a8415cd1d2d30e65d505adb5ba75a0338" title=" " alt="" coords="274,122,431,149"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="776,274,895,301"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="1039,521,1109,547"/>
<area shape="rect" href="vmx_8c.html#a60eaab2d29aa87878b8dd9b43dadb779" title=" " alt="" coords="259,472,447,513"/>
<area shape="rect" href="capabilities_8h.html#a7dc840840c570386f3265751dbcd8b41" title=" " alt="" coords="501,325,688,367"/>
<area shape="rect" href="capabilities_8h.html#ab417100ad999a4402c4b0698ada5dc9b" title=" " alt="" coords="976,739,1172,766"/>
<area shape="rect" href="lapic_8c.html#a4b4d880305f2ddba0ac9fdb398a7611a" title=" " alt="" coords="518,443,671,484"/>
<area shape="rect" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358" title=" " alt="" coords="505,391,684,418"/>
<area shape="rect" href="vmx_8c.html#a96f48e7f7fd7a33ba502bea65d7a94d8" title=" " alt="" coords="750,753,921,795"/>
<area shape="rect" href="vmx_8c.html#a3db9d3d67497234d969c753d0b1093ab" title=" " alt="" coords="752,623,919,664"/>
<area shape="rect" href="vmx_8h.html#a5f203a8d867ee0e3830ee06de5fbea20" title=" " alt="" coords="495,610,695,637"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="764,401,907,427"/>
<area shape="rect" href="lapic_8c.html#a36de6235abe5d5bd2fd57bf5739c1b5f" title=" " alt="" coords="743,451,928,478"/>
<area shape="rect" href="vmx_8c.html#a5742d1df3fb94e98dd1a0f0443b529a4" title=" " alt="" coords="979,689,1169,715"/>
<area shape="rect" href="vmx_8c.html#aa4973cf70be6e2559648a74eab4987a5" title=" " alt="" coords="1220,681,1383,723"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="1003,841,1145,867"/>
<area shape="rect" href="vmx_8c.html#a4322412ccf65775174621cab858dd234" title=" " alt="" coords="993,623,1155,664"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="1221,630,1382,657"/>
<area shape="rect" href="vmx_8h.html#a96f48e7f7fd7a33ba502bea65d7a94d8" title=" " alt="" coords="750,688,921,729"/>
<area shape="rect" href="vmx_8h.html#a3db9d3d67497234d969c753d0b1093ab" title=" " alt="" coords="752,557,919,599"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a3f6e91eedb4d7eefd8f4007389aaac7b_icgraph.png" border="0" usemap="#avmx_8h_a3f6e91eedb4d7eefd8f4007389aaac7b_icgraph" alt=""/></div>
<map name="avmx_8h_a3f6e91eedb4d7eefd8f4007389aaac7b_icgraph" id="avmx_8h_a3f6e91eedb4d7eefd8f4007389aaac7b_icgraph">
<area shape="rect" title=" " alt="" coords="901,244,1107,270"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,244,853,270"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,29,361,56"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,120,604,146"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,171,631,212"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,236,651,278"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,273,387,300"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,54,618,95"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,353,633,380"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,404,635,446"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,470,615,497"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,29,140,56"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,110,373,151"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,117,136,144"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,175,369,216"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,182,138,209"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,420,374,446"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,470,343,497"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,521,372,548"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,420,134,446"/>
</map>
</div>

</div>
</div>
<a id="a0b6c0e9c7b484761a132ec953d096492"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b6c0e9c7b484761a132ec953d096492">&#9670;&nbsp;</a></span>vmx_spec_ctrl_restore_host()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_spec_ctrl_restore_host </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *&#160;</td>
          <td class="paramname"><em>vmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l07192">7192</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;{</div>
<div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160;    u64 hostval = this_cpu_read(x86_spec_ctrl_current);</div>
<div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160; </div>
<div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;    <span class="keywordflow">if</span> (!cpu_feature_enabled(X86_FEATURE_MSR_SPEC_CTRL))</div>
<div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160; </div>
<div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &amp; <a class="code" href="run__flags_8h.html#a5d3ba313b977949c46fbac49f895ddc7">VMX_RUN_SAVE_SPEC_CTRL</a>)</div>
<div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a815b675924198437a00d9a2d33a20e4c">spec_ctrl</a> = __rdmsr(MSR_IA32_SPEC_CTRL);</div>
<div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160; </div>
<div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;<span class="comment">     * If the guest/host SPEC_CTRL values differ, restore the host value.</span></div>
<div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l07206"></a><span class="lineno"> 7206</span>&#160;<span class="comment">     * For legacy IBRS, the IBRS bit always needs to be written after</span></div>
<div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160;<span class="comment">     * transitioning from a less privileged predictor mode, regardless of</span></div>
<div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160;<span class="comment">     * whether the guest/host values differ.</span></div>
<div class="line"><a name="l07209"></a><span class="lineno"> 7209</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l07210"></a><span class="lineno"> 7210</span>&#160;    <span class="keywordflow">if</span> (cpu_feature_enabled(X86_FEATURE_KERNEL_IBRS) ||</div>
<div class="line"><a name="l07211"></a><span class="lineno"> 7211</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a815b675924198437a00d9a2d33a20e4c">spec_ctrl</a> != hostval)</div>
<div class="line"><a name="l07212"></a><span class="lineno"> 7212</span>&#160;        native_wrmsrl(MSR_IA32_SPEC_CTRL, hostval);</div>
<div class="line"><a name="l07213"></a><span class="lineno"> 7213</span>&#160; </div>
<div class="line"><a name="l07214"></a><span class="lineno"> 7214</span>&#160;    barrier_nospec();</div>
<div class="line"><a name="l07215"></a><span class="lineno"> 7215</span>&#160;}</div>
<div class="ttc" id="astructvcpu__vmx_html_a815b675924198437a00d9a2d33a20e4c"><div class="ttname"><a href="structvcpu__vmx.html#a815b675924198437a00d9a2d33a20e4c">vcpu_vmx::spec_ctrl</a></div><div class="ttdeci">u64 spec_ctrl</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00283">vmx.h:283</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab423eb4ed8f021a4985f4f471c891ba3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab423eb4ed8f021a4985f4f471c891ba3">&#9670;&nbsp;</a></span>vmx_update_cpu_dirty_logging()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_update_cpu_dirty_logging </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l08110">8110</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l08111"></a><span class="lineno"> 8111</span>&#160;{</div>
<div class="line"><a name="l08112"></a><span class="lineno"> 8112</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l08113"></a><span class="lineno"> 8113</span>&#160; </div>
<div class="line"><a name="l08114"></a><span class="lineno"> 8114</span>&#160;    <span class="keywordflow">if</span> (WARN_ON_ONCE(!<a class="code" href="vmx_8c.html#a869a6afe50059b01380ae1911c1e4ad2">enable_pml</a>))</div>
<div class="line"><a name="l08115"></a><span class="lineno"> 8115</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l08116"></a><span class="lineno"> 8116</span>&#160; </div>
<div class="line"><a name="l08117"></a><span class="lineno"> 8117</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>)) {</div>
<div class="line"><a name="l08118"></a><span class="lineno"> 8118</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a8c239bf06e666ec62b7ff19f1e2966bf">nested</a>.<a class="code" href="structnested__vmx.html#adf0f60d93abc261ef32d07b7f1d195a5">update_vmcs01_cpu_dirty_logging</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l08119"></a><span class="lineno"> 8119</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l08120"></a><span class="lineno"> 8120</span>&#160;    }</div>
<div class="line"><a name="l08121"></a><span class="lineno"> 8121</span>&#160; </div>
<div class="line"><a name="l08122"></a><span class="lineno"> 8122</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l08123"></a><span class="lineno"> 8123</span>&#160;<span class="comment">     * Note, nr_memslots_dirty_logging can be changed concurrent with this</span></div>
<div class="line"><a name="l08124"></a><span class="lineno"> 8124</span>&#160;<span class="comment">     * code, but in that case another update request will be made and so</span></div>
<div class="line"><a name="l08125"></a><span class="lineno"> 8125</span>&#160;<span class="comment">     * the guest will never run with a stale PML value.</span></div>
<div class="line"><a name="l08126"></a><span class="lineno"> 8126</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l08127"></a><span class="lineno"> 8127</span>&#160;    <span class="keywordflow">if</span> (atomic_read(&amp;<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>-&gt;kvm-&gt;nr_memslots_dirty_logging))</div>
<div class="line"><a name="l08128"></a><span class="lineno"> 8128</span>&#160;        secondary_exec_controls_setbit(vmx, SECONDARY_EXEC_ENABLE_PML);</div>
<div class="line"><a name="l08129"></a><span class="lineno"> 8129</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l08130"></a><span class="lineno"> 8130</span>&#160;        secondary_exec_controls_clearbit(vmx, SECONDARY_EXEC_ENABLE_PML);</div>
<div class="line"><a name="l08131"></a><span class="lineno"> 8131</span>&#160;}</div>
<div class="ttc" id="astructnested__vmx_html_adf0f60d93abc261ef32d07b7f1d195a5"><div class="ttname"><a href="structnested__vmx.html#adf0f60d93abc261ef32d07b7f1d195a5">nested_vmx::update_vmcs01_cpu_dirty_logging</a></div><div class="ttdeci">bool update_vmcs01_cpu_dirty_logging</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00178">vmx.h:178</a></div></div>
<div class="ttc" id="avmx_8c_html_a869a6afe50059b01380ae1911c1e4ad2"><div class="ttname"><a href="vmx_8c.html#a869a6afe50059b01380ae1911c1e4ad2">enable_pml</a></div><div class="ttdeci">bool __read_mostly enable_pml</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8c_source.html#l00120">vmx.c:120</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ab423eb4ed8f021a4985f4f471c891ba3_cgraph.png" border="0" usemap="#avmx_8h_ab423eb4ed8f021a4985f4f471c891ba3_cgraph" alt=""/></div>
<map name="avmx_8h_ab423eb4ed8f021a4985f4f471c891ba3_cgraph" id="avmx_8h_ab423eb4ed8f021a4985f4f471c891ba3_cgraph">
<area shape="rect" title=" " alt="" coords="5,23,176,65"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="224,5,344,32"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="249,56,319,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ab423eb4ed8f021a4985f4f471c891ba3_icgraph.png" border="0" usemap="#avmx_8h_ab423eb4ed8f021a4985f4f471c891ba3_icgraph" alt=""/></div>
<map name="avmx_8h_ab423eb4ed8f021a4985f4f471c891ba3_icgraph" id="avmx_8h_ab423eb4ed8f021a4985f4f471c891ba3_icgraph">
<area shape="rect" title=" " alt="" coords="901,236,1072,278"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,244,853,270"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,29,361,56"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,120,604,146"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,171,631,212"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,236,651,278"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,273,387,300"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,54,618,95"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,353,633,380"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,404,635,446"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,470,615,497"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,29,140,56"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,110,373,151"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,117,136,144"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,175,369,216"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,182,138,209"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,420,374,446"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,470,343,497"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,521,372,548"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,420,134,446"/>
</map>
</div>

</div>
</div>
<a id="a6ddb2979d2cb226fe63f24b99f88a99e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ddb2979d2cb226fe63f24b99f88a99e">&#9670;&nbsp;</a></span>vmx_update_exception_bitmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_update_exception_bitmap </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l00874">874</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;{</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    u32 eb;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    eb = (1u &lt;&lt; PF_VECTOR) | (1u &lt;&lt; UD_VECTOR) | (1u &lt;&lt; MC_VECTOR) |</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;         (1u &lt;&lt; DB_VECTOR) | (1u &lt;&lt; AC_VECTOR);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">     * Guest access to VMware backdoor ports could legitimately</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">     * trigger #GP because of TSS I/O permission bitmap.</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">     * We intercept those #GP and allow access to them anyway</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">     * as VMware does.</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a2ce1016cd5cbf9583cfe1ec0e64e9118">enable_vmware_backdoor</a>)</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        eb |= (1u &lt;&lt; GP_VECTOR);</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keywordflow">if</span> ((vcpu-&gt;guest_debug &amp;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;         (KVM_GUESTDBG_ENABLE | KVM_GUESTDBG_USE_SW_BP)) ==</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        (KVM_GUESTDBG_ENABLE | KVM_GUESTDBG_USE_SW_BP))</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        eb |= 1u &lt;&lt; BP_VECTOR;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(vcpu)-&gt;<a class="code" href="structvcpu__vmx.html#a681de6c7b77c3ea7dc1957773c87b753">rmode</a>.<a class="code" href="structvcpu__vmx.html#aaa63f71d9d8f2379dcbd33365383f22e">vm86_active</a>)</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        eb = ~0;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vmx_8h.html#a046cd100cd1f1b77bfa5ba028dcd52ff">vmx_need_pf_intercept</a>(vcpu))</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        eb &amp;= ~(1u &lt;&lt; PF_VECTOR);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="comment">/* When we are running a nested L2 guest and L1 specified for it a</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">     * certain exception bitmap, we must trap the same exceptions and pass</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">     * them to L1. When running L2, we will only handle the exceptions</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">     * specified above if L1 did not want them.</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(vcpu))</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        eb |= <a class="code" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497">get_vmcs12</a>(vcpu)-&gt;<a class="code" href="structvmcs12.html#a3850890ffe2376b9d33088fe970e6a42">exception_bitmap</a>;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordtype">int</span> mask = 0, match = 0;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160; </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="vmx_8c.html#abf08136dbf993f207b5536a18082c6ed">enable_ept</a> &amp;&amp; (eb &amp; (1u &lt;&lt; PF_VECTOR))) {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">             * If EPT is enabled, #PF is currently only intercepted</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">             * if MAXPHYADDR is smaller on the guest than on the</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">             * host.  In that case we only care about present,</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">             * non-reserved faults.  For vmcs02, however, PFEC_MASK</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">             * and PFEC_MATCH are set in prepare_vmcs02_rare.</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            mask = PFERR_PRESENT_MASK | PFERR_RSVD_MASK;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            match = PFERR_PRESENT_MASK;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <a class="code" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9">vmcs_write32</a>(PAGE_FAULT_ERROR_CODE_MASK, mask);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <a class="code" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9">vmcs_write32</a>(PAGE_FAULT_ERROR_CODE_MATCH, match);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">     * Disabling xfd interception indicates that dynamic xfeatures</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">     * might be used in the guest. Always trap #NM in this case</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">     * to save guest xfd_err timely.</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">if</span> (vcpu-&gt;arch.xfd_no_write_intercept)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        eb |= (1u &lt;&lt; NM_VECTOR);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160; </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <a class="code" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9">vmcs_write32</a>(EXCEPTION_BITMAP, eb);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;}</div>
<div class="ttc" id="astructvmcs12_html_a3850890ffe2376b9d33088fe970e6a42"><div class="ttname"><a href="structvmcs12.html#a3850890ffe2376b9d33088fe970e6a42">vmcs12::exception_bitmap</a></div><div class="ttdeci">u32 exception_bitmap</div><div class="ttdef"><b>Definition:</b> <a href="vmcs12_8h_source.html#l00123">vmcs12.h:123</a></div></div>
<div class="ttc" id="avmx_8h_html_a046cd100cd1f1b77bfa5ba028dcd52ff"><div class="ttname"><a href="vmx_8h.html#a046cd100cd1f1b77bfa5ba028dcd52ff">vmx_need_pf_intercept</a></div><div class="ttdeci">static bool vmx_need_pf_intercept(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vmx_8h_source.html#l00719">vmx.h:719</a></div></div>
<div class="ttc" id="ax86_8c_html_a2ce1016cd5cbf9583cfe1ec0e64e9118"><div class="ttname"><a href="x86_8c.html#a2ce1016cd5cbf9583cfe1ec0e64e9118">enable_vmware_backdoor</a></div><div class="ttdeci">bool __read_mostly enable_vmware_backdoor</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l00176">x86.c:176</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a6ddb2979d2cb226fe63f24b99f88a99e_cgraph.png" border="0" usemap="#avmx_8h_a6ddb2979d2cb226fe63f24b99f88a99e_cgraph" alt=""/></div>
<map name="avmx_8h_a6ddb2979d2cb226fe63f24b99f88a99e_cgraph" id="avmx_8h_a6ddb2979d2cb226fe63f24b99f88a99e_cgraph">
<area shape="rect" title=" " alt="" coords="5,99,180,141"/>
<area shape="rect" href="nested_8h.html#a65c62b59f6be374d9da24feaef363497" title=" " alt="" coords="265,5,366,32"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="496,5,567,32"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="255,107,375,133"/>
<area shape="rect" href="vmx__ops_8h.html#a2a7e7c5e8ee913ae1811b078174df0c9" title=" " alt="" coords="259,157,372,184"/>
<area shape="rect" href="vmx_8h.html#a046cd100cd1f1b77bfa5ba028dcd52ff" title=" " alt="" coords="228,233,403,260"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="474,56,589,83"/>
<area shape="rect" href="vmx__onhyperv_8h.html#a76f5e23936d63b1aa1a525e7f4181cf0" title=" " alt="" coords="471,107,592,133"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="451,157,612,184"/>
<area shape="rect" href="vmx__ops_8h.html#af5ce3717bbcc96eeddead8b57ac3fa6a" title=" " alt="" coords="472,208,591,235"/>
<area shape="rect" href="cpuid_8h.html#a1678e00b10264045277c1abfcb6eec3e" title=" " alt="" coords="458,259,605,285"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a6ddb2979d2cb226fe63f24b99f88a99e_icgraph.png" border="0" usemap="#avmx_8h_a6ddb2979d2cb226fe63f24b99f88a99e_icgraph" alt=""/></div>
<map name="avmx_8h_a6ddb2979d2cb226fe63f24b99f88a99e_icgraph" id="avmx_8h_a6ddb2979d2cb226fe63f24b99f88a99e_icgraph">
<area shape="rect" title=" " alt="" coords="1487,535,1661,577"/>
<area shape="rect" href="vmx_8c.html#a5b0ffadb6f1bbf0fe42d6cf7a17490bb" title=" " alt="" coords="1308,492,1416,519"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,576,138,603"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,5,343,32"/>
<area shape="rect" href="vmx_8c.html#ac744bdcb0b42778132eaeb180e29e70c" title=" " alt="" coords="1309,543,1415,569"/>
<area shape="rect" href="vmx_8c.html#a8ff77baa2f28fd717210bcac02a13434" title=" " alt="" coords="1285,678,1439,719"/>
<area shape="rect" href="vmx_8c.html#acf9f5acdb0b2a5b2778c853846cfa09f" title=" " alt="" coords="1132,492,1237,519"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="901,357,1084,384"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="915,467,1070,509"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="699,341,853,368"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,355,361,381"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,459,604,485"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,510,631,551"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,107,651,149"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,279,387,305"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,393,618,434"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,173,633,200"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,225,635,266"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,56,615,83"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,355,140,381"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,445,373,486"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,452,136,479"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,510,369,551"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,56,374,83"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,107,372,133"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,56,134,83"/>
</map>
</div>

</div>
</div>
<a id="ae503a24f01885d9e4044034cf2e709cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae503a24f01885d9e4044034cf2e709cb">&#9670;&nbsp;</a></span>vmx_update_host_rsp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_update_host_rsp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__vmx.html">vcpu_vmx</a> *&#160;</td>
          <td class="paramname"><em>vmx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>host_rsp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l07184">7184</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;{</div>
<div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;    <span class="keywordflow">if</span> (unlikely(host_rsp != vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a058c58b6c534321752261fcb9271bd74">host_state</a>.<a class="code" href="structvmcs__host__state.html#aefed838ca75b84f863fc7b71d68a18f1">rsp</a>)) {</div>
<div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a058c58b6c534321752261fcb9271bd74">host_state</a>.<a class="code" href="structvmcs__host__state.html#aefed838ca75b84f863fc7b71d68a18f1">rsp</a> = host_rsp;</div>
<div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;        <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_RSP, host_rsp);</div>
<div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160;    }</div>
<div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;}</div>
<div class="ttc" id="astructvmcs__host__state_html_aefed838ca75b84f863fc7b71d68a18f1"><div class="ttname"><a href="structvmcs__host__state.html#aefed838ca75b84f863fc7b71d68a18f1">vmcs_host_state::rsp</a></div><div class="ttdeci">unsigned long rsp</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00039">vmcs.h:39</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_ae503a24f01885d9e4044034cf2e709cb_cgraph.png" border="0" usemap="#avmx_8h_ae503a24f01885d9e4044034cf2e709cb_cgraph" alt=""/></div>
<map name="avmx_8h_ae503a24f01885d9e4044034cf2e709cb_cgraph" id="avmx_8h_ae503a24f01885d9e4044034cf2e709cb_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,171,108"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="219,81,320,108"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="391,5,506,32"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="388,56,509,83"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="368,107,529,133"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="395,157,502,184"/>
</map>
</div>

</div>
</div>
<a id="a7b282a828cac2d1ae55bb522a0c42c1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b282a828cac2d1ae55bb522a0c42c1f">&#9670;&nbsp;</a></span>vmx_vcpu_load_vmcs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmx_vcpu_load_vmcs </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structloaded__vmcs.html">loaded_vmcs</a> *&#160;</td>
          <td class="paramname"><em>buddy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vmx_8c_source.html#l01415">1415</a> of file <a class="el" href="vmx_8c_source.html">vmx.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;{</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__vmx.html">vcpu_vmx</a> *vmx = <a class="code" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4">to_vmx</a>(<a class="code" href="structvcpu__vmx.html#a8a60fad06a6c03c5cc25e80d9a5b0203">vcpu</a>);</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="keywordtype">bool</span> already_loaded = vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a41190e00a22fb0388ba36b9bb5cc3bdd">cpu</a> == cpu;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvmcs.html">vmcs</a> *prev;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160; </div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">if</span> (!already_loaded) {</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        <a class="code" href="vmx_8c.html#acffc6d01ff543c9abee613b5fe1b1bd4">loaded_vmcs_clear</a>(vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        local_irq_disable();</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">         * Ensure loaded_vmcs-&gt;cpu is read before adding loaded_vmcs to</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">         * this cpu&#39;s percpu list, otherwise it may not yet be deleted</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment">         * from its previous cpu&#39;s percpu list.  Pairs with the</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment">         * smb_wmb() in __loaded_vmcs_clear().</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        smp_rmb();</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160; </div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        list_add(&amp;vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#ae1b5a89e2a622eb313efc632f663d4fd">loaded_vmcss_on_cpu_link</a>,</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;             &amp;per_cpu(loaded_vmcss_on_cpu, cpu));</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        local_irq_enable();</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    }</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160; </div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    prev = per_cpu(current_vmcs, cpu);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="keywordflow">if</span> (prev != vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a>) {</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        per_cpu(current_vmcs, cpu) = vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a>;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <a class="code" href="vmx__ops_8h.html#a33ef2cd0708406b39123ddd368eeb996">vmcs_load</a>(vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a>);</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160; </div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">         * No indirect branch prediction barrier needed when switching</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">         * the active VMCS within a vCPU, unless IBRS is advertised to</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment">         * the vCPU.  To minimize the number of IBPBs executed, KVM</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment">         * performs IBPB on nested VM-Exit (a single nested transition</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment">         * may switch the active VMCS multiple times).</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        <span class="keywordflow">if</span> (!buddy || WARN_ON_ONCE(buddy-&gt;<a class="code" href="structloaded__vmcs.html#a7ad4f334c47135f357d1e4fe338676b5">vmcs</a> != prev))</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;            indirect_branch_prediction_barrier();</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    }</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160; </div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordflow">if</span> (!already_loaded) {</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordtype">void</span> *gdt = get_current_gdt_ro();</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160; </div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment">         * Flush all EPTP/VPID contexts, the new pCPU may have stale</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment">         * TLB entries from its previous association with the vCPU.</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        kvm_make_request(KVM_REQ_TLB_FLUSH, vcpu);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160; </div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">         * Linux uses per-cpu TSS and GDT, so set these when switching</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">         * processors.  See 22.2.4.</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_TR_BASE,</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)&amp;get_cpu_entry_area(cpu)-&gt;tss.x86_tss);</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_GDTR_BASE, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)gdt);   <span class="comment">/* 22.2.4 */</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160; </div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_IA32_EMULATION) || IS_ENABLED(CONFIG_X86_32)) {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            <span class="comment">/* 22.2.3 */</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            <a class="code" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8">vmcs_writel</a>(HOST_IA32_SYSENTER_ESP,</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(cpu_entry_stack(cpu) + 1));</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        }</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        vmx-&gt;<a class="code" href="structvcpu__vmx.html#a69374d46755703c6bf50a48eb2c2807e">loaded_vmcs</a>-&gt;<a class="code" href="structloaded__vmcs.html#a41190e00a22fb0388ba36b9bb5cc3bdd">cpu</a> = cpu;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    }</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;}</div>
<div class="ttc" id="astructloaded__vmcs_html_ae1b5a89e2a622eb313efc632f663d4fd"><div class="ttname"><a href="structloaded__vmcs.html#ae1b5a89e2a622eb313efc632f663d4fd">loaded_vmcs::loaded_vmcss_on_cpu_link</a></div><div class="ttdeci">struct list_head loaded_vmcss_on_cpu_link</div><div class="ttdef"><b>Definition:</b> <a href="vmcs_8h_source.html#l00072">vmcs.h:73</a></div></div>
<div class="ttc" id="avmx__ops_8h_html_a33ef2cd0708406b39123ddd368eeb996"><div class="ttname"><a href="vmx__ops_8h.html#a33ef2cd0708406b39123ddd368eeb996">vmcs_load</a></div><div class="ttdeci">static void vmcs_load(struct vmcs *vmcs)</div><div class="ttdef"><b>Definition:</b> <a href="vmx__ops_8h_source.html#l00294">vmx_ops.h:294</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a7b282a828cac2d1ae55bb522a0c42c1f_cgraph.png" border="0" usemap="#avmx_8h_a7b282a828cac2d1ae55bb522a0c42c1f_cgraph" alt=""/></div>
<map name="avmx_8h_a7b282a828cac2d1ae55bb522a0c42c1f_cgraph" id="avmx_8h_a7b282a828cac2d1ae55bb522a0c42c1f_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,172,108"/>
<area shape="rect" href="vmx_8c.html#acffc6d01ff543c9abee613b5fe1b1bd4" title=" " alt="" coords="220,5,367,32"/>
<area shape="rect" href="vmx_8h.html#a6e0cb34c77519a9be4432b4dd4ec11b4" title=" " alt="" coords="258,56,329,83"/>
<area shape="rect" href="vmx__ops_8h.html#a33ef2cd0708406b39123ddd368eeb996" title=" " alt="" coords="247,107,339,133"/>
<area shape="rect" href="vmx__ops_8h.html#a053ad90862efca58007aa2827f072fe8" title=" " alt="" coords="243,157,344,184"/>
<area shape="rect" href="vmx_8c.html#a70760e20007fba075a5170ffbdc80fa6" title=" " alt="" coords="415,5,576,32"/>
<area shape="rect" href="vmx__ops_8h.html#adefc7dc8e1885fe973b3e8d58e23e0aa" title=" " alt="" coords="624,5,720,32"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ae52cbc37c9ad5d2d3ce269912ae976da" title=" " alt="" coords="445,56,545,83"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab35d8d7479c3c62d461012dcabc04b11" title=" " alt="" coords="415,107,576,133"/>
<area shape="rect" href="vmx__ops_8h.html#abd38efcacf0b873c6e9ca1f940f39008" title=" " alt="" coords="438,157,553,184"/>
<area shape="rect" href="vmx__onhyperv_8h.html#ab8d4fdb2c9a0ae33024dd8b9ecf14961" title=" " alt="" coords="435,208,556,235"/>
<area shape="rect" href="vmx__ops_8h.html#ac411fdca9086093e5690910de4382641" title=" " alt="" coords="442,259,549,285"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vmx_8h_a7b282a828cac2d1ae55bb522a0c42c1f_icgraph.png" border="0" usemap="#avmx_8h_a7b282a828cac2d1ae55bb522a0c42c1f_icgraph" alt=""/></div>
<map name="avmx_8h_a7b282a828cac2d1ae55bb522a0c42c1f_icgraph" id="avmx_8h_a7b282a828cac2d1ae55bb522a0c42c1f_icgraph">
<area shape="rect" title=" " alt="" coords="1196,259,1363,285"/>
<area shape="rect" href="vmx_2nested_8c.html#a6e7c1f08ddd44344917e3bdc534d97de" title=" " alt="" coords="925,107,1148,133"/>
<area shape="rect" href="vmx_2nested_8c.html#a5b55a1eda2dc47d6d1a238d483e6ce36" title=" " alt="" coords="965,259,1108,285"/>
<area shape="rect" href="vmx_8c.html#aa3c244b12b83c2a97122b94343131bb1" title=" " alt="" coords="975,309,1099,336"/>
<area shape="rect" href="vmx_2nested_8c.html#a3fe22c3468a281d231b3554bdc8ab9d2" title=" " alt="" coords="727,107,849,133"/>
<area shape="rect" href="vmx_2nested_8c.html#a012c9b2d00b8a098ebc34d5693eb2f2b" title=" " alt="" coords="725,157,851,184"/>
<area shape="rect" href="vmx_2nested_8c.html#a5a5df09c88b5fad9a716109f9917e9a5" title=" " alt="" coords="699,56,877,83"/>
<area shape="rect" href="vmx_2nested_8c.html#ac436bd43f9cd48511bdf54c6e36fd31d" title=" " alt="" coords="703,5,873,32"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,125,373,166"/>
<area shape="rect" href="vmx_8c.html#a7cacd86bbd7f4ae2b8c9e5e8568fa5e4" title=" " alt="" coords="9,132,136,159"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3473bc074c4b59fe28597bd275c7668" title=" " alt="" coords="479,5,606,32"/>
<area shape="rect" href="vmx_2nested_8c.html#a0d98c8746dea3af0e50611aa851e01d9" title=" " alt="" coords="481,56,605,83"/>
<area shape="rect" href="vmx_2nested_8c.html#ad9920ec1586ae352fbc272ed93cf7b38" title=" " alt="" coords="739,259,837,285"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="711,451,865,477"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="483,208,602,235"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,309,615,336"/>
<area shape="rect" href="vmx_2nested_8c.html#a2c53f6d5cd8133df2c8e67ab90b9aa5f" title=" " alt="" coords="201,259,374,285"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="232,309,343,336"/>
<area shape="rect" href="vmx_2nested_8c.html#acee8cb651216e97a9c12b807243ae59a" title=" " alt="" coords="203,360,372,387"/>
<area shape="rect" href="vmx_8c.html#ac1cd58b9f223df9d6b5fe9695c0cbe2b" title=" " alt="" coords="11,259,134,285"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,528,361,555"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,259,604,285"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,710,631,751"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,645,651,686"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,608,387,635"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,477,618,518"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,360,633,387"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,411,635,453"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,528,140,555"/>
<area shape="rect" href="vmx_2nested_8c.html#a6a1c45a52fde9844f4431a9db00dbf9f" title=" " alt="" coords="206,710,369,751"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="7,717,138,744"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
