<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/x86/kvm/svm/avic.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_c21774f8bc9f0de15163573e5f5fa2b5.html">x86</a></li><li class="navelem"><a class="el" href="dir_fde450fd4b58e2560c53a1e73bfa4d6d.html">kvm</a></li><li class="navelem"><a class="el" href="dir_59e270fee840b69a56de99d30906df9d.html">svm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">avic.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/kvm_types.h&gt;</code><br />
<code>#include &lt;linux/hashtable.h&gt;</code><br />
<code>#include &lt;linux/amd-iommu.h&gt;</code><br />
<code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &lt;asm/irq_remapping.h&gt;</code><br />
<code>#include &quot;<a class="el" href="trace_8h_source.html">trace.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="lapic_8h_source.html">lapic.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="x86_8h_source.html">x86.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="irq_8h_source.html">irq.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="svm_8h_source.html">svm.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for avic.c:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c__incl.png" border="0" usemap="#aarch_2x86_2kvm_2svm_2avic_8c" alt=""/></div>
<map name="aarch_2x86_2kvm_2svm_2avic_8c" id="aarch_2x86_2kvm_2svm_2avic_8c">
<area shape="rect" title=" " alt="" coords="1251,5,1437,32"/>
<area shape="rect" title=" " alt="" coords="1153,155,1295,181"/>
<area shape="rect" title=" " alt="" coords="1983,80,2118,107"/>
<area shape="rect" title=" " alt="" coords="2142,80,2293,107"/>
<area shape="rect" title=" " alt="" coords="691,453,826,480"/>
<area shape="rect" title=" " alt="" coords="2317,80,2477,107"/>
<area shape="rect" href="trace_8h.html" title=" " alt="" coords="1892,80,1959,107"/>
<area shape="rect" href="lapic_8h.html" title=" " alt="" coords="671,155,737,181"/>
<area shape="rect" href="x86_8h.html" title=" " alt="" coords="1085,304,1144,331"/>
<area shape="rect" href="irq_8h.html" title=" " alt="" coords="483,80,533,107"/>
<area shape="rect" href="svm_8h.html" title=" " alt="" coords="1389,80,1451,107"/>
<area shape="rect" title=" " alt="" coords="1928,155,2064,181"/>
<area shape="rect" title=" " alt="" coords="2089,155,2183,181"/>
<area shape="rect" title=" " alt="" coords="1809,155,1903,181"/>
<area shape="rect" title=" " alt="" coords="2207,155,2350,181"/>
<area shape="rect" title=" " alt="" coords="2375,155,2516,181"/>
<area shape="rect" title=" " alt="" coords="2541,155,2691,181"/>
<area shape="rect" title=" " alt="" coords="507,229,610,256"/>
<area shape="rect" href="hyperv_8h.html" title=" " alt="" coords="777,229,855,256"/>
<area shape="rect" href="smm_8h.html" title=" " alt="" coords="635,229,701,256"/>
<area shape="rect" title=" " alt="" coords="1106,379,1238,405"/>
<area shape="rect" title=" " alt="" coords="847,379,942,405"/>
<area shape="rect" title=" " alt="" coords="966,379,1082,405"/>
<area shape="rect" href="kvm__cache__regs_8h.html" title=" " alt="" coords="1262,379,1405,405"/>
<area shape="rect" href="kvm__emulate_8h.html" title=" " alt="" coords="1481,379,1605,405"/>
<area shape="rect" title=" " alt="" coords="1536,453,1667,480"/>
<area shape="rect" href="fpu_8h.html" title=" " alt="" coords="1457,453,1511,480"/>
<area shape="rect" title=" " alt="" coords="1429,528,1539,555"/>
<area shape="rect" title=" " alt="" coords="537,304,671,331"/>
<area shape="rect" title=" " alt="" coords="332,155,471,181"/>
<area shape="rect" title=" " alt="" coords="43,155,160,181"/>
<area shape="rect" title=" " alt="" coords="183,155,307,181"/>
<area shape="rect" title=" " alt="" coords="1515,155,1610,181"/>
<area shape="rect" title=" " alt="" coords="1634,155,1785,181"/>
<area shape="rect" href="cpuid_8h.html" title=" " alt="" coords="1421,155,1491,181"/>
<area shape="rect" href="reverse__cpuid_8h.html" title=" " alt="" coords="1767,229,1892,256"/>
<area shape="rect" title=" " alt="" coords="1653,229,1742,256"/>
<area shape="rect" title=" " alt="" coords="1916,229,2044,256"/>
<area shape="rect" title=" " alt="" coords="2068,229,2231,256"/>
<area shape="rect" href="governed__features_8h.html" title=" " alt="" coords="1473,229,1629,256"/>
<area shape="rect" title=" " alt="" coords="1766,304,1893,331"/>
<area shape="rect" title=" " alt="" coords="1917,304,2053,331"/>
<area shape="rect" title=" " alt="" coords="1599,304,1742,331"/>
</map>
</div>
</div>
<p><a href="avic_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structamd__svm__iommu__ir.html">amd_svm_iommu_ir</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1f8c165bf4196327bc3abff648276d92"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a1f8c165bf4196327bc3abff648276d92">pr_fmt</a>(fmt)&#160;&#160;&#160;KBUILD_MODNAME &quot;: &quot; fmt</td></tr>
<tr class="separator:a1f8c165bf4196327bc3abff648276d92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85aae38c76b154dc96183124f815e5e4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a85aae38c76b154dc96183124f815e5e4">AVIC_VCPU_ID_MASK</a>&#160;&#160;&#160;AVIC_PHYSICAL_MAX_INDEX_MASK</td></tr>
<tr class="separator:a85aae38c76b154dc96183124f815e5e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c20b22e6bbe72fbdd760aaff3dc45ef"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a9c20b22e6bbe72fbdd760aaff3dc45ef">AVIC_VM_ID_SHIFT</a>&#160;&#160;&#160;HWEIGHT32(AVIC_PHYSICAL_MAX_INDEX_MASK)</td></tr>
<tr class="separator:a9c20b22e6bbe72fbdd760aaff3dc45ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa582eb517550b4af588363963042a791"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#aa582eb517550b4af588363963042a791">AVIC_VM_ID_MASK</a>&#160;&#160;&#160;(GENMASK(31, <a class="el" href="avic_8c.html#a9c20b22e6bbe72fbdd760aaff3dc45ef">AVIC_VM_ID_SHIFT</a>) &gt;&gt; <a class="el" href="avic_8c.html#a9c20b22e6bbe72fbdd760aaff3dc45ef">AVIC_VM_ID_SHIFT</a>)</td></tr>
<tr class="separator:aa582eb517550b4af588363963042a791"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a504afac7afffff075f42d33af8c21ef0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a504afac7afffff075f42d33af8c21ef0">AVIC_GATAG_TO_VMID</a>(x)&#160;&#160;&#160;((x &gt;&gt; <a class="el" href="avic_8c.html#a9c20b22e6bbe72fbdd760aaff3dc45ef">AVIC_VM_ID_SHIFT</a>) &amp; <a class="el" href="avic_8c.html#aa582eb517550b4af588363963042a791">AVIC_VM_ID_MASK</a>)</td></tr>
<tr class="separator:a504afac7afffff075f42d33af8c21ef0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a379bb93a0924b7a44f0fa7cdd37517b1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a379bb93a0924b7a44f0fa7cdd37517b1">AVIC_GATAG_TO_VCPUID</a>(x)&#160;&#160;&#160;(x &amp; <a class="el" href="avic_8c.html#a85aae38c76b154dc96183124f815e5e4">AVIC_VCPU_ID_MASK</a>)</td></tr>
<tr class="separator:a379bb93a0924b7a44f0fa7cdd37517b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a591769978fd794e332f217d97f35bfec"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a591769978fd794e332f217d97f35bfec">__AVIC_GATAG</a>(vm_id,  vcpu_id)</td></tr>
<tr class="separator:a591769978fd794e332f217d97f35bfec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76254d6522116c2c98b13d9342ba145a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a76254d6522116c2c98b13d9342ba145a">AVIC_GATAG</a>(vm_id,  vcpu_id)</td></tr>
<tr class="separator:a76254d6522116c2c98b13d9342ba145a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43bf45802761215fb7aeb3a0f716a429"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a43bf45802761215fb7aeb3a0f716a429">SVM_VM_DATA_HASH_BITS</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:a43bf45802761215fb7aeb3a0f716a429"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6a50d2e2e091254aac3982a50360a8ba"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a6a50d2e2e091254aac3982a50360a8ba">module_param_unsafe</a> (<a class="el" href="avic_8c.html#a969a7c5f37696d459ce0a2065a8ca97f">force_avic</a>, bool, 0444)</td></tr>
<tr class="separator:a6a50d2e2e091254aac3982a50360a8ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0b824f0eb25d52b2753a0446792f7d9"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#aa0b824f0eb25d52b2753a0446792f7d9">DEFINE_HASHTABLE</a> (svm_vm_data_hash, <a class="el" href="avic_8c.html#a43bf45802761215fb7aeb3a0f716a429">SVM_VM_DATA_HASH_BITS</a>)</td></tr>
<tr class="separator:aa0b824f0eb25d52b2753a0446792f7d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48d73aa47db0cd13044af80a191469b6"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a48d73aa47db0cd13044af80a191469b6">DEFINE_SPINLOCK</a> (svm_vm_data_hash_lock)</td></tr>
<tr class="separator:a48d73aa47db0cd13044af80a191469b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2af29a6a396bb757ac21f02f6aacfdfa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a2af29a6a396bb757ac21f02f6aacfdfa">avic_activate_vmcb</a> (struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *svm)</td></tr>
<tr class="separator:a2af29a6a396bb757ac21f02f6aacfdfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac41a57fe4f855076b5c5718def5bd6d3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#ac41a57fe4f855076b5c5718def5bd6d3">avic_deactivate_vmcb</a> (struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *svm)</td></tr>
<tr class="separator:ac41a57fe4f855076b5c5718def5bd6d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af75098185942f8eb5703b2b65bf9257d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#af75098185942f8eb5703b2b65bf9257d">avic_ga_log_notifier</a> (u32 ga_tag)</td></tr>
<tr class="separator:af75098185942f8eb5703b2b65bf9257d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bb736e8688ecfaa3696b347764fd37d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a3bb736e8688ecfaa3696b347764fd37d">avic_vm_destroy</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a3bb736e8688ecfaa3696b347764fd37d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ddedac4b0b428928fae6bc9fe902e2a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a0ddedac4b0b428928fae6bc9fe902e2a">avic_vm_init</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a0ddedac4b0b428928fae6bc9fe902e2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40f16bbe281410ac02865ea25c26bf12"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a40f16bbe281410ac02865ea25c26bf12">avic_init_vmcb</a> (struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *svm, struct vmcb *vmcb)</td></tr>
<tr class="separator:a40f16bbe281410ac02865ea25c26bf12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cfb06497cbd5960a4a909c44e701f06"><td class="memItemLeft" align="right" valign="top">static u64 *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a8cfb06497cbd5960a4a909c44e701f06">avic_get_physical_id_entry</a> (struct kvm_vcpu *vcpu, unsigned int index)</td></tr>
<tr class="separator:a8cfb06497cbd5960a4a909c44e701f06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefc63eafb35c1efd94f6d53e7d0b20d5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5">avic_init_backing_page</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aefc63eafb35c1efd94f6d53e7d0b20d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8c9ded2546dccf6e4b561e633d22e7e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#ac8c9ded2546dccf6e4b561e633d22e7e">avic_ring_doorbell</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ac8c9ded2546dccf6e4b561e633d22e7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b9e298755a0d51bb5b2dfc9dd254c64"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64">avic_kick_vcpu</a> (struct kvm_vcpu *vcpu, u32 icrl)</td></tr>
<tr class="separator:a2b9e298755a0d51bb5b2dfc9dd254c64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b900d047f49b6cd00266aba3f4912bf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf">avic_kick_vcpu_by_physical_id</a> (struct kvm *kvm, u32 physical_id, u32 icrl)</td></tr>
<tr class="separator:a4b900d047f49b6cd00266aba3f4912bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1404df5f813565dd104640a6e5bfea67"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a1404df5f813565dd104640a6e5bfea67">avic_kick_vcpu_by_logical_id</a> (struct kvm *kvm, u32 *avic_logical_id_table, u32 logid_index, u32 icrl)</td></tr>
<tr class="separator:a1404df5f813565dd104640a6e5bfea67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cf9fdcdf4f5f6559c099faaab0c2d29"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a7cf9fdcdf4f5f6559c099faaab0c2d29">avic_kick_target_vcpus_fast</a> (struct kvm *kvm, struct <a class="el" href="structkvm__lapic.html">kvm_lapic</a> *source, u32 icrl, u32 icrh, u32 index)</td></tr>
<tr class="separator:a7cf9fdcdf4f5f6559c099faaab0c2d29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9345a779111a59de8fa4110106c3adf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#ad9345a779111a59de8fa4110106c3adf">avic_kick_target_vcpus</a> (struct kvm *kvm, struct <a class="el" href="structkvm__lapic.html">kvm_lapic</a> *source, u32 icrl, u32 icrh, u32 index)</td></tr>
<tr class="separator:ad9345a779111a59de8fa4110106c3adf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a11c0014568405b90307ef68285e4ff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a4a11c0014568405b90307ef68285e4ff">avic_incomplete_ipi_interception</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a4a11c0014568405b90307ef68285e4ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed65a2dabdad6a421b487e1e7b106277"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#aed65a2dabdad6a421b487e1e7b106277">avic_vcpu_get_apicv_inhibit_reasons</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aed65a2dabdad6a421b487e1e7b106277"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5eaaa2d4a926c006359343ff29a9cdf7"><td class="memItemLeft" align="right" valign="top">static u32 *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7">avic_get_logical_id_entry</a> (struct kvm_vcpu *vcpu, u32 ldr, bool flat)</td></tr>
<tr class="separator:a5eaaa2d4a926c006359343ff29a9cdf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2650b353757b538de17a1c843f7308d2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a2650b353757b538de17a1c843f7308d2">avic_ldr_write</a> (struct kvm_vcpu *vcpu, u8 g_physical_id, u32 ldr)</td></tr>
<tr class="separator:a2650b353757b538de17a1c843f7308d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ed13621ec3f14afbf47f129e43b496d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d">avic_invalidate_logical_id_entry</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a2ed13621ec3f14afbf47f129e43b496d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a9ffca6bae1adce86d4495b5caaae2e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e">avic_handle_ldr_update</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a6a9ffca6bae1adce86d4495b5caaae2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaff9720871b696bc298d89cbb27a6dc2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2">avic_handle_dfr_update</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aaff9720871b696bc298d89cbb27a6dc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf44c96047cb51680ff358ad52747b93"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#abf44c96047cb51680ff358ad52747b93">avic_unaccel_trap_write</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:abf44c96047cb51680ff358ad52747b93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c7db7e1cb25acd53eb51e777934c9e8"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a9c7db7e1cb25acd53eb51e777934c9e8">is_avic_unaccelerated_access_trap</a> (u32 offset)</td></tr>
<tr class="separator:a9c7db7e1cb25acd53eb51e777934c9e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a299de3990a5ce5ce873df7afe2b3338f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a299de3990a5ce5ce873df7afe2b3338f">avic_unaccelerated_access_interception</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a299de3990a5ce5ce873df7afe2b3338f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e0a22138080054f4ac064064402f74a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a">avic_init_vcpu</a> (struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *svm)</td></tr>
<tr class="separator:a8e0a22138080054f4ac064064402f74a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9f162404fdb37bba372d0c9cdc043ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee">avic_apicv_post_state_restore</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ae9f162404fdb37bba372d0c9cdc043ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a520da70652fa3f7af0d58c1ecb7d0db7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a520da70652fa3f7af0d58c1ecb7d0db7">avic_set_pi_irte_mode</a> (struct kvm_vcpu *vcpu, bool activate)</td></tr>
<tr class="separator:a520da70652fa3f7af0d58c1ecb7d0db7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0573329bfb8b7a1a2ba0a4e2ce438dfa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a0573329bfb8b7a1a2ba0a4e2ce438dfa">svm_ir_list_del</a> (struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *svm, struct amd_iommu_pi_data *pi)</td></tr>
<tr class="separator:a0573329bfb8b7a1a2ba0a4e2ce438dfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0262c9f1d0d537dafa962ca68a873378"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a0262c9f1d0d537dafa962ca68a873378">svm_ir_list_add</a> (struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *svm, struct amd_iommu_pi_data *pi)</td></tr>
<tr class="separator:a0262c9f1d0d537dafa962ca68a873378"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24f70312b475fe0e0858ee3cc7e3af71"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a24f70312b475fe0e0858ee3cc7e3af71">get_pi_vcpu_info</a> (struct kvm *kvm, struct kvm_kernel_irq_routing_entry *e, struct vcpu_data *vcpu_info, struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> **svm)</td></tr>
<tr class="separator:a24f70312b475fe0e0858ee3cc7e3af71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a8b145ddec7a3dc1367a4e4e0df397e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a3a8b145ddec7a3dc1367a4e4e0df397e">avic_pi_update_irte</a> (struct kvm *kvm, unsigned int host_irq, uint32_t guest_irq, bool set)</td></tr>
<tr class="separator:a3a8b145ddec7a3dc1367a4e4e0df397e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b088623e16cec4875e37d8ce15231b2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a7b088623e16cec4875e37d8ce15231b2">avic_update_iommu_vcpu_affinity</a> (struct kvm_vcpu *vcpu, int cpu, bool r)</td></tr>
<tr class="separator:a7b088623e16cec4875e37d8ce15231b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7decdbafc7d47b2241e68ce3c90a9779"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a7decdbafc7d47b2241e68ce3c90a9779">avic_vcpu_load</a> (struct kvm_vcpu *vcpu, int cpu)</td></tr>
<tr class="separator:a7decdbafc7d47b2241e68ce3c90a9779"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a461f968598a11484e76a07fb87221bf2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a461f968598a11484e76a07fb87221bf2">avic_vcpu_put</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a461f968598a11484e76a07fb87221bf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51356c24441683c197e1d4c2555da06d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d">avic_refresh_virtual_apic_mode</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a51356c24441683c197e1d4c2555da06d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affcdeac6765016e970e33d6ecff3eebb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb">avic_refresh_apicv_exec_ctrl</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:affcdeac6765016e970e33d6ecff3eebb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a056e12caaf24f044fce8545a863dbbce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a056e12caaf24f044fce8545a863dbbce">avic_vcpu_blocking</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a056e12caaf24f044fce8545a863dbbce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e341d7f17b2f611aca180217cfc6ad3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a7e341d7f17b2f611aca180217cfc6ad3">avic_vcpu_unblocking</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a7e341d7f17b2f611aca180217cfc6ad3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada833d2b35b3e565a6900b25d1cce7c7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#ada833d2b35b3e565a6900b25d1cce7c7">avic_hardware_setup</a> (void)</td></tr>
<tr class="separator:ada833d2b35b3e565a6900b25d1cce7c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a969a7c5f37696d459ce0a2065a8ca97f"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a969a7c5f37696d459ce0a2065a8ca97f">force_avic</a></td></tr>
<tr class="separator:a969a7c5f37696d459ce0a2065a8ca97f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebb4737cca7862427a4b94f3f086dee3"><td class="memItemLeft" align="right" valign="top">static u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#aebb4737cca7862427a4b94f3f086dee3">next_vm_id</a> = 0</td></tr>
<tr class="separator:aebb4737cca7862427a4b94f3f086dee3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e123c3defad20a133e56f43373b9c44"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#a1e123c3defad20a133e56f43373b9c44">next_vm_id_wrapped</a> = 0</td></tr>
<tr class="separator:a1e123c3defad20a133e56f43373b9c44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4c0ba70ab315cedbb11f259b1d7ae08"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="avic_8c.html#ad4c0ba70ab315cedbb11f259b1d7ae08">x2avic_enabled</a></td></tr>
<tr class="separator:ad4c0ba70ab315cedbb11f259b1d7ae08"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a591769978fd794e332f217d97f35bfec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a591769978fd794e332f217d97f35bfec">&#9670;&nbsp;</a></span>__AVIC_GATAG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __AVIC_GATAG</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">vm_id, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">vcpu_id&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">                     ((((vm_id) &amp; <a class="code" href="avic_8c.html#aa582eb517550b4af588363963042a791">AVIC_VM_ID_MASK</a>) &lt;&lt; <a class="code" href="avic_8c.html#a9c20b22e6bbe72fbdd760aaff3dc45ef">AVIC_VM_ID_SHIFT</a>) | \</div>
<div class="line">                     ((vcpu_id) &amp; <a class="code" href="avic_8c.html#a85aae38c76b154dc96183124f815e5e4">AVIC_VCPU_ID_MASK</a>))</div>
<div class="ttc" id="aavic_8c_html_a85aae38c76b154dc96183124f815e5e4"><div class="ttname"><a href="avic_8c.html#a85aae38c76b154dc96183124f815e5e4">AVIC_VCPU_ID_MASK</a></div><div class="ttdeci">#define AVIC_VCPU_ID_MASK</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00041">avic.c:41</a></div></div>
<div class="ttc" id="aavic_8c_html_a9c20b22e6bbe72fbdd760aaff3dc45ef"><div class="ttname"><a href="avic_8c.html#a9c20b22e6bbe72fbdd760aaff3dc45ef">AVIC_VM_ID_SHIFT</a></div><div class="ttdeci">#define AVIC_VM_ID_SHIFT</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00043">avic.c:43</a></div></div>
<div class="ttc" id="aavic_8c_html_aa582eb517550b4af588363963042a791"><div class="ttname"><a href="avic_8c.html#aa582eb517550b4af588363963042a791">AVIC_VM_ID_MASK</a></div><div class="ttdeci">#define AVIC_VM_ID_MASK</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00044">avic.c:44</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00049">49</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="a76254d6522116c2c98b13d9342ba145a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76254d6522116c2c98b13d9342ba145a">&#9670;&nbsp;</a></span>AVIC_GATAG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AVIC_GATAG</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">vm_id, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">vcpu_id&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">({                                  \</div>
<div class="line">    u32 ga_tag = <a class="code" href="avic_8c.html#a591769978fd794e332f217d97f35bfec">__AVIC_GATAG</a>(vm_id, vcpu_id);          \</div>
<div class="line">                                    \</div>
<div class="line">    WARN_ON_ONCE(<a class="code" href="avic_8c.html#a379bb93a0924b7a44f0fa7cdd37517b1">AVIC_GATAG_TO_VCPUID</a>(ga_tag) != (vcpu_id));    \</div>
<div class="line">    WARN_ON_ONCE(<a class="code" href="avic_8c.html#a504afac7afffff075f42d33af8c21ef0">AVIC_GATAG_TO_VMID</a>(ga_tag) != (vm_id));        \</div>
<div class="line">    ga_tag;                             \</div>
<div class="line">})</div>
<div class="ttc" id="aavic_8c_html_a379bb93a0924b7a44f0fa7cdd37517b1"><div class="ttname"><a href="avic_8c.html#a379bb93a0924b7a44f0fa7cdd37517b1">AVIC_GATAG_TO_VCPUID</a></div><div class="ttdeci">#define AVIC_GATAG_TO_VCPUID(x)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00047">avic.c:47</a></div></div>
<div class="ttc" id="aavic_8c_html_a504afac7afffff075f42d33af8c21ef0"><div class="ttname"><a href="avic_8c.html#a504afac7afffff075f42d33af8c21ef0">AVIC_GATAG_TO_VMID</a></div><div class="ttdeci">#define AVIC_GATAG_TO_VMID(x)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00046">avic.c:46</a></div></div>
<div class="ttc" id="aavic_8c_html_a591769978fd794e332f217d97f35bfec"><div class="ttname"><a href="avic_8c.html#a591769978fd794e332f217d97f35bfec">__AVIC_GATAG</a></div><div class="ttdeci">#define __AVIC_GATAG(vm_id, vcpu_id)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00049">avic.c:49</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00051">51</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="a379bb93a0924b7a44f0fa7cdd37517b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a379bb93a0924b7a44f0fa7cdd37517b1">&#9670;&nbsp;</a></span>AVIC_GATAG_TO_VCPUID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AVIC_GATAG_TO_VCPUID</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;(x &amp; <a class="el" href="avic_8c.html#a85aae38c76b154dc96183124f815e5e4">AVIC_VCPU_ID_MASK</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00047">47</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="a504afac7afffff075f42d33af8c21ef0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a504afac7afffff075f42d33af8c21ef0">&#9670;&nbsp;</a></span>AVIC_GATAG_TO_VMID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AVIC_GATAG_TO_VMID</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;((x &gt;&gt; <a class="el" href="avic_8c.html#a9c20b22e6bbe72fbdd760aaff3dc45ef">AVIC_VM_ID_SHIFT</a>) &amp; <a class="el" href="avic_8c.html#aa582eb517550b4af588363963042a791">AVIC_VM_ID_MASK</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00046">46</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="a85aae38c76b154dc96183124f815e5e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85aae38c76b154dc96183124f815e5e4">&#9670;&nbsp;</a></span>AVIC_VCPU_ID_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AVIC_VCPU_ID_MASK&#160;&#160;&#160;AVIC_PHYSICAL_MAX_INDEX_MASK</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00041">41</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="aa582eb517550b4af588363963042a791"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa582eb517550b4af588363963042a791">&#9670;&nbsp;</a></span>AVIC_VM_ID_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AVIC_VM_ID_MASK&#160;&#160;&#160;(GENMASK(31, <a class="el" href="avic_8c.html#a9c20b22e6bbe72fbdd760aaff3dc45ef">AVIC_VM_ID_SHIFT</a>) &gt;&gt; <a class="el" href="avic_8c.html#a9c20b22e6bbe72fbdd760aaff3dc45ef">AVIC_VM_ID_SHIFT</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00044">44</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="a9c20b22e6bbe72fbdd760aaff3dc45ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c20b22e6bbe72fbdd760aaff3dc45ef">&#9670;&nbsp;</a></span>AVIC_VM_ID_SHIFT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AVIC_VM_ID_SHIFT&#160;&#160;&#160;HWEIGHT32(AVIC_PHYSICAL_MAX_INDEX_MASK)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00043">43</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="a1f8c165bf4196327bc3abff648276d92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f8c165bf4196327bc3abff648276d92">&#9670;&nbsp;</a></span>pr_fmt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pr_fmt</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">fmt</td><td>)</td>
          <td>&#160;&#160;&#160;KBUILD_MODNAME &quot;: &quot; fmt</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00015">15</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="a43bf45802761215fb7aeb3a0f716a429"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43bf45802761215fb7aeb3a0f716a429">&#9670;&nbsp;</a></span>SVM_VM_DATA_HASH_BITS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SVM_VM_DATA_HASH_BITS&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00070">70</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a2af29a6a396bb757ac21f02f6aacfdfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2af29a6a396bb757ac21f02f6aacfdfa">&#9670;&nbsp;</a></span>avic_activate_vmcb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_activate_vmcb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *&#160;</td>
          <td class="paramname"><em>svm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00085">85</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;{</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">struct </span>vmcb *vmcb = svm-&gt;<a class="code" href="structvcpu__svm.html#af0c24755d59a0cfca7ce9ba64f682722">vmcb01</a>.<a class="code" href="structkvm__vmcb__info.html#a8076921f239564576af7af19be7f6f04">ptr</a>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    vmcb-&gt;control.int_ctl &amp;= ~(AVIC_ENABLE_MASK | X2APIC_MODE_MASK);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    vmcb-&gt;control.avic_physical_id &amp;= ~AVIC_PHYSICAL_MAX_INDEX_MASK;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    vmcb-&gt;control.int_ctl |= AVIC_ENABLE_MASK;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">     * Note: KVM supports hybrid-AVIC mode, where KVM emulates x2APIC MSR</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">     * accesses, while interrupt injection to a running vCPU can be</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">     * achieved using AVIC doorbell.  KVM disables the APIC access page</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">     * (deletes the memslot) if any vCPU has x2APIC enabled, thus enabling</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">     * AVIC in hybrid mode activates only the doorbell mechanism.</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="avic_8c.html#ad4c0ba70ab315cedbb11f259b1d7ae08">x2avic_enabled</a> &amp;&amp; <a class="code" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a>(svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>.arch.apic)) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        vmcb-&gt;control.int_ctl |= X2APIC_MODE_MASK;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        vmcb-&gt;control.avic_physical_id |= X2AVIC_MAX_PHYSICAL_ID;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="comment">/* Disabling MSR intercept for x2APIC registers */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <a class="code" href="svm_8c.html#a195738d23c6f6b6bf7269334d3a38721">svm_set_x2apic_msr_interception</a>(svm, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">         * Flush the TLB, the guest may have inserted a non-APIC</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">         * mapping into the TLB while AVIC was disabled.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        kvm_make_request(KVM_REQ_TLB_FLUSH_CURRENT, &amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment">/* For xAVIC and hybrid-xAVIC modes */</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        vmcb-&gt;control.avic_physical_id |= AVIC_MAX_PHYSICAL_ID;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="comment">/* Enabling MSR intercept for x2APIC registers */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <a class="code" href="svm_8c.html#a195738d23c6f6b6bf7269334d3a38721">svm_set_x2apic_msr_interception</a>(svm, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_ad4c0ba70ab315cedbb11f259b1d7ae08"><div class="ttname"><a href="avic_8c.html#ad4c0ba70ab315cedbb11f259b1d7ae08">x2avic_enabled</a></div><div class="ttdeci">bool x2avic_enabled</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00075">avic.c:75</a></div></div>
<div class="ttc" id="alapic_8h_html_a07d3e1e4090a62753325dfa11d232cea"><div class="ttname"><a href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a></div><div class="ttdeci">static int apic_x2apic_mode(struct kvm_lapic *apic)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00221">lapic.h:221</a></div></div>
<div class="ttc" id="astructkvm__vmcb__info_html_a8076921f239564576af7af19be7f6f04"><div class="ttname"><a href="structkvm__vmcb__info.html#a8076921f239564576af7af19be7f6f04">kvm_vmcb_info::ptr</a></div><div class="ttdeci">struct vmcb * ptr</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00110">svm.h:110</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_af0c24755d59a0cfca7ce9ba64f682722"><div class="ttname"><a href="structvcpu__svm.html#af0c24755d59a0cfca7ce9ba64f682722">vcpu_svm::vmcb01</a></div><div class="ttdeci">struct kvm_vmcb_info vmcb01</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00212">svm.h:213</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_af164d8d741d9ea90dae6a46974d29f9e"><div class="ttname"><a href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu_svm::vcpu</a></div><div class="ttdeci">struct kvm_vcpu vcpu</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00206">svm.h:210</a></div></div>
<div class="ttc" id="asvm_8c_html_a195738d23c6f6b6bf7269334d3a38721"><div class="ttname"><a href="svm_8c.html#a195738d23c6f6b6bf7269334d3a38721">svm_set_x2apic_msr_interception</a></div><div class="ttdeci">void svm_set_x2apic_msr_interception(struct vcpu_svm *svm, bool intercept)</div><div class="ttdef"><b>Definition:</b> <a href="svm_8c_source.html#l00892">svm.c:892</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a2af29a6a396bb757ac21f02f6aacfdfa_cgraph.png" border="0" usemap="#aavic_8c_a2af29a6a396bb757ac21f02f6aacfdfa_cgraph" alt=""/></div>
<map name="aavic_8c_a2af29a6a396bb757ac21f02f6aacfdfa_cgraph" id="aavic_8c_a2af29a6a396bb757ac21f02f6aacfdfa_cgraph">
<area shape="rect" title=" " alt="" coords="5,165,157,192"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="213,136,356,163"/>
<area shape="rect" href="svm_8c.html#a195738d23c6f6b6bf7269334d3a38721" title=" " alt="" coords="205,187,364,229"/>
<area shape="rect" href="svm_8c.html#ae7cebb5bd1d0e7eadb2b7df90cca0c74" title=" " alt="" coords="412,195,571,221"/>
<area shape="rect" href="svm_8c.html#a7baa0f9e5f7d38e8ed066a4b8a61c09a" title=" " alt="" coords="637,137,796,178"/>
<area shape="rect" href="svm_8c.html#a1ffde811cc7743857dbb3175beda4aa2" title=" " alt="" coords="619,224,815,251"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="894,5,1035,32"/>
<area shape="rect" href="svm__onhyperv_8h.html#aa8051536beeae65d3e4645edd68850ae" title=" " alt="" coords="863,57,1067,98"/>
<area shape="rect" href="svm_8c.html#a35438091c40e77c617ce2ec9d521cc1f" title=" " alt="" coords="891,123,1038,149"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="929,224,1000,251"/>
<area shape="rect" href="svm_8c.html#a48f427ed9696201e388996df7ceccb9e" title=" " alt="" coords="889,173,1040,200"/>
<area shape="rect" href="svm_8c.html#a6a3d076f98c7c25a44d90f49f0fca2c3" title=" " alt="" coords="1115,224,1288,251"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a2af29a6a396bb757ac21f02f6aacfdfa_icgraph.png" border="0" usemap="#aavic_8c_a2af29a6a396bb757ac21f02f6aacfdfa_icgraph" alt=""/></div>
<map name="aavic_8c_a2af29a6a396bb757ac21f02f6aacfdfa_icgraph" id="aavic_8c_a2af29a6a396bb757ac21f02f6aacfdfa_icgraph">
<area shape="rect" title=" " alt="" coords="572,35,724,61"/>
<area shape="rect" href="avic_8c.html#a40f16bbe281410ac02865ea25c26bf12" title=" " alt="" coords="389,5,509,32"/>
<area shape="rect" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d" title=" " alt="" coords="373,57,524,98"/>
<area shape="rect" href="svm_8c.html#aa3d3185c3eece1cf1e99fd5da3ca3181" title=" " alt="" coords="210,5,297,32"/>
<area shape="rect" href="svm_8c.html#a72a80d54451776cc2794da8564a424fa" title=" " alt="" coords="5,5,133,32"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="181,57,325,98"/>
</map>
</div>

</div>
</div>
<a id="ae9f162404fdb37bba372d0c9cdc043ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9f162404fdb37bba372d0c9cdc043ee">&#9670;&nbsp;</a></span>avic_apicv_post_state_restore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_apicv_post_state_restore </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00738">738</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;{</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <a class="code" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2">avic_handle_dfr_update</a>(vcpu);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <a class="code" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e">avic_handle_ldr_update</a>(vcpu);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a6a9ffca6bae1adce86d4495b5caaae2e"><div class="ttname"><a href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e">avic_handle_ldr_update</a></div><div class="ttdeci">static void avic_handle_ldr_update(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00610">avic.c:610</a></div></div>
<div class="ttc" id="aavic_8c_html_aaff9720871b696bc298d89cbb27a6dc2"><div class="ttname"><a href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2">avic_handle_dfr_update</a></div><div class="ttdeci">static void avic_handle_dfr_update(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00629">avic.c:629</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_ae9f162404fdb37bba372d0c9cdc043ee_cgraph.png" border="0" usemap="#aavic_8c_ae9f162404fdb37bba372d0c9cdc043ee_cgraph" alt=""/></div>
<map name="aavic_8c_ae9f162404fdb37bba372d0c9cdc043ee_cgraph" id="aavic_8c_ae9f162404fdb37bba372d0c9cdc043ee_cgraph">
<area shape="rect" title=" " alt="" coords="5,161,172,203"/>
<area shape="rect" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2" title=" " alt="" coords="220,114,397,141"/>
<area shape="rect" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e" title=" " alt="" coords="221,194,397,221"/>
<area shape="rect" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d" title=" " alt="" coords="445,77,616,119"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="702,26,773,53"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="665,245,810,271"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="666,106,809,133"/>
<area shape="rect" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7" title=" " alt="" coords="664,168,811,209"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="885,175,991,202"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="859,245,1017,271"/>
<area shape="rect" href="avic_8c.html#a2650b353757b538de17a1c843f7308d2" title=" " alt="" coords="474,245,587,271"/>
<area shape="rect" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096" title=" " alt="" coords="475,295,587,322"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_ae9f162404fdb37bba372d0c9cdc043ee_icgraph.png" border="0" usemap="#aavic_8c_ae9f162404fdb37bba372d0c9cdc043ee_icgraph" alt=""/></div>
<map name="aavic_8c_ae9f162404fdb37bba372d0c9cdc043ee_icgraph" id="aavic_8c_ae9f162404fdb37bba372d0c9cdc043ee_icgraph">
<area shape="rect" title=" " alt="" coords="396,5,563,47"/>
<area shape="rect" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d" title=" " alt="" coords="197,5,348,47"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="5,5,149,47"/>
</map>
</div>

</div>
</div>
<a id="ac41a57fe4f855076b5c5718def5bd6d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac41a57fe4f855076b5c5718def5bd6d3">&#9670;&nbsp;</a></span>avic_deactivate_vmcb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_deactivate_vmcb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *&#160;</td>
          <td class="paramname"><em>svm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00120">120</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;{</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keyword">struct </span>vmcb *vmcb = svm-&gt;<a class="code" href="structvcpu__svm.html#af0c24755d59a0cfca7ce9ba64f682722">vmcb01</a>.<a class="code" href="structkvm__vmcb__info.html#a8076921f239564576af7af19be7f6f04">ptr</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    vmcb-&gt;control.int_ctl &amp;= ~(AVIC_ENABLE_MASK | X2APIC_MODE_MASK);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    vmcb-&gt;control.avic_physical_id &amp;= ~AVIC_PHYSICAL_MAX_INDEX_MASK;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">     * If running nested and the guest uses its own MSR bitmap, there</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">     * is no need to update L0&#39;s msr bitmap</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>) &amp;&amp;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <a class="code" href="svm_8h.html#a5deff43556f8c807c64def073cd548e4">vmcb12_is_intercept</a>(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#aa2e4d643ef957cd597e82a29f0f0a2c8">nested</a>.<a class="code" href="structsvm__nested__state.html#a3b275e369200f402f9d5765babb77629">ctl</a>, INTERCEPT_MSR_PROT))</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">/* Enabling MSR intercept for x2APIC registers */</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="svm_8c.html#a195738d23c6f6b6bf7269334d3a38721">svm_set_x2apic_msr_interception</a>(svm, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_afbcfc413ceedb460734eb5fd7c5c4fbc"><div class="ttname"><a href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a></div><div class="ttdeci">static bool is_guest_mode(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00226">kvm_cache_regs.h:226</a></div></div>
<div class="ttc" id="astructsvm__nested__state_html_a3b275e369200f402f9d5765babb77629"><div class="ttname"><a href="structsvm__nested__state.html#a3b275e369200f402f9d5765babb77629">svm_nested_state::ctl</a></div><div class="ttdeci">struct vmcb_ctrl_area_cached ctl</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00170">svm.h:173</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_aa2e4d643ef957cd597e82a29f0f0a2c8"><div class="ttname"><a href="structvcpu__svm.html#aa2e4d643ef957cd597e82a29f0f0a2c8">vcpu_svm::nested</a></div><div class="ttdeci">struct svm_nested_state nested</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00236">svm.h:238</a></div></div>
<div class="ttc" id="asvm_8h_html_a5deff43556f8c807c64def073cd548e4"><div class="ttname"><a href="svm_8h.html#a5deff43556f8c807c64def073cd548e4">vmcb12_is_intercept</a></div><div class="ttdeci">static bool vmcb12_is_intercept(struct vmcb_ctrl_area_cached *control, u32 bit)</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00397">svm.h:397</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_ac41a57fe4f855076b5c5718def5bd6d3_cgraph.png" border="0" usemap="#aavic_8c_ac41a57fe4f855076b5c5718def5bd6d3_cgraph" alt=""/></div>
<map name="aavic_8c_ac41a57fe4f855076b5c5718def5bd6d3_cgraph" id="aavic_8c_ac41a57fe4f855076b5c5718def5bd6d3_cgraph">
<area shape="rect" title=" " alt="" coords="5,195,173,221"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="241,136,361,163"/>
<area shape="rect" href="svm_8c.html#a195738d23c6f6b6bf7269334d3a38721" title=" " alt="" coords="221,187,380,229"/>
<area shape="rect" href="svm_8h.html#a5deff43556f8c807c64def073cd548e4" title=" " alt="" coords="222,253,379,280"/>
<area shape="rect" href="svm_8c.html#ae7cebb5bd1d0e7eadb2b7df90cca0c74" title=" " alt="" coords="428,195,587,221"/>
<area shape="rect" href="svm_8c.html#a7baa0f9e5f7d38e8ed066a4b8a61c09a" title=" " alt="" coords="653,137,812,178"/>
<area shape="rect" href="svm_8c.html#a1ffde811cc7743857dbb3175beda4aa2" title=" " alt="" coords="635,224,831,251"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="910,5,1051,32"/>
<area shape="rect" href="svm__onhyperv_8h.html#aa8051536beeae65d3e4645edd68850ae" title=" " alt="" coords="879,57,1083,98"/>
<area shape="rect" href="svm_8c.html#a35438091c40e77c617ce2ec9d521cc1f" title=" " alt="" coords="907,123,1054,149"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="945,224,1016,251"/>
<area shape="rect" href="svm_8c.html#a48f427ed9696201e388996df7ceccb9e" title=" " alt="" coords="905,173,1056,200"/>
<area shape="rect" href="svm_8c.html#a6a3d076f98c7c25a44d90f49f0fca2c3" title=" " alt="" coords="1131,224,1304,251"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_ac41a57fe4f855076b5c5718def5bd6d3_icgraph.png" border="0" usemap="#aavic_8c_ac41a57fe4f855076b5c5718def5bd6d3_icgraph" alt=""/></div>
<map name="aavic_8c_ac41a57fe4f855076b5c5718def5bd6d3_icgraph" id="aavic_8c_ac41a57fe4f855076b5c5718def5bd6d3_icgraph">
<area shape="rect" title=" " alt="" coords="572,35,740,61"/>
<area shape="rect" href="avic_8c.html#a40f16bbe281410ac02865ea25c26bf12" title=" " alt="" coords="389,5,509,32"/>
<area shape="rect" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d" title=" " alt="" coords="373,57,524,98"/>
<area shape="rect" href="svm_8c.html#aa3d3185c3eece1cf1e99fd5da3ca3181" title=" " alt="" coords="210,5,297,32"/>
<area shape="rect" href="svm_8c.html#a72a80d54451776cc2794da8564a424fa" title=" " alt="" coords="5,5,133,32"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="181,57,325,98"/>
</map>
</div>

</div>
</div>
<a id="af75098185942f8eb5703b2b65bf9257d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af75098185942f8eb5703b2b65bf9257d">&#9670;&nbsp;</a></span>avic_ga_log_notifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int avic_ga_log_notifier </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>ga_tag</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00143">143</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__svm.html">kvm_svm</a> *<a class="code" href="structkvm__svm.html">kvm_svm</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = NULL;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    u32 vm_id = <a class="code" href="avic_8c.html#a504afac7afffff075f42d33af8c21ef0">AVIC_GATAG_TO_VMID</a>(ga_tag);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    u32 vcpu_id = <a class="code" href="avic_8c.html#a379bb93a0924b7a44f0fa7cdd37517b1">AVIC_GATAG_TO_VCPUID</a>(ga_tag);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    pr_debug(<span class="stringliteral">&quot;SVM: %s: vm_id=%#x, vcpu_id=%#x\n&quot;</span>, __func__, vm_id, vcpu_id);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    trace_kvm_avic_ga_log(vm_id, vcpu_id);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    spin_lock_irqsave(&amp;svm_vm_data_hash_lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    hash_for_each_possible(svm_vm_data_hash, <a class="code" href="structkvm__svm.html">kvm_svm</a>, hnode, vm_id) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a06c4479d5aefb8c19b8ead15d599b324">avic_vm_id</a> != vm_id)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        vcpu = kvm_get_vcpu_by_id(&amp;<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#ade6c6ec6e820a10719c5d61e161aa8b8">kvm</a>, vcpu_id);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    spin_unlock_irqrestore(&amp;svm_vm_data_hash_lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">/* Note:</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">     * At this point, the IOMMU should have already set the pending</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">     * bit in the vAPIC backing page. So, we just need to schedule</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">     * in the vcpu.</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">if</span> (vcpu)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5">kvm_vcpu_wake_up</a>(vcpu);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_ad9f0140eebcdef9a9ebae54431d2fba5"><div class="ttname"><a href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5">kvm_vcpu_wake_up</a></div><div class="ttdeci">bool kvm_vcpu_wake_up(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03915">kvm_main.c:3915</a></div></div>
<div class="ttc" id="astructkvm__svm_html"><div class="ttname"><a href="structkvm__svm.html">kvm_svm</a></div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00095">svm.h:95</a></div></div>
<div class="ttc" id="astructkvm__svm_html_a06c4479d5aefb8c19b8ead15d599b324"><div class="ttname"><a href="structkvm__svm.html#a06c4479d5aefb8c19b8ead15d599b324">kvm_svm::avic_vm_id</a></div><div class="ttdeci">u32 avic_vm_id</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00099">svm.h:99</a></div></div>
<div class="ttc" id="astructkvm__svm_html_ade6c6ec6e820a10719c5d61e161aa8b8"><div class="ttname"><a href="structkvm__svm.html#ade6c6ec6e820a10719c5d61e161aa8b8">kvm_svm::kvm</a></div><div class="ttdeci">struct kvm kvm</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00092">svm.h:96</a></div></div>
<div class="ttc" id="axen_8c_html_a773b39d480759f67926cb18ae2219281"><div class="ttname"><a href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a></div><div class="ttdeci">uint32_t flags</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00001">xen.c:1</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_af75098185942f8eb5703b2b65bf9257d_cgraph.png" border="0" usemap="#aavic_8c_af75098185942f8eb5703b2b65bf9257d_cgraph" alt=""/></div>
<map name="aavic_8c_af75098185942f8eb5703b2b65bf9257d_cgraph" id="aavic_8c_af75098185942f8eb5703b2b65bf9257d_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,157,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="205,5,359,32"/>
</map>
</div>

</div>
</div>
<a id="a5eaaa2d4a926c006359343ff29a9cdf7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5eaaa2d4a926c006359343ff29a9cdf7">&#9670;&nbsp;</a></span>avic_get_logical_id_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u32* avic_get_logical_id_entry </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>ldr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>flat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00549">549</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;{</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__svm.html">kvm_svm</a> *<a class="code" href="structkvm__svm.html">kvm_svm</a> = <a class="code" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd">to_kvm_svm</a>(vcpu-&gt;kvm);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    u32 *logical_apic_id_table;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    u32 cluster, index;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    ldr = GET_APIC_LOGICAL_ID(ldr);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">if</span> (flat) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        cluster = 0;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        cluster = (ldr &gt;&gt; 4);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">if</span> (cluster &gt;= 0xf)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        ldr &amp;= 0xf;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">if</span> (!ldr || !is_power_of_2(ldr))</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    index = __ffs(ldr);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">if</span> (WARN_ON_ONCE(index &gt; 7))</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    index += (cluster &lt;&lt; 2);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    logical_apic_id_table = (u32 *) page_address(<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a837dca12e3d1d7b768feb04c6a3c2e96">avic_logical_id_table_page</a>);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">return</span> &amp;logical_apic_id_table[index];</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;}</div>
<div class="ttc" id="astructkvm__svm_html_a837dca12e3d1d7b768feb04c6a3c2e96"><div class="ttname"><a href="structkvm__svm.html#a837dca12e3d1d7b768feb04c6a3c2e96">kvm_svm::avic_logical_id_table_page</a></div><div class="ttdeci">struct page * avic_logical_id_table_page</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00100">svm.h:100</a></div></div>
<div class="ttc" id="asvm_8h_html_ac27f6fe2ff4beeb5ad1b11681d0386fd"><div class="ttname"><a href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd">to_kvm_svm</a></div><div class="ttdeci">static __always_inline struct kvm_svm * to_kvm_svm(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00316">svm.h:316</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a5eaaa2d4a926c006359343ff29a9cdf7_cgraph.png" border="0" usemap="#aavic_8c_a5eaaa2d4a926c006359343ff29a9cdf7_cgraph" alt=""/></div>
<map name="aavic_8c_a5eaaa2d4a926c006359343ff29a9cdf7_cgraph" id="aavic_8c_a5eaaa2d4a926c006359343ff29a9cdf7_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,152,47"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="200,13,307,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a5eaaa2d4a926c006359343ff29a9cdf7_icgraph.png" border="0" usemap="#aavic_8c_a5eaaa2d4a926c006359343ff29a9cdf7_icgraph" alt=""/></div>
<map name="aavic_8c_a5eaaa2d4a926c006359343ff29a9cdf7_icgraph" id="aavic_8c_a5eaaa2d4a926c006359343ff29a9cdf7_icgraph">
<area shape="rect" title=" " alt="" coords="1075,41,1221,83"/>
<area shape="rect" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d" title=" " alt="" coords="856,12,1027,53"/>
<area shape="rect" href="avic_8c.html#a2650b353757b538de17a1c843f7308d2" title=" " alt="" coords="885,78,998,105"/>
<area shape="rect" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2" title=" " alt="" coords="631,19,808,46"/>
<area shape="rect" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e" title=" " alt="" coords="631,71,807,98"/>
<area shape="rect" href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee" title=" " alt="" coords="410,9,577,51"/>
<area shape="rect" href="avic_8c.html#abf44c96047cb51680ff358ad52747b93" title=" " alt="" coords="404,75,583,102"/>
<area shape="rect" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d" title=" " alt="" coords="201,5,352,47"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="5,5,149,47"/>
<area shape="rect" href="avic_8c.html#a299de3990a5ce5ce873df7afe2b3338f" title=" " alt="" coords="197,71,356,112"/>
</map>
</div>

</div>
</div>
<a id="a8cfb06497cbd5960a4a909c44e701f06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cfb06497cbd5960a4a909c44e701f06">&#9670;&nbsp;</a></span>avic_get_physical_id_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u64* avic_get_physical_id_entry </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00262">262</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;{</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    u64 *avic_physical_id_table;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__svm.html">kvm_svm</a> *<a class="code" href="structkvm__svm.html">kvm_svm</a> = <a class="code" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd">to_kvm_svm</a>(vcpu-&gt;kvm);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span> ((!<a class="code" href="avic_8c.html#ad4c0ba70ab315cedbb11f259b1d7ae08">x2avic_enabled</a> &amp;&amp; index &gt; AVIC_MAX_PHYSICAL_ID) ||</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        (index &gt; X2AVIC_MAX_PHYSICAL_ID))</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    avic_physical_id_table = page_address(<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#aa05522988cc0a3ce6ad59dcec1ed0c46">avic_physical_id_table_page</a>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">return</span> &amp;avic_physical_id_table[index];</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div>
<div class="ttc" id="astructkvm__svm_html_aa05522988cc0a3ce6ad59dcec1ed0c46"><div class="ttname"><a href="structkvm__svm.html#aa05522988cc0a3ce6ad59dcec1ed0c46">kvm_svm::avic_physical_id_table_page</a></div><div class="ttdeci">struct page * avic_physical_id_table_page</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00101">svm.h:101</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a8cfb06497cbd5960a4a909c44e701f06_cgraph.png" border="0" usemap="#aavic_8c_a8cfb06497cbd5960a4a909c44e701f06_cgraph" alt=""/></div>
<map name="aavic_8c_a8cfb06497cbd5960a4a909c44e701f06_cgraph" id="aavic_8c_a8cfb06497cbd5960a4a909c44e701f06_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,163,47"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="211,13,317,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a8cfb06497cbd5960a4a909c44e701f06_icgraph.png" border="0" usemap="#aavic_8c_a8cfb06497cbd5960a4a909c44e701f06_icgraph" alt=""/></div>
<map name="aavic_8c_a8cfb06497cbd5960a4a909c44e701f06_icgraph" id="aavic_8c_a8cfb06497cbd5960a4a909c44e701f06_icgraph">
<area shape="rect" title=" " alt="" coords="575,5,732,47"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="352,13,527,39"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="189,13,304,39"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="5,13,141,39"/>
</map>
</div>

</div>
</div>
<a id="aaff9720871b696bc298d89cbb27a6dc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaff9720871b696bc298d89cbb27a6dc2">&#9670;&nbsp;</a></span>avic_handle_dfr_update()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_handle_dfr_update </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00629">629</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;{</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    u32 dfr = <a class="code" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee">kvm_lapic_get_reg</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;arch.apic, APIC_DFR);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordflow">if</span> (svm-&gt;<a class="code" href="structvcpu__svm.html#ae08ffe38b03c1c44686c57c274553f59">dfr_reg</a> == dfr)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d">avic_invalidate_logical_id_entry</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    svm-&gt;<a class="code" href="structvcpu__svm.html#ae08ffe38b03c1c44686c57c274553f59">dfr_reg</a> = dfr;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a2ed13621ec3f14afbf47f129e43b496d"><div class="ttname"><a href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d">avic_invalidate_logical_id_entry</a></div><div class="ttdeci">static void avic_invalidate_logical_id_entry(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00595">avic.c:595</a></div></div>
<div class="ttc" id="alapic_8h_html_a8cd1df8b4c079c23a522d09c964da0ee"><div class="ttname"><a href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee">kvm_lapic_get_reg</a></div><div class="ttdeci">static u32 kvm_lapic_get_reg(struct kvm_lapic *apic, int reg_off)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00179">lapic.h:179</a></div></div>
<div class="ttc" id="astructvcpu__svm_html"><div class="ttname"><a href="structvcpu__svm.html">vcpu_svm</a></div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00209">svm.h:209</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_ae08ffe38b03c1c44686c57c274553f59"><div class="ttname"><a href="structvcpu__svm.html#ae08ffe38b03c1c44686c57c274553f59">vcpu_svm::dfr_reg</a></div><div class="ttdeci">u32 dfr_reg</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00268">svm.h:268</a></div></div>
<div class="ttc" id="asvm_8h_html_a83e420c88631faf9613ea3caa72c63b7"><div class="ttname"><a href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a></div><div class="ttdeci">static __always_inline struct vcpu_svm * to_svm(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00364">svm.h:364</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_aaff9720871b696bc298d89cbb27a6dc2_cgraph.png" border="0" usemap="#aavic_8c_aaff9720871b696bc298d89cbb27a6dc2_cgraph" alt=""/></div>
<map name="aavic_8c_aaff9720871b696bc298d89cbb27a6dc2_cgraph" id="aavic_8c_aaff9720871b696bc298d89cbb27a6dc2_cgraph">
<area shape="rect" title=" " alt="" coords="5,123,183,149"/>
<area shape="rect" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d" title=" " alt="" coords="231,57,401,98"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="493,123,564,149"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="243,173,389,200"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="457,5,600,32"/>
<area shape="rect" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7" title=" " alt="" coords="455,57,602,98"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="656,64,763,91"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="449,173,608,200"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_aaff9720871b696bc298d89cbb27a6dc2_icgraph.png" border="0" usemap="#aavic_8c_aaff9720871b696bc298d89cbb27a6dc2_icgraph" alt=""/></div>
<map name="aavic_8c_aaff9720871b696bc298d89cbb27a6dc2_icgraph" id="aavic_8c_aaff9720871b696bc298d89cbb27a6dc2_icgraph">
<area shape="rect" title=" " alt="" coords="631,46,808,73"/>
<area shape="rect" href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee" title=" " alt="" coords="410,8,577,49"/>
<area shape="rect" href="avic_8c.html#abf44c96047cb51680ff358ad52747b93" title=" " alt="" coords="404,75,583,102"/>
<area shape="rect" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d" title=" " alt="" coords="201,5,352,47"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="5,5,149,47"/>
<area shape="rect" href="avic_8c.html#a299de3990a5ce5ce873df7afe2b3338f" title=" " alt="" coords="197,71,356,112"/>
</map>
</div>

</div>
</div>
<a id="a6a9ffca6bae1adce86d4495b5caaae2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a9ffca6bae1adce86d4495b5caaae2e">&#9670;&nbsp;</a></span>avic_handle_ldr_update()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_handle_ldr_update </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00610">610</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;{</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    u32 ldr = <a class="code" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee">kvm_lapic_get_reg</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;arch.apic, APIC_LDR);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    u32 <span class="keywordtype">id</span> = <a class="code" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096">kvm_xapic_id</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;arch.apic);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="comment">/* AVIC does not support LDR update for x2APIC */</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;arch.apic))</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">if</span> (ldr == svm-&gt;<a class="code" href="structvcpu__svm.html#a250d72e13c39c0c6d85a5e6c188554ce">ldr_reg</a>)</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <a class="code" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d">avic_invalidate_logical_id_entry</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    svm-&gt;<a class="code" href="structvcpu__svm.html#a250d72e13c39c0c6d85a5e6c188554ce">ldr_reg</a> = ldr;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="avic_8c.html#a2650b353757b538de17a1c843f7308d2">avic_ldr_write</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>, <span class="keywordtype">id</span>, ldr);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a2650b353757b538de17a1c843f7308d2"><div class="ttname"><a href="avic_8c.html#a2650b353757b538de17a1c843f7308d2">avic_ldr_write</a></div><div class="ttdeci">static void avic_ldr_write(struct kvm_vcpu *vcpu, u8 g_physical_id, u32 ldr)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00578">avic.c:578</a></div></div>
<div class="ttc" id="alapic_8h_html_a4f07303d20a06eeb408d4985c5e15096"><div class="ttname"><a href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096">kvm_xapic_id</a></div><div class="ttdeci">static u8 kvm_xapic_id(struct kvm_lapic *apic)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00276">lapic.h:276</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_a250d72e13c39c0c6d85a5e6c188554ce"><div class="ttname"><a href="structvcpu__svm.html#a250d72e13c39c0c6d85a5e6c188554ce">vcpu_svm::ldr_reg</a></div><div class="ttdeci">u32 ldr_reg</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00267">svm.h:267</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a6a9ffca6bae1adce86d4495b5caaae2e_cgraph.png" border="0" usemap="#aavic_8c_a6a9ffca6bae1adce86d4495b5caaae2e_cgraph" alt=""/></div>
<map name="aavic_8c_a6a9ffca6bae1adce86d4495b5caaae2e_cgraph" id="aavic_8c_a6a9ffca6bae1adce86d4495b5caaae2e_cgraph">
<area shape="rect" title=" " alt="" coords="5,140,181,167"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="450,5,593,32"/>
<area shape="rect" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d" title=" " alt="" coords="229,103,400,145"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="486,59,557,85"/>
<area shape="rect" href="avic_8c.html#a2650b353757b538de17a1c843f7308d2" title=" " alt="" coords="258,169,371,196"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="449,195,594,221"/>
<area shape="rect" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096" title=" " alt="" coords="259,271,371,297"/>
<area shape="rect" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7" title=" " alt="" coords="448,117,595,158"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="669,124,775,151"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="643,195,801,221"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a6a9ffca6bae1adce86d4495b5caaae2e_icgraph.png" border="0" usemap="#aavic_8c_a6a9ffca6bae1adce86d4495b5caaae2e_icgraph" alt=""/></div>
<map name="aavic_8c_a6a9ffca6bae1adce86d4495b5caaae2e_icgraph" id="aavic_8c_a6a9ffca6bae1adce86d4495b5caaae2e_icgraph">
<area shape="rect" title=" " alt="" coords="631,46,807,73"/>
<area shape="rect" href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee" title=" " alt="" coords="410,8,577,49"/>
<area shape="rect" href="avic_8c.html#abf44c96047cb51680ff358ad52747b93" title=" " alt="" coords="404,75,583,102"/>
<area shape="rect" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d" title=" " alt="" coords="201,5,352,47"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="5,5,149,47"/>
<area shape="rect" href="avic_8c.html#a299de3990a5ce5ce873df7afe2b3338f" title=" " alt="" coords="197,71,356,112"/>
</map>
</div>

</div>
</div>
<a id="ada833d2b35b3e565a6900b25d1cce7c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada833d2b35b3e565a6900b25d1cce7c7">&#9670;&nbsp;</a></span>avic_hardware_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool avic_hardware_setup </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l01188">1188</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;{</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="svm_8c.html#a17a219d0651f1db709a3af0fc5527aa0">npt_enabled</a>)</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="comment">/* AVIC is a prerequisite for x2AVIC. */</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">if</span> (!boot_cpu_has(X86_FEATURE_AVIC) &amp;&amp; !<a class="code" href="avic_8c.html#a969a7c5f37696d459ce0a2065a8ca97f">force_avic</a>) {</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="keywordflow">if</span> (boot_cpu_has(X86_FEATURE_X2AVIC)) {</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            pr_warn(FW_BUG <span class="stringliteral">&quot;Cannot support x2AVIC due to AVIC is disabled&quot;</span>);</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            pr_warn(FW_BUG <span class="stringliteral">&quot;Try enable AVIC using force_avic option&quot;</span>);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        }</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">if</span> (boot_cpu_has(X86_FEATURE_AVIC)) {</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        pr_info(<span class="stringliteral">&quot;AVIC enabled\n&quot;</span>);</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="avic_8c.html#a969a7c5f37696d459ce0a2065a8ca97f">force_avic</a>) {</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment">         * Some older systems does not advertise AVIC support.</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment">         * See Revision Guide for specific AMD processor for more detail.</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        pr_warn(<span class="stringliteral">&quot;AVIC is not supported in CPUID but force enabled&quot;</span>);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        pr_warn(<span class="stringliteral">&quot;Your system might crash and burn&quot;</span>);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="comment">/* AVIC is a prerequisite for x2AVIC. */</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <a class="code" href="avic_8c.html#ad4c0ba70ab315cedbb11f259b1d7ae08">x2avic_enabled</a> = boot_cpu_has(X86_FEATURE_X2AVIC);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="avic_8c.html#ad4c0ba70ab315cedbb11f259b1d7ae08">x2avic_enabled</a>)</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        pr_info(<span class="stringliteral">&quot;x2AVIC enabled\n&quot;</span>);</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    amd_iommu_register_ga_log_notifier(&amp;<a class="code" href="avic_8c.html#af75098185942f8eb5703b2b65bf9257d">avic_ga_log_notifier</a>);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a969a7c5f37696d459ce0a2065a8ca97f"><div class="ttname"><a href="avic_8c.html#a969a7c5f37696d459ce0a2065a8ca97f">force_avic</a></div><div class="ttdeci">static bool force_avic</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00062">avic.c:60</a></div></div>
<div class="ttc" id="aavic_8c_html_af75098185942f8eb5703b2b65bf9257d"><div class="ttname"><a href="avic_8c.html#af75098185942f8eb5703b2b65bf9257d">avic_ga_log_notifier</a></div><div class="ttdeci">int avic_ga_log_notifier(u32 ga_tag)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00143">avic.c:143</a></div></div>
<div class="ttc" id="asvm_8c_html_a17a219d0651f1db709a3af0fc5527aa0"><div class="ttname"><a href="svm_8c.html#a17a219d0651f1db709a3af0fc5527aa0">npt_enabled</a></div><div class="ttdeci">bool npt_enabled</div><div class="ttdef"><b>Definition:</b> <a href="svm_8c_source.html#l00198">svm.c:198</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_ada833d2b35b3e565a6900b25d1cce7c7_icgraph.png" border="0" usemap="#aavic_8c_ada833d2b35b3e565a6900b25d1cce7c7_icgraph" alt=""/></div>
<map name="aavic_8c_ada833d2b35b3e565a6900b25d1cce7c7_icgraph" id="aavic_8c_ada833d2b35b3e565a6900b25d1cce7c7_icgraph">
<area shape="rect" title=" " alt="" coords="215,5,375,32"/>
<area shape="rect" href="svm_8c.html#aa4cdf4791105d54ebcadfeafdcdf01ac" title=" " alt="" coords="5,5,167,32"/>
</map>
</div>

</div>
</div>
<a id="a4a11c0014568405b90307ef68285e4ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a11c0014568405b90307ef68285e4ff">&#9670;&nbsp;</a></span>avic_incomplete_ipi_interception()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int avic_incomplete_ipi_interception </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00490">490</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;{</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    u32 icrh = svm-&gt;<a class="code" href="structvcpu__svm.html#af095ed7bcc31c036e28e533582723a60">vmcb</a>-&gt;control.exit_info_1 &gt;&gt; 32;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    u32 icrl = svm-&gt;<a class="code" href="structvcpu__svm.html#af095ed7bcc31c036e28e533582723a60">vmcb</a>-&gt;control.exit_info_1;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    u32 <span class="keywordtype">id</span> = svm-&gt;<a class="code" href="structvcpu__svm.html#af095ed7bcc31c036e28e533582723a60">vmcb</a>-&gt;control.exit_info_2 &gt;&gt; 32;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    u32 index = svm-&gt;<a class="code" href="structvcpu__svm.html#af095ed7bcc31c036e28e533582723a60">vmcb</a>-&gt;control.exit_info_2 &amp; 0x1FF;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__lapic.html">kvm_lapic</a> *apic = <a class="code" href="structkvm__lapic.html#a54741597d07b2792d2da72ea301ad648">vcpu</a>-&gt;arch.apic;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    trace_kvm_avic_incomplete_ipi(<a class="code" href="structkvm__lapic.html#a54741597d07b2792d2da72ea301ad648">vcpu</a>-&gt;vcpu_id, icrh, icrl, <span class="keywordtype">id</span>, index);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">switch</span> (<span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">case</span> AVIC_IPI_FAILURE_INVALID_TARGET:</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">case</span> AVIC_IPI_FAILURE_INVALID_INT_TYPE:</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">         * Emulate IPIs that are not handled by AVIC hardware, which</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">         * only virtualizes Fixed, Edge-Triggered INTRs, and falls over</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">         * if _any_ targets are invalid, e.g. if the logical mode mask</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">         * is a superset of running vCPUs.</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">         * The exit is a trap, e.g. ICR holds the correct value and RIP</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">         * has been advanced, KVM is responsible only for emulating the</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">         * IPI.  Sadly, hardware may sometimes leave the BUSY flag set,</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">         * in which case KVM needs to emulate the ICR write as well in</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">         * order to clear the BUSY flag.</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">if</span> (icrl &amp; APIC_ICR_BUSY)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            <a class="code" href="lapic_8c.html#a1b33bb5758d3dd75c7b87e537a5e729e">kvm_apic_write_nodecode</a>(<a class="code" href="structkvm__lapic.html#a54741597d07b2792d2da72ea301ad648">vcpu</a>, APIC_ICR);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <a class="code" href="lapic_8c.html#a4b7f12cb3ba68245df79bc30d938b728">kvm_apic_send_ipi</a>(apic, icrl, icrh);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">case</span> AVIC_IPI_FAILURE_TARGET_NOT_RUNNING:</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">         * At this point, we expect that the AVIC HW has already</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">         * set the appropriate IRR bits on the valid target</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">         * vcpus. So, we just need to kick the appropriate vcpu.</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <a class="code" href="avic_8c.html#ad9345a779111a59de8fa4110106c3adf">avic_kick_target_vcpus</a>(<a class="code" href="structkvm__lapic.html#a54741597d07b2792d2da72ea301ad648">vcpu</a>-&gt;kvm, apic, icrl, icrh, index);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">case</span> AVIC_IPI_FAILURE_INVALID_BACKING_PAGE:</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        WARN_ONCE(1, <span class="stringliteral">&quot;Invalid backing page\n&quot;</span>);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">case</span> AVIC_IPI_FAILURE_INVALID_IPI_VECTOR:</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="comment">/* Invalid IPI with vector &lt; 16 */</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        vcpu_unimpl(<a class="code" href="structkvm__lapic.html#a54741597d07b2792d2da72ea301ad648">vcpu</a>, <span class="stringliteral">&quot;Unknown avic incomplete IPI interception\n&quot;</span>);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_ad9345a779111a59de8fa4110106c3adf"><div class="ttname"><a href="avic_8c.html#ad9345a779111a59de8fa4110106c3adf">avic_kick_target_vcpus</a></div><div class="ttdeci">static void avic_kick_target_vcpus(struct kvm *kvm, struct kvm_lapic *source, u32 icrl, u32 icrh, u32 index)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00465">avic.c:465</a></div></div>
<div class="ttc" id="alapic_8c_html_a1b33bb5758d3dd75c7b87e537a5e729e"><div class="ttname"><a href="lapic_8c.html#a1b33bb5758d3dd75c7b87e537a5e729e">kvm_apic_write_nodecode</a></div><div class="ttdeci">void kvm_apic_write_nodecode(struct kvm_vcpu *vcpu, u32 offset)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8c_source.html#l02446">lapic.c:2446</a></div></div>
<div class="ttc" id="alapic_8c_html_a4b7f12cb3ba68245df79bc30d938b728"><div class="ttname"><a href="lapic_8c.html#a4b7f12cb3ba68245df79bc30d938b728">kvm_apic_send_ipi</a></div><div class="ttdeci">void kvm_apic_send_ipi(struct kvm_lapic *apic, u32 icr_low, u32 icr_high)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8c_source.html#l01504">lapic.c:1504</a></div></div>
<div class="ttc" id="astructkvm__lapic_html"><div class="ttname"><a href="structkvm__lapic.html">kvm_lapic</a></div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00059">lapic.h:59</a></div></div>
<div class="ttc" id="astructkvm__lapic_html_a54741597d07b2792d2da72ea301ad648"><div class="ttname"><a href="structkvm__lapic.html#a54741597d07b2792d2da72ea301ad648">kvm_lapic::vcpu</a></div><div class="ttdeci">struct kvm_vcpu * vcpu</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00064">lapic.h:64</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_af095ed7bcc31c036e28e533582723a60"><div class="ttname"><a href="structvcpu__svm.html#af095ed7bcc31c036e28e533582723a60">vcpu_svm::vmcb</a></div><div class="ttdeci">struct vmcb * vmcb</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00212">svm.h:212</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a4a11c0014568405b90307ef68285e4ff_cgraph.png" border="0" usemap="#aavic_8c_a4a11c0014568405b90307ef68285e4ff_cgraph" alt=""/></div>
<map name="aavic_8c_a4a11c0014568405b90307ef68285e4ff_cgraph" id="aavic_8c_a4a11c0014568405b90307ef68285e4ff_cgraph">
<area shape="rect" title=" " alt="" coords="5,419,157,460"/>
<area shape="rect" href="avic_8c.html#ad9345a779111a59de8fa4110106c3adf" title=" " alt="" coords="931,249,1106,276"/>
<area shape="rect" href="lapic_8c.html#a4b7f12cb3ba68245df79bc30d938b728" title=" " alt="" coords="692,452,839,478"/>
<area shape="rect" href="lapic_8c.html#a1b33bb5758d3dd75c7b87e537a5e729e" title=" " alt="" coords="205,452,400,478"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="267,502,338,529"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1741,401,1883,428"/>
<area shape="rect" href="avic_8c.html#a7cf9fdcdf4f5f6559c099faaab0c2d29" title=" " alt="" coords="1167,173,1373,200"/>
<area shape="rect" href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64" title=" " alt="" coords="1991,21,2112,48"/>
<area shape="rect" href="lapic_8c.html#adb63e5a650d4571316b450d153a3105d" title=" " alt="" coords="1186,350,1354,377"/>
<area shape="rect" href="avic_8c.html#a1404df5f813565dd104640a6e5bfea67" title=" " alt="" coords="1430,46,1643,73"/>
<area shape="rect" href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf" title=" " alt="" coords="1700,46,1924,73"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="1739,1294,1885,1321"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="1483,148,1590,174"/>
<area shape="rect" href="svm_8c.html#a1faf261e116f9d9481e1bd6796e32280" title=" " alt="" coords="2179,14,2360,55"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1972,1294,2131,1321"/>
<area shape="rect" href="lapic_8c.html#a870119cb74033f360164df90029af75a" title=" " alt="" coords="1427,553,1646,580"/>
<area shape="rect" href="lapic_8c.html#ae8c127c0d736bacbfa2cdc6b3fd5c2f6" title=" " alt="" coords="1421,300,1652,326"/>
<area shape="rect" href="lapic_8c.html#a8fb87d02d911e49b5793e391702afe7e" title=" " alt="" coords="1476,350,1597,377"/>
<area shape="rect" href="irq_8h.html#a50293a78b5c0b6715243dc7854bcb210" title=" " alt="" coords="924,684,1113,710"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="1179,604,1361,630"/>
<area shape="rect" href="lapic_8h.html#ae7e74fde3e4fb01f561634e789b5eab4" title=" " alt="" coords="1199,940,1341,966"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="1469,801,1605,828"/>
<area shape="rect" href="lapic_8h.html#a447b1b971acaf871dd62669b4aa3116f" title=" " alt="" coords="1185,889,1355,916"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="1193,823,1347,864"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="1173,654,1367,681"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="1191,706,1349,747"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="1189,553,1351,580"/>
<area shape="rect" href="lapic_8c.html#a378a0961283ea67791303e70114fb10d" title=" " alt="" coords="449,350,611,377"/>
<area shape="rect" href="lapic_8c.html#acebc0ffd4530dfd1beb1254d1e4d9491" title=" " alt="" coords="451,1269,609,1296"/>
<area shape="rect" href="lapic_8c.html#adf2487dc76dace6e577b637cc357998b" title=" " alt="" coords="448,452,612,478"/>
<area shape="rect" href="lapic_8c.html#aa06cb4ebbfa40dbfa494b3b4cd9f8833" title=" " alt="" coords="678,350,853,377"/>
<area shape="rect" href="lapic_8c.html#adaceffbfc91320b193a66d974fb12ce0" title=" " alt="" coords="939,1142,1099,1169"/>
<area shape="rect" href="lapic_8c.html#afefd171448cafa66f80ecb9b9659ebb1" title=" " alt="" coords="660,1142,871,1169"/>
<area shape="rect" href="lapic_8c.html#af5602fb092ac09abc6c2bf0ad789d726" title=" " alt="" coords="714,1193,817,1220"/>
<area shape="rect" href="lapic_8c.html#aeb32a868e76d57da9fab57fce43efdbe" title=" " alt="" coords="710,1396,821,1422"/>
<area shape="rect" href="lapic_8c.html#ab2ee275fa1bc17aa0bfde435723b8f48" title=" " alt="" coords="947,1446,1091,1473"/>
<area shape="rect" href="lapic_8c.html#a02bd03bf711be3200ea2316ced434ff1" title=" " alt="" coords="715,1548,816,1574"/>
<area shape="rect" href="lapic_8c.html#ac7a03b55710bfcc78be7af0609f6f93d" title=" " alt="" coords="700,1294,831,1321"/>
<area shape="rect" href="lapic_8c.html#a8aa5f66b440e07d680f42fdaa211eac2" title=" " alt="" coords="949,1244,1089,1270"/>
<area shape="rect" href="lapic_8c.html#aec07f4595f82e14e1075beb4730b6976" title=" " alt="" coords="710,1497,821,1524"/>
<area shape="rect" href="lapic_8c.html#a54214770509be207a1c1271e8b48acf4" title=" " alt="" coords="697,1598,834,1625"/>
<area shape="rect" href="lapic_8c.html#a2a5ccc92c8b75ad6118bdc1b84a43554" title=" " alt="" coords="697,1649,833,1676"/>
<area shape="rect" href="lapic_8c.html#ab24997de83c3fd44d1cd7520a615883e" title=" " alt="" coords="679,1345,852,1372"/>
<area shape="rect" href="lapic_8c.html#a36de6235abe5d5bd2fd57bf5739c1b5f" title=" " alt="" coords="673,1700,858,1726"/>
<area shape="rect" href="lapic_8c.html#a756b707dd502680db2eed7759defde40" title=" " alt="" coords="919,990,1119,1017"/>
<area shape="rect" href="lapic_8c.html#ab18679414f6ced1b8597fc3a9b445dea" title=" " alt="" coords="697,1801,834,1828"/>
<area shape="rect" href="lapic_8c.html#ade21404bee3e5dbbe596ff391e0a23db" title=" " alt="" coords="695,788,836,814"/>
<area shape="rect" href="lapic_8c.html#a5f5c49ce8a579b59663644f0f1a6cbe3" title=" " alt="" coords="701,838,829,865"/>
<area shape="rect" href="lapic_8c.html#a946cf21407471f7a6ba449b2435055c3" title=" " alt="" coords="940,1624,1097,1650"/>
<area shape="rect" href="lapic_8c.html#a694be782d2a5e9a6ece8dd51f3da91f4" title=" " alt="" coords="1443,1737,1630,1764"/>
</map>
</div>

</div>
</div>
<a id="aefc63eafb35c1efd94f6d53e7d0b20d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefc63eafb35c1efd94f6d53e7d0b20d5">&#9670;&nbsp;</a></span>avic_init_backing_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int avic_init_backing_page </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00277">277</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;{</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    u64 *entry, new_entry;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordtype">int</span> <span class="keywordtype">id</span> = vcpu-&gt;vcpu_id;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> ((!<a class="code" href="avic_8c.html#ad4c0ba70ab315cedbb11f259b1d7ae08">x2avic_enabled</a> &amp;&amp; <span class="keywordtype">id</span> &gt; AVIC_MAX_PHYSICAL_ID) ||</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        (<span class="keywordtype">id</span> &gt; X2AVIC_MAX_PHYSICAL_ID))</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;arch.apic-&gt;regs)</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a21212b8e1a82cdc8ac696137981d8d7a">kvm_apicv_activated</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;kvm)) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">         * Note, AVIC hardware walks the nested page table to check</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">         * permissions, but does not use the SPA address specified in</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">         * the leaf SPTE since it uses address in the AVIC_BACKING_PAGE</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">         * pointer field of the VMCB.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        ret = <a class="code" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec">kvm_alloc_apic_access_page</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;kvm);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    svm-&gt;<a class="code" href="structvcpu__svm.html#a2c8b33d5ae9b731a886634cd6c00165f">avic_backing_page</a> = virt_to_page(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;arch.apic-&gt;regs);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">/* Setting AVIC backing page address in the phy APIC ID table */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    entry = <a class="code" href="avic_8c.html#a8cfb06497cbd5960a4a909c44e701f06">avic_get_physical_id_entry</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> (!entry)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    new_entry = __sme_set((page_to_phys(svm-&gt;<a class="code" href="structvcpu__svm.html#a2c8b33d5ae9b731a886634cd6c00165f">avic_backing_page</a>) &amp;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                  AVIC_PHYSICAL_ID_ENTRY_BACKING_PAGE_MASK) |</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                  AVIC_PHYSICAL_ID_ENTRY_VALID_MASK);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    WRITE_ONCE(*entry, new_entry);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    svm-&gt;<a class="code" href="structvcpu__svm.html#abc377a3a5f1f42e18f8a9044321f3d5b">avic_physical_id_cache</a> = entry;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a8cfb06497cbd5960a4a909c44e701f06"><div class="ttname"><a href="avic_8c.html#a8cfb06497cbd5960a4a909c44e701f06">avic_get_physical_id_entry</a></div><div class="ttdeci">static u64 * avic_get_physical_id_entry(struct kvm_vcpu *vcpu, unsigned int index)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00262">avic.c:262</a></div></div>
<div class="ttc" id="alapic_8c_html_a8c6616d2cbae35632aa5debb15b552ec"><div class="ttname"><a href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec">kvm_alloc_apic_access_page</a></div><div class="ttdeci">int kvm_alloc_apic_access_page(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8c_source.html#l02598">lapic.c:2598</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_a2c8b33d5ae9b731a886634cd6c00165f"><div class="ttname"><a href="structvcpu__svm.html#a2c8b33d5ae9b731a886634cd6c00165f">vcpu_svm::avic_backing_page</a></div><div class="ttdeci">struct page * avic_backing_page</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00269">svm.h:269</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_abc377a3a5f1f42e18f8a9044321f3d5b"><div class="ttname"><a href="structvcpu__svm.html#abc377a3a5f1f42e18f8a9044321f3d5b">vcpu_svm::avic_physical_id_cache</a></div><div class="ttdeci">u64 * avic_physical_id_cache</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00270">svm.h:270</a></div></div>
<div class="ttc" id="ax86_8c_html_a21212b8e1a82cdc8ac696137981d8d7a"><div class="ttname"><a href="x86_8c.html#a21212b8e1a82cdc8ac696137981d8d7a">kvm_apicv_activated</a></div><div class="ttdeci">bool kvm_apicv_activated(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l09935">x86.c:9935</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_aefc63eafb35c1efd94f6d53e7d0b20d5_cgraph.png" border="0" usemap="#aavic_8c_aefc63eafb35c1efd94f6d53e7d0b20d5_cgraph" alt=""/></div>
<map name="aavic_8c_aefc63eafb35c1efd94f6d53e7d0b20d5_cgraph" id="aavic_8c_aefc63eafb35c1efd94f6d53e7d0b20d5_cgraph">
<area shape="rect" title=" " alt="" coords="5,664,180,691"/>
<area shape="rect" href="avic_8c.html#a8cfb06497cbd5960a4a909c44e701f06" title=" " alt="" coords="256,573,413,614"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="228,639,441,665"/>
<area shape="rect" href="x86_8c.html#a21212b8e1a82cdc8ac696137981d8d7a" title=" " alt="" coords="254,689,415,716"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="299,740,370,767"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="535,580,641,607"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="489,635,687,661"/>
<area shape="rect" href="kvm__main_8c.html#a5132836c5be1763ca353ca2489a7fe23" title=" " alt="" coords="537,715,639,741"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="741,573,943,600"/>
<area shape="rect" href="kvm__main_8c.html#ab790fe1e5bd86339acfc80a95efddf4c" title=" " alt="" coords="1021,595,1191,637"/>
<area shape="rect" href="kvm__main_8c.html#a8f5a06af032a1edb199b4ae393b2de8e" title=" " alt="" coords="997,661,1215,688"/>
<area shape="rect" href="guest__memfd_8c.html#abaf64b8cb9e32ccb368d1d9c49d0bb02" title=" " alt="" coords="1039,5,1173,32"/>
<area shape="rect" href="guest__memfd_8c.html#a905ecfa162a290dceb1c7d5678e2a70f" title=" " alt="" coords="1813,71,1963,97"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1035,544,1177,571"/>
<area shape="rect" href="guest__memfd_8c.html#a2eab57d9fb8529d3751b5c8179d881c9" title=" " alt="" coords="2073,71,2228,97"/>
<area shape="rect" href="kvm__main_8c.html#a52d56a5dc447602839375289b5bbffb2" title=" " alt="" coords="1544,645,1720,672"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="1263,199,1481,225"/>
<area shape="rect" href="kvm__main_8c.html#a8c9bd99a64bbedb0930e29ed4dcc7897" title=" " alt="" coords="1290,595,1454,621"/>
<area shape="rect" href="kvm__main_8c.html#ac4ce014a99262ed5672a102c6d2ffdbd" title=" " alt="" coords="1290,696,1454,723"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="1538,325,1726,352"/>
<area shape="rect" href="kvm__main_8c.html#afdb5cea8958921b2ea9bd3a29cf9d7a6" title=" " alt="" coords="1292,544,1452,571"/>
<area shape="rect" href="kvm__main_8c.html#a6dd13a049fee9663450eebbf2ac16faa" title=" " alt="" coords="1287,419,1457,461"/>
<area shape="rect" href="kvm__main_8c.html#a192569033b972982f6b53e13666ef82b" title=" " alt="" coords="1269,747,1475,773"/>
<area shape="rect" href="kvm__main_8c.html#aa89329e461345f4a586065895ca072c6" title=" " alt="" coords="2055,684,2247,711"/>
<area shape="rect" href="kvm__main_8c.html#a115855e32d0da82706ba0bf22d90d8f1" title=" " alt="" coords="1803,595,1973,621"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="1783,471,1993,497"/>
<area shape="rect" href="kvm__main_8c.html#ada893d7e7d49d1023d23653b23944572" title=" " alt="" coords="2070,532,2231,559"/>
<area shape="rect" href="kvm__main_8c.html#a1a0266e85b304bdbde46a83f921d9606" title=" " alt="" coords="2045,481,2256,508"/>
<area shape="rect" href="kvm__main_8c.html#a578857fc65c8fabf9b425ff0b55a5fd3" title=" " alt="" coords="2069,583,2232,609"/>
<area shape="rect" href="kvm__main_8c.html#aa3b1664c58e5dab933e8659d884d56f3" title=" " alt="" coords="2064,633,2237,660"/>
<area shape="rect" href="x86_8c.html#ae7e25dec8e0af366fb3db41dc9881970" title=" " alt="" coords="2041,431,2260,457"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1529,107,1735,149"/>
<area shape="rect" href="kvm__main_8c.html#aab592fb3a4d6204c86d8f99caa0986ba" title=" " alt="" coords="1789,220,1987,247"/>
<area shape="rect" href="kvm__main_8c.html#ae2d9291adcda0ba0f7a20350dabdd418" title=" " alt="" coords="1557,173,1707,200"/>
<area shape="rect" href="x86_8c.html#a5a34304a4f0ec19e4bce34e0513fc3a4" title=" " alt="" coords="1796,140,1980,167"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="1797,322,1979,363"/>
<area shape="rect" href="kvm__main_8c.html#a31dbd36d8363fc2e5979b3976ebc0dbb" title=" " alt="" coords="1793,387,1983,429"/>
<area shape="rect" href="kvm__main_8c.html#aa87d0b55e37a312b7291fa9b5c83634c" title=" " alt="" coords="1811,271,1965,297"/>
<area shape="rect" href="kvm__main_8c.html#a40ed7705420af10446677d1c99a0978e" title=" " alt="" coords="1543,427,1721,453"/>
<area shape="rect" href="x86_8c.html#a14568e065745512e03b3088070848289" title=" " alt="" coords="1529,478,1735,519"/>
<area shape="rect" href="dirty__ring_8c.html#a38d9bd671fa9181708075184e77eca3a" title=" " alt="" coords="1547,376,1717,403"/>
<area shape="rect" href="kvm__main_8c.html#a055190afb6bce32ba87e7fea907ec1ec" title=" " alt="" coords="797,769,887,796"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="735,715,949,741"/>
<area shape="rect" href="kvm__main_8c.html#a7c20e0f654f0b4472c3833f0a563e11e" title=" " alt="" coords="1042,769,1170,796"/>
<area shape="rect" href="kvm__main_8c.html#aa77d8fc2ee9fe5965c45f1d0989eb266" title=" " alt="" coords="1028,828,1184,855"/>
<area shape="rect" href="kvm__main_8c.html#a63ec3e18db03a212e6e84391b5025689" title=" " alt="" coords="1287,845,1457,872"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1556,797,1708,824"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1807,848,1969,875"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1585,848,1679,875"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="1008,715,1204,741"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_aefc63eafb35c1efd94f6d53e7d0b20d5_icgraph.png" border="0" usemap="#aavic_8c_aefc63eafb35c1efd94f6d53e7d0b20d5_icgraph" alt=""/></div>
<map name="aavic_8c_aefc63eafb35c1efd94f6d53e7d0b20d5_icgraph" id="aavic_8c_aefc63eafb35c1efd94f6d53e7d0b20d5_icgraph">
<area shape="rect" title=" " alt="" coords="352,5,527,32"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="189,5,304,32"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="5,5,141,32"/>
</map>
</div>

</div>
</div>
<a id="a8e0a22138080054f4ac064064402f74a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e0a22138080054f4ac064064402f74a">&#9670;&nbsp;</a></span>avic_init_vcpu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int avic_init_vcpu </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *&#160;</td>
          <td class="paramname"><em>svm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00719">719</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;{</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = &amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="x86_8c.html#a04af9ab3eee510b54cba17a6fa94ee04">enable_apicv</a> || !<a class="code" href="irq_8h.html#a96951e3a1bfa402d8bee67713e267b39">irqchip_in_kernel</a>(vcpu-&gt;kvm))</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    ret = <a class="code" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5">avic_init_backing_page</a>(vcpu);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    INIT_LIST_HEAD(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af217181f505db1b71c48743233032539">ir_list</a>);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    spin_lock_init(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    svm-&gt;<a class="code" href="structvcpu__svm.html#ae08ffe38b03c1c44686c57c274553f59">dfr_reg</a> = APIC_DFR_FLAT;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_aefc63eafb35c1efd94f6d53e7d0b20d5"><div class="ttname"><a href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5">avic_init_backing_page</a></div><div class="ttdeci">static int avic_init_backing_page(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00277">avic.c:277</a></div></div>
<div class="ttc" id="airq_8h_html_a96951e3a1bfa402d8bee67713e267b39"><div class="ttname"><a href="irq_8h.html#a96951e3a1bfa402d8bee67713e267b39">irqchip_in_kernel</a></div><div class="ttdeci">static int irqchip_in_kernel(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="irq_8h_source.html#l00090">irq.h:90</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_af217181f505db1b71c48743233032539"><div class="ttname"><a href="structvcpu__svm.html#af217181f505db1b71c48743233032539">vcpu_svm::ir_list</a></div><div class="ttdeci">struct list_head ir_list</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00270">svm.h:278</a></div></div>
<div class="ttc" id="astructvcpu__svm_html_af38f3c63a81a10aae69b308aa175d618"><div class="ttname"><a href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">vcpu_svm::ir_list_lock</a></div><div class="ttdeci">spinlock_t ir_list_lock</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00279">svm.h:279</a></div></div>
<div class="ttc" id="ax86_8c_html_a04af9ab3eee510b54cba17a6fa94ee04"><div class="ttname"><a href="x86_8c.html#a04af9ab3eee510b54cba17a6fa94ee04">enable_apicv</a></div><div class="ttdeci">bool __read_mostly enable_apicv</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l00235">x86.c:235</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a8e0a22138080054f4ac064064402f74a_cgraph.png" border="0" usemap="#aavic_8c_a8e0a22138080054f4ac064064402f74a_cgraph" alt=""/></div>
<map name="aavic_8c_a8e0a22138080054f4ac064064402f74a_cgraph" id="aavic_8c_a8e0a22138080054f4ac064064402f74a_cgraph">
<area shape="rect" title=" " alt="" coords="5,547,120,574"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="168,522,343,549"/>
<area shape="rect" href="irq_8h.html#a96951e3a1bfa402d8bee67713e267b39" title=" " alt="" coords="189,573,321,599"/>
<area shape="rect" href="avic_8c.html#a8cfb06497cbd5960a4a909c44e701f06" title=" " alt="" coords="419,431,576,472"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="391,497,604,523"/>
<area shape="rect" href="x86_8c.html#a21212b8e1a82cdc8ac696137981d8d7a" title=" " alt="" coords="417,547,578,574"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="462,598,533,625"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="697,438,804,465"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="652,493,849,519"/>
<area shape="rect" href="kvm__main_8c.html#a5132836c5be1763ca353ca2489a7fe23" title=" " alt="" coords="699,787,802,814"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="903,147,1106,174"/>
<area shape="rect" href="kvm__main_8c.html#ab790fe1e5bd86339acfc80a95efddf4c" title=" " alt="" coords="1183,5,1354,47"/>
<area shape="rect" href="kvm__main_8c.html#a8f5a06af032a1edb199b4ae393b2de8e" title=" " alt="" coords="1160,71,1377,98"/>
<area shape="rect" href="guest__memfd_8c.html#abaf64b8cb9e32ccb368d1d9c49d0bb02" title=" " alt="" coords="1201,122,1336,149"/>
<area shape="rect" href="guest__memfd_8c.html#a905ecfa162a290dceb1c7d5678e2a70f" title=" " alt="" coords="1975,198,2126,225"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1197,610,1340,637"/>
<area shape="rect" href="guest__memfd_8c.html#a2eab57d9fb8529d3751b5c8179d881c9" title=" " alt="" coords="2232,198,2387,225"/>
<area shape="rect" href="kvm__main_8c.html#a52d56a5dc447602839375289b5bbffb2" title=" " alt="" coords="1707,610,1883,637"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="1425,303,1644,330"/>
<area shape="rect" href="kvm__main_8c.html#a8c9bd99a64bbedb0930e29ed4dcc7897" title=" " alt="" coords="1453,610,1617,637"/>
<area shape="rect" href="kvm__main_8c.html#ac4ce014a99262ed5672a102c6d2ffdbd" title=" " alt="" coords="1453,661,1617,687"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="1701,863,1889,890"/>
<area shape="rect" href="kvm__main_8c.html#afdb5cea8958921b2ea9bd3a29cf9d7a6" title=" " alt="" coords="1455,711,1615,738"/>
<area shape="rect" href="kvm__main_8c.html#a6dd13a049fee9663450eebbf2ac16faa" title=" " alt="" coords="1449,493,1620,535"/>
<area shape="rect" href="kvm__main_8c.html#a192569033b972982f6b53e13666ef82b" title=" " alt="" coords="1431,762,1638,789"/>
<area shape="rect" href="kvm__main_8c.html#aa89329e461345f4a586065895ca072c6" title=" " alt="" coords="2213,610,2405,637"/>
<area shape="rect" href="kvm__main_8c.html#a115855e32d0da82706ba0bf22d90d8f1" title=" " alt="" coords="1965,711,2136,738"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="1945,661,2156,687"/>
<area shape="rect" href="kvm__main_8c.html#ada893d7e7d49d1023d23653b23944572" title=" " alt="" coords="2229,711,2390,738"/>
<area shape="rect" href="kvm__main_8c.html#a1a0266e85b304bdbde46a83f921d9606" title=" " alt="" coords="2204,661,2415,687"/>
<area shape="rect" href="kvm__main_8c.html#a578857fc65c8fabf9b425ff0b55a5fd3" title=" " alt="" coords="2228,762,2391,789"/>
<area shape="rect" href="kvm__main_8c.html#aa3b1664c58e5dab933e8659d884d56f3" title=" " alt="" coords="2223,813,2396,839"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1692,325,1897,367"/>
<area shape="rect" href="kvm__main_8c.html#aab592fb3a4d6204c86d8f99caa0986ba" title=" " alt="" coords="1952,274,2149,301"/>
<area shape="rect" href="kvm__main_8c.html#ae2d9291adcda0ba0f7a20350dabdd418" title=" " alt="" coords="1720,223,1869,250"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="1960,787,2141,828"/>
<area shape="rect" href="kvm__main_8c.html#a31dbd36d8363fc2e5979b3976ebc0dbb" title=" " alt="" coords="1955,852,2146,893"/>
<area shape="rect" href="kvm__main_8c.html#aa87d0b55e37a312b7291fa9b5c83634c" title=" " alt="" coords="1973,918,2128,945"/>
<area shape="rect" href="kvm__main_8c.html#a40ed7705420af10446677d1c99a0978e" title=" " alt="" coords="1705,442,1884,469"/>
<area shape="rect" href="x86_8c.html#a14568e065745512e03b3088070848289" title=" " alt="" coords="1692,493,1897,535"/>
<area shape="rect" href="dirty__ring_8c.html#a38d9bd671fa9181708075184e77eca3a" title=" " alt="" coords="1709,559,1880,586"/>
<area shape="rect" href="kvm__main_8c.html#a055190afb6bce32ba87e7fea907ec1ec" title=" " alt="" coords="959,787,1050,814"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="897,838,1112,865"/>
<area shape="rect" href="kvm__main_8c.html#a7c20e0f654f0b4472c3833f0a563e11e" title=" " alt="" coords="1205,762,1333,789"/>
<area shape="rect" href="kvm__main_8c.html#aa77d8fc2ee9fe5965c45f1d0989eb266" title=" " alt="" coords="1191,813,1347,839"/>
<area shape="rect" href="kvm__main_8c.html#a63ec3e18db03a212e6e84391b5025689" title=" " alt="" coords="1449,943,1620,970"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1719,969,1871,995"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1969,969,2132,995"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1747,1019,1842,1046"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="1171,863,1367,890"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a8e0a22138080054f4ac064064402f74a_icgraph.png" border="0" usemap="#aavic_8c_a8e0a22138080054f4ac064064402f74a_icgraph" alt=""/></div>
<map name="aavic_8c_a8e0a22138080054f4ac064064402f74a_icgraph" id="aavic_8c_a8e0a22138080054f4ac064064402f74a_icgraph">
<area shape="rect" title=" " alt="" coords="189,5,304,32"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="5,5,141,32"/>
</map>
</div>

</div>
</div>
<a id="a40f16bbe281410ac02865ea25c26bf12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40f16bbe281410ac02865ea25c26bf12">&#9670;&nbsp;</a></span>avic_init_vmcb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_init_vmcb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *&#160;</td>
          <td class="paramname"><em>svm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vmcb *&#160;</td>
          <td class="paramname"><em>vmcb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00244">244</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;{</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__svm.html">kvm_svm</a> *<a class="code" href="structkvm__svm.html">kvm_svm</a> = <a class="code" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd">to_kvm_svm</a>(svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>.kvm);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    phys_addr_t bpa = __sme_set(page_to_phys(svm-&gt;<a class="code" href="structvcpu__svm.html#a2c8b33d5ae9b731a886634cd6c00165f">avic_backing_page</a>));</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    phys_addr_t lpa = __sme_set(page_to_phys(<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a837dca12e3d1d7b768feb04c6a3c2e96">avic_logical_id_table_page</a>));</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    phys_addr_t ppa = __sme_set(page_to_phys(<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#aa05522988cc0a3ce6ad59dcec1ed0c46">avic_physical_id_table_page</a>));</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    vmcb-&gt;control.avic_backing_page = bpa &amp; AVIC_HPA_MASK;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    vmcb-&gt;control.avic_logical_id = lpa &amp; AVIC_HPA_MASK;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    vmcb-&gt;control.avic_physical_id = ppa &amp; AVIC_HPA_MASK;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    vmcb-&gt;control.avic_vapic_bar = APIC_DEFAULT_PHYS_BASE &amp; VMCB_AVIC_APIC_BAR_MASK;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a21212b8e1a82cdc8ac696137981d8d7a">kvm_apicv_activated</a>(svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>.kvm))</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="avic_8c.html#a2af29a6a396bb757ac21f02f6aacfdfa">avic_activate_vmcb</a>(svm);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <a class="code" href="avic_8c.html#ac41a57fe4f855076b5c5718def5bd6d3">avic_deactivate_vmcb</a>(svm);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a2af29a6a396bb757ac21f02f6aacfdfa"><div class="ttname"><a href="avic_8c.html#a2af29a6a396bb757ac21f02f6aacfdfa">avic_activate_vmcb</a></div><div class="ttdeci">static void avic_activate_vmcb(struct vcpu_svm *svm)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00085">avic.c:85</a></div></div>
<div class="ttc" id="aavic_8c_html_ac41a57fe4f855076b5c5718def5bd6d3"><div class="ttname"><a href="avic_8c.html#ac41a57fe4f855076b5c5718def5bd6d3">avic_deactivate_vmcb</a></div><div class="ttdeci">static void avic_deactivate_vmcb(struct vcpu_svm *svm)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00120">avic.c:120</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a40f16bbe281410ac02865ea25c26bf12_cgraph.png" border="0" usemap="#aavic_8c_a40f16bbe281410ac02865ea25c26bf12_cgraph" alt=""/></div>
<map name="aavic_8c_a40f16bbe281410ac02865ea25c26bf12_cgraph" id="aavic_8c_a40f16bbe281410ac02865ea25c26bf12_cgraph">
<area shape="rect" title=" " alt="" coords="5,275,125,301"/>
<area shape="rect" href="avic_8c.html#a2af29a6a396bb757ac21f02f6aacfdfa" title=" " alt="" coords="181,195,333,221"/>
<area shape="rect" href="avic_8c.html#ac41a57fe4f855076b5c5718def5bd6d3" title=" " alt="" coords="173,249,341,276"/>
<area shape="rect" href="x86_8c.html#a21212b8e1a82cdc8ac696137981d8d7a" title=" " alt="" coords="177,300,338,327"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="204,351,311,377"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="397,136,540,163"/>
<area shape="rect" href="svm_8c.html#a195738d23c6f6b6bf7269334d3a38721" title=" " alt="" coords="389,187,548,229"/>
<area shape="rect" href="svm_8c.html#ae7cebb5bd1d0e7eadb2b7df90cca0c74" title=" " alt="" coords="596,195,755,221"/>
<area shape="rect" href="svm_8c.html#a7baa0f9e5f7d38e8ed066a4b8a61c09a" title=" " alt="" coords="821,137,980,178"/>
<area shape="rect" href="svm_8c.html#a1ffde811cc7743857dbb3175beda4aa2" title=" " alt="" coords="803,224,999,251"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="1078,5,1219,32"/>
<area shape="rect" href="svm__onhyperv_8h.html#aa8051536beeae65d3e4645edd68850ae" title=" " alt="" coords="1047,57,1251,98"/>
<area shape="rect" href="svm_8c.html#a35438091c40e77c617ce2ec9d521cc1f" title=" " alt="" coords="1075,123,1222,149"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="1113,224,1184,251"/>
<area shape="rect" href="svm_8c.html#a48f427ed9696201e388996df7ceccb9e" title=" " alt="" coords="1073,173,1224,200"/>
<area shape="rect" href="svm_8c.html#a6a3d076f98c7c25a44d90f49f0fca2c3" title=" " alt="" coords="1299,224,1472,251"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="409,253,529,280"/>
<area shape="rect" href="svm_8h.html#a5deff43556f8c807c64def073cd548e4" title=" " alt="" coords="390,304,547,331"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a40f16bbe281410ac02865ea25c26bf12_icgraph.png" border="0" usemap="#aavic_8c_a40f16bbe281410ac02865ea25c26bf12_icgraph" alt=""/></div>
<map name="aavic_8c_a40f16bbe281410ac02865ea25c26bf12_icgraph" id="aavic_8c_a40f16bbe281410ac02865ea25c26bf12_icgraph">
<area shape="rect" title=" " alt="" coords="316,5,436,32"/>
<area shape="rect" href="svm_8c.html#aa3d3185c3eece1cf1e99fd5da3ca3181" title=" " alt="" coords="181,5,268,32"/>
<area shape="rect" href="svm_8c.html#a72a80d54451776cc2794da8564a424fa" title=" " alt="" coords="5,5,133,32"/>
</map>
</div>

</div>
</div>
<a id="a2ed13621ec3f14afbf47f129e43b496d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ed13621ec3f14afbf47f129e43b496d">&#9670;&nbsp;</a></span>avic_invalidate_logical_id_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_invalidate_logical_id_entry </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00595">595</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;{</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordtype">bool</span> flat = svm-&gt;<a class="code" href="structvcpu__svm.html#ae08ffe38b03c1c44686c57c274553f59">dfr_reg</a> == APIC_DFR_FLAT;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    u32 *entry;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">/* Note: x2AVIC does not use logical APIC ID table */</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;arch.apic))</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    entry = <a class="code" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7">avic_get_logical_id_entry</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>, svm-&gt;<a class="code" href="structvcpu__svm.html#a250d72e13c39c0c6d85a5e6c188554ce">ldr_reg</a>, flat);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span> (entry)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        clear_bit(AVIC_LOGICAL_ID_ENTRY_VALID_BIT, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)entry);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a5eaaa2d4a926c006359343ff29a9cdf7"><div class="ttname"><a href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7">avic_get_logical_id_entry</a></div><div class="ttdeci">static u32 * avic_get_logical_id_entry(struct kvm_vcpu *vcpu, u32 ldr, bool flat)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00549">avic.c:549</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a2ed13621ec3f14afbf47f129e43b496d_cgraph.png" border="0" usemap="#aavic_8c_a2ed13621ec3f14afbf47f129e43b496d_cgraph" alt=""/></div>
<map name="aavic_8c_a2ed13621ec3f14afbf47f129e43b496d_cgraph" id="aavic_8c_a2ed13621ec3f14afbf47f129e43b496d_cgraph">
<area shape="rect" title=" " alt="" coords="5,57,176,98"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="226,5,369,32"/>
<area shape="rect" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7" title=" " alt="" coords="224,57,371,98"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="262,123,333,149"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="419,64,525,91"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a2ed13621ec3f14afbf47f129e43b496d_icgraph.png" border="0" usemap="#aavic_8c_a2ed13621ec3f14afbf47f129e43b496d_icgraph" alt=""/></div>
<map name="aavic_8c_a2ed13621ec3f14afbf47f129e43b496d_icgraph" id="aavic_8c_a2ed13621ec3f14afbf47f129e43b496d_icgraph">
<area shape="rect" title=" " alt="" coords="856,39,1027,80"/>
<area shape="rect" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2" title=" " alt="" coords="631,21,808,47"/>
<area shape="rect" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e" title=" " alt="" coords="631,71,807,98"/>
<area shape="rect" href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee" title=" " alt="" coords="410,9,577,51"/>
<area shape="rect" href="avic_8c.html#abf44c96047cb51680ff358ad52747b93" title=" " alt="" coords="404,75,583,102"/>
<area shape="rect" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d" title=" " alt="" coords="201,5,352,47"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="5,5,149,47"/>
<area shape="rect" href="avic_8c.html#a299de3990a5ce5ce873df7afe2b3338f" title=" " alt="" coords="197,71,356,112"/>
</map>
</div>

</div>
</div>
<a id="ad9345a779111a59de8fa4110106c3adf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9345a779111a59de8fa4110106c3adf">&#9670;&nbsp;</a></span>avic_kick_target_vcpus()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_kick_target_vcpus </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__lapic.html">kvm_lapic</a> *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>icrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>icrh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00465">465</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;{</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    u32 dest = <a class="code" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a>(source) ? icrh : GET_XAPIC_DEST_FIELD(icrh);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="avic_8c.html#a7cf9fdcdf4f5f6559c099faaab0c2d29">avic_kick_target_vcpus_fast</a>(kvm, source, icrl, icrh, index))</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    trace_kvm_avic_kick_vcpu_slowpath(icrh, icrl, index);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">     * Wake any target vCPUs that are blocking, i.e. waiting for a wake</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">     * event.  There&#39;s no need to signal doorbells, as hardware has handled</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">     * vCPUs that were in guest at the time of the IPI, and vCPUs that have</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">     * since entered the guest will have processed pending IRQs at VMRUN.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    kvm_for_each_vcpu(i, vcpu, kvm) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lapic_8c.html#adb63e5a650d4571316b450d153a3105d">kvm_apic_match_dest</a>(vcpu, source, icrl &amp; <a class="code" href="lapic_8h.html#ad3b78bd2ddd9b9b15390755b6df98d3d">APIC_SHORT_MASK</a>,</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                    dest, icrl &amp; <a class="code" href="lapic_8h.html#a5e58cf75a31cd26e03db7f201861a8e4">APIC_DEST_MASK</a>))</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <a class="code" href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64">avic_kick_vcpu</a>(vcpu, icrl);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a2b9e298755a0d51bb5b2dfc9dd254c64"><div class="ttname"><a href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64">avic_kick_vcpu</a></div><div class="ttdeci">static void avic_kick_vcpu(struct kvm_vcpu *vcpu, u32 icrl)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00340">avic.c:340</a></div></div>
<div class="ttc" id="aavic_8c_html_a7cf9fdcdf4f5f6559c099faaab0c2d29"><div class="ttname"><a href="avic_8c.html#a7cf9fdcdf4f5f6559c099faaab0c2d29">avic_kick_target_vcpus_fast</a></div><div class="ttdeci">static int avic_kick_target_vcpus_fast(struct kvm *kvm, struct kvm_lapic *source, u32 icrl, u32 icrh, u32 index)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00397">avic.c:397</a></div></div>
<div class="ttc" id="alapic_8c_html_adb63e5a650d4571316b450d153a3105d"><div class="ttname"><a href="lapic_8c.html#adb63e5a650d4571316b450d153a3105d">kvm_apic_match_dest</a></div><div class="ttdeci">bool kvm_apic_match_dest(struct kvm_vcpu *vcpu, struct kvm_lapic *source, int shorthand, unsigned int dest, int dest_mode)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8c_source.html#l01067">lapic.c:1067</a></div></div>
<div class="ttc" id="alapic_8h_html_a5e58cf75a31cd26e03db7f201861a8e4"><div class="ttname"><a href="lapic_8h.html#a5e58cf75a31cd26e03db7f201861a8e4">APIC_DEST_MASK</a></div><div class="ttdeci">#define APIC_DEST_MASK</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00017">lapic.h:17</a></div></div>
<div class="ttc" id="alapic_8h_html_ad3b78bd2ddd9b9b15390755b6df98d3d"><div class="ttname"><a href="lapic_8h.html#ad3b78bd2ddd9b9b15390755b6df98d3d">APIC_SHORT_MASK</a></div><div class="ttdeci">#define APIC_SHORT_MASK</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00015">lapic.h:15</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_ad9345a779111a59de8fa4110106c3adf_cgraph.png" border="0" usemap="#aavic_8c_ad9345a779111a59de8fa4110106c3adf_cgraph" alt=""/></div>
<map name="aavic_8c_ad9345a779111a59de8fa4110106c3adf_cgraph" id="aavic_8c_ad9345a779111a59de8fa4110106c3adf_cgraph">
<area shape="rect" title=" " alt="" coords="5,259,180,285"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1041,411,1184,437"/>
<area shape="rect" href="avic_8c.html#a7cf9fdcdf4f5f6559c099faaab0c2d29" title=" " alt="" coords="228,208,435,235"/>
<area shape="rect" href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64" title=" " alt="" coords="1052,56,1173,83"/>
<area shape="rect" href="lapic_8c.html#adb63e5a650d4571316b450d153a3105d" title=" " alt="" coords="247,411,415,437"/>
<area shape="rect" href="avic_8c.html#a1404df5f813565dd104640a6e5bfea67" title=" " alt="" coords="491,132,705,159"/>
<area shape="rect" href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf" title=" " alt="" coords="761,81,985,108"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="801,233,946,260"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="545,183,651,209"/>
<area shape="rect" href="svm_8c.html#a1faf261e116f9d9481e1bd6796e32280" title=" " alt="" coords="1240,49,1421,90"/>
<area shape="rect" href="avic_8c.html#ac8c9ded2546dccf6e4b561e633d22e7e" title=" " alt="" coords="1469,5,1611,32"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1479,56,1601,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1686,107,1839,133"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1659,56,1867,83"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1033,233,1192,260"/>
<area shape="rect" href="lapic_8c.html#a870119cb74033f360164df90029af75a" title=" " alt="" coords="489,436,707,463"/>
<area shape="rect" href="lapic_8c.html#ae8c127c0d736bacbfa2cdc6b3fd5c2f6" title=" " alt="" coords="483,537,713,564"/>
<area shape="rect" href="lapic_8c.html#a8fb87d02d911e49b5793e391702afe7e" title=" " alt="" coords="537,385,659,412"/>
<area shape="rect" href="lapic_8c.html#a98bde25094c754b30e796357ba643ab0" title=" " alt="" coords="795,487,951,513"/>
<area shape="rect" href="lapic_8c.html#a8bdd67ff70db633e45cce412fb4c7718" title=" " alt="" coords="813,639,933,665"/>
<area shape="rect" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096" title=" " alt="" coords="817,588,929,615"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_ad9345a779111a59de8fa4110106c3adf_icgraph.png" border="0" usemap="#aavic_8c_ad9345a779111a59de8fa4110106c3adf_icgraph" alt=""/></div>
<map name="aavic_8c_ad9345a779111a59de8fa4110106c3adf_icgraph" id="aavic_8c_ad9345a779111a59de8fa4110106c3adf_icgraph">
<area shape="rect" title=" " alt="" coords="205,13,380,39"/>
<area shape="rect" href="avic_8c.html#a4a11c0014568405b90307ef68285e4ff" title=" " alt="" coords="5,5,157,47"/>
</map>
</div>

</div>
</div>
<a id="a7cf9fdcdf4f5f6559c099faaab0c2d29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cf9fdcdf4f5f6559c099faaab0c2d29">&#9670;&nbsp;</a></span>avic_kick_target_vcpus_fast()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int avic_kick_target_vcpus_fast </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__lapic.html">kvm_lapic</a> *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>icrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>icrh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00397">397</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;{</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordtype">int</span> dest_mode = icrl &amp; <a class="code" href="lapic_8h.html#a5e58cf75a31cd26e03db7f201861a8e4">APIC_DEST_MASK</a>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordtype">int</span> shorthand = icrl &amp; <a class="code" href="lapic_8h.html#ad3b78bd2ddd9b9b15390755b6df98d3d">APIC_SHORT_MASK</a>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__svm.html">kvm_svm</a> *<a class="code" href="structkvm__svm.html">kvm_svm</a> = <a class="code" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd">to_kvm_svm</a>(<a class="code" href="structkvm__svm.html#ade6c6ec6e820a10719c5d61e161aa8b8">kvm</a>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    u32 dest;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> (shorthand != <a class="code" href="lapic_8h.html#acc73bace457403e7d23ff22afac7df0f">APIC_DEST_NOSHORT</a>)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a>(source))</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        dest = icrh;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        dest = GET_XAPIC_DEST_FIELD(icrh);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> (dest_mode == APIC_DEST_PHYSICAL) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="comment">/* broadcast destination, use slow path */</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a>(source) &amp;&amp; dest == <a class="code" href="lapic_8h.html#a481da2cdd19d996fb0378476375133c6">X2APIC_BROADCAST</a>)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a>(source) &amp;&amp; dest == <a class="code" href="lapic_8h.html#a8e368c4d317e2f3289d8287fc28c4d19">APIC_BROADCAST</a>)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">if</span> (WARN_ON_ONCE(dest != index))</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <a class="code" href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf">avic_kick_vcpu_by_physical_id</a>(<a class="code" href="structkvm__svm.html#ade6c6ec6e820a10719c5d61e161aa8b8">kvm</a>, dest, icrl);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        u32 *avic_logical_id_table;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> bitmap, i;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        u32 cluster;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a>(source)) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="comment">/* 16 bit dest mask, 16 bit cluster id */</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            bitmap = dest &amp; 0xFFFF;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            cluster = (dest &gt;&gt; 16) &lt;&lt; 4;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee">kvm_lapic_get_reg</a>(source, APIC_DFR) == APIC_DFR_FLAT) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="comment">/* 8 bit dest mask*/</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            bitmap = dest;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            cluster = 0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="comment">/* 4 bit desk mask, 4 bit cluster id */</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            bitmap = dest &amp; 0xF;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            cluster = (dest &gt;&gt; 4) &lt;&lt; 2;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment">/* Nothing to do if there are no destinations in the cluster. */</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordflow">if</span> (unlikely(!bitmap))</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea">apic_x2apic_mode</a>(source))</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            avic_logical_id_table = NULL;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            avic_logical_id_table = page_address(<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a837dca12e3d1d7b768feb04c6a3c2e96">avic_logical_id_table_page</a>);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">         * AVIC is inhibited if vCPUs aren&#39;t mapped 1:1 with logical</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">         * IDs, thus each bit in the destination is guaranteed to map</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">         * to at most one vCPU.</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        for_each_set_bit(i, &amp;bitmap, 16)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <a class="code" href="avic_8c.html#a1404df5f813565dd104640a6e5bfea67">avic_kick_vcpu_by_logical_id</a>(<a class="code" href="structkvm__svm.html#ade6c6ec6e820a10719c5d61e161aa8b8">kvm</a>, avic_logical_id_table,</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                             cluster + i, icrl);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    return 0;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a1404df5f813565dd104640a6e5bfea67"><div class="ttname"><a href="avic_8c.html#a1404df5f813565dd104640a6e5bfea67">avic_kick_vcpu_by_logical_id</a></div><div class="ttdeci">static void avic_kick_vcpu_by_logical_id(struct kvm *kvm, u32 *avic_logical_id_table, u32 logid_index, u32 icrl)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00365">avic.c:365</a></div></div>
<div class="ttc" id="aavic_8c_html_a4b900d047f49b6cd00266aba3f4912bf"><div class="ttname"><a href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf">avic_kick_vcpu_by_physical_id</a></div><div class="ttdeci">static void avic_kick_vcpu_by_physical_id(struct kvm *kvm, u32 physical_id, u32 icrl)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00349">avic.c:349</a></div></div>
<div class="ttc" id="alapic_8h_html_a481da2cdd19d996fb0378476375133c6"><div class="ttname"><a href="lapic_8h.html#a481da2cdd19d996fb0378476375133c6">X2APIC_BROADCAST</a></div><div class="ttdeci">#define X2APIC_BROADCAST</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00023">lapic.h:23</a></div></div>
<div class="ttc" id="alapic_8h_html_a8e368c4d317e2f3289d8287fc28c4d19"><div class="ttname"><a href="lapic_8h.html#a8e368c4d317e2f3289d8287fc28c4d19">APIC_BROADCAST</a></div><div class="ttdeci">#define APIC_BROADCAST</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00022">lapic.h:22</a></div></div>
<div class="ttc" id="alapic_8h_html_acc73bace457403e7d23ff22afac7df0f"><div class="ttname"><a href="lapic_8h.html#acc73bace457403e7d23ff22afac7df0f">APIC_DEST_NOSHORT</a></div><div class="ttdeci">#define APIC_DEST_NOSHORT</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00016">lapic.h:16</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a7cf9fdcdf4f5f6559c099faaab0c2d29_cgraph.png" border="0" usemap="#aavic_8c_a7cf9fdcdf4f5f6559c099faaab0c2d29_cgraph" alt=""/></div>
<map name="aavic_8c_a7cf9fdcdf4f5f6559c099faaab0c2d29_cgraph" id="aavic_8c_a7cf9fdcdf4f5f6559c099faaab0c2d29_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,212,133"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="295,5,438,32"/>
<area shape="rect" href="avic_8c.html#a1404df5f813565dd104640a6e5bfea67" title=" " alt="" coords="260,56,473,83"/>
<area shape="rect" href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf" title=" " alt="" coords="521,81,745,108"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="294,157,439,184"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="313,208,420,235"/>
<area shape="rect" href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64" title=" " alt="" coords="793,81,915,108"/>
<area shape="rect" href="svm_8c.html#a1faf261e116f9d9481e1bd6796e32280" title=" " alt="" coords="963,74,1144,115"/>
<area shape="rect" href="avic_8c.html#ac8c9ded2546dccf6e4b561e633d22e7e" title=" " alt="" coords="1192,31,1333,57"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1201,81,1324,108"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1409,132,1562,159"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1381,81,1589,108"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="554,157,713,184"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a7cf9fdcdf4f5f6559c099faaab0c2d29_icgraph.png" border="0" usemap="#aavic_8c_a7cf9fdcdf4f5f6559c099faaab0c2d29_icgraph" alt=""/></div>
<map name="aavic_8c_a7cf9fdcdf4f5f6559c099faaab0c2d29_icgraph" id="aavic_8c_a7cf9fdcdf4f5f6559c099faaab0c2d29_icgraph">
<area shape="rect" title=" " alt="" coords="428,13,635,39"/>
<area shape="rect" href="avic_8c.html#ad9345a779111a59de8fa4110106c3adf" title=" " alt="" coords="205,13,380,39"/>
<area shape="rect" href="avic_8c.html#a4a11c0014568405b90307ef68285e4ff" title=" " alt="" coords="5,5,157,47"/>
</map>
</div>

</div>
</div>
<a id="a2b9e298755a0d51bb5b2dfc9dd254c64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b9e298755a0d51bb5b2dfc9dd254c64">&#9670;&nbsp;</a></span>avic_kick_vcpu()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_kick_vcpu </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>icrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00340">340</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;{</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    vcpu-&gt;arch.apic-&gt;irr_pending = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <a class="code" href="svm_8c.html#a1faf261e116f9d9481e1bd6796e32280">svm_complete_interrupt_delivery</a>(vcpu,</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    icrl &amp; APIC_MODE_MASK,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    icrl &amp; APIC_INT_LEVELTRIG,</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                    icrl &amp; APIC_VECTOR_MASK);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}</div>
<div class="ttc" id="asvm_8c_html_a1faf261e116f9d9481e1bd6796e32280"><div class="ttname"><a href="svm_8c.html#a1faf261e116f9d9481e1bd6796e32280">svm_complete_interrupt_delivery</a></div><div class="ttdeci">void svm_complete_interrupt_delivery(struct kvm_vcpu *vcpu, int delivery_mode, int trig_mode, int vector)</div><div class="ttdef"><b>Definition:</b> <a href="svm_8c_source.html#l03633">svm.c:3633</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a2b9e298755a0d51bb5b2dfc9dd254c64_cgraph.png" border="0" usemap="#aavic_8c_a2b9e298755a0d51bb5b2dfc9dd254c64_cgraph" alt=""/></div>
<map name="aavic_8c_a2b9e298755a0d51bb5b2dfc9dd254c64_cgraph" id="aavic_8c_a2b9e298755a0d51bb5b2dfc9dd254c64_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,127,83"/>
<area shape="rect" href="svm_8c.html#a1faf261e116f9d9481e1bd6796e32280" title=" " alt="" coords="175,49,356,90"/>
<area shape="rect" href="avic_8c.html#ac8c9ded2546dccf6e4b561e633d22e7e" title=" " alt="" coords="404,5,545,32"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="413,56,536,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="621,107,774,133"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="593,56,801,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a2b9e298755a0d51bb5b2dfc9dd254c64_icgraph.png" border="0" usemap="#aavic_8c_a2b9e298755a0d51bb5b2dfc9dd254c64_icgraph" alt=""/></div>
<map name="aavic_8c_a2b9e298755a0d51bb5b2dfc9dd254c64_icgraph" id="aavic_8c_a2b9e298755a0d51bb5b2dfc9dd254c64_icgraph">
<area shape="rect" title=" " alt="" coords="1216,13,1337,39"/>
<area shape="rect" href="avic_8c.html#ad9345a779111a59de8fa4110106c3adf" title=" " alt="" coords="205,13,380,39"/>
<area shape="rect" href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf" title=" " alt="" coords="944,38,1168,65"/>
<area shape="rect" href="avic_8c.html#a4a11c0014568405b90307ef68285e4ff" title=" " alt="" coords="5,5,157,47"/>
<area shape="rect" href="avic_8c.html#a7cf9fdcdf4f5f6559c099faaab0c2d29" title=" " alt="" coords="428,38,635,65"/>
<area shape="rect" href="avic_8c.html#a1404df5f813565dd104640a6e5bfea67" title=" " alt="" coords="683,89,896,115"/>
</map>
</div>

</div>
</div>
<a id="a1404df5f813565dd104640a6e5bfea67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1404df5f813565dd104640a6e5bfea67">&#9670;&nbsp;</a></span>avic_kick_vcpu_by_logical_id()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_kick_vcpu_by_logical_id </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32 *&#160;</td>
          <td class="paramname"><em>avic_logical_id_table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>logid_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>icrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00365">365</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;{</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    u32 physical_id;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">if</span> (avic_logical_id_table) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        u32 logid_entry = avic_logical_id_table[logid_index];</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="comment">/* Nothing to do if the logical destination is invalid. */</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordflow">if</span> (unlikely(!(logid_entry &amp; AVIC_LOGICAL_ID_ENTRY_VALID_MASK)))</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        physical_id = logid_entry &amp;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                  AVIC_LOGICAL_ID_ENTRY_GUEST_PHYSICAL_ID_MASK;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">         * For x2APIC, the logical APIC ID is a read-only value that is</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">         * derived from the x2APIC ID, thus the x2APIC ID can be found</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">         * by reversing the calculation (stored in logid_index).  Note,</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">         * bits 31:20 of the x2APIC ID aren&#39;t propagated to the logical</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">         * ID, but KVM limits the x2APIC ID limited to KVM_MAX_VCPU_IDS.</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        physical_id = logid_index;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <a class="code" href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf">avic_kick_vcpu_by_physical_id</a>(kvm, physical_id, icrl);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a1404df5f813565dd104640a6e5bfea67_cgraph.png" border="0" usemap="#aavic_8c_a1404df5f813565dd104640a6e5bfea67_cgraph" alt=""/></div>
<map name="aavic_8c_a1404df5f813565dd104640a6e5bfea67_cgraph" id="aavic_8c_a1404df5f813565dd104640a6e5bfea67_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,219,83"/>
<area shape="rect" href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf" title=" " alt="" coords="267,56,491,83"/>
<area shape="rect" href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64" title=" " alt="" coords="539,56,660,83"/>
<area shape="rect" href="svm_8c.html#a1faf261e116f9d9481e1bd6796e32280" title=" " alt="" coords="708,49,889,90"/>
<area shape="rect" href="avic_8c.html#ac8c9ded2546dccf6e4b561e633d22e7e" title=" " alt="" coords="937,5,1079,32"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="947,56,1069,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1154,107,1307,133"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1127,56,1335,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a1404df5f813565dd104640a6e5bfea67_icgraph.png" border="0" usemap="#aavic_8c_a1404df5f813565dd104640a6e5bfea67_icgraph" alt=""/></div>
<map name="aavic_8c_a1404df5f813565dd104640a6e5bfea67_icgraph" id="aavic_8c_a1404df5f813565dd104640a6e5bfea67_icgraph">
<area shape="rect" title=" " alt="" coords="683,13,896,39"/>
<area shape="rect" href="avic_8c.html#a7cf9fdcdf4f5f6559c099faaab0c2d29" title=" " alt="" coords="428,13,635,39"/>
<area shape="rect" href="avic_8c.html#ad9345a779111a59de8fa4110106c3adf" title=" " alt="" coords="205,13,380,39"/>
<area shape="rect" href="avic_8c.html#a4a11c0014568405b90307ef68285e4ff" title=" " alt="" coords="5,5,157,47"/>
</map>
</div>

</div>
</div>
<a id="a4b900d047f49b6cd00266aba3f4912bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b900d047f49b6cd00266aba3f4912bf">&#9670;&nbsp;</a></span>avic_kick_vcpu_by_physical_id()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_kick_vcpu_by_physical_id </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>physical_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>icrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00349">349</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;{</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">     * KVM inhibits AVIC if any vCPU ID diverges from the vCPUs APIC ID,</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">     * i.e. APIC ID == vCPU ID.</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *target_vcpu = kvm_get_vcpu_by_id(kvm, physical_id);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">/* Once again, nothing to do if the target vCPU doesn&#39;t exist. */</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (unlikely(!target_vcpu))</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <a class="code" href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64">avic_kick_vcpu</a>(target_vcpu, icrl);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a4b900d047f49b6cd00266aba3f4912bf_cgraph.png" border="0" usemap="#aavic_8c_a4b900d047f49b6cd00266aba3f4912bf_cgraph" alt=""/></div>
<map name="aavic_8c_a4b900d047f49b6cd00266aba3f4912bf_cgraph" id="aavic_8c_a4b900d047f49b6cd00266aba3f4912bf_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,229,83"/>
<area shape="rect" href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64" title=" " alt="" coords="277,56,399,83"/>
<area shape="rect" href="svm_8c.html#a1faf261e116f9d9481e1bd6796e32280" title=" " alt="" coords="447,49,628,90"/>
<area shape="rect" href="avic_8c.html#ac8c9ded2546dccf6e4b561e633d22e7e" title=" " alt="" coords="676,5,817,32"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="685,56,808,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="893,107,1046,133"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="865,56,1073,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a4b900d047f49b6cd00266aba3f4912bf_icgraph.png" border="0" usemap="#aavic_8c_a4b900d047f49b6cd00266aba3f4912bf_icgraph" alt=""/></div>
<map name="aavic_8c_a4b900d047f49b6cd00266aba3f4912bf_icgraph" id="aavic_8c_a4b900d047f49b6cd00266aba3f4912bf_icgraph">
<area shape="rect" title=" " alt="" coords="944,13,1168,39"/>
<area shape="rect" href="avic_8c.html#a7cf9fdcdf4f5f6559c099faaab0c2d29" title=" " alt="" coords="428,13,635,39"/>
<area shape="rect" href="avic_8c.html#a1404df5f813565dd104640a6e5bfea67" title=" " alt="" coords="683,38,896,65"/>
<area shape="rect" href="avic_8c.html#ad9345a779111a59de8fa4110106c3adf" title=" " alt="" coords="205,13,380,39"/>
<area shape="rect" href="avic_8c.html#a4a11c0014568405b90307ef68285e4ff" title=" " alt="" coords="5,5,157,47"/>
</map>
</div>

</div>
</div>
<a id="a2650b353757b538de17a1c843f7308d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2650b353757b538de17a1c843f7308d2">&#9670;&nbsp;</a></span>avic_ldr_write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void avic_ldr_write </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8&#160;</td>
          <td class="paramname"><em>g_physical_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>ldr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00578">578</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;{</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordtype">bool</span> flat;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    u32 *entry, new_entry;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    flat = <a class="code" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee">kvm_lapic_get_reg</a>(vcpu-&gt;arch.apic, APIC_DFR) == APIC_DFR_FLAT;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    entry = <a class="code" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7">avic_get_logical_id_entry</a>(vcpu, ldr, flat);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">if</span> (!entry)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    new_entry = READ_ONCE(*entry);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    new_entry &amp;= ~AVIC_LOGICAL_ID_ENTRY_GUEST_PHYSICAL_ID_MASK;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    new_entry |= (g_physical_id &amp; AVIC_LOGICAL_ID_ENTRY_GUEST_PHYSICAL_ID_MASK);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    new_entry |= AVIC_LOGICAL_ID_ENTRY_VALID_MASK;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    WRITE_ONCE(*entry, new_entry);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a2650b353757b538de17a1c843f7308d2_cgraph.png" border="0" usemap="#aavic_8c_a2650b353757b538de17a1c843f7308d2_cgraph" alt=""/></div>
<map name="aavic_8c_a2650b353757b538de17a1c843f7308d2_cgraph" id="aavic_8c_a2650b353757b538de17a1c843f7308d2_cgraph">
<area shape="rect" title=" " alt="" coords="5,42,119,69"/>
<area shape="rect" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7" title=" " alt="" coords="167,5,313,47"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="167,71,313,98"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="387,13,494,39"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="361,71,520,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a2650b353757b538de17a1c843f7308d2_icgraph.png" border="0" usemap="#aavic_8c_a2650b353757b538de17a1c843f7308d2_icgraph" alt=""/></div>
<map name="aavic_8c_a2650b353757b538de17a1c843f7308d2_icgraph" id="aavic_8c_a2650b353757b538de17a1c843f7308d2_icgraph">
<area shape="rect" title=" " alt="" coords="855,46,968,73"/>
<area shape="rect" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e" title=" " alt="" coords="631,46,807,73"/>
<area shape="rect" href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee" title=" " alt="" coords="410,8,577,49"/>
<area shape="rect" href="avic_8c.html#abf44c96047cb51680ff358ad52747b93" title=" " alt="" coords="404,75,583,102"/>
<area shape="rect" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d" title=" " alt="" coords="201,5,352,47"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="5,5,149,47"/>
<area shape="rect" href="avic_8c.html#a299de3990a5ce5ce873df7afe2b3338f" title=" " alt="" coords="197,71,356,112"/>
</map>
</div>

</div>
</div>
<a id="a3a8b145ddec7a3dc1367a4e4e0df397e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a8b145ddec7a3dc1367a4e4e0df397e">&#9670;&nbsp;</a></span>avic_pi_update_irte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int avic_pi_update_irte </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>host_irq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>guest_irq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>set</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Here, we setup with legacy mode in the following cases:</p><ol type="1">
<li>When cannot target interrupt to a specific vcpu.</li>
<li>Unsetting posted interrupt.</li>
<li>APIC virtualization is disabled for the vcpu.</li>
<li>IRQ has incompatible delivery mode (SMI, INIT, etc)</li>
</ol>
<p>Here, we successfully setting up vcpu affinity in IOMMU guest mode. Now, we need to store the posted interrupt information in a per-vcpu ir_list so that we can reference to them directly when we update vcpu scheduling information in IOMMU irte.</p>
<p>Here, pi is used to:</p><ul>
<li>Tell IOMMU to use legacy mode for this interrupt.</li>
<li>Retrieve ga_tag of prior interrupt remapping data.</li>
</ul>
<p>Check if the posted interrupt was previously setup with the guest_mode by checking if the ga_tag was cached. If so, we need to clean up the per-vcpu ir_list.</p>

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00894">894</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;{</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keyword">struct </span>kvm_kernel_irq_routing_entry *e;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keyword">struct </span>kvm_irq_routing_table *irq_rt;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordtype">int</span> idx, ret = 0;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8">kvm_arch_has_assigned_device</a>(kvm) ||</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        !irq_remapping_cap(IRQ_POSTING_CAP))</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    pr_debug(<span class="stringliteral">&quot;SVM: %s: host_irq=%#x, guest_irq=%#x, set=%#x\n&quot;</span>,</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;         __func__, host_irq, guest_irq, set);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    idx = srcu_read_lock(&amp;kvm-&gt;irq_srcu);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    irq_rt = srcu_dereference(kvm-&gt;irq_routing, &amp;kvm-&gt;irq_srcu);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160; </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">if</span> (guest_irq &gt;= irq_rt-&gt;nr_rt_entries ||</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        hlist_empty(&amp;irq_rt-&gt;map[guest_irq])) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        pr_warn_once(<span class="stringliteral">&quot;no route for guest_irq %u/%u (broken user space?)\n&quot;</span>,</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                 guest_irq, irq_rt-&gt;nr_rt_entries);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160; </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    hlist_for_each_entry(e, &amp;irq_rt-&gt;map[guest_irq], link) {</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keyword">struct </span>vcpu_data vcpu_info;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = NULL;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keywordflow">if</span> (e-&gt;type != KVM_IRQ_ROUTING_MSI)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">        /**</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">         * Here, we setup with legacy mode in the following cases:</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">         * 1. When cannot target interrupt to a specific vcpu.</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">         * 2. Unsetting posted interrupt.</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">         * 3. APIC virtualization is disabled for the vcpu.</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">         * 4. IRQ has incompatible delivery mode (SMI, INIT, etc)</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="avic_8c.html#a24f70312b475fe0e0858ee3cc7e3af71">get_pi_vcpu_info</a>(kvm, e, &amp;vcpu_info, &amp;svm) &amp;&amp; set &amp;&amp;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            <a class="code" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358">kvm_vcpu_apicv_active</a>(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>)) {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <span class="keyword">struct </span>amd_iommu_pi_data pi;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="comment">/* Try to enable guest_mode in IRTE */</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            pi.base = __sme_set(page_to_phys(svm-&gt;<a class="code" href="structvcpu__svm.html#a2c8b33d5ae9b731a886634cd6c00165f">avic_backing_page</a>) &amp;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                        AVIC_HPA_MASK);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            pi.ga_tag = <a class="code" href="avic_8c.html#a76254d6522116c2c98b13d9342ba145a">AVIC_GATAG</a>(<a class="code" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd">to_kvm_svm</a>(kvm)-&gt;avic_vm_id,</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                             svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>.vcpu_id);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            pi.is_guest_mode = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            pi.vcpu_data = &amp;vcpu_info;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            ret = irq_set_vcpu_affinity(host_irq, &amp;pi);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">            /**</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">             * Here, we successfully setting up vcpu affinity in</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">             * IOMMU guest mode. Now, we need to store the posted</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">             * interrupt information in a per-vcpu ir_list so that</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">             * we can reference to them directly when we update vcpu</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">             * scheduling information in IOMMU irte.</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            <span class="keywordflow">if</span> (!ret &amp;&amp; pi.is_guest_mode)</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                <a class="code" href="avic_8c.html#a0262c9f1d0d537dafa962ca68a873378">svm_ir_list_add</a>(svm, &amp;pi);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <span class="comment">/* Use legacy mode in IRTE */</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            <span class="keyword">struct </span>amd_iommu_pi_data pi;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">            /**</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">             * Here, pi is used to:</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">             * - Tell IOMMU to use legacy mode for this interrupt.</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">             * - Retrieve ga_tag of prior interrupt remapping data.</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            pi.prev_ga_tag = 0;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            pi.is_guest_mode = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            ret = irq_set_vcpu_affinity(host_irq, &amp;pi);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">            /**</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">             * Check if the posted interrupt was previously</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">             * setup with the guest_mode by checking if the ga_tag</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">             * was cached. If so, we need to clean up the per-vcpu</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">             * ir_list.</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            <span class="keywordflow">if</span> (!ret &amp;&amp; pi.prev_ga_tag) {</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                <span class="keywordtype">int</span> <span class="keywordtype">id</span> = <a class="code" href="avic_8c.html#a379bb93a0924b7a44f0fa7cdd37517b1">AVIC_GATAG_TO_VCPUID</a>(pi.prev_ga_tag);</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                <span class="keyword">struct </span>kvm_vcpu *vcpu;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                vcpu = kvm_get_vcpu_by_id(kvm, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                <span class="keywordflow">if</span> (vcpu)</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                    <a class="code" href="avic_8c.html#a0573329bfb8b7a1a2ba0a4e2ce438dfa">svm_ir_list_del</a>(<a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(vcpu), &amp;pi);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        }</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keywordflow">if</span> (!ret &amp;&amp; svm) {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            trace_kvm_pi_irte_update(host_irq, svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>.vcpu_id,</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                         e-&gt;gsi, vcpu_info.vector,</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                         vcpu_info.pi_desc_addr, set);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            pr_err(<span class="stringliteral">&quot;%s: failed to update PI IRTE\n&quot;</span>, __func__);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    ret = 0;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;out:</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    srcu_read_unlock(&amp;kvm-&gt;irq_srcu, idx);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a0262c9f1d0d537dafa962ca68a873378"><div class="ttname"><a href="avic_8c.html#a0262c9f1d0d537dafa962ca68a873378">svm_ir_list_add</a></div><div class="ttdeci">static int svm_ir_list_add(struct vcpu_svm *svm, struct amd_iommu_pi_data *pi)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00792">avic.c:792</a></div></div>
<div class="ttc" id="aavic_8c_html_a0573329bfb8b7a1a2ba0a4e2ce438dfa"><div class="ttname"><a href="avic_8c.html#a0573329bfb8b7a1a2ba0a4e2ce438dfa">svm_ir_list_del</a></div><div class="ttdeci">static void svm_ir_list_del(struct vcpu_svm *svm, struct amd_iommu_pi_data *pi)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00776">avic.c:776</a></div></div>
<div class="ttc" id="aavic_8c_html_a24f70312b475fe0e0858ee3cc7e3af71"><div class="ttname"><a href="avic_8c.html#a24f70312b475fe0e0858ee3cc7e3af71">get_pi_vcpu_info</a></div><div class="ttdeci">static int get_pi_vcpu_info(struct kvm *kvm, struct kvm_kernel_irq_routing_entry *e, struct vcpu_data *vcpu_info, struct vcpu_svm **svm)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00861">avic.c:861</a></div></div>
<div class="ttc" id="aavic_8c_html_a76254d6522116c2c98b13d9342ba145a"><div class="ttname"><a href="avic_8c.html#a76254d6522116c2c98b13d9342ba145a">AVIC_GATAG</a></div><div class="ttdeci">#define AVIC_GATAG(vm_id, vcpu_id)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00051">avic.c:51</a></div></div>
<div class="ttc" id="alapic_8h_html_a3af346d02eebff16886d49d3810b5358"><div class="ttname"><a href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358">kvm_vcpu_apicv_active</a></div><div class="ttdeci">static bool kvm_vcpu_apicv_active(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00226">lapic.h:226</a></div></div>
<div class="ttc" id="ax86_8c_html_ae63567e9b665b34f8c84fc4dc594f3c8"><div class="ttname"><a href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8">kvm_arch_has_assigned_device</a></div><div class="ttdeci">bool noinstr kvm_arch_has_assigned_device(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l13419">x86.c:13419</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a3a8b145ddec7a3dc1367a4e4e0df397e_cgraph.png" border="0" usemap="#aavic_8c_a3a8b145ddec7a3dc1367a4e4e0df397e_cgraph" alt=""/></div>
<map name="aavic_8c_a3a8b145ddec7a3dc1367a4e4e0df397e_cgraph" id="aavic_8c_a3a8b145ddec7a3dc1367a4e4e0df397e_cgraph">
<area shape="rect" title=" " alt="" coords="5,539,155,565"/>
<area shape="rect" href="avic_8c.html#a24f70312b475fe0e0858ee3cc7e3af71" title=" " alt="" coords="227,437,359,464"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="488,501,559,528"/>
<area shape="rect" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8" title=" " alt="" coords="203,641,384,682"/>
<area shape="rect" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358" title=" " alt="" coords="663,349,841,376"/>
<area shape="rect" href="avic_8c.html#a0262c9f1d0d537dafa962ca68a873378" title=" " alt="" coords="231,539,355,565"/>
<area shape="rect" href="avic_8c.html#a0573329bfb8b7a1a2ba0a4e2ce438dfa" title=" " alt="" coords="463,564,583,591"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="240,707,347,733"/>
<area shape="rect" href="irq__comm_8c.html#a6de5d9a13302fceb034b8d75b4c787e2" title=" " alt="" coords="432,400,615,427"/>
<area shape="rect" href="irq__comm_8c.html#a6270cddb139f2ca4f42d21f8caaa1224" title=" " alt="" coords="457,451,590,477"/>
<area shape="rect" href="lapic_8c.html#adb63e5a650d4571316b450d153a3105d" title=" " alt="" coords="668,236,836,263"/>
<area shape="rect" href="lapic_8h.html#ae7e74fde3e4fb01f561634e789b5eab4" title=" " alt="" coords="681,400,823,427"/>
<area shape="rect" href="lapic_8c.html#a8620b1c89f8cf017f7827024fc95ac92" title=" " alt="" coords="680,451,824,493"/>
<area shape="rect" href="lapic_8c.html#a870119cb74033f360164df90029af75a" title=" " alt="" coords="895,81,1114,108"/>
<area shape="rect" href="lapic_8c.html#ae8c127c0d736bacbfa2cdc6b3fd5c2f6" title=" " alt="" coords="889,208,1120,235"/>
<area shape="rect" href="lapic_8c.html#a8fb87d02d911e49b5793e391702afe7e" title=" " alt="" coords="944,287,1065,313"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1459,157,1601,184"/>
<area shape="rect" href="lapic_8c.html#a98bde25094c754b30e796357ba643ab0" title=" " alt="" coords="1207,107,1363,133"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="1213,5,1358,32"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1451,5,1609,32"/>
<area shape="rect" href="lapic_8c.html#a8bdd67ff70db633e45cce412fb4c7718" title=" " alt="" coords="1225,208,1345,235"/>
<area shape="rect" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096" title=" " alt="" coords="1229,259,1341,285"/>
<area shape="rect" href="lapic_8h.html#a1d8660ecbda996b11b10b179013e52d4" title=" " alt="" coords="919,400,1090,427"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="945,349,1064,376"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="913,477,1097,518"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="1195,461,1376,488"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="1193,513,1378,554"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="1181,360,1390,387"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="1168,579,1403,605"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="1189,629,1382,656"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="1207,681,1364,722"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="1204,411,1367,437"/>
</map>
</div>

</div>
</div>
<a id="affcdeac6765016e970e33d6ecff3eebb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affcdeac6765016e970e33d6ecff3eebb">&#9670;&nbsp;</a></span>avic_refresh_apicv_exec_ctrl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_refresh_apicv_exec_ctrl </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l01136">1136</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;{</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordtype">bool</span> activated = <a class="code" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358">kvm_vcpu_apicv_active</a>(vcpu);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="x86_8c.html#a04af9ab3eee510b54cba17a6fa94ee04">enable_apicv</a>)</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <a class="code" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d">avic_refresh_virtual_apic_mode</a>(vcpu);</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160; </div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">if</span> (activated)</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <a class="code" href="avic_8c.html#a7decdbafc7d47b2241e68ce3c90a9779">avic_vcpu_load</a>(vcpu, vcpu-&gt;cpu);</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <a class="code" href="avic_8c.html#a461f968598a11484e76a07fb87221bf2">avic_vcpu_put</a>(vcpu);</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160; </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <a class="code" href="avic_8c.html#a520da70652fa3f7af0d58c1ecb7d0db7">avic_set_pi_irte_mode</a>(vcpu, activated);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a461f968598a11484e76a07fb87221bf2"><div class="ttname"><a href="avic_8c.html#a461f968598a11484e76a07fb87221bf2">avic_vcpu_put</a></div><div class="ttdeci">void avic_vcpu_put(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l01072">avic.c:1072</a></div></div>
<div class="ttc" id="aavic_8c_html_a51356c24441683c197e1d4c2555da06d"><div class="ttname"><a href="avic_8c.html#a51356c24441683c197e1d4c2555da06d">avic_refresh_virtual_apic_mode</a></div><div class="ttdeci">void avic_refresh_virtual_apic_mode(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l01112">avic.c:1112</a></div></div>
<div class="ttc" id="aavic_8c_html_a520da70652fa3f7af0d58c1ecb7d0db7"><div class="ttname"><a href="avic_8c.html#a520da70652fa3f7af0d58c1ecb7d0db7">avic_set_pi_irte_mode</a></div><div class="ttdeci">static int avic_set_pi_irte_mode(struct kvm_vcpu *vcpu, bool activate)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00744">avic.c:744</a></div></div>
<div class="ttc" id="aavic_8c_html_a7decdbafc7d47b2241e68ce3c90a9779"><div class="ttname"><a href="avic_8c.html#a7decdbafc7d47b2241e68ce3c90a9779">avic_vcpu_load</a></div><div class="ttdeci">void avic_vcpu_load(struct kvm_vcpu *vcpu, int cpu)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l01028">avic.c:1028</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_affcdeac6765016e970e33d6ecff3eebb_cgraph.png" border="0" usemap="#aavic_8c_affcdeac6765016e970e33d6ecff3eebb_cgraph" alt=""/></div>
<map name="aavic_8c_affcdeac6765016e970e33d6ecff3eebb_cgraph" id="aavic_8c_affcdeac6765016e970e33d6ecff3eebb_cgraph">
<area shape="rect" title=" " alt="" coords="5,681,149,723"/>
<area shape="rect" href="avic_8c.html#a51356c24441683c197e1d4c2555da06d" title=" " alt="" coords="197,503,348,544"/>
<area shape="rect" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358" title=" " alt="" coords="396,638,575,665"/>
<area shape="rect" href="avic_8c.html#a520da70652fa3f7af0d58c1ecb7d0db7" title=" " alt="" coords="1077,798,1245,825"/>
<area shape="rect" href="avic_8c.html#a7decdbafc7d47b2241e68ce3c90a9779" title=" " alt="" coords="865,739,987,766"/>
<area shape="rect" href="avic_8c.html#a461f968598a11484e76a07fb87221bf2" title=" " alt="" coords="869,689,983,715"/>
<area shape="rect" href="avic_8c.html#a2af29a6a396bb757ac21f02f6aacfdfa" title=" " alt="" coords="409,426,561,453"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="1373,577,1444,603"/>
<area shape="rect" href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee" title=" " alt="" coords="623,244,789,285"/>
<area shape="rect" href="avic_8c.html#ac41a57fe4f855076b5c5718def5bd6d3" title=" " alt="" coords="401,482,569,509"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="647,634,765,661"/>
<area shape="rect" href="svm_8h.html#ab83edec724698a20d66a086a1900aa27" title=" " alt="" coords="417,375,553,402"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1337,251,1480,278"/>
<area shape="rect" href="svm_8c.html#a195738d23c6f6b6bf7269334d3a38721" title=" " alt="" coords="627,412,785,453"/>
<area shape="rect" href="svm_8c.html#ae7cebb5bd1d0e7eadb2b7df90cca0c74" title=" " alt="" coords="847,419,1005,446"/>
<area shape="rect" href="svm_8c.html#a7baa0f9e5f7d38e8ed066a4b8a61c09a" title=" " alt="" coords="1081,361,1240,403"/>
<area shape="rect" href="svm_8c.html#a1ffde811cc7743857dbb3175beda4aa2" title=" " alt="" coords="1063,529,1259,555"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="1338,470,1479,497"/>
<area shape="rect" href="svm__onhyperv_8h.html#aa8051536beeae65d3e4645edd68850ae" title=" " alt="" coords="1307,303,1511,344"/>
<area shape="rect" href="svm_8c.html#a35438091c40e77c617ce2ec9d521cc1f" title=" " alt="" coords="1335,369,1482,395"/>
<area shape="rect" href="svm_8c.html#a48f427ed9696201e388996df7ceccb9e" title=" " alt="" coords="1333,419,1484,446"/>
<area shape="rect" href="svm_8c.html#a6a3d076f98c7c25a44d90f49f0fca2c3" title=" " alt="" coords="1559,470,1732,497"/>
<area shape="rect" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2" title=" " alt="" coords="837,251,1015,278"/>
<area shape="rect" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e" title=" " alt="" coords="838,193,1014,219"/>
<area shape="rect" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d" title=" " alt="" coords="1075,244,1246,285"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="1336,91,1481,118"/>
<area shape="rect" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7" title=" " alt="" coords="1335,164,1482,205"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="1592,171,1699,198"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1566,91,1725,118"/>
<area shape="rect" href="avic_8c.html#a2650b353757b538de17a1c843f7308d2" title=" " alt="" coords="1104,91,1217,118"/>
<area shape="rect" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096" title=" " alt="" coords="1105,41,1217,67"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="646,478,766,505"/>
<area shape="rect" href="svm_8h.html#a5deff43556f8c807c64def073cd548e4" title=" " alt="" coords="627,529,785,555"/>
<area shape="rect" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8" title=" " alt="" coords="1318,761,1499,803"/>
<area shape="rect" href="avic_8c.html#a7b088623e16cec4875e37d8ce15231b2" title=" " alt="" coords="1065,732,1257,773"/>
</map>
</div>

</div>
</div>
<a id="a51356c24441683c197e1d4c2555da06d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51356c24441683c197e1d4c2555da06d">&#9670;&nbsp;</a></span>avic_refresh_virtual_apic_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_refresh_virtual_apic_mode </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>During AVIC temporary deactivation, guest could update APIC ID, DFR and LDR registers, which would not be trapped by <a class="el" href="avic_8c.html#a299de3990a5ce5ce873df7afe2b3338f">avic_unaccelerated_access_interception()</a>. In this case, we need to check and update the AVIC logical APIC ID table accordingly before re-activating.</p>

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l01112">1112</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;{</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keyword">struct </span>vmcb *vmcb = svm-&gt;<a class="code" href="structvcpu__svm.html#af0c24755d59a0cfca7ce9ba64f682722">vmcb01</a>.<a class="code" href="structkvm__vmcb__info.html#a8076921f239564576af7af19be7f6f04">ptr</a>;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160; </div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4">lapic_in_kernel</a>(vcpu) || !<a class="code" href="x86_8c.html#a04af9ab3eee510b54cba17a6fa94ee04">enable_apicv</a>)</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358">kvm_vcpu_apicv_active</a>(vcpu)) {<span class="comment"></span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">        /**</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">         * During AVIC temporary deactivation, guest could update</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">         * APIC ID, DFR and LDR registers, which would not be trapped</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">         * by avic_unaccelerated_access_interception(). In this case,</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">         * we need to check and update the AVIC logical APIC ID table</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">         * accordingly before re-activating.</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        <a class="code" href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee">avic_apicv_post_state_restore</a>(vcpu);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <a class="code" href="avic_8c.html#a2af29a6a396bb757ac21f02f6aacfdfa">avic_activate_vmcb</a>(svm);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <a class="code" href="avic_8c.html#ac41a57fe4f855076b5c5718def5bd6d3">avic_deactivate_vmcb</a>(svm);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <a class="code" href="svm_8h.html#ab83edec724698a20d66a086a1900aa27">vmcb_mark_dirty</a>(vmcb, <a class="code" href="svm_8h.html#a39fca1837c5ce7715cbf571669660c13a3d33483aba8bab1af6c7a3a56141cd8f">VMCB_AVIC</a>);</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_ae9f162404fdb37bba372d0c9cdc043ee"><div class="ttname"><a href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee">avic_apicv_post_state_restore</a></div><div class="ttdeci">void avic_apicv_post_state_restore(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00738">avic.c:738</a></div></div>
<div class="ttc" id="alapic_8h_html_a1d8c9378fcbf62390a89dc3b7f0bdbd4"><div class="ttname"><a href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4">lapic_in_kernel</a></div><div class="ttdeci">static bool lapic_in_kernel(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00186">lapic.h:186</a></div></div>
<div class="ttc" id="asvm_8h_html_a39fca1837c5ce7715cbf571669660c13a3d33483aba8bab1af6c7a3a56141cd8f"><div class="ttname"><a href="svm_8h.html#a39fca1837c5ce7715cbf571669660c13a3d33483aba8bab1af6c7a3a56141cd8f">VMCB_AVIC</a></div><div class="ttdeci">@ VMCB_AVIC</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00061">svm.h:61</a></div></div>
<div class="ttc" id="asvm_8h_html_ab83edec724698a20d66a086a1900aa27"><div class="ttname"><a href="svm_8h.html#ab83edec724698a20d66a086a1900aa27">vmcb_mark_dirty</a></div><div class="ttdeci">static void vmcb_mark_dirty(struct vmcb *vmcb, int bit)</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00354">svm.h:354</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a51356c24441683c197e1d4c2555da06d_cgraph.png" border="0" usemap="#aavic_8c_a51356c24441683c197e1d4c2555da06d_cgraph" alt=""/></div>
<map name="aavic_8c_a51356c24441683c197e1d4c2555da06d_cgraph" id="aavic_8c_a51356c24441683c197e1d4c2555da06d_cgraph">
<area shape="rect" title=" " alt="" coords="5,539,156,580"/>
<area shape="rect" href="avic_8c.html#a2af29a6a396bb757ac21f02f6aacfdfa" title=" " alt="" coords="217,491,369,518"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="1181,390,1252,417"/>
<area shape="rect" href="avic_8c.html#ae9f162404fdb37bba372d0c9cdc043ee" title=" " alt="" coords="431,244,597,285"/>
<area shape="rect" href="avic_8c.html#ac41a57fe4f855076b5c5718def5bd6d3" title=" " alt="" coords="209,546,377,573"/>
<area shape="rect" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358" title=" " alt="" coords="204,597,383,623"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="455,651,573,678"/>
<area shape="rect" href="svm_8h.html#ab83edec724698a20d66a086a1900aa27" title=" " alt="" coords="225,698,361,725"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1145,251,1288,278"/>
<area shape="rect" href="svm_8c.html#a195738d23c6f6b6bf7269334d3a38721" title=" " alt="" coords="435,484,593,525"/>
<area shape="rect" href="svm_8c.html#ae7cebb5bd1d0e7eadb2b7df90cca0c74" title=" " alt="" coords="655,513,813,539"/>
<area shape="rect" href="svm_8c.html#a7baa0f9e5f7d38e8ed066a4b8a61c09a" title=" " alt="" coords="889,564,1048,605"/>
<area shape="rect" href="svm_8c.html#a1ffde811cc7743857dbb3175beda4aa2" title=" " alt="" coords="871,513,1067,539"/>
<area shape="rect" href="x86_8c.html#aea310c0e4f695bd1c6b5d96aa1dbd940" title=" " alt="" coords="1146,571,1287,598"/>
<area shape="rect" href="svm__onhyperv_8h.html#aa8051536beeae65d3e4645edd68850ae" title=" " alt="" coords="1115,623,1319,664"/>
<area shape="rect" href="svm_8c.html#a35438091c40e77c617ce2ec9d521cc1f" title=" " alt="" coords="1143,689,1290,715"/>
<area shape="rect" href="svm_8c.html#a48f427ed9696201e388996df7ceccb9e" title=" " alt="" coords="1141,521,1292,547"/>
<area shape="rect" href="svm_8c.html#a6a3d076f98c7c25a44d90f49f0fca2c3" title=" " alt="" coords="1367,495,1540,522"/>
<area shape="rect" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2" title=" " alt="" coords="645,251,823,278"/>
<area shape="rect" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e" title=" " alt="" coords="646,193,822,219"/>
<area shape="rect" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d" title=" " alt="" coords="883,244,1054,285"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="1144,91,1289,118"/>
<area shape="rect" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7" title=" " alt="" coords="1143,164,1290,205"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="1400,171,1507,198"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1374,91,1533,118"/>
<area shape="rect" href="avic_8c.html#a2650b353757b538de17a1c843f7308d2" title=" " alt="" coords="912,91,1025,118"/>
<area shape="rect" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096" title=" " alt="" coords="913,41,1025,67"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="454,601,574,627"/>
<area shape="rect" href="svm_8h.html#a5deff43556f8c807c64def073cd548e4" title=" " alt="" coords="435,550,593,577"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a51356c24441683c197e1d4c2555da06d_icgraph.png" border="0" usemap="#aavic_8c_a51356c24441683c197e1d4c2555da06d_icgraph" alt=""/></div>
<map name="aavic_8c_a51356c24441683c197e1d4c2555da06d_icgraph" id="aavic_8c_a51356c24441683c197e1d4c2555da06d_icgraph">
<area shape="rect" title=" " alt="" coords="197,5,348,47"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="5,5,149,47"/>
</map>
</div>

</div>
</div>
<a id="ac8c9ded2546dccf6e4b561e633d22e7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8c9ded2546dccf6e4b561e633d22e7e">&#9670;&nbsp;</a></span>avic_ring_doorbell()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_ring_doorbell </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00321">321</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;{</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">     * Note, the vCPU could get migrated to a different pCPU at any point,</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">     * which could result in signalling the wrong/previous pCPU.  But if</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">     * that happens the vCPU is guaranteed to do a VMRUN (after being</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">     * migrated) and thus will process pending interrupts, i.e. a doorbell</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">     * is not needed (and the spurious one is harmless).</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordtype">int</span> cpu = READ_ONCE(vcpu-&gt;cpu);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span> (cpu != get_cpu()) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        wrmsrl(MSR_AMD64_SVM_AVIC_DOORBELL, kvm_cpu_get_apicid(cpu));</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        trace_kvm_avic_doorbell(vcpu-&gt;vcpu_id, kvm_cpu_get_apicid(cpu));</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    put_cpu();</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_ac8c9ded2546dccf6e4b561e633d22e7e_icgraph.png" border="0" usemap="#aavic_8c_ac8c9ded2546dccf6e4b561e633d22e7e_icgraph" alt=""/></div>
<map name="aavic_8c_ac8c9ded2546dccf6e4b561e633d22e7e_icgraph" id="aavic_8c_ac8c9ded2546dccf6e4b561e633d22e7e_icgraph">
<area shape="rect" title=" " alt="" coords="1659,38,1800,65"/>
<area shape="rect" href="svm_8c.html#a1faf261e116f9d9481e1bd6796e32280" title=" " alt="" coords="1429,31,1611,72"/>
<area shape="rect" href="avic_8c.html#a2b9e298755a0d51bb5b2dfc9dd254c64" title=" " alt="" coords="1238,13,1359,39"/>
<area shape="rect" href="svm_8c.html#a501d86bb28fd272f1ab52b8689b5f948" title=" " alt="" coords="1216,63,1381,90"/>
<area shape="rect" href="avic_8c.html#ad9345a779111a59de8fa4110106c3adf" title=" " alt="" coords="205,13,380,39"/>
<area shape="rect" href="avic_8c.html#a4b900d047f49b6cd00266aba3f4912bf" title=" " alt="" coords="944,38,1168,65"/>
<area shape="rect" href="avic_8c.html#a4a11c0014568405b90307ef68285e4ff" title=" " alt="" coords="5,5,157,47"/>
<area shape="rect" href="avic_8c.html#a7cf9fdcdf4f5f6559c099faaab0c2d29" title=" " alt="" coords="428,38,635,65"/>
<area shape="rect" href="avic_8c.html#a1404df5f813565dd104640a6e5bfea67" title=" " alt="" coords="683,89,896,115"/>
</map>
</div>

</div>
</div>
<a id="a520da70652fa3f7af0d58c1ecb7d0db7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a520da70652fa3f7af0d58c1ecb7d0db7">&#9670;&nbsp;</a></span>avic_set_pi_irte_mode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int avic_set_pi_irte_mode </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>activate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00744">744</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;{</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keyword">struct </span><a class="code" href="structamd__svm__iommu__ir.html">amd_svm_iommu_ir</a> *ir;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8">kvm_arch_has_assigned_device</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;kvm))</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">     * Here, we go through the per-vcpu ir_list to update all existing</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">     * interrupt remapping table entry targeting this vcpu.</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    spin_lock_irqsave(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keywordflow">if</span> (list_empty(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af217181f505db1b71c48743233032539">ir_list</a>))</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    list_for_each_entry(ir, &amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af217181f505db1b71c48743233032539">ir_list</a>, node) {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">if</span> (activate)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            ret = amd_iommu_activate_guest_mode(ir-&gt;<a class="code" href="structamd__svm__iommu__ir.html#ad1d0011f27de4fbde266e0ce65476e84">data</a>);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            ret = amd_iommu_deactivate_guest_mode(ir-&gt;<a class="code" href="structamd__svm__iommu__ir.html#ad1d0011f27de4fbde266e0ce65476e84">data</a>);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;out:</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    spin_unlock_irqrestore(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;}</div>
<div class="ttc" id="astructamd__svm__iommu__ir_html"><div class="ttname"><a href="structamd__svm__iommu__ir.html">amd_svm_iommu_ir</a></div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00080">avic.c:80</a></div></div>
<div class="ttc" id="astructamd__svm__iommu__ir_html_ad1d0011f27de4fbde266e0ce65476e84"><div class="ttname"><a href="structamd__svm__iommu__ir.html#ad1d0011f27de4fbde266e0ce65476e84">amd_svm_iommu_ir::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00082">avic.c:82</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a520da70652fa3f7af0d58c1ecb7d0db7_cgraph.png" border="0" usemap="#aavic_8c_a520da70652fa3f7af0d58c1ecb7d0db7_cgraph" alt=""/></div>
<map name="aavic_8c_a520da70652fa3f7af0d58c1ecb7d0db7_cgraph" id="aavic_8c_a520da70652fa3f7af0d58c1ecb7d0db7_cgraph">
<area shape="rect" title=" " alt="" coords="5,42,173,69"/>
<area shape="rect" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8" title=" " alt="" coords="221,5,403,47"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="277,71,347,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a520da70652fa3f7af0d58c1ecb7d0db7_icgraph.png" border="0" usemap="#aavic_8c_a520da70652fa3f7af0d58c1ecb7d0db7_icgraph" alt=""/></div>
<map name="aavic_8c_a520da70652fa3f7af0d58c1ecb7d0db7_icgraph" id="aavic_8c_a520da70652fa3f7af0d58c1ecb7d0db7_icgraph">
<area shape="rect" title=" " alt="" coords="197,13,365,39"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="5,5,149,47"/>
</map>
</div>

</div>
</div>
<a id="abf44c96047cb51680ff358ad52747b93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf44c96047cb51680ff358ad52747b93">&#9670;&nbsp;</a></span>avic_unaccel_trap_write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int avic_unaccel_trap_write </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00641">641</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;{</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    u32 offset = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(vcpu)-&gt;<a class="code" href="structvcpu__svm.html#af095ed7bcc31c036e28e533582723a60">vmcb</a>-&gt;control.exit_info_1 &amp;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                AVIC_UNACCEL_ACCESS_OFFSET_MASK;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">switch</span> (offset) {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">case</span> APIC_LDR:</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <a class="code" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e">avic_handle_ldr_update</a>(vcpu);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">case</span> APIC_DFR:</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <a class="code" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2">avic_handle_dfr_update</a>(vcpu);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">case</span> APIC_RRR:</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="comment">/* Ignore writes to Read Remote Data, it&#39;s read-only. */</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <a class="code" href="lapic_8c.html#a1b33bb5758d3dd75c7b87e537a5e729e">kvm_apic_write_nodecode</a>(vcpu, offset);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_abf44c96047cb51680ff358ad52747b93_cgraph.png" border="0" usemap="#aavic_8c_abf44c96047cb51680ff358ad52747b93_cgraph" alt=""/></div>
<map name="aavic_8c_abf44c96047cb51680ff358ad52747b93_cgraph" id="aavic_8c_abf44c96047cb51680ff358ad52747b93_cgraph">
<area shape="rect" title=" " alt="" coords="5,136,184,163"/>
<area shape="rect" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2" title=" " alt="" coords="475,108,652,135"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="1021,20,1091,47"/>
<area shape="rect" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e" title=" " alt="" coords="475,163,651,190"/>
<area shape="rect" href="lapic_8c.html#a1b33bb5758d3dd75c7b87e537a5e729e" title=" " alt="" coords="232,492,427,519"/>
<area shape="rect" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d" title=" " alt="" coords="720,97,891,138"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="983,592,1129,619"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="985,366,1127,392"/>
<area shape="rect" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7" title=" " alt="" coords="983,198,1129,240"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="1233,206,1339,232"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1207,592,1365,619"/>
<area shape="rect" href="avic_8c.html#a2650b353757b538de17a1c843f7308d2" title=" " alt="" coords="749,315,862,342"/>
<area shape="rect" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096" title=" " alt="" coords="749,264,861,291"/>
<area shape="rect" href="lapic_8c.html#a378a0961283ea67791303e70114fb10d" title=" " alt="" coords="483,467,644,494"/>
<area shape="rect" href="lapic_8c.html#acebc0ffd4530dfd1beb1254d1e4d9491" title=" " alt="" coords="485,1151,642,1178"/>
<area shape="rect" href="lapic_8c.html#adf2487dc76dace6e577b637cc357998b" title=" " alt="" coords="481,568,645,595"/>
<area shape="rect" href="lapic_8c.html#aa06cb4ebbfa40dbfa494b3b4cd9f8833" title=" " alt="" coords="718,467,893,494"/>
<area shape="rect" href="lapic_8c.html#adaceffbfc91320b193a66d974fb12ce0" title=" " alt="" coords="976,1235,1136,1262"/>
<area shape="rect" href="lapic_8c.html#afefd171448cafa66f80ecb9b9659ebb1" title=" " alt="" coords="700,872,911,899"/>
<area shape="rect" href="lapic_8c.html#af5602fb092ac09abc6c2bf0ad789d726" title=" " alt="" coords="754,1075,857,1102"/>
<area shape="rect" href="lapic_8c.html#aeb32a868e76d57da9fab57fce43efdbe" title=" " alt="" coords="750,1531,861,1558"/>
<area shape="rect" href="lapic_8c.html#ab2ee275fa1bc17aa0bfde435723b8f48" title=" " alt="" coords="984,1582,1128,1608"/>
<area shape="rect" href="lapic_8c.html#a02bd03bf711be3200ea2316ced434ff1" title=" " alt="" coords="755,1227,856,1254"/>
<area shape="rect" href="lapic_8c.html#ac7a03b55710bfcc78be7af0609f6f93d" title=" " alt="" coords="740,1176,871,1203"/>
<area shape="rect" href="lapic_8c.html#a8aa5f66b440e07d680f42fdaa211eac2" title=" " alt="" coords="986,1408,1126,1435"/>
<area shape="rect" href="lapic_8c.html#aec07f4595f82e14e1075beb4730b6976" title=" " alt="" coords="750,822,861,848"/>
<area shape="rect" href="lapic_8c.html#a4b7f12cb3ba68245df79bc30d938b728" title=" " alt="" coords="732,670,879,696"/>
<area shape="rect" href="lapic_8h.html#a447b1b971acaf871dd62669b4aa3116f" title=" " alt="" coords="1201,791,1371,818"/>
<area shape="rect" href="lapic_8c.html#a54214770509be207a1c1271e8b48acf4" title=" " alt="" coords="737,1582,874,1608"/>
<area shape="rect" href="lapic_8c.html#a2a5ccc92c8b75ad6118bdc1b84a43554" title=" " alt="" coords="737,1632,873,1659"/>
<area shape="rect" href="lapic_8c.html#ab24997de83c3fd44d1cd7520a615883e" title=" " alt="" coords="719,1683,892,1710"/>
<area shape="rect" href="lapic_8c.html#a36de6235abe5d5bd2fd57bf5739c1b5f" title=" " alt="" coords="713,1024,898,1051"/>
<area shape="rect" href="lapic_8c.html#a756b707dd502680db2eed7759defde40" title=" " alt="" coords="705,1278,905,1304"/>
<area shape="rect" href="lapic_8c.html#ab18679414f6ced1b8597fc3a9b445dea" title=" " alt="" coords="737,1328,874,1355"/>
<area shape="rect" href="lapic_8c.html#ade21404bee3e5dbbe596ff391e0a23db" title=" " alt="" coords="735,1379,876,1406"/>
<area shape="rect" href="lapic_8c.html#a5f5c49ce8a579b59663644f0f1a6cbe3" title=" " alt="" coords="741,1430,869,1456"/>
<area shape="rect" href="lapic_8c.html#a946cf21407471f7a6ba449b2435055c3" title=" " alt="" coords="727,720,884,747"/>
<area shape="rect" href="lapic_8c.html#a694be782d2a5e9a6ece8dd51f3da91f4" title=" " alt="" coords="712,923,899,950"/>
<area shape="rect" href="lapic_8c.html#a063bf62e455f91f22cf2b81452698b0c" title=" " alt="" coords="981,814,1131,840"/>
<area shape="rect" href="lapic_8c.html#a76fc10b30ae9deff038c276c3f5a9843" title=" " alt="" coords="1001,982,1111,1008"/>
<area shape="rect" href="lapic_8c.html#a80d977ac48cfa76440f2961e38b23fd0" title=" " alt="" coords="1207,1007,1365,1034"/>
<area shape="rect" href="lapic_8c.html#a7cfae0ee851075e6141d0446f4a133ab" title=" " alt="" coords="991,1286,1121,1312"/>
<area shape="rect" href="hyperv_8h.html#a7ffceaf3950bd76a9a3a28ff1e836e58" title=" " alt="" coords="959,1083,1153,1110"/>
<area shape="rect" href="hyperv_8c.html#a47f5a157cae898f7a7b370854c3748a4" title=" " alt="" coords="966,1134,1146,1160"/>
<area shape="rect" href="lapic_8c.html#a5001020f0ca8d6d692c54dd23b40ade4" title=" " alt="" coords="975,1184,1137,1211"/>
<area shape="rect" href="xen_8h.html#ae436f94d060f3cb8029695c5a9fddc42" title=" " alt="" coords="959,1531,1153,1558"/>
<area shape="rect" href="lapic_8c.html#a985df23c29d6d25105aba975adf5582c" title=" " alt="" coords="979,916,1133,957"/>
<area shape="rect" href="lapic_8c.html#af8cab016891083e066b7e1c086d012ae" title=" " alt="" coords="1221,1408,1351,1435"/>
<area shape="rect" href="irq_8h.html#a50293a78b5c0b6715243dc7854bcb210" title=" " alt="" coords="961,716,1151,743"/>
<area shape="rect" href="lapic_8c.html#a8c69ed3d074907a7adcee84e8570ebb2" title=" " alt="" coords="725,568,885,595"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_abf44c96047cb51680ff358ad52747b93_icgraph.png" border="0" usemap="#aavic_8c_abf44c96047cb51680ff358ad52747b93_icgraph" alt=""/></div>
<map name="aavic_8c_abf44c96047cb51680ff358ad52747b93_icgraph" id="aavic_8c_abf44c96047cb51680ff358ad52747b93_icgraph">
<area shape="rect" title=" " alt="" coords="212,13,391,39"/>
<area shape="rect" href="avic_8c.html#a299de3990a5ce5ce873df7afe2b3338f" title=" " alt="" coords="5,5,164,47"/>
</map>
</div>

</div>
</div>
<a id="a299de3990a5ce5ce873df7afe2b3338f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a299de3990a5ce5ce873df7afe2b3338f">&#9670;&nbsp;</a></span>avic_unaccelerated_access_interception()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int avic_unaccelerated_access_interception </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00693">693</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;{</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    u32 offset = svm-&gt;<a class="code" href="structvcpu__svm.html#af095ed7bcc31c036e28e533582723a60">vmcb</a>-&gt;control.exit_info_1 &amp;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;             AVIC_UNACCEL_ACCESS_OFFSET_MASK;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    u32 vector = svm-&gt;<a class="code" href="structvcpu__svm.html#af095ed7bcc31c036e28e533582723a60">vmcb</a>-&gt;control.exit_info_2 &amp;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;             AVIC_UNACCEL_ACCESS_VECTOR_MASK;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordtype">bool</span> write = (svm-&gt;<a class="code" href="structvcpu__svm.html#af095ed7bcc31c036e28e533582723a60">vmcb</a>-&gt;control.exit_info_1 &gt;&gt; 32) &amp;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;             AVIC_UNACCEL_ACCESS_WRITE_MASK;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordtype">bool</span> trap = <a class="code" href="avic_8c.html#a9c7db7e1cb25acd53eb51e777934c9e8">is_avic_unaccelerated_access_trap</a>(offset);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    trace_kvm_avic_unaccelerated_access(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;vcpu_id, offset,</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                        trap, write, vector);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> (trap) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="comment">/* Handling Trap */</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        WARN_ONCE(!write, <span class="stringliteral">&quot;svm: Handling trap read.\n&quot;</span>);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        ret = <a class="code" href="avic_8c.html#abf44c96047cb51680ff358ad52747b93">avic_unaccel_trap_write</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="comment">/* Handling Fault */</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        ret = <a class="code" href="x86_8c.html#a117738c7e069e71d58ab48a581bfc646">kvm_emulate_instruction</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>, 0);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a9c7db7e1cb25acd53eb51e777934c9e8"><div class="ttname"><a href="avic_8c.html#a9c7db7e1cb25acd53eb51e777934c9e8">is_avic_unaccelerated_access_trap</a></div><div class="ttdeci">static bool is_avic_unaccelerated_access_trap(u32 offset)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00664">avic.c:664</a></div></div>
<div class="ttc" id="aavic_8c_html_abf44c96047cb51680ff358ad52747b93"><div class="ttname"><a href="avic_8c.html#abf44c96047cb51680ff358ad52747b93">avic_unaccel_trap_write</a></div><div class="ttdeci">static int avic_unaccel_trap_write(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00641">avic.c:641</a></div></div>
<div class="ttc" id="ax86_8c_html_a117738c7e069e71d58ab48a581bfc646"><div class="ttname"><a href="x86_8c.html#a117738c7e069e71d58ab48a581bfc646">kvm_emulate_instruction</a></div><div class="ttdeci">int kvm_emulate_instruction(struct kvm_vcpu *vcpu, int emulation_type)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l09262">x86.c:9262</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a299de3990a5ce5ce873df7afe2b3338f_cgraph.png" border="0" usemap="#aavic_8c_a299de3990a5ce5ce873df7afe2b3338f_cgraph" alt=""/></div>
<map name="aavic_8c_a299de3990a5ce5ce873df7afe2b3338f_cgraph" id="aavic_8c_a299de3990a5ce5ce873df7afe2b3338f_cgraph">
<area shape="rect" title=" " alt="" coords="5,955,164,997"/>
<area shape="rect" href="avic_8c.html#abf44c96047cb51680ff358ad52747b93" title=" " alt="" coords="217,781,395,808"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="1007,832,1078,859"/>
<area shape="rect" href="avic_8c.html#a9c7db7e1cb25acd53eb51e777934c9e8" title=" " alt="" coords="223,985,389,1026"/>
<area shape="rect" href="x86_8c.html#a117738c7e069e71d58ab48a581bfc646" title=" " alt="" coords="212,1320,400,1347"/>
<area shape="rect" href="avic_8c.html#aaff9720871b696bc298d89cbb27a6dc2" title=" " alt="" coords="457,781,634,808"/>
<area shape="rect" href="avic_8c.html#a6a9ffca6bae1adce86d4495b5caaae2e" title=" " alt="" coords="457,613,633,640"/>
<area shape="rect" href="lapic_8c.html#a1b33bb5758d3dd75c7b87e537a5e729e" title=" " alt="" coords="448,335,643,361"/>
<area shape="rect" href="avic_8c.html#a2ed13621ec3f14afbf47f129e43b496d" title=" " alt="" coords="705,665,875,706"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="1203,512,1349,539"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="971,512,1114,539"/>
<area shape="rect" href="avic_8c.html#a5eaaa2d4a926c006359343ff29a9cdf7" title=" " alt="" coords="969,665,1116,706"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1404,512,1563,539"/>
<area shape="rect" href="avic_8c.html#a2650b353757b538de17a1c843f7308d2" title=" " alt="" coords="733,613,847,640"/>
<area shape="rect" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096" title=" " alt="" coords="734,461,846,488"/>
<area shape="rect" href="lapic_8c.html#a378a0961283ea67791303e70114fb10d" title=" " alt="" coords="709,107,871,133"/>
<area shape="rect" href="lapic_8c.html#acebc0ffd4530dfd1beb1254d1e4d9491" title=" " alt="" coords="711,259,869,285"/>
<area shape="rect" href="lapic_8c.html#adf2487dc76dace6e577b637cc357998b" title=" " alt="" coords="708,360,872,387"/>
<area shape="rect" href="lapic_8c.html#aa06cb4ebbfa40dbfa494b3b4cd9f8833" title=" " alt="" coords="955,5,1130,32"/>
<area shape="rect" href="lapic_8c.html#adaceffbfc91320b193a66d974fb12ce0" title=" " alt="" coords="1196,208,1356,235"/>
<area shape="rect" href="lapic_8c.html#afefd171448cafa66f80ecb9b9659ebb1" title=" " alt="" coords="937,309,1148,336"/>
<area shape="rect" href="lapic_8c.html#af5602fb092ac09abc6c2bf0ad789d726" title=" " alt="" coords="991,360,1094,387"/>
<area shape="rect" href="lapic_8c.html#aeb32a868e76d57da9fab57fce43efdbe" title=" " alt="" coords="987,157,1098,184"/>
<area shape="rect" href="lapic_8c.html#a02bd03bf711be3200ea2316ced434ff1" title=" " alt="" coords="992,208,1093,235"/>
<area shape="rect" href="lapic_8c.html#ac7a03b55710bfcc78be7af0609f6f93d" title=" " alt="" coords="977,107,1108,133"/>
<area shape="rect" href="lapic_8c.html#a8aa5f66b440e07d680f42fdaa211eac2" title=" " alt="" coords="1206,81,1346,108"/>
<area shape="rect" href="x86_8c.html#a3f6bd8b3f0bc1678451fd28682e7c3b1" title=" " alt="" coords="454,1564,637,1591"/>
<area shape="rect" href="x86_8c.html#a02687f1819d3a24cafdda1660be6ec9b" title=" " alt="" coords="975,1152,1110,1179"/>
<area shape="rect" href="x86_8c.html#a3989782ad88b95fba558bd550288d551" title=" " alt="" coords="691,1859,889,1885"/>
<area shape="rect" href="x86_8c.html#a82999d0b499027dbcf226f164016c023" title=" " alt="" coords="701,1909,879,1936"/>
<area shape="rect" href="emulate_8c.html#a8e6c168c4d0660ef944366d6dd83c506" title=" " alt="" coords="713,1961,867,2002"/>
<area shape="rect" href="x86_8c.html#a673435288bc64cc9ddadb6b25c95693e" title=" " alt="" coords="729,2027,851,2053"/>
<area shape="rect" href="x86_8c.html#aa8815dc77b29b1054a9edc849d14a3b0" title=" " alt="" coords="696,2128,884,2155"/>
<area shape="rect" href="x86_8c.html#ac9502ee8f018301047c80e19ab79f7e2" title=" " alt="" coords="958,2128,1127,2155"/>
<area shape="rect" href="x86_8c.html#aac24bace71b27dc8ae2ee3ecae145d0f" title=" " alt="" coords="951,2077,1135,2104"/>
<area shape="rect" href="x86_8c.html#a031a116c2f53928292fd79cb4405352e" title=" " alt="" coords="691,2077,889,2104"/>
<area shape="rect" href="x86_8c.html#a83c65667726e87db38b0379e6de27a29" title=" " alt="" coords="710,1035,870,1077"/>
<area shape="rect" href="x86_8c.html#a5cf5556013d24428137ff2113e368db5" title=" " alt="" coords="695,1101,885,1128"/>
<area shape="rect" href="x86_8h.html#acdc826b0cd2ce8b958a826c8faa306b4" title=" " alt="" coords="709,1153,871,1194"/>
<area shape="rect" href="pmu_8c.html#a0b4da757f734ef55ec71a70808bc50d4" title=" " alt="" coords="699,1219,881,1245"/>
<area shape="rect" href="kvm__cache__regs_8h.html#aa70071fd3a98f236b0b57a30cbec124f" title=" " alt="" coords="733,1269,847,1296"/>
<area shape="rect" href="x86_8c.html#a12826c3f941e4dbf381d4d085ce42110" title=" " alt="" coords="729,984,851,1011"/>
<area shape="rect" href="x86_8c.html#a95270b039fad8dd0663cbee58f3d1cf4" title=" " alt="" coords="704,1371,876,1413"/>
<area shape="rect" href="x86_8c.html#aaad1e1c79fc8780110beaebf328ea7f9" title=" " alt="" coords="697,1437,883,1464"/>
<area shape="rect" href="x86_8c.html#a5559cadc9496d9f62e002e88144d5156" title=" " alt="" coords="709,1488,871,1515"/>
<area shape="rect" href="x86_8c.html#a5969d2c2ff863d86dbdd90088da52139" title=" " alt="" coords="725,1539,855,1565"/>
<area shape="rect" href="x86_8c.html#a32d57f7752f511acb821a12625ff8455" title=" " alt="" coords="709,1589,871,1616"/>
<area shape="rect" href="emulate_8c.html#a4a1d9ea50bedcf56a5ba5ca9f6e90c6a" title=" " alt="" coords="999,1699,1086,1725"/>
<area shape="rect" href="x86_8c.html#a1d439c08a5848010284827827cfcbf76" title=" " alt="" coords="705,1691,875,1733"/>
<area shape="rect" href="emulate_8c.html#a01cc7d1fe9a09ddc0941fe01271556af" title=" " alt="" coords="719,1640,861,1667"/>
</map>
</div>

</div>
</div>
<a id="a7b088623e16cec4875e37d8ce15231b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b088623e16cec4875e37d8ce15231b2">&#9670;&nbsp;</a></span>avic_update_iommu_vcpu_affinity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int avic_update_iommu_vcpu_affinity </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l01002">1002</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;{</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keyword">struct </span><a class="code" href="structamd__svm__iommu__ir.html">amd_svm_iommu_ir</a> *ir;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    lockdep_assert_held(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8">kvm_arch_has_assigned_device</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>-&gt;kvm))</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">     * Here, we go through the per-vcpu ir_list to update all existing</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">     * interrupt remapping table entry targeting this vcpu.</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">if</span> (list_empty(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af217181f505db1b71c48743233032539">ir_list</a>))</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    list_for_each_entry(ir, &amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af217181f505db1b71c48743233032539">ir_list</a>, node) {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        ret = amd_iommu_update_ga(cpu, r, ir-&gt;<a class="code" href="structamd__svm__iommu__ir.html#ad1d0011f27de4fbde266e0ce65476e84">data</a>);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a7b088623e16cec4875e37d8ce15231b2_cgraph.png" border="0" usemap="#aavic_8c_a7b088623e16cec4875e37d8ce15231b2_cgraph" alt=""/></div>
<map name="aavic_8c_a7b088623e16cec4875e37d8ce15231b2_cgraph" id="aavic_8c_a7b088623e16cec4875e37d8ce15231b2_cgraph">
<area shape="rect" title=" " alt="" coords="5,35,197,76"/>
<area shape="rect" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8" title=" " alt="" coords="245,5,427,47"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="301,71,371,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a7b088623e16cec4875e37d8ce15231b2_icgraph.png" border="0" usemap="#aavic_8c_a7b088623e16cec4875e37d8ce15231b2_icgraph" alt=""/></div>
<map name="aavic_8c_a7b088623e16cec4875e37d8ce15231b2_icgraph" id="aavic_8c_a7b088623e16cec4875e37d8ce15231b2_icgraph">
<area shape="rect" title=" " alt="" coords="389,110,581,151"/>
<area shape="rect" href="avic_8c.html#a7decdbafc7d47b2241e68ce3c90a9779" title=" " alt="" coords="219,88,341,115"/>
<area shape="rect" href="avic_8c.html#a461f968598a11484e76a07fb87221bf2" title=" " alt="" coords="223,143,337,169"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="16,107,160,149"/>
<area shape="rect" href="avic_8c.html#a7e341d7f17b2f611aca180217cfc6ad3" title=" " alt="" coords="5,5,171,32"/>
<area shape="rect" href="svm_8c.html#ab9e5b464a654de732fe7b0ce81145897" title=" " alt="" coords="27,56,149,83"/>
<area shape="rect" href="avic_8c.html#a056e12caaf24f044fce8545a863dbbce" title=" " alt="" coords="13,173,163,200"/>
<area shape="rect" href="svm_8c.html#af102e65fa4a28844d0bd7bbb75bd4565" title=" " alt="" coords="30,224,146,251"/>
</map>
</div>

</div>
</div>
<a id="a056e12caaf24f044fce8545a863dbbce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a056e12caaf24f044fce8545a863dbbce">&#9670;&nbsp;</a></span>avic_vcpu_blocking()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_vcpu_blocking </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l01153">1153</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;{</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358">kvm_vcpu_apicv_active</a>(vcpu))</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160; </div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;       <span class="comment">/*</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">        * Unload the AVIC when the vCPU is about to block, _before_</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">        * the vCPU actually blocks.</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">        *</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">        * Any IRQs that arrive before IsRunning=0 will not cause an</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">        * incomplete IPI vmexit on the source, therefore vIRR will also</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">        * be checked by kvm_vcpu_check_block() before blocking.  The</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">        * memory barrier implicit in set_current_state orders writing</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">        * IsRunning=0 before reading the vIRR.  The processor needs a</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">        * matching memory barrier on interrupt delivery between writing</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">        * IRR and reading IsRunning; the lack of this barrier might be</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">        * the cause of errata #1235).</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <a class="code" href="avic_8c.html#a461f968598a11484e76a07fb87221bf2">avic_vcpu_put</a>(vcpu);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a056e12caaf24f044fce8545a863dbbce_cgraph.png" border="0" usemap="#aavic_8c_a056e12caaf24f044fce8545a863dbbce_cgraph" alt=""/></div>
<map name="aavic_8c_a056e12caaf24f044fce8545a863dbbce_cgraph" id="aavic_8c_a056e12caaf24f044fce8545a863dbbce_cgraph">
<area shape="rect" title=" " alt="" coords="5,97,155,123"/>
<area shape="rect" href="avic_8c.html#a461f968598a11484e76a07fb87221bf2" title=" " alt="" coords="235,71,349,98"/>
<area shape="rect" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358" title=" " alt="" coords="203,122,381,149"/>
<area shape="rect" href="avic_8c.html#a7b088623e16cec4875e37d8ce15231b2" title=" " alt="" coords="429,5,621,47"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="725,71,795,98"/>
<area shape="rect" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8" title=" " alt="" coords="669,5,851,47"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="466,122,585,149"/>
</map>
</div>

</div>
</div>
<a id="aed65a2dabdad6a421b487e1e7b106277"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed65a2dabdad6a421b487e1e7b106277">&#9670;&nbsp;</a></span>avic_vcpu_get_apicv_inhibit_reasons()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long avic_vcpu_get_apicv_inhibit_reasons </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00542">542</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;{</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc">is_guest_mode</a>(vcpu))</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">return</span> APICV_INHIBIT_REASON_NESTED;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_aed65a2dabdad6a421b487e1e7b106277_cgraph.png" border="0" usemap="#aavic_8c_aed65a2dabdad6a421b487e1e7b106277_cgraph" alt=""/></div>
<map name="aavic_8c_aed65a2dabdad6a421b487e1e7b106277_cgraph" id="aavic_8c_aed65a2dabdad6a421b487e1e7b106277_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,163,47"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="211,13,331,39"/>
</map>
</div>

</div>
</div>
<a id="a7decdbafc7d47b2241e68ce3c90a9779"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7decdbafc7d47b2241e68ce3c90a9779">&#9670;&nbsp;</a></span>avic_vcpu_load()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_vcpu_load </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cpu</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l01028">1028</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;{</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    u64 entry;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keywordtype">int</span> h_physical_id = kvm_cpu_get_apicid(cpu);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    lockdep_assert_preemption_disabled();</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keywordflow">if</span> (WARN_ON(h_physical_id &amp; ~AVIC_PHYSICAL_ID_ENTRY_HOST_PHYSICAL_ID_MASK))</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">     * No need to update anything if the vCPU is blocking, i.e. if the vCPU</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">     * is being scheduled in after being preempted.  The CPU entries in the</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">     * Physical APIC table and IRTE are consumed iff IsRun{ning} is &#39;1&#39;.</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">     * If the vCPU was migrated, its new CPU value will be stuffed when the</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">     * vCPU unblocks.</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">if</span> (kvm_vcpu_is_blocking(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>))</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">     * Grab the per-vCPU interrupt remapping lock even if the VM doesn&#39;t</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">     * _currently_ have assigned devices, as that can change.  Holding</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">     * ir_list_lock ensures that either svm_ir_list_add() will consume</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">     * up-to-date entry information, or that this task will wait until</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">     * svm_ir_list_add() completes to set the new target pCPU.</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    spin_lock_irqsave(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160; </div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    entry = READ_ONCE(*(svm-&gt;<a class="code" href="structvcpu__svm.html#abc377a3a5f1f42e18f8a9044321f3d5b">avic_physical_id_cache</a>));</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    WARN_ON_ONCE(entry &amp; AVIC_PHYSICAL_ID_ENTRY_IS_RUNNING_MASK);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    entry &amp;= ~AVIC_PHYSICAL_ID_ENTRY_HOST_PHYSICAL_ID_MASK;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    entry |= (h_physical_id &amp; AVIC_PHYSICAL_ID_ENTRY_HOST_PHYSICAL_ID_MASK);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    entry |= AVIC_PHYSICAL_ID_ENTRY_IS_RUNNING_MASK;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160; </div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    WRITE_ONCE(*(svm-&gt;<a class="code" href="structvcpu__svm.html#abc377a3a5f1f42e18f8a9044321f3d5b">avic_physical_id_cache</a>), entry);</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <a class="code" href="avic_8c.html#a7b088623e16cec4875e37d8ce15231b2">avic_update_iommu_vcpu_affinity</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>, h_physical_id, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160; </div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    spin_unlock_irqrestore(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a7b088623e16cec4875e37d8ce15231b2"><div class="ttname"><a href="avic_8c.html#a7b088623e16cec4875e37d8ce15231b2">avic_update_iommu_vcpu_affinity</a></div><div class="ttdeci">static int avic_update_iommu_vcpu_affinity(struct kvm_vcpu *vcpu, int cpu, bool r)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l01002">avic.c:1002</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a7decdbafc7d47b2241e68ce3c90a9779_cgraph.png" border="0" usemap="#aavic_8c_a7decdbafc7d47b2241e68ce3c90a9779_cgraph" alt=""/></div>
<map name="aavic_8c_a7decdbafc7d47b2241e68ce3c90a9779_cgraph" id="aavic_8c_a7decdbafc7d47b2241e68ce3c90a9779_cgraph">
<area shape="rect" title=" " alt="" coords="5,42,128,69"/>
<area shape="rect" href="avic_8c.html#a7b088623e16cec4875e37d8ce15231b2" title=" " alt="" coords="176,5,368,47"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="471,71,542,98"/>
<area shape="rect" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8" title=" " alt="" coords="416,5,597,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a7decdbafc7d47b2241e68ce3c90a9779_icgraph.png" border="0" usemap="#aavic_8c_a7decdbafc7d47b2241e68ce3c90a9779_icgraph" alt=""/></div>
<map name="aavic_8c_a7decdbafc7d47b2241e68ce3c90a9779_icgraph" id="aavic_8c_a7decdbafc7d47b2241e68ce3c90a9779_icgraph">
<area shape="rect" title=" " alt="" coords="219,71,341,98"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="16,5,160,47"/>
<area shape="rect" href="avic_8c.html#a7e341d7f17b2f611aca180217cfc6ad3" title=" " alt="" coords="5,71,171,98"/>
<area shape="rect" href="svm_8c.html#ab9e5b464a654de732fe7b0ce81145897" title=" " alt="" coords="27,122,149,149"/>
</map>
</div>

</div>
</div>
<a id="a461f968598a11484e76a07fb87221bf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a461f968598a11484e76a07fb87221bf2">&#9670;&nbsp;</a></span>avic_vcpu_put()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_vcpu_put </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l01072">1072</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;{</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    u64 entry;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    lockdep_assert_preemption_disabled();</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">     * Note, reading the Physical ID entry outside of ir_list_lock is safe</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">     * as only the pCPU that has loaded (or is loading) the vCPU is allowed</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">     * to modify the entry, and preemption is disabled.  I.e. the vCPU</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">     * can&#39;t be scheduled out and thus avic_vcpu_{put,load}() can&#39;t run</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">     * recursively.</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    entry = READ_ONCE(*(svm-&gt;<a class="code" href="structvcpu__svm.html#abc377a3a5f1f42e18f8a9044321f3d5b">avic_physical_id_cache</a>));</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">/* Nothing to do if IsRunning == &#39;0&#39; due to vCPU blocking. */</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">if</span> (!(entry &amp; AVIC_PHYSICAL_ID_ENTRY_IS_RUNNING_MASK))</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">     * Take and hold the per-vCPU interrupt remapping lock while updating</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">     * the Physical ID entry even though the lock doesn&#39;t protect against</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">     * multiple writers (see above).  Holding ir_list_lock ensures that</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment">     * either svm_ir_list_add() will consume up-to-date entry information,</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">     * or that this task will wait until svm_ir_list_add() completes to</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">     * mark the vCPU as not running.</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    spin_lock_irqsave(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <a class="code" href="avic_8c.html#a7b088623e16cec4875e37d8ce15231b2">avic_update_iommu_vcpu_affinity</a>(<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>, -1, 0);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    entry &amp;= ~AVIC_PHYSICAL_ID_ENTRY_IS_RUNNING_MASK;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    WRITE_ONCE(*(svm-&gt;<a class="code" href="structvcpu__svm.html#abc377a3a5f1f42e18f8a9044321f3d5b">avic_physical_id_cache</a>), entry);</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    spin_unlock_irqrestore(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a461f968598a11484e76a07fb87221bf2_cgraph.png" border="0" usemap="#aavic_8c_a461f968598a11484e76a07fb87221bf2_cgraph" alt=""/></div>
<map name="aavic_8c_a461f968598a11484e76a07fb87221bf2_cgraph" id="aavic_8c_a461f968598a11484e76a07fb87221bf2_cgraph">
<area shape="rect" title=" " alt="" coords="5,42,120,69"/>
<area shape="rect" href="avic_8c.html#a7b088623e16cec4875e37d8ce15231b2" title=" " alt="" coords="168,5,360,47"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="463,71,534,98"/>
<area shape="rect" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8" title=" " alt="" coords="408,5,589,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a461f968598a11484e76a07fb87221bf2_icgraph.png" border="0" usemap="#aavic_8c_a461f968598a11484e76a07fb87221bf2_icgraph" alt=""/></div>
<map name="aavic_8c_a461f968598a11484e76a07fb87221bf2_icgraph" id="aavic_8c_a461f968598a11484e76a07fb87221bf2_icgraph">
<area shape="rect" title=" " alt="" coords="203,71,317,98"/>
<area shape="rect" href="avic_8c.html#affcdeac6765016e970e33d6ecff3eebb" title=" " alt="" coords="8,5,152,47"/>
<area shape="rect" href="avic_8c.html#a056e12caaf24f044fce8545a863dbbce" title=" " alt="" coords="5,71,155,98"/>
<area shape="rect" href="svm_8c.html#af102e65fa4a28844d0bd7bbb75bd4565" title=" " alt="" coords="22,122,138,149"/>
</map>
</div>

</div>
</div>
<a id="a7e341d7f17b2f611aca180217cfc6ad3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e341d7f17b2f611aca180217cfc6ad3">&#9670;&nbsp;</a></span>avic_vcpu_unblocking()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_vcpu_unblocking </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l01174">1174</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;{</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358">kvm_vcpu_apicv_active</a>(vcpu))</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160; </div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <a class="code" href="avic_8c.html#a7decdbafc7d47b2241e68ce3c90a9779">avic_vcpu_load</a>(vcpu, vcpu-&gt;cpu);</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a7e341d7f17b2f611aca180217cfc6ad3_cgraph.png" border="0" usemap="#aavic_8c_a7e341d7f17b2f611aca180217cfc6ad3_cgraph" alt=""/></div>
<map name="aavic_8c_a7e341d7f17b2f611aca180217cfc6ad3_cgraph" id="aavic_8c_a7e341d7f17b2f611aca180217cfc6ad3_cgraph">
<area shape="rect" title=" " alt="" coords="5,97,171,123"/>
<area shape="rect" href="avic_8c.html#a7decdbafc7d47b2241e68ce3c90a9779" title=" " alt="" coords="247,71,369,98"/>
<area shape="rect" href="lapic_8h.html#a3af346d02eebff16886d49d3810b5358" title=" " alt="" coords="219,122,397,149"/>
<area shape="rect" href="avic_8c.html#a7b088623e16cec4875e37d8ce15231b2" title=" " alt="" coords="445,5,637,47"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="741,71,811,98"/>
<area shape="rect" href="x86_8c.html#ae63567e9b665b34f8c84fc4dc594f3c8" title=" " alt="" coords="685,5,867,47"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="482,122,601,149"/>
</map>
</div>

</div>
</div>
<a id="a3bb736e8688ecfaa3696b347764fd37d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bb736e8688ecfaa3696b347764fd37d">&#9670;&nbsp;</a></span>avic_vm_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void avic_vm_destroy </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00174">174</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__svm.html">kvm_svm</a> *<a class="code" href="structkvm__svm.html">kvm_svm</a> = <a class="code" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd">to_kvm_svm</a>(<a class="code" href="structkvm__svm.html#ade6c6ec6e820a10719c5d61e161aa8b8">kvm</a>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="x86_8c.html#a04af9ab3eee510b54cba17a6fa94ee04">enable_apicv</a>)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a837dca12e3d1d7b768feb04c6a3c2e96">avic_logical_id_table_page</a>)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        __free_page(<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a837dca12e3d1d7b768feb04c6a3c2e96">avic_logical_id_table_page</a>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#aa05522988cc0a3ce6ad59dcec1ed0c46">avic_physical_id_table_page</a>)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        __free_page(<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#aa05522988cc0a3ce6ad59dcec1ed0c46">avic_physical_id_table_page</a>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    spin_lock_irqsave(&amp;svm_vm_data_hash_lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    hash_del(&amp;<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a4f8eab5b98a43c0a7402d15663d4e032">hnode</a>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    spin_unlock_irqrestore(&amp;svm_vm_data_hash_lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
<div class="ttc" id="astructkvm__svm_html_a4f8eab5b98a43c0a7402d15663d4e032"><div class="ttname"><a href="structkvm__svm.html#a4f8eab5b98a43c0a7402d15663d4e032">kvm_svm::hnode</a></div><div class="ttdeci">struct hlist_node hnode</div><div class="ttdef"><b>Definition:</b> <a href="svm_8h_source.html#l00101">svm.h:102</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a3bb736e8688ecfaa3696b347764fd37d_cgraph.png" border="0" usemap="#aavic_8c_a3bb736e8688ecfaa3696b347764fd37d_cgraph" alt=""/></div>
<map name="aavic_8c_a3bb736e8688ecfaa3696b347764fd37d_cgraph" id="aavic_8c_a3bb736e8688ecfaa3696b347764fd37d_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,139,32"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="187,5,293,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a3bb736e8688ecfaa3696b347764fd37d_icgraph.png" border="0" usemap="#aavic_8c_a3bb736e8688ecfaa3696b347764fd37d_icgraph" alt=""/></div>
<map name="aavic_8c_a3bb736e8688ecfaa3696b347764fd37d_icgraph" id="aavic_8c_a3bb736e8688ecfaa3696b347764fd37d_icgraph">
<area shape="rect" title=" " alt="" coords="188,31,321,57"/>
<area shape="rect" href="avic_8c.html#a0ddedac4b0b428928fae6bc9fe902e2a" title=" " alt="" coords="20,5,125,32"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="5,56,140,83"/>
</map>
</div>

</div>
</div>
<a id="a0ddedac4b0b428928fae6bc9fe902e2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ddedac4b0b428928fae6bc9fe902e2a">&#9670;&nbsp;</a></span>avic_vm_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int avic_vm_init </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00192">192</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">int</span> err = -ENOMEM;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__svm.html">kvm_svm</a> *<a class="code" href="structkvm__svm.html">kvm_svm</a> = <a class="code" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd">to_kvm_svm</a>(<a class="code" href="structkvm__svm.html#ade6c6ec6e820a10719c5d61e161aa8b8">kvm</a>);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__svm.html">kvm_svm</a> *k2;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keyword">struct </span>page *p_page;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keyword">struct </span>page *l_page;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    u32 vm_id;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="x86_8c.html#a04af9ab3eee510b54cba17a6fa94ee04">enable_apicv</a>)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">/* Allocating physical APIC ID table (4KB) */</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    p_page = alloc_page(GFP_KERNEL_ACCOUNT | __GFP_ZERO);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> (!p_page)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">goto</span> free_avic;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#aa05522988cc0a3ce6ad59dcec1ed0c46">avic_physical_id_table_page</a> = p_page;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">/* Allocating logical APIC ID table (4KB) */</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    l_page = alloc_page(GFP_KERNEL_ACCOUNT | __GFP_ZERO);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">if</span> (!l_page)</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">goto</span> free_avic;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a837dca12e3d1d7b768feb04c6a3c2e96">avic_logical_id_table_page</a> = l_page;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    spin_lock_irqsave(&amp;svm_vm_data_hash_lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; again:</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    vm_id = <a class="code" href="avic_8c.html#aebb4737cca7862427a4b94f3f086dee3">next_vm_id</a> = (<a class="code" href="avic_8c.html#aebb4737cca7862427a4b94f3f086dee3">next_vm_id</a> + 1) &amp; <a class="code" href="avic_8c.html#aa582eb517550b4af588363963042a791">AVIC_VM_ID_MASK</a>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">if</span> (vm_id == 0) { <span class="comment">/* id is 1-based, zero is not okay */</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <a class="code" href="avic_8c.html#a1e123c3defad20a133e56f43373b9c44">next_vm_id_wrapped</a> = 1;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">goto</span> again;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">/* Is it still in use? Only possible if wrapped at least once */</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="avic_8c.html#a1e123c3defad20a133e56f43373b9c44">next_vm_id_wrapped</a>) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        hash_for_each_possible(svm_vm_data_hash, k2, hnode, vm_id) {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">if</span> (k2-&gt;<a class="code" href="structkvm__svm.html#a06c4479d5aefb8c19b8ead15d599b324">avic_vm_id</a> == vm_id)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <span class="keywordflow">goto</span> again;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a06c4479d5aefb8c19b8ead15d599b324">avic_vm_id</a> = vm_id;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    hash_add(svm_vm_data_hash, &amp;<a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a4f8eab5b98a43c0a7402d15663d4e032">hnode</a>, <a class="code" href="structkvm__svm.html">kvm_svm</a>-&gt;<a class="code" href="structkvm__svm.html#a06c4479d5aefb8c19b8ead15d599b324">avic_vm_id</a>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    spin_unlock_irqrestore(&amp;svm_vm_data_hash_lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;free_avic:</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="avic_8c.html#a3bb736e8688ecfaa3696b347764fd37d">avic_vm_destroy</a>(kvm);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div>
<div class="ttc" id="aavic_8c_html_a1e123c3defad20a133e56f43373b9c44"><div class="ttname"><a href="avic_8c.html#a1e123c3defad20a133e56f43373b9c44">next_vm_id_wrapped</a></div><div class="ttdeci">static bool next_vm_id_wrapped</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00073">avic.c:73</a></div></div>
<div class="ttc" id="aavic_8c_html_a3bb736e8688ecfaa3696b347764fd37d"><div class="ttname"><a href="avic_8c.html#a3bb736e8688ecfaa3696b347764fd37d">avic_vm_destroy</a></div><div class="ttdeci">void avic_vm_destroy(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00174">avic.c:174</a></div></div>
<div class="ttc" id="aavic_8c_html_aebb4737cca7862427a4b94f3f086dee3"><div class="ttname"><a href="avic_8c.html#aebb4737cca7862427a4b94f3f086dee3">next_vm_id</a></div><div class="ttdeci">static u32 next_vm_id</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l00072">avic.c:72</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a0ddedac4b0b428928fae6bc9fe902e2a_cgraph.png" border="0" usemap="#aavic_8c_a0ddedac4b0b428928fae6bc9fe902e2a_cgraph" alt=""/></div>
<map name="aavic_8c_a0ddedac4b0b428928fae6bc9fe902e2a_cgraph" id="aavic_8c_a0ddedac4b0b428928fae6bc9fe902e2a_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,111,57"/>
<area shape="rect" href="avic_8c.html#a3bb736e8688ecfaa3696b347764fd37d" title=" " alt="" coords="159,5,292,32"/>
<area shape="rect" href="svm_8h.html#ac27f6fe2ff4beeb5ad1b11681d0386fd" title=" " alt="" coords="340,31,447,57"/>
</map>
</div>

</div>
</div>
<a id="aa0b824f0eb25d52b2753a0446792f7d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0b824f0eb25d52b2753a0446792f7d9">&#9670;&nbsp;</a></span>DEFINE_HASHTABLE()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static DEFINE_HASHTABLE </td>
          <td>(</td>
          <td class="paramtype">svm_vm_data_hash&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="avic_8c.html#a43bf45802761215fb7aeb3a0f716a429">SVM_VM_DATA_HASH_BITS</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a48d73aa47db0cd13044af80a191469b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48d73aa47db0cd13044af80a191469b6">&#9670;&nbsp;</a></span>DEFINE_SPINLOCK()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static DEFINE_SPINLOCK </td>
          <td>(</td>
          <td class="paramtype">svm_vm_data_hash_lock&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a24f70312b475fe0e0858ee3cc7e3af71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24f70312b475fe0e0858ee3cc7e3af71">&#9670;&nbsp;</a></span>get_pi_vcpu_info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_pi_vcpu_info </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_kernel_irq_routing_entry *&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vcpu_data *&#160;</td>
          <td class="paramname"><em>vcpu_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> **&#160;</td>
          <td class="paramname"><em>svm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00861">861</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;{</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keyword">struct </span>kvm_lapic_irq irq;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = NULL;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <a class="code" href="irq__comm_8c.html#a6270cddb139f2ca4f42d21f8caaa1224">kvm_set_msi_irq</a>(kvm, e, &amp;irq);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="irq__comm_8c.html#a6de5d9a13302fceb034b8d75b4c787e2">kvm_intr_is_single_vcpu</a>(kvm, &amp;irq, &amp;vcpu) ||</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        !kvm_irq_is_postable(&amp;irq)) {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        pr_debug(<span class="stringliteral">&quot;SVM: %s: use legacy intr remap mode for irq %u\n&quot;</span>,</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;             __func__, irq.vector);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    pr_debug(<span class="stringliteral">&quot;SVM: %s: use GA mode for irq %u\n&quot;</span>, __func__,</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;         irq.vector);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    *svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(vcpu);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    vcpu_info-&gt;pi_desc_addr = __sme_set(page_to_phys((*svm)-&gt;avic_backing_page));</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    vcpu_info-&gt;vector = irq.vector;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;}</div>
<div class="ttc" id="airq__comm_8c_html_a6270cddb139f2ca4f42d21f8caaa1224"><div class="ttname"><a href="irq__comm_8c.html#a6270cddb139f2ca4f42d21f8caaa1224">kvm_set_msi_irq</a></div><div class="ttdeci">void kvm_set_msi_irq(struct kvm *kvm, struct kvm_kernel_irq_routing_entry *e, struct kvm_lapic_irq *irq)</div><div class="ttdef"><b>Definition:</b> <a href="irq__comm_8c_source.html#l00104">irq_comm.c:104</a></div></div>
<div class="ttc" id="airq__comm_8c_html_a6de5d9a13302fceb034b8d75b4c787e2"><div class="ttname"><a href="irq__comm_8c.html#a6de5d9a13302fceb034b8d75b4c787e2">kvm_intr_is_single_vcpu</a></div><div class="ttdeci">bool kvm_intr_is_single_vcpu(struct kvm *kvm, struct kvm_lapic_irq *irq, struct kvm_vcpu **dest_vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="irq__comm_8c_source.html#l00338">irq_comm.c:338</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a24f70312b475fe0e0858ee3cc7e3af71_cgraph.png" border="0" usemap="#aavic_8c_a24f70312b475fe0e0858ee3cc7e3af71_cgraph" alt=""/></div>
<map name="aavic_8c_a24f70312b475fe0e0858ee3cc7e3af71_cgraph" id="aavic_8c_a24f70312b475fe0e0858ee3cc7e3af71_cgraph">
<area shape="rect" title=" " alt="" coords="5,425,137,452"/>
<area shape="rect" href="irq__comm_8c.html#a6de5d9a13302fceb034b8d75b4c787e2" title=" " alt="" coords="185,375,368,401"/>
<area shape="rect" href="irq__comm_8c.html#a6270cddb139f2ca4f42d21f8caaa1224" title=" " alt="" coords="210,425,343,452"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="241,476,312,503"/>
<area shape="rect" href="lapic_8c.html#adb63e5a650d4571316b450d153a3105d" title=" " alt="" coords="416,233,584,260"/>
<area shape="rect" href="lapic_8h.html#ae7e74fde3e4fb01f561634e789b5eab4" title=" " alt="" coords="429,375,571,401"/>
<area shape="rect" href="lapic_8c.html#a8620b1c89f8cf017f7827024fc95ac92" title=" " alt="" coords="428,430,572,471"/>
<area shape="rect" href="lapic_8c.html#a870119cb74033f360164df90029af75a" title=" " alt="" coords="638,81,857,108"/>
<area shape="rect" href="lapic_8c.html#ae8c127c0d736bacbfa2cdc6b3fd5c2f6" title=" " alt="" coords="632,208,863,235"/>
<area shape="rect" href="lapic_8c.html#a8fb87d02d911e49b5793e391702afe7e" title=" " alt="" coords="687,284,808,311"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1201,157,1344,184"/>
<area shape="rect" href="lapic_8c.html#a98bde25094c754b30e796357ba643ab0" title=" " alt="" coords="950,107,1106,133"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="955,5,1101,32"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1193,5,1352,32"/>
<area shape="rect" href="lapic_8c.html#a8bdd67ff70db633e45cce412fb4c7718" title=" " alt="" coords="968,208,1088,235"/>
<area shape="rect" href="lapic_8h.html#a4f07303d20a06eeb408d4985c5e15096" title=" " alt="" coords="972,259,1084,285"/>
<area shape="rect" href="lapic_8h.html#a1d8660ecbda996b11b10b179013e52d4" title=" " alt="" coords="662,349,833,376"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="688,400,807,427"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="655,495,839,537"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="937,360,1119,387"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="935,411,1121,453"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="923,477,1133,504"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="911,528,1145,555"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="931,579,1125,605"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="949,630,1107,671"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="947,696,1109,723"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a24f70312b475fe0e0858ee3cc7e3af71_icgraph.png" border="0" usemap="#aavic_8c_a24f70312b475fe0e0858ee3cc7e3af71_icgraph" alt=""/></div>
<map name="aavic_8c_a24f70312b475fe0e0858ee3cc7e3af71_icgraph" id="aavic_8c_a24f70312b475fe0e0858ee3cc7e3af71_icgraph">
<area shape="rect" title=" " alt="" coords="203,5,335,32"/>
<area shape="rect" href="avic_8c.html#a3a8b145ddec7a3dc1367a4e4e0df397e" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a9c7db7e1cb25acd53eb51e777934c9e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c7db7e1cb25acd53eb51e777934c9e8">&#9670;&nbsp;</a></span>is_avic_unaccelerated_access_trap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool is_avic_unaccelerated_access_trap </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>offset</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00664">664</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;{</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">switch</span> (offset) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">case</span> APIC_ID:</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">case</span> APIC_EOI:</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">case</span> APIC_RRR:</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">case</span> APIC_LDR:</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">case</span> APIC_DFR:</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordflow">case</span> APIC_SPIV:</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">case</span> APIC_ESR:</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">case</span> APIC_ICR:</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">case</span> APIC_LVTT:</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">case</span> APIC_LVTTHMR:</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">case</span> APIC_LVTPC:</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">case</span> APIC_LVT0:</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">case</span> APIC_LVT1:</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">case</span> APIC_LVTERR:</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">case</span> APIC_TMICT:</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">case</span> APIC_TDCR:</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    }</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a9c7db7e1cb25acd53eb51e777934c9e8_icgraph.png" border="0" usemap="#aavic_8c_a9c7db7e1cb25acd53eb51e777934c9e8_icgraph" alt=""/></div>
<map name="aavic_8c_a9c7db7e1cb25acd53eb51e777934c9e8_icgraph" id="aavic_8c_a9c7db7e1cb25acd53eb51e777934c9e8_icgraph">
<area shape="rect" title=" " alt="" coords="212,5,379,47"/>
<area shape="rect" href="avic_8c.html#a299de3990a5ce5ce873df7afe2b3338f" title=" " alt="" coords="5,5,164,47"/>
</map>
</div>

</div>
</div>
<a id="a6a50d2e2e091254aac3982a50360a8ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a50d2e2e091254aac3982a50360a8ba">&#9670;&nbsp;</a></span>module_param_unsafe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_param_unsafe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="avic_8c.html#a969a7c5f37696d459ce0a2065a8ca97f">force_avic</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">0444&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0262c9f1d0d537dafa962ca68a873378"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0262c9f1d0d537dafa962ca68a873378">&#9670;&nbsp;</a></span>svm_ir_list_add()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int svm_ir_list_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *&#160;</td>
          <td class="paramname"><em>svm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct amd_iommu_pi_data *&#160;</td>
          <td class="paramname"><em>pi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>In some cases, the existing irte is updated and re-set, so we need to check here if it's already been * added to the ir_list.</p>
<p>Allocating new amd_iommu_pi_data, which will get add to the per-vcpu ir_list.</p>

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00792">792</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;{</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keyword">struct </span><a class="code" href="structamd__svm__iommu__ir.html">amd_svm_iommu_ir</a> *ir;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    u64 entry;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">     * In some cases, the existing irte is updated and re-set,</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">     * so we need to check here if it&#39;s already been * added</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">     * to the ir_list.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keywordflow">if</span> (pi-&gt;ir_data &amp;&amp; (pi-&gt;prev_ga_tag != 0)) {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keyword">struct </span>kvm *kvm = svm-&gt;<a class="code" href="structvcpu__svm.html#af164d8d741d9ea90dae6a46974d29f9e">vcpu</a>.kvm;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        u32 vcpu_id = <a class="code" href="avic_8c.html#a379bb93a0924b7a44f0fa7cdd37517b1">AVIC_GATAG_TO_VCPUID</a>(pi-&gt;prev_ga_tag);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keyword">struct </span>kvm_vcpu *prev_vcpu = kvm_get_vcpu_by_id(kvm, vcpu_id);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keyword">struct </span><a class="code" href="structvcpu__svm.html">vcpu_svm</a> *prev_svm;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="keywordflow">if</span> (!prev_vcpu) {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            ret = -EINVAL;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        prev_svm = <a class="code" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7">to_svm</a>(prev_vcpu);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <a class="code" href="avic_8c.html#a0573329bfb8b7a1a2ba0a4e2ce438dfa">svm_ir_list_del</a>(prev_svm, pi);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">     * Allocating new amd_iommu_pi_data, which will get</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">     * add to the per-vcpu ir_list.</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    ir = kzalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structamd__svm__iommu__ir.html">amd_svm_iommu_ir</a>), GFP_KERNEL_ACCOUNT);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">if</span> (!ir) {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        ret = -ENOMEM;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    ir-&gt;<a class="code" href="structamd__svm__iommu__ir.html#ad1d0011f27de4fbde266e0ce65476e84">data</a> = pi-&gt;ir_data;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    spin_lock_irqsave(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">     * Update the target pCPU for IOMMU doorbells if the vCPU is running.</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">     * If the vCPU is NOT running, i.e. is blocking or scheduled out, KVM</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">     * will update the pCPU info when the vCPU awkened and/or scheduled in.</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">     * See also avic_vcpu_load().</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    entry = READ_ONCE(*(svm-&gt;<a class="code" href="structvcpu__svm.html#abc377a3a5f1f42e18f8a9044321f3d5b">avic_physical_id_cache</a>));</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">if</span> (entry &amp; AVIC_PHYSICAL_ID_ENTRY_IS_RUNNING_MASK)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        amd_iommu_update_ga(entry &amp; AVIC_PHYSICAL_ID_ENTRY_HOST_PHYSICAL_ID_MASK,</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                    <span class="keyword">true</span>, pi-&gt;ir_data);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    list_add(&amp;ir-&gt;<a class="code" href="structamd__svm__iommu__ir.html#a54d6bf7341caaad5d37469694a4bd434">node</a>, &amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af217181f505db1b71c48743233032539">ir_list</a>);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    spin_unlock_irqrestore(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;out:</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;}</div>
<div class="ttc" id="astructamd__svm__iommu__ir_html_a54d6bf7341caaad5d37469694a4bd434"><div class="ttname"><a href="structamd__svm__iommu__ir.html#a54d6bf7341caaad5d37469694a4bd434">amd_svm_iommu_ir::node</a></div><div class="ttdeci">struct list_head node</div><div class="ttdef"><b>Definition:</b> <a href="avic_8c_source.html#l01188">avic.c:81</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a0262c9f1d0d537dafa962ca68a873378_cgraph.png" border="0" usemap="#aavic_8c_a0262c9f1d0d537dafa962ca68a873378_cgraph" alt=""/></div>
<map name="aavic_8c_a0262c9f1d0d537dafa962ca68a873378_cgraph" id="aavic_8c_a0262c9f1d0d537dafa962ca68a873378_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,129,57"/>
<area shape="rect" href="avic_8c.html#a0573329bfb8b7a1a2ba0a4e2ce438dfa" title=" " alt="" coords="177,5,297,32"/>
<area shape="rect" href="svm_8h.html#a83e420c88631faf9613ea3caa72c63b7" title=" " alt="" coords="202,56,273,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a0262c9f1d0d537dafa962ca68a873378_icgraph.png" border="0" usemap="#aavic_8c_a0262c9f1d0d537dafa962ca68a873378_icgraph" alt=""/></div>
<map name="aavic_8c_a0262c9f1d0d537dafa962ca68a873378_icgraph" id="aavic_8c_a0262c9f1d0d537dafa962ca68a873378_icgraph">
<area shape="rect" title=" " alt="" coords="203,5,327,32"/>
<area shape="rect" href="avic_8c.html#a3a8b145ddec7a3dc1367a4e4e0df397e" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a0573329bfb8b7a1a2ba0a4e2ce438dfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0573329bfb8b7a1a2ba0a4e2ce438dfa">&#9670;&nbsp;</a></span>svm_ir_list_del()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void svm_ir_list_del </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvcpu__svm.html">vcpu_svm</a> *&#160;</td>
          <td class="paramname"><em>svm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct amd_iommu_pi_data *&#160;</td>
          <td class="paramname"><em>pi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00776">776</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;{</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keyword">struct </span><a class="code" href="structamd__svm__iommu__ir.html">amd_svm_iommu_ir</a> *cur;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    spin_lock_irqsave(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    list_for_each_entry(cur, &amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af217181f505db1b71c48743233032539">ir_list</a>, <a class="code" href="structamd__svm__iommu__ir.html#a54d6bf7341caaad5d37469694a4bd434">node</a>) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structamd__svm__iommu__ir.html#ad1d0011f27de4fbde266e0ce65476e84">data</a> != pi-&gt;ir_data)</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        list_del(&amp;cur-&gt;<a class="code" href="structamd__svm__iommu__ir.html#a54d6bf7341caaad5d37469694a4bd434">node</a>);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        kfree(cur);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    spin_unlock_irqrestore(&amp;svm-&gt;<a class="code" href="structvcpu__svm.html#af38f3c63a81a10aae69b308aa175d618">ir_list_lock</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="avic_8c_a0573329bfb8b7a1a2ba0a4e2ce438dfa_icgraph.png" border="0" usemap="#aavic_8c_a0573329bfb8b7a1a2ba0a4e2ce438dfa_icgraph" alt=""/></div>
<map name="aavic_8c_a0573329bfb8b7a1a2ba0a4e2ce438dfa_icgraph" id="aavic_8c_a0573329bfb8b7a1a2ba0a4e2ce438dfa_icgraph">
<area shape="rect" title=" " alt="" coords="375,5,495,32"/>
<area shape="rect" href="avic_8c.html#a3a8b145ddec7a3dc1367a4e4e0df397e" title=" " alt="" coords="5,5,155,32"/>
<area shape="rect" href="avic_8c.html#a0262c9f1d0d537dafa962ca68a873378" title=" " alt="" coords="203,31,327,57"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a969a7c5f37696d459ce0a2065a8ca97f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a969a7c5f37696d459ce0a2065a8ca97f">&#9670;&nbsp;</a></span>force_avic</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool force_avic</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00062">62</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="aebb4737cca7862427a4b94f3f086dee3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebb4737cca7862427a4b94f3f086dee3">&#9670;&nbsp;</a></span>next_vm_id</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">u32 next_vm_id = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00072">72</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="a1e123c3defad20a133e56f43373b9c44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e123c3defad20a133e56f43373b9c44">&#9670;&nbsp;</a></span>next_vm_id_wrapped</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool next_vm_id_wrapped = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00073">73</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
<a id="ad4c0ba70ab315cedbb11f259b1d7ae08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4c0ba70ab315cedbb11f259b1d7ae08">&#9670;&nbsp;</a></span>x2avic_enabled</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool x2avic_enabled</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="avic_8c_source.html#l00075">75</a> of file <a class="el" href="avic_8c_source.html">avic.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
