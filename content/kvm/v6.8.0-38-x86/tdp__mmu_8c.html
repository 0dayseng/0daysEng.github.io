<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/x86/kvm/mmu/tdp_mmu.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_c21774f8bc9f0de15163573e5f5fa2b5.html">x86</a></li><li class="navelem"><a class="el" href="dir_fde450fd4b58e2560c53a1e73bfa4d6d.html">kvm</a></li><li class="navelem"><a class="el" href="dir_5b5419bab78eb3e26ed0c43edf6fed27.html">mmu</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tdp_mmu.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="mmu_8h_source.html">mmu.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mmu__internal_8h_source.html">mmu_internal.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mmutrace_8h_source.html">mmutrace.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tdp__iter_8h_source.html">tdp_iter.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tdp__mmu_8h_source.html">tdp_mmu.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="spte_8h_source.html">spte.h</a>&quot;</code><br />
<code>#include &lt;asm/cmpxchg.h&gt;</code><br />
<code>#include &lt;trace/events/kvm.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for tdp_mmu.c:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c__incl.png" border="0" usemap="#aarch_2x86_2kvm_2mmu_2tdp__mmu_8c" alt=""/></div>
<map name="aarch_2x86_2kvm_2mmu_2tdp__mmu_8c" id="aarch_2x86_2kvm_2mmu_2tdp__mmu_8c">
<area shape="rect" title=" " alt="" coords="1633,5,1808,47"/>
<area shape="rect" href="mmu_8h.html" title=" " alt="" coords="1343,244,1411,271"/>
<area shape="rect" href="mmu__internal_8h.html" title=" " alt="" coords="1554,244,1679,271"/>
<area shape="rect" href="mmutrace_8h.html" title=" " alt="" coords="1810,95,1911,121"/>
<area shape="rect" href="tdp__iter_8h.html" title=" " alt="" coords="1446,95,1529,121"/>
<area shape="rect" href="spte_8h.html" title=" " alt="" coords="1561,169,1624,196"/>
<area shape="rect" href="tdp__mmu_8h.html" title=" " alt="" coords="1630,95,1726,121"/>
<area shape="rect" title=" " alt="" coords="1935,95,2061,121"/>
<area shape="rect" title=" " alt="" coords="2085,95,2233,121"/>
<area shape="rect" title=" " alt="" coords="1341,543,1476,569"/>
<area shape="rect" href="kvm__cache__regs_8h.html" title=" " alt="" coords="1283,468,1425,495"/>
<area shape="rect" href="cpuid_8h.html" title=" " alt="" coords="997,319,1066,345"/>
<area shape="rect" href="x86_8h.html" title=" " alt="" coords="870,393,929,420"/>
<area shape="rect" href="reverse__cpuid_8h.html" title=" " alt="" coords="245,393,370,420"/>
<area shape="rect" title=" " alt="" coords="1133,393,1223,420"/>
<area shape="rect" title=" " alt="" coords="1247,393,1375,420"/>
<area shape="rect" title=" " alt="" coords="683,393,846,420"/>
<area shape="rect" href="governed__features_8h.html" title=" " alt="" coords="953,393,1109,420"/>
<area shape="rect" title=" " alt="" coords="937,468,1069,495"/>
<area shape="rect" title=" " alt="" coords="1093,468,1188,495"/>
<area shape="rect" title=" " alt="" coords="745,468,861,495"/>
<area shape="rect" href="kvm__emulate_8h.html" title=" " alt="" coords="484,468,608,495"/>
<area shape="rect" title=" " alt="" coords="539,543,670,569"/>
<area shape="rect" href="fpu_8h.html" title=" " alt="" coords="460,543,515,569"/>
<area shape="rect" title=" " alt="" coords="432,617,543,644"/>
<area shape="rect" title=" " alt="" coords="5,468,132,495"/>
<area shape="rect" title=" " alt="" coords="157,468,293,495"/>
<area shape="rect" title=" " alt="" coords="317,468,460,495"/>
<area shape="rect" title=" " alt="" coords="1706,319,1813,345"/>
<area shape="rect" title=" " alt="" coords="1551,319,1682,345"/>
<area shape="rect" title=" " alt="" coords="1801,169,1937,196"/>
<area shape="rect" title=" " alt="" coords="1961,169,2115,196"/>
<area shape="rect" title=" " alt="" coords="2140,169,2291,196"/>
</map>
</div>
</div>
<p><a href="tdp__mmu_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1f8c165bf4196327bc3abff648276d92"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a1f8c165bf4196327bc3abff648276d92">pr_fmt</a>(fmt)&#160;&#160;&#160;KBUILD_MODNAME &quot;: &quot; fmt</td></tr>
<tr class="separator:a1f8c165bf4196327bc3abff648276d92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9d1583c53d0b2660327c4dea8fae4e3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ab9d1583c53d0b2660327c4dea8fae4e3">__for_each_tdp_mmu_root_yield_safe</a>(_kvm,  _root,  _as_id,  _only_valid)</td></tr>
<tr class="separator:ab9d1583c53d0b2660327c4dea8fae4e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c960568750483d675f0f994ac033a41"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a3c960568750483d675f0f994ac033a41">for_each_valid_tdp_mmu_root_yield_safe</a>(_kvm,  _root,  _as_id)&#160;&#160;&#160;	<a class="el" href="tdp__mmu_8c.html#ab9d1583c53d0b2660327c4dea8fae4e3">__for_each_tdp_mmu_root_yield_safe</a>(_kvm, _root, _as_id, true)</td></tr>
<tr class="separator:a3c960568750483d675f0f994ac033a41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a380373dbae26c3723631c3eebccf47db"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a380373dbae26c3723631c3eebccf47db">for_each_tdp_mmu_root_yield_safe</a>(_kvm,  _root)</td></tr>
<tr class="separator:a380373dbae26c3723631c3eebccf47db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80ff30c938358003552a2b48063b0fee"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a80ff30c938358003552a2b48063b0fee">for_each_tdp_mmu_root</a>(_kvm,  _root,  _as_id)</td></tr>
<tr class="separator:a80ff30c938358003552a2b48063b0fee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8f1376ead11b676fb3cf0e3d26f6464"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#af8f1376ead11b676fb3cf0e3d26f6464">tdp_root_for_each_pte</a>(_iter,  _root,  _start,  _end)&#160;&#160;&#160;	<a class="el" href="tdp__iter_8h.html#a83c970d2555495599eb8e75e3ced770f">for_each_tdp_pte</a>(_iter, _root, _start, _end)</td></tr>
<tr class="separator:af8f1376ead11b676fb3cf0e3d26f6464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05d1e6fdfa42b23ebcea4b55ff41256d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a05d1e6fdfa42b23ebcea4b55ff41256d">tdp_root_for_each_leaf_pte</a>(_iter,  _root,  _start,  _end)</td></tr>
<tr class="separator:a05d1e6fdfa42b23ebcea4b55ff41256d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9784c3e281a9a5a1c7fe6ea1f806e8f2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a9784c3e281a9a5a1c7fe6ea1f806e8f2">tdp_mmu_for_each_pte</a>(_iter,  _mmu,  _start,  _end)&#160;&#160;&#160;	<a class="el" href="tdp__iter_8h.html#a83c970d2555495599eb8e75e3ced770f">for_each_tdp_pte</a>(_iter, <a class="el" href="spte_8h.html#ab169c1872e98b9731a05121e0439f244">root_to_sp</a>(_mmu-&gt;root.hpa), _start, _end)</td></tr>
<tr class="separator:a9784c3e281a9a5a1c7fe6ea1f806e8f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a23cd686f18bfd24a24a5d89c25b74385"><td class="memItemLeft" align="right" valign="top">typedef bool(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a23cd686f18bfd24a24a5d89c25b74385">tdp_handler_t</a>) (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:a23cd686f18bfd24a24a5d89c25b74385"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab7552e1b0abe0e2ddb3f91e3f002d9d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ab7552e1b0abe0e2ddb3f91e3f002d9d9">kvm_mmu_init_tdp_mmu</a> (struct kvm *kvm)</td></tr>
<tr class="separator:ab7552e1b0abe0e2ddb3f91e3f002d9d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94f5586dfab1d77897564b4b4979da48"><td class="memItemLeft" align="right" valign="top">static __always_inline bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48">kvm_lockdep_assert_mmu_lock_held</a> (struct kvm *kvm, bool shared)</td></tr>
<tr class="separator:a94f5586dfab1d77897564b4b4979da48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73432bf42fbb3d43b3e04f88cd92b592"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592">kvm_mmu_uninit_tdp_mmu</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a73432bf42fbb3d43b3e04f88cd92b592"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afab0b8fc9210a8e1190a153f664ef78b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b">tdp_mmu_free_sp</a> (struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp)</td></tr>
<tr class="separator:afab0b8fc9210a8e1190a153f664ef78b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92b80ecd9f7bf033d7ed2f28fb0a1279"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279">tdp_mmu_free_sp_rcu_callback</a> (struct rcu_head *head)</td></tr>
<tr class="separator:a92b80ecd9f7bf033d7ed2f28fb0a1279"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a9d637b546d8dfd125028f823a6eac0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0">kvm_tdp_mmu_put_root</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root)</td></tr>
<tr class="separator:a8a9d637b546d8dfd125028f823a6eac0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d434b3d8d515d7e4c585ae3aa7e15fa"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a5d434b3d8d515d7e4c585ae3aa7e15fa">tdp_mmu_next_root</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *prev_root, bool only_valid)</td></tr>
<tr class="separator:a5d434b3d8d515d7e4c585ae3aa7e15fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab91e6aa4615cd9bf4f66141ca34642b"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aab91e6aa4615cd9bf4f66141ca34642b">tdp_mmu_alloc_sp</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aab91e6aa4615cd9bf4f66141ca34642b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d6f094dd9ef458c1c57aee653afd602"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a8d6f094dd9ef458c1c57aee653afd602">tdp_mmu_init_sp</a> (struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp, <a class="el" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a> sptep, gfn_t gfn, union kvm_mmu_page_role role)</td></tr>
<tr class="separator:a8d6f094dd9ef458c1c57aee653afd602"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a502cd8b971218c38ecd999409fc15ee3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a502cd8b971218c38ecd999409fc15ee3">tdp_mmu_init_child_sp</a> (struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *child_sp, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter)</td></tr>
<tr class="separator:a502cd8b971218c38ecd999409fc15ee3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae643f902f826e920f4150bb66872fd47"><td class="memItemLeft" align="right" valign="top">hpa_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ae643f902f826e920f4150bb66872fd47">kvm_tdp_mmu_get_vcpu_root_hpa</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ae643f902f826e920f4150bb66872fd47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95692dd1daa13effa90e042a8a7057af"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af">handle_changed_spte</a> (struct kvm *kvm, int as_id, gfn_t gfn, u64 old_spte, u64 new_spte, int level, bool shared)</td></tr>
<tr class="separator:a95692dd1daa13effa90e042a8a7057af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5217224e4957f6457786d51ddd62914b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a5217224e4957f6457786d51ddd62914b">tdp_account_mmu_page</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp)</td></tr>
<tr class="separator:a5217224e4957f6457786d51ddd62914b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0003da5596a964166d5e46389e7cf4b3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3">tdp_unaccount_mmu_page</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp)</td></tr>
<tr class="separator:a0003da5596a964166d5e46389e7cf4b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a401c07c0503d3fc2c62b9a8a06096686"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686">tdp_mmu_unlink_sp</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp)</td></tr>
<tr class="separator:a401c07c0503d3fc2c62b9a8a06096686"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac509299bc28d3b827578915abdb2280e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e">handle_removed_pt</a> (struct kvm *kvm, <a class="el" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a> pt, bool shared)</td></tr>
<tr class="separator:ac509299bc28d3b827578915abdb2280e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a692eb9d20075258e5d4a0e4289a7c9b6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6">tdp_mmu_set_spte_atomic</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, u64 new_spte)</td></tr>
<tr class="separator:a692eb9d20075258e5d4a0e4289a7c9b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab901a77cd00a4e809baa9a25e289b59d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d">tdp_mmu_zap_spte_atomic</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter)</td></tr>
<tr class="separator:ab901a77cd00a4e809baa9a25e289b59d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1880e056251c1743579f5c7a25ccad1a"><td class="memItemLeft" align="right" valign="top">static u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a">tdp_mmu_set_spte</a> (struct kvm *kvm, int as_id, <a class="el" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a> sptep, u64 old_spte, u64 new_spte, gfn_t gfn, int level)</td></tr>
<tr class="separator:a1880e056251c1743579f5c7a25ccad1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6444812b70d9509539a3fa478cde14d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d">tdp_mmu_iter_set_spte</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, u64 new_spte)</td></tr>
<tr class="separator:af6444812b70d9509539a3fa478cde14d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc2d73db35961f670cedf8ce1206c4d2"><td class="memItemLeft" align="right" valign="top">static bool __must_check&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2">tdp_mmu_iter_cond_resched</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, bool flush, bool shared)</td></tr>
<tr class="separator:abc2d73db35961f670cedf8ce1206c4d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac323268ae26fde5a608d694f4943d476"><td class="memItemLeft" align="right" valign="top">static gfn_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476">tdp_mmu_max_gfn_exclusive</a> (void)</td></tr>
<tr class="separator:ac323268ae26fde5a608d694f4943d476"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9c34fae0b7eac63cc78a01882498cfb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb">__tdp_mmu_zap_root</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root, bool shared, int zap_level)</td></tr>
<tr class="separator:af9c34fae0b7eac63cc78a01882498cfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95955e5f31399228d6a722fba5a81477"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477">tdp_mmu_zap_root</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root, bool shared)</td></tr>
<tr class="separator:a95955e5f31399228d6a722fba5a81477"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a381e22ee819864cf1fd726479a76b6c7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a381e22ee819864cf1fd726479a76b6c7">kvm_tdp_mmu_zap_sp</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp)</td></tr>
<tr class="separator:a381e22ee819864cf1fd726479a76b6c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a182ff449fd87f9503148e88c33cff5ac"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac">tdp_mmu_zap_leafs</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root, gfn_t start, gfn_t end, bool can_yield, bool flush)</td></tr>
<tr class="separator:a182ff449fd87f9503148e88c33cff5ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4fb1a66a2bc67f8699e8ddafdd4b1e8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8">kvm_tdp_mmu_zap_leafs</a> (struct kvm *kvm, gfn_t start, gfn_t end, bool flush)</td></tr>
<tr class="separator:aa4fb1a66a2bc67f8699e8ddafdd4b1e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca0f6025bf55596c80647e3a35997d92"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92">kvm_tdp_mmu_zap_all</a> (struct kvm *kvm)</td></tr>
<tr class="separator:aca0f6025bf55596c80647e3a35997d92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ab26f4fb05f388d8bcf04ad89ee6797"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797">kvm_tdp_mmu_zap_invalidated_roots</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a8ab26f4fb05f388d8bcf04ad89ee6797"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4bbd5785998945455f358b7cd9bbafa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ab4bbd5785998945455f358b7cd9bbafa">kvm_tdp_mmu_invalidate_all_roots</a> (struct kvm *kvm)</td></tr>
<tr class="separator:ab4bbd5785998945455f358b7cd9bbafa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa98226578ebe207e97e262a86bbd5427"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427">tdp_mmu_map_handle_target_level</a> (struct kvm_vcpu *vcpu, struct <a class="el" href="structkvm__page__fault.html">kvm_page_fault</a> *fault, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter)</td></tr>
<tr class="separator:aa98226578ebe207e97e262a86bbd5427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6588b054500f580603f94c0555fe3c06"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06">tdp_mmu_link_sp</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp, bool shared)</td></tr>
<tr class="separator:a6588b054500f580603f94c0555fe3c06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf7d062eca8e6190d76f4934c290be61"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61">tdp_mmu_split_huge_page</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp, bool shared)</td></tr>
<tr class="separator:acf7d062eca8e6190d76f4934c290be61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2479228afe629631e4f0331c440a4d6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6">kvm_tdp_mmu_map</a> (struct kvm_vcpu *vcpu, struct <a class="el" href="structkvm__page__fault.html">kvm_page_fault</a> *fault)</td></tr>
<tr class="separator:ad2479228afe629631e4f0331c440a4d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa8f0898db08dd5c9213ac2f8b355501"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501">kvm_tdp_mmu_unmap_gfn_range</a> (struct kvm *kvm, struct kvm_gfn_range *range, bool flush)</td></tr>
<tr class="separator:aaa8f0898db08dd5c9213ac2f8b355501"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee4308cb9e1b221fb73c67c6e8f0e1d1"><td class="memItemLeft" align="right" valign="top">static __always_inline bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aee4308cb9e1b221fb73c67c6e8f0e1d1">kvm_tdp_mmu_handle_gfn</a> (struct kvm *kvm, struct kvm_gfn_range *range, <a class="el" href="tdp__mmu_8c.html#a23cd686f18bfd24a24a5d89c25b74385">tdp_handler_t</a> handler)</td></tr>
<tr class="separator:aee4308cb9e1b221fb73c67c6e8f0e1d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30ae563747c16580e9c760ea701eec6d"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a30ae563747c16580e9c760ea701eec6d">age_gfn_range</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:a30ae563747c16580e9c760ea701eec6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a5c7f827057100e08b2f45da804fa30"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a0a5c7f827057100e08b2f45da804fa30">kvm_tdp_mmu_age_gfn_range</a> (struct kvm *kvm, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:a0a5c7f827057100e08b2f45da804fa30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35969e29bbb017463732377231d536c4"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a35969e29bbb017463732377231d536c4">test_age_gfn</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:a35969e29bbb017463732377231d536c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78b4b5fbbd5f7b9fc997fef12a5ff92b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a78b4b5fbbd5f7b9fc997fef12a5ff92b">kvm_tdp_mmu_test_age_gfn</a> (struct kvm *kvm, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:a78b4b5fbbd5f7b9fc997fef12a5ff92b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01bf8752c61ddeae2878ef46d312e00c"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c">set_spte_gfn</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:a01bf8752c61ddeae2878ef46d312e00c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa53a75612d7b32153949be34f4055144"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aa53a75612d7b32153949be34f4055144">kvm_tdp_mmu_set_spte_gfn</a> (struct kvm *kvm, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:aa53a75612d7b32153949be34f4055144"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3e523e725021c7dd3f3796f4e074a37"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37">wrprot_gfn_range</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root, gfn_t start, gfn_t end, int min_level)</td></tr>
<tr class="separator:ae3e523e725021c7dd3f3796f4e074a37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f6c658f3ddf3ffac5ce96335b78e295"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a7f6c658f3ddf3ffac5ce96335b78e295">kvm_tdp_mmu_wrprot_slot</a> (struct kvm *kvm, const struct kvm_memory_slot *slot, int min_level)</td></tr>
<tr class="separator:a7f6c658f3ddf3ffac5ce96335b78e295"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef3c64f4319d3be908d23467dd8fb337"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aef3c64f4319d3be908d23467dd8fb337">__tdp_mmu_alloc_sp_for_split</a> (gfp_t gfp)</td></tr>
<tr class="separator:aef3c64f4319d3be908d23467dd8fb337"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa61edf11261db080cdd6b2bba981310f"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aa61edf11261db080cdd6b2bba981310f">tdp_mmu_alloc_sp_for_split</a> (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, bool shared)</td></tr>
<tr class="separator:aa61edf11261db080cdd6b2bba981310f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa070d8c089f8547cfc2dbafa856e99c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c">tdp_mmu_split_huge_pages_root</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root, gfn_t start, gfn_t end, int target_level, bool shared)</td></tr>
<tr class="separator:afa070d8c089f8547cfc2dbafa856e99c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57310f6ad7e70c13dadcfd30aa71af6d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d">kvm_tdp_mmu_try_split_huge_pages</a> (struct kvm *kvm, const struct kvm_memory_slot *slot, gfn_t start, gfn_t end, int target_level, bool shared)</td></tr>
<tr class="separator:a57310f6ad7e70c13dadcfd30aa71af6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d2a2606fb90f6b6e1a2559d12c04ee8"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a8d2a2606fb90f6b6e1a2559d12c04ee8">tdp_mmu_need_write_protect</a> (struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp)</td></tr>
<tr class="separator:a8d2a2606fb90f6b6e1a2559d12c04ee8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9da9e7ba01717f85966fc080e86ecb84"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84">clear_dirty_gfn_range</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root, gfn_t start, gfn_t end)</td></tr>
<tr class="separator:a9da9e7ba01717f85966fc080e86ecb84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a670804848ccec53148d097c06b44657c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c">kvm_tdp_mmu_clear_dirty_slot</a> (struct kvm *kvm, const struct kvm_memory_slot *slot)</td></tr>
<tr class="separator:a670804848ccec53148d097c06b44657c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a302b8c57cfb6b9bc82a2f68047477145"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a302b8c57cfb6b9bc82a2f68047477145">clear_dirty_pt_masked</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root, gfn_t gfn, unsigned long mask, bool wrprot)</td></tr>
<tr class="separator:a302b8c57cfb6b9bc82a2f68047477145"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1753c27bb053bc6ac3a3893e10b49f6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ad1753c27bb053bc6ac3a3893e10b49f6">kvm_tdp_mmu_clear_dirty_pt_masked</a> (struct kvm *kvm, struct kvm_memory_slot *slot, gfn_t gfn, unsigned long mask, bool wrprot)</td></tr>
<tr class="separator:ad1753c27bb053bc6ac3a3893e10b49f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac72a38de4d0b8a5cfeace82f10cc4caf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf">zap_collapsible_spte_range</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root, const struct kvm_memory_slot *slot)</td></tr>
<tr class="separator:ac72a38de4d0b8a5cfeace82f10cc4caf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a86994ba17144f60df37ea7682d650b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a3a86994ba17144f60df37ea7682d650b">kvm_tdp_mmu_zap_collapsible_sptes</a> (struct kvm *kvm, const struct kvm_memory_slot *slot)</td></tr>
<tr class="separator:a3a86994ba17144f60df37ea7682d650b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa07f9d272e2404a5b5392ae7aa175580"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580">write_protect_gfn</a> (struct kvm *kvm, struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root, gfn_t gfn, int min_level)</td></tr>
<tr class="separator:aa07f9d272e2404a5b5392ae7aa175580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45fd618d35fb0df14a3401a230f41faa"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a45fd618d35fb0df14a3401a230f41faa">kvm_tdp_mmu_write_protect_gfn</a> (struct kvm *kvm, struct kvm_memory_slot *slot, gfn_t gfn, int min_level)</td></tr>
<tr class="separator:a45fd618d35fb0df14a3401a230f41faa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a34a882b3a9c5607394395bc988b804"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#a9a34a882b3a9c5607394395bc988b804">kvm_tdp_mmu_get_walk</a> (struct kvm_vcpu *vcpu, u64 addr, u64 *sptes, int *root_level)</td></tr>
<tr class="separator:a9a34a882b3a9c5607394395bc988b804"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab831f739cbe511803c4752d84ffab75c"><td class="memItemLeft" align="right" valign="top">u64 *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tdp__mmu_8c.html#ab831f739cbe511803c4752d84ffab75c">kvm_tdp_mmu_fast_pf_get_last_sptep</a> (struct kvm_vcpu *vcpu, u64 addr, u64 *spte)</td></tr>
<tr class="separator:ab831f739cbe511803c4752d84ffab75c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ab9d1583c53d0b2660327c4dea8fae4e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab9d1583c53d0b2660327c4dea8fae4e3">&#9670;&nbsp;</a></span>__for_each_tdp_mmu_root_yield_safe</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __for_each_tdp_mmu_root_yield_safe</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_kvm, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_root, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_as_id, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_only_valid&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">for</span> (_root = <a class="code" href="tdp__mmu_8c.html#a5d434b3d8d515d7e4c585ae3aa7e15fa">tdp_mmu_next_root</a>(_kvm, NULL, _only_valid);    \</div>
<div class="line">         ({ lockdep_assert_held(&amp;(_kvm)-&gt;mmu_lock); }), _root;  \</div>
<div class="line">         _root = <a class="code" href="tdp__mmu_8c.html#a5d434b3d8d515d7e4c585ae3aa7e15fa">tdp_mmu_next_root</a>(_kvm, _root, _only_valid))   \</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79">kvm_mmu_page_as_id</a>(_root) != _as_id) {      \</div>
<div class="line">        } <span class="keywordflow">else</span></div>
<div class="ttc" id="ammu__internal_8h_html_a993d31328977f0bf21610ad74fa55a79"><div class="ttname"><a href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79">kvm_mmu_page_as_id</a></div><div class="ttdeci">static int kvm_mmu_page_as_id(struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00143">mmu_internal.h:143</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a5d434b3d8d515d7e4c585ae3aa7e15fa"><div class="ttname"><a href="tdp__mmu_8c.html#a5d434b3d8d515d7e4c585ae3aa7e15fa">tdp_mmu_next_root</a></div><div class="ttdeci">static struct kvm_mmu_page * tdp_mmu_next_root(struct kvm *kvm, struct kvm_mmu_page *prev_root, bool only_valid)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00104">tdp_mmu.c:104</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00152">152</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>

</div>
</div>
<a id="a80ff30c938358003552a2b48063b0fee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80ff30c938358003552a2b48063b0fee">&#9670;&nbsp;</a></span>for_each_tdp_mmu_root</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define for_each_tdp_mmu_root</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_kvm, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_root, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_as_id&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    list_for_each_entry(_root, &amp;_kvm-&gt;arch.tdp_mmu_roots, link) \</div>
<div class="line">        if (<a class="code" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48">kvm_lockdep_assert_mmu_lock_held</a>(_kvm, <span class="keyword">false</span>) &amp;&amp;    \</div>
<div class="line">            <a class="code" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79">kvm_mmu_page_as_id</a>(_root) != _as_id) {      \</div>
<div class="line">        } <span class="keywordflow">else</span></div>
<div class="ttc" id="atdp__mmu_8c_html_a94f5586dfab1d77897564b4b4979da48"><div class="ttname"><a href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48">kvm_lockdep_assert_mmu_lock_held</a></div><div class="ttdeci">static __always_inline bool kvm_lockdep_assert_mmu_lock_held(struct kvm *kvm, bool shared)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00022">tdp_mmu.c:22</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00174">174</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>

</div>
</div>
<a id="a380373dbae26c3723631c3eebccf47db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a380373dbae26c3723631c3eebccf47db">&#9670;&nbsp;</a></span>for_each_tdp_mmu_root_yield_safe</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define for_each_tdp_mmu_root_yield_safe</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_kvm, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_root&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">for</span> (_root = <a class="code" href="tdp__mmu_8c.html#a5d434b3d8d515d7e4c585ae3aa7e15fa">tdp_mmu_next_root</a>(_kvm, NULL, <span class="keyword">false</span>);      \</div>
<div class="line">         ({ lockdep_assert_held(&amp;(_kvm)-&gt;mmu_lock); }), _root;  \</div>
<div class="line">         _root = <a class="code" href="tdp__mmu_8c.html#a5d434b3d8d515d7e4c585ae3aa7e15fa">tdp_mmu_next_root</a>(_kvm, _root, <span class="keyword">false</span>))</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00162">162</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>

</div>
</div>
<a id="a3c960568750483d675f0f994ac033a41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c960568750483d675f0f994ac033a41">&#9670;&nbsp;</a></span>for_each_valid_tdp_mmu_root_yield_safe</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define for_each_valid_tdp_mmu_root_yield_safe</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_kvm, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_root, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_as_id&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;	<a class="el" href="tdp__mmu_8c.html#ab9d1583c53d0b2660327c4dea8fae4e3">__for_each_tdp_mmu_root_yield_safe</a>(_kvm, _root, _as_id, true)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00159">159</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>

</div>
</div>
<a id="a1f8c165bf4196327bc3abff648276d92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f8c165bf4196327bc3abff648276d92">&#9670;&nbsp;</a></span>pr_fmt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pr_fmt</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">fmt</td><td>)</td>
          <td>&#160;&#160;&#160;KBUILD_MODNAME &quot;: &quot; fmt</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00002">2</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>

</div>
</div>
<a id="a9784c3e281a9a5a1c7fe6ea1f806e8f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9784c3e281a9a5a1c7fe6ea1f806e8f2">&#9670;&nbsp;</a></span>tdp_mmu_for_each_pte</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define tdp_mmu_for_each_pte</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_iter, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_mmu, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_start, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_end&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;	<a class="el" href="tdp__iter_8h.html#a83c970d2555495599eb8e75e3ced770f">for_each_tdp_pte</a>(_iter, <a class="el" href="spte_8h.html#ab169c1872e98b9731a05121e0439f244">root_to_sp</a>(_mmu-&gt;root.hpa), _start, _end)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00631">631</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>

</div>
</div>
<a id="a05d1e6fdfa42b23ebcea4b55ff41256d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05d1e6fdfa42b23ebcea4b55ff41256d">&#9670;&nbsp;</a></span>tdp_root_for_each_leaf_pte</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define tdp_root_for_each_leaf_pte</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_iter, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_root, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_start, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_end&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <a class="code" href="tdp__mmu_8c.html#af8f1376ead11b676fb3cf0e3d26f6464">tdp_root_for_each_pte</a>(_iter, _root, _start, _end)       \</div>
<div class="line">        if (!<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(_iter.old_spte) ||       \</div>
<div class="line">            !<a class="code" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a>(_iter.old_spte, _iter.level))     \</div>
<div class="line">            continue;                   \</div>
<div class="line">        else</div>
<div class="ttc" id="aspte_8h_html_a785ce7507ac8cabfb2a667ed0c57b1f5"><div class="ttname"><a href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a></div><div class="ttdeci">static bool is_last_spte(u64 pte, int level)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00318">spte.h:318</a></div></div>
<div class="ttc" id="aspte_8h_html_a7d73c1cb0114320b9dab8ba78033c686"><div class="ttname"><a href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a></div><div class="ttdeci">static bool is_shadow_present_pte(u64 pte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00258">spte.h:258</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_af8f1376ead11b676fb3cf0e3d26f6464"><div class="ttname"><a href="tdp__mmu_8c.html#af8f1376ead11b676fb3cf0e3d26f6464">tdp_root_for_each_pte</a></div><div class="ttdeci">#define tdp_root_for_each_pte(_iter, _root, _start, _end)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00621">tdp_mmu.c:621</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00624">624</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>

</div>
</div>
<a id="af8f1376ead11b676fb3cf0e3d26f6464"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8f1376ead11b676fb3cf0e3d26f6464">&#9670;&nbsp;</a></span>tdp_root_for_each_pte</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define tdp_root_for_each_pte</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_iter, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_root, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_start, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_end&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;	<a class="el" href="tdp__iter_8h.html#a83c970d2555495599eb8e75e3ced770f">for_each_tdp_pte</a>(_iter, _root, _start, _end)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00621">621</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a23cd686f18bfd24a24a5d89c25b74385"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23cd686f18bfd24a24a5d89c25b74385">&#9670;&nbsp;</a></span>tdp_handler_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef bool(* tdp_handler_t) (struct kvm *kvm, struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *iter, struct kvm_gfn_range *range)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01126">1126</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aef3c64f4319d3be908d23467dd8fb337"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef3c64f4319d3be908d23467dd8fb337">&#9670;&nbsp;</a></span>__tdp_mmu_alloc_sp_for_split()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a>* __tdp_mmu_alloc_sp_for_split </td>
          <td>(</td>
          <td class="paramtype">gfp_t&#160;</td>
          <td class="paramname"><em>gfp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01315">1315</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;{</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160; </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    gfp |= __GFP_ZERO;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160; </div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    sp = kmem_cache_alloc(<a class="code" href="mmu_8c.html#a3634b84158ea95896b7dcbbb228c309c">mmu_page_header_cache</a>, gfp);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">if</span> (!sp)</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    sp-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a> = (<span class="keywordtype">void</span> *)__get_free_page(gfp);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keywordflow">if</span> (!sp-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a>) {</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        kmem_cache_free(<a class="code" href="mmu_8c.html#a3634b84158ea95896b7dcbbb228c309c">mmu_page_header_cache</a>, sp);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    }</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160; </div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordflow">return</span> sp;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a3634b84158ea95896b7dcbbb228c309c"><div class="ttname"><a href="mmu_8c.html#a3634b84158ea95896b7dcbbb228c309c">mmu_page_header_cache</a></div><div class="ttdeci">struct kmem_cache * mmu_page_header_cache</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00181">mmu.c:181</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html"><div class="ttname"><a href="structkvm__mmu__page.html">kvm_mmu_page</a></div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00052">mmu_internal.h:52</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a1bb8925c750e6b17d3a66a54c5df7c50"><div class="ttname"><a href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">kvm_mmu_page::spt</a></div><div class="ttdeci">u64 * spt</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00083">mmu_internal.h:83</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aef3c64f4319d3be908d23467dd8fb337_icgraph.png" border="0" usemap="#atdp__mmu_8c_aef3c64f4319d3be908d23467dd8fb337_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aef3c64f4319d3be908d23467dd8fb337_icgraph" id="atdp__mmu_8c_aef3c64f4319d3be908d23467dd8fb337_icgraph">
<area shape="rect" title=" " alt="" coords="3748,258,3907,299"/>
<area shape="rect" href="tdp__mmu_8c.html#aa61edf11261db080cdd6b2bba981310f" title=" " alt="" coords="3531,258,3700,299"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="3324,258,3483,299"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="3096,258,3276,299"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2861,225,3044,266"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2857,290,3048,331"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2637,225,2803,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2377,225,2583,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2111,232,2329,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1914,232,2057,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2631,290,2809,331"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2402,297,2558,324"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2140,297,2300,324"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1908,290,2063,331"/>
</map>
</div>

</div>
</div>
<a id="af9c34fae0b7eac63cc78a01882498cfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9c34fae0b7eac63cc78a01882498cfb">&#9670;&nbsp;</a></span>__tdp_mmu_zap_root()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __tdp_mmu_zap_root </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>zap_level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00690">690</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;{</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    gfn_t end = <a class="code" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476">tdp_mmu_max_gfn_exclusive</a>();</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    gfn_t start = 0;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <a class="code" href="tdp__iter_8h.html#ae338deba99081393a1e19cdfa6640f48">for_each_tdp_pte_min_level</a>(iter, root, zap_level, start, end) {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;retry:</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2">tdp_mmu_iter_cond_resched</a>(kvm, &amp;iter, <span class="keyword">false</span>, shared))</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter.old_spte))</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">if</span> (iter.level &gt; zap_level)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="keywordflow">if</span> (!shared)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <a class="code" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d">tdp_mmu_iter_set_spte</a>(kvm, &amp;iter, 0);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6">tdp_mmu_set_spte_atomic</a>(kvm, &amp;iter, 0))</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordflow">goto</span> retry;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;}</div>
<div class="ttc" id="astructtdp__iter_html"><div class="ttname"><a href="structtdp__iter.html">tdp_iter</a></div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00078">tdp_iter.h:78</a></div></div>
<div class="ttc" id="atdp__iter_8h_html_ae338deba99081393a1e19cdfa6640f48"><div class="ttname"><a href="tdp__iter_8h.html#ae338deba99081393a1e19cdfa6640f48">for_each_tdp_pte_min_level</a></div><div class="ttdeci">#define for_each_tdp_pte_min_level(iter, root, min_level, start, end)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00123">tdp_iter.h:123</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a692eb9d20075258e5d4a0e4289a7c9b6"><div class="ttname"><a href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6">tdp_mmu_set_spte_atomic</a></div><div class="ttdeci">static int tdp_mmu_set_spte_atomic(struct kvm *kvm, struct tdp_iter *iter, u64 new_spte)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00517">tdp_mmu.c:517</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_abc2d73db35961f670cedf8ce1206c4d2"><div class="ttname"><a href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2">tdp_mmu_iter_cond_resched</a></div><div class="ttdeci">static bool __must_check tdp_mmu_iter_cond_resched(struct kvm *kvm, struct tdp_iter *iter, bool flush, bool shared)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00648">tdp_mmu.c:648</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_ac323268ae26fde5a608d694f4943d476"><div class="ttname"><a href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476">tdp_mmu_max_gfn_exclusive</a></div><div class="ttdeci">static gfn_t tdp_mmu_max_gfn_exclusive(void)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00679">tdp_mmu.c:679</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_af6444812b70d9509539a3fa478cde14d"><div class="ttname"><a href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d">tdp_mmu_iter_set_spte</a></div><div class="ttdeci">static void tdp_mmu_iter_set_spte(struct kvm *kvm, struct tdp_iter *iter, u64 new_spte)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00612">tdp_mmu.c:612</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_af9c34fae0b7eac63cc78a01882498cfb_cgraph.png" border="0" usemap="#atdp__mmu_8c_af9c34fae0b7eac63cc78a01882498cfb_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_af9c34fae0b7eac63cc78a01882498cfb_cgraph" id="atdp__mmu_8c_af9c34fae0b7eac63cc78a01882498cfb_cgraph">
<area shape="rect" title=" " alt="" coords="5,347,167,373"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2404,688,2579,715"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="219,195,428,221"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="236,448,411,475"/>
<area shape="rect" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476" title=" " alt="" coords="215,397,432,424"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="480,347,679,373"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="492,169,667,196"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="727,144,937,171"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="985,86,1196,127"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1258,43,1425,69"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1247,93,1435,120"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="506,499,653,525"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="751,575,913,601"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1275,347,1408,373"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1244,819,1439,845"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1750,921,1905,962"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1015,600,1166,627"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1778,292,1877,319"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1760,815,1895,841"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1775,993,1880,1020"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1034,896,1147,923"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1004,1048,1177,1075"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1019,1099,1162,1125"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1000,448,1181,475"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1027,195,1155,221"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1292,245,1391,272"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2007,916,2128,943"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1255,549,1427,576"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1246,667,1437,693"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1494,714,1689,755"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1291,499,1391,525"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1258,601,1425,642"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1265,448,1418,475"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1509,561,1674,588"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1487,845,1696,872"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1494,779,1689,821"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1744,865,1911,892"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2017,292,2118,319"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1988,815,2147,841"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="2224,815,2356,841"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1526,511,1657,537"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1522,612,1661,639"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1493,393,1690,420"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1514,445,1669,486"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1959,764,2176,791"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1974,967,2161,993"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1249,1048,1433,1075"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1498,1073,1685,1100"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1264,1099,1419,1125"/>
<area shape="rect" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778" title=" " alt="" coords="501,397,657,424"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_af9c34fae0b7eac63cc78a01882498cfb_icgraph.png" border="0" usemap="#atdp__mmu_8c_af9c34fae0b7eac63cc78a01882498cfb_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_af9c34fae0b7eac63cc78a01882498cfb_icgraph" id="atdp__mmu_8c_af9c34fae0b7eac63cc78a01882498cfb_icgraph">
<area shape="rect" title=" " alt="" coords="3897,256,4059,283"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="3703,256,3849,283"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="3453,227,3626,253"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="3424,278,3655,319"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="3215,227,3360,253"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="2947,227,3151,253"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="1713,227,1883,253"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="740,227,875,253"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="553,215,668,241"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="325,107,475,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="317,157,483,184"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="303,427,497,453"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="323,208,477,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="295,259,505,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="314,310,486,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="333,376,467,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="329,5,471,32"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="335,56,465,83"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="47,107,205,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="5,5,247,32"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="59,56,193,83"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="2687,283,2892,309"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="3199,369,3376,396"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="1234,281,1398,308"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="973,395,1143,421"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="987,277,1129,304"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="744,395,871,421"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="2436,333,2617,374"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="2967,391,3131,433"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="2973,457,3124,484"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="2185,340,2373,367"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1727,463,1869,489"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1463,463,1665,489"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1217,488,1415,515"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1222,387,1410,413"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="965,445,1151,472"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="951,496,1165,523"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="947,597,1169,624"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="988,547,1128,573"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="739,445,876,472"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="720,496,895,523"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="716,597,899,624"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="957,329,1159,370"/>
<area shape="rect" href="x86_8c.html#ae7e25dec8e0af366fb3db41dc9881970" title=" " alt="" coords="2680,399,2899,425"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="2421,399,2632,425"/>
<area shape="rect" href="kvm__main_8c.html#a52d56a5dc447602839375289b5bbffb2" title=" " alt="" coords="2191,463,2367,489"/>
<area shape="rect" href="kvm__main_8c.html#a8c9bd99a64bbedb0930e29ed4dcc7897" title=" " alt="" coords="1952,539,2116,565"/>
<area shape="rect" href="kvm__main_8c.html#ac4ce014a99262ed5672a102c6d2ffdbd" title=" " alt="" coords="1952,589,2116,616"/>
<area shape="rect" href="kvm__main_8c.html#afdb5cea8958921b2ea9bd3a29cf9d7a6" title=" " alt="" coords="1954,387,2114,413"/>
<area shape="rect" href="kvm__main_8c.html#a192569033b972982f6b53e13666ef82b" title=" " alt="" coords="1931,437,2137,464"/>
</map>
</div>

</div>
</div>
<a id="a30ae563747c16580e9c760ea701eec6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30ae563747c16580e9c760ea701eec6d">&#9670;&nbsp;</a></span>age_gfn_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool age_gfn_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01161">1161</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;{</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    u64 new_spte;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">/* If we have a non-accessed entry we don&#39;t need to change the pte. */</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="spte_8h.html#a16669248c64937ddec714d855609cacb">is_accessed_spte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>))</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd">spte_ad_enabled</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>)) {</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a> = <a class="code" href="tdp__iter_8h.html#a06888df6894eef0e93f82c77b99110b2">tdp_mmu_clear_spte_bits</a>(iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>,</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                             iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>,</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                             <a class="code" href="spte_8c.html#a1037a592d9e03bab1ce70a6e471901ae">shadow_accessed_mask</a>,</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                             iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>);</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        new_spte = iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a> &amp; ~<a class="code" href="spte_8c.html#a1037a592d9e03bab1ce70a6e471901ae">shadow_accessed_mask</a>;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">         * Capture the dirty status of the page, so that it doesn&#39;t get</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment">         * lost when the SPTE is marked for access tracking.</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49">is_writable_pte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>))</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            <a class="code" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873">kvm_set_pfn_dirty</a>(<a class="code" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd">spte_to_pfn</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>));</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        new_spte = <a class="code" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909">mark_spte_for_access_track</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a> = <a class="code" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4">kvm_tdp_mmu_write_spte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>,</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                            iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>, new_spte,</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                            iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    trace_kvm_tdp_mmu_spte_changed(iter-&gt;<a class="code" href="structtdp__iter.html#a473dd3cffaeffdae16cb52b94286141b">as_id</a>, iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>, iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>,</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                       iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>, new_spte);</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_a3617d51882e6aba0abae53c0bf922873"><div class="ttname"><a href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873">kvm_set_pfn_dirty</a></div><div class="ttdeci">void kvm_set_pfn_dirty(kvm_pfn_t pfn)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03285">kvm_main.c:3285</a></div></div>
<div class="ttc" id="aspte_8c_html_a1037a592d9e03bab1ce70a6e471901ae"><div class="ttname"><a href="spte_8c.html#a1037a592d9e03bab1ce70a6e471901ae">shadow_accessed_mask</a></div><div class="ttdeci">u64 __read_mostly shadow_accessed_mask</div><div class="ttdef"><b>Definition:</b> <a href="spte_8c_source.html#l00032">spte.c:32</a></div></div>
<div class="ttc" id="aspte_8c_html_a8885614ad1f7e35c498eb228826d1909"><div class="ttname"><a href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909">mark_spte_for_access_track</a></div><div class="ttdeci">u64 mark_spte_for_access_track(u64 spte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8c_source.html#l00341">spte.c:341</a></div></div>
<div class="ttc" id="aspte_8h_html_a16669248c64937ddec714d855609cacb"><div class="ttname"><a href="spte_8h.html#a16669248c64937ddec714d855609cacb">is_accessed_spte</a></div><div class="ttdeci">static bool is_accessed_spte(u64 spte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00333">spte.h:333</a></div></div>
<div class="ttc" id="aspte_8h_html_a4d0035385de92ed42a75324a2fb96d49"><div class="ttname"><a href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49">is_writable_pte</a></div><div class="ttdeci">static bool is_writable_pte(unsigned long pte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00441">spte.h:441</a></div></div>
<div class="ttc" id="aspte_8h_html_a88a720d39abac3aee2f63e03a20e8abd"><div class="ttname"><a href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd">spte_to_pfn</a></div><div class="ttdeci">static kvm_pfn_t spte_to_pfn(u64 pte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00328">spte.h:328</a></div></div>
<div class="ttc" id="aspte_8h_html_a976cddc84d935189584bdce94d4805fd"><div class="ttname"><a href="spte_8h.html#a976cddc84d935189584bdce94d4805fd">spte_ad_enabled</a></div><div class="ttdeci">static bool spte_ad_enabled(u64 spte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00279">spte.h:279</a></div></div>
<div class="ttc" id="astructtdp__iter_html_a473dd3cffaeffdae16cb52b94286141b"><div class="ttname"><a href="structtdp__iter.html#a473dd3cffaeffdae16cb52b94286141b">tdp_iter::as_id</a></div><div class="ttdeci">int as_id</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00103">tdp_iter.h:103</a></div></div>
<div class="ttc" id="astructtdp__iter_html_a5d152c98e3bfe241c7f4ebeacbfd2627"><div class="ttname"><a href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">tdp_iter::gfn</a></div><div class="ttdeci">gfn_t gfn</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00095">tdp_iter.h:95</a></div></div>
<div class="ttc" id="astructtdp__iter_html_a869c59866a73015fdc7bb34b2ce8ed1b"><div class="ttname"><a href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">tdp_iter::sptep</a></div><div class="ttdeci">tdp_ptep_t sptep</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00093">tdp_iter.h:93</a></div></div>
<div class="ttc" id="astructtdp__iter_html_ac3633464e37fa08393128005c46de911"><div class="ttname"><a href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">tdp_iter::old_spte</a></div><div class="ttdeci">u64 old_spte</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00105">tdp_iter.h:105</a></div></div>
<div class="ttc" id="astructtdp__iter_html_ac6b854683bce752c9e0fe0b068a288b2"><div class="ttname"><a href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">tdp_iter::level</a></div><div class="ttdeci">int level</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00101">tdp_iter.h:101</a></div></div>
<div class="ttc" id="atdp__iter_8h_html_a06888df6894eef0e93f82c77b99110b2"><div class="ttname"><a href="tdp__iter_8h.html#a06888df6894eef0e93f82c77b99110b2">tdp_mmu_clear_spte_bits</a></div><div class="ttdeci">static u64 tdp_mmu_clear_spte_bits(tdp_ptep_t sptep, u64 old_spte, u64 mask, int level)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00061">tdp_iter.h:61</a></div></div>
<div class="ttc" id="atdp__iter_8h_html_a74cc1f032b50c7c6c64ded8866deb4a4"><div class="ttname"><a href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4">kvm_tdp_mmu_write_spte</a></div><div class="ttdeci">static u64 kvm_tdp_mmu_write_spte(tdp_ptep_t sptep, u64 old_spte, u64 new_spte, int level)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00051">tdp_iter.h:51</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a30ae563747c16580e9c760ea701eec6d_cgraph.png" border="0" usemap="#atdp__mmu_8c_a30ae563747c16580e9c760ea701eec6d_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a30ae563747c16580e9c760ea701eec6d_cgraph" id="atdp__mmu_8c_a30ae563747c16580e9c760ea701eec6d_cgraph">
<area shape="rect" title=" " alt="" coords="5,244,124,271"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="698,44,833,71"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1172,145,1304,172"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="955,263,1076,289"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="198,143,341,169"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="172,345,367,372"/>
<area shape="rect" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909" title=" " alt="" coords="436,206,603,247"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="220,396,319,423"/>
<area shape="rect" href="tdp__iter_8h.html#a06888df6894eef0e93f82c77b99110b2" title=" " alt="" coords="175,447,364,473"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="936,196,1095,223"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="907,95,1124,121"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1352,145,1527,172"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="442,124,597,151"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="672,95,859,121"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="415,473,624,500"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="422,407,617,449"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="422,342,617,383"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="716,465,815,492"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="682,364,849,391"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="965,465,1066,492"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="931,364,1100,391"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="688,247,843,289"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a30ae563747c16580e9c760ea701eec6d_icgraph.png" border="0" usemap="#atdp__mmu_8c_a30ae563747c16580e9c760ea701eec6d_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a30ae563747c16580e9c760ea701eec6d_icgraph" id="atdp__mmu_8c_a30ae563747c16580e9c760ea701eec6d_icgraph">
<area shape="rect" title=" " alt="" coords="391,13,509,39"/>
<area shape="rect" href="tdp__mmu_8c.html#a0a5c7f827057100e08b2f45da804fa30" title=" " alt="" coords="164,5,343,47"/>
<area shape="rect" href="mmu_8c.html#a39977aaa99a2eb423e12429a5deb15dc" title=" " alt="" coords="5,13,116,39"/>
</map>
</div>

</div>
</div>
<a id="a9da9e7ba01717f85966fc080e86ecb84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9da9e7ba01717f85966fc080e86ecb84">&#9670;&nbsp;</a></span>clear_dirty_gfn_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool clear_dirty_gfn_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01518">1518</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;{</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keyword">const</span> u64 dbit = <a class="code" href="tdp__mmu_8c.html#a8d2a2606fb90f6b6e1a2559d12c04ee8">tdp_mmu_need_write_protect</a>(root) ? <a class="code" href="mmu_8h.html#a8738f5e32b741b402eeb723accb071ed">PT_WRITABLE_MASK</a> :</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                                <a class="code" href="spte_8c.html#a4da775a32ca03cd42a18da1e1aac568e">shadow_dirty_mask</a>;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="keywordtype">bool</span> spte_set = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160; </div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160; </div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <a class="code" href="tdp__mmu_8c.html#af8f1376ead11b676fb3cf0e3d26f6464">tdp_root_for_each_pte</a>(iter, root, start, end) {</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;retry:</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter.old_spte) ||</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            !<a class="code" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a>(iter.old_spte, iter.level))</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160; </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2">tdp_mmu_iter_cond_resched</a>(kvm, &amp;iter, <span class="keyword">false</span>, <span class="keyword">true</span>))</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160; </div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        <a class="code" href="mmu__internal_8h.html#a687a3432a6f9b4c6f600cb8b945ff3af">KVM_MMU_WARN_ON</a>(dbit == <a class="code" href="spte_8c.html#a4da775a32ca03cd42a18da1e1aac568e">shadow_dirty_mask</a> &amp;&amp;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                <a class="code" href="spte_8h.html#a5870e4934206b631c93e08f3ef78b934">spte_ad_need_write_protect</a>(iter.old_spte));</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160; </div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        <span class="keywordflow">if</span> (!(iter.old_spte &amp; dbit))</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160; </div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6">tdp_mmu_set_spte_atomic</a>(kvm, &amp;iter, iter.old_spte &amp; ~dbit))</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            <span class="keywordflow">goto</span> retry;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160; </div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        spte_set = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    }</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160; </div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keywordflow">return</span> spte_set;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;}</div>
<div class="ttc" id="ammu_8h_html_a8738f5e32b741b402eeb723accb071ed"><div class="ttname"><a href="mmu_8h.html#a8738f5e32b741b402eeb723accb071ed">PT_WRITABLE_MASK</a></div><div class="ttdeci">#define PT_WRITABLE_MASK</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8h_source.html#l00015">mmu.h:15</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a687a3432a6f9b4c6f600cb8b945ff3af"><div class="ttname"><a href="mmu__internal_8h.html#a687a3432a6f9b4c6f600cb8b945ff3af">KVM_MMU_WARN_ON</a></div><div class="ttdeci">#define KVM_MMU_WARN_ON(x)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00012">mmu_internal.h:12</a></div></div>
<div class="ttc" id="aspte_8c_html_a4da775a32ca03cd42a18da1e1aac568e"><div class="ttname"><a href="spte_8c.html#a4da775a32ca03cd42a18da1e1aac568e">shadow_dirty_mask</a></div><div class="ttdeci">u64 __read_mostly shadow_dirty_mask</div><div class="ttdef"><b>Definition:</b> <a href="spte_8c_source.html#l00033">spte.c:33</a></div></div>
<div class="ttc" id="aspte_8h_html_a5870e4934206b631c93e08f3ef78b934"><div class="ttname"><a href="spte_8h.html#a5870e4934206b631c93e08f3ef78b934">spte_ad_need_write_protect</a></div><div class="ttdeci">static bool spte_ad_need_write_protect(u64 spte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00285">spte.h:285</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a8d2a2606fb90f6b6e1a2559d12c04ee8"><div class="ttname"><a href="tdp__mmu_8c.html#a8d2a2606fb90f6b6e1a2559d12c04ee8">tdp_mmu_need_write_protect</a></div><div class="ttdeci">static bool tdp_mmu_need_write_protect(struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01501">tdp_mmu.c:1501</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a9da9e7ba01717f85966fc080e86ecb84_cgraph.png" border="0" usemap="#atdp__mmu_8c_a9da9e7ba01717f85966fc080e86ecb84_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a9da9e7ba01717f85966fc080e86ecb84_cgraph" id="atdp__mmu_8c_a9da9e7ba01717f85966fc080e86ecb84_cgraph">
<area shape="rect" title=" " alt="" coords="5,680,168,707"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1534,212,1633,239"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1496,968,1671,995"/>
<area shape="rect" href="spte_8h.html#a5870e4934206b631c93e08f3ef78b934" title=" " alt="" coords="245,1242,397,1283"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="216,59,425,85"/>
<area shape="rect" href="tdp__mmu_8c.html#a8d2a2606fb90f6b6e1a2559d12c04ee8" title=" " alt="" coords="239,643,402,685"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="221,709,420,736"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1719,212,1820,239"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="483,55,657,81"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="715,53,925,80"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="977,45,1187,86"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1260,5,1427,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1249,56,1437,83"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1544,5,1623,32"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="503,592,637,619"/>
<area shape="rect" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5" title=" " alt="" coords="473,643,667,685"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="489,709,651,736"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1015,988,1149,1015"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="743,978,897,1019"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="745,709,895,736"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="753,763,887,789"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="767,1061,873,1088"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="763,864,877,891"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="733,524,907,551"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="749,431,891,457"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="729,212,911,239"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="756,313,884,340"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1033,212,1131,239"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1021,1039,1143,1065"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="996,583,1168,609"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="987,633,1177,660"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="985,735,1179,761"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1246,634,1441,675"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1032,785,1132,812"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="999,466,1165,507"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1005,532,1159,559"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1261,583,1426,609"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1239,765,1448,792"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1246,699,1441,741"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1278,816,1409,843"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1274,415,1413,441"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1245,532,1442,559"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1266,466,1421,507"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1003,937,1161,964"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="973,887,1191,913"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1277,968,1409,995"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="989,1089,1175,1116"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="990,415,1174,441"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1250,364,1437,391"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1005,364,1159,391"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a9da9e7ba01717f85966fc080e86ecb84_icgraph.png" border="0" usemap="#atdp__mmu_8c_a9da9e7ba01717f85966fc080e86ecb84_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a9da9e7ba01717f85966fc080e86ecb84_icgraph" id="atdp__mmu_8c_a9da9e7ba01717f85966fc080e86ecb84_icgraph">
<area shape="rect" title=" " alt="" coords="3351,232,3513,259"/>
<area shape="rect" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c" title=" " alt="" coords="3076,232,3303,259"/>
<area shape="rect" href="mmu_8c.html#acb92068f6e948846797ac6814b3618f1" title=" " alt="" coords="2833,225,3028,266"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2619,225,2785,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2365,225,2571,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2099,232,2317,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1908,232,2051,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
</map>
</div>

</div>
</div>
<a id="a302b8c57cfb6b9bc82a2f68047477145"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a302b8c57cfb6b9bc82a2f68047477145">&#9670;&nbsp;</a></span>clear_dirty_pt_masked()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void clear_dirty_pt_masked </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>wrprot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01581">1581</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;{</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keyword">const</span> u64 dbit = (wrprot || <a class="code" href="tdp__mmu_8c.html#a8d2a2606fb90f6b6e1a2559d12c04ee8">tdp_mmu_need_write_protect</a>(root)) ? <a class="code" href="mmu_8h.html#a8738f5e32b741b402eeb723accb071ed">PT_WRITABLE_MASK</a> :</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                                    <a class="code" href="spte_8c.html#a4da775a32ca03cd42a18da1e1aac568e">shadow_dirty_mask</a>;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160; </div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160; </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160; </div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a05d1e6fdfa42b23ebcea4b55ff41256d">tdp_root_for_each_leaf_pte</a>(iter, root, <a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a> + __ffs(mask),</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                    <a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a> + BITS_PER_LONG) {</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="keywordflow">if</span> (!mask)</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160; </div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <a class="code" href="mmu__internal_8h.html#a687a3432a6f9b4c6f600cb8b945ff3af">KVM_MMU_WARN_ON</a>(dbit == <a class="code" href="spte_8c.html#a4da775a32ca03cd42a18da1e1aac568e">shadow_dirty_mask</a> &amp;&amp;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                <a class="code" href="spte_8h.html#a5870e4934206b631c93e08f3ef78b934">spte_ad_need_write_protect</a>(iter.old_spte));</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160; </div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        <span class="keywordflow">if</span> (iter.level &gt; PG_LEVEL_4K ||</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;            !(mask &amp; (1UL &lt;&lt; (iter.gfn - <a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>))))</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160; </div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        mask &amp;= ~(1UL &lt;&lt; (iter.gfn - <a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>));</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160; </div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <span class="keywordflow">if</span> (!(iter.old_spte &amp; dbit))</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160; </div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        iter.old_spte = <a class="code" href="tdp__iter_8h.html#a06888df6894eef0e93f82c77b99110b2">tdp_mmu_clear_spte_bits</a>(iter.sptep,</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                            iter.old_spte, dbit,</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                            iter.level);</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        trace_kvm_tdp_mmu_spte_changed(iter.as_id, iter.gfn, iter.level,</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                           iter.old_spte,</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;                           iter.old_spte &amp; ~dbit);</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        <a class="code" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873">kvm_set_pfn_dirty</a>(<a class="code" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd">spte_to_pfn</a>(iter.old_spte));</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    }</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160; </div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a05d1e6fdfa42b23ebcea4b55ff41256d"><div class="ttname"><a href="tdp__mmu_8c.html#a05d1e6fdfa42b23ebcea4b55ff41256d">tdp_root_for_each_leaf_pte</a></div><div class="ttdeci">#define tdp_root_for_each_leaf_pte(_iter, _root, _start, _end)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00624">tdp_mmu.c:624</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a302b8c57cfb6b9bc82a2f68047477145_cgraph.png" border="0" usemap="#atdp__mmu_8c_a302b8c57cfb6b9bc82a2f68047477145_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a302b8c57cfb6b9bc82a2f68047477145_cgraph" id="atdp__mmu_8c_a302b8c57cfb6b9bc82a2f68047477145_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,175,133"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="246,5,389,32"/>
<area shape="rect" href="spte_8h.html#a5870e4934206b631c93e08f3ef78b934" title=" " alt="" coords="1169,49,1321,90"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="268,107,367,133"/>
<area shape="rect" href="tdp__iter_8h.html#a06888df6894eef0e93f82c77b99110b2" title=" " alt="" coords="223,157,412,184"/>
<area shape="rect" href="tdp__mmu_8c.html#a8d2a2606fb90f6b6e1a2559d12c04ee8" title=" " alt="" coords="236,217,399,258"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="487,5,642,32"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="717,5,904,32"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1369,115,1544,141"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="460,107,669,133"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="467,158,662,199"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="761,165,860,192"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="727,267,894,293"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="986,165,1087,192"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="957,216,1116,243"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1179,216,1311,243"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="952,317,1121,344"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="976,368,1097,395"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="498,224,631,251"/>
<area shape="rect" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5" title=" " alt="" coords="468,275,661,317"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a302b8c57cfb6b9bc82a2f68047477145_icgraph.png" border="0" usemap="#atdp__mmu_8c_a302b8c57cfb6b9bc82a2f68047477145_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a302b8c57cfb6b9bc82a2f68047477145_icgraph" id="atdp__mmu_8c_a302b8c57cfb6b9bc82a2f68047477145_icgraph">
<area shape="rect" title=" " alt="" coords="1324,46,1493,73"/>
<area shape="rect" href="tdp__mmu_8c.html#ad1753c27bb053bc6ac3a3893e10b49f6" title=" " alt="" coords="1080,39,1276,80"/>
<area shape="rect" href="mmu_8c.html#afeee4db4dd885d0e891ccb05f545c876" title=" " alt="" coords="855,5,1023,47"/>
<area shape="rect" href="mmu_8c.html#ace4eaa769a0c9e1f75a3900a51275d18" title=" " alt="" coords="847,71,1032,112"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="620,39,799,80"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="416,46,572,73"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="208,46,368,73"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="5,39,160,80"/>
</map>
</div>

</div>
</div>
<a id="a95692dd1daa13effa90e042a8a7057af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95692dd1daa13effa90e042a8a7057af">&#9670;&nbsp;</a></span>handle_changed_spte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_changed_spte </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>as_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>old_spte</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>new_spte</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>handle_changed_spte - handle bookkeeping associated with an SPTE change @kvm: kvm instance @as_id: the address space of the paging structure the SPTE was a part of @gfn: the base GFN that was mapped by the SPTE @old_spte: The value of the SPTE before the change @new_spte: The value of the SPTE after the change @level: the level of the PT the SPTE is part of in the paging structure @shared: This operation may not be running under the exclusive use of the MMU lock and the operation must synchronize with other threads that might be modifying SPTEs.</p>
<p>Handle bookkeeping that might result from the modification of a SPTE. Note, dirty logging updates are handled in common code, not here (see <a class="el" href="spte_8c.html#ab8dba69ef9f5267d41ba061dbe101ded">make_spte()</a> and <a class="el" href="mmu_8c.html#a7a30f054b63184f3edafba0d2645dbb2">fast_pf_fix_direct_spte()</a>). </p>

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00408">408</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;{</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordtype">bool</span> was_present = <a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(old_spte);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">bool</span> is_present = <a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(new_spte);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordtype">bool</span> was_leaf = was_present &amp;&amp; <a class="code" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a>(old_spte, level);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordtype">bool</span> is_leaf = is_present &amp;&amp; <a class="code" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a>(new_spte, level);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordtype">bool</span> pfn_changed = <a class="code" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd">spte_to_pfn</a>(old_spte) != <a class="code" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd">spte_to_pfn</a>(new_spte);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    WARN_ON_ONCE(level &gt; PT64_ROOT_MAX_LEVEL);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    WARN_ON_ONCE(level &lt; PG_LEVEL_4K);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    WARN_ON_ONCE(gfn &amp; (KVM_PAGES_PER_HPAGE(level) - 1));</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">     * If this warning were to trigger it would indicate that there was a</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">     * missing MMU notifier or a race with some notifier handler.</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">     * A present, leaf SPTE should never be directly replaced with another</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">     * present leaf SPTE pointing to a different PFN. A notifier handler</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">     * should be zapping the SPTE before the main MM&#39;s page table is</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">     * changed, or the SPTE should be zeroed, and the TLBs flushed by the</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">     * thread before replacement.</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span> (was_leaf &amp;&amp; is_leaf &amp;&amp; pfn_changed) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        pr_err(<span class="stringliteral">&quot;Invalid SPTE change: cannot replace a present leaf\n&quot;</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;               <span class="stringliteral">&quot;SPTE with another present leaf SPTE mapping a\n&quot;</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;               <span class="stringliteral">&quot;different PFN!\n&quot;</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;               <span class="stringliteral">&quot;as_id: %d gfn: %llx old_spte: %llx new_spte: %llx level: %d&quot;</span>,</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;               as_id, gfn, old_spte, new_spte, level);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">         * Crash the host to prevent error propagation and guest data</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">         * corruption.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        BUG();</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">if</span> (old_spte == new_spte)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    trace_kvm_tdp_mmu_spte_changed(as_id, gfn, level, old_spte, new_spte);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> (is_leaf)</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <a class="code" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4">check_spte_writable_invariants</a>(new_spte);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">     * The only times a SPTE should be changed from a non-present to</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">     * non-present state is when an MMIO entry is installed/modified/</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">     * removed. In that case, there is nothing to do here.</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (!was_present &amp;&amp; !is_present) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">         * If this change does not involve a MMIO SPTE or removed SPTE,</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">         * it is unexpected. Log the change, though it should not</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">         * impact the guest since both the former and current SPTEs</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">         * are nonpresent.</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">if</span> (WARN_ON_ONCE(!<a class="code" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7">is_mmio_spte</a>(old_spte) &amp;&amp;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                 !<a class="code" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7">is_mmio_spte</a>(new_spte) &amp;&amp;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                 !<a class="code" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b">is_removed_spte</a>(new_spte)))</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            pr_err(<span class="stringliteral">&quot;Unexpected SPTE change! Nonpresent SPTEs\n&quot;</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                   <span class="stringliteral">&quot;should not be replaced with another,\n&quot;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                   <span class="stringliteral">&quot;different nonpresent SPTE, unless one or both\n&quot;</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                   <span class="stringliteral">&quot;are MMIO SPTEs, or the new SPTE is\n&quot;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                   <span class="stringliteral">&quot;a temporary removed SPTE.\n&quot;</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                   <span class="stringliteral">&quot;as_id: %d gfn: %llx old_spte: %llx new_spte: %llx level: %d&quot;</span>,</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                   as_id, gfn, old_spte, new_spte, level);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span> (is_leaf != was_leaf)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <a class="code" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73">kvm_update_page_stats</a>(kvm, level, is_leaf ? 1 : -1);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">if</span> (was_leaf &amp;&amp; <a class="code" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c">is_dirty_spte</a>(old_spte) &amp;&amp;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        (!is_present || !<a class="code" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c">is_dirty_spte</a>(new_spte) || pfn_changed))</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <a class="code" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873">kvm_set_pfn_dirty</a>(<a class="code" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd">spte_to_pfn</a>(old_spte));</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">     * Recursively handle child PTs if the change removed a subtree from</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">     * the paging structure.  Note the WARN on the PFN changing without the</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">     * SPTE being converted to a hugepage (leaf) or being zapped.  Shadow</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">     * pages are kernel allocations and should never be migrated.</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">if</span> (was_present &amp;&amp; !was_leaf &amp;&amp;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        (is_leaf || !is_present || WARN_ON_ONCE(pfn_changed)))</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <a class="code" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e">handle_removed_pt</a>(kvm, <a class="code" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977">spte_to_child_pt</a>(old_spte, level), shared);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (was_leaf &amp;&amp; <a class="code" href="spte_8h.html#a16669248c64937ddec714d855609cacb">is_accessed_spte</a>(old_spte) &amp;&amp;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        (!is_present || !<a class="code" href="spte_8h.html#a16669248c64937ddec714d855609cacb">is_accessed_spte</a>(new_spte) || pfn_changed))</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <a class="code" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb">kvm_set_pfn_accessed</a>(<a class="code" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd">spte_to_pfn</a>(old_spte));</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_ad88d3f7ece0c0ad7dce0c296133beccb"><div class="ttname"><a href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb">kvm_set_pfn_accessed</a></div><div class="ttdeci">void kvm_set_pfn_accessed(kvm_pfn_t pfn)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03295">kvm_main.c:3295</a></div></div>
<div class="ttc" id="ammu_8h_html_a9d589fd96a814e43fc146f83dc5d5f73"><div class="ttname"><a href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73">kvm_update_page_stats</a></div><div class="ttdeci">static void kvm_update_page_stats(struct kvm *kvm, int level, int count)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8h_source.html#l00305">mmu.h:305</a></div></div>
<div class="ttc" id="aspte_8h_html_a0726c9cf54d23a373533a0833aaf979c"><div class="ttname"><a href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c">is_dirty_spte</a></div><div class="ttdeci">static bool is_dirty_spte(u64 spte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00341">spte.h:341</a></div></div>
<div class="ttc" id="aspte_8h_html_a2927d719923cb2ed2b5b83d739a275f7"><div class="ttname"><a href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7">is_mmio_spte</a></div><div class="ttdeci">static bool is_mmio_spte(u64 spte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00252">spte.h:252</a></div></div>
<div class="ttc" id="aspte_8h_html_a2946d25249b11a82d33e9ad9dca73ec4"><div class="ttname"><a href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4">check_spte_writable_invariants</a></div><div class="ttdeci">static void check_spte_writable_invariants(u64 spte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00447">spte.h:447</a></div></div>
<div class="ttc" id="aspte_8h_html_ad52bae526742289dbd54348dfa55310b"><div class="ttname"><a href="spte_8h.html#ad52bae526742289dbd54348dfa55310b">is_removed_spte</a></div><div class="ttdeci">static bool is_removed_spte(u64 spte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00202">spte.h:202</a></div></div>
<div class="ttc" id="atdp__iter_8c_html_ae565103c187af07e69eb2f29b180b977"><div class="ttname"><a href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977">spte_to_child_pt</a></div><div class="ttdeci">tdp_ptep_t spte_to_child_pt(u64 spte, int level)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8c_source.html#l00062">tdp_iter.c:62</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_ac509299bc28d3b827578915abdb2280e"><div class="ttname"><a href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e">handle_removed_pt</a></div><div class="ttdeci">static void handle_removed_pt(struct kvm *kvm, tdp_ptep_t pt, bool shared)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00309">tdp_mmu.c:309</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a95692dd1daa13effa90e042a8a7057af_cgraph.png" border="0" usemap="#atdp__mmu_8c_a95692dd1daa13effa90e042a8a7057af_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a95692dd1daa13effa90e042a8a7057af_cgraph" id="atdp__mmu_8c_a95692dd1daa13effa90e042a8a7057af_cgraph">
<area shape="rect" title=" " alt="" coords="5,704,168,731"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="951,119,1106,161"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="231,520,382,547"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="476,676,609,703"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1605,188,1780,215"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="979,731,1078,757"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="961,185,1096,212"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="976,51,1081,77"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="250,883,363,909"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="220,984,393,1011"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="235,933,378,960"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="216,1035,397,1061"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="243,781,371,808"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="493,883,592,909"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1208,144,1329,171"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="457,419,629,445"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="447,469,638,496"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="445,621,640,648"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="695,549,890,590"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="493,520,593,547"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="459,290,626,331"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="466,368,619,395"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="710,447,875,473"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="688,680,897,707"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="695,614,890,655"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="945,245,1112,272"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1218,731,1319,757"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1189,195,1348,221"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1425,188,1557,215"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1184,296,1353,323"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="727,497,858,524"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="723,279,862,305"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="694,329,891,356"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="715,381,870,422"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1160,93,1377,120"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1175,43,1362,69"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="451,984,635,1011"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="699,959,886,985"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="465,933,620,960"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a95692dd1daa13effa90e042a8a7057af_icgraph.png" border="0" usemap="#atdp__mmu_8c_a95692dd1daa13effa90e042a8a7057af_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a95692dd1daa13effa90e042a8a7057af_icgraph" id="atdp__mmu_8c_a95692dd1daa13effa90e042a8a7057af_icgraph">
<area shape="rect" title=" " alt="" coords="1736,215,1899,242"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1537,190,1688,217"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="1539,241,1686,267"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="1291,521,1489,547"/>
<area shape="rect" href="tdp__mmu_8c.html#a381e22ee819864cf1fd726479a76b6c7" title=" " alt="" coords="1304,105,1476,131"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="1303,241,1477,267"/>
<area shape="rect" href="mmu_8c.html#a85202c8f53b11b1c80f9b6e26210aa9a" title=" " alt="" coords="1057,11,1227,52"/>
<area shape="rect" href="mmu_8c.html#a2683113dbbf42e73c2b52410f9ef6f84" title=" " alt="" coords="765,5,981,47"/>
<area shape="rect" href="mmu_8c.html#a13148d5065ef27624701afcaa3229983" title=" " alt="" coords="497,9,680,35"/>
<area shape="rect" href="x86_8c.html#a91673b399129921871f11d0752eea8c3" title=" " alt="" coords="234,7,411,34"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="1061,353,1223,379"/>
<area shape="rect" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c" title=" " alt="" coords="1089,157,1195,183"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="1073,445,1211,471"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="1065,241,1219,267"/>
<area shape="rect" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580" title=" " alt="" coords="1074,87,1210,114"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="799,353,946,379"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="502,334,675,361"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="473,385,704,427"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="250,342,395,369"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="220,393,425,419"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="234,443,411,470"/>
<area shape="rect" href="tdp__mmu_8c.html#aa53a75612d7b32153949be34f4055144" title=" " alt="" coords="767,129,978,155"/>
<area shape="rect" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d" title=" " alt="" coords="518,129,659,155"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="511,517,667,543"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="774,427,971,454"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="509,451,668,492"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="233,495,413,536"/>
<area shape="rect" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501" title=" " alt="" coords="773,180,973,221"/>
<area shape="rect" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8" title=" " alt="" coords="778,246,967,273"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="501,187,676,214"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="512,241,665,267"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="247,109,398,151"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="224,175,421,216"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="253,241,393,267"/>
<area shape="rect" href="mtrr_8c.html#aca604775fbcfad49bfaf9441fc2253dc" title=" " alt="" coords="271,291,374,318"/>
<area shape="rect" href="tdp__mmu_8c.html#a45fd618d35fb0df14a3401a230f41faa" title=" " alt="" coords="752,74,993,101"/>
<area shape="rect" href="mmu_8c.html#a1f49638b71a482e4b0c3a6af10d0711e" title=" " alt="" coords="493,61,684,103"/>
<area shape="rect" href="page__track_8c.html#ab6a4ffea76ea12eb3b1e83eafaf4618b" title=" " alt="" coords="221,58,425,85"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="1061,631,1223,658"/>
<area shape="rect" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427" title=" " alt="" coords="1057,513,1227,555"/>
<area shape="rect" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d" title=" " alt="" coords="1041,686,1243,713"/>
<area shape="rect" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37" title=" " alt="" coords="1074,579,1210,606"/>
<area shape="rect" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c" title=" " alt="" coords="759,633,986,659"/>
<area shape="rect" href="mmu_8c.html#acb92068f6e948846797ac6814b3618f1" title=" " alt="" coords="225,627,420,668"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="5,627,172,668"/>
<area shape="rect" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf" title=" " alt="" coords="794,685,951,727"/>
<area shape="rect" href="tdp__mmu_8c.html#a3a86994ba17144f60df37ea7682d650b" title=" " alt="" coords="475,688,702,729"/>
<area shape="rect" href="mmu_8c.html#a35da5538a61de05522efdad8f615df4f" title=" " alt="" coords="223,692,422,733"/>
<area shape="rect" href="tdp__mmu_8c.html#a7f6c658f3ddf3ffac5ce96335b78e295" title=" " alt="" coords="773,579,973,606"/>
<area shape="rect" href="mmu_8c.html#a168b7814e68a545abd8bf00fc4466610" title=" " alt="" coords="499,568,679,609"/>
</map>
</div>

</div>
</div>
<a id="ac509299bc28d3b827578915abdb2280e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac509299bc28d3b827578915abdb2280e">&#9670;&nbsp;</a></span>handle_removed_pt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_removed_pt </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a>&#160;</td>
          <td class="paramname"><em>pt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e">handle_removed_pt()</a> - handle a page table removed from the TDP structure</p>
<p>@kvm: kvm instance @pt: the page removed from the paging structure @shared: This operation may not be running under the exclusive use of the MMU lock and the operation must synchronize with other threads that might be modifying SPTEs.</p>
<p>Given a page table that has been removed from the TDP paging structure, iterates through the page table to clear SPTEs and free child page tables.</p>
<p>Note that pt is passed in as a tdp_ptep_t, but it does not need RCU protection. Since this thread removed it from the paging structure, this thread will be responsible for ensuring the page is freed. Hence the early rcu_dereferences in the function. </p>

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00309">309</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;{</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp = <a class="code" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13">sptep_to_sp</a>(rcu_dereference(pt));</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">int</span> level = sp-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.level;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    gfn_t base_gfn = sp-&gt;<a class="code" href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">gfn</a>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    trace_kvm_mmu_prepare_zap_page(sp);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686">tdp_mmu_unlink_sp</a>(kvm, sp);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="spte_8h.html#a576b7a13ccedb0b5859a12df4280ed9d">SPTE_ENT_PER_PAGE</a>; i++) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <a class="code" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a> sptep = pt + i;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        gfn_t <a class="code" href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">gfn</a> = base_gfn + i * KVM_PAGES_PER_HPAGE(level);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        u64 old_spte;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">if</span> (shared) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">             * Set the SPTE to a nonpresent value that other</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">             * threads will not overwrite. If the SPTE was</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">             * already marked as removed then another thread</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">             * handling a page fault could overwrite it, so</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">             * set the SPTE until it is set from some other</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">             * value to the removed SPTE value.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                old_spte = <a class="code" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1">kvm_tdp_mmu_write_spte_atomic</a>(sptep, <a class="code" href="spte_8h.html#a9e3b5ea0bcca48866f5fb2e94ae03826">REMOVED_SPTE</a>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b">is_removed_spte</a>(old_spte))</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                cpu_relax();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">             * If the SPTE is not MMU-present, there is no backing</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">             * page associated with the SPTE and so no side effects</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">             * that need to be recorded, and exclusive ownership of</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">             * mmu_lock ensures the SPTE can&#39;t be made present.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">             * Note, zapping MMIO SPTEs is also unnecessary as they</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">             * are guarded by the memslots generation, not by being</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">             * unreachable.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            old_spte = <a class="code" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768">kvm_tdp_mmu_read_spte</a>(sptep);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(old_spte))</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">             * Use the common helper instead of a raw WRITE_ONCE as</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">             * the SPTE needs to be updated atomically if it can be</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">             * modified by a different vCPU outside of mmu_lock.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">             * Even though the parent SPTE is !PRESENT, the TLB</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">             * hasn&#39;t yet been flushed, and both Intel and AMD</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">             * document that A/D assists can use upper-level PxE</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">             * entries that are cached in the TLB, i.e. the CPU can</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">             * still access the page and mark it dirty.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">             *</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">             * No retry is needed in the atomic update path as the</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">             * sole concern is dropping a Dirty bit, i.e. no other</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">             * task can zap/remove the SPTE as mmu_lock is held for</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">             * write.  Marking the SPTE as a removed SPTE is not</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">             * strictly necessary for the same reason, but using</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">             * the remove SPTE value keeps the shared/exclusive</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">             * paths consistent and allows the handle_changed_spte()</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">             * call below to hardcode the new value to REMOVED_SPTE.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">             *</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">             * Note, even though dropping a Dirty bit is the only</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">             * scenario where a non-atomic update could result in a</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">             * functional bug, simply checking the Dirty bit isn&#39;t</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">             * sufficient as a fast page fault could read the upper</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">             * level SPTE before it is zapped, and then make this</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">             * target SPTE writable, resume the guest, and set the</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">             * Dirty bit between reading the SPTE above and writing</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">             * it here.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            old_spte = <a class="code" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4">kvm_tdp_mmu_write_spte</a>(sptep, old_spte,</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                              <a class="code" href="spte_8h.html#a9e3b5ea0bcca48866f5fb2e94ae03826">REMOVED_SPTE</a>, level);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af">handle_changed_spte</a>(kvm, <a class="code" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79">kvm_mmu_page_as_id</a>(sp), <a class="code" href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">gfn</a>,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                    old_spte, <a class="code" href="spte_8h.html#a9e3b5ea0bcca48866f5fb2e94ae03826">REMOVED_SPTE</a>, level, shared);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    call_rcu(&amp;sp-&gt;rcu_head, <a class="code" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279">tdp_mmu_free_sp_rcu_callback</a>);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div>
<div class="ttc" id="ammu__internal_8h_html_a6798167b4e223d54b53a69a2c3c892c3"><div class="ttname"><a href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a></div><div class="ttdeci">u64 __rcu * tdp_ptep_t</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00050">mmu_internal.h:50</a></div></div>
<div class="ttc" id="aspte_8h_html_a501c74fbb95a5dd015922c57a163ca13"><div class="ttname"><a href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13">sptep_to_sp</a></div><div class="ttdeci">static struct kvm_mmu_page * sptep_to_sp(u64 *sptep)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00235">spte.h:235</a></div></div>
<div class="ttc" id="aspte_8h_html_a576b7a13ccedb0b5859a12df4280ed9d"><div class="ttname"><a href="spte_8h.html#a576b7a13ccedb0b5859a12df4280ed9d">SPTE_ENT_PER_PAGE</a></div><div class="ttdeci">#define SPTE_ENT_PER_PAGE</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00058">spte.h:58</a></div></div>
<div class="ttc" id="aspte_8h_html_a9e3b5ea0bcca48866f5fb2e94ae03826"><div class="ttname"><a href="spte_8h.html#a9e3b5ea0bcca48866f5fb2e94ae03826">REMOVED_SPTE</a></div><div class="ttdeci">#define REMOVED_SPTE</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00197">spte.h:197</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a9a054096d38bb2789139b0ef5aa8fec3"><div class="ttname"><a href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">kvm_mmu_page::role</a></div><div class="ttdeci">union kvm_mmu_page_role role</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00074">mmu_internal.h:80</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_ad833bc48e1885408b2b5c7deca9a6232"><div class="ttname"><a href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">kvm_mmu_page::gfn</a></div><div class="ttdeci">gfn_t gfn</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00081">mmu_internal.h:81</a></div></div>
<div class="ttc" id="atdp__iter_8h_html_a2138ed5465b3552439c1ad55ee1bc6d1"><div class="ttname"><a href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1">kvm_tdp_mmu_write_spte_atomic</a></div><div class="ttdeci">static u64 kvm_tdp_mmu_write_spte_atomic(tdp_ptep_t sptep, u64 new_spte)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00022">tdp_iter.h:22</a></div></div>
<div class="ttc" id="atdp__iter_8h_html_ae1b8feffcbd421cbcb6a40cd57abf768"><div class="ttname"><a href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768">kvm_tdp_mmu_read_spte</a></div><div class="ttdeci">static u64 kvm_tdp_mmu_read_spte(tdp_ptep_t sptep)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00017">tdp_iter.h:17</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a401c07c0503d3fc2c62b9a8a06096686"><div class="ttname"><a href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686">tdp_mmu_unlink_sp</a></div><div class="ttdeci">static void tdp_mmu_unlink_sp(struct kvm *kvm, struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00279">tdp_mmu.c:279</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a92b80ecd9f7bf033d7ed2f28fb0a1279"><div class="ttname"><a href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279">tdp_mmu_free_sp_rcu_callback</a></div><div class="ttdeci">static void tdp_mmu_free_sp_rcu_callback(struct rcu_head *head)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00068">tdp_mmu.c:68</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a95692dd1daa13effa90e042a8a7057af"><div class="ttname"><a href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af">handle_changed_spte</a></div><div class="ttdeci">static void handle_changed_spte(struct kvm *kvm, int as_id, gfn_t gfn, u64 old_spte, u64 new_spte, int level, bool shared)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00408">tdp_mmu.c:408</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ac509299bc28d3b827578915abdb2280e_cgraph.png" border="0" usemap="#atdp__mmu_8c_ac509299bc28d3b827578915abdb2280e_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_ac509299bc28d3b827578915abdb2280e_cgraph" id="atdp__mmu_8c_ac509299bc28d3b827578915abdb2280e_cgraph">
<area shape="rect" title=" " alt="" coords="5,674,156,701"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="470,384,633,410"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1433,434,1608,461"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="728,628,861,654"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="215,569,387,596"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="206,674,397,701"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="204,733,399,760"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="454,788,649,830"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="251,837,351,864"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="218,892,385,934"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="225,964,378,990"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="717,562,872,603"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="727,510,862,537"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="742,460,847,486"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="993,308,1091,334"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="738,409,851,436"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="708,54,881,81"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="723,105,866,132"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="704,156,885,182"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="731,257,859,284"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="993,206,1091,233"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="981,620,1103,646"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="963,561,1121,588"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="933,510,1151,537"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1226,536,1358,562"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="949,460,1135,486"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1241,308,1343,334"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="950,54,1134,81"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1199,80,1385,106"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="965,105,1119,132"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="469,569,634,596"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="447,737,656,764"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="454,671,649,712"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="711,729,878,756"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="957,678,1127,705"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="486,854,617,881"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="482,905,621,932"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="453,1022,650,1049"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="474,956,629,998"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ac509299bc28d3b827578915abdb2280e_icgraph.png" border="0" usemap="#atdp__mmu_8c_ac509299bc28d3b827578915abdb2280e_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ac509299bc28d3b827578915abdb2280e_icgraph" id="atdp__mmu_8c_ac509299bc28d3b827578915abdb2280e_icgraph">
<area shape="rect" title=" " alt="" coords="1943,374,2093,401"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1732,374,1895,401"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="1537,241,1684,267"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="1291,521,1489,547"/>
<area shape="rect" href="tdp__mmu_8c.html#a381e22ee819864cf1fd726479a76b6c7" title=" " alt="" coords="1304,105,1476,131"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="1303,241,1477,267"/>
<area shape="rect" href="mmu_8c.html#a85202c8f53b11b1c80f9b6e26210aa9a" title=" " alt="" coords="1057,11,1227,52"/>
<area shape="rect" href="mmu_8c.html#a2683113dbbf42e73c2b52410f9ef6f84" title=" " alt="" coords="765,5,981,47"/>
<area shape="rect" href="mmu_8c.html#a13148d5065ef27624701afcaa3229983" title=" " alt="" coords="497,9,680,35"/>
<area shape="rect" href="x86_8c.html#a91673b399129921871f11d0752eea8c3" title=" " alt="" coords="234,7,411,34"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="1061,353,1223,379"/>
<area shape="rect" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c" title=" " alt="" coords="1089,157,1195,183"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="1073,445,1211,471"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="1065,241,1219,267"/>
<area shape="rect" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580" title=" " alt="" coords="1074,87,1210,114"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="799,353,946,379"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="502,334,675,361"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="473,385,704,427"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="250,342,395,369"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="220,393,425,419"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="234,443,411,470"/>
<area shape="rect" href="tdp__mmu_8c.html#aa53a75612d7b32153949be34f4055144" title=" " alt="" coords="767,129,978,155"/>
<area shape="rect" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d" title=" " alt="" coords="518,129,659,155"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="511,517,667,543"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="774,427,971,454"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="509,451,668,492"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="233,495,413,536"/>
<area shape="rect" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501" title=" " alt="" coords="773,180,973,221"/>
<area shape="rect" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8" title=" " alt="" coords="778,246,967,273"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="501,187,676,214"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="512,241,665,267"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="247,109,398,151"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="224,175,421,216"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="253,241,393,267"/>
<area shape="rect" href="mtrr_8c.html#aca604775fbcfad49bfaf9441fc2253dc" title=" " alt="" coords="271,291,374,318"/>
<area shape="rect" href="tdp__mmu_8c.html#a45fd618d35fb0df14a3401a230f41faa" title=" " alt="" coords="752,74,993,101"/>
<area shape="rect" href="mmu_8c.html#a1f49638b71a482e4b0c3a6af10d0711e" title=" " alt="" coords="493,61,684,103"/>
<area shape="rect" href="page__track_8c.html#ab6a4ffea76ea12eb3b1e83eafaf4618b" title=" " alt="" coords="221,58,425,85"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="1061,631,1223,658"/>
<area shape="rect" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427" title=" " alt="" coords="1057,513,1227,555"/>
<area shape="rect" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d" title=" " alt="" coords="1041,686,1243,713"/>
<area shape="rect" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37" title=" " alt="" coords="1074,579,1210,606"/>
<area shape="rect" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c" title=" " alt="" coords="759,633,986,659"/>
<area shape="rect" href="mmu_8c.html#acb92068f6e948846797ac6814b3618f1" title=" " alt="" coords="225,627,420,668"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="5,627,172,668"/>
<area shape="rect" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf" title=" " alt="" coords="794,685,951,727"/>
<area shape="rect" href="tdp__mmu_8c.html#a3a86994ba17144f60df37ea7682d650b" title=" " alt="" coords="475,688,702,729"/>
<area shape="rect" href="mmu_8c.html#a35da5538a61de05522efdad8f615df4f" title=" " alt="" coords="223,692,422,733"/>
<area shape="rect" href="tdp__mmu_8c.html#a7f6c658f3ddf3ffac5ce96335b78e295" title=" " alt="" coords="773,579,973,606"/>
<area shape="rect" href="mmu_8c.html#a168b7814e68a545abd8bf00fc4466610" title=" " alt="" coords="499,568,679,609"/>
</map>
</div>

</div>
</div>
<a id="a94f5586dfab1d77897564b4b4979da48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94f5586dfab1d77897564b4b4979da48">&#9670;&nbsp;</a></span>kvm_lockdep_assert_mmu_lock_held()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __always_inline bool kvm_lockdep_assert_mmu_lock_held </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00022">22</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">if</span> (shared)</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        lockdep_assert_held_read(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a94f5586dfab1d77897564b4b4979da48_icgraph.png" border="0" usemap="#atdp__mmu_8c_a94f5586dfab1d77897564b4b4979da48_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a94f5586dfab1d77897564b4b4979da48_icgraph" id="atdp__mmu_8c_a94f5586dfab1d77897564b4b4979da48_icgraph">
<area shape="rect" title=" " alt="" coords="3557,129,3713,171"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="2833,71,3013,112"/>
<area shape="rect" href="tdp__mmu_8c.html#aa61edf11261db080cdd6b2bba981310f" title=" " alt="" coords="3340,129,3509,171"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="3351,245,3498,271"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2592,5,2775,47"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2588,71,2779,112"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2341,5,2507,47"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2059,5,2264,47"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="1789,13,2008,39"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1355,231,1498,258"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1073,238,1276,265"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="828,301,1025,327"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="833,238,1021,265"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="609,326,780,353"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="431,326,557,353"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="427,434,561,461"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="14,269,207,295"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="264,459,379,486"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="36,471,185,498"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="28,522,193,549"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="33,573,188,599"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="5,623,216,650"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="25,675,197,716"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="43,319,178,346"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="40,370,181,397"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="46,421,175,447"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2335,71,2513,112"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2083,77,2239,103"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="1819,74,1979,101"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1582,64,1737,105"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="3097,129,3256,171"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="3090,390,3263,417"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="3061,237,3292,279"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="2851,434,2996,461"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="2581,434,2785,461"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="1342,434,1511,461"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="1324,381,1529,407"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="2835,198,3012,225"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="845,377,1009,403"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="623,377,766,403"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="2071,133,2252,175"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="2601,243,2765,284"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="2608,191,2759,218"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="1805,141,1993,167"/>
<area shape="rect" href="x86_8c.html#ae7e25dec8e0af366fb3db41dc9881970" title=" " alt="" coords="2315,245,2533,271"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="2056,238,2267,265"/>
<area shape="rect" href="kvm__main_8c.html#a52d56a5dc447602839375289b5bbffb2" title=" " alt="" coords="1811,238,1987,265"/>
<area shape="rect" href="kvm__main_8c.html#a8c9bd99a64bbedb0930e29ed4dcc7897" title=" " alt="" coords="1577,181,1741,207"/>
<area shape="rect" href="kvm__main_8c.html#ac4ce014a99262ed5672a102c6d2ffdbd" title=" " alt="" coords="1577,231,1741,258"/>
<area shape="rect" href="kvm__main_8c.html#afdb5cea8958921b2ea9bd3a29cf9d7a6" title=" " alt="" coords="1579,282,1739,309"/>
</map>
</div>

</div>
</div>
<a id="ab7552e1b0abe0e2ddb3f91e3f002d9d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7552e1b0abe0e2ddb3f91e3f002d9d9">&#9670;&nbsp;</a></span>kvm_mmu_init_tdp_mmu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_mmu_init_tdp_mmu </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00015">15</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;{</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    INIT_LIST_HEAD(&amp;kvm-&gt;arch.tdp_mmu_roots);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    spin_lock_init(&amp;kvm-&gt;arch.tdp_mmu_pages_lock);</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ab7552e1b0abe0e2ddb3f91e3f002d9d9_icgraph.png" border="0" usemap="#atdp__mmu_8c_ab7552e1b0abe0e2ddb3f91e3f002d9d9_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ab7552e1b0abe0e2ddb3f91e3f002d9d9_icgraph" id="atdp__mmu_8c_ab7552e1b0abe0e2ddb3f91e3f002d9d9_icgraph">
<area shape="rect" title=" " alt="" coords="808,5,997,32"/>
<area shape="rect" href="mmu_8c.html#ab4c98414ab44b654e98c50e06b5ddf23" title=" " alt="" coords="612,5,760,32"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="421,5,564,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="247,5,373,32"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="5,5,199,32"/>
</map>
</div>

</div>
</div>
<a id="a73432bf42fbb3d43b3e04f88cd92b592"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73432bf42fbb3d43b3e04f88cd92b592">&#9670;&nbsp;</a></span>kvm_mmu_uninit_tdp_mmu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_mmu_uninit_tdp_mmu </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00033">33</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">     * Invalidate all roots, which besides the obvious, schedules all roots</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">     * for zapping and thus puts the TDP MMU&#39;s reference to each root, i.e.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">     * ultimately frees all roots.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="tdp__mmu_8c.html#ab4bbd5785998945455f358b7cd9bbafa">kvm_tdp_mmu_invalidate_all_roots</a>(kvm);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797">kvm_tdp_mmu_zap_invalidated_roots</a>(kvm);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    WARN_ON(atomic64_read(&amp;kvm-&gt;arch.tdp_mmu_pages));</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    WARN_ON(!list_empty(&amp;kvm-&gt;arch.tdp_mmu_roots));</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">     * Ensure that all the outstanding RCU callbacks to free shadow pages</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">     * can run before the VM is torn down.  Putting the last reference to</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">     * zapped roots will create new callbacks.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    rcu_barrier();</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a8ab26f4fb05f388d8bcf04ad89ee6797"><div class="ttname"><a href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797">kvm_tdp_mmu_zap_invalidated_roots</a></div><div class="ttdeci">void kvm_tdp_mmu_zap_invalidated_roots(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00856">tdp_mmu.c:856</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_ab4bbd5785998945455f358b7cd9bbafa"><div class="ttname"><a href="tdp__mmu_8c.html#ab4bbd5785998945455f358b7cd9bbafa">kvm_tdp_mmu_invalidate_all_roots</a></div><div class="ttdeci">void kvm_tdp_mmu_invalidate_all_roots(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00901">tdp_mmu.c:901</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a73432bf42fbb3d43b3e04f88cd92b592_cgraph.png" border="0" usemap="#atdp__mmu_8c_a73432bf42fbb3d43b3e04f88cd92b592_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a73432bf42fbb3d43b3e04f88cd92b592_cgraph" id="atdp__mmu_8c_a73432bf42fbb3d43b3e04f88cd92b592_cgraph">
<area shape="rect" title=" " alt="" coords="5,439,211,465"/>
<area shape="rect" href="tdp__mmu_8c.html#ab4bbd5785998945455f358b7cd9bbafa" title=" " alt="" coords="278,398,470,439"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="259,463,489,505"/>
<area shape="rect" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0" title=" " alt="" coords="537,119,719,145"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="555,652,701,679"/>
<area shape="rect" href="tdp__mmu_8h.html#a166bc9e57a26e8a37e94e2314a72d226" title=" " alt="" coords="777,68,918,95"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="2019,107,2186,149"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="2287,115,2426,141"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="767,652,928,679"/>
<area shape="rect" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48" title=" " alt="" coords="769,703,925,745"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2513,731,2688,757"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="980,67,1189,93"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="997,608,1172,635"/>
<area shape="rect" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476" title=" " alt="" coords="976,715,1193,741"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="1241,669,1440,696"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="1253,63,1428,89"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="1488,61,1699,88"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1747,49,1957,90"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="2019,5,2186,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="2009,56,2197,83"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="1267,532,1414,559"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1512,679,1675,705"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="2036,579,2169,605"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="2005,224,2200,251"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1775,799,1929,841"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1777,427,1927,453"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="2551,303,2650,329"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1785,647,1919,673"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1799,697,1905,724"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1795,596,1909,623"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1765,865,1939,892"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1781,748,1923,775"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1761,967,1943,993"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1788,1068,1916,1095"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="2053,1097,2152,1124"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2042,832,2163,859"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="2017,477,2189,504"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="2007,275,2198,301"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="2259,399,2454,441"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="2053,325,2153,352"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="2026,376,2179,403"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="2252,224,2461,251"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="2259,295,2454,337"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2736,303,2837,329"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="2023,629,2182,656"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="2248,680,2465,707"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="2263,731,2450,757"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="2011,883,2195,909"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="2025,781,2180,808"/>
<area shape="rect" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778" title=" " alt="" coords="1263,720,1419,747"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a73432bf42fbb3d43b3e04f88cd92b592_icgraph.png" border="0" usemap="#atdp__mmu_8c_a73432bf42fbb3d43b3e04f88cd92b592_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a73432bf42fbb3d43b3e04f88cd92b592_icgraph" id="atdp__mmu_8c_a73432bf42fbb3d43b3e04f88cd92b592_icgraph">
<area shape="rect" title=" " alt="" coords="1329,157,1535,184"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="1117,157,1281,184"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="899,183,1069,209"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="913,132,1055,159"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="720,132,847,159"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="716,183,851,209"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="303,5,497,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="553,183,668,209"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="325,56,475,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="317,107,483,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="323,157,477,184"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="295,208,505,235"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="314,259,486,301"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="333,325,467,352"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="329,376,471,403"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="335,427,465,453"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="47,56,205,83"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="5,376,247,403"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="59,427,193,453"/>
</map>
</div>

</div>
</div>
<a id="a0a5c7f827057100e08b2f45da804fa30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a5c7f827057100e08b2f45da804fa30">&#9670;&nbsp;</a></span>kvm_tdp_mmu_age_gfn_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_tdp_mmu_age_gfn_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01195">1195</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;{</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="tdp__mmu_8c.html#aee4308cb9e1b221fb73c67c6e8f0e1d1">kvm_tdp_mmu_handle_gfn</a>(kvm, range, <a class="code" href="tdp__mmu_8c.html#a30ae563747c16580e9c760ea701eec6d">age_gfn_range</a>);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a30ae563747c16580e9c760ea701eec6d"><div class="ttname"><a href="tdp__mmu_8c.html#a30ae563747c16580e9c760ea701eec6d">age_gfn_range</a></div><div class="ttdeci">static bool age_gfn_range(struct kvm *kvm, struct tdp_iter *iter, struct kvm_gfn_range *range)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01161">tdp_mmu.c:1161</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_aee4308cb9e1b221fb73c67c6e8f0e1d1"><div class="ttname"><a href="tdp__mmu_8c.html#aee4308cb9e1b221fb73c67c6e8f0e1d1">kvm_tdp_mmu_handle_gfn</a></div><div class="ttdeci">static __always_inline bool kvm_tdp_mmu_handle_gfn(struct kvm *kvm, struct kvm_gfn_range *range, tdp_handler_t handler)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01129">tdp_mmu.c:1129</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a0a5c7f827057100e08b2f45da804fa30_cgraph.png" border="0" usemap="#atdp__mmu_8c_a0a5c7f827057100e08b2f45da804fa30_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a0a5c7f827057100e08b2f45da804fa30_cgraph" id="atdp__mmu_8c_a0a5c7f827057100e08b2f45da804fa30_cgraph">
<area shape="rect" title=" " alt="" coords="5,276,184,317"/>
<area shape="rect" href="tdp__mmu_8c.html#a30ae563747c16580e9c760ea701eec6d" title=" " alt="" coords="272,258,391,284"/>
<area shape="rect" href="tdp__mmu_8c.html#aee4308cb9e1b221fb73c67c6e8f0e1d1" title=" " alt="" coords="232,308,431,335"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1005,43,1139,70"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1479,144,1611,171"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1261,262,1383,288"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="505,142,647,168"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="479,344,673,371"/>
<area shape="rect" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909" title=" " alt="" coords="743,205,909,246"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="527,395,625,422"/>
<area shape="rect" href="tdp__iter_8h.html#a06888df6894eef0e93f82c77b99110b2" title=" " alt="" coords="481,446,671,472"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1243,195,1401,222"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1213,94,1431,120"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1659,144,1833,171"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="749,123,903,150"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="979,94,1165,120"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="721,472,931,499"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="729,406,923,448"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="729,341,923,382"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1023,464,1121,491"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="989,363,1155,390"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1271,464,1373,491"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1237,363,1407,390"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="995,246,1149,288"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a0a5c7f827057100e08b2f45da804fa30_icgraph.png" border="0" usemap="#atdp__mmu_8c_a0a5c7f827057100e08b2f45da804fa30_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a0a5c7f827057100e08b2f45da804fa30_icgraph" id="atdp__mmu_8c_a0a5c7f827057100e08b2f45da804fa30_icgraph">
<area shape="rect" title=" " alt="" coords="164,5,343,47"/>
<area shape="rect" href="mmu_8c.html#a39977aaa99a2eb423e12429a5deb15dc" title=" " alt="" coords="5,13,116,39"/>
</map>
</div>

</div>
</div>
<a id="ad1753c27bb053bc6ac3a3893e10b49f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1753c27bb053bc6ac3a3893e10b49f6">&#9670;&nbsp;</a></span>kvm_tdp_mmu_clear_dirty_pt_masked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_tdp_mmu_clear_dirty_pt_masked </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>wrprot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01629">1629</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;{</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160; </div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a80ff30c938358003552a2b48063b0fee">for_each_tdp_mmu_root</a>(kvm, root, slot-&gt;as_id)</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        <a class="code" href="tdp__mmu_8c.html#a302b8c57cfb6b9bc82a2f68047477145">clear_dirty_pt_masked</a>(kvm, root, <a class="code" href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">gfn</a>, mask, wrprot);</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a302b8c57cfb6b9bc82a2f68047477145"><div class="ttname"><a href="tdp__mmu_8c.html#a302b8c57cfb6b9bc82a2f68047477145">clear_dirty_pt_masked</a></div><div class="ttdeci">static void clear_dirty_pt_masked(struct kvm *kvm, struct kvm_mmu_page *root, gfn_t gfn, unsigned long mask, bool wrprot)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01581">tdp_mmu.c:1581</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a80ff30c938358003552a2b48063b0fee"><div class="ttname"><a href="tdp__mmu_8c.html#a80ff30c938358003552a2b48063b0fee">for_each_tdp_mmu_root</a></div><div class="ttdeci">#define for_each_tdp_mmu_root(_kvm, _root, _as_id)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00174">tdp_mmu.c:174</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ad1753c27bb053bc6ac3a3893e10b49f6_cgraph.png" border="0" usemap="#atdp__mmu_8c_ad1753c27bb053bc6ac3a3893e10b49f6_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_ad1753c27bb053bc6ac3a3893e10b49f6_cgraph" id="atdp__mmu_8c_ad1753c27bb053bc6ac3a3893e10b49f6_cgraph">
<area shape="rect" title=" " alt="" coords="5,99,201,141"/>
<area shape="rect" href="tdp__mmu_8c.html#a302b8c57cfb6b9bc82a2f68047477145" title=" " alt="" coords="249,107,419,133"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="490,5,633,32"/>
<area shape="rect" href="spte_8h.html#a5870e4934206b631c93e08f3ef78b934" title=" " alt="" coords="1413,49,1565,90"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="512,107,611,133"/>
<area shape="rect" href="tdp__iter_8h.html#a06888df6894eef0e93f82c77b99110b2" title=" " alt="" coords="467,157,656,184"/>
<area shape="rect" href="tdp__mmu_8c.html#a8d2a2606fb90f6b6e1a2559d12c04ee8" title=" " alt="" coords="480,217,643,258"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="731,5,886,32"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="961,5,1148,32"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1613,115,1788,141"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="704,107,913,133"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="711,158,906,199"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1005,165,1104,192"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="971,267,1138,293"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1230,165,1331,192"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1201,216,1360,243"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1423,216,1555,243"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1196,317,1365,344"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1220,368,1341,395"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="742,224,875,251"/>
<area shape="rect" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5" title=" " alt="" coords="712,275,905,317"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ad1753c27bb053bc6ac3a3893e10b49f6_icgraph.png" border="0" usemap="#atdp__mmu_8c_ad1753c27bb053bc6ac3a3893e10b49f6_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ad1753c27bb053bc6ac3a3893e10b49f6_icgraph" id="atdp__mmu_8c_ad1753c27bb053bc6ac3a3893e10b49f6_icgraph">
<area shape="rect" title=" " alt="" coords="1080,39,1276,80"/>
<area shape="rect" href="mmu_8c.html#afeee4db4dd885d0e891ccb05f545c876" title=" " alt="" coords="855,5,1023,47"/>
<area shape="rect" href="mmu_8c.html#ace4eaa769a0c9e1f75a3900a51275d18" title=" " alt="" coords="847,71,1032,112"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="620,39,799,80"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="416,46,572,73"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="208,46,368,73"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="5,39,160,80"/>
</map>
</div>

</div>
</div>
<a id="a670804848ccec53148d097c06b44657c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a670804848ccec53148d097c06b44657c">&#9670;&nbsp;</a></span>kvm_tdp_mmu_clear_dirty_slot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_tdp_mmu_clear_dirty_slot </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01560">1560</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;{</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="keywordtype">bool</span> spte_set = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160; </div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    lockdep_assert_held_read(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a3c960568750483d675f0f994ac033a41">for_each_valid_tdp_mmu_root_yield_safe</a>(kvm, root, slot-&gt;as_id)</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        spte_set |= <a class="code" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84">clear_dirty_gfn_range</a>(kvm, root, slot-&gt;base_gfn,</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                slot-&gt;base_gfn + slot-&gt;npages);</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160; </div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    return spte_set;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a3c960568750483d675f0f994ac033a41"><div class="ttname"><a href="tdp__mmu_8c.html#a3c960568750483d675f0f994ac033a41">for_each_valid_tdp_mmu_root_yield_safe</a></div><div class="ttdeci">#define for_each_valid_tdp_mmu_root_yield_safe(_kvm, _root, _as_id)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00159">tdp_mmu.c:159</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a9da9e7ba01717f85966fc080e86ecb84"><div class="ttname"><a href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84">clear_dirty_gfn_range</a></div><div class="ttdeci">static bool clear_dirty_gfn_range(struct kvm *kvm, struct kvm_mmu_page *root, gfn_t start, gfn_t end)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01518">tdp_mmu.c:1518</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a670804848ccec53148d097c06b44657c_cgraph.png" border="0" usemap="#atdp__mmu_8c_a670804848ccec53148d097c06b44657c_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a670804848ccec53148d097c06b44657c_cgraph" id="atdp__mmu_8c_a670804848ccec53148d097c06b44657c_cgraph">
<area shape="rect" title=" " alt="" coords="5,620,232,647"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="280,620,443,647"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1809,275,1907,301"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1771,1055,1945,1081"/>
<area shape="rect" href="spte_8h.html#a5870e4934206b631c93e08f3ef78b934" title=" " alt="" coords="519,1325,671,1366"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="491,59,700,85"/>
<area shape="rect" href="tdp__mmu_8c.html#a8d2a2606fb90f6b6e1a2559d12c04ee8" title=" " alt="" coords="514,583,677,625"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="496,649,695,676"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1993,275,2095,301"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="757,55,932,81"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="989,53,1200,80"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1251,45,1462,86"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1535,5,1701,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1524,56,1712,83"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="778,532,911,559"/>
<area shape="rect" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5" title=" " alt="" coords="748,583,941,625"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="763,852,926,879"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1290,700,1423,727"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1017,1207,1172,1249"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1019,532,1170,559"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1027,1105,1162,1132"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1042,1156,1147,1183"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1038,751,1151,777"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1008,953,1181,980"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1023,903,1166,929"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1004,1004,1185,1031"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1031,801,1159,828"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1307,953,1406,980"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1296,1215,1417,1241"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1271,329,1443,356"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1261,431,1452,457"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1259,380,1454,407"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1521,498,1715,539"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1307,532,1407,559"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1273,583,1440,625"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1280,279,1433,305"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1535,329,1701,356"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1513,447,1723,473"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1521,381,1715,422"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1553,564,1683,591"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1549,615,1687,641"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1519,279,1717,305"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1541,213,1695,254"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1277,1105,1436,1132"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1248,1055,1465,1081"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1552,1105,1684,1132"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1263,1156,1450,1183"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1265,1004,1449,1031"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1525,953,1711,980"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1279,903,1434,929"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a670804848ccec53148d097c06b44657c_icgraph.png" border="0" usemap="#atdp__mmu_8c_a670804848ccec53148d097c06b44657c_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a670804848ccec53148d097c06b44657c_icgraph" id="atdp__mmu_8c_a670804848ccec53148d097c06b44657c_icgraph">
<area shape="rect" title=" " alt="" coords="3076,232,3303,259"/>
<area shape="rect" href="mmu_8c.html#acb92068f6e948846797ac6814b3618f1" title=" " alt="" coords="2833,225,3028,266"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2619,225,2785,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2365,225,2571,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2099,232,2317,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1908,232,2051,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
</map>
</div>

</div>
</div>
<a id="ab831f739cbe511803c4752d84ffab75c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab831f739cbe511803c4752d84ffab75c">&#9670;&nbsp;</a></span>kvm_tdp_mmu_fast_pf_get_last_sptep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64* kvm_tdp_mmu_fast_pf_get_last_sptep </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64 *&#160;</td>
          <td class="paramname"><em>spte</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01795">1795</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;{</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="keyword">struct </span>kvm_mmu *mmu = vcpu-&gt;arch.mmu;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    gfn_t gfn = addr &gt;&gt; PAGE_SHIFT;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <a class="code" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a> sptep = NULL;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160; </div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a9784c3e281a9a5a1c7fe6ea1f806e8f2">tdp_mmu_for_each_pte</a>(iter, mmu, gfn, gfn + 1) {</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        *spte = iter.old_spte;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        sptep = iter.sptep;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    }</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160; </div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">     * Perform the rcu_dereference to get the raw spte pointer value since</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">     * we are passing it up to fast_page_fault, which is shared with the</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">     * legacy MMU and thus does not retain the TDP MMU-specific __rcu</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment">     * annotation.</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment">     * This is safe since fast_page_fault obeys the contracts of this</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">     * function as well as all TDP MMU contracts around modifying SPTEs</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">     * outside of mmu_lock.</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="keywordflow">return</span> rcu_dereference(sptep);</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a9784c3e281a9a5a1c7fe6ea1f806e8f2"><div class="ttname"><a href="tdp__mmu_8c.html#a9784c3e281a9a5a1c7fe6ea1f806e8f2">tdp_mmu_for_each_pte</a></div><div class="ttdeci">#define tdp_mmu_for_each_pte(_iter, _mmu, _start, _end)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00631">tdp_mmu.c:631</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ab831f739cbe511803c4752d84ffab75c_icgraph.png" border="0" usemap="#atdp__mmu_8c_ab831f739cbe511803c4752d84ffab75c_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ab831f739cbe511803c4752d84ffab75c_icgraph" id="atdp__mmu_8c_ab831f739cbe511803c4752d84ffab75c_icgraph">
<area shape="rect" title=" " alt="" coords="2705,543,2877,585"/>
<area shape="rect" href="mmu_8c.html#a19bf28eb1ca5198dc125fd42f26c789e" title=" " alt="" coords="2535,551,2657,577"/>
<area shape="rect" href="mmu_8c.html#aebe1e577e70e9f77f0bfea48bab7c83d" title=" " alt="" coords="2352,551,2487,577"/>
<area shape="rect" href="mmu_8c.html#a4bd7a8fd81e65c4e06e025d92c5787d9" title=" " alt="" coords="1441,521,1596,548"/>
<area shape="rect" href="mmu_8c.html#a925050134bb3c589bb55b63993ddacb1" title=" " alt="" coords="2137,576,2304,603"/>
<area shape="rect" href="mmu_8c.html#a2346100ce00fd4d842c51c4be6cbfe35" title=" " alt="" coords="1199,521,1347,548"/>
<area shape="rect" href="mmu__internal_8h.html#ae3c71be306692107b4d90bfb8d24d7f5" title=" " alt="" coords="1177,233,1368,260"/>
<area shape="rect" href="mmu_8c.html#a88ade1c65bbbb9b25a78e82003a71a7c" title=" " alt="" coords="984,639,1104,665"/>
<area shape="rect" href="x86_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="255,385,427,412"/>
<area shape="rect" href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f" title=" " alt="" coords="723,613,911,640"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="505,832,645,859"/>
<area shape="rect" href="svm_2nested_8c.html#a2d996c5be366f0a7b21228fd18be85ab" title=" " alt="" coords="735,908,898,935"/>
<area shape="rect" href="vmx_2nested_8c.html#a6541b63ab236a1d9732c8ffc3c604ee9" title=" " alt="" coords="735,1035,899,1061"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="5,385,205,412"/>
<area shape="rect" href="x86_8c.html#ac766943d4a9d3c7a489012c02e25be54" title=" " alt="" coords="526,613,625,640"/>
<area shape="rect" href="x86_8c.html#a48bee74c7062ceb8db0b0fa3beebfbbc" title=" " alt="" coords="522,731,629,757"/>
<area shape="rect" href="smm_8c.html#ae1445727a8459a6cc7d2e49e5a63c0d5" title=" " alt="" coords="293,533,389,560"/>
<area shape="rect" href="mmu_8c.html#a3b03fb05a1055f336fa61182cf0c760b" title=" " alt="" coords="476,461,675,488"/>
<area shape="rect" href="x86_8c.html#afb193fb2b1c3f240d0ad5a5378afc118" title=" " alt="" coords="505,781,645,808"/>
<area shape="rect" href="smm_8c.html#a5382946234c910e05c6e2c09aff15713" title=" " alt="" coords="499,563,652,589"/>
<area shape="rect" href="x86_8c.html#a2694456104c02a7204796d89d13a1e91" title=" " alt="" coords="511,411,640,437"/>
<area shape="rect" href="vmx_2nested_8c.html#a001f930db9a867e828cf01b48d3e4e25" title=" " alt="" coords="498,665,653,706"/>
<area shape="rect" href="x86_8c.html#a420caf80521ab8d6ef7218d5dd26d47f" title=" " alt="" coords="538,360,613,387"/>
<area shape="rect" href="x86_8c.html#adfaccb9ae903e8b5aee77f8591d51dc9" title=" " alt="" coords="261,606,420,647"/>
<area shape="rect" href="svm_8c.html#af4590239d3e0b5fbad189a245207dfaa" title=" " alt="" coords="307,781,374,808"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="288,832,393,859"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="253,284,428,311"/>
<area shape="rect" href="svm_2nested_8c.html#a9b21378a3de8baae9bcb689f00cad48e" title=" " alt="" coords="486,883,665,909"/>
<area shape="rect" href="svm_2nested_8c.html#a73d1cb9b9fcfa112138681d9080a1c05" title=" " alt="" coords="498,933,653,960"/>
<area shape="rect" href="svm_2nested_8c.html#a8bac395de612ca2b748016c6f5ea0fef" title=" " alt="" coords="491,984,659,1011"/>
<area shape="rect" href="vmx_2nested_8c.html#a06a397c328d1656bb4d3ab073878e6f0" title=" " alt="" coords="484,1035,667,1061"/>
<area shape="rect" href="vmx_2nested_8c.html#a27bdf4f6bbd476189cb0198a634394f5" title=" " alt="" coords="510,1085,641,1112"/>
<area shape="rect" href="mmu_8c.html#a339656816251af93fbd52aece22a2009" title=" " alt="" coords="959,226,1129,267"/>
<area shape="rect" href="mmu_8c.html#a3d0bd209d792a4316f3b40681fdc10f9" title=" " alt="" coords="960,107,1128,133"/>
<area shape="rect" href="async__pf_8c.html#aac6395172fbf7947412604d7e2f33417" title=" " alt="" coords="736,226,897,267"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="507,208,644,235"/>
<area shape="rect" href="vmx_8c.html#a8acbb27feacd0dd2105ccd2957cab474" title=" " alt="" coords="735,56,899,83"/>
<area shape="rect" href="vmx_8c.html#a55a56c6fe3cbee7ead4da26de4074000" title=" " alt="" coords="737,107,896,133"/>
<area shape="rect" href="mmu_8c.html#a4d6f2ec540cbdb86e2594df2e4d453c2" title=" " alt="" coords="727,157,906,184"/>
<area shape="rect" href="svm_8c.html#a723646ac5d3234ba8e1845249e6a0935" title=" " alt="" coords="753,5,881,32"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="501,56,649,83"/>
<area shape="rect" href="vmx_8c.html#a7a38ddbd01bec99bf94ab4868ad4c6ea" title=" " alt="" coords="491,107,660,133"/>
<area shape="rect" href="svm_8c.html#a589e870c8a06d1ba26f24da299e47b95" title=" " alt="" coords="515,157,635,184"/>
<area shape="rect" href="svm_8c.html#a8afafecae406016532810194f187fe2c" title=" " alt="" coords="481,5,669,32"/>
<area shape="rect" href="mmu_8c.html#afd5a07eceb08a73f2ef1f4d643d67397" title=" " alt="" coords="1915,577,2089,604"/>
<area shape="rect" href="mmu_8c.html#abd9285ed33f21279b97f214287ab49bf" title=" " alt="" coords="1669,580,1867,607"/>
<area shape="rect" href="mmu_8c.html#a3e794d802eeb843cd6d7b699b74d8bf3" title=" " alt="" coords="1430,635,1607,661"/>
<area shape="rect" href="mmu_8c.html#a00f26353045c597f6a49cdd4f239f548" title=" " alt="" coords="1416,580,1621,607"/>
<area shape="rect" href="mmu_8c.html#a37d0224d142272ad59fd35b4a22c5937" title=" " alt="" coords="1201,639,1345,665"/>
<area shape="rect" href="svm_2nested_8c.html#a962af1ea814d32a42ada9f601918cee5" title=" " alt="" coords="1187,573,1358,614"/>
</map>
</div>

</div>
</div>
<a id="ae643f902f826e920f4150bb66872fd47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae643f902f826e920f4150bb66872fd47">&#9670;&nbsp;</a></span>kvm_tdp_mmu_get_vcpu_root_hpa()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hpa_t kvm_tdp_mmu_get_vcpu_root_hpa </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00219">219</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;{</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keyword">union </span>kvm_mmu_page_role role = vcpu-&gt;arch.mmu-&gt;root_role;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">     * Check for an existing root before allocating a new one.  Note, the</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">     * role check prevents consuming an invalid root.</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a80ff30c938358003552a2b48063b0fee">for_each_tdp_mmu_root</a>(kvm, root, <a class="code" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac">kvm_mmu_role_as_id</a>(<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>)) {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">if</span> (root-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.word == <a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.word &amp;&amp;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <a class="code" href="tdp__mmu_8h.html#ae8fe85fef7c2fb884cd2d27810a84d0b">kvm_tdp_mmu_get_root</a>(root))</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    root = <a class="code" href="tdp__mmu_8c.html#aab91e6aa4615cd9bf4f66141ca34642b">tdp_mmu_alloc_sp</a>(vcpu);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a8d6f094dd9ef458c1c57aee653afd602">tdp_mmu_init_sp</a>(root, NULL, 0, <a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">     * TDP MMU roots are kept until they are explicitly invalidated, either</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">     * by a memslot update or by the destruction of the VM.  Initialize the</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">     * refcount to two; one reference for the vCPU, and one reference for</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">     * the TDP MMU itself, which is held until the root is invalidated and</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">     * is ultimately put by kvm_tdp_mmu_zap_invalidated_roots().</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    refcount_set(&amp;root-&gt;<a class="code" href="structkvm__mmu__page.html#a41397fd72948cc7002b169d2fb3aba5f">tdp_mmu_root_count</a>, 2);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    spin_lock(&amp;kvm-&gt;arch.tdp_mmu_pages_lock);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    list_add_rcu(&amp;root-&gt;<a class="code" href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">link</a>, &amp;kvm-&gt;arch.tdp_mmu_roots);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    spin_unlock(&amp;kvm-&gt;arch.tdp_mmu_pages_lock);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;out:</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">return</span> __pa(root-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a>);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div>
<div class="ttc" id="ammu__internal_8h_html_a5334557775f77a151865c95f1cd224ac"><div class="ttname"><a href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac">kvm_mmu_role_as_id</a></div><div class="ttdeci">static int kvm_mmu_role_as_id(union kvm_mmu_page_role role)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00138">mmu_internal.h:138</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a41397fd72948cc7002b169d2fb3aba5f"><div class="ttname"><a href="structkvm__mmu__page.html#a41397fd72948cc7002b169d2fb3aba5f">kvm_mmu_page::tdp_mmu_root_count</a></div><div class="ttdeci">refcount_t tdp_mmu_root_count</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00102">mmu_internal.h:102</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_aa5dc0ace123000668489891db69aa600"><div class="ttname"><a href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">kvm_mmu_page::link</a></div><div class="ttdeci">struct list_head link</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00351">mmu_internal.h:57</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a8d6f094dd9ef458c1c57aee653afd602"><div class="ttname"><a href="tdp__mmu_8c.html#a8d6f094dd9ef458c1c57aee653afd602">tdp_mmu_init_sp</a></div><div class="ttdeci">static void tdp_mmu_init_sp(struct kvm_mmu_page *sp, tdp_ptep_t sptep, gfn_t gfn, union kvm_mmu_page_role role)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00190">tdp_mmu.c:190</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_aab91e6aa4615cd9bf4f66141ca34642b"><div class="ttname"><a href="tdp__mmu_8c.html#aab91e6aa4615cd9bf4f66141ca34642b">tdp_mmu_alloc_sp</a></div><div class="ttdeci">static struct kvm_mmu_page * tdp_mmu_alloc_sp(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00180">tdp_mmu.c:180</a></div></div>
<div class="ttc" id="atdp__mmu_8h_html_ae8fe85fef7c2fb884cd2d27810a84d0b"><div class="ttname"><a href="tdp__mmu_8h.html#ae8fe85fef7c2fb884cd2d27810a84d0b">kvm_tdp_mmu_get_root</a></div><div class="ttdeci">static __must_check bool kvm_tdp_mmu_get_root(struct kvm_mmu_page *root)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8h_source.html#l00015">tdp_mmu.h:15</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ae643f902f826e920f4150bb66872fd47_cgraph.png" border="0" usemap="#atdp__mmu_8c_ae643f902f826e920f4150bb66872fd47_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_ae643f902f826e920f4150bb66872fd47_cgraph" id="atdp__mmu_8c_ae643f902f826e920f4150bb66872fd47_cgraph">
<area shape="rect" title=" " alt="" coords="5,74,192,115"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="248,5,413,32"/>
<area shape="rect" href="tdp__mmu_8h.html#ae8fe85fef7c2fb884cd2d27810a84d0b" title=" " alt="" coords="240,56,421,83"/>
<area shape="rect" href="tdp__mmu_8c.html#aab91e6aa4615cd9bf4f66141ca34642b" title=" " alt="" coords="259,107,403,133"/>
<area shape="rect" href="tdp__mmu_8c.html#a8d6f094dd9ef458c1c57aee653afd602" title=" " alt="" coords="263,157,398,184"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ae643f902f826e920f4150bb66872fd47_icgraph.png" border="0" usemap="#atdp__mmu_8c_ae643f902f826e920f4150bb66872fd47_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ae643f902f826e920f4150bb66872fd47_icgraph" id="atdp__mmu_8c_ae643f902f826e920f4150bb66872fd47_icgraph">
<area shape="rect" title=" " alt="" coords="1811,99,1997,141"/>
<area shape="rect" href="mmu_8c.html#a171383889d717b24003ee27735437bbe" title=" " alt="" coords="1584,107,1763,133"/>
<area shape="rect" href="mmu_8c.html#a475bd00898314bb9378d8e4306aa7874" title=" " alt="" coords="1409,107,1536,133"/>
<area shape="rect" href="mmu_8h.html#ab0e194ecad859add3d639850021f8b16" title=" " alt="" coords="1221,107,1361,133"/>
<area shape="rect" href="mmu_8c.html#a339656816251af93fbd52aece22a2009" title=" " alt="" coords="1003,70,1173,111"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="589,136,727,163"/>
<area shape="rect" href="async__pf_8c.html#aac6395172fbf7947412604d7e2f33417" title=" " alt="" coords="793,70,955,111"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="571,67,745,93"/>
<area shape="rect" href="svm_8c.html#acb46126747f78036462437a7bcdc2e47" title=" " alt="" coords="427,5,508,32"/>
<area shape="rect" href="svm_8c.html#aac18b9094154a2c8b8e27c3b08c9e359" title=" " alt="" coords="413,56,522,83"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="412,107,523,133"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="427,157,508,184"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,157,364,184"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,157,129,184"/>
</map>
</div>

</div>
</div>
<a id="a9a34a882b3a9c5607394395bc988b804"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a34a882b3a9c5607394395bc988b804">&#9670;&nbsp;</a></span>kvm_tdp_mmu_get_walk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_tdp_mmu_get_walk </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64 *&#160;</td>
          <td class="paramname"><em>sptes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>root_level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01766">1766</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;{</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keyword">struct </span>kvm_mmu *mmu = vcpu-&gt;arch.mmu;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    gfn_t gfn = addr &gt;&gt; PAGE_SHIFT;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordtype">int</span> leaf = -1;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160; </div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    *root_level = vcpu-&gt;arch.mmu-&gt;root_role.<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160; </div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a9784c3e281a9a5a1c7fe6ea1f806e8f2">tdp_mmu_for_each_pte</a>(iter, mmu, gfn, gfn + 1) {</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        leaf = iter.level;</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        sptes[leaf] = iter.old_spte;</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    }</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160; </div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="keywordflow">return</span> leaf;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a9a34a882b3a9c5607394395bc988b804_icgraph.png" border="0" usemap="#atdp__mmu_8c_a9a34a882b3a9c5607394395bc988b804_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a9a34a882b3a9c5607394395bc988b804_icgraph" id="atdp__mmu_8c_a9a34a882b3a9c5607394395bc988b804_icgraph">
<area shape="rect" title=" " alt="" coords="1500,81,1687,108"/>
<area shape="rect" href="mmu_8c.html#a24c91b8ae0a349c76c95f6266f62d6e1" title=" " alt="" coords="1329,81,1452,108"/>
<area shape="rect" href="mmu_8c.html#a899cf46c0ee6df6305c7fe167421e2b7" title=" " alt="" coords="1095,81,1281,108"/>
<area shape="rect" href="mmu_8c.html#a3d0bd209d792a4316f3b40681fdc10f9" title=" " alt="" coords="879,81,1047,108"/>
<area shape="rect" href="vmx_8c.html#a8acbb27feacd0dd2105ccd2957cab474" title=" " alt="" coords="659,5,823,32"/>
<area shape="rect" href="vmx_8c.html#a55a56c6fe3cbee7ead4da26de4074000" title=" " alt="" coords="662,56,821,83"/>
<area shape="rect" href="mmu_8c.html#a4d6f2ec540cbdb86e2594df2e4d453c2" title=" " alt="" coords="652,107,831,133"/>
<area shape="rect" href="svm_8c.html#a723646ac5d3234ba8e1845249e6a0935" title=" " alt="" coords="677,157,805,184"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="436,5,584,32"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="222,5,357,32"/>
<area shape="rect" href="vmx_8c.html#a7a38ddbd01bec99bf94ab4868ad4c6ea" title=" " alt="" coords="425,56,595,83"/>
<area shape="rect" href="svm_8c.html#a589e870c8a06d1ba26f24da299e47b95" title=" " alt="" coords="450,107,570,133"/>
<area shape="rect" href="svm_8c.html#a8afafecae406016532810194f187fe2c" title=" " alt="" coords="416,157,604,184"/>
<area shape="rect" href="sev_8c.html#aac550422551b71c0afe8efe176e0b55d" title=" " alt="" coords="5,128,163,155"/>
<area shape="rect" href="sev_8c.html#ae483e70b55c68f5a2405263543ce3737" title=" " alt="" coords="211,150,368,191"/>
<area shape="rect" href="svm_8c.html#a3f8983432f4aae138a6f4d167c561132" title=" " alt="" coords="223,216,356,243"/>
</map>
</div>

</div>
</div>
<a id="aee4308cb9e1b221fb73c67c6e8f0e1d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee4308cb9e1b221fb73c67c6e8f0e1d1">&#9670;&nbsp;</a></span>kvm_tdp_mmu_handle_gfn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static __always_inline bool kvm_tdp_mmu_handle_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tdp__mmu_8c.html#a23cd686f18bfd24a24a5d89c25b74385">tdp_handler_t</a>&#160;</td>
          <td class="paramname"><em>handler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01129">1129</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;{</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160; </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">     * Don&#39;t support rescheduling, none of the MMU notifiers that funnel</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">     * into this helper allow blocking; it&#39;d be dead, wasteful code.</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a80ff30c938358003552a2b48063b0fee">for_each_tdp_mmu_root</a>(kvm, root, range-&gt;slot-&gt;as_id) {</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        rcu_read_lock();</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <a class="code" href="tdp__mmu_8c.html#a05d1e6fdfa42b23ebcea4b55ff41256d">tdp_root_for_each_leaf_pte</a>(iter, root, range-&gt;start, range-&gt;end)</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            ret |= handler(kvm, &amp;iter, range);</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160; </div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        rcu_read_unlock();</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    }</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160; </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    return ret;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aee4308cb9e1b221fb73c67c6e8f0e1d1_icgraph.png" border="0" usemap="#atdp__mmu_8c_aee4308cb9e1b221fb73c67c6e8f0e1d1_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aee4308cb9e1b221fb73c67c6e8f0e1d1_icgraph" id="atdp__mmu_8c_aee4308cb9e1b221fb73c67c6e8f0e1d1_icgraph">
<area shape="rect" title=" " alt="" coords="455,71,653,98"/>
<area shape="rect" href="tdp__mmu_8c.html#a0a5c7f827057100e08b2f45da804fa30" title=" " alt="" coords="212,5,391,47"/>
<area shape="rect" href="tdp__mmu_8c.html#aa53a75612d7b32153949be34f4055144" title=" " alt="" coords="196,71,407,98"/>
<area shape="rect" href="tdp__mmu_8c.html#a78b4b5fbbd5f7b9fc997fef12a5ff92b" title=" " alt="" coords="196,122,407,149"/>
<area shape="rect" href="mmu_8c.html#a39977aaa99a2eb423e12429a5deb15dc" title=" " alt="" coords="21,13,132,39"/>
<area shape="rect" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d" title=" " alt="" coords="6,71,147,98"/>
<area shape="rect" href="mmu_8c.html#a7045f4df80d26474c5fe995d02eebc35" title=" " alt="" coords="5,122,148,149"/>
</map>
</div>

</div>
</div>
<a id="ab4bbd5785998945455f358b7cd9bbafa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4bbd5785998945455f358b7cd9bbafa">&#9670;&nbsp;</a></span>kvm_tdp_mmu_invalidate_all_roots()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_tdp_mmu_invalidate_all_roots </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00901">901</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;{</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">     * mmu_lock must be held for write to ensure that a root doesn&#39;t become</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">     * invalid while there are active readers (invalidating a root while</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">     * there are active readers may or may not be problematic in practice,</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">     * but it&#39;s uncharted territory and not supported).</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">     * Waive the assertion if there are no users of @kvm, i.e. the VM is</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">     * being destroyed after all references have been put, or if no vCPUs</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">     * have been created (which means there are no roots), i.e. the VM is</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">     * being destroyed in an error path of KVM_CREATE_VM.</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_PROVE_LOCKING) &amp;&amp;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        refcount_read(&amp;kvm-&gt;users_count) &amp;&amp; kvm-&gt;created_vcpus)</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">     * As above, mmu_lock isn&#39;t held when destroying the VM!  There can&#39;t</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">     * be other references to @kvm, i.e. nothing else can invalidate roots</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">     * or get/put references to roots.</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    list_for_each_entry(root, &amp;kvm-&gt;arch.tdp_mmu_roots, <a class="code" href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">link</a>) {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">         * Note, invalid roots can outlive a memslot update!  Invalid</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">         * roots must be *zapped* before the memslot update completes,</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">         * but a different task can acquire a reference and keep the</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">         * root alive after its been zapped.</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">if</span> (!root-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.invalid) {</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            root-&gt;<a class="code" href="structkvm__mmu__page.html#a4be3912894be6a937cad4c54708edaa4">tdp_mmu_scheduled_root_to_zap</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            root-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.invalid = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        }</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    }</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;}</div>
<div class="ttc" id="astructkvm__mmu__page_html_a4be3912894be6a937cad4c54708edaa4"><div class="ttname"><a href="structkvm__mmu__page.html#a4be3912894be6a937cad4c54708edaa4">kvm_mmu_page::tdp_mmu_scheduled_root_to_zap</a></div><div class="ttdeci">bool tdp_mmu_scheduled_root_to_zap</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00066">mmu_internal.h:66</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ab4bbd5785998945455f358b7cd9bbafa_icgraph.png" border="0" usemap="#atdp__mmu_8c_ab4bbd5785998945455f358b7cd9bbafa_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ab4bbd5785998945455f358b7cd9bbafa_icgraph" id="atdp__mmu_8c_ab4bbd5785998945455f358b7cd9bbafa_icgraph">
<area shape="rect" title=" " alt="" coords="3580,271,3772,313"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="3327,233,3532,260"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="3341,304,3518,331"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="1429,212,1593,239"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,212,1338,239"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="1181,161,1324,188"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="939,161,1065,188"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,212,1069,239"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,5,669,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,212,851,239"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,56,647,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,107,655,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,157,649,184"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,208,677,235"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,259,658,301"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,325,639,352"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,376,643,403"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,427,637,453"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,56,377,83"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,376,419,403"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,427,365,453"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="2867,267,3048,309"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="3115,326,3279,367"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="3121,392,3272,419"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="2353,279,2541,305"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1908,431,2051,457"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,432,1860,459"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,432,1609,459"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,537,1605,564"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,381,1345,408"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,432,1359,459"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,483,1364,509"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,533,1323,560"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,407,1071,433"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,457,1089,484"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,471,851,497"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,477,640,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,508,1093,535"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,521,863,548"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,585,1354,626"/>
<area shape="rect" href="x86_8c.html#ae7e25dec8e0af366fb3db41dc9881970" title=" " alt="" coords="2848,333,3067,360"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="2589,333,2800,360"/>
<area shape="rect" href="kvm__main_8c.html#a52d56a5dc447602839375289b5bbffb2" title=" " alt="" coords="2359,405,2535,432"/>
<area shape="rect" href="kvm__main_8c.html#a8c9bd99a64bbedb0930e29ed4dcc7897" title=" " alt="" coords="2120,380,2284,407"/>
<area shape="rect" href="kvm__main_8c.html#ac4ce014a99262ed5672a102c6d2ffdbd" title=" " alt="" coords="2120,431,2284,457"/>
<area shape="rect" href="kvm__main_8c.html#afdb5cea8958921b2ea9bd3a29cf9d7a6" title=" " alt="" coords="2122,481,2282,508"/>
<area shape="rect" href="kvm__main_8c.html#a192569033b972982f6b53e13666ef82b" title=" " alt="" coords="2099,532,2305,559"/>
</map>
</div>

</div>
</div>
<a id="ad2479228afe629631e4f0331c440a4d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2479228afe629631e4f0331c440a4d6">&#9670;&nbsp;</a></span>kvm_tdp_mmu_map()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_tdp_mmu_map </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__page__fault.html">kvm_page_fault</a> *&#160;</td>
          <td class="paramname"><em>fault</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01032">1032</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;{</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keyword">struct </span>kvm_mmu *mmu = vcpu-&gt;arch.mmu;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordtype">int</span> ret = <a class="code" href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da5f8c25625c45554fecc5a5b95e63a2e5">RET_PF_RETRY</a>;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <a class="code" href="mmu_8c.html#ab3ace8d82fe9d5e1653277159c5ad4df">kvm_mmu_hugepage_adjust</a>(vcpu, fault);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    trace_kvm_mmu_spte_requested(fault);</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160; </div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a9784c3e281a9a5a1c7fe6ea1f806e8f2">tdp_mmu_for_each_pte</a>(iter, mmu, fault-&gt;<a class="code" href="structkvm__page__fault.html#a27031ff0dd2c0b28283774456a29f066">gfn</a>, fault-&gt;<a class="code" href="structkvm__page__fault.html#a27031ff0dd2c0b28283774456a29f066">gfn</a> + 1) {</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="keywordtype">int</span> r;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="keywordflow">if</span> (fault-&gt;<a class="code" href="structkvm__page__fault.html#a8c1b32bdc3f59a2c3ffca8cc919b5ef3">nx_huge_page_workaround_enabled</a>)</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            <a class="code" href="mmu_8c.html#ae810dbeb6cd413090f54ca0cf864fe49">disallowed_hugepage_adjust</a>(fault, iter.old_spte, iter.level);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">         * If SPTE has been frozen by another thread, just give up and</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">         * retry, avoiding unnecessary page table allocation and free.</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b">is_removed_spte</a>(iter.old_spte))</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            <span class="keywordflow">goto</span> retry;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160; </div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="keywordflow">if</span> (iter.level == fault-&gt;<a class="code" href="structkvm__page__fault.html#ad6705ad5f00efe4e9e47328860e9634a">goal_level</a>)</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            <span class="keywordflow">goto</span> map_target_level;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="comment">/* Step down into the lower level page table if it exists. */</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter.old_spte) &amp;&amp;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;            !<a class="code" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729">is_large_pte</a>(iter.old_spte))</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">         * The SPTE is either non-present or points to a huge page that</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">         * needs to be split.</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        sp = <a class="code" href="tdp__mmu_8c.html#aab91e6aa4615cd9bf4f66141ca34642b">tdp_mmu_alloc_sp</a>(vcpu);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <a class="code" href="tdp__mmu_8c.html#a502cd8b971218c38ecd999409fc15ee3">tdp_mmu_init_child_sp</a>(sp, &amp;iter);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        sp-&gt;<a class="code" href="structkvm__mmu__page.html#a48fdf70976937b2e4cc3e8265ffa5676">nx_huge_page_disallowed</a> = fault-&gt;<a class="code" href="structkvm__page__fault.html#a421a772100b124af81fb35768801c6bc">huge_page_disallowed</a>;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter.old_spte))</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            r = <a class="code" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61">tdp_mmu_split_huge_page</a>(kvm, &amp;iter, sp, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            r = <a class="code" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06">tdp_mmu_link_sp</a>(kvm, &amp;iter, sp, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">         * Force the guest to retry if installing an upper level SPTE</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">         * failed, e.g. because a different task modified the SPTE.</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        <span class="keywordflow">if</span> (r) {</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            <a class="code" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b">tdp_mmu_free_sp</a>(sp);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <span class="keywordflow">goto</span> retry;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        }</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160; </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">if</span> (fault-&gt;<a class="code" href="structkvm__page__fault.html#a421a772100b124af81fb35768801c6bc">huge_page_disallowed</a> &amp;&amp;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            fault-&gt;<a class="code" href="structkvm__page__fault.html#a8ffa43a08e1131c59b2597d86a616b26">req_level</a> &gt;= iter.level) {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            spin_lock(&amp;kvm-&gt;arch.tdp_mmu_pages_lock);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <span class="keywordflow">if</span> (sp-&gt;<a class="code" href="structkvm__mmu__page.html#a48fdf70976937b2e4cc3e8265ffa5676">nx_huge_page_disallowed</a>)</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                <a class="code" href="mmu_8c.html#ad3e86bf491c8c2726e3bc6702166cfdf">track_possible_nx_huge_page</a>(kvm, sp);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            spin_unlock(&amp;kvm-&gt;arch.tdp_mmu_pages_lock);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">     * The walk aborted before reaching the target level, e.g. because the</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">     * iterator detected an upper level SPTE was frozen during traversal.</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    WARN_ON_ONCE(iter.level == fault-&gt;<a class="code" href="structkvm__page__fault.html#ad6705ad5f00efe4e9e47328860e9634a">goal_level</a>);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="keywordflow">goto</span> retry;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;map_target_level:</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    ret = <a class="code" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427">tdp_mmu_map_handle_target_level</a>(vcpu, fault, &amp;iter);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160; </div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;retry:</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_ab3ace8d82fe9d5e1653277159c5ad4df"><div class="ttname"><a href="mmu_8c.html#ab3ace8d82fe9d5e1653277159c5ad4df">kvm_mmu_hugepage_adjust</a></div><div class="ttdeci">void kvm_mmu_hugepage_adjust(struct kvm_vcpu *vcpu, struct kvm_page_fault *fault)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l03180">mmu.c:3180</a></div></div>
<div class="ttc" id="ammu_8c_html_ad3e86bf491c8c2726e3bc6702166cfdf"><div class="ttname"><a href="mmu_8c.html#ad3e86bf491c8c2726e3bc6702166cfdf">track_possible_nx_huge_page</a></div><div class="ttdeci">void track_possible_nx_huge_page(struct kvm *kvm, struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00848">mmu.c:848</a></div></div>
<div class="ttc" id="ammu_8c_html_ae810dbeb6cd413090f54ca0cf864fe49"><div class="ttname"><a href="mmu_8c.html#ae810dbeb6cd413090f54ca0cf864fe49">disallowed_hugepage_adjust</a></div><div class="ttdeci">void disallowed_hugepage_adjust(struct kvm_page_fault *fault, u64 spte, int cur_level)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l03216">mmu.c:3216</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da5f8c25625c45554fecc5a5b95e63a2e5"><div class="ttname"><a href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da5f8c25625c45554fecc5a5b95e63a2e5">RET_PF_RETRY</a></div><div class="ttdeci">@ RET_PF_RETRY</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00275">mmu_internal.h:275</a></div></div>
<div class="ttc" id="aspte_8h_html_ae9b1a94fccf74f0837e1a775bc57d729"><div class="ttname"><a href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729">is_large_pte</a></div><div class="ttdeci">static bool is_large_pte(u64 pte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00313">spte.h:313</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a48fdf70976937b2e4cc3e8265ffa5676"><div class="ttname"><a href="structkvm__mmu__page.html#a48fdf70976937b2e4cc3e8265ffa5676">kvm_mmu_page::nx_huge_page_disallowed</a></div><div class="ttdeci">bool nx_huge_page_disallowed</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00074">mmu_internal.h:74</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a27031ff0dd2c0b28283774456a29f066"><div class="ttname"><a href="structkvm__page__fault.html#a27031ff0dd2c0b28283774456a29f066">kvm_page_fault::gfn</a></div><div class="ttdeci">gfn_t gfn</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00233">mmu_internal.h:233</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a421a772100b124af81fb35768801c6bc"><div class="ttname"><a href="structkvm__page__fault.html#a421a772100b124af81fb35768801c6bc">kvm_page_fault::huge_page_disallowed</a></div><div class="ttdeci">bool huge_page_disallowed</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00212">mmu_internal.h:212</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a8c1b32bdc3f59a2c3ffca8cc919b5ef3"><div class="ttname"><a href="structkvm__page__fault.html#a8c1b32bdc3f59a2c3ffca8cc919b5ef3">kvm_page_fault::nx_huge_page_workaround_enabled</a></div><div class="ttdeci">const bool nx_huge_page_workaround_enabled</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00206">mmu_internal.h:206</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a8ffa43a08e1131c59b2597d86a616b26"><div class="ttname"><a href="structkvm__page__fault.html#a8ffa43a08e1131c59b2597d86a616b26">kvm_page_fault::req_level</a></div><div class="ttdeci">u8 req_level</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00224">mmu_internal.h:224</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_ad6705ad5f00efe4e9e47328860e9634a"><div class="ttname"><a href="structkvm__page__fault.html#ad6705ad5f00efe4e9e47328860e9634a">kvm_page_fault::goal_level</a></div><div class="ttdeci">u8 goal_level</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00230">mmu_internal.h:230</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a502cd8b971218c38ecd999409fc15ee3"><div class="ttname"><a href="tdp__mmu_8c.html#a502cd8b971218c38ecd999409fc15ee3">tdp_mmu_init_child_sp</a></div><div class="ttdeci">static void tdp_mmu_init_child_sp(struct kvm_mmu_page *child_sp, struct tdp_iter *iter)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00205">tdp_mmu.c:205</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a6588b054500f580603f94c0555fe3c06"><div class="ttname"><a href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06">tdp_mmu_link_sp</a></div><div class="ttdeci">static int tdp_mmu_link_sp(struct kvm *kvm, struct tdp_iter *iter, struct kvm_mmu_page *sp, bool shared)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01006">tdp_mmu.c:1006</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_aa98226578ebe207e97e262a86bbd5427"><div class="ttname"><a href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427">tdp_mmu_map_handle_target_level</a></div><div class="ttdeci">static int tdp_mmu_map_handle_target_level(struct kvm_vcpu *vcpu, struct kvm_page_fault *fault, struct tdp_iter *iter)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00943">tdp_mmu.c:943</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_acf7d062eca8e6190d76f4934c290be61"><div class="ttname"><a href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61">tdp_mmu_split_huge_page</a></div><div class="ttdeci">static int tdp_mmu_split_huge_page(struct kvm *kvm, struct tdp_iter *iter, struct kvm_mmu_page *sp, bool shared)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01376">tdp_mmu.c:1376</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_afab0b8fc9210a8e1190a153f664ef78b"><div class="ttname"><a href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b">tdp_mmu_free_sp</a></div><div class="ttdeci">static void tdp_mmu_free_sp(struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00054">tdp_mmu.c:54</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ad2479228afe629631e4f0331c440a4d6_cgraph.png" border="0" usemap="#atdp__mmu_8c_ad2479228afe629631e4f0331c440a4d6_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_ad2479228afe629631e4f0331c440a4d6_cgraph" id="atdp__mmu_8c_ad2479228afe629631e4f0331c440a4d6_cgraph">
<area shape="rect" title=" " alt="" coords="5,1407,161,1433"/>
<area shape="rect" href="mmu_8c.html#ae810dbeb6cd413090f54ca0cf864fe49" title=" " alt="" coords="739,1023,901,1065"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1708,1089,1809,1116"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1482,836,1657,863"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1503,1380,1636,1407"/>
<area shape="rect" href="mmu_8c.html#ab3ace8d82fe9d5e1653277159c5ad4df" title=" " alt="" coords="213,1545,423,1572"/>
<area shape="rect" href="tdp__mmu_8c.html#aab91e6aa4615cd9bf4f66141ca34642b" title=" " alt="" coords="246,1596,390,1623"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="249,1647,387,1673"/>
<area shape="rect" href="tdp__mmu_8c.html#a502cd8b971218c38ecd999409fc15ee3" title=" " alt="" coords="734,1393,906,1420"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="509,1241,647,1268"/>
<area shape="rect" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427" title=" " alt="" coords="735,958,905,999"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="219,1368,417,1395"/>
<area shape="rect" href="mmu_8c.html#ad3e86bf491c8c2726e3bc6702166cfdf" title=" " alt="" coords="209,1697,427,1724"/>
<area shape="rect" href="spte_8h.html#af8791b1ec453ef3bce3c87ea28744692" title=" " alt="" coords="997,1191,1127,1217"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1257,1241,1387,1268"/>
<area shape="rect" href="mmu_8c.html#a3c4a735c02073ba03d156c2ce4cfc5e5" title=" " alt="" coords="475,1546,681,1587"/>
<area shape="rect" href="mmu_8c.html#a25a86ecdadc998ed7ceac6eb669be98f" title=" " alt="" coords="729,1600,911,1627"/>
<area shape="rect" href="mmu_8c.html#a1a8a0df061e27892bcc64a3e810e6c29" title=" " alt="" coords="759,1549,881,1576"/>
<area shape="rect" href="mmu_8h.html#a41b79b63cae220349d8eb5a54f047939" title=" " alt="" coords="1009,1549,1115,1576"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1012,1241,1112,1268"/>
<area shape="rect" href="tdp__mmu_8c.html#a8d6f094dd9ef458c1c57aee653afd602" title=" " alt="" coords="995,1393,1129,1420"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="753,1140,887,1167"/>
<area shape="rect" href="spte_8c.html#a98038e4116bcdef6f9e1e335eefc29c9" title=" " alt="" coords="745,1191,895,1217"/>
<area shape="rect" href="tdp__mmu_8c.html#a5217224e4957f6457786d51ddd62914b" title=" " alt="" coords="729,1089,911,1116"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="733,1292,907,1319"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="963,1292,1161,1319"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="989,1343,1135,1369"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1241,1292,1403,1319"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1520,1241,1619,1268"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1513,1191,1626,1217"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1479,1304,1660,1331"/>
<area shape="rect" href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e" title=" " alt="" coords="961,153,1163,180"/>
<area shape="rect" href="spte_8c.html#ae55574ff3b0384504236d8fb85a3a6d0" title=" " alt="" coords="993,372,1131,399"/>
<area shape="rect" href="spte_8c.html#ab8dba69ef9f5267d41ba061dbe101ded" title=" " alt="" coords="1015,553,1109,580"/>
<area shape="rect" href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5" title=" " alt="" coords="1247,95,1397,121"/>
<area shape="rect" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f" title=" " alt="" coords="1235,146,1409,187"/>
<area shape="rect" href="spte_8c.html#a941485cd3f9578fdfff7474df672b8e4" title=" " alt="" coords="1215,212,1429,239"/>
<area shape="rect" href="spte_8h.html#aca7067bb9ce45d32003771bcdb7f902b" title=" " alt="" coords="1267,684,1377,711"/>
<area shape="rect" href="mmu__internal_8h.html#a8a367cbfff40c5c72d6f19049da9fc51" title=" " alt="" coords="1225,785,1419,812"/>
<area shape="rect" href="spte_8h.html#a331291ac914d7a45322fae31df1f5e64" title=" " alt="" coords="1271,364,1373,391"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1261,415,1383,441"/>
<area shape="rect" href="spte_8c.html#ab239f729574ce926da684e16e1c739fc" title=" " alt="" coords="1251,465,1393,492"/>
<area shape="rect" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5" title=" " alt="" coords="1225,517,1419,558"/>
<area shape="rect" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15" title=" " alt="" coords="1231,583,1413,609"/>
<area shape="rect" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909" title=" " alt="" coords="1486,930,1653,971"/>
<area shape="rect" href="mmu_8c.html#af8846daf6e76a8d619fba16ff979245b" title=" " alt="" coords="1222,633,1422,660"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1213,263,1431,289"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1229,313,1415,340"/>
<area shape="rect" href="spte_8c.html#adc3a08f029fff6aaf2bf687edf69410f" title=" " alt="" coords="959,988,1165,1015"/>
<area shape="rect" href="spte_8c.html#ac0162f8b29f82f308036271f93880cd7" title=" " alt="" coords="1237,988,1407,1015"/>
</map>
</div>

</div>
</div>
<a id="a8a9d637b546d8dfd125028f823a6eac0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a9d637b546d8dfd125028f823a6eac0">&#9670;&nbsp;</a></span>kvm_tdp_mmu_put_root()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_tdp_mmu_put_root </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00076">76</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;{</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span> (!refcount_dec_and_test(&amp;root-&gt;<a class="code" href="structkvm__mmu__page.html#a41397fd72948cc7002b169d2fb3aba5f">tdp_mmu_root_count</a>))</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">     * The TDP MMU itself holds a reference to each root until the root is</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">     * explicitly invalidated, i.e. the final reference should be never be</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">     * put for a valid root.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    KVM_BUG_ON(!<a class="code" href="tdp__mmu_8h.html#a166bc9e57a26e8a37e94e2314a72d226">is_tdp_mmu_page</a>(root) || !root-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.invalid, kvm);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    spin_lock(&amp;kvm-&gt;arch.tdp_mmu_pages_lock);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    list_del_rcu(&amp;root-&gt;<a class="code" href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">link</a>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    spin_unlock(&amp;kvm-&gt;arch.tdp_mmu_pages_lock);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    call_rcu(&amp;root-&gt;rcu_head, <a class="code" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279">tdp_mmu_free_sp_rcu_callback</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8h_html_a166bc9e57a26e8a37e94e2314a72d226"><div class="ttname"><a href="tdp__mmu_8h.html#a166bc9e57a26e8a37e94e2314a72d226">is_tdp_mmu_page</a></div><div class="ttdeci">static bool is_tdp_mmu_page(struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8h_source.html#l00074">tdp_mmu.h:74</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a8a9d637b546d8dfd125028f823a6eac0_cgraph.png" border="0" usemap="#atdp__mmu_8c_a8a9d637b546d8dfd125028f823a6eac0_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a8a9d637b546d8dfd125028f823a6eac0_cgraph" id="atdp__mmu_8c_a8a9d637b546d8dfd125028f823a6eac0_cgraph">
<area shape="rect" title=" " alt="" coords="5,35,187,61"/>
<area shape="rect" href="tdp__mmu_8h.html#a166bc9e57a26e8a37e94e2314a72d226" title=" " alt="" coords="247,5,389,32"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="235,57,401,98"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="449,64,588,91"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a8a9d637b546d8dfd125028f823a6eac0_icgraph.png" border="0" usemap="#atdp__mmu_8c_a8a9d637b546d8dfd125028f823a6eac0_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a8a9d637b546d8dfd125028f823a6eac0_icgraph" id="atdp__mmu_8c_a8a9d637b546d8dfd125028f823a6eac0_icgraph">
<area shape="rect" title=" " alt="" coords="1523,281,1704,307"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="1269,71,1449,112"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="1244,244,1475,285"/>
<area shape="rect" href="mmu_8c.html#a5b648a843c7267d204fe81facbc9f84f" title=" " alt="" coords="1279,310,1440,337"/>
<area shape="rect" href="tdp__mmu_8c.html#a5d434b3d8d515d7e4c585ae3aa7e15fa" title=" " alt="" coords="1283,361,1436,387"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="1002,5,1185,47"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="998,71,1189,112"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="757,5,923,47"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="477,5,683,47"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="751,71,929,112"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="502,74,658,101"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="991,190,1196,217"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="1005,267,1182,294"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="758,159,922,186"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="495,125,665,151"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="509,175,651,202"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="749,211,931,252"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="758,276,922,317"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="765,342,915,369"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="486,226,674,253"/>
<area shape="rect" href="x86_8c.html#ae7e25dec8e0af366fb3db41dc9881970" title=" " alt="" coords="471,283,689,310"/>
<area shape="rect" href="mmu_8c.html#ab7d4e418cb85a72507e384df5027293e" title=" " alt="" coords="1011,670,1176,697"/>
<area shape="rect" href="mmu_8c.html#ae3c450d21264b7f2a31cc71d03c2a658" title=" " alt="" coords="739,393,941,435"/>
<area shape="rect" href="mmu_8c.html#accc9c990bf354ea4f50d7e9c2deee3e4" title=" " alt="" coords="759,511,921,552"/>
<area shape="rect" href="mmu_8c.html#a0e7f249026693e08d3c8b70f7ffd5003" title=" " alt="" coords="517,467,643,494"/>
<area shape="rect" href="vmx_2nested_8c.html#ad9920ec1586ae352fbc272ed93cf7b38" title=" " alt="" coords="791,822,889,849"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="783,873,897,899"/>
<area shape="rect" href="x86_8c.html#aa792359250f034a2a29b0c809df64ff3" title=" " alt="" coords="761,577,919,603"/>
<area shape="rect" href="mmu_8c.html#aed9206081417b11ad2654d347022bb05" title=" " alt="" coords="756,924,924,965"/>
<area shape="rect" href="mmu_8c.html#a6d448c19a18bd089be4c218a86d523be" title=" " alt="" coords="737,990,943,1017"/>
<area shape="rect" href="mmu_8c.html#a7bf770a114656f992dd1c0aff57fe9e5" title=" " alt="" coords="769,721,911,747"/>
<area shape="rect" href="x86_8c.html#ae69bdd054a70a95d99b79bae770372cf" title=" " alt="" coords="288,619,387,646"/>
<area shape="rect" href="vmx_2nested_8c.html#a5a5df09c88b5fad9a716109f9917e9a5" title=" " alt="" coords="751,1041,929,1067"/>
<area shape="rect" href="mmu_8c.html#aa1e7a67c950b9d5bc46f7aaed6b5367c" title=" " alt="" coords="486,393,674,435"/>
<area shape="rect" href="mmu_8c.html#a40fe74f8abc723be216276bf005e4be8" title=" " alt="" coords="259,467,416,494"/>
<area shape="rect" href="x86_8c.html#a75f57f1f4494df7f35fcdf0e0e582a31" title=" " alt="" coords="52,518,157,545"/>
<area shape="rect" href="vmx_2nested_8c.html#a4c26f7246065bb8952f345af22487b9c" title=" " alt="" coords="521,873,639,899"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="507,923,653,950"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="252,967,423,1008"/>
<area shape="rect" href="x86_8c.html#a97b209e5c87a4c7b5850646ab9a1919c" title=" " alt="" coords="502,569,658,595"/>
<area shape="rect" href="vmx_2nested_8c.html#a82fdee7a11d269320b0b30e836910587" title=" " alt="" coords="519,1025,641,1051"/>
<area shape="rect" href="x86_8c.html#a334f9c72dae5c0a2867b04acbc2beb6e" title=" " alt="" coords="505,1076,655,1117"/>
<area shape="rect" href="mmu_8c.html#a1b010cfd4a70f0e7ad2d50619562cd1c" title=" " alt="" coords="506,771,654,798"/>
<area shape="rect" href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f" title=" " alt="" coords="486,721,674,747"/>
<area shape="rect" href="x86_8c.html#afb193fb2b1c3f240d0ad5a5378afc118" title=" " alt="" coords="267,721,407,747"/>
<area shape="rect" href="x86_8c.html#aa7dd06e7d0835e6cbf23134ad9fb19d8" title=" " alt="" coords="489,822,671,849"/>
<area shape="rect" href="x86_8c.html#a39acca4a1624a86a5d8e547339729536" title=" " alt="" coords="52,721,157,747"/>
<area shape="rect" href="x86_8c.html#ad6dd5b8847ecb92fe36f8dabdac40b08" title=" " alt="" coords="23,569,186,595"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="52,619,157,646"/>
<area shape="rect" href="vmx_2nested_8c.html#a562e6893d0703c98635cab943cc58fed" title=" " alt="" coords="5,670,204,697"/>
</map>
</div>

</div>
</div>
<a id="aa53a75612d7b32153949be34f4055144"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa53a75612d7b32153949be34f4055144">&#9670;&nbsp;</a></span>kvm_tdp_mmu_set_spte_gfn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_tdp_mmu_set_spte_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01247">1247</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;{</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">     * No need to handle the remote TLB flush under RCU protection, the</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">     * target SPTE _must_ be a leaf SPTE, i.e. cannot result in freeing a</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">     * shadow page. See the WARN on pfn_changed in handle_changed_spte().</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="tdp__mmu_8c.html#aee4308cb9e1b221fb73c67c6e8f0e1d1">kvm_tdp_mmu_handle_gfn</a>(kvm, range, <a class="code" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c">set_spte_gfn</a>);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a01bf8752c61ddeae2878ef46d312e00c"><div class="ttname"><a href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c">set_spte_gfn</a></div><div class="ttdeci">static bool set_spte_gfn(struct kvm *kvm, struct tdp_iter *iter, struct kvm_gfn_range *range)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01211">tdp_mmu.c:1211</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa53a75612d7b32153949be34f4055144_cgraph.png" border="0" usemap="#atdp__mmu_8c_aa53a75612d7b32153949be34f4055144_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa53a75612d7b32153949be34f4055144_cgraph" id="atdp__mmu_8c_aa53a75612d7b32153949be34f4055144_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,216,57"/>
<area shape="rect" href="tdp__mmu_8c.html#aee4308cb9e1b221fb73c67c6e8f0e1d1" title=" " alt="" coords="264,5,463,32"/>
<area shape="rect" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c" title=" " alt="" coords="311,56,416,83"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2536,581,2711,608"/>
<area shape="rect" href="spte_8c.html#acde6f5a6ce759cab5d21b74658796860" title=" " alt="" coords="511,49,693,90"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="515,140,689,167"/>
<area shape="rect" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909" title=" " alt="" coords="1640,49,1807,90"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1882,306,2037,347"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="2120,165,2279,192"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="2356,204,2488,231"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2139,317,2260,344"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="741,191,888,217"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="936,719,1099,745"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1407,289,1540,316"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1376,239,1571,265"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1162,492,1313,519"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1910,769,2009,796"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1892,115,2027,141"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1907,719,2012,745"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1181,668,1294,695"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1151,871,1324,897"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1166,820,1309,847"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1147,972,1328,999"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1173,921,1301,948"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1424,1023,1523,1049"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1387,391,1559,417"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1378,441,1569,468"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1626,333,1821,374"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1423,492,1523,519"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1390,543,1557,585"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1397,609,1550,636"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1641,399,1806,425"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1619,216,1828,243"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1626,267,1821,309"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1876,255,2043,281"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2149,769,2250,796"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="2115,267,2284,293"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1658,449,1789,476"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1654,500,1793,527"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1625,551,1822,577"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1646,602,1801,643"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="2091,115,2308,141"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="2106,719,2293,745"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1381,871,1565,897"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1630,845,1817,872"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1396,820,1551,847"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa53a75612d7b32153949be34f4055144_icgraph.png" border="0" usemap="#atdp__mmu_8c_aa53a75612d7b32153949be34f4055144_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa53a75612d7b32153949be34f4055144_icgraph" id="atdp__mmu_8c_aa53a75612d7b32153949be34f4055144_icgraph">
<area shape="rect" title=" " alt="" coords="195,5,405,32"/>
<area shape="rect" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d" title=" " alt="" coords="5,5,147,32"/>
</map>
</div>

</div>
</div>
<a id="a78b4b5fbbd5f7b9fc997fef12a5ff92b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78b4b5fbbd5f7b9fc997fef12a5ff92b">&#9670;&nbsp;</a></span>kvm_tdp_mmu_test_age_gfn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_tdp_mmu_test_age_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01206">1206</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;{</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="tdp__mmu_8c.html#aee4308cb9e1b221fb73c67c6e8f0e1d1">kvm_tdp_mmu_handle_gfn</a>(kvm, range, <a class="code" href="tdp__mmu_8c.html#a35969e29bbb017463732377231d536c4">test_age_gfn</a>);</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a35969e29bbb017463732377231d536c4"><div class="ttname"><a href="tdp__mmu_8c.html#a35969e29bbb017463732377231d536c4">test_age_gfn</a></div><div class="ttdeci">static bool test_age_gfn(struct kvm *kvm, struct tdp_iter *iter, struct kvm_gfn_range *range)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01200">tdp_mmu.c:1200</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a78b4b5fbbd5f7b9fc997fef12a5ff92b_cgraph.png" border="0" usemap="#atdp__mmu_8c_a78b4b5fbbd5f7b9fc997fef12a5ff92b_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a78b4b5fbbd5f7b9fc997fef12a5ff92b_cgraph" id="atdp__mmu_8c_a78b4b5fbbd5f7b9fc997fef12a5ff92b_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,216,57"/>
<area shape="rect" href="tdp__mmu_8c.html#aee4308cb9e1b221fb73c67c6e8f0e1d1" title=" " alt="" coords="264,5,463,32"/>
<area shape="rect" href="tdp__mmu_8c.html#a35969e29bbb017463732377231d536c4" title=" " alt="" coords="310,56,417,83"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="511,56,645,83"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="723,31,881,57"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="693,81,911,108"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="959,31,1091,57"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1139,56,1313,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a78b4b5fbbd5f7b9fc997fef12a5ff92b_icgraph.png" border="0" usemap="#atdp__mmu_8c_a78b4b5fbbd5f7b9fc997fef12a5ff92b_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a78b4b5fbbd5f7b9fc997fef12a5ff92b_icgraph" id="atdp__mmu_8c_a78b4b5fbbd5f7b9fc997fef12a5ff92b_icgraph">
<area shape="rect" title=" " alt="" coords="196,5,407,32"/>
<area shape="rect" href="mmu_8c.html#a7045f4df80d26474c5fe995d02eebc35" title=" " alt="" coords="5,5,148,32"/>
</map>
</div>

</div>
</div>
<a id="a57310f6ad7e70c13dadcfd30aa71af6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57310f6ad7e70c13dadcfd30aa71af6d">&#9670;&nbsp;</a></span>kvm_tdp_mmu_try_split_huge_pages()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_tdp_mmu_try_split_huge_pages </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01483">1483</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;{</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keywordtype">int</span> r = 0;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160; </div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48">kvm_lockdep_assert_mmu_lock_held</a>(kvm, shared);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a3c960568750483d675f0f994ac033a41">for_each_valid_tdp_mmu_root_yield_safe</a>(kvm, root, slot-&gt;as_id) {</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        r = <a class="code" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c">tdp_mmu_split_huge_pages_root</a>(kvm, root, start, end, target_level, shared);</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <span class="keywordflow">if</span> (r) {</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            <a class="code" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0">kvm_tdp_mmu_put_root</a>(kvm, root);</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        }</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    }</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a8a9d637b546d8dfd125028f823a6eac0"><div class="ttname"><a href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0">kvm_tdp_mmu_put_root</a></div><div class="ttdeci">void kvm_tdp_mmu_put_root(struct kvm *kvm, struct kvm_mmu_page *root)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00076">tdp_mmu.c:76</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_afa070d8c089f8547cfc2dbafa856e99c"><div class="ttname"><a href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c">tdp_mmu_split_huge_pages_root</a></div><div class="ttdeci">static int tdp_mmu_split_huge_pages_root(struct kvm *kvm, struct kvm_mmu_page *root, gfn_t start, gfn_t end, int target_level, bool shared)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01414">tdp_mmu.c:1414</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a57310f6ad7e70c13dadcfd30aa71af6d_cgraph.png" border="0" usemap="#atdp__mmu_8c_a57310f6ad7e70c13dadcfd30aa71af6d_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a57310f6ad7e70c13dadcfd30aa71af6d_cgraph" id="atdp__mmu_8c_a57310f6ad7e70c13dadcfd30aa71af6d_cgraph">
<area shape="rect" title=" " alt="" coords="5,92,185,133"/>
<area shape="rect" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48" title=" " alt="" coords="729,5,885,47"/>
<area shape="rect" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0" title=" " alt="" coords="233,99,415,126"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="245,328,403,369"/>
<area shape="rect" href="tdp__mmu_8h.html#a166bc9e57a26e8a37e94e2314a72d226" title=" " alt="" coords="497,41,638,67"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1945,209,2111,251"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="2173,187,2312,214"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2192,969,2293,995"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2360,1171,2535,1198"/>
<area shape="rect" href="tdp__mmu_8c.html#aa61edf11261db080cdd6b2bba981310f" title=" " alt="" coords="483,92,652,133"/>
<area shape="rect" href="tdp__mmu_8c.html#a502cd8b971218c38ecd999409fc15ee3" title=" " alt="" coords="481,310,653,337"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="463,361,672,387"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="469,950,666,977"/>
<area shape="rect" href="tdp__mmu_8c.html#aef3c64f4319d3be908d23467dd8fb337" title=" " alt="" coords="728,92,887,133"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1978,318,2078,345"/>
<area shape="rect" href="tdp__mmu_8c.html#a8d6f094dd9ef458c1c57aee653afd602" title=" " alt="" coords="740,310,875,337"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="2177,318,2308,345"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="720,361,895,387"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="943,357,1153,383"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1201,345,1412,387"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1473,310,1640,337"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1463,361,1651,387"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1701,1222,1883,1249"/>
<area shape="rect" href="spte_8c.html#adc3a08f029fff6aaf2bf687edf69410f" title=" " alt="" coords="1203,1323,1410,1350"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="739,899,876,926"/>
<area shape="rect" href="mmu__internal_8h.html#a8a367cbfff40c5c72d6f19049da9fc51" title=" " alt="" coords="1460,1374,1653,1401"/>
<area shape="rect" href="spte_8c.html#ac0162f8b29f82f308036271f93880cd7" title=" " alt="" coords="1471,1425,1642,1451"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1949,1441,2107,1467"/>
<area shape="rect" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909" title=" " alt="" coords="1709,1476,1875,1517"/>
<area shape="rect" href="spte_8h.html#abc2b9043d48550e741fda1e2ad36a652" title=" " alt="" coords="1706,1425,1878,1451"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="2177,1441,2309,1467"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1951,1375,2105,1416"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="981,874,1115,901"/>
<area shape="rect" href="spte_8c.html#a98038e4116bcdef6f9e1e335eefc29c9" title=" " alt="" coords="973,925,1123,951"/>
<area shape="rect" href="tdp__mmu_8c.html#a5217224e4957f6457786d51ddd62914b" title=" " alt="" coords="957,975,1139,1002"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="961,753,1135,779"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="1207,823,1406,850"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="1233,690,1380,717"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1475,842,1638,869"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1961,607,2095,634"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1931,487,2125,514"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1717,513,1867,539"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1725,1171,1859,1198"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1739,867,1845,894"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1979,969,2077,995"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1735,918,1849,945"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1705,715,1879,742"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1721,817,1863,843"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1728,1019,1856,1046"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1979,1070,2077,1097"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a57310f6ad7e70c13dadcfd30aa71af6d_icgraph.png" border="0" usemap="#atdp__mmu_8c_a57310f6ad7e70c13dadcfd30aa71af6d_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a57310f6ad7e70c13dadcfd30aa71af6d_icgraph" id="atdp__mmu_8c_a57310f6ad7e70c13dadcfd30aa71af6d_icgraph">
<area shape="rect" title=" " alt="" coords="3096,258,3276,299"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2861,225,3044,266"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2857,290,3048,331"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2637,225,2803,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2377,225,2583,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2111,232,2329,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1914,232,2057,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2631,290,2809,331"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2402,297,2558,324"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2140,297,2300,324"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1908,290,2063,331"/>
</map>
</div>

</div>
</div>
<a id="aaa8f0898db08dd5c9213ac2f8b355501"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa8f0898db08dd5c9213ac2f8b355501">&#9670;&nbsp;</a></span>kvm_tdp_mmu_unmap_gfn_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_tdp_mmu_unmap_gfn_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>flush</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01114">1114</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;{</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <a class="code" href="tdp__mmu_8c.html#ab9d1583c53d0b2660327c4dea8fae4e3">__for_each_tdp_mmu_root_yield_safe</a>(kvm, root, range-&gt;slot-&gt;as_id, <span class="keyword">false</span>)</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        flush = <a class="code" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac">tdp_mmu_zap_leafs</a>(kvm, root, range-&gt;start, range-&gt;end,</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                      range-&gt;may_block, flush);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160; </div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    return flush;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a182ff449fd87f9503148e88c33cff5ac"><div class="ttname"><a href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac">tdp_mmu_zap_leafs</a></div><div class="ttdeci">static bool tdp_mmu_zap_leafs(struct kvm *kvm, struct kvm_mmu_page *root, gfn_t start, gfn_t end, bool can_yield, bool flush)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00780">tdp_mmu.c:780</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_ab9d1583c53d0b2660327c4dea8fae4e3"><div class="ttname"><a href="tdp__mmu_8c.html#ab9d1583c53d0b2660327c4dea8fae4e3">__for_each_tdp_mmu_root_yield_safe</a></div><div class="ttdeci">#define __for_each_tdp_mmu_root_yield_safe(_kvm, _root, _as_id, _only_valid)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00152">tdp_mmu.c:152</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aaa8f0898db08dd5c9213ac2f8b355501_cgraph.png" border="0" usemap="#atdp__mmu_8c_aaa8f0898db08dd5c9213ac2f8b355501_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_aaa8f0898db08dd5c9213ac2f8b355501_cgraph" id="atdp__mmu_8c_aaa8f0898db08dd5c9213ac2f8b355501_cgraph">
<area shape="rect" title=" " alt="" coords="5,986,205,1028"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="253,994,407,1020"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="2006,319,2105,346"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1968,740,2143,767"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="459,824,668,851"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="476,994,651,1020"/>
<area shape="rect" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476" title=" " alt="" coords="455,1227,672,1254"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2219,319,2321,346"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="720,707,895,734"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="943,290,1153,316"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1201,101,1412,142"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1474,116,1641,143"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1463,66,1651,92"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1772,167,1851,194"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1723,116,1899,143"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1735,66,1888,92"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="734,994,881,1020"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="967,522,1129,548"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1491,994,1624,1020"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1460,1044,1655,1071"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1978,497,2133,538"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1231,766,1382,792"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1490,1095,1625,1122"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1254,522,1359,548"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1250,867,1363,894"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1220,167,1393,194"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1235,218,1378,244"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1216,319,1397,346"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1243,420,1371,447"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1508,471,1607,498"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2209,914,2331,940"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1471,791,1643,818"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1462,892,1653,919"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1714,893,1909,934"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1507,842,1607,868"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1474,624,1641,665"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1481,690,1634,716"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1729,791,1894,818"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1707,1024,1916,1051"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1714,958,1909,1000"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1972,966,2139,992"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="2191,1019,2349,1046"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1746,842,1877,868"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1742,631,1881,658"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1713,690,1910,716"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1703,1075,1920,1102"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1718,522,1905,548"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1465,167,1649,194"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1480,218,1635,244"/>
<area shape="rect" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778" title=" " alt="" coords="729,1227,885,1254"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aaa8f0898db08dd5c9213ac2f8b355501_icgraph.png" border="0" usemap="#atdp__mmu_8c_aaa8f0898db08dd5c9213ac2f8b355501_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aaa8f0898db08dd5c9213ac2f8b355501_icgraph" id="atdp__mmu_8c_aaa8f0898db08dd5c9213ac2f8b355501_icgraph">
<area shape="rect" title=" " alt="" coords="228,5,428,47"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="5,13,180,39"/>
</map>
</div>

</div>
</div>
<a id="a45fd618d35fb0df14a3401a230f41faa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45fd618d35fb0df14a3401a230f41faa">&#9670;&nbsp;</a></span>kvm_tdp_mmu_write_protect_gfn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_tdp_mmu_write_protect_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>min_level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01746">1746</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;{</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="keywordtype">bool</span> spte_set = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160; </div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a80ff30c938358003552a2b48063b0fee">for_each_tdp_mmu_root</a>(kvm, root, slot-&gt;as_id)</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        spte_set |= <a class="code" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580">write_protect_gfn</a>(kvm, root, <a class="code" href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">gfn</a>, min_level);</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160; </div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    return spte_set;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_aa07f9d272e2404a5b5392ae7aa175580"><div class="ttname"><a href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580">write_protect_gfn</a></div><div class="ttdeci">static bool write_protect_gfn(struct kvm *kvm, struct kvm_mmu_page *root, gfn_t gfn, int min_level)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01710">tdp_mmu.c:1710</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a45fd618d35fb0df14a3401a230f41faa_cgraph.png" border="0" usemap="#atdp__mmu_8c_a45fd618d35fb0df14a3401a230f41faa_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a45fd618d35fb0df14a3401a230f41faa_cgraph" id="atdp__mmu_8c_a45fd618d35fb0df14a3401a230f41faa_cgraph">
<area shape="rect" title=" " alt="" coords="5,43,247,69"/>
<area shape="rect" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580" title=" " alt="" coords="295,43,431,69"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1870,169,1969,196"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2496,793,2671,820"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="479,245,653,272"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2109,169,2210,196"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="701,423,848,449"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="896,448,1059,475"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1367,397,1500,424"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1336,892,1531,919"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1842,1057,1997,1098"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1122,616,1273,643"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1852,920,1987,947"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1867,1123,1972,1149"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1141,245,1254,272"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1111,195,1284,221"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1126,144,1269,171"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1107,448,1288,475"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1133,296,1261,323"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1384,347,1483,373"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2099,1072,2220,1099"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1347,616,1519,643"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1338,667,1529,693"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1586,819,1781,861"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1383,499,1483,525"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1350,550,1517,591"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1357,717,1510,744"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1601,600,1766,627"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1579,951,1788,977"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1586,885,1781,926"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1836,971,2003,997"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="2080,920,2239,947"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="2316,920,2448,947"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="2075,1021,2244,1048"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1618,499,1749,525"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1614,549,1753,576"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1585,717,1782,744"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1606,651,1761,693"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="2051,869,2268,896"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="2066,1123,2253,1149"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1341,195,1525,221"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1590,169,1777,196"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1356,144,1511,171"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a45fd618d35fb0df14a3401a230f41faa_icgraph.png" border="0" usemap="#atdp__mmu_8c_a45fd618d35fb0df14a3401a230f41faa_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a45fd618d35fb0df14a3401a230f41faa_icgraph" id="atdp__mmu_8c_a45fd618d35fb0df14a3401a230f41faa_icgraph">
<area shape="rect" title=" " alt="" coords="2897,85,3139,112"/>
<area shape="rect" href="mmu_8c.html#a1f49638b71a482e4b0c3a6af10d0711e" title=" " alt="" coords="2659,78,2849,119"/>
<area shape="rect" href="page__track_8c.html#ab6a4ffea76ea12eb3b1e83eafaf4618b" title=" " alt="" coords="2403,5,2607,32"/>
<area shape="rect" href="mmu_8c.html#aec5cf4265713109c5e2ea673c610cd03" title=" " alt="" coords="2201,56,2347,83"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2416,107,2595,149"/>
<area shape="rect" href="mmu_8c.html#a2e21344d37e1f1c8c347bed8627da8db" title=" " alt="" coords="2400,173,2611,200"/>
<area shape="rect" href="mmu_8c.html#a6f305a17525ee7345f0f852070869e4c" title=" " alt="" coords="1921,56,2148,83"/>
<area shape="rect" href="mmu_8c.html#a1ade612e5d4a58575df9428f6ad72bb9" title=" " alt="" coords="1643,56,1873,83"/>
<area shape="rect" href="mmu_8c.html#a0afaf010cb78207cd01091773878f1f2" title=" " alt="" coords="1432,107,1595,133"/>
<area shape="rect" href="mmu_8c.html#a0ebfdae56a33b8ca22e8fa22268fe033" title=" " alt="" coords="1196,49,1384,90"/>
<area shape="rect" href="mmu_8c.html#aa0069ee555cb7a0001ed142edc326369" title=" " alt="" coords="1200,116,1380,143"/>
<area shape="rect" href="mmu_8c.html#a3722e33cca20a56503aa98b084383c47" title=" " alt="" coords="987,116,1082,143"/>
<area shape="rect" href="paging__tmpl_8h.html#ac7154588698b915e973bb8ca63e206e4" title=" " alt="" coords="1007,169,1062,196"/>
<area shape="rect" href="mmu_8c.html#aebe1e577e70e9f77f0bfea48bab7c83d" title=" " alt="" coords="719,116,853,143"/>
<area shape="rect" href="mmu_8c.html#a4bd7a8fd81e65c4e06e025d92c5787d9" title=" " alt="" coords="465,165,620,192"/>
<area shape="rect" href="mmu_8c.html#a925050134bb3c589bb55b63993ddacb1" title=" " alt="" coords="459,115,626,141"/>
<area shape="rect" href="paging__tmpl_8h.html#a58a78a9bd7e3593e2a7cfe13400331aa" title=" " alt="" coords="741,169,831,196"/>
<area shape="rect" href="mmu_8c.html#abe6e7771da6f6df50052156316535466" title=" " alt="" coords="921,56,1148,83"/>
<area shape="rect" href="mmu_8c.html#a03732600ed110f429f4a2d526a303bcb" title=" " alt="" coords="699,49,873,90"/>
<area shape="rect" href="mmu_8c.html#a2e109b8775cdfe9924c3d331ac5f332f" title=" " alt="" coords="456,49,629,90"/>
<area shape="rect" href="mmu_8c.html#adfe576663ff84a7b51773d87e91dd28a" title=" " alt="" coords="200,49,375,90"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2196,115,2352,141"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="1955,115,2115,141"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1681,107,1835,149"/>
<area shape="rect" href="mmu_8c.html#a2f33377dcdaf5435e453ff75e02075dd" title=" " alt="" coords="2198,173,2350,200"/>
<area shape="rect" href="mmu_8c.html#ab00408fb7acb0199782175051f59add6" title=" " alt="" coords="1950,316,2119,343"/>
<area shape="rect" href="mmu_8c.html#a475bd00898314bb9378d8e4306aa7874" title=" " alt="" coords="1695,291,1821,317"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="717,341,855,368"/>
<area shape="rect" href="x86_8c.html#a334f9c72dae5c0a2867b04acbc2beb6e" title=" " alt="" coords="1215,414,1365,455"/>
<area shape="rect" href="mmu_8h.html#ab0e194ecad859add3d639850021f8b16" title=" " alt="" coords="1443,291,1583,317"/>
<area shape="rect" href="mmu_8c.html#a339656816251af93fbd52aece22a2009" title=" " alt="" coords="1205,225,1375,266"/>
<area shape="rect" href="async__pf_8c.html#aac6395172fbf7947412604d7e2f33417" title=" " alt="" coords="954,225,1115,266"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="699,232,873,259"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="502,216,583,243"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="194,216,381,243"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="11,216,135,243"/>
<area shape="rect" href="x86_8c.html#abf28742eaf88f469f322233afeb66b59" title=" " alt="" coords="951,494,1118,535"/>
<area shape="rect" href="x86_8c.html#a187212c772cf6e896de2a5304f88b9fb" title=" " alt="" coords="965,392,1104,419"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="709,501,863,528"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,699,361,725"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,552,604,579"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,603,631,645"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,267,651,309"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,384,387,411"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,721,618,762"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,333,633,360"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,385,635,426"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,451,615,477"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,699,140,725"/>
<area shape="rect" href="vmx_2nested_8c.html#a77ca924cd23ac875ea48b1f181f33000" title=" " alt="" coords="202,545,373,586"/>
</map>
</div>

</div>
</div>
<a id="a7f6c658f3ddf3ffac5ce96335b78e295"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f6c658f3ddf3ffac5ce96335b78e295">&#9670;&nbsp;</a></span>kvm_tdp_mmu_wrprot_slot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_tdp_mmu_wrprot_slot </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>min_level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01300">1300</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;{</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keywordtype">bool</span> spte_set = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160; </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    lockdep_assert_held_read(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160; </div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a3c960568750483d675f0f994ac033a41">for_each_valid_tdp_mmu_root_yield_safe</a>(kvm, root, slot-&gt;as_id)</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        spte_set |= <a class="code" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37">wrprot_gfn_range</a>(kvm, root, slot-&gt;base_gfn,</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                 slot-&gt;base_gfn + slot-&gt;npages, min_level);</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160; </div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    return spte_set;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_ae3e523e725021c7dd3f3796f4e074a37"><div class="ttname"><a href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37">wrprot_gfn_range</a></div><div class="ttdeci">static bool wrprot_gfn_range(struct kvm *kvm, struct kvm_mmu_page *root, gfn_t start, gfn_t end, int min_level)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01262">tdp_mmu.c:1262</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a7f6c658f3ddf3ffac5ce96335b78e295_cgraph.png" border="0" usemap="#atdp__mmu_8c_a7f6c658f3ddf3ffac5ce96335b78e295_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a7f6c658f3ddf3ffac5ce96335b78e295_cgraph" id="atdp__mmu_8c_a7f6c658f3ddf3ffac5ce96335b78e295_cgraph">
<area shape="rect" title=" " alt="" coords="5,115,205,141"/>
<area shape="rect" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37" title=" " alt="" coords="253,115,389,141"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1731,220,1829,247"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2361,501,2536,528"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="437,92,647,119"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="443,347,641,373"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1974,220,2075,247"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="695,91,869,117"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="917,89,1128,116"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1176,78,1387,119"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1456,93,1623,120"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1445,43,1633,69"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1741,144,1819,171"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1692,93,1868,120"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1703,43,1857,69"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="701,637,863,664"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1215,448,1348,475"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1703,710,1857,751"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="947,637,1098,664"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1713,869,1847,896"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="970,1053,1075,1080"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="966,1104,1079,1131"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="936,1155,1109,1181"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="951,1205,1094,1232"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="932,397,1113,424"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="959,296,1087,323"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1232,347,1331,373"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1964,717,2085,744"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1195,717,1367,744"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1186,768,1377,795"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1184,824,1379,851"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1442,886,1637,927"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1231,549,1331,576"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1198,601,1365,642"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1205,667,1358,693"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1457,717,1622,744"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1435,835,1644,861"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1442,769,1637,810"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1697,776,1863,803"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1945,819,2104,845"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="2181,819,2313,845"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1474,499,1605,525"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1470,549,1609,576"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1441,667,1638,693"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1462,601,1617,642"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1916,869,2133,896"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1931,920,2118,947"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1189,1155,1373,1181"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1446,1180,1633,1207"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1204,1205,1359,1232"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a7f6c658f3ddf3ffac5ce96335b78e295_icgraph.png" border="0" usemap="#atdp__mmu_8c_a7f6c658f3ddf3ffac5ce96335b78e295_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a7f6c658f3ddf3ffac5ce96335b78e295_icgraph" id="atdp__mmu_8c_a7f6c658f3ddf3ffac5ce96335b78e295_icgraph">
<area shape="rect" title=" " alt="" coords="3061,232,3261,259"/>
<area shape="rect" href="mmu_8c.html#a168b7814e68a545abd8bf00fc4466610" title=" " alt="" coords="2833,225,3013,266"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2619,225,2785,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2365,225,2571,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2099,232,2317,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1908,232,2051,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
</map>
</div>

</div>
</div>
<a id="aca0f6025bf55596c80647e3a35997d92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca0f6025bf55596c80647e3a35997d92">&#9670;&nbsp;</a></span>kvm_tdp_mmu_zap_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_tdp_mmu_zap_all </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00831">831</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;{</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">     * Zap all roots, including invalid roots, as all SPTEs must be dropped</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">     * before returning to the caller.  Zap directly even if the root is</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">     * also being zapped by a worker.  Walking zapped top-level SPTEs isn&#39;t</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">     * all that expensive and mmu_lock is already held, which means the</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">     * worker has yielded, i.e. flushing the work instead of zapping here</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">     * isn&#39;t guaranteed to be any faster.</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">     * A TLB flush is unnecessary, KVM zaps everything if and only the VM</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">     * is being destroyed or the userspace VMM has exited.  In both cases,</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">     * KVM_RUN is unreachable, i.e. no vCPUs will ever service the request.</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a380373dbae26c3723631c3eebccf47db">for_each_tdp_mmu_root_yield_safe</a>(kvm, root)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <a class="code" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477">tdp_mmu_zap_root</a>(kvm, root, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_a380373dbae26c3723631c3eebccf47db"><div class="ttname"><a href="tdp__mmu_8c.html#a380373dbae26c3723631c3eebccf47db">for_each_tdp_mmu_root_yield_safe</a></div><div class="ttdeci">#define for_each_tdp_mmu_root_yield_safe(_kvm, _root)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00162">tdp_mmu.c:162</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a95955e5f31399228d6a722fba5a81477"><div class="ttname"><a href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477">tdp_mmu_zap_root</a></div><div class="ttdeci">static void tdp_mmu_zap_root(struct kvm *kvm, struct kvm_mmu_page *root, bool shared)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00716">tdp_mmu.c:716</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aca0f6025bf55596c80647e3a35997d92_cgraph.png" border="0" usemap="#atdp__mmu_8c_aca0f6025bf55596c80647e3a35997d92_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_aca0f6025bf55596c80647e3a35997d92_cgraph" id="atdp__mmu_8c_aca0f6025bf55596c80647e3a35997d92_cgraph">
<area shape="rect" title=" " alt="" coords="5,911,179,938"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="227,911,373,938"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="421,882,583,908"/>
<area shape="rect" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48" title=" " alt="" coords="424,933,580,974"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2168,220,2343,247"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="635,932,844,959"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="652,882,827,908"/>
<area shape="rect" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476" title=" " alt="" coords="631,983,848,1010"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="896,831,1095,858"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="908,932,1083,959"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="1143,1008,1353,1035"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1401,1014,1612,1056"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1674,1022,1841,1048"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1663,1072,1851,1099"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="922,882,1069,908"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1167,423,1329,450"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1691,870,1824,896"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1660,920,1855,947"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="2178,322,2333,364"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1431,659,1582,686"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="2206,515,2305,542"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1690,43,1825,70"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1454,195,1559,222"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1450,246,1563,272"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1420,94,1593,120"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1435,144,1578,171"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1416,296,1597,323"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1443,448,1571,475"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1708,448,1807,475"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2409,299,2531,326"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1671,768,1843,795"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1662,600,1853,627"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1914,837,2109,878"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1707,550,1807,576"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1674,652,1841,693"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1681,718,1834,744"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1929,768,2094,795"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1907,920,2116,947"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1914,449,2109,490"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="2172,271,2339,298"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2419,515,2521,542"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="2391,244,2549,271"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1946,566,2077,592"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1942,659,2081,686"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1913,718,2110,744"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1903,94,2120,120"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1918,195,2105,222"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1665,94,1849,120"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1680,144,1835,171"/>
<area shape="rect" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778" title=" " alt="" coords="917,983,1073,1010"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aca0f6025bf55596c80647e3a35997d92_icgraph.png" border="0" usemap="#atdp__mmu_8c_aca0f6025bf55596c80647e3a35997d92_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aca0f6025bf55596c80647e3a35997d92_icgraph" id="atdp__mmu_8c_aca0f6025bf55596c80647e3a35997d92_icgraph">
<area shape="rect" title=" " alt="" coords="1561,208,1735,235"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="1368,208,1513,235"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="1116,208,1320,235"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="899,208,1068,235"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="716,208,851,235"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="553,208,668,235"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="325,5,475,32"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="317,56,483,83"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="303,107,497,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="323,157,477,184"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="295,208,505,235"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="314,259,486,301"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="333,325,467,352"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="329,376,471,403"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="335,427,465,453"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="47,5,205,32"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="5,376,247,403"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="59,427,193,453"/>
</map>
</div>

</div>
</div>
<a id="a3a86994ba17144f60df37ea7682d650b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a86994ba17144f60df37ea7682d650b">&#9670;&nbsp;</a></span>kvm_tdp_mmu_zap_collapsible_sptes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_tdp_mmu_zap_collapsible_sptes </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01695">1695</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;{</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160; </div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    lockdep_assert_held_read(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a3c960568750483d675f0f994ac033a41">for_each_valid_tdp_mmu_root_yield_safe</a>(kvm, root, slot-&gt;as_id)</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        <a class="code" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf">zap_collapsible_spte_range</a>(kvm, root, slot);</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_ac72a38de4d0b8a5cfeace82f10cc4caf"><div class="ttname"><a href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf">zap_collapsible_spte_range</a></div><div class="ttdeci">static void zap_collapsible_spte_range(struct kvm *kvm, struct kvm_mmu_page *root, const struct kvm_memory_slot *slot)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01640">tdp_mmu.c:1640</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a3a86994ba17144f60df37ea7682d650b_cgraph.png" border="0" usemap="#atdp__mmu_8c_a3a86994ba17144f60df37ea7682d650b_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a3a86994ba17144f60df37ea7682d650b_cgraph" id="atdp__mmu_8c_a3a86994ba17144f60df37ea7682d650b_cgraph">
<area shape="rect" title=" " alt="" coords="5,1128,232,1169"/>
<area shape="rect" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf" title=" " alt="" coords="280,1128,437,1169"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1515,90,1614,117"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1739,486,1914,513"/>
<area shape="rect" href="mmu_8c.html#a514b4601388e83cb56ffe210d5123b50" title=" " alt="" coords="494,1325,686,1367"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="485,1215,695,1242"/>
<area shape="rect" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d" title=" " alt="" coords="489,1135,691,1162"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1776,90,1877,117"/>
<area shape="rect" href="mmu_8c.html#a3c4a735c02073ba03d156c2ce4cfc5e5" title=" " alt="" coords="743,1355,949,1396"/>
<area shape="rect" href="mmu_8c.html#a25a86ecdadc998ed7ceac6eb669be98f" title=" " alt="" coords="997,1358,1179,1385"/>
<area shape="rect" href="mmu_8c.html#a1a8a0df061e27892bcc64a3e810e6c29" title=" " alt="" coords="1027,1409,1149,1435"/>
<area shape="rect" href="mmu_8h.html#a41b79b63cae220349d8eb5a54f047939" title=" " alt="" coords="1264,1409,1371,1435"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="1230,1274,1405,1301"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="1459,1274,1670,1301"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1721,1267,1932,1308"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1991,1249,2157,1275"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1980,1299,2168,1326"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="2265,1249,2343,1275"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="2216,1350,2392,1377"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="2227,1299,2381,1326"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1722,1089,1931,1115"/>
<area shape="rect" href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e" title=" " alt="" coords="745,1186,947,1213"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="747,1085,945,1111"/>
<area shape="rect" href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5" title=" " alt="" coords="1013,1186,1163,1213"/>
<area shape="rect" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f" title=" " alt="" coords="1001,1237,1175,1279"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1007,461,1169,487"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1498,1085,1631,1111"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1240,141,1395,183"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1242,831,1393,858"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1250,613,1385,639"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1265,562,1370,589"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1261,258,1374,285"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1231,207,1404,234"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1246,410,1389,437"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1227,461,1408,487"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1253,309,1381,335"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1515,359,1614,386"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1504,149,1625,175"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1479,831,1651,858"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1469,882,1660,909"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1467,1034,1662,1061"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1729,1001,1924,1043"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1515,933,1615,959"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1481,715,1648,756"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1488,781,1641,807"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1485,613,1644,639"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1456,562,1673,589"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1471,511,1658,538"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1473,207,1657,234"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1487,410,1642,437"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a3a86994ba17144f60df37ea7682d650b_icgraph.png" border="0" usemap="#atdp__mmu_8c_a3a86994ba17144f60df37ea7682d650b_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a3a86994ba17144f60df37ea7682d650b_icgraph" id="atdp__mmu_8c_a3a86994ba17144f60df37ea7682d650b_icgraph">
<area shape="rect" title=" " alt="" coords="3080,225,3307,266"/>
<area shape="rect" href="mmu_8c.html#a35da5538a61de05522efdad8f615df4f" title=" " alt="" coords="2833,225,3032,266"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2619,225,2785,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2365,225,2571,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2099,232,2317,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1908,232,2051,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
</map>
</div>

</div>
</div>
<a id="a8ab26f4fb05f388d8bcf04ad89ee6797"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ab26f4fb05f388d8bcf04ad89ee6797">&#9670;&nbsp;</a></span>kvm_tdp_mmu_zap_invalidated_roots()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_tdp_mmu_zap_invalidated_roots </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00856">856</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;{</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    read_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160; </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a380373dbae26c3723631c3eebccf47db">for_each_tdp_mmu_root_yield_safe</a>(kvm, root) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordflow">if</span> (!root-&gt;<a class="code" href="structkvm__mmu__page.html#a4be3912894be6a937cad4c54708edaa4">tdp_mmu_scheduled_root_to_zap</a>)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        root-&gt;<a class="code" href="structkvm__mmu__page.html#a4be3912894be6a937cad4c54708edaa4">tdp_mmu_scheduled_root_to_zap</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        KVM_BUG_ON(!root-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.invalid, kvm);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">         * A TLB flush is not necessary as KVM performs a local TLB</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">         * flush when allocating a new root (see kvm_mmu_load()), and</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">         * when migrating a vCPU to a different pCPU.  Note, the local</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">         * TLB flush on reuse also invalidates paging-structure-cache</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">         * entries, i.e. TLB entries for intermediate paging structures,</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">         * that may be zapped, as such entries are associated with the</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">         * ASID on both VMX and SVM.</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <a class="code" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477">tdp_mmu_zap_root</a>(kvm, root, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">         * The referenced needs to be put *after* zapping the root, as</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">         * the root must be reachable by mmu_notifiers while it&#39;s being</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">         * zapped</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <a class="code" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0">kvm_tdp_mmu_put_root</a>(kvm, root);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160; </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    read_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a8ab26f4fb05f388d8bcf04ad89ee6797_cgraph.png" border="0" usemap="#atdp__mmu_8c_a8ab26f4fb05f388d8bcf04ad89ee6797_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a8ab26f4fb05f388d8bcf04ad89ee6797_cgraph" id="atdp__mmu_8c_a8ab26f4fb05f388d8bcf04ad89ee6797_cgraph">
<area shape="rect" title=" " alt="" coords="5,314,236,355"/>
<area shape="rect" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0" title=" " alt="" coords="284,119,465,145"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="301,503,448,529"/>
<area shape="rect" href="tdp__mmu_8h.html#a166bc9e57a26e8a37e94e2314a72d226" title=" " alt="" coords="523,68,665,95"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1766,107,1933,149"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="2034,115,2173,141"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="513,503,675,529"/>
<area shape="rect" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48" title=" " alt="" coords="516,554,672,595"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2260,781,2435,808"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="727,67,936,93"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="744,477,919,504"/>
<area shape="rect" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476" title=" " alt="" coords="723,579,940,605"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="988,528,1187,555"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="1000,64,1175,91"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="1235,59,1445,85"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1493,49,1704,90"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1766,5,1933,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1755,56,1943,83"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="1014,477,1161,504"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1259,705,1421,732"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1783,579,1916,605"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1752,224,1947,251"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="2270,191,2425,233"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1523,427,1674,453"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="2298,984,2397,1011"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1782,629,1917,656"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1546,781,1651,808"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1542,933,1655,960"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1512,731,1685,757"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1527,680,1670,707"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1508,984,1689,1011"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1535,883,1663,909"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1800,984,1899,1011"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2501,241,2623,268"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1763,477,1935,504"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1754,376,1945,403"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="2006,341,2201,382"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1799,325,1899,352"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1773,427,1926,453"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="2021,477,2186,504"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1999,224,2208,251"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="2006,275,2201,317"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="2264,283,2431,309"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2511,984,2613,1011"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="2483,440,2641,467"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1995,680,2212,707"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="2010,781,2197,808"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1757,731,1941,757"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1772,680,1927,707"/>
<area shape="rect" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778" title=" " alt="" coords="1009,579,1165,605"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a8ab26f4fb05f388d8bcf04ad89ee6797_icgraph.png" border="0" usemap="#atdp__mmu_8c_a8ab26f4fb05f388d8bcf04ad89ee6797_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a8ab26f4fb05f388d8bcf04ad89ee6797_icgraph" id="atdp__mmu_8c_a8ab26f4fb05f388d8bcf04ad89ee6797_icgraph">
<area shape="rect" title=" " alt="" coords="3580,271,3811,313"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="3327,233,3532,260"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="3341,304,3518,331"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="1429,212,1593,239"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,212,1338,239"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="1181,161,1324,188"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="939,161,1065,188"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,212,1069,239"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,5,669,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,212,851,239"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,56,647,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,107,655,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,157,649,184"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,208,677,235"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,259,658,301"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,325,639,352"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,376,643,403"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,427,637,453"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,56,377,83"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,376,419,403"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,427,365,453"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="2867,267,3048,309"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="3115,326,3279,367"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="3121,392,3272,419"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="2353,279,2541,305"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1908,431,2051,457"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,432,1860,459"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,432,1609,459"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,537,1605,564"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,381,1345,408"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,432,1359,459"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,483,1364,509"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,533,1323,560"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,407,1071,433"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,457,1089,484"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,471,851,497"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,477,640,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,508,1093,535"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,521,863,548"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,585,1354,626"/>
<area shape="rect" href="x86_8c.html#ae7e25dec8e0af366fb3db41dc9881970" title=" " alt="" coords="2848,333,3067,360"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="2589,333,2800,360"/>
<area shape="rect" href="kvm__main_8c.html#a52d56a5dc447602839375289b5bbffb2" title=" " alt="" coords="2359,405,2535,432"/>
<area shape="rect" href="kvm__main_8c.html#a8c9bd99a64bbedb0930e29ed4dcc7897" title=" " alt="" coords="2120,380,2284,407"/>
<area shape="rect" href="kvm__main_8c.html#ac4ce014a99262ed5672a102c6d2ffdbd" title=" " alt="" coords="2120,431,2284,457"/>
<area shape="rect" href="kvm__main_8c.html#afdb5cea8958921b2ea9bd3a29cf9d7a6" title=" " alt="" coords="2122,481,2282,508"/>
<area shape="rect" href="kvm__main_8c.html#a192569033b972982f6b53e13666ef82b" title=" " alt="" coords="2099,532,2305,559"/>
</map>
</div>

</div>
</div>
<a id="aa4fb1a66a2bc67f8699e8ddafdd4b1e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4fb1a66a2bc67f8699e8ddafdd4b1e8">&#9670;&nbsp;</a></span>kvm_tdp_mmu_zap_leafs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_tdp_mmu_zap_leafs </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>flush</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00820">820</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;{</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *root;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a380373dbae26c3723631c3eebccf47db">for_each_tdp_mmu_root_yield_safe</a>(kvm, root)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        flush = <a class="code" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac">tdp_mmu_zap_leafs</a>(kvm, root, start, end, <span class="keyword">true</span>, flush);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">return</span> flush;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa4fb1a66a2bc67f8699e8ddafdd4b1e8_cgraph.png" border="0" usemap="#atdp__mmu_8c_aa4fb1a66a2bc67f8699e8ddafdd4b1e8_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa4fb1a66a2bc67f8699e8ddafdd4b1e8_cgraph" id="atdp__mmu_8c_aa4fb1a66a2bc67f8699e8ddafdd4b1e8_cgraph">
<area shape="rect" title=" " alt="" coords="5,994,195,1020"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="243,994,396,1020"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1995,319,2094,346"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1957,740,2132,767"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="448,824,657,851"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="465,994,640,1020"/>
<area shape="rect" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476" title=" " alt="" coords="444,1227,661,1254"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2209,319,2310,346"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="709,707,884,734"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="932,290,1143,316"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1191,101,1401,142"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1463,116,1630,143"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1453,66,1641,92"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1761,167,1840,194"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1713,116,1889,143"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1724,66,1877,92"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="723,994,870,1020"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="956,522,1119,548"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1480,994,1613,1020"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1449,1044,1644,1071"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1967,497,2122,538"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1221,766,1371,792"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1479,1095,1614,1122"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1243,522,1349,548"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1239,867,1353,894"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1209,167,1383,194"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1225,218,1367,244"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1205,319,1387,346"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1232,420,1360,447"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1497,471,1596,498"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2199,914,2320,940"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1461,791,1633,818"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1451,892,1642,919"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1703,893,1898,934"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1497,842,1597,868"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1463,624,1630,665"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1470,690,1623,716"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1718,791,1883,818"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1696,1024,1905,1051"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1703,958,1898,1000"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1961,966,2128,992"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="2180,1019,2339,1046"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1735,842,1866,868"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1731,631,1870,658"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1702,690,1899,716"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1692,1075,1909,1102"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1707,522,1894,548"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1455,167,1639,194"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1469,218,1624,244"/>
<area shape="rect" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778" title=" " alt="" coords="719,1227,875,1254"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa4fb1a66a2bc67f8699e8ddafdd4b1e8_icgraph.png" border="0" usemap="#atdp__mmu_8c_aa4fb1a66a2bc67f8699e8ddafdd4b1e8_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa4fb1a66a2bc67f8699e8ddafdd4b1e8_icgraph" id="atdp__mmu_8c_aa4fb1a66a2bc67f8699e8ddafdd4b1e8_icgraph">
<area shape="rect" title=" " alt="" coords="2076,278,2265,305"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="1875,278,2028,305"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="1653,100,1803,141"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="1629,243,1827,284"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="1658,313,1798,339"/>
<area shape="rect" href="mtrr_8c.html#aca604775fbcfad49bfaf9441fc2253dc" title=" " alt="" coords="1677,465,1779,491"/>
<area shape="rect" href="x86_8c.html#ae1ffb1252c0aa966c6d94279766427ca" title=" " alt="" coords="1353,5,1543,47"/>
<area shape="rect" href="x86_8c.html#a613f1a822aa2ffa29a32341ec8a92913" title=" " alt="" coords="1359,71,1537,112"/>
<area shape="rect" href="hyperv_8c.html#a9eaaad1dfbff166c751e725c9fcf73b6" title=" " alt="" coords="1370,137,1526,163"/>
<area shape="rect" href="x86_8c.html#ae3d9929c9a77fa2c710befa0a784d4c6" title=" " alt="" coords="1083,5,1242,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="865,13,989,39"/>
<area shape="rect" href="hyperv_8c.html#addb1696255847fad41e6cbadd2e31f57" title=" " alt="" coords="1105,103,1220,130"/>
<area shape="rect" href="hyperv_8c.html#a98568f4f9b61af590e833d5f4a127c68" title=" " alt="" coords="870,67,985,94"/>
<area shape="rect" href="hyperv_8c.html#adbfbc91bbdd19f529b4489eb1d8e1ec7" title=" " alt="" coords="647,74,781,101"/>
<area shape="rect" href="hyperv_8c.html#ab6a097fa5ccc00cb31061629a4e3e2f7" title=" " alt="" coords="387,99,584,126"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="164,339,339,366"/>
<area shape="rect" href="svm_8c.html#acb46126747f78036462437a7bcdc2e47" title=" " alt="" coords="20,289,101,315"/>
<area shape="rect" href="svm_8c.html#aac18b9094154a2c8b8e27c3b08c9e359" title=" " alt="" coords="6,339,115,366"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="5,390,116,417"/>
<area shape="rect" href="x86_8c.html#a541cd35068f221456141f8798a1ab7c9" title=" " alt="" coords="1315,191,1581,218"/>
<area shape="rect" href="x86_8c.html#aab788793558a6c5c0cdc2e3ec840ebf6" title=" " alt="" coords="1369,243,1527,284"/>
<area shape="rect" href="vfio_8c.html#a0f8a9bc6a328c121266b7bedf8ccbe28" title=" " alt="" coords="1059,191,1267,218"/>
<area shape="rect" href="vfio_8c.html#a72ebd436cdee24ef38504201f2d8552c" title=" " alt="" coords="857,118,997,145"/>
<area shape="rect" href="vfio_8c.html#a69f95fca834d8d52cbb826dec545bbb9" title=" " alt="" coords="859,169,995,195"/>
<area shape="rect" href="vfio_8c.html#a0f0458c9f09300055baa0c892a2fbc29" title=" " alt="" coords="859,219,996,246"/>
<area shape="rect" href="vfio_8c.html#a8ad4a98a112c210e854931feaef8bd63" title=" " alt="" coords="646,162,782,189"/>
<area shape="rect" href="vfio_8c.html#a6e1f4ba2cd918c03e22262aa0019af12" title=" " alt="" coords="416,162,555,189"/>
<area shape="rect" href="svm_8c.html#af4590239d3e0b5fbad189a245207dfaa" title=" " alt="" coords="1415,313,1481,339"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="1395,371,1501,398"/>
<area shape="rect" href="svm_8c.html#ad1887c4bb9c78c577fb20a129d73ea41" title=" " alt="" coords="1103,270,1222,297"/>
<area shape="rect" href="smm_8c.html#a0943012ff008c7999f582998f0f9167a" title=" " alt="" coords="632,434,796,461"/>
<area shape="rect" href="x86_8c.html#a86812e4228865668099921709e1c2f26" title=" " alt="" coords="1099,371,1226,398"/>
<area shape="rect" href="vmx_8c.html#ac02e59b539f5874eaeb4b12568e9d0dd" title=" " alt="" coords="1103,422,1223,449"/>
<area shape="rect" href="x86_8c.html#abe99237e5fd6f33407bc30aa2647e0db" title=" " alt="" coords="1116,473,1209,499"/>
<area shape="rect" href="smm_8c.html#a0c50da2c4874eda6d67766974a476019" title=" " alt="" coords="1062,523,1263,550"/>
<area shape="rect" href="svm_8c.html#af2ee2a03530f5b7a02a127d8b779d2ae" title=" " alt="" coords="844,270,1011,297"/>
<area shape="rect" href="vmx_8c.html#aa55ace9429e6e94042e6602716222805" title=" " alt="" coords="885,434,970,461"/>
<area shape="rect" href="smm_8c.html#ae0136cd1aa193ad29565961ea839a99a" title=" " alt="" coords="855,510,1000,537"/>
<area shape="rect" href="mtrr_8c.html#a2b95f238c68e317e64e57d06f2a698dd" title=" " alt="" coords="413,390,558,417"/>
</map>
</div>

</div>
</div>
<a id="a381e22ee819864cf1fd726479a76b6c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a381e22ee819864cf1fd726479a76b6c7">&#9670;&nbsp;</a></span>kvm_tdp_mmu_zap_sp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_tdp_mmu_zap_sp </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>sp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00752">752</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;{</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    u64 old_spte;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">     * This helper intentionally doesn&#39;t allow zapping a root shadow page,</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">     * which doesn&#39;t have a parent page table and thus no associated entry.</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keywordflow">if</span> (WARN_ON_ONCE(!sp-&gt;<a class="code" href="structkvm__mmu__page.html#a354e43de3a7ea16fee41005505982422">ptep</a>))</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    old_spte = <a class="code" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768">kvm_tdp_mmu_read_spte</a>(sp-&gt;<a class="code" href="structkvm__mmu__page.html#a354e43de3a7ea16fee41005505982422">ptep</a>);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">if</span> (WARN_ON_ONCE(!<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(old_spte)))</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a">tdp_mmu_set_spte</a>(kvm, <a class="code" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79">kvm_mmu_page_as_id</a>(sp), sp-&gt;<a class="code" href="structkvm__mmu__page.html#a354e43de3a7ea16fee41005505982422">ptep</a>, old_spte, 0,</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;             sp-&gt;<a class="code" href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">gfn</a>, sp-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.level + 1);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;}</div>
<div class="ttc" id="astructkvm__mmu__page_html_a354e43de3a7ea16fee41005505982422"><div class="ttname"><a href="structkvm__mmu__page.html#a354e43de3a7ea16fee41005505982422">kvm_mmu_page::ptep</a></div><div class="ttdeci">tdp_ptep_t ptep</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00107">mmu_internal.h:107</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a1880e056251c1743579f5c7a25ccad1a"><div class="ttname"><a href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a">tdp_mmu_set_spte</a></div><div class="ttdeci">static u64 tdp_mmu_set_spte(struct kvm *kvm, int as_id, tdp_ptep_t sptep, u64 old_spte, u64 new_spte, gfn_t gfn, int level)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00592">tdp_mmu.c:592</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a381e22ee819864cf1fd726479a76b6c7_cgraph.png" border="0" usemap="#atdp__mmu_8c_a381e22ee819864cf1fd726479a76b6c7_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a381e22ee819864cf1fd726479a76b6c7_cgraph" id="atdp__mmu_8c_a381e22ee819864cf1fd726479a76b6c7_cgraph">
<area shape="rect" title=" " alt="" coords="5,904,177,931"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2020,359,2195,385"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="871,993,1043,1020"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="862,1044,1053,1071"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="225,719,372,745"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1125,993,1290,1020"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="420,521,583,548"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="891,841,1024,868"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="860,355,1055,381"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1366,145,1521,186"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="646,600,797,627"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1394,211,1493,237"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1376,479,1511,505"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1391,544,1496,571"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="665,752,778,779"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="635,803,808,829"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="650,701,793,728"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="631,369,812,396"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="657,253,785,280"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="908,300,1007,327"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1623,308,1744,335"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1110,413,1305,454"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="907,623,1007,649"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="874,725,1041,766"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="881,791,1034,817"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1103,296,1312,323"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1110,347,1305,389"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1360,359,1527,385"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1633,207,1734,233"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1604,460,1763,487"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1840,460,1972,487"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1599,359,1768,385"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1142,623,1273,649"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1138,732,1277,759"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1109,787,1306,813"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1130,838,1285,879"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1575,511,1792,537"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1590,561,1777,588"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="865,943,1049,969"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1114,924,1301,951"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="880,892,1035,919"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a381e22ee819864cf1fd726479a76b6c7_icgraph.png" border="0" usemap="#atdp__mmu_8c_a381e22ee819864cf1fd726479a76b6c7_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a381e22ee819864cf1fd726479a76b6c7_icgraph" id="atdp__mmu_8c_a381e22ee819864cf1fd726479a76b6c7_icgraph">
<area shape="rect" title=" " alt="" coords="943,13,1115,39"/>
<area shape="rect" href="mmu_8c.html#a85202c8f53b11b1c80f9b6e26210aa9a" title=" " alt="" coords="725,5,895,47"/>
<area shape="rect" href="mmu_8c.html#a2683113dbbf42e73c2b52410f9ef6f84" title=" " alt="" coords="461,5,677,47"/>
<area shape="rect" href="mmu_8c.html#a13148d5065ef27624701afcaa3229983" title=" " alt="" coords="231,13,413,39"/>
<area shape="rect" href="x86_8c.html#a91673b399129921871f11d0752eea8c3" title=" " alt="" coords="5,13,183,39"/>
</map>
</div>

</div>
</div>
<a id="a01bf8752c61ddeae2878ef46d312e00c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01bf8752c61ddeae2878ef46d312e00c">&#9670;&nbsp;</a></span>set_spte_gfn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool set_spte_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01211">1211</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;{</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    u64 new_spte;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160; </div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="comment">/* Huge pages aren&#39;t expected to be modified without first being zapped. */</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    WARN_ON_ONCE(pte_huge(range-&gt;arg.pte) || range-&gt;start + 1 != range-&gt;end);</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordflow">if</span> (iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a> != PG_LEVEL_4K ||</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        !<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>))</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">     * Note, when changing a read-only SPTE, it&#39;s not strictly necessary to</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">     * zero the SPTE before setting the new PFN, but doing so preserves the</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">     * invariant that the PFN of a present * leaf SPTE can never change.</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">     * See handle_changed_spte().</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <a class="code" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d">tdp_mmu_iter_set_spte</a>(kvm, iter, 0);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160; </div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="keywordflow">if</span> (!pte_write(range-&gt;arg.pte)) {</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        new_spte = <a class="code" href="spte_8c.html#acde6f5a6ce759cab5d21b74658796860">kvm_mmu_changed_pte_notifier_make_spte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>,</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                                  pte_pfn(range-&gt;arg.pte));</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160; </div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <a class="code" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d">tdp_mmu_iter_set_spte</a>(kvm, iter, new_spte);</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    }</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160; </div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;}</div>
<div class="ttc" id="aspte_8c_html_acde6f5a6ce759cab5d21b74658796860"><div class="ttname"><a href="spte_8c.html#acde6f5a6ce759cab5d21b74658796860">kvm_mmu_changed_pte_notifier_make_spte</a></div><div class="ttdeci">u64 kvm_mmu_changed_pte_notifier_make_spte(u64 old_spte, kvm_pfn_t new_pfn)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8c_source.html#l00325">spte.c:325</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a01bf8752c61ddeae2878ef46d312e00c_cgraph.png" border="0" usemap="#atdp__mmu_8c_a01bf8752c61ddeae2878ef46d312e00c_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a01bf8752c61ddeae2878ef46d312e00c_cgraph" id="atdp__mmu_8c_a01bf8752c61ddeae2878ef46d312e00c_cgraph">
<area shape="rect" title=" " alt="" coords="5,51,111,78"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2184,576,2359,603"/>
<area shape="rect" href="spte_8c.html#acde6f5a6ce759cab5d21b74658796860" title=" " alt="" coords="159,44,341,85"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="163,135,337,162"/>
<area shape="rect" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909" title=" " alt="" coords="1288,44,1455,85"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1530,301,1685,342"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1768,160,1927,187"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="2004,199,2136,226"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1787,312,1908,339"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="389,186,536,212"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="584,714,747,740"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1055,284,1188,311"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1024,234,1219,260"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="810,487,961,514"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1558,764,1657,791"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1540,110,1675,136"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1555,714,1660,740"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="829,663,942,690"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="799,866,972,892"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="814,815,957,842"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="795,967,976,994"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="821,916,949,943"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1072,1018,1171,1044"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1035,386,1207,412"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1026,436,1217,463"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1274,328,1469,369"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1071,487,1171,514"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1038,538,1205,580"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1045,604,1198,631"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1289,394,1454,420"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1267,211,1476,238"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1274,262,1469,304"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1524,250,1691,276"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1797,764,1898,791"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1763,262,1932,288"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1306,444,1437,471"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1302,495,1441,522"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1273,546,1470,572"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1294,597,1449,638"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1739,110,1956,136"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1754,714,1941,740"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1029,866,1213,892"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1278,840,1465,867"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1044,815,1199,842"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a01bf8752c61ddeae2878ef46d312e00c_icgraph.png" border="0" usemap="#atdp__mmu_8c_a01bf8752c61ddeae2878ef46d312e00c_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a01bf8752c61ddeae2878ef46d312e00c_icgraph" id="atdp__mmu_8c_a01bf8752c61ddeae2878ef46d312e00c_icgraph">
<area shape="rect" title=" " alt="" coords="453,5,559,32"/>
<area shape="rect" href="tdp__mmu_8c.html#aa53a75612d7b32153949be34f4055144" title=" " alt="" coords="195,5,405,32"/>
<area shape="rect" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d" title=" " alt="" coords="5,5,147,32"/>
</map>
</div>

</div>
</div>
<a id="a5217224e4957f6457786d51ddd62914b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5217224e4957f6457786d51ddd62914b">&#9670;&nbsp;</a></span>tdp_account_mmu_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tdp_account_mmu_page </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>sp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00261">261</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;{</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    kvm_account_pgtable_pages((<span class="keywordtype">void</span> *)sp-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a>, +1);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    atomic64_inc(&amp;kvm-&gt;arch.tdp_mmu_pages);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a5217224e4957f6457786d51ddd62914b_icgraph.png" border="0" usemap="#atdp__mmu_8c_a5217224e4957f6457786d51ddd62914b_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a5217224e4957f6457786d51ddd62914b_icgraph" id="atdp__mmu_8c_a5217224e4957f6457786d51ddd62914b_icgraph">
<area shape="rect" title=" " alt="" coords="3961,232,4143,259"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="3776,232,3913,259"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="3325,207,3481,233"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="3531,257,3728,284"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="3324,258,3483,299"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="3096,258,3276,299"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2861,225,3044,266"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2857,290,3048,331"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2637,225,2803,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2377,225,2583,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2111,232,2329,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1914,232,2057,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2631,290,2809,331"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2402,297,2558,324"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2140,297,2300,324"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1908,290,2063,331"/>
</map>
</div>

</div>
</div>
<a id="aab91e6aa4615cd9bf4f66141ca34642b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab91e6aa4615cd9bf4f66141ca34642b">&#9670;&nbsp;</a></span>tdp_mmu_alloc_sp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a>* tdp_mmu_alloc_sp </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00180">180</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;{</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    sp = kvm_mmu_memory_cache_alloc(&amp;vcpu-&gt;arch.mmu_page_header_cache);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    sp-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a> = kvm_mmu_memory_cache_alloc(&amp;vcpu-&gt;arch.mmu_shadow_page_cache);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">return</span> sp;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aab91e6aa4615cd9bf4f66141ca34642b_icgraph.png" border="0" usemap="#atdp__mmu_8c_aab91e6aa4615cd9bf4f66141ca34642b_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aab91e6aa4615cd9bf4f66141ca34642b_icgraph" id="atdp__mmu_8c_aab91e6aa4615cd9bf4f66141ca34642b_icgraph">
<area shape="rect" title=" " alt="" coords="2045,136,2189,163"/>
<area shape="rect" href="tdp__mmu_8c.html#ae643f902f826e920f4150bb66872fd47" title=" " alt="" coords="1811,99,1997,141"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="1826,165,1982,192"/>
<area shape="rect" href="mmu_8c.html#a171383889d717b24003ee27735437bbe" title=" " alt="" coords="1584,107,1763,133"/>
<area shape="rect" href="mmu_8c.html#a475bd00898314bb9378d8e4306aa7874" title=" " alt="" coords="1409,107,1536,133"/>
<area shape="rect" href="mmu_8h.html#ab0e194ecad859add3d639850021f8b16" title=" " alt="" coords="1221,107,1361,133"/>
<area shape="rect" href="mmu_8c.html#a339656816251af93fbd52aece22a2009" title=" " alt="" coords="1003,70,1173,111"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="589,136,727,163"/>
<area shape="rect" href="async__pf_8c.html#aac6395172fbf7947412604d7e2f33417" title=" " alt="" coords="793,70,955,111"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="571,67,745,93"/>
<area shape="rect" href="svm_8c.html#acb46126747f78036462437a7bcdc2e47" title=" " alt="" coords="427,5,508,32"/>
<area shape="rect" href="svm_8c.html#aac18b9094154a2c8b8e27c3b08c9e359" title=" " alt="" coords="413,56,522,83"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="412,107,523,133"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="427,157,508,184"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,157,364,184"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,157,129,184"/>
</map>
</div>

</div>
</div>
<a id="aa61edf11261db080cdd6b2bba981310f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa61edf11261db080cdd6b2bba981310f">&#9670;&nbsp;</a></span>tdp_mmu_alloc_sp_for_split()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a>* tdp_mmu_alloc_sp_for_split </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01334">1334</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;{</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160; </div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48">kvm_lockdep_assert_mmu_lock_held</a>(kvm, shared);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160; </div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">     * Since we are allocating while under the MMU lock we have to be</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">     * careful about GFP flags. Use GFP_NOWAIT to avoid blocking on direct</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">     * reclaim and to avoid making any filesystem callbacks (which can end</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">     * up invoking KVM MMU notifiers, resulting in a deadlock).</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">     * If this allocation fails we drop the lock and retry with reclaim</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">     * allowed.</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    sp = <a class="code" href="tdp__mmu_8c.html#aef3c64f4319d3be908d23467dd8fb337">__tdp_mmu_alloc_sp_for_split</a>(GFP_NOWAIT | __GFP_ACCOUNT);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="keywordflow">if</span> (sp)</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="keywordflow">return</span> sp;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160; </div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160; </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="keywordflow">if</span> (shared)</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        read_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        write_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160; </div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    iter-&gt;<a class="code" href="structtdp__iter.html#a983cb7057ab9ba3c1e3984ce5cd4e295">yielded</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    sp = <a class="code" href="tdp__mmu_8c.html#aef3c64f4319d3be908d23467dd8fb337">__tdp_mmu_alloc_sp_for_split</a>(GFP_KERNEL_ACCOUNT);</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160; </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keywordflow">if</span> (shared)</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        read_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        write_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160; </div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160; </div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <span class="keywordflow">return</span> sp;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;}</div>
<div class="ttc" id="astructtdp__iter_html_a983cb7057ab9ba3c1e3984ce5cd4e295"><div class="ttname"><a href="structtdp__iter.html#a983cb7057ab9ba3c1e3984ce5cd4e295">tdp_iter::yielded</a></div><div class="ttdeci">bool yielded</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00116">tdp_iter.h:116</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_aef3c64f4319d3be908d23467dd8fb337"><div class="ttname"><a href="tdp__mmu_8c.html#aef3c64f4319d3be908d23467dd8fb337">__tdp_mmu_alloc_sp_for_split</a></div><div class="ttdeci">static struct kvm_mmu_page * __tdp_mmu_alloc_sp_for_split(gfp_t gfp)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01315">tdp_mmu.c:1315</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa61edf11261db080cdd6b2bba981310f_cgraph.png" border="0" usemap="#atdp__mmu_8c_aa61edf11261db080cdd6b2bba981310f_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa61edf11261db080cdd6b2bba981310f_cgraph" id="atdp__mmu_8c_aa61edf11261db080cdd6b2bba981310f_cgraph">
<area shape="rect" title=" " alt="" coords="5,39,175,80"/>
<area shape="rect" href="tdp__mmu_8c.html#aef3c64f4319d3be908d23467dd8fb337" title=" " alt="" coords="223,5,381,47"/>
<area shape="rect" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48" title=" " alt="" coords="224,71,380,112"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa61edf11261db080cdd6b2bba981310f_icgraph.png" border="0" usemap="#atdp__mmu_8c_aa61edf11261db080cdd6b2bba981310f_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa61edf11261db080cdd6b2bba981310f_icgraph" id="atdp__mmu_8c_aa61edf11261db080cdd6b2bba981310f_icgraph">
<area shape="rect" title=" " alt="" coords="3531,258,3700,299"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="3324,258,3483,299"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="3096,258,3276,299"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2861,225,3044,266"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2857,290,3048,331"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2637,225,2803,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2377,225,2583,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2111,232,2329,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1914,232,2057,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2631,290,2809,331"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2402,297,2558,324"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2140,297,2300,324"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1908,290,2063,331"/>
</map>
</div>

</div>
</div>
<a id="afab0b8fc9210a8e1190a153f664ef78b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afab0b8fc9210a8e1190a153f664ef78b">&#9670;&nbsp;</a></span>tdp_mmu_free_sp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tdp_mmu_free_sp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>sp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00054">54</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    free_page((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)sp-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a>);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    kmem_cache_free(<a class="code" href="mmu_8c.html#a3634b84158ea95896b7dcbbb228c309c">mmu_page_header_cache</a>, sp);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_afab0b8fc9210a8e1190a153f664ef78b_icgraph.png" border="0" usemap="#atdp__mmu_8c_afab0b8fc9210a8e1190a153f664ef78b_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_afab0b8fc9210a8e1190a153f664ef78b_icgraph" id="atdp__mmu_8c_afab0b8fc9210a8e1190a153f664ef78b_icgraph">
<area shape="rect" title=" " alt="" coords="2388,555,2527,581"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="767,51,923,77"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="2173,547,2340,589"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="2177,739,2336,781"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1959,440,2110,467"/>
<area shape="rect" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0" title=" " alt="" coords="1944,695,2125,721"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1725,440,1887,467"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="1499,440,1646,467"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="1227,211,1426,237"/>
<area shape="rect" href="tdp__mmu_8c.html#a381e22ee819864cf1fd726479a76b6c7" title=" " alt="" coords="1241,493,1413,520"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="1239,388,1414,415"/>
<area shape="rect" href="mmu_8c.html#a85202c8f53b11b1c80f9b6e26210aa9a" title=" " alt="" coords="989,515,1158,557"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="993,312,1154,339"/>
<area shape="rect" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c" title=" " alt="" coords="1021,363,1126,389"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="1005,261,1142,288"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="997,413,1150,440"/>
<area shape="rect" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580" title=" " alt="" coords="1005,464,1141,491"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="771,379,918,405"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="488,439,719,481"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="235,407,440,433"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="249,472,426,499"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="14,392,178,419"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="5,494,187,535"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="14,559,178,601"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="21,443,171,469"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="992,211,1155,237"/>
<area shape="rect" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427" title=" " alt="" coords="988,43,1159,85"/>
<area shape="rect" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d" title=" " alt="" coords="973,109,1174,136"/>
<area shape="rect" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37" title=" " alt="" coords="1005,160,1141,187"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="1716,922,1896,963"/>
<area shape="rect" href="mmu_8c.html#a5b648a843c7267d204fe81facbc9f84f" title=" " alt="" coords="1725,695,1887,721"/>
<area shape="rect" href="tdp__mmu_8c.html#a5d434b3d8d515d7e4c585ae3aa7e15fa" title=" " alt="" coords="1729,745,1883,772"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="1481,1011,1664,1053"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="1477,1243,1668,1285"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="1243,1237,1410,1278"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="971,1237,1176,1278"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="1237,1302,1416,1343"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="995,1309,1151,1336"/>
<area shape="rect" href="mmu_8c.html#ab7d4e418cb85a72507e384df5027293e" title=" " alt="" coords="1490,876,1655,903"/>
<area shape="rect" href="mmu_8c.html#ae3c450d21264b7f2a31cc71d03c2a658" title=" " alt="" coords="1225,1003,1428,1045"/>
<area shape="rect" href="mmu_8c.html#accc9c990bf354ea4f50d7e9c2deee3e4" title=" " alt="" coords="1245,1069,1408,1110"/>
<area shape="rect" href="mmu_8c.html#a0e7f249026693e08d3c8b70f7ffd5003" title=" " alt="" coords="1010,1105,1137,1132"/>
<area shape="rect" href="vmx_2nested_8c.html#ad9920ec1586ae352fbc272ed93cf7b38" title=" " alt="" coords="1277,1185,1376,1212"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="1269,632,1384,659"/>
<area shape="rect" href="x86_8c.html#aa792359250f034a2a29b0c809df64ff3" title=" " alt="" coords="1248,683,1405,709"/>
<area shape="rect" href="mmu_8c.html#aed9206081417b11ad2654d347022bb05" title=" " alt="" coords="1243,734,1411,775"/>
<area shape="rect" href="mmu_8c.html#a6d448c19a18bd089be4c218a86d523be" title=" " alt="" coords="1224,800,1429,827"/>
<area shape="rect" href="mmu_8c.html#a7bf770a114656f992dd1c0aff57fe9e5" title=" " alt="" coords="1255,851,1398,877"/>
<area shape="rect" href="x86_8c.html#ae69bdd054a70a95d99b79bae770372cf" title=" " alt="" coords="1277,901,1376,928"/>
<area shape="rect" href="vmx_2nested_8c.html#a5a5df09c88b5fad9a716109f9917e9a5" title=" " alt="" coords="1237,952,1416,979"/>
</map>
</div>

</div>
</div>
<a id="a92b80ecd9f7bf033d7ed2f28fb0a1279"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92b80ecd9f7bf033d7ed2f28fb0a1279">&#9670;&nbsp;</a></span>tdp_mmu_free_sp_rcu_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tdp_mmu_free_sp_rcu_callback </td>
          <td>(</td>
          <td class="paramtype">struct rcu_head *&#160;</td>
          <td class="paramname"><em>head</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00068">68</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp = container_of(head, <span class="keyword">struct</span> <a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                           rcu_head);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b">tdp_mmu_free_sp</a>(sp);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a92b80ecd9f7bf033d7ed2f28fb0a1279_cgraph.png" border="0" usemap="#atdp__mmu_8c_a92b80ecd9f7bf033d7ed2f28fb0a1279_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a92b80ecd9f7bf033d7ed2f28fb0a1279_cgraph" id="atdp__mmu_8c_a92b80ecd9f7bf033d7ed2f28fb0a1279_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,172,47"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="220,13,359,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a92b80ecd9f7bf033d7ed2f28fb0a1279_icgraph.png" border="0" usemap="#atdp__mmu_8c_a92b80ecd9f7bf033d7ed2f28fb0a1279_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a92b80ecd9f7bf033d7ed2f28fb0a1279_icgraph" id="atdp__mmu_8c_a92b80ecd9f7bf033d7ed2f28fb0a1279_icgraph">
<area shape="rect" title=" " alt="" coords="2240,452,2407,493"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="2026,350,2177,377"/>
<area shape="rect" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0" title=" " alt="" coords="2011,591,2192,618"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1791,350,1954,377"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="1566,173,1713,199"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="1294,350,1493,377"/>
<area shape="rect" href="tdp__mmu_8c.html#a381e22ee819864cf1fd726479a76b6c7" title=" " alt="" coords="1307,67,1479,94"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="1306,173,1481,199"/>
<area shape="rect" href="mmu_8c.html#a85202c8f53b11b1c80f9b6e26210aa9a" title=" " alt="" coords="1057,5,1227,47"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="1061,274,1223,301"/>
<area shape="rect" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c" title=" " alt="" coords="1089,122,1195,149"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="1073,223,1211,250"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="1065,173,1219,199"/>
<area shape="rect" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580" title=" " alt="" coords="1074,71,1210,98"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="807,322,953,349"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="488,424,719,465"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="235,391,440,418"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="249,457,426,483"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="14,377,178,403"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="5,479,187,520"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="14,544,178,585"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="21,427,171,454"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="525,205,681,231"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="781,154,979,181"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="1061,375,1223,402"/>
<area shape="rect" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427" title=" " alt="" coords="795,256,965,297"/>
<area shape="rect" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d" title=" " alt="" coords="1041,430,1243,457"/>
<area shape="rect" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37" title=" " alt="" coords="1074,485,1210,511"/>
<area shape="rect" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c" title=" " alt="" coords="767,373,993,399"/>
<area shape="rect" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf" title=" " alt="" coords="801,424,959,465"/>
<area shape="rect" href="tdp__mmu_8c.html#a7f6c658f3ddf3ffac5ce96335b78e295" title=" " alt="" coords="780,490,980,517"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="1783,643,1963,684"/>
<area shape="rect" href="mmu_8c.html#a5b648a843c7267d204fe81facbc9f84f" title=" " alt="" coords="1792,831,1953,858"/>
<area shape="rect" href="tdp__mmu_8c.html#a5d434b3d8d515d7e4c585ae3aa7e15fa" title=" " alt="" coords="1796,591,1949,618"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="1548,657,1731,699"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="1544,592,1735,633"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="1310,657,1477,699"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="1304,592,1483,633"/>
<area shape="rect" href="mmu_8c.html#ab7d4e418cb85a72507e384df5027293e" title=" " alt="" coords="1557,985,1722,1011"/>
<area shape="rect" href="mmu_8c.html#ae3c450d21264b7f2a31cc71d03c2a658" title=" " alt="" coords="1292,723,1495,764"/>
<area shape="rect" href="mmu_8c.html#accc9c990bf354ea4f50d7e9c2deee3e4" title=" " alt="" coords="1312,788,1475,829"/>
<area shape="rect" href="mmu_8c.html#a0e7f249026693e08d3c8b70f7ffd5003" title=" " alt="" coords="1079,1010,1205,1037"/>
<area shape="rect" href="vmx_2nested_8c.html#ad9920ec1586ae352fbc272ed93cf7b38" title=" " alt="" coords="1344,854,1443,881"/>
<area shape="rect" href="vmx_2nested_8c.html#a54e70f407596ed5f029a4e4a9855d76c" title=" " alt="" coords="1336,905,1451,931"/>
<area shape="rect" href="x86_8c.html#aa792359250f034a2a29b0c809df64ff3" title=" " alt="" coords="1315,955,1472,982"/>
<area shape="rect" href="mmu_8c.html#aed9206081417b11ad2654d347022bb05" title=" " alt="" coords="1309,1007,1477,1048"/>
<area shape="rect" href="mmu_8c.html#a6d448c19a18bd089be4c218a86d523be" title=" " alt="" coords="1291,1073,1496,1099"/>
<area shape="rect" href="mmu_8c.html#a7bf770a114656f992dd1c0aff57fe9e5" title=" " alt="" coords="1322,1123,1465,1150"/>
<area shape="rect" href="x86_8c.html#ae69bdd054a70a95d99b79bae770372cf" title=" " alt="" coords="1344,1174,1443,1201"/>
<area shape="rect" href="vmx_2nested_8c.html#a5a5df09c88b5fad9a716109f9917e9a5" title=" " alt="" coords="1304,1275,1483,1302"/>
</map>
</div>

</div>
</div>
<a id="a502cd8b971218c38ecd999409fc15ee3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a502cd8b971218c38ecd999409fc15ee3">&#9670;&nbsp;</a></span>tdp_mmu_init_child_sp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tdp_mmu_init_child_sp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>child_sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00205">205</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;{</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *parent_sp;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keyword">union </span>kvm_mmu_page_role role;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    parent_sp = <a class="code" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13">sptep_to_sp</a>(rcu_dereference(iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>));</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    role = parent_sp-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    role.level--;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a8d6f094dd9ef458c1c57aee653afd602">tdp_mmu_init_sp</a>(child_sp, iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>, iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>, role);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a502cd8b971218c38ecd999409fc15ee3_cgraph.png" border="0" usemap="#atdp__mmu_8c_a502cd8b971218c38ecd999409fc15ee3_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a502cd8b971218c38ecd999409fc15ee3_cgraph" id="atdp__mmu_8c_a502cd8b971218c38ecd999409fc15ee3_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,177,57"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="243,5,343,32"/>
<area shape="rect" href="tdp__mmu_8c.html#a8d6f094dd9ef458c1c57aee653afd602" title=" " alt="" coords="225,56,360,83"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="408,5,539,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a502cd8b971218c38ecd999409fc15ee3_icgraph.png" border="0" usemap="#atdp__mmu_8c_a502cd8b971218c38ecd999409fc15ee3_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a502cd8b971218c38ecd999409fc15ee3_icgraph" id="atdp__mmu_8c_a502cd8b971218c38ecd999409fc15ee3_icgraph">
<area shape="rect" title=" " alt="" coords="3531,236,3703,263"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="3325,207,3481,233"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="3324,258,3483,299"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="3096,258,3276,299"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2861,225,3044,266"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2857,290,3048,331"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2637,225,2803,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2377,225,2583,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2111,232,2329,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1914,232,2057,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2631,290,2809,331"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2402,297,2558,324"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2140,297,2300,324"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1908,290,2063,331"/>
</map>
</div>

</div>
</div>
<a id="a8d6f094dd9ef458c1c57aee653afd602"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d6f094dd9ef458c1c57aee653afd602">&#9670;&nbsp;</a></span>tdp_mmu_init_sp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tdp_mmu_init_sp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a>&#160;</td>
          <td class="paramname"><em>sptep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union kvm_mmu_page_role&#160;</td>
          <td class="paramname"><em>role</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00190">190</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    INIT_LIST_HEAD(&amp;sp-&gt;<a class="code" href="structkvm__mmu__page.html#a6a67c3f1dd304ec2730973d68f6ac4f7">possible_nx_huge_page_link</a>);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    set_page_private(virt_to_page(sp-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a>), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)sp);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    sp-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a> = role;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    sp-&gt;<a class="code" href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">gfn</a> = gfn;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    sp-&gt;<a class="code" href="structkvm__mmu__page.html#a354e43de3a7ea16fee41005505982422">ptep</a> = sptep;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    sp-&gt;<a class="code" href="structkvm__mmu__page.html#aaa85f786ecee91a190d244221531622b">tdp_mmu_page</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    trace_kvm_mmu_get_page(sp, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div>
<div class="ttc" id="astructkvm__mmu__page_html_a6a67c3f1dd304ec2730973d68f6ac4f7"><div class="ttname"><a href="structkvm__mmu__page.html#a6a67c3f1dd304ec2730973d68f6ac4f7">kvm_mmu_page::possible_nx_huge_page_link</a></div><div class="ttdeci">struct list_head possible_nx_huge_page_link</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00109">mmu_internal.h:118</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_aaa85f786ecee91a190d244221531622b"><div class="ttname"><a href="structkvm__mmu__page.html#aaa85f786ecee91a190d244221531622b">kvm_mmu_page::tdp_mmu_page</a></div><div class="ttdeci">bool tdp_mmu_page</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00060">mmu_internal.h:60</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a8d6f094dd9ef458c1c57aee653afd602_icgraph.png" border="0" usemap="#atdp__mmu_8c_a8d6f094dd9ef458c1c57aee653afd602_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a8d6f094dd9ef458c1c57aee653afd602_icgraph" id="atdp__mmu_8c_a8d6f094dd9ef458c1c57aee653afd602_icgraph">
<area shape="rect" title=" " alt="" coords="3731,160,3865,187"/>
<area shape="rect" href="tdp__mmu_8c.html#ae643f902f826e920f4150bb66872fd47" title=" " alt="" coords="3496,123,3683,165"/>
<area shape="rect" href="tdp__mmu_8c.html#a502cd8b971218c38ecd999409fc15ee3" title=" " alt="" coords="3503,189,3675,216"/>
<area shape="rect" href="mmu_8c.html#a171383889d717b24003ee27735437bbe" title=" " alt="" coords="3062,131,3241,157"/>
<area shape="rect" href="mmu_8c.html#a475bd00898314bb9378d8e4306aa7874" title=" " alt="" coords="2855,131,2981,157"/>
<area shape="rect" href="mmu_8h.html#ab0e194ecad859add3d639850021f8b16" title=" " alt="" coords="1406,131,1546,157"/>
<area shape="rect" href="mmu_8c.html#a339656816251af93fbd52aece22a2009" title=" " alt="" coords="1133,81,1303,122"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="672,152,809,179"/>
<area shape="rect" href="async__pf_8c.html#aac6395172fbf7947412604d7e2f33417" title=" " alt="" coords="887,81,1048,122"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="653,77,828,104"/>
<area shape="rect" href="svm_8c.html#acb46126747f78036462437a7bcdc2e47" title=" " alt="" coords="468,5,549,32"/>
<area shape="rect" href="svm_8c.html#aac18b9094154a2c8b8e27c3b08c9e359" title=" " alt="" coords="454,56,563,83"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="453,107,564,133"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="468,157,549,184"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,157,364,184"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,157,129,184"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="3291,248,3447,275"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="3289,182,3448,223"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="3061,182,3241,223"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2827,247,3009,289"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2823,182,3013,223"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2602,247,2769,289"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2343,247,2548,289"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2076,255,2295,281"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1879,255,2022,281"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1623,255,1825,281"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1377,340,1575,367"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1382,237,1570,264"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1125,365,1311,392"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1111,416,1325,443"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1133,467,1303,493"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1107,264,1329,291"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1148,315,1288,341"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="899,365,1036,392"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="880,416,1055,443"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="683,416,798,443"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="441,416,577,443"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="677,467,804,493"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="900,517,1035,544"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="412,467,605,493"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="683,517,798,544"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="434,517,583,544"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="426,568,591,595"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="431,619,586,645"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="876,231,1059,257"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1117,198,1319,239"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2596,182,2775,223"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2367,189,2523,216"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2105,189,2265,216"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1873,182,2028,223"/>
</map>
</div>

</div>
</div>
<a id="abc2d73db35961f670cedf8ce1206c4d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc2d73db35961f670cedf8ce1206c4d2">&#9670;&nbsp;</a></span>tdp_mmu_iter_cond_resched()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool __must_check tdp_mmu_iter_cond_resched </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>flush</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00648">648</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;{</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    WARN_ON_ONCE(iter-&gt;<a class="code" href="structtdp__iter.html#a983cb7057ab9ba3c1e3984ce5cd4e295">yielded</a>);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">/* Ensure forward progress has been made before yielding. */</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">if</span> (iter-&gt;<a class="code" href="structtdp__iter.html#add699b3494aafcbc63bf5c66d4281875">next_last_level_gfn</a> == iter-&gt;<a class="code" href="structtdp__iter.html#a98f21bd9a64fdbc0146b38eb7d8b3be4">yielded_gfn</a>)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">if</span> (need_resched() || rwlock_needbreak(&amp;kvm-&gt;mmu_lock)) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">if</span> (flush)</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            <a class="code" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b">kvm_flush_remote_tlbs</a>(kvm);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        rcu_read_unlock();</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keywordflow">if</span> (shared)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            cond_resched_rwlock_read(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            cond_resched_rwlock_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        rcu_read_lock();</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        WARN_ON_ONCE(iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a> &gt; iter-&gt;<a class="code" href="structtdp__iter.html#add699b3494aafcbc63bf5c66d4281875">next_last_level_gfn</a>);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        iter-&gt;<a class="code" href="structtdp__iter.html#a983cb7057ab9ba3c1e3984ce5cd4e295">yielded</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">return</span> iter-&gt;<a class="code" href="structtdp__iter.html#a983cb7057ab9ba3c1e3984ce5cd4e295">yielded</a>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_a54913b65d68c88909678d5cf9c983a6b"><div class="ttname"><a href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b">kvm_flush_remote_tlbs</a></div><div class="ttdeci">void kvm_flush_remote_tlbs(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l00346">kvm_main.c:346</a></div></div>
<div class="ttc" id="astructtdp__iter_html_a98f21bd9a64fdbc0146b38eb7d8b3be4"><div class="ttname"><a href="structtdp__iter.html#a98f21bd9a64fdbc0146b38eb7d8b3be4">tdp_iter::yielded_gfn</a></div><div class="ttdeci">gfn_t yielded_gfn</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00089">tdp_iter.h:89</a></div></div>
<div class="ttc" id="astructtdp__iter_html_add699b3494aafcbc63bf5c66d4281875"><div class="ttname"><a href="structtdp__iter.html#add699b3494aafcbc63bf5c66d4281875">tdp_iter::next_last_level_gfn</a></div><div class="ttdeci">gfn_t next_last_level_gfn</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00083">tdp_iter.h:83</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_abc2d73db35961f670cedf8ce1206c4d2_cgraph.png" border="0" usemap="#atdp__mmu_8c_abc2d73db35961f670cedf8ce1206c4d2_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_abc2d73db35961f670cedf8ce1206c4d2_cgraph" id="atdp__mmu_8c_abc2d73db35961f670cedf8ce1206c4d2_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,215,57"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="263,31,437,57"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="485,31,696,57"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="744,23,955,65"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1013,5,1180,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1003,56,1191,83"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1287,5,1366,32"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1239,56,1415,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1250,107,1403,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_abc2d73db35961f670cedf8ce1206c4d2_icgraph.png" border="0" usemap="#atdp__mmu_8c_abc2d73db35961f670cedf8ce1206c4d2_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_abc2d73db35961f670cedf8ce1206c4d2_icgraph" id="atdp__mmu_8c_abc2d73db35961f670cedf8ce1206c4d2_icgraph">
<area shape="rect" title=" " alt="" coords="1556,729,1765,755"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="1346,389,1507,415"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="1345,877,1508,903"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="1347,692,1506,733"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="1350,577,1503,603"/>
<area shape="rect" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37" title=" " alt="" coords="1359,759,1495,786"/>
<area shape="rect" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf" title=" " alt="" coords="1348,811,1505,852"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="1111,245,1257,271"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="821,245,994,271"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="792,179,1023,220"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="569,241,714,267"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="255,241,459,267"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="6,241,175,267"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="539,187,744,214"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="553,107,730,134"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="275,187,439,214"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="5,189,176,215"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="19,138,162,165"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="267,5,448,47"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="275,71,439,112"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="282,137,433,163"/>
<area shape="rect" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c" title=" " alt="" coords="1071,887,1297,914"/>
<area shape="rect" href="mmu_8c.html#acb92068f6e948846797ac6814b3618f1" title=" " alt="" coords="810,885,1005,927"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="558,803,725,844"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="255,803,460,844"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="1094,689,1274,731"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="816,689,999,731"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="812,624,1003,665"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="552,716,731,757"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="279,745,435,771"/>
<area shape="rect" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501" title=" " alt="" coords="1084,569,1284,611"/>
<area shape="rect" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8" title=" " alt="" coords="1089,518,1279,545"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="820,573,995,599"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="831,518,984,545"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="566,428,717,469"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="543,519,740,560"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="571,643,711,670"/>
<area shape="rect" href="mtrr_8c.html#aca604775fbcfad49bfaf9441fc2253dc" title=" " alt="" coords="590,334,693,361"/>
<area shape="rect" href="x86_8c.html#ae1ffb1252c0aa966c6d94279766427ca" title=" " alt="" coords="262,460,453,501"/>
<area shape="rect" href="x86_8c.html#a613f1a822aa2ffa29a32341ec8a92913" title=" " alt="" coords="268,343,447,384"/>
<area shape="rect" href="hyperv_8c.html#a9eaaad1dfbff166c751e725c9fcf73b6" title=" " alt="" coords="279,409,435,435"/>
<area shape="rect" href="x86_8c.html#a541cd35068f221456141f8798a1ab7c9" title=" " alt="" coords="224,526,491,553"/>
<area shape="rect" href="x86_8c.html#aab788793558a6c5c0cdc2e3ec840ebf6" title=" " alt="" coords="278,577,437,619"/>
<area shape="rect" href="svm_8c.html#af4590239d3e0b5fbad189a245207dfaa" title=" " alt="" coords="324,643,391,670"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="305,694,410,721"/>
<area shape="rect" href="mtrr_8c.html#a2b95f238c68e317e64e57d06f2a698dd" title=" " alt="" coords="285,291,430,318"/>
<area shape="rect" href="tdp__mmu_8c.html#a7f6c658f3ddf3ffac5ce96335b78e295" title=" " alt="" coords="1084,761,1284,787"/>
<area shape="rect" href="mmu_8c.html#a168b7814e68a545abd8bf00fc4466610" title=" " alt="" coords="817,755,997,796"/>
<area shape="rect" href="tdp__mmu_8c.html#a3a86994ba17144f60df37ea7682d650b" title=" " alt="" coords="1071,815,1297,856"/>
<area shape="rect" href="mmu_8c.html#a35da5538a61de05522efdad8f615df4f" title=" " alt="" coords="808,820,1007,861"/>
</map>
</div>

</div>
</div>
<a id="af6444812b70d9509539a3fa478cde14d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6444812b70d9509539a3fa478cde14d">&#9670;&nbsp;</a></span>tdp_mmu_iter_set_spte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tdp_mmu_iter_set_spte </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>new_spte</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00612">612</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;{</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    WARN_ON_ONCE(iter-&gt;<a class="code" href="structtdp__iter.html#a983cb7057ab9ba3c1e3984ce5cd4e295">yielded</a>);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a> = <a class="code" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a">tdp_mmu_set_spte</a>(kvm, iter-&gt;<a class="code" href="structtdp__iter.html#a473dd3cffaeffdae16cb52b94286141b">as_id</a>, iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>,</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                      iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>, new_spte,</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                      iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>, iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_af6444812b70d9509539a3fa478cde14d_cgraph.png" border="0" usemap="#atdp__mmu_8c_af6444812b70d9509539a3fa478cde14d_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_af6444812b70d9509539a3fa478cde14d_cgraph" id="atdp__mmu_8c_af6444812b70d9509539a3fa478cde14d_cgraph">
<area shape="rect" title=" " alt="" coords="5,573,180,599"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="228,573,375,599"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="423,573,585,599"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="893,699,1027,726"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="863,227,1057,254"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1369,549,1523,591"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="649,547,799,574"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2023,379,2197,406"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1397,255,1495,282"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1379,633,1513,659"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1393,818,1499,845"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="667,497,781,523"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="637,851,811,878"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="653,902,795,929"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="633,649,815,675"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="660,103,788,130"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="911,154,1009,181"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1625,531,1747,558"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="874,649,1046,675"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="865,598,1055,625"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1113,263,1307,304"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="910,430,1010,457"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="877,481,1043,523"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="883,547,1037,574"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1127,653,1293,679"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1105,146,1315,173"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1113,197,1307,239"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1363,481,1529,507"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1635,255,1737,282"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1607,582,1765,609"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1843,582,1975,609"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1601,430,1771,457"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1145,430,1275,457"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1141,485,1279,511"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1111,602,1309,629"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1133,536,1287,577"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1577,633,1795,659"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1593,683,1779,710"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="868,851,1052,878"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1117,877,1303,903"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="883,902,1037,929"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_af6444812b70d9509539a3fa478cde14d_icgraph.png" border="0" usemap="#atdp__mmu_8c_af6444812b70d9509539a3fa478cde14d_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_af6444812b70d9509539a3fa478cde14d_icgraph" id="atdp__mmu_8c_af6444812b70d9509539a3fa478cde14d_icgraph">
<area shape="rect" title=" " alt="" coords="1835,383,2009,409"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="1625,232,1787,259"/>
<area shape="rect" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c" title=" " alt="" coords="1653,307,1759,333"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="1637,383,1775,409"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="1629,481,1783,508"/>
<area shape="rect" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580" title=" " alt="" coords="1638,561,1774,588"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="1383,147,1530,173"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="1086,40,1259,67"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="1057,139,1288,181"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="831,15,977,41"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="515,5,719,32"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="801,84,1007,111"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="815,171,993,197"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="535,56,699,83"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="527,107,708,149"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="535,173,699,214"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="542,239,693,265"/>
<area shape="rect" href="tdp__mmu_8c.html#aa53a75612d7b32153949be34f4055144" title=" " alt="" coords="1351,293,1562,320"/>
<area shape="rect" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d" title=" " alt="" coords="1102,293,1243,320"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="1095,344,1251,371"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="1358,395,1555,421"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="1093,395,1252,437"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="814,355,994,397"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="526,290,709,331"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="522,355,713,397"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="233,850,412,891"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="5,857,161,884"/>
<area shape="rect" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501" title=" " alt="" coords="1357,474,1557,515"/>
<area shape="rect" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8" title=" " alt="" coords="1362,619,1551,645"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="1085,481,1260,508"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="1096,629,1249,656"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="829,535,979,577"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="805,622,1003,663"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="834,720,974,747"/>
<area shape="rect" href="mtrr_8c.html#aca604775fbcfad49bfaf9441fc2253dc" title=" " alt="" coords="853,796,955,823"/>
<area shape="rect" href="x86_8c.html#ae1ffb1252c0aa966c6d94279766427ca" title=" " alt="" coords="522,421,713,462"/>
<area shape="rect" href="x86_8c.html#a613f1a822aa2ffa29a32341ec8a92913" title=" " alt="" coords="528,486,707,527"/>
<area shape="rect" href="hyperv_8c.html#a9eaaad1dfbff166c751e725c9fcf73b6" title=" " alt="" coords="539,552,695,579"/>
<area shape="rect" href="x86_8c.html#a541cd35068f221456141f8798a1ab7c9" title=" " alt="" coords="484,603,751,629"/>
<area shape="rect" href="x86_8c.html#aab788793558a6c5c0cdc2e3ec840ebf6" title=" " alt="" coords="538,654,697,695"/>
<area shape="rect" href="svm_8c.html#af4590239d3e0b5fbad189a245207dfaa" title=" " alt="" coords="584,720,651,747"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="565,771,670,797"/>
<area shape="rect" href="mtrr_8c.html#a2b95f238c68e317e64e57d06f2a698dd" title=" " alt="" coords="545,821,690,848"/>
<area shape="rect" href="tdp__mmu_8c.html#a45fd618d35fb0df14a3401a230f41faa" title=" " alt="" coords="1336,865,1577,892"/>
<area shape="rect" href="mmu_8c.html#a1f49638b71a482e4b0c3a6af10d0711e" title=" " alt="" coords="1077,915,1268,957"/>
<area shape="rect" href="page__track_8c.html#ab6a4ffea76ea12eb3b1e83eafaf4618b" title=" " alt="" coords="802,923,1006,949"/>
<area shape="rect" href="mmu_8c.html#aec5cf4265713109c5e2ea673c610cd03" title=" " alt="" coords="544,937,691,964"/>
<area shape="rect" href="mmu_8c.html#a2e21344d37e1f1c8c347bed8627da8db" title=" " alt="" coords="799,1024,1009,1051"/>
<area shape="rect" href="mmu_8c.html#a6f305a17525ee7345f0f852070869e4c" title=" " alt="" coords="209,937,436,964"/>
<area shape="rect" href="mmu_8c.html#a2f33377dcdaf5435e453ff75e02075dd" title=" " alt="" coords="541,1024,693,1051"/>
</map>
</div>

</div>
</div>
<a id="a6588b054500f580603f94c0555fe3c06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6588b054500f580603f94c0555fe3c06">&#9670;&nbsp;</a></span>tdp_mmu_link_sp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tdp_mmu_link_sp </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01006">1006</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;{</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    u64 spte = <a class="code" href="spte_8c.html#a98038e4116bcdef6f9e1e335eefc29c9">make_nonleaf_spte</a>(sp-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a>, !<a class="code" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e">kvm_ad_enabled</a>());</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">if</span> (shared) {</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        ret = <a class="code" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6">tdp_mmu_set_spte_atomic</a>(kvm, iter, spte);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <a class="code" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d">tdp_mmu_iter_set_spte</a>(kvm, iter, spte);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    }</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a5217224e4957f6457786d51ddd62914b">tdp_account_mmu_page</a>(kvm, sp);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;}</div>
<div class="ttc" id="aspte_8c_html_a98038e4116bcdef6f9e1e335eefc29c9"><div class="ttname"><a href="spte_8c.html#a98038e4116bcdef6f9e1e335eefc29c9">make_nonleaf_spte</a></div><div class="ttdeci">u64 make_nonleaf_spte(u64 *child_pt, bool ad_disabled)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8c_source.html#l00310">spte.c:310</a></div></div>
<div class="ttc" id="aspte_8h_html_ac3f82ba169af94a026b5df40f3d3753e"><div class="ttname"><a href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e">kvm_ad_enabled</a></div><div class="ttdeci">static bool kvm_ad_enabled(void)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00269">spte.h:269</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a5217224e4957f6457786d51ddd62914b"><div class="ttname"><a href="tdp__mmu_8c.html#a5217224e4957f6457786d51ddd62914b">tdp_account_mmu_page</a></div><div class="ttdeci">static void tdp_account_mmu_page(struct kvm *kvm, struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00261">tdp_mmu.c:261</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a6588b054500f580603f94c0555fe3c06_cgraph.png" border="0" usemap="#atdp__mmu_8c_a6588b054500f580603f94c0555fe3c06_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a6588b054500f580603f94c0555fe3c06_cgraph" id="atdp__mmu_8c_a6588b054500f580603f94c0555fe3c06_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,143,133"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="215,5,348,32"/>
<area shape="rect" href="spte_8c.html#a98038e4116bcdef6f9e1e335eefc29c9" title=" " alt="" coords="207,56,356,83"/>
<area shape="rect" href="tdp__mmu_8c.html#a5217224e4957f6457786d51ddd62914b" title=" " alt="" coords="191,107,372,133"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="194,157,369,184"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="420,208,619,235"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="446,157,593,184"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="667,821,829,848"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1137,143,1271,169"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1107,353,1301,380"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1613,338,1767,379"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="893,527,1043,553"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2267,847,2441,873"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1641,923,1739,949"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1623,847,1757,873"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1637,1075,1743,1101"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="911,897,1025,924"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="881,1151,1055,1177"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="897,1201,1039,1228"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="877,1049,1059,1076"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="904,999,1032,1025"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1155,897,1253,924"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1869,396,1991,423"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1118,628,1290,655"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1109,577,1299,604"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1357,411,1551,453"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1154,527,1254,553"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1121,679,1287,721"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1127,476,1281,503"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1371,644,1537,671"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1349,295,1559,321"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1357,346,1551,387"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1607,621,1773,648"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1879,948,1981,975"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1851,847,2009,873"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="2087,847,2219,873"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1845,621,2015,648"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1389,593,1519,620"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1385,695,1523,721"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1355,543,1553,569"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1377,477,1531,518"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1821,897,2039,924"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1837,1049,2023,1076"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1112,1151,1296,1177"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1361,1176,1547,1203"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1127,1201,1281,1228"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a6588b054500f580603f94c0555fe3c06_icgraph.png" border="0" usemap="#atdp__mmu_8c_a6588b054500f580603f94c0555fe3c06_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a6588b054500f580603f94c0555fe3c06_icgraph" id="atdp__mmu_8c_a6588b054500f580603f94c0555fe3c06_icgraph">
<area shape="rect" title=" " alt="" coords="3776,232,3913,259"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="3325,207,3481,233"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="3531,257,3728,284"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="3324,258,3483,299"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="3096,258,3276,299"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2861,225,3044,266"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2857,290,3048,331"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2637,225,2803,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2377,225,2583,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2111,232,2329,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1914,232,2057,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2631,290,2809,331"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2402,297,2558,324"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2140,297,2300,324"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1908,290,2063,331"/>
</map>
</div>

</div>
</div>
<a id="aa98226578ebe207e97e262a86bbd5427"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa98226578ebe207e97e262a86bbd5427">&#9670;&nbsp;</a></span>tdp_mmu_map_handle_target_level()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tdp_mmu_map_handle_target_level </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__page__fault.html">kvm_page_fault</a> *&#160;</td>
          <td class="paramname"><em>fault</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00943">943</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;{</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp = <a class="code" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13">sptep_to_sp</a>(rcu_dereference(iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>));</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    u64 new_spte;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordtype">int</span> ret = <a class="code" href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dabfabef9865271880389a5b0a0e3dbd60">RET_PF_FIXED</a>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordtype">bool</span> wrprot = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">if</span> (WARN_ON_ONCE(sp-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.level != fault-&gt;<a class="code" href="structkvm__page__fault.html#ad6705ad5f00efe4e9e47328860e9634a">goal_level</a>))</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da5f8c25625c45554fecc5a5b95e63a2e5">RET_PF_RETRY</a>;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">if</span> (unlikely(!fault-&gt;<a class="code" href="structkvm__page__fault.html#a94ca2315c94da3e5ab0273b78ff6da3a">slot</a>))</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        new_spte = <a class="code" href="spte_8c.html#ae55574ff3b0384504236d8fb85a3a6d0">make_mmio_spte</a>(vcpu, iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>, <a class="code" href="spte_8h.html#a6d2b2f22abfb57dd243ea63582db156a">ACC_ALL</a>);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        wrprot = <a class="code" href="spte_8c.html#ab8dba69ef9f5267d41ba061dbe101ded">make_spte</a>(vcpu, sp, fault-&gt;<a class="code" href="structkvm__page__fault.html#a94ca2315c94da3e5ab0273b78ff6da3a">slot</a>, <a class="code" href="spte_8h.html#a6d2b2f22abfb57dd243ea63582db156a">ACC_ALL</a>, iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>,</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                     fault-&gt;<a class="code" href="structkvm__page__fault.html#a784cc6d936bf4aa03731c0620e334553">pfn</a>, iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>, fault-&gt;<a class="code" href="structkvm__page__fault.html#a2226254b058797ac61a2b5347d1877bd">prefetch</a>, <span class="keyword">true</span>,</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                     fault-&gt;<a class="code" href="structkvm__page__fault.html#aff41947455b49de1c0e9d1fddc7273e5">map_writable</a>, &amp;new_spte);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160; </div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">if</span> (new_spte == iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>)</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        ret = <a class="code" href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dadacf3084387ea47f12bc11e866c6ec99">RET_PF_SPURIOUS</a>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6">tdp_mmu_set_spte_atomic</a>(vcpu-&gt;kvm, iter, new_spte))</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da5f8c25625c45554fecc5a5b95e63a2e5">RET_PF_RETRY</a>;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>) &amp;&amp;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;         !<a class="code" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>, iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>))</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <a class="code" href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e">kvm_flush_remote_tlbs_gfn</a>(vcpu-&gt;kvm, iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>, iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>);</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">     * If the page fault was caused by a write but the page is write</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">     * protected, emulation is needed. If the emulation was skipped,</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">     * the vCPU would have the same fault again.</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordflow">if</span> (wrprot) {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="keywordflow">if</span> (fault-&gt;<a class="code" href="structkvm__page__fault.html#a366b2dee3b9a362d1b8a759bfd92bcae">write</a>)</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            ret = <a class="code" href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dad03187d2c9f578d70424cf6ecd860cc8">RET_PF_EMULATE</a>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    }</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">/* If a MMIO SPTE is installed, the MMIO will need to be emulated. */</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordflow">if</span> (unlikely(<a class="code" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7">is_mmio_spte</a>(new_spte))) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        vcpu-&gt;stat.pf_mmio_spte_created++;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        trace_mark_mmio_spte(rcu_dereference(iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>), iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>,</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                     new_spte);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        ret = <a class="code" href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dad03187d2c9f578d70424cf6ecd860cc8">RET_PF_EMULATE</a>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        trace_kvm_mmu_set_spte(iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>, iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>,</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                       rcu_dereference(iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>));</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    }</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160; </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;}</div>
<div class="ttc" id="ammu__internal_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2dabfabef9865271880389a5b0a0e3dbd60"><div class="ttname"><a href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dabfabef9865271880389a5b0a0e3dbd60">RET_PF_FIXED</a></div><div class="ttdeci">@ RET_PF_FIXED</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00278">mmu_internal.h:278</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2dad03187d2c9f578d70424cf6ecd860cc8"><div class="ttname"><a href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dad03187d2c9f578d70424cf6ecd860cc8">RET_PF_EMULATE</a></div><div class="ttdeci">@ RET_PF_EMULATE</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00276">mmu_internal.h:276</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2dadacf3084387ea47f12bc11e866c6ec99"><div class="ttname"><a href="mmu__internal_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2dadacf3084387ea47f12bc11e866c6ec99">RET_PF_SPURIOUS</a></div><div class="ttdeci">@ RET_PF_SPURIOUS</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00279">mmu_internal.h:279</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ae152dfa402f5fe629bd4b1f4f931de1e"><div class="ttname"><a href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e">kvm_flush_remote_tlbs_gfn</a></div><div class="ttdeci">static void kvm_flush_remote_tlbs_gfn(struct kvm *kvm, gfn_t gfn, int level)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00176">mmu_internal.h:176</a></div></div>
<div class="ttc" id="aspte_8c_html_ab8dba69ef9f5267d41ba061dbe101ded"><div class="ttname"><a href="spte_8c.html#ab8dba69ef9f5267d41ba061dbe101ded">make_spte</a></div><div class="ttdeci">bool make_spte(struct kvm_vcpu *vcpu, struct kvm_mmu_page *sp, const struct kvm_memory_slot *slot, unsigned int pte_access, gfn_t gfn, kvm_pfn_t pfn, u64 old_spte, bool prefetch, bool can_unsync, bool host_writable, u64 *new_spte)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8c_source.html#l00137">spte.c:137</a></div></div>
<div class="ttc" id="aspte_8c_html_ae55574ff3b0384504236d8fb85a3a6d0"><div class="ttname"><a href="spte_8c.html#ae55574ff3b0384504236d8fb85a3a6d0">make_mmio_spte</a></div><div class="ttdeci">u64 make_mmio_spte(struct kvm_vcpu *vcpu, u64 gfn, unsigned int access)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8c_source.html#l00071">spte.c:71</a></div></div>
<div class="ttc" id="aspte_8h_html_a6d2b2f22abfb57dd243ea63582db156a"><div class="ttname"><a href="spte_8h.html#a6d2b2f22abfb57dd243ea63582db156a">ACC_ALL</a></div><div class="ttdeci">#define ACC_ALL</div><div class="ttdef"><b>Definition:</b> <a href="spte_8h_source.html#l00049">spte.h:49</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a2226254b058797ac61a2b5347d1877bd"><div class="ttname"><a href="structkvm__page__fault.html#a2226254b058797ac61a2b5347d1877bd">kvm_page_fault::prefetch</a></div><div class="ttdeci">const bool prefetch</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00194">mmu_internal.h:194</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a366b2dee3b9a362d1b8a759bfd92bcae"><div class="ttname"><a href="structkvm__page__fault.html#a366b2dee3b9a362d1b8a759bfd92bcae">kvm_page_fault::write</a></div><div class="ttdeci">const bool write</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00198">mmu_internal.h:198</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a784cc6d936bf4aa03731c0620e334553"><div class="ttname"><a href="structkvm__page__fault.html#a784cc6d936bf4aa03731c0620e334553">kvm_page_fault::pfn</a></div><div class="ttdeci">kvm_pfn_t pfn</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00240">mmu_internal.h:240</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a94ca2315c94da3e5ab0273b78ff6da3a"><div class="ttname"><a href="structkvm__page__fault.html#a94ca2315c94da3e5ab0273b78ff6da3a">kvm_page_fault::slot</a></div><div class="ttdeci">struct kvm_memory_slot * slot</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00236">mmu_internal.h:236</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_aff41947455b49de1c0e9d1fddc7273e5"><div class="ttname"><a href="structkvm__page__fault.html#aff41947455b49de1c0e9d1fddc7273e5">kvm_page_fault::map_writable</a></div><div class="ttdeci">bool map_writable</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00242">mmu_internal.h:242</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa98226578ebe207e97e262a86bbd5427_cgraph.png" border="0" usemap="#atdp__mmu_8c_aa98226578ebe207e97e262a86bbd5427_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa98226578ebe207e97e262a86bbd5427_cgraph" id="atdp__mmu_8c_aa98226578ebe207e97e262a86bbd5427_cgraph">
<area shape="rect" title=" " alt="" coords="5,757,176,798"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1045,992,1143,1019"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="781,891,894,917"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1491,828,1665,855"/>
<area shape="rect" href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e" title=" " alt="" coords="224,329,427,356"/>
<area shape="rect" href="spte_8c.html#ae55574ff3b0384504236d8fb85a3a6d0" title=" " alt="" coords="256,789,395,816"/>
<area shape="rect" href="spte_8c.html#ab8dba69ef9f5267d41ba061dbe101ded" title=" " alt="" coords="535,428,629,455"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1044,1473,1144,1500"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="226,1119,425,1145"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1296,992,1397,1019"/>
<area shape="rect" href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5" title=" " alt="" coords="507,329,657,356"/>
<area shape="rect" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f" title=" " alt="" coords="495,117,669,158"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="750,68,925,95"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="989,43,1199,69"/>
<area shape="rect" href="spte_8c.html#a941485cd3f9578fdfff7474df672b8e4" title=" " alt="" coords="475,789,689,816"/>
<area shape="rect" href="spte_8h.html#aca7067bb9ce45d32003771bcdb7f902b" title=" " alt="" coords="1292,119,1401,145"/>
<area shape="rect" href="mmu__internal_8h.html#a8a367cbfff40c5c72d6f19049da9fc51" title=" " alt="" coords="741,251,934,277"/>
<area shape="rect" href="spte_8h.html#a331291ac914d7a45322fae31df1f5e64" title=" " alt="" coords="786,144,889,171"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1286,493,1407,520"/>
<area shape="rect" href="spte_8c.html#ab239f729574ce926da684e16e1c739fc" title=" " alt="" coords="766,453,909,480"/>
<area shape="rect" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5" title=" " alt="" coords="741,505,934,546"/>
<area shape="rect" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15" title=" " alt="" coords="746,301,929,328"/>
<area shape="rect" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909" title=" " alt="" coords="754,622,921,663"/>
<area shape="rect" href="mmu_8c.html#af8846daf6e76a8d619fba16ff979245b" title=" " alt="" coords="737,403,937,429"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="985,739,1203,765"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1001,815,1187,841"/>
<area shape="rect" href="spte_8h.html#a5bbdbb975f397f372a8240c35c3556d0" title=" " alt="" coords="1027,144,1161,171"/>
<area shape="rect" href="spte_8h.html#a2c32e50904a7680b61afa512022cffa3" title=" " alt="" coords="1024,93,1164,120"/>
<area shape="rect" href="dirty__ring_8c.html#ac1878b63f1f337e93cf186ebd4fffcc4" title=" " alt="" coords="1008,347,1180,389"/>
<area shape="rect" href="dirty__ring_8c.html#a81ebbf462440ed5392d6d3412a859ae7" title=" " alt="" coords="1015,245,1173,272"/>
<area shape="rect" href="kvm__main_8c.html#ac5a3afd8e2d8d1139dc7711c4b9e07e3" title=" " alt="" coords="1007,296,1181,323"/>
<area shape="rect" href="dirty__ring_8c.html#ad6e626257c739b2ac3d397119a7cf798" title=" " alt="" coords="1251,195,1443,221"/>
<area shape="rect" href="dirty__ring_8c.html#a6fe5cd75b9bac6497e1ae7340f2a5f7b" title=" " alt="" coords="1273,245,1421,272"/>
<area shape="rect" href="dirty__ring_8c.html#a22c9a239acf3463a8599a21c0a756538" title=" " alt="" coords="1257,296,1436,323"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1017,566,1171,607"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1015,688,1173,715"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1281,727,1413,753"/>
<area shape="rect" href="page__track_8c.html#a73235ad2d0552c7e4b6b69d729fa79b1" title=" " alt="" coords="998,464,1190,491"/>
<area shape="rect" href="mmu_8c.html#a01f2e3d13500ebb1caa2021001ba4026" title=" " alt="" coords="1023,515,1165,541"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1281,1473,1412,1500"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="501,1119,663,1145"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1027,1397,1161,1424"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="762,1397,913,1424"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="770,739,905,765"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="785,941,890,968"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="751,1195,924,1221"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="766,1245,909,1272"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="747,1296,928,1323"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="773,1043,901,1069"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1045,1093,1143,1120"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa98226578ebe207e97e262a86bbd5427_icgraph.png" border="0" usemap="#atdp__mmu_8c_aa98226578ebe207e97e262a86bbd5427_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa98226578ebe207e97e262a86bbd5427_icgraph" id="atdp__mmu_8c_aa98226578ebe207e97e262a86bbd5427_icgraph">
<area shape="rect" title=" " alt="" coords="209,5,380,47"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="5,13,161,39"/>
</map>
</div>

</div>
</div>
<a id="ac323268ae26fde5a608d694f4943d476"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac323268ae26fde5a608d694f4943d476">&#9670;&nbsp;</a></span>tdp_mmu_max_gfn_exclusive()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static gfn_t tdp_mmu_max_gfn_exclusive </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00679">679</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;{</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">     * Bound TDP MMU walks at host.MAXPHYADDR.  KVM disallows memslots with</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">     * a gpa range that would exceed the max gfn, and KVM does not create</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">     * MMIO SPTEs for &quot;impossible&quot; gfns, instead sending such accesses down</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">     * the slow emulation path every time.</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778">kvm_mmu_max_gfn</a>() + 1;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;}</div>
<div class="ttc" id="ammu_8h_html_a6555cf2d510d04ae19bee154d166f778"><div class="ttname"><a href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778">kvm_mmu_max_gfn</a></div><div class="ttdeci">static gfn_t kvm_mmu_max_gfn(void)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8h_source.html#l00066">mmu.h:66</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ac323268ae26fde5a608d694f4943d476_cgraph.png" border="0" usemap="#atdp__mmu_8c_ac323268ae26fde5a608d694f4943d476_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_ac323268ae26fde5a608d694f4943d476_cgraph" id="atdp__mmu_8c_ac323268ae26fde5a608d694f4943d476_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,223,32"/>
<area shape="rect" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778" title=" " alt="" coords="271,5,427,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ac323268ae26fde5a608d694f4943d476_icgraph.png" border="0" usemap="#atdp__mmu_8c_ac323268ae26fde5a608d694f4943d476_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ac323268ae26fde5a608d694f4943d476_icgraph" id="atdp__mmu_8c_ac323268ae26fde5a608d694f4943d476_icgraph">
<area shape="rect" title=" " alt="" coords="2261,247,2479,273"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="2052,217,2213,244"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="2056,272,2209,299"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="1831,169,1977,196"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="1554,89,1727,116"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="1525,162,1756,203"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="1302,56,1447,83"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="989,31,1193,57"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="715,5,885,32"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="470,16,605,43"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="1272,121,1477,148"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="1286,201,1463,228"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="1009,107,1173,133"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="715,56,885,83"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="729,107,871,133"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="474,77,601,104"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="447,150,628,191"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="1009,209,1173,250"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="1015,275,1166,301"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="196,187,384,213"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="5,187,148,213"/>
<area shape="rect" href="x86_8c.html#ae7e25dec8e0af366fb3db41dc9881970" title=" " alt="" coords="691,216,909,243"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="432,216,643,243"/>
<area shape="rect" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501" title=" " alt="" coords="1804,265,2004,306"/>
<area shape="rect" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8" title=" " alt="" coords="1809,417,1999,444"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="1553,272,1728,299"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="1564,537,1717,564"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="1299,413,1450,454"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="1276,530,1473,571"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="1305,625,1445,652"/>
<area shape="rect" href="mtrr_8c.html#aca604775fbcfad49bfaf9441fc2253dc" title=" " alt="" coords="1323,701,1426,728"/>
<area shape="rect" href="x86_8c.html#ae1ffb1252c0aa966c6d94279766427ca" title=" " alt="" coords="995,326,1186,367"/>
<area shape="rect" href="x86_8c.html#a613f1a822aa2ffa29a32341ec8a92913" title=" " alt="" coords="1001,391,1180,433"/>
<area shape="rect" href="hyperv_8c.html#a9eaaad1dfbff166c751e725c9fcf73b6" title=" " alt="" coords="1013,457,1169,484"/>
<area shape="rect" href="x86_8c.html#ae3d9929c9a77fa2c710befa0a784d4c6" title=" " alt="" coords="721,326,879,367"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="475,333,599,360"/>
<area shape="rect" href="hyperv_8c.html#addb1696255847fad41e6cbadd2e31f57" title=" " alt="" coords="743,457,857,484"/>
<area shape="rect" href="x86_8c.html#a541cd35068f221456141f8798a1ab7c9" title=" " alt="" coords="957,508,1224,535"/>
<area shape="rect" href="x86_8c.html#aab788793558a6c5c0cdc2e3ec840ebf6" title=" " alt="" coords="1011,559,1170,601"/>
<area shape="rect" href="vfio_8c.html#a0f8a9bc6a328c121266b7bedf8ccbe28" title=" " alt="" coords="696,508,904,535"/>
<area shape="rect" href="svm_8c.html#af4590239d3e0b5fbad189a245207dfaa" title=" " alt="" coords="1057,625,1124,652"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="1038,676,1143,703"/>
<area shape="rect" href="svm_8c.html#ad1887c4bb9c78c577fb20a129d73ea41" title=" " alt="" coords="741,559,859,585"/>
<area shape="rect" href="smm_8c.html#a0943012ff008c7999f582998f0f9167a" title=" " alt="" coords="718,609,882,636"/>
<area shape="rect" href="x86_8c.html#a86812e4228865668099921709e1c2f26" title=" " alt="" coords="737,660,863,687"/>
<area shape="rect" href="vmx_8c.html#ac02e59b539f5874eaeb4b12568e9d0dd" title=" " alt="" coords="740,711,860,737"/>
<area shape="rect" href="x86_8c.html#abe99237e5fd6f33407bc30aa2647e0db" title=" " alt="" coords="753,761,847,788"/>
<area shape="rect" href="smm_8c.html#a0c50da2c4874eda6d67766974a476019" title=" " alt="" coords="699,812,901,839"/>
<area shape="rect" href="mtrr_8c.html#a2b95f238c68e317e64e57d06f2a698dd" title=" " alt="" coords="1018,795,1163,821"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="713,863,887,889"/>
</map>
</div>

</div>
</div>
<a id="a8d2a2606fb90f6b6e1a2559d12c04ee8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d2a2606fb90f6b6e1a2559d12c04ee8">&#9670;&nbsp;</a></span>tdp_mmu_need_write_protect()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool tdp_mmu_need_write_protect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>sp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01501">1501</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;{</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">     * All TDP MMU shadow pages share the same role as their root, aside</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">     * from level, so it is valid to key off any shadow page to determine if</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">     * write protection is needed for an entire tree.</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5">kvm_mmu_page_ad_need_write_protect</a>(sp) || !<a class="code" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e">kvm_ad_enabled</a>();</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;}</div>
<div class="ttc" id="ammu__internal_8h_html_a32da0c4cb2494f355e66aabe82bc1bb5"><div class="ttname"><a href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5">kvm_mmu_page_ad_need_write_protect</a></div><div class="ttdeci">static bool kvm_mmu_page_ad_need_write_protect(struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00148">mmu_internal.h:148</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a8d2a2606fb90f6b6e1a2559d12c04ee8_cgraph.png" border="0" usemap="#atdp__mmu_8c_a8d2a2606fb90f6b6e1a2559d12c04ee8_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a8d2a2606fb90f6b6e1a2559d12c04ee8_cgraph" id="atdp__mmu_8c_a8d2a2606fb90f6b6e1a2559d12c04ee8_cgraph">
<area shape="rect" title=" " alt="" coords="5,27,168,69"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="246,5,379,32"/>
<area shape="rect" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5" title=" " alt="" coords="216,57,409,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a8d2a2606fb90f6b6e1a2559d12c04ee8_icgraph.png" border="0" usemap="#atdp__mmu_8c_a8d2a2606fb90f6b6e1a2559d12c04ee8_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a8d2a2606fb90f6b6e1a2559d12c04ee8_icgraph" id="atdp__mmu_8c_a8d2a2606fb90f6b6e1a2559d12c04ee8_icgraph">
<area shape="rect" title=" " alt="" coords="3592,261,3755,302"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="3378,241,3541,268"/>
<area shape="rect" href="tdp__mmu_8c.html#a302b8c57cfb6b9bc82a2f68047477145" title=" " alt="" coords="3375,293,3544,320"/>
<area shape="rect" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c" title=" " alt="" coords="3100,236,3327,263"/>
<area shape="rect" href="mmu_8c.html#acb92068f6e948846797ac6814b3618f1" title=" " alt="" coords="2857,225,3052,266"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2637,225,2803,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2377,225,2583,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2111,232,2329,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1914,232,2057,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
<area shape="rect" href="tdp__mmu_8c.html#ad1753c27bb053bc6ac3a3893e10b49f6" title=" " alt="" coords="3115,290,3311,331"/>
<area shape="rect" href="mmu_8c.html#afeee4db4dd885d0e891ccb05f545c876" title=" " alt="" coords="2871,290,3039,331"/>
<area shape="rect" href="mmu_8c.html#ace4eaa769a0c9e1f75a3900a51275d18" title=" " alt="" coords="2862,355,3047,397"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2631,322,2809,363"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2402,329,2558,356"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2140,329,2300,356"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1908,322,2063,363"/>
</map>
</div>

</div>
</div>
<a id="a5d434b3d8d515d7e4c585ae3aa7e15fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d434b3d8d515d7e4c585ae3aa7e15fa">&#9670;&nbsp;</a></span>tdp_mmu_next_root()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a>* tdp_mmu_next_root </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>prev_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>only_valid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00104">104</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;{</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *next_root;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">     * While the roots themselves are RCU-protected, fields such as</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">     * role.invalid are protected by mmu_lock.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    lockdep_assert_held(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> (prev_root)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        next_root = list_next_or_null_rcu(&amp;kvm-&gt;arch.tdp_mmu_roots,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                          &amp;prev_root-&gt;<a class="code" href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">link</a>,</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                          typeof(*prev_root), <a class="code" href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">link</a>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        next_root = list_first_or_null_rcu(&amp;kvm-&gt;arch.tdp_mmu_roots,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                           typeof(*next_root), <a class="code" href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">link</a>);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">while</span> (next_root) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">if</span> ((!only_valid || !next_root-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.invalid) &amp;&amp;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <a class="code" href="tdp__mmu_8h.html#ae8fe85fef7c2fb884cd2d27810a84d0b">kvm_tdp_mmu_get_root</a>(next_root))</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        next_root = list_next_or_null_rcu(&amp;kvm-&gt;arch.tdp_mmu_roots,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                &amp;next_root-&gt;<a class="code" href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">link</a>, typeof(*next_root), <a class="code" href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">link</a>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (prev_root)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <a class="code" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0">kvm_tdp_mmu_put_root</a>(kvm, prev_root);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">return</span> next_root;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a5d434b3d8d515d7e4c585ae3aa7e15fa_cgraph.png" border="0" usemap="#atdp__mmu_8c_a5d434b3d8d515d7e4c585ae3aa7e15fa_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a5d434b3d8d515d7e4c585ae3aa7e15fa_cgraph" id="atdp__mmu_8c_a5d434b3d8d515d7e4c585ae3aa7e15fa_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,159,57"/>
<area shape="rect" href="tdp__mmu_8h.html#ae8fe85fef7c2fb884cd2d27810a84d0b" title=" " alt="" coords="207,5,388,32"/>
<area shape="rect" href="tdp__mmu_8c.html#a8a9d637b546d8dfd125028f823a6eac0" title=" " alt="" coords="207,56,388,83"/>
<area shape="rect" href="tdp__mmu_8h.html#a166bc9e57a26e8a37e94e2314a72d226" title=" " alt="" coords="449,27,590,53"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="436,78,603,119"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="651,85,789,112"/>
</map>
</div>

</div>
</div>
<a id="a1880e056251c1743579f5c7a25ccad1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1880e056251c1743579f5c7a25ccad1a">&#9670;&nbsp;</a></span>tdp_mmu_set_spte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u64 tdp_mmu_set_spte </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>as_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a>&#160;</td>
          <td class="paramname"><em>sptep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>old_spte</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>new_spte</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00592">592</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;{</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">     * No thread should be using this function to set SPTEs to or from the</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">     * temporary removed SPTE value.</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">     * If operating under the MMU lock in read mode, tdp_mmu_set_spte_atomic</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">     * should be used. If operating under the MMU lock in write mode, the</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">     * use of the removed SPTE should not be necessary.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    WARN_ON_ONCE(<a class="code" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b">is_removed_spte</a>(old_spte) || <a class="code" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b">is_removed_spte</a>(new_spte));</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    old_spte = <a class="code" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4">kvm_tdp_mmu_write_spte</a>(sptep, old_spte, new_spte, level);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af">handle_changed_spte</a>(kvm, as_id, gfn, old_spte, new_spte, level, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">return</span> old_spte;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a1880e056251c1743579f5c7a25ccad1a_cgraph.png" border="0" usemap="#atdp__mmu_8c_a1880e056251c1743579f5c7a25ccad1a_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a1880e056251c1743579f5c7a25ccad1a_cgraph" id="atdp__mmu_8c_a1880e056251c1743579f5c7a25ccad1a_cgraph">
<area shape="rect" title=" " alt="" coords="5,573,152,599"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="200,573,363,599"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="671,699,804,726"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="640,227,835,254"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1146,549,1301,591"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="426,547,577,574"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1800,379,1975,406"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1174,255,1273,282"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1156,633,1291,659"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1171,818,1276,845"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="445,497,558,523"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="415,851,588,878"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="430,902,573,929"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="411,649,592,675"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="437,103,565,130"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="688,154,787,181"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1403,531,1524,558"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="651,649,823,675"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="642,598,833,625"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="890,263,1085,304"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="687,430,787,457"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="654,481,821,523"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="661,547,814,574"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="905,653,1070,679"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="883,146,1092,173"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="890,197,1085,239"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1140,481,1307,507"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1413,255,1514,282"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1384,582,1543,609"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1620,582,1752,609"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1379,430,1548,457"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="922,430,1053,457"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="918,485,1057,511"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="889,602,1086,629"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="910,536,1065,577"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1355,633,1572,659"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1370,683,1557,710"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="645,851,829,878"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="894,877,1081,903"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="660,902,815,929"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a1880e056251c1743579f5c7a25ccad1a_icgraph.png" border="0" usemap="#atdp__mmu_8c_a1880e056251c1743579f5c7a25ccad1a_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a1880e056251c1743579f5c7a25ccad1a_icgraph" id="atdp__mmu_8c_a1880e056251c1743579f5c7a25ccad1a_icgraph">
<area shape="rect" title=" " alt="" coords="1813,245,1960,272"/>
<area shape="rect" href="tdp__mmu_8c.html#a381e22ee819864cf1fd726479a76b6c7" title=" " alt="" coords="1592,179,1764,205"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="1591,271,1765,297"/>
<area shape="rect" href="mmu_8c.html#a85202c8f53b11b1c80f9b6e26210aa9a" title=" " alt="" coords="1373,113,1543,154"/>
<area shape="rect" href="mmu_8c.html#a2683113dbbf42e73c2b52410f9ef6f84" title=" " alt="" coords="1097,67,1313,109"/>
<area shape="rect" href="mmu_8c.html#a13148d5065ef27624701afcaa3229983" title=" " alt="" coords="829,33,1012,60"/>
<area shape="rect" href="x86_8c.html#a91673b399129921871f11d0752eea8c3" title=" " alt="" coords="563,28,741,55"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="1377,184,1539,211"/>
<area shape="rect" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c" title=" " alt="" coords="1405,245,1511,272"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="1389,296,1527,323"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="1381,453,1535,480"/>
<area shape="rect" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580" title=" " alt="" coords="1390,573,1526,600"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="1131,175,1278,201"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="834,95,1007,121"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="805,167,1036,209"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="579,79,725,105"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="263,5,467,32"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="549,129,755,156"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="563,180,741,207"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="283,56,447,83"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="275,107,456,149"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="283,173,447,214"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="290,239,441,265"/>
<area shape="rect" href="tdp__mmu_8c.html#aa53a75612d7b32153949be34f4055144" title=" " alt="" coords="1099,245,1310,272"/>
<area shape="rect" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d" title=" " alt="" coords="850,245,991,272"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="843,296,999,323"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="1106,347,1303,373"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="841,347,1000,389"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="562,347,742,389"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="274,290,457,331"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="270,355,461,397"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="5,534,184,575"/>
<area shape="rect" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501" title=" " alt="" coords="1105,446,1305,487"/>
<area shape="rect" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8" title=" " alt="" coords="1110,540,1299,567"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="833,453,1008,480"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="844,560,997,587"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="577,486,727,527"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="553,553,751,594"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="582,619,722,645"/>
<area shape="rect" href="mtrr_8c.html#aca604775fbcfad49bfaf9441fc2253dc" title=" " alt="" coords="601,669,703,696"/>
<area shape="rect" href="x86_8c.html#ae1ffb1252c0aa966c6d94279766427ca" title=" " alt="" coords="270,421,461,462"/>
<area shape="rect" href="x86_8c.html#a613f1a822aa2ffa29a32341ec8a92913" title=" " alt="" coords="276,486,455,527"/>
<area shape="rect" href="hyperv_8c.html#a9eaaad1dfbff166c751e725c9fcf73b6" title=" " alt="" coords="287,552,443,579"/>
<area shape="rect" href="x86_8c.html#a541cd35068f221456141f8798a1ab7c9" title=" " alt="" coords="232,603,499,629"/>
<area shape="rect" href="x86_8c.html#aab788793558a6c5c0cdc2e3ec840ebf6" title=" " alt="" coords="286,654,445,695"/>
<area shape="rect" href="tdp__mmu_8c.html#a45fd618d35fb0df14a3401a230f41faa" title=" " alt="" coords="1084,671,1325,697"/>
<area shape="rect" href="mmu_8c.html#a1f49638b71a482e4b0c3a6af10d0711e" title=" " alt="" coords="825,763,1016,805"/>
<area shape="rect" href="page__track_8c.html#ab6a4ffea76ea12eb3b1e83eafaf4618b" title=" " alt="" coords="550,771,754,797"/>
<area shape="rect" href="mmu_8c.html#aec5cf4265713109c5e2ea673c610cd03" title=" " alt="" coords="292,796,439,823"/>
<area shape="rect" href="mmu_8c.html#a2e21344d37e1f1c8c347bed8627da8db" title=" " alt="" coords="547,872,757,899"/>
</map>
</div>

</div>
</div>
<a id="a692eb9d20075258e5d4a0e4289a7c9b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a692eb9d20075258e5d4a0e4289a7c9b6">&#9670;&nbsp;</a></span>tdp_mmu_set_spte_atomic()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tdp_mmu_set_spte_atomic </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>new_spte</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00517">517</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;{</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    u64 *sptep = rcu_dereference(iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">     * The caller is responsible for ensuring the old SPTE is not a REMOVED</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">     * SPTE.  KVM should never attempt to zap or manipulate a REMOVED SPTE,</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">     * and pre-checking before inserting a new SPTE is advantageous as it</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">     * avoids unnecessary work.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    WARN_ON_ONCE(iter-&gt;<a class="code" href="structtdp__iter.html#a983cb7057ab9ba3c1e3984ce5cd4e295">yielded</a> || <a class="code" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b">is_removed_spte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>));</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    lockdep_assert_held_read(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">     * Note, fast_pf_fix_direct_spte() can also modify TDP MMU SPTEs and</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">     * does not hold the mmu_lock.  On failure, i.e. if a different logical</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">     * CPU modified the SPTE, try_cmpxchg64() updates iter-&gt;old_spte with</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">     * the current value, so the caller operates on fresh data, e.g. if it</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">     * retries tdp_mmu_set_spte_atomic()</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">if</span> (!try_cmpxchg64(sptep, &amp;iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>, new_spte))</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordflow">return</span> -EBUSY;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af">handle_changed_spte</a>(kvm, iter-&gt;<a class="code" href="structtdp__iter.html#a473dd3cffaeffdae16cb52b94286141b">as_id</a>, iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>, iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>,</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                new_spte, iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a692eb9d20075258e5d4a0e4289a7c9b6_cgraph.png" border="0" usemap="#atdp__mmu_8c_a692eb9d20075258e5d4a0e4289a7c9b6_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a692eb9d20075258e5d4a0e4289a7c9b6_cgraph" id="atdp__mmu_8c_a692eb9d20075258e5d4a0e4289a7c9b6_cgraph">
<area shape="rect" title=" " alt="" coords="5,314,204,340"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="252,503,415,530"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="723,120,856,147"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1198,240,1353,281"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="478,503,629,530"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1852,399,2027,426"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1226,802,1325,828"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1208,188,1343,215"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1223,58,1328,84"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="497,1000,610,1027"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="467,798,640,824"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="482,848,625,875"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="463,171,644,198"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="489,950,617,976"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="740,899,839,926"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1455,247,1576,274"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="703,427,875,454"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="694,579,885,606"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="692,528,887,555"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="942,517,1137,558"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="739,630,839,656"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="706,681,873,722"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="713,376,866,403"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="957,466,1122,492"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="935,583,1144,610"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="942,634,1137,676"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1192,306,1359,332"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1465,802,1566,828"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1436,196,1595,223"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1672,196,1804,223"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1431,348,1600,375"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="974,700,1105,727"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="970,751,1109,778"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="941,348,1138,375"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="962,400,1117,441"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1407,146,1624,172"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1422,95,1609,122"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="697,798,881,824"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="946,852,1133,879"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="712,848,867,875"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a692eb9d20075258e5d4a0e4289a7c9b6_icgraph.png" border="0" usemap="#atdp__mmu_8c_a692eb9d20075258e5d4a0e4289a7c9b6_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a692eb9d20075258e5d4a0e4289a7c9b6_icgraph" id="atdp__mmu_8c_a692eb9d20075258e5d4a0e4289a7c9b6_icgraph">
<area shape="rect" title=" " alt="" coords="2597,155,2796,182"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="2368,365,2529,391"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="2367,70,2530,97"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="2380,181,2517,207"/>
<area shape="rect" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427" title=" " alt="" coords="2101,115,2272,156"/>
<area shape="rect" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d" title=" " alt="" coords="2348,259,2549,286"/>
<area shape="rect" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37" title=" " alt="" coords="2381,17,2517,43"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="2113,410,2260,437"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="1823,505,1997,531"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="1795,403,2025,444"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="1571,514,1717,541"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="1289,523,1493,550"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="1047,523,1217,550"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="802,498,937,525"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="549,498,664,525"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="256,473,449,499"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="1541,463,1747,490"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="1555,393,1733,419"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="1309,473,1473,499"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1047,473,1217,499"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="1061,422,1203,449"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="806,447,933,474"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="779,297,960,339"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="1309,356,1473,397"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="1316,422,1467,449"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="513,307,701,334"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="281,307,424,334"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="5,307,208,334"/>
<area shape="rect" href="x86_8c.html#ae7e25dec8e0af366fb3db41dc9881970" title=" " alt="" coords="1023,363,1241,390"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="764,363,975,390"/>
<area shape="rect" href="kvm__main_8c.html#a52d56a5dc447602839375289b5bbffb2" title=" " alt="" coords="519,362,695,389"/>
<area shape="rect" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c" title=" " alt="" coords="2073,63,2300,90"/>
<area shape="rect" href="mmu_8c.html#acb92068f6e948846797ac6814b3618f1" title=" " alt="" coords="1547,64,1741,105"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="1049,123,1215,164"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="767,127,972,168"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="497,141,716,167"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="1832,166,1988,193"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="2088,231,2285,258"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="1831,217,1989,259"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="1554,188,1734,229"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="1300,123,1483,164"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="1296,188,1487,229"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="1043,188,1221,229"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="791,195,947,222"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="527,195,687,222"/>
<area shape="rect" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf" title=" " alt="" coords="2108,283,2265,324"/>
<area shape="rect" href="tdp__mmu_8c.html#a3a86994ba17144f60df37ea7682d650b" title=" " alt="" coords="1797,283,2023,324"/>
<area shape="rect" href="mmu_8c.html#a35da5538a61de05522efdad8f615df4f" title=" " alt="" coords="1545,268,1743,309"/>
<area shape="rect" href="tdp__mmu_8c.html#a7f6c658f3ddf3ffac5ce96335b78e295" title=" " alt="" coords="2087,13,2287,39"/>
<area shape="rect" href="mmu_8c.html#a168b7814e68a545abd8bf00fc4466610" title=" " alt="" coords="1820,5,2000,47"/>
</map>
</div>

</div>
</div>
<a id="acf7d062eca8e6190d76f4934c290be61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf7d062eca8e6190d76f4934c290be61">&#9670;&nbsp;</a></span>tdp_mmu_split_huge_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tdp_mmu_split_huge_page </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>sp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01376">1376</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;{</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keyword">const</span> u64 huge_spte = iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> level = iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="keywordtype">int</span> ret, i;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160; </div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">     * No need for atomics when writing to sp-&gt;spt since the page table has</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">     * not been linked in yet and thus is not reachable from any other CPU.</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="spte_8h.html#a576b7a13ccedb0b5859a12df4280ed9d">SPTE_ENT_PER_PAGE</a>; i++)</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        sp-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a>[i] = <a class="code" href="spte_8c.html#adc3a08f029fff6aaf2bf687edf69410f">make_huge_page_split_spte</a>(kvm, huge_spte, sp-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>, i);</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160; </div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">     * Replace the huge spte with a pointer to the populated lower level</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">     * page table. Since we are making this change without a TLB flush vCPUs</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">     * will see a mix of the split mappings and the original huge mapping,</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">     * depending on what&#39;s currently in their TLB. This is fine from a</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">     * correctness standpoint since the translation will be the same either</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">     * way.</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    ret = <a class="code" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06">tdp_mmu_link_sp</a>(kvm, iter, sp, shared);</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160; </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">     * tdp_mmu_link_sp_atomic() will handle subtracting the huge page we</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">     * are overwriting from the page stats. But we have to manually update</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment">     * the page stats with the new present child pages.</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <a class="code" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73">kvm_update_page_stats</a>(kvm, level - 1, <a class="code" href="spte_8h.html#a576b7a13ccedb0b5859a12df4280ed9d">SPTE_ENT_PER_PAGE</a>);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160; </div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;out:</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    trace_kvm_mmu_split_huge_page(iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>, huge_spte, level, ret);</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;}</div>
<div class="ttc" id="aspte_8c_html_adc3a08f029fff6aaf2bf687edf69410f"><div class="ttname"><a href="spte_8c.html#adc3a08f029fff6aaf2bf687edf69410f">make_huge_page_split_spte</a></div><div class="ttdeci">u64 make_huge_page_split_spte(struct kvm *kvm, u64 huge_spte, union kvm_mmu_page_role role, int index)</div><div class="ttdef"><b>Definition:</b> <a href="spte_8c_source.html#l00274">spte.c:274</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_acf7d062eca8e6190d76f4934c290be61_cgraph.png" border="0" usemap="#atdp__mmu_8c_acf7d062eca8e6190d76f4934c290be61_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_acf7d062eca8e6190d76f4934c290be61_cgraph" id="atdp__mmu_8c_acf7d062eca8e6190d76f4934c290be61_cgraph">
<area shape="rect" title=" " alt="" coords="5,97,203,124"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1123,97,1304,124"/>
<area shape="rect" href="spte_8c.html#adc3a08f029fff6aaf2bf687edf69410f" title=" " alt="" coords="1352,64,1559,91"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="251,447,388,473"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2142,464,2243,491"/>
<area shape="rect" href="mmu__internal_8h.html#a8a367cbfff40c5c72d6f19049da9fc51" title=" " alt="" coords="1615,64,1808,91"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2529,493,2704,520"/>
<area shape="rect" href="spte_8c.html#ac0162f8b29f82f308036271f93880cd7" title=" " alt="" coords="1626,203,1797,229"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="2113,144,2272,171"/>
<area shape="rect" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909" title=" " alt="" coords="1867,195,2033,237"/>
<area shape="rect" href="spte_8h.html#abc2b9043d48550e741fda1e2ad36a652" title=" " alt="" coords="1864,93,2036,120"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="2349,253,2481,280"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="2115,246,2270,287"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2355,333,2476,360"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="460,573,593,600"/>
<area shape="rect" href="spte_8c.html#a98038e4116bcdef6f9e1e335eefc29c9" title=" " alt="" coords="452,371,601,397"/>
<area shape="rect" href="tdp__mmu_8c.html#a5217224e4957f6457786d51ddd62914b" title=" " alt="" coords="436,421,617,448"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="439,472,614,499"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="665,523,864,549"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="691,472,838,499"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="912,497,1075,524"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1389,1096,1522,1123"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1358,371,1553,397"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1138,827,1289,853"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1901,464,1999,491"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1883,43,2017,69"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1161,624,1266,651"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1157,472,1270,499"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1127,249,1300,276"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1142,148,1285,175"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1149,573,1277,600"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1406,472,1505,499"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1369,1045,1541,1072"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1360,827,1551,853"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1614,726,1809,767"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1405,877,1505,904"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1372,929,1539,970"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1379,995,1532,1021"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1629,1100,1794,1127"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1607,421,1816,448"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1614,305,1809,346"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1867,312,2033,339"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1646,877,1777,904"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1642,932,1781,959"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1613,983,1810,1009"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1634,1034,1789,1075"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="2084,93,2301,120"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="2099,624,2286,651"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1363,219,1547,245"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1378,148,1533,175"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_acf7d062eca8e6190d76f4934c290be61_icgraph.png" border="0" usemap="#atdp__mmu_8c_acf7d062eca8e6190d76f4934c290be61_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_acf7d062eca8e6190d76f4934c290be61_icgraph" id="atdp__mmu_8c_acf7d062eca8e6190d76f4934c290be61_icgraph">
<area shape="rect" title=" " alt="" coords="3531,236,3728,263"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="3325,207,3481,233"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="3324,258,3483,299"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="3096,258,3276,299"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2861,225,3044,266"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2857,290,3048,331"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2637,225,2803,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2377,225,2583,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2111,232,2329,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1914,232,2057,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2631,290,2809,331"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2402,297,2558,324"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2140,297,2300,324"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1908,290,2063,331"/>
</map>
</div>

</div>
</div>
<a id="afa070d8c089f8547cfc2dbafa856e99c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa070d8c089f8547cfc2dbafa856e99c">&#9670;&nbsp;</a></span>tdp_mmu_split_huge_pages_root()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tdp_mmu_split_huge_pages_root </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01414">1414</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;{</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp = NULL;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160; </div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">     * Traverse the page table splitting all huge pages above the target</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">     * level into one lower level. For example, if we encounter a 1GB page</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">     * we split it into 512 2MB pages.</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment">     * Since the TDP iterator uses a pre-order traversal, we are guaranteed</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment">     * to visit an SPTE before ever visiting its children, which means we</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment">     * will correctly recursively split huge pages that are more than one</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment">     * level above the target level (e.g. splitting a 1GB to 512 2MB pages,</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment">     * and then splitting each of those to 512 4KB pages).</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <a class="code" href="tdp__iter_8h.html#ae338deba99081393a1e19cdfa6640f48">for_each_tdp_pte_min_level</a>(iter, root, target_level + 1, start, end) {</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;retry:</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2">tdp_mmu_iter_cond_resched</a>(kvm, &amp;iter, <span class="keyword">false</span>, shared))</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160; </div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter.old_spte) || !<a class="code" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729">is_large_pte</a>(iter.old_spte))</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160; </div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <span class="keywordflow">if</span> (!sp) {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            sp = <a class="code" href="tdp__mmu_8c.html#aa61edf11261db080cdd6b2bba981310f">tdp_mmu_alloc_sp_for_split</a>(kvm, &amp;iter, shared);</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;            <span class="keywordflow">if</span> (!sp) {</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                ret = -ENOMEM;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                trace_kvm_mmu_split_huge_page(iter.gfn,</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                                  iter.old_spte,</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                                  iter.level, ret);</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;            }</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160; </div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;            <span class="keywordflow">if</span> (iter.yielded)</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        }</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160; </div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <a class="code" href="tdp__mmu_8c.html#a502cd8b971218c38ecd999409fc15ee3">tdp_mmu_init_child_sp</a>(sp, &amp;iter);</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160; </div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61">tdp_mmu_split_huge_page</a>(kvm, &amp;iter, sp, shared))</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;            <span class="keywordflow">goto</span> retry;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160; </div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        sp = NULL;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    }</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160; </div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160; </div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">     * It&#39;s possible to exit the loop having never used the last sp if, for</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="comment">     * example, a vCPU doing HugePage NX splitting wins the race and</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment">     * installs its own sp in place of the last sp we tried to split.</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="keywordflow">if</span> (sp)</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <a class="code" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b">tdp_mmu_free_sp</a>(sp);</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160; </div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_aa61edf11261db080cdd6b2bba981310f"><div class="ttname"><a href="tdp__mmu_8c.html#aa61edf11261db080cdd6b2bba981310f">tdp_mmu_alloc_sp_for_split</a></div><div class="ttdeci">static struct kvm_mmu_page * tdp_mmu_alloc_sp_for_split(struct kvm *kvm, struct tdp_iter *iter, bool shared)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l01334">tdp_mmu.c:1334</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_afa070d8c089f8547cfc2dbafa856e99c_cgraph.png" border="0" usemap="#atdp__mmu_8c_afa070d8c089f8547cfc2dbafa856e99c_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_afa070d8c089f8547cfc2dbafa856e99c_cgraph" id="atdp__mmu_8c_afa070d8c089f8547cfc2dbafa856e99c_cgraph">
<area shape="rect" title=" " alt="" coords="5,1124,164,1165"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1938,94,2039,121"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2103,482,2277,509"/>
<area shape="rect" href="tdp__mmu_8c.html#aa61edf11261db080cdd6b2bba981310f" title=" " alt="" coords="232,1199,401,1240"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="247,1265,386,1291"/>
<area shape="rect" href="tdp__mmu_8c.html#a502cd8b971218c38ecd999409fc15ee3" title=" " alt="" coords="231,1131,403,1158"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="212,1347,421,1374"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="218,454,415,481"/>
<area shape="rect" href="tdp__mmu_8c.html#aef3c64f4319d3be908d23467dd8fb337" title=" " alt="" coords="477,1225,636,1267"/>
<area shape="rect" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48" title=" " alt="" coords="479,1291,635,1332"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1727,1170,1827,1197"/>
<area shape="rect" href="tdp__mmu_8c.html#a8d6f094dd9ef458c1c57aee653afd602" title=" " alt="" coords="489,1123,624,1150"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1923,1170,2054,1197"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="469,1357,644,1383"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="692,1357,903,1383"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="951,1349,1161,1391"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1223,1331,1389,1358"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1212,1382,1400,1409"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1502,1331,1581,1358"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1453,1433,1629,1459"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1465,1382,1618,1409"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1451,246,1632,273"/>
<area shape="rect" href="spte_8c.html#adc3a08f029fff6aaf2bf687edf69410f" title=" " alt="" coords="953,334,1159,361"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="488,766,625,793"/>
<area shape="rect" href="mmu__internal_8h.html#a8a367cbfff40c5c72d6f19049da9fc51" title=" " alt="" coords="1209,334,1403,361"/>
<area shape="rect" href="spte_8c.html#ac0162f8b29f82f308036271f93880cd7" title=" " alt="" coords="1221,225,1391,251"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1698,297,1857,323"/>
<area shape="rect" href="spte_8c.html#a8885614ad1f7e35c498eb228826d1909" title=" " alt="" coords="1458,348,1625,389"/>
<area shape="rect" href="spte_8h.html#abc2b9043d48550e741fda1e2ad36a652" title=" " alt="" coords="1455,145,1627,171"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1923,347,2055,374"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1700,449,1855,491"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1928,457,2049,483"/>
<area shape="rect" href="spte_8h.html#ac3f82ba169af94a026b5df40f3d3753e" title=" " alt="" coords="731,690,864,717"/>
<area shape="rect" href="spte_8c.html#a98038e4116bcdef6f9e1e335eefc29c9" title=" " alt="" coords="723,741,872,767"/>
<area shape="rect" href="tdp__mmu_8c.html#a5217224e4957f6457786d51ddd62914b" title=" " alt="" coords="707,791,888,818"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="710,893,885,919"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="957,842,1155,869"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="983,935,1129,962"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1225,743,1387,770"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1711,974,1844,1001"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1680,1094,1875,1121"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1466,1073,1617,1099"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1474,297,1609,323"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1489,769,1594,795"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1728,515,1827,542"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1485,819,1598,846"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1455,870,1628,897"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1470,718,1613,745"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1477,566,1605,593"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1728,617,1827,643"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_afa070d8c089f8547cfc2dbafa856e99c_icgraph.png" border="0" usemap="#atdp__mmu_8c_afa070d8c089f8547cfc2dbafa856e99c_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_afa070d8c089f8547cfc2dbafa856e99c_icgraph" id="atdp__mmu_8c_afa070d8c089f8547cfc2dbafa856e99c_icgraph">
<area shape="rect" title=" " alt="" coords="3324,258,3483,299"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="3096,258,3276,299"/>
<area shape="rect" href="mmu_8c.html#a073d9b7de8eaf977452c1eb7395a78d6" title=" " alt="" coords="2861,225,3044,266"/>
<area shape="rect" href="mmu_8c.html#a6abdd1728810c3f3ab8c2e1e6d2d37f0" title=" " alt="" coords="2857,290,3048,331"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2637,225,2803,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2377,225,2583,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2111,232,2329,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1914,232,2057,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2631,290,2809,331"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2402,297,2558,324"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="2140,297,2300,324"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1908,290,2063,331"/>
</map>
</div>

</div>
</div>
<a id="a401c07c0503d3fc2c62b9a8a06096686"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a401c07c0503d3fc2c62b9a8a06096686">&#9670;&nbsp;</a></span>tdp_mmu_unlink_sp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tdp_mmu_unlink_sp </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>sp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686">tdp_mmu_unlink_sp()</a> - Remove a shadow page from the list of used pages</p>
<p>@kvm: kvm instance @sp: the page to be removed </p>

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00279">279</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;{</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3">tdp_unaccount_mmu_page</a>(kvm, sp);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (!sp-&gt;<a class="code" href="structkvm__mmu__page.html#a48fdf70976937b2e4cc3e8265ffa5676">nx_huge_page_disallowed</a>)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    spin_lock(&amp;kvm-&gt;arch.tdp_mmu_pages_lock);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    sp-&gt;<a class="code" href="structkvm__mmu__page.html#a48fdf70976937b2e4cc3e8265ffa5676">nx_huge_page_disallowed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a">untrack_possible_nx_huge_page</a>(kvm, sp);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    spin_unlock(&amp;kvm-&gt;arch.tdp_mmu_pages_lock);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a2fba0b2dd67723bfbc4349ea7c8e019a"><div class="ttname"><a href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a">untrack_possible_nx_huge_page</a></div><div class="ttdeci">void untrack_possible_nx_huge_page(struct kvm *kvm, struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00891">mmu.c:891</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_a0003da5596a964166d5e46389e7cf4b3"><div class="ttname"><a href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3">tdp_unaccount_mmu_page</a></div><div class="ttdeci">static void tdp_unaccount_mmu_page(struct kvm *kvm, struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00267">tdp_mmu.c:267</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a401c07c0503d3fc2c62b9a8a06096686_cgraph.png" border="0" usemap="#atdp__mmu_8c_a401c07c0503d3fc2c62b9a8a06096686_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a401c07c0503d3fc2c62b9a8a06096686_cgraph" id="atdp__mmu_8c_a401c07c0503d3fc2c62b9a8a06096686_cgraph">
<area shape="rect" title=" " alt="" coords="5,35,159,61"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="207,5,404,32"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="228,57,383,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a401c07c0503d3fc2c62b9a8a06096686_icgraph.png" border="0" usemap="#atdp__mmu_8c_a401c07c0503d3fc2c62b9a8a06096686_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a401c07c0503d3fc2c62b9a8a06096686_icgraph" id="atdp__mmu_8c_a401c07c0503d3fc2c62b9a8a06096686_icgraph">
<area shape="rect" title=" " alt="" coords="2141,353,2295,379"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1943,353,2093,379"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1732,353,1895,379"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="1537,241,1684,267"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="1291,473,1489,499"/>
<area shape="rect" href="tdp__mmu_8c.html#a381e22ee819864cf1fd726479a76b6c7" title=" " alt="" coords="1304,105,1476,131"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="1303,241,1477,267"/>
<area shape="rect" href="mmu_8c.html#a85202c8f53b11b1c80f9b6e26210aa9a" title=" " alt="" coords="1057,11,1227,52"/>
<area shape="rect" href="mmu_8c.html#a2683113dbbf42e73c2b52410f9ef6f84" title=" " alt="" coords="765,5,981,47"/>
<area shape="rect" href="mmu_8c.html#a13148d5065ef27624701afcaa3229983" title=" " alt="" coords="497,11,680,38"/>
<area shape="rect" href="x86_8c.html#a91673b399129921871f11d0752eea8c3" title=" " alt="" coords="234,10,411,37"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="1061,303,1223,330"/>
<area shape="rect" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c" title=" " alt="" coords="1089,157,1195,183"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="1073,393,1211,419"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="1065,241,1219,267"/>
<area shape="rect" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580" title=" " alt="" coords="1074,87,1210,114"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="799,303,946,330"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="502,287,675,314"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="473,339,704,380"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="250,295,395,322"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="220,397,425,423"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="234,346,411,373"/>
<area shape="rect" href="tdp__mmu_8c.html#aa53a75612d7b32153949be34f4055144" title=" " alt="" coords="767,129,978,155"/>
<area shape="rect" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d" title=" " alt="" coords="518,130,659,157"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="511,470,667,497"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="774,371,971,398"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="509,404,668,445"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="233,448,413,489"/>
<area shape="rect" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501" title=" " alt="" coords="773,180,973,221"/>
<area shape="rect" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8" title=" " alt="" coords="778,246,967,273"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="501,185,676,211"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="512,235,665,262"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="247,229,398,271"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="224,61,421,103"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="253,127,393,154"/>
<area shape="rect" href="mtrr_8c.html#aca604775fbcfad49bfaf9441fc2253dc" title=" " alt="" coords="271,178,374,205"/>
<area shape="rect" href="tdp__mmu_8c.html#a45fd618d35fb0df14a3401a230f41faa" title=" " alt="" coords="752,74,993,101"/>
<area shape="rect" href="mmu_8c.html#a1f49638b71a482e4b0c3a6af10d0711e" title=" " alt="" coords="493,64,684,105"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="1061,639,1223,666"/>
<area shape="rect" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427" title=" " alt="" coords="1057,465,1227,507"/>
<area shape="rect" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d" title=" " alt="" coords="1041,531,1243,558"/>
<area shape="rect" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37" title=" " alt="" coords="1074,587,1210,614"/>
<area shape="rect" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c" title=" " alt="" coords="759,647,986,674"/>
<area shape="rect" href="mmu_8c.html#acb92068f6e948846797ac6814b3618f1" title=" " alt="" coords="225,645,420,687"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="5,587,172,628"/>
<area shape="rect" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf" title=" " alt="" coords="794,524,951,565"/>
<area shape="rect" href="tdp__mmu_8c.html#a3a86994ba17144f60df37ea7682d650b" title=" " alt="" coords="475,521,702,563"/>
<area shape="rect" href="mmu_8c.html#a35da5538a61de05522efdad8f615df4f" title=" " alt="" coords="223,524,422,565"/>
<area shape="rect" href="tdp__mmu_8c.html#a7f6c658f3ddf3ffac5ce96335b78e295" title=" " alt="" coords="773,593,973,619"/>
<area shape="rect" href="mmu_8c.html#a168b7814e68a545abd8bf00fc4466610" title=" " alt="" coords="499,587,679,628"/>
</map>
</div>

</div>
</div>
<a id="a182ff449fd87f9503148e88c33cff5ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a182ff449fd87f9503148e88c33cff5ac">&#9670;&nbsp;</a></span>tdp_mmu_zap_leafs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool tdp_mmu_zap_leafs </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>can_yield</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>flush</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00780">780</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;{</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    end = min(end, <a class="code" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476">tdp_mmu_max_gfn_exclusive</a>());</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <a class="code" href="tdp__iter_8h.html#ae338deba99081393a1e19cdfa6640f48">for_each_tdp_pte_min_level</a>(iter, root, PG_LEVEL_4K, start, end) {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">if</span> (can_yield &amp;&amp;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <a class="code" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2">tdp_mmu_iter_cond_resched</a>(kvm, &amp;iter, flush, <span class="keyword">false</span>)) {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            flush = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter.old_spte) ||</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            !<a class="code" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a>(iter.old_spte, iter.level))</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <a class="code" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d">tdp_mmu_iter_set_spte</a>(kvm, &amp;iter, 0);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        flush = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">     * Because this flow zaps _only_ leaf SPTEs, the caller doesn&#39;t need</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment">     * to provide RCU protection as no &#39;struct kvm_mmu_page&#39; will be freed.</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">return</span> flush;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a182ff449fd87f9503148e88c33cff5ac_cgraph.png" border="0" usemap="#atdp__mmu_8c_a182ff449fd87f9503148e88c33cff5ac_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a182ff449fd87f9503148e88c33cff5ac_cgraph" id="atdp__mmu_8c_a182ff449fd87f9503148e88c33cff5ac_cgraph">
<area shape="rect" title=" " alt="" coords="5,657,159,684"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1758,1164,1857,1191"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1720,483,1895,509"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="211,145,420,172"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="228,657,403,684"/>
<area shape="rect" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476" title=" " alt="" coords="207,1291,424,1317"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1971,1164,2073,1191"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="472,139,647,165"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="695,113,905,140"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="953,99,1164,141"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1226,107,1393,133"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1215,56,1403,83"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1524,107,1603,133"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1475,56,1651,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1487,5,1640,32"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="486,657,633,684"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="719,657,881,684"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1243,461,1376,488"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1212,883,1407,909"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1730,283,1885,325"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="983,657,1134,684"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1242,984,1377,1011"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1006,461,1111,488"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1002,759,1115,785"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="972,309,1145,336"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="987,360,1130,387"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="968,931,1149,957"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="995,1085,1123,1112"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1260,1189,1359,1216"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1961,939,2083,965"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1223,781,1395,808"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1214,613,1405,640"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1466,803,1661,845"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1259,563,1359,589"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1226,665,1393,706"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1233,731,1386,757"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1481,752,1646,779"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1459,1037,1668,1064"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1466,971,1661,1013"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1724,979,1891,1005"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1943,1019,2101,1045"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1498,533,1629,560"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1494,584,1633,611"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1465,701,1662,728"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1486,635,1641,677"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1455,920,1672,947"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1470,360,1657,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1217,259,1401,285"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1232,309,1387,336"/>
<area shape="rect" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778" title=" " alt="" coords="481,1291,637,1317"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a182ff449fd87f9503148e88c33cff5ac_icgraph.png" border="0" usemap="#atdp__mmu_8c_a182ff449fd87f9503148e88c33cff5ac_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a182ff449fd87f9503148e88c33cff5ac_icgraph" id="atdp__mmu_8c_a182ff449fd87f9503148e88c33cff5ac_icgraph">
<area shape="rect" title=" " alt="" coords="2345,249,2499,275"/>
<area shape="rect" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501" title=" " alt="" coords="2097,212,2297,253"/>
<area shape="rect" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8" title=" " alt="" coords="2103,278,2292,305"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="1875,219,2049,246"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="1885,278,2039,305"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="1653,100,1803,141"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="1629,243,1827,284"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="1658,313,1798,339"/>
<area shape="rect" href="mtrr_8c.html#aca604775fbcfad49bfaf9441fc2253dc" title=" " alt="" coords="1677,465,1779,491"/>
<area shape="rect" href="x86_8c.html#ae1ffb1252c0aa966c6d94279766427ca" title=" " alt="" coords="1353,5,1543,47"/>
<area shape="rect" href="x86_8c.html#a613f1a822aa2ffa29a32341ec8a92913" title=" " alt="" coords="1359,71,1537,112"/>
<area shape="rect" href="hyperv_8c.html#a9eaaad1dfbff166c751e725c9fcf73b6" title=" " alt="" coords="1370,137,1526,163"/>
<area shape="rect" href="x86_8c.html#ae3d9929c9a77fa2c710befa0a784d4c6" title=" " alt="" coords="1083,5,1242,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="865,13,989,39"/>
<area shape="rect" href="hyperv_8c.html#addb1696255847fad41e6cbadd2e31f57" title=" " alt="" coords="1105,103,1220,130"/>
<area shape="rect" href="hyperv_8c.html#a98568f4f9b61af590e833d5f4a127c68" title=" " alt="" coords="870,67,985,94"/>
<area shape="rect" href="hyperv_8c.html#adbfbc91bbdd19f529b4489eb1d8e1ec7" title=" " alt="" coords="647,74,781,101"/>
<area shape="rect" href="hyperv_8c.html#ab6a097fa5ccc00cb31061629a4e3e2f7" title=" " alt="" coords="387,99,584,126"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="164,339,339,366"/>
<area shape="rect" href="svm_8c.html#acb46126747f78036462437a7bcdc2e47" title=" " alt="" coords="20,289,101,315"/>
<area shape="rect" href="svm_8c.html#aac18b9094154a2c8b8e27c3b08c9e359" title=" " alt="" coords="6,339,115,366"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="5,390,116,417"/>
<area shape="rect" href="x86_8c.html#a541cd35068f221456141f8798a1ab7c9" title=" " alt="" coords="1315,191,1581,218"/>
<area shape="rect" href="x86_8c.html#aab788793558a6c5c0cdc2e3ec840ebf6" title=" " alt="" coords="1369,243,1527,284"/>
<area shape="rect" href="vfio_8c.html#a0f8a9bc6a328c121266b7bedf8ccbe28" title=" " alt="" coords="1059,191,1267,218"/>
<area shape="rect" href="vfio_8c.html#a72ebd436cdee24ef38504201f2d8552c" title=" " alt="" coords="857,118,997,145"/>
<area shape="rect" href="vfio_8c.html#a69f95fca834d8d52cbb826dec545bbb9" title=" " alt="" coords="859,169,995,195"/>
<area shape="rect" href="vfio_8c.html#a0f0458c9f09300055baa0c892a2fbc29" title=" " alt="" coords="859,219,996,246"/>
<area shape="rect" href="vfio_8c.html#a8ad4a98a112c210e854931feaef8bd63" title=" " alt="" coords="646,162,782,189"/>
<area shape="rect" href="vfio_8c.html#a6e1f4ba2cd918c03e22262aa0019af12" title=" " alt="" coords="416,162,555,189"/>
<area shape="rect" href="svm_8c.html#af4590239d3e0b5fbad189a245207dfaa" title=" " alt="" coords="1415,313,1481,339"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="1395,371,1501,398"/>
<area shape="rect" href="svm_8c.html#ad1887c4bb9c78c577fb20a129d73ea41" title=" " alt="" coords="1103,270,1222,297"/>
<area shape="rect" href="smm_8c.html#a0943012ff008c7999f582998f0f9167a" title=" " alt="" coords="632,434,796,461"/>
<area shape="rect" href="x86_8c.html#a86812e4228865668099921709e1c2f26" title=" " alt="" coords="1099,371,1226,398"/>
<area shape="rect" href="vmx_8c.html#ac02e59b539f5874eaeb4b12568e9d0dd" title=" " alt="" coords="1103,422,1223,449"/>
<area shape="rect" href="x86_8c.html#abe99237e5fd6f33407bc30aa2647e0db" title=" " alt="" coords="1116,473,1209,499"/>
<area shape="rect" href="smm_8c.html#a0c50da2c4874eda6d67766974a476019" title=" " alt="" coords="1062,523,1263,550"/>
<area shape="rect" href="svm_8c.html#af2ee2a03530f5b7a02a127d8b779d2ae" title=" " alt="" coords="844,270,1011,297"/>
<area shape="rect" href="vmx_8c.html#aa55ace9429e6e94042e6602716222805" title=" " alt="" coords="885,434,970,461"/>
<area shape="rect" href="smm_8c.html#ae0136cd1aa193ad29565961ea839a99a" title=" " alt="" coords="855,510,1000,537"/>
<area shape="rect" href="mtrr_8c.html#a2b95f238c68e317e64e57d06f2a698dd" title=" " alt="" coords="413,390,558,417"/>
</map>
</div>

</div>
</div>
<a id="a95955e5f31399228d6a722fba5a81477"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95955e5f31399228d6a722fba5a81477">&#9670;&nbsp;</a></span>tdp_mmu_zap_root()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tdp_mmu_zap_root </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00716">716</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;{</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">     * The root must have an elevated refcount so that it&#39;s reachable via</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">     * mmu_notifier callbacks, which allows this path to yield and drop</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">     * mmu_lock.  When handling an unmap/release mmu_notifier command, KVM</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">     * must drop all references to relevant pages prior to completing the</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">     * callback.  Dropping mmu_lock with an unreachable root would result</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">     * in zapping SPTEs after a relevant mmu_notifier callback completes</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">     * and lead to use-after-free as zapping a SPTE triggers &quot;writeback&quot; of</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">     * dirty accessed bits to the SPTE&#39;s associated struct page.</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    WARN_ON_ONCE(!refcount_read(&amp;root-&gt;<a class="code" href="structkvm__mmu__page.html#a41397fd72948cc7002b169d2fb3aba5f">tdp_mmu_root_count</a>));</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <a class="code" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48">kvm_lockdep_assert_mmu_lock_held</a>(kvm, shared);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">     * To avoid RCU stalls due to recursively removing huge swaths of SPs,</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">     * split the zap into two passes.  On the first pass, zap at the 1gb</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">     * level, and then zap top-level SPs on the second pass.  &quot;1gb&quot; is not</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">     * arbitrary, as KVM must be able to zap a 1gb shadow page without</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">     * inducing a stall to allow in-place replacement with a 1gb hugepage.</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">     * Because zapping a SP recurses on its children, stepping down to</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">     * PG_LEVEL_4K in the iterator itself is unnecessary.</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <a class="code" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb">__tdp_mmu_zap_root</a>(kvm, root, shared, PG_LEVEL_1G);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <a class="code" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb">__tdp_mmu_zap_root</a>(kvm, root, shared, root-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.level);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160; </div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;}</div>
<div class="ttc" id="atdp__mmu_8c_html_af9c34fae0b7eac63cc78a01882498cfb"><div class="ttname"><a href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb">__tdp_mmu_zap_root</a></div><div class="ttdeci">static void __tdp_mmu_zap_root(struct kvm *kvm, struct kvm_mmu_page *root, bool shared, int zap_level)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00690">tdp_mmu.c:690</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a95955e5f31399228d6a722fba5a81477_cgraph.png" border="0" usemap="#atdp__mmu_8c_a95955e5f31399228d6a722fba5a81477_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a95955e5f31399228d6a722fba5a81477_cgraph" id="atdp__mmu_8c_a95955e5f31399228d6a722fba5a81477_cgraph">
<area shape="rect" title=" " alt="" coords="5,444,152,471"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="200,415,361,441"/>
<area shape="rect" href="tdp__mmu_8c.html#a94f5586dfab1d77897564b4b4979da48" title=" " alt="" coords="203,466,359,507"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1947,775,2121,801"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="413,59,623,85"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="431,516,605,543"/>
<area shape="rect" href="tdp__mmu_8c.html#ac323268ae26fde5a608d694f4943d476" title=" " alt="" coords="409,465,627,492"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="675,415,873,441"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="687,57,861,84"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="921,56,1132,83"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1180,47,1391,89"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1453,5,1619,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1442,56,1630,83"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="701,567,847,593"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="945,592,1108,619"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1469,415,1603,441"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1439,941,1633,968"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1957,125,2111,166"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1210,617,1361,644"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1985,263,2083,289"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1469,992,1603,1019"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1233,668,1338,695"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="1229,719,1342,745"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="1199,988,1372,1015"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="1214,1039,1357,1065"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="1195,516,1376,543"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="1221,313,1349,340"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1487,364,1585,391"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="2188,961,2309,988"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1450,617,1622,644"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1441,668,1631,695"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1693,877,1887,918"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1486,567,1586,593"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1453,719,1619,761"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1459,516,1613,543"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1707,673,1873,700"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1685,943,1895,969"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1693,994,1887,1035"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1951,1001,2117,1028"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="2198,263,2299,289"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="2169,1041,2328,1068"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1725,623,1855,649"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1721,724,1859,751"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1691,505,1889,532"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1713,557,1867,598"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1681,1060,1899,1087"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1697,775,1883,801"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1444,1043,1628,1069"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1459,1093,1613,1120"/>
<area shape="rect" href="mmu_8h.html#a6555cf2d510d04ae19bee154d166f778" title=" " alt="" coords="696,465,852,492"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a95955e5f31399228d6a722fba5a81477_icgraph.png" border="0" usemap="#atdp__mmu_8c_a95955e5f31399228d6a722fba5a81477_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a95955e5f31399228d6a722fba5a81477_icgraph" id="atdp__mmu_8c_a95955e5f31399228d6a722fba5a81477_icgraph">
<area shape="rect" title=" " alt="" coords="3703,251,3849,277"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="3453,221,3626,248"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="3424,273,3655,314"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="3215,221,3360,248"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="2947,221,3151,248"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="1713,221,1883,248"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="740,221,875,248"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="553,215,668,241"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="325,107,475,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="317,157,483,184"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="303,427,497,453"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="323,208,477,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="295,259,505,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="314,310,486,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="333,376,467,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="329,5,471,32"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="335,56,465,83"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="47,107,205,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="5,5,247,32"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="59,56,193,83"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="2687,276,2892,303"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="3199,360,3376,387"/>
<area shape="rect" href="mmu_8c.html#a0beae9a256ad42642a6b522a36a18a74" title=" " alt="" coords="1234,272,1398,299"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="973,389,1143,416"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="987,272,1129,299"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="744,389,871,416"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="2436,323,2617,365"/>
<area shape="rect" href="mmu_8c.html#ad4293ab926b1ab16fb8b380a76b9f533" title=" " alt="" coords="2967,382,3131,423"/>
<area shape="rect" href="mmu_8c.html#a5a613414a3787274a50cc9f9e9bab180" title=" " alt="" coords="2973,448,3124,475"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="2185,331,2373,357"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1727,453,1869,480"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1463,453,1665,480"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1217,483,1415,509"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1222,381,1410,408"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="965,440,1151,467"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="951,491,1165,517"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="947,592,1169,619"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="988,541,1128,568"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="739,440,876,467"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="720,491,895,517"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="553,491,668,517"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="716,592,899,619"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="957,323,1159,365"/>
<area shape="rect" href="x86_8c.html#ae7e25dec8e0af366fb3db41dc9881970" title=" " alt="" coords="2680,389,2899,416"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="2421,389,2632,416"/>
<area shape="rect" href="kvm__main_8c.html#a52d56a5dc447602839375289b5bbffb2" title=" " alt="" coords="2191,453,2367,480"/>
<area shape="rect" href="kvm__main_8c.html#a8c9bd99a64bbedb0930e29ed4dcc7897" title=" " alt="" coords="1952,529,2116,556"/>
<area shape="rect" href="kvm__main_8c.html#ac4ce014a99262ed5672a102c6d2ffdbd" title=" " alt="" coords="1952,580,2116,607"/>
<area shape="rect" href="kvm__main_8c.html#afdb5cea8958921b2ea9bd3a29cf9d7a6" title=" " alt="" coords="1954,377,2114,404"/>
<area shape="rect" href="kvm__main_8c.html#a192569033b972982f6b53e13666ef82b" title=" " alt="" coords="1931,428,2137,455"/>
</map>
</div>

</div>
</div>
<a id="ab901a77cd00a4e809baa9a25e289b59d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab901a77cd00a4e809baa9a25e289b59d">&#9670;&nbsp;</a></span>tdp_mmu_zap_spte_atomic()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int tdp_mmu_zap_spte_atomic </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00549">549</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;{</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">     * Freeze the SPTE by setting it to a special,</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">     * non-present value. This will stop other threads from</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">     * immediately installing a present entry in its place</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">     * before the TLBs are flushed.</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    ret = <a class="code" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6">tdp_mmu_set_spte_atomic</a>(kvm, iter, <a class="code" href="spte_8h.html#a9e3b5ea0bcca48866f5fb2e94ae03826">REMOVED_SPTE</a>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <a class="code" href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e">kvm_flush_remote_tlbs_gfn</a>(kvm, iter-&gt;<a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>, iter-&gt;<a class="code" href="structtdp__iter.html#ac6b854683bce752c9e0fe0b068a288b2">level</a>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">     * No other thread can overwrite the removed SPTE as they must either</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">     * wait on the MMU lock or use tdp_mmu_set_spte_atomic() which will not</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">     * overwrite the special removed SPTE value. No bookkeeping is needed</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">     * here since the SPTE is going from non-present to non-present.  Use</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">     * the raw write helper to avoid an unnecessary check on volatile bits.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770">__kvm_tdp_mmu_write_spte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#a869c59866a73015fdc7bb34b2ce8ed1b">sptep</a>, 0);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;}</div>
<div class="ttc" id="atdp__iter_8h_html_acce3a5afd04a68fc666c32e91d8c1770"><div class="ttname"><a href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770">__kvm_tdp_mmu_write_spte</a></div><div class="ttdeci">static void __kvm_tdp_mmu_write_spte(tdp_ptep_t sptep, u64 new_spte)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00027">tdp_iter.h:27</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ab901a77cd00a4e809baa9a25e289b59d_cgraph.png" border="0" usemap="#atdp__mmu_8c_ab901a77cd00a4e809baa9a25e289b59d_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_ab901a77cd00a4e809baa9a25e289b59d_cgraph" id="atdp__mmu_8c_ab901a77cd00a4e809baa9a25e289b59d_cgraph">
<area shape="rect" title=" " alt="" coords="5,942,207,969"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1217,871,1426,898"/>
<area shape="rect" href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e" title=" " alt="" coords="255,993,457,1019"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="257,571,455,598"/>
<area shape="rect" href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5" title=" " alt="" coords="517,993,668,1019"/>
<area shape="rect" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f" title=" " alt="" coords="505,1044,680,1085"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="731,1051,906,1078"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="957,1051,1168,1078"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1216,1044,1427,1085"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1485,1047,1652,1074"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1475,1098,1663,1125"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1780,1047,1859,1074"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1731,1098,1907,1125"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="511,369,674,395"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="996,470,1129,497"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1491,976,1646,1017"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="743,638,894,665"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2156,369,2331,395"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1519,419,1618,446"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1501,369,1636,395"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="766,217,871,243"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="762,115,875,142"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="732,318,905,345"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="747,267,890,294"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="728,521,909,547"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="755,65,883,91"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1013,14,1112,41"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1759,978,1880,1005"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="977,638,1149,665"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="967,689,1158,715"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="965,841,1160,867"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1224,740,1419,781"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1013,739,1113,766"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="979,521,1146,563"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="986,587,1139,614"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1239,638,1404,665"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1224,805,1419,847"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1485,611,1652,638"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1769,419,1870,446"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1740,470,1899,497"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1976,419,2108,446"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1256,689,1387,715"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1252,470,1391,497"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1223,587,1420,614"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1244,521,1399,563"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1711,369,1928,395"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1726,318,1913,345"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="971,318,1155,345"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1228,293,1415,319"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="985,267,1140,294"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ab901a77cd00a4e809baa9a25e289b59d_icgraph.png" border="0" usemap="#atdp__mmu_8c_ab901a77cd00a4e809baa9a25e289b59d_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ab901a77cd00a4e809baa9a25e289b59d_icgraph" id="atdp__mmu_8c_ab901a77cd00a4e809baa9a25e289b59d_icgraph">
<area shape="rect" title=" " alt="" coords="3560,232,3761,259"/>
<area shape="rect" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf" title=" " alt="" coords="3355,225,3512,266"/>
<area shape="rect" href="tdp__mmu_8c.html#a3a86994ba17144f60df37ea7682d650b" title=" " alt="" coords="3080,225,3307,266"/>
<area shape="rect" href="mmu_8c.html#a35da5538a61de05522efdad8f615df4f" title=" " alt="" coords="2833,225,3032,266"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2619,225,2785,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2365,225,2571,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2099,232,2317,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1908,232,2051,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
</map>
</div>

</div>
</div>
<a id="a0003da5596a964166d5e46389e7cf4b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0003da5596a964166d5e46389e7cf4b3">&#9670;&nbsp;</a></span>tdp_unaccount_mmu_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tdp_unaccount_mmu_page </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>sp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l00267">267</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;{</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    kvm_account_pgtable_pages((<span class="keywordtype">void</span> *)sp-&gt;<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a>, -1);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    atomic64_dec(&amp;kvm-&gt;arch.tdp_mmu_pages);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a0003da5596a964166d5e46389e7cf4b3_icgraph.png" border="0" usemap="#atdp__mmu_8c_a0003da5596a964166d5e46389e7cf4b3_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a0003da5596a964166d5e46389e7cf4b3_icgraph" id="atdp__mmu_8c_a0003da5596a964166d5e46389e7cf4b3_icgraph">
<area shape="rect" title=" " alt="" coords="2343,346,2540,373"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="2141,346,2295,373"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="1943,346,2093,373"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="1732,346,1895,373"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="1537,242,1684,269"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="1291,455,1489,482"/>
<area shape="rect" href="tdp__mmu_8c.html#a381e22ee819864cf1fd726479a76b6c7" title=" " alt="" coords="1304,106,1476,133"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="1303,242,1477,269"/>
<area shape="rect" href="mmu_8c.html#a85202c8f53b11b1c80f9b6e26210aa9a" title=" " alt="" coords="1057,13,1227,55"/>
<area shape="rect" href="mmu_8c.html#a2683113dbbf42e73c2b52410f9ef6f84" title=" " alt="" coords="765,5,981,47"/>
<area shape="rect" href="mmu_8c.html#a13148d5065ef27624701afcaa3229983" title=" " alt="" coords="497,11,680,38"/>
<area shape="rect" href="x86_8c.html#a91673b399129921871f11d0752eea8c3" title=" " alt="" coords="234,11,411,38"/>
<area shape="rect" href="tdp__mmu_8c.html#af9c34fae0b7eac63cc78a01882498cfb" title=" " alt="" coords="1061,299,1223,326"/>
<area shape="rect" href="tdp__mmu_8c.html#a01bf8752c61ddeae2878ef46d312e00c" title=" " alt="" coords="1089,158,1195,185"/>
<area shape="rect" href="tdp__mmu_8c.html#a6588b054500f580603f94c0555fe3c06" title=" " alt="" coords="1073,379,1211,406"/>
<area shape="rect" href="tdp__mmu_8c.html#a182ff449fd87f9503148e88c33cff5ac" title=" " alt="" coords="1065,242,1219,269"/>
<area shape="rect" href="tdp__mmu_8c.html#aa07f9d272e2404a5b5392ae7aa175580" title=" " alt="" coords="1074,89,1210,115"/>
<area shape="rect" href="tdp__mmu_8c.html#a95955e5f31399228d6a722fba5a81477" title=" " alt="" coords="799,299,946,326"/>
<area shape="rect" href="tdp__mmu_8c.html#aca0f6025bf55596c80647e3a35997d92" title=" " alt="" coords="502,281,675,307"/>
<area shape="rect" href="tdp__mmu_8c.html#a8ab26f4fb05f388d8bcf04ad89ee6797" title=" " alt="" coords="473,332,704,373"/>
<area shape="rect" href="mmu_8c.html#a6db2d9d04af40584cbde51a2e1f74837" title=" " alt="" coords="250,281,395,307"/>
<area shape="rect" href="tdp__mmu_8c.html#a73432bf42fbb3d43b3e04f88cd92b592" title=" " alt="" coords="220,331,425,358"/>
<area shape="rect" href="mmu_8c.html#abd59fd9785b9b5676841e9706c1c6797" title=" " alt="" coords="234,382,411,409"/>
<area shape="rect" href="tdp__mmu_8c.html#aa53a75612d7b32153949be34f4055144" title=" " alt="" coords="767,127,978,154"/>
<area shape="rect" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d" title=" " alt="" coords="518,129,659,155"/>
<area shape="rect" href="tdp__mmu_8c.html#ad2479228afe629631e4f0331c440a4d6" title=" " alt="" coords="511,463,667,490"/>
<area shape="rect" href="tdp__mmu_8c.html#acf7d062eca8e6190d76f4934c290be61" title=" " alt="" coords="774,362,971,389"/>
<area shape="rect" href="tdp__mmu_8c.html#afa070d8c089f8547cfc2dbafa856e99c" title=" " alt="" coords="509,397,668,439"/>
<area shape="rect" href="tdp__mmu_8c.html#a57310f6ad7e70c13dadcfd30aa71af6d" title=" " alt="" coords="233,433,413,475"/>
<area shape="rect" href="tdp__mmu_8c.html#aaa8f0898db08dd5c9213ac2f8b355501" title=" " alt="" coords="773,179,973,220"/>
<area shape="rect" href="tdp__mmu_8c.html#aa4fb1a66a2bc67f8699e8ddafdd4b1e8" title=" " alt="" coords="778,245,967,271"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="501,179,676,206"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="512,230,665,257"/>
<area shape="rect" href="x86_8c.html#ac280f3f33408b1fead3c38127a2ab3e9" title=" " alt="" coords="247,99,398,140"/>
<area shape="rect" href="x86_8c.html#ab61af196de8a3705f59d9915b5eb1a0e" title=" " alt="" coords="224,164,421,205"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="253,230,393,257"/>
<area shape="rect" href="tdp__mmu_8c.html#a45fd618d35fb0df14a3401a230f41faa" title=" " alt="" coords="752,73,993,99"/>
<area shape="rect" href="mmu_8c.html#a1f49638b71a482e4b0c3a6af10d0711e" title=" " alt="" coords="493,63,684,104"/>
<area shape="rect" href="tdp__mmu_8c.html#a9da9e7ba01717f85966fc080e86ecb84" title=" " alt="" coords="1061,514,1223,541"/>
<area shape="rect" href="tdp__mmu_8c.html#aa98226578ebe207e97e262a86bbd5427" title=" " alt="" coords="1057,448,1227,489"/>
<area shape="rect" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d" title=" " alt="" coords="1041,569,1243,595"/>
<area shape="rect" href="tdp__mmu_8c.html#ae3e523e725021c7dd3f3796f4e074a37" title=" " alt="" coords="1074,623,1210,650"/>
<area shape="rect" href="tdp__mmu_8c.html#a670804848ccec53148d097c06b44657c" title=" " alt="" coords="759,514,986,541"/>
<area shape="rect" href="mmu_8c.html#acb92068f6e948846797ac6814b3618f1" title=" " alt="" coords="225,500,420,541"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="5,565,172,607"/>
<area shape="rect" href="tdp__mmu_8c.html#ac72a38de4d0b8a5cfeace82f10cc4caf" title=" " alt="" coords="794,565,951,607"/>
<area shape="rect" href="tdp__mmu_8c.html#a3a86994ba17144f60df37ea7682d650b" title=" " alt="" coords="475,565,702,607"/>
<area shape="rect" href="mmu_8c.html#a35da5538a61de05522efdad8f615df4f" title=" " alt="" coords="223,565,422,607"/>
<area shape="rect" href="tdp__mmu_8c.html#a7f6c658f3ddf3ffac5ce96335b78e295" title=" " alt="" coords="773,633,973,659"/>
<area shape="rect" href="mmu_8c.html#a168b7814e68a545abd8bf00fc4466610" title=" " alt="" coords="233,631,413,672"/>
</map>
</div>

</div>
</div>
<a id="a35969e29bbb017463732377231d536c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35969e29bbb017463732377231d536c4">&#9670;&nbsp;</a></span>test_age_gfn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool test_age_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtdp__iter.html">tdp_iter</a> *&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01200">1200</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;{</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="spte_8h.html#a16669248c64937ddec714d855609cacb">is_accessed_spte</a>(iter-&gt;<a class="code" href="structtdp__iter.html#ac3633464e37fa08393128005c46de911">old_spte</a>);</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a35969e29bbb017463732377231d536c4_cgraph.png" border="0" usemap="#atdp__mmu_8c_a35969e29bbb017463732377231d536c4_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_a35969e29bbb017463732377231d536c4_cgraph" id="atdp__mmu_8c_a35969e29bbb017463732377231d536c4_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,112,57"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="160,31,295,57"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="372,5,531,32"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="343,56,560,83"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="608,5,740,32"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="788,31,963,57"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_a35969e29bbb017463732377231d536c4_icgraph.png" border="0" usemap="#atdp__mmu_8c_a35969e29bbb017463732377231d536c4_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_a35969e29bbb017463732377231d536c4_icgraph" id="atdp__mmu_8c_a35969e29bbb017463732377231d536c4_icgraph">
<area shape="rect" title=" " alt="" coords="455,5,561,32"/>
<area shape="rect" href="tdp__mmu_8c.html#a78b4b5fbbd5f7b9fc997fef12a5ff92b" title=" " alt="" coords="196,5,407,32"/>
<area shape="rect" href="mmu_8c.html#a7045f4df80d26474c5fe995d02eebc35" title=" " alt="" coords="5,5,148,32"/>
</map>
</div>

</div>
</div>
<a id="aa07f9d272e2404a5b5392ae7aa175580"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa07f9d272e2404a5b5392ae7aa175580">&#9670;&nbsp;</a></span>write_protect_gfn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool write_protect_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>min_level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01710">1710</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;{</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    u64 new_spte;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="keywordtype">bool</span> spte_set = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160; </div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    BUG_ON(<a class="code" href="structtdp__iter.html#ac27bd3b5c86c4d810d3345d0f961825e">min_level</a> &gt; KVM_MAX_HUGEPAGE_LEVEL);</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160; </div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <a class="code" href="tdp__iter_8h.html#ae338deba99081393a1e19cdfa6640f48">for_each_tdp_pte_min_level</a>(iter, root, <a class="code" href="structtdp__iter.html#ac27bd3b5c86c4d810d3345d0f961825e">min_level</a>, <a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a>, <a class="code" href="structtdp__iter.html#a5d152c98e3bfe241c7f4ebeacbfd2627">gfn</a> + 1) {</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter.old_spte) ||</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;            !<a class="code" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a>(iter.old_spte, iter.level))</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160; </div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        new_spte = iter.old_spte &amp;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;            ~(<a class="code" href="mmu_8h.html#a8738f5e32b741b402eeb723accb071ed">PT_WRITABLE_MASK</a> | <a class="code" href="spte_8c.html#af450287cc0d83434644a34a9b938a250">shadow_mmu_writable_mask</a>);</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        <span class="keywordflow">if</span> (new_spte == iter.old_spte)</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160; </div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <a class="code" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d">tdp_mmu_iter_set_spte</a>(kvm, &amp;iter, new_spte);</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        spte_set = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    }</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160; </div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160; </div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    <span class="keywordflow">return</span> spte_set;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;}</div>
<div class="ttc" id="aspte_8c_html_af450287cc0d83434644a34a9b938a250"><div class="ttname"><a href="spte_8c.html#af450287cc0d83434644a34a9b938a250">shadow_mmu_writable_mask</a></div><div class="ttdeci">u64 __read_mostly shadow_mmu_writable_mask</div><div class="ttdef"><b>Definition:</b> <a href="spte_8c_source.html#l00028">spte.c:28</a></div></div>
<div class="ttc" id="astructtdp__iter_html_ac27bd3b5c86c4d810d3345d0f961825e"><div class="ttname"><a href="structtdp__iter.html#ac27bd3b5c86c4d810d3345d0f961825e">tdp_iter::min_level</a></div><div class="ttdeci">int min_level</div><div class="ttdef"><b>Definition:</b> <a href="tdp__iter_8h_source.html#l00099">tdp_iter.h:99</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa07f9d272e2404a5b5392ae7aa175580_cgraph.png" border="0" usemap="#atdp__mmu_8c_aa07f9d272e2404a5b5392ae7aa175580_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa07f9d272e2404a5b5392ae7aa175580_cgraph" id="atdp__mmu_8c_aa07f9d272e2404a5b5392ae7aa175580_cgraph">
<area shape="rect" title=" " alt="" coords="5,43,141,69"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1581,169,1679,196"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2207,793,2381,820"/>
<area shape="rect" href="tdp__mmu_8c.html#af6444812b70d9509539a3fa478cde14d" title=" " alt="" coords="189,245,364,272"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1819,169,1921,196"/>
<area shape="rect" href="tdp__mmu_8c.html#a1880e056251c1743579f5c7a25ccad1a" title=" " alt="" coords="412,423,559,449"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="607,448,769,475"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1077,397,1211,424"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1047,892,1241,919"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1553,1057,1707,1098"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="833,616,983,643"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1563,920,1697,947"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="1577,1123,1683,1149"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="851,245,965,272"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="821,195,995,221"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="837,144,979,171"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="817,448,999,475"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="844,296,972,323"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1095,347,1193,373"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1809,1072,1931,1099"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1058,616,1230,643"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1049,667,1239,693"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1297,819,1491,861"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1094,499,1194,525"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1061,550,1227,591"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1067,717,1221,744"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1311,600,1477,627"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1289,951,1499,977"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1297,885,1491,926"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1547,971,1713,997"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1791,920,1949,947"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="2027,920,2159,947"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1785,1021,1955,1048"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1329,499,1459,525"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1325,549,1463,576"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1295,717,1493,744"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1317,651,1471,693"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1761,869,1979,896"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1777,1123,1963,1149"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1052,195,1236,221"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1301,169,1487,196"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1067,144,1221,171"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_aa07f9d272e2404a5b5392ae7aa175580_icgraph.png" border="0" usemap="#atdp__mmu_8c_aa07f9d272e2404a5b5392ae7aa175580_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_aa07f9d272e2404a5b5392ae7aa175580_icgraph" id="atdp__mmu_8c_aa07f9d272e2404a5b5392ae7aa175580_icgraph">
<area shape="rect" title=" " alt="" coords="3187,85,3323,112"/>
<area shape="rect" href="tdp__mmu_8c.html#a45fd618d35fb0df14a3401a230f41faa" title=" " alt="" coords="2897,85,3139,112"/>
<area shape="rect" href="mmu_8c.html#a1f49638b71a482e4b0c3a6af10d0711e" title=" " alt="" coords="2659,78,2849,119"/>
<area shape="rect" href="page__track_8c.html#ab6a4ffea76ea12eb3b1e83eafaf4618b" title=" " alt="" coords="2403,5,2607,32"/>
<area shape="rect" href="mmu_8c.html#aec5cf4265713109c5e2ea673c610cd03" title=" " alt="" coords="2201,56,2347,83"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="2416,107,2595,149"/>
<area shape="rect" href="mmu_8c.html#a2e21344d37e1f1c8c347bed8627da8db" title=" " alt="" coords="2400,173,2611,200"/>
<area shape="rect" href="mmu_8c.html#a6f305a17525ee7345f0f852070869e4c" title=" " alt="" coords="1921,56,2148,83"/>
<area shape="rect" href="mmu_8c.html#a1ade612e5d4a58575df9428f6ad72bb9" title=" " alt="" coords="1643,56,1873,83"/>
<area shape="rect" href="mmu_8c.html#a0afaf010cb78207cd01091773878f1f2" title=" " alt="" coords="1432,107,1595,133"/>
<area shape="rect" href="mmu_8c.html#a0ebfdae56a33b8ca22e8fa22268fe033" title=" " alt="" coords="1196,50,1384,91"/>
<area shape="rect" href="mmu_8c.html#aa0069ee555cb7a0001ed142edc326369" title=" " alt="" coords="1200,119,1380,145"/>
<area shape="rect" href="mmu_8c.html#a3722e33cca20a56503aa98b084383c47" title=" " alt="" coords="987,119,1082,145"/>
<area shape="rect" href="paging__tmpl_8h.html#ac7154588698b915e973bb8ca63e206e4" title=" " alt="" coords="1007,171,1062,197"/>
<area shape="rect" href="mmu_8c.html#aebe1e577e70e9f77f0bfea48bab7c83d" title=" " alt="" coords="719,119,853,145"/>
<area shape="rect" href="mmu_8c.html#a4bd7a8fd81e65c4e06e025d92c5787d9" title=" " alt="" coords="465,168,620,195"/>
<area shape="rect" href="mmu_8c.html#a925050134bb3c589bb55b63993ddacb1" title=" " alt="" coords="459,117,626,144"/>
<area shape="rect" href="paging__tmpl_8h.html#a58a78a9bd7e3593e2a7cfe13400331aa" title=" " alt="" coords="741,171,831,197"/>
<area shape="rect" href="mmu_8c.html#abe6e7771da6f6df50052156316535466" title=" " alt="" coords="921,57,1148,84"/>
<area shape="rect" href="mmu_8c.html#a03732600ed110f429f4a2d526a303bcb" title=" " alt="" coords="699,50,873,91"/>
<area shape="rect" href="mmu_8c.html#a2e109b8775cdfe9924c3d331ac5f332f" title=" " alt="" coords="456,50,629,91"/>
<area shape="rect" href="mmu_8c.html#adfe576663ff84a7b51773d87e91dd28a" title=" " alt="" coords="200,50,375,91"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="2196,115,2352,141"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="1955,115,2115,141"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1681,107,1835,149"/>
<area shape="rect" href="mmu_8c.html#a2f33377dcdaf5435e453ff75e02075dd" title=" " alt="" coords="2198,173,2350,200"/>
<area shape="rect" href="mmu_8c.html#ab00408fb7acb0199782175051f59add6" title=" " alt="" coords="1950,316,2119,343"/>
<area shape="rect" href="mmu_8c.html#a475bd00898314bb9378d8e4306aa7874" title=" " alt="" coords="1695,291,1821,317"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="717,341,855,368"/>
<area shape="rect" href="x86_8c.html#a334f9c72dae5c0a2867b04acbc2beb6e" title=" " alt="" coords="1215,414,1365,455"/>
<area shape="rect" href="mmu_8h.html#ab0e194ecad859add3d639850021f8b16" title=" " alt="" coords="1443,291,1583,317"/>
<area shape="rect" href="mmu_8c.html#a339656816251af93fbd52aece22a2009" title=" " alt="" coords="1205,225,1375,266"/>
<area shape="rect" href="async__pf_8c.html#aac6395172fbf7947412604d7e2f33417" title=" " alt="" coords="954,225,1115,266"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="699,232,873,259"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="502,221,583,248"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="194,221,381,248"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="11,221,135,248"/>
<area shape="rect" href="x86_8c.html#abf28742eaf88f469f322233afeb66b59" title=" " alt="" coords="951,494,1118,535"/>
<area shape="rect" href="x86_8c.html#a187212c772cf6e896de2a5304f88b9fb" title=" " alt="" coords="965,392,1104,419"/>
<area shape="rect" href="vmx_2nested_8c.html#ad680a323fa0378a55e97821505ba74b1" title=" " alt="" coords="709,505,863,532"/>
<area shape="rect" href="vmx_8c.html#a23ea2316b60c27a2c00f924b983a46e9" title=" " alt="" coords="213,704,361,731"/>
<area shape="rect" href="vmx_2nested_8c.html#af5978d4465f6d84a878163540b6f9ae6" title=" " alt="" coords="481,557,604,584"/>
<area shape="rect" href="vmx_2nested_8c.html#a4e307e2bcf664c83265b1442e3fc8da2" title=" " alt="" coords="455,609,631,650"/>
<area shape="rect" href="vmx_2nested_8c.html#ad3cab9cf8633364513bd6a24caecf41a" title=" " alt="" coords="435,273,651,314"/>
<area shape="rect" href="vmx_2nested_8c.html#ae8bd3aaa6d3ea61d98732dc54ced8578" title=" " alt="" coords="188,393,387,420"/>
<area shape="rect" href="vmx_2nested_8c.html#a48fcc88ceee4f57a3dbf23fedb46a5cb" title=" " alt="" coords="467,726,618,767"/>
<area shape="rect" href="vmx_2nested_8c.html#aedc5821e9af5c7bd4aac6c06f4ca046f" title=" " alt="" coords="453,339,633,365"/>
<area shape="rect" href="vmx_2hyperv_8c.html#a937e30dece4579b71b17efcd54c1d910" title=" " alt="" coords="451,390,635,431"/>
<area shape="rect" href="vmx_2nested_8c.html#a64e6550fab681b40c832fe4e2d5e3b95" title=" " alt="" coords="470,456,615,483"/>
<area shape="rect" href="vmx_8c.html#a6ee5de3518ff2c2c20b1c1a0e17b2f1e" title=" " alt="" coords="5,704,140,731"/>
</map>
</div>

</div>
</div>
<a id="ae3e523e725021c7dd3f3796f4e074a37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3e523e725021c7dd3f3796f4e074a37">&#9670;&nbsp;</a></span>wrprot_gfn_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool wrprot_gfn_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>min_level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01262">1262</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;{</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    u64 new_spte;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordtype">bool</span> spte_set = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    BUG_ON(<a class="code" href="structtdp__iter.html#ac27bd3b5c86c4d810d3345d0f961825e">min_level</a> &gt; KVM_MAX_HUGEPAGE_LEVEL);</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <a class="code" href="tdp__iter_8h.html#ae338deba99081393a1e19cdfa6640f48">for_each_tdp_pte_min_level</a>(iter, root, <a class="code" href="structtdp__iter.html#ac27bd3b5c86c4d810d3345d0f961825e">min_level</a>, start, end) {</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;retry:</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2">tdp_mmu_iter_cond_resched</a>(kvm, &amp;iter, <span class="keyword">false</span>, <span class="keyword">true</span>))</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160; </div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter.old_spte) ||</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;            !<a class="code" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a>(iter.old_spte, iter.level) ||</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            !(iter.old_spte &amp; <a class="code" href="mmu_8h.html#a8738f5e32b741b402eeb723accb071ed">PT_WRITABLE_MASK</a>))</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160; </div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        new_spte = iter.old_spte &amp; ~<a class="code" href="mmu_8h.html#a8738f5e32b741b402eeb723accb071ed">PT_WRITABLE_MASK</a>;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160; </div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6">tdp_mmu_set_spte_atomic</a>(kvm, &amp;iter, new_spte))</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;            <span class="keywordflow">goto</span> retry;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160; </div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        spte_set = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    }</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160; </div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="keywordflow">return</span> spte_set;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ae3e523e725021c7dd3f3796f4e074a37_cgraph.png" border="0" usemap="#atdp__mmu_8c_ae3e523e725021c7dd3f3796f4e074a37_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_ae3e523e725021c7dd3f3796f4e074a37_cgraph" id="atdp__mmu_8c_ae3e523e725021c7dd3f3796f4e074a37_cgraph">
<area shape="rect" title=" " alt="" coords="5,115,141,141"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1483,220,1581,247"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="2113,491,2288,517"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="189,92,399,119"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="195,347,393,373"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1726,220,1827,247"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="447,91,621,117"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="669,89,880,116"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="928,78,1139,119"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1208,93,1375,120"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1197,43,1385,69"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1493,144,1571,171"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1444,93,1620,120"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1455,43,1609,69"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="453,637,615,664"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="967,448,1100,475"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="1455,689,1609,730"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="699,637,850,664"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="1465,895,1599,921"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="722,1053,827,1080"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="718,1104,831,1131"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="688,1155,861,1181"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="703,1205,846,1232"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="684,397,865,424"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="711,296,839,323"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="984,347,1083,373"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1716,692,1837,719"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="947,717,1119,744"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="938,768,1129,795"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="936,824,1131,851"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1194,886,1389,927"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="983,549,1083,576"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="950,601,1117,642"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="957,667,1110,693"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1209,717,1374,744"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1187,835,1396,861"/>
<area shape="rect" href="tdp__iter_8h.html#ae00f2a54e0e899c2f169396a9c10d223" title=" " alt="" coords="1194,769,1389,810"/>
<area shape="rect" href="spte_8c.html#a11de60840b247621debae854aea928db" title=" " alt="" coords="1449,776,1615,803"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1697,844,1856,871"/>
<area shape="rect" href="spte_8h.html#a976cddc84d935189584bdce94d4805fd" title=" " alt="" coords="1933,844,2065,871"/>
<area shape="rect" href="spte_8h.html#aeb796217990be75433fd1430d5958184" title=" " alt="" coords="1692,743,1861,769"/>
<area shape="rect" href="spte_8h.html#a6e93c3ba68ed8b0ab050918d92cf4c6b" title=" " alt="" coords="1226,499,1357,525"/>
<area shape="rect" href="tdp__mmu_8c.html#afab0b8fc9210a8e1190a153f664ef78b" title=" " alt="" coords="1222,549,1361,576"/>
<area shape="rect" href="tdp__mmu_8c.html#a0003da5596a964166d5e46389e7cf4b3" title=" " alt="" coords="1193,667,1390,693"/>
<area shape="rect" href="mmu_8c.html#a2fba0b2dd67723bfbc4349ea7c8e019a" title=" " alt="" coords="1214,601,1369,642"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1668,895,1885,921"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1683,945,1870,972"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="941,1155,1125,1181"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1198,1180,1385,1207"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="956,1205,1111,1232"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ae3e523e725021c7dd3f3796f4e074a37_icgraph.png" border="0" usemap="#atdp__mmu_8c_ae3e523e725021c7dd3f3796f4e074a37_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ae3e523e725021c7dd3f3796f4e074a37_icgraph" id="atdp__mmu_8c_ae3e523e725021c7dd3f3796f4e074a37_icgraph">
<area shape="rect" title=" " alt="" coords="3309,232,3445,259"/>
<area shape="rect" href="tdp__mmu_8c.html#a7f6c658f3ddf3ffac5ce96335b78e295" title=" " alt="" coords="3061,232,3261,259"/>
<area shape="rect" href="mmu_8c.html#a168b7814e68a545abd8bf00fc4466610" title=" " alt="" coords="2833,225,3013,266"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2619,225,2785,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2365,225,2571,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2099,232,2317,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1908,232,2051,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
</map>
</div>

</div>
</div>
<a id="ac72a38de4d0b8a5cfeace82f10cc4caf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac72a38de4d0b8a5cfeace82f10cc4caf">&#9670;&nbsp;</a></span>zap_collapsible_spte_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void zap_collapsible_spte_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structkvm__mmu__page.html">kvm_mmu_page</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tdp__mmu_8c_source.html#l01640">1640</a> of file <a class="el" href="tdp__mmu_8c_source.html">tdp_mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;{</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    gfn_t start = slot-&gt;base_gfn;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    gfn_t end = start + slot-&gt;npages;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <span class="keyword">struct </span><a class="code" href="structtdp__iter.html">tdp_iter</a> iter;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="keywordtype">int</span> max_mapping_level;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160; </div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160; </div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <a class="code" href="tdp__iter_8h.html#ae338deba99081393a1e19cdfa6640f48">for_each_tdp_pte_min_level</a>(iter, root, PG_LEVEL_2M, start, end) {</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;retry:</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2">tdp_mmu_iter_cond_resched</a>(kvm, &amp;iter, <span class="keyword">false</span>, <span class="keyword">true</span>))</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160; </div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        <span class="keywordflow">if</span> (iter.level &gt; KVM_MAX_HUGEPAGE_LEVEL ||</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            !<a class="code" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686">is_shadow_present_pte</a>(iter.old_spte))</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160; </div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment">         * Don&#39;t zap leaf SPTEs, if a leaf SPTE could be replaced with</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="comment">         * a large page size, then its parent would have been zapped</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment">         * instead of stepping down.</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5">is_last_spte</a>(iter.old_spte, iter.level))</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160; </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment">         * If iter.gfn resides outside of the slot, i.e. the page for</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">         * the current level overlaps but is not contained by the slot,</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment">         * then the SPTE can&#39;t be made huge.  More importantly, trying</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="comment">         * to query that info from slot-&gt;arch.lpage_info will cause an</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="comment">         * out-of-bounds access.</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        <span class="keywordflow">if</span> (iter.gfn &lt; start || iter.gfn &gt;= end)</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160; </div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        max_mapping_level = <a class="code" href="mmu_8c.html#a514b4601388e83cb56ffe210d5123b50">kvm_mmu_max_mapping_level</a>(kvm, slot,</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                                  iter.gfn, PG_LEVEL_NUM);</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        <span class="keywordflow">if</span> (max_mapping_level &lt; iter.level)</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160; </div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        <span class="comment">/* Note, a successful atomic zap also does a remote TLB flush. */</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d">tdp_mmu_zap_spte_atomic</a>(kvm, &amp;iter))</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;            <span class="keywordflow">goto</span> retry;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    }</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160; </div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a514b4601388e83cb56ffe210d5123b50"><div class="ttname"><a href="mmu_8c.html#a514b4601388e83cb56ffe210d5123b50">kvm_mmu_max_mapping_level</a></div><div class="ttdeci">int kvm_mmu_max_mapping_level(struct kvm *kvm, const struct kvm_memory_slot *slot, gfn_t gfn, int max_level)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l03170">mmu.c:3170</a></div></div>
<div class="ttc" id="atdp__mmu_8c_html_ab901a77cd00a4e809baa9a25e289b59d"><div class="ttname"><a href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d">tdp_mmu_zap_spte_atomic</a></div><div class="ttdeci">static int tdp_mmu_zap_spte_atomic(struct kvm *kvm, struct tdp_iter *iter)</div><div class="ttdef"><b>Definition:</b> <a href="tdp__mmu_8c_source.html#l00549">tdp_mmu.c:549</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ac72a38de4d0b8a5cfeace82f10cc4caf_cgraph.png" border="0" usemap="#atdp__mmu_8c_ac72a38de4d0b8a5cfeace82f10cc4caf_cgraph" alt=""/></div>
<map name="atdp__mmu_8c_ac72a38de4d0b8a5cfeace82f10cc4caf_cgraph" id="atdp__mmu_8c_ac72a38de4d0b8a5cfeace82f10cc4caf_cgraph">
<area shape="rect" title=" " alt="" coords="5,1128,163,1169"/>
<area shape="rect" href="spte_8h.html#a785ce7507ac8cabfb2a667ed0c57b1f5" title=" " alt="" coords="1241,90,1339,117"/>
<area shape="rect" href="spte_8h.html#a7d73c1cb0114320b9dab8ba78033c686" title=" " alt="" coords="1465,486,1639,513"/>
<area shape="rect" href="mmu_8c.html#a514b4601388e83cb56ffe210d5123b50" title=" " alt="" coords="219,1325,411,1367"/>
<area shape="rect" href="tdp__mmu_8c.html#abc2d73db35961f670cedf8ce1206c4d2" title=" " alt="" coords="211,1215,420,1242"/>
<area shape="rect" href="tdp__mmu_8c.html#ab901a77cd00a4e809baa9a25e289b59d" title=" " alt="" coords="215,1135,416,1162"/>
<area shape="rect" href="spte_8h.html#ae9b1a94fccf74f0837e1a775bc57d729" title=" " alt="" coords="1501,90,1603,117"/>
<area shape="rect" href="mmu_8c.html#a3c4a735c02073ba03d156c2ce4cfc5e5" title=" " alt="" coords="468,1355,675,1396"/>
<area shape="rect" href="mmu_8c.html#a25a86ecdadc998ed7ceac6eb669be98f" title=" " alt="" coords="723,1358,904,1385"/>
<area shape="rect" href="mmu_8c.html#a1a8a0df061e27892bcc64a3e810e6c29" title=" " alt="" coords="753,1409,874,1435"/>
<area shape="rect" href="mmu_8h.html#a41b79b63cae220349d8eb5a54f047939" title=" " alt="" coords="989,1409,1096,1435"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="955,1274,1130,1301"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="1185,1274,1395,1301"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1447,1267,1657,1308"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1716,1249,1883,1275"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1705,1299,1893,1326"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1990,1249,2069,1275"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1941,1350,2117,1377"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1953,1299,2106,1326"/>
<area shape="rect" href="tdp__iter_8h.html#acce3a5afd04a68fc666c32e91d8c1770" title=" " alt="" coords="1447,1089,1657,1115"/>
<area shape="rect" href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e" title=" " alt="" coords="470,1186,673,1213"/>
<area shape="rect" href="tdp__mmu_8c.html#a692eb9d20075258e5d4a0e4289a7c9b6" title=" " alt="" coords="472,1085,671,1111"/>
<area shape="rect" href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5" title=" " alt="" coords="738,1186,889,1213"/>
<area shape="rect" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f" title=" " alt="" coords="726,1237,901,1279"/>
<area shape="rect" href="tdp__mmu_8c.html#a95692dd1daa13effa90e042a8a7057af" title=" " alt="" coords="732,461,895,487"/>
<area shape="rect" href="spte_8h.html#ad52bae526742289dbd54348dfa55310b" title=" " alt="" coords="1223,1085,1357,1111"/>
<area shape="rect" href="spte_8h.html#a2946d25249b11a82d33e9ad9dca73ec4" title=" " alt="" coords="965,141,1120,183"/>
<area shape="rect" href="tdp__mmu_8c.html#ac509299bc28d3b827578915abdb2280e" title=" " alt="" coords="967,831,1118,858"/>
<area shape="rect" href="spte_8h.html#a16669248c64937ddec714d855609cacb" title=" " alt="" coords="975,613,1110,639"/>
<area shape="rect" href="spte_8h.html#a0726c9cf54d23a373533a0833aaf979c" title=" " alt="" coords="990,562,1095,589"/>
<area shape="rect" href="spte_8h.html#a2927d719923cb2ed2b5b83d739a275f7" title=" " alt="" coords="986,258,1099,285"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="956,207,1129,234"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="971,410,1114,437"/>
<area shape="rect" href="mmu_8h.html#a9d589fd96a814e43fc146f83dc5d5f73" title=" " alt="" coords="952,461,1133,487"/>
<area shape="rect" href="tdp__iter_8c.html#ae565103c187af07e69eb2f29b180b977" title=" " alt="" coords="979,309,1107,335"/>
<area shape="rect" href="spte_8h.html#a88a720d39abac3aee2f63e03a20e8abd" title=" " alt="" coords="1241,359,1339,386"/>
<area shape="rect" href="spte_8h.html#a4d0035385de92ed42a75324a2fb96d49" title=" " alt="" coords="1229,149,1351,175"/>
<area shape="rect" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79" title=" " alt="" coords="1204,831,1376,858"/>
<area shape="rect" href="tdp__iter_8h.html#ae1b8feffcbd421cbcb6a40cd57abf768" title=" " alt="" coords="1195,882,1385,909"/>
<area shape="rect" href="tdp__iter_8h.html#a74cc1f032b50c7c6c64ded8866deb4a4" title=" " alt="" coords="1193,1034,1387,1061"/>
<area shape="rect" href="tdp__iter_8h.html#a2138ed5465b3552439c1ad55ee1bc6d1" title=" " alt="" coords="1455,1001,1649,1043"/>
<area shape="rect" href="spte_8h.html#a501c74fbb95a5dd015922c57a163ca13" title=" " alt="" coords="1240,933,1340,959"/>
<area shape="rect" href="tdp__mmu_8c.html#a92b80ecd9f7bf033d7ed2f28fb0a1279" title=" " alt="" coords="1207,715,1373,756"/>
<area shape="rect" href="tdp__mmu_8c.html#a401c07c0503d3fc2c62b9a8a06096686" title=" " alt="" coords="1213,781,1367,807"/>
<area shape="rect" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac" title=" " alt="" coords="1469,831,1635,858"/>
<area shape="rect" href="spte_8h.html#a30b8d20964e90337ab8eaeddca1ba192" title=" " alt="" coords="1211,613,1369,639"/>
<area shape="rect" href="spte_8h.html#a98cf368e8afe70efc381135f55a982c8" title=" " alt="" coords="1181,562,1399,589"/>
<area shape="rect" href="spte_8h.html#ad4cab344dce7557c80f815d4dc072deb" title=" " alt="" coords="1197,511,1383,538"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1198,207,1382,234"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="1213,410,1367,437"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="tdp__mmu_8c_ac72a38de4d0b8a5cfeace82f10cc4caf_icgraph.png" border="0" usemap="#atdp__mmu_8c_ac72a38de4d0b8a5cfeace82f10cc4caf_icgraph" alt=""/></div>
<map name="atdp__mmu_8c_ac72a38de4d0b8a5cfeace82f10cc4caf_icgraph" id="atdp__mmu_8c_ac72a38de4d0b8a5cfeace82f10cc4caf_icgraph">
<area shape="rect" title=" " alt="" coords="3355,225,3512,266"/>
<area shape="rect" href="tdp__mmu_8c.html#a3a86994ba17144f60df37ea7682d650b" title=" " alt="" coords="3080,225,3307,266"/>
<area shape="rect" href="mmu_8c.html#a35da5538a61de05522efdad8f615df4f" title=" " alt="" coords="2833,225,3032,266"/>
<area shape="rect" href="x86_8c.html#a9ca94438429f3e85a9b7b6db1ef55252" title=" " alt="" coords="2619,225,2785,266"/>
<area shape="rect" href="x86_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="2365,225,2571,266"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="2099,232,2317,259"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="1908,232,2051,259"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="1657,232,1860,259"/>
<area shape="rect" href="x86_8c.html#a0c0c5e35bc626e4140927bf15b4881f9" title=" " alt="" coords="1412,177,1609,204"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="1417,257,1605,284"/>
<area shape="rect" href="vmx_8c.html#acc48d0f16e027c2bad1268d02a2eaa68" title=" " alt="" coords="1160,51,1345,77"/>
<area shape="rect" href="lapic_8c.html#a8c6616d2cbae35632aa5debb15b552ec" title=" " alt="" coords="1146,101,1359,128"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1167,152,1338,179"/>
<area shape="rect" href="lapic_8c.html#a017e57adbc721d98d26099f1a431a22c" title=" " alt="" coords="1141,203,1364,229"/>
<area shape="rect" href="vmx_8c.html#a15d61630d8c4e3f7aea16d3b0164a799" title=" " alt="" coords="1183,253,1323,280"/>
<area shape="rect" href="vmx_8c.html#a426fe0cb3c7fd73b276f6815b6ab9ddc" title=" " alt="" coords="933,51,1071,77"/>
<area shape="rect" href="avic_8c.html#aefc63eafb35c1efd94f6d53e7d0b20d5" title=" " alt="" coords="915,101,1089,128"/>
<area shape="rect" href="avic_8c.html#a8e0a22138080054f4ac064064402f74a" title=" " alt="" coords="737,25,851,52"/>
<area shape="rect" href="svm_8c.html#a2af2f754ca7838a0253d54c33aae7d1e" title=" " alt="" coords="504,5,640,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="731,113,857,140"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="935,203,1069,229"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="475,56,669,83"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="737,240,851,267"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="497,107,647,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="489,157,655,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="495,208,649,235"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="467,259,677,285"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="486,310,658,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="505,376,639,403"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="501,427,643,453"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="507,477,637,504"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="219,107,377,133"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="177,427,419,453"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="231,477,365,504"/>
<area shape="rect" href="x86_8c.html#a384702aafa8cdbab3cf92b3d576bb6fb" title=" " alt="" coords="911,253,1093,280"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="725,400,863,427"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="531,528,613,555"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="205,528,391,555"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,528,129,555"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="1151,305,1354,346"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
