<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/x86/kvm/smm.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_c21774f8bc9f0de15163573e5f5fa2b5.html">x86</a></li><li class="navelem"><a class="el" href="dir_fde450fd4b58e2560c53a1e73bfa4d6d.html">kvm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">smm.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &quot;<a class="el" href="x86_8h_source.html">x86.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="kvm__cache__regs_8h_source.html">kvm_cache_regs.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="kvm__emulate_8h_source.html">kvm_emulate.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="smm_8h_source.html">smm.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="cpuid_8h_source.html">cpuid.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="trace_8h_source.html">trace.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for smm.c:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c__incl.png" border="0" usemap="#aarch_2x86_2kvm_2smm_8c" alt=""/></div>
<map name="aarch_2x86_2kvm_2smm_8c" id="aarch_2x86_2kvm_2smm_8c">
<area shape="rect" title=" " alt="" coords="376,5,535,32"/>
<area shape="rect" title=" " alt="" coords="27,304,161,331"/>
<area shape="rect" href="x86_8h.html" title=" " alt="" coords="359,155,418,181"/>
<area shape="rect" href="kvm__cache__regs_8h.html" title=" " alt="" coords="23,229,165,256"/>
<area shape="rect" href="kvm__emulate_8h.html" title=" " alt="" coords="656,229,780,256"/>
<area shape="rect" href="smm_8h.html" title=" " alt="" coords="1063,80,1130,107"/>
<area shape="rect" href="cpuid_8h.html" title=" " alt="" coords="723,80,793,107"/>
<area shape="rect" href="trace_8h.html" title=" " alt="" coords="1727,80,1794,107"/>
<area shape="rect" title=" " alt="" coords="241,229,373,256"/>
<area shape="rect" title=" " alt="" coords="397,229,492,256"/>
<area shape="rect" title=" " alt="" coords="516,229,632,256"/>
<area shape="rect" title=" " alt="" coords="711,304,842,331"/>
<area shape="rect" href="fpu_8h.html" title=" " alt="" coords="632,304,687,331"/>
<area shape="rect" title=" " alt="" coords="604,379,715,405"/>
<area shape="rect" title=" " alt="" coords="1277,155,1410,181"/>
<area shape="rect" href="reverse__cpuid_8h.html" title=" " alt="" coords="861,155,986,181"/>
<area shape="rect" title=" " alt="" coords="1011,155,1100,181"/>
<area shape="rect" title=" " alt="" coords="1125,155,1253,181"/>
<area shape="rect" title=" " alt="" coords="493,155,655,181"/>
<area shape="rect" href="governed__features_8h.html" title=" " alt="" coords="680,155,836,181"/>
<area shape="rect" title=" " alt="" coords="804,229,931,256"/>
<area shape="rect" title=" " alt="" coords="955,229,1091,256"/>
<area shape="rect" title=" " alt="" coords="1116,229,1259,256"/>
<area shape="rect" title=" " alt="" coords="1434,155,1570,181"/>
<area shape="rect" title=" " alt="" coords="1595,155,1689,181"/>
<area shape="rect" title=" " alt="" coords="1713,155,1808,181"/>
<area shape="rect" title=" " alt="" coords="1832,155,1975,181"/>
<area shape="rect" title=" " alt="" coords="1999,155,2141,181"/>
<area shape="rect" title=" " alt="" coords="2165,155,2316,181"/>
</map>
</div>
</div>
<p><a href="smm_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1f8c165bf4196327bc3abff648276d92"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a1f8c165bf4196327bc3abff648276d92">pr_fmt</a>(fmt)&#160;&#160;&#160;KBUILD_MODNAME &quot;: &quot; fmt</td></tr>
<tr class="separator:a1f8c165bf4196327bc3abff648276d92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4744b0c85cabfb51a8651614b3d24068"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(field,  offset)&#160;&#160;&#160;	ASSERT_STRUCT_OFFSET(struct kvm_smram_state_32, field, offset - 0xFE00)</td></tr>
<tr class="separator:a4744b0c85cabfb51a8651614b3d24068"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa62e77eee225992050fc4a81084fdaa1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(field,  offset)&#160;&#160;&#160;	ASSERT_STRUCT_OFFSET(struct kvm_smram_state_64, field, offset - 0xFE00)</td></tr>
<tr class="separator:aa62e77eee225992050fc4a81084fdaa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7812ad37d9dd48c3fa0a85cad91e6241"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a7812ad37d9dd48c3fa0a85cad91e6241">check_smram_offsets</a> (void)</td></tr>
<tr class="separator:a7812ad37d9dd48c3fa0a85cad91e6241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5382946234c910e05c6e2c09aff15713"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a5382946234c910e05c6e2c09aff15713">kvm_smm_changed</a> (struct kvm_vcpu *vcpu, bool entering_smm)</td></tr>
<tr class="separator:a5382946234c910e05c6e2c09aff15713"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a638e02081e08ea00a30c71d82fccf9d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a638e02081e08ea00a30c71d82fccf9d7">process_smi</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a638e02081e08ea00a30c71d82fccf9d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e93139a6ea69860969bd5bd0fcb5de5"><td class="memItemLeft" align="right" valign="top">static u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a0e93139a6ea69860969bd5bd0fcb5de5">enter_smm_get_segment_flags</a> (struct kvm_segment *seg)</td></tr>
<tr class="separator:a0e93139a6ea69860969bd5bd0fcb5de5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a194dfeabd35eaaf3f958a037fe4dc027"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a> (struct kvm_vcpu *vcpu, struct kvm_smm_seg_state_32 *<a class="el" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>, u32 *selector, int n)</td></tr>
<tr class="separator:a194dfeabd35eaaf3f958a037fe4dc027"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a441459cf488188fad0f4147293e000ec"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a441459cf488188fad0f4147293e000ec">enter_smm_save_state_32</a> (struct kvm_vcpu *vcpu, struct kvm_smram_state_32 *smram)</td></tr>
<tr class="separator:a441459cf488188fad0f4147293e000ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1445727a8459a6cc7d2e49e5a63c0d5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#ae1445727a8459a6cc7d2e49e5a63c0d5">enter_smm</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ae1445727a8459a6cc7d2e49e5a63c0d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a295c8b394815c953fba753d42c4fc5b6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a295c8b394815c953fba753d42c4fc5b6">rsm_set_desc_flags</a> (struct kvm_segment *desc, u32 <a class="el" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>)</td></tr>
<tr class="separator:a295c8b394815c953fba753d42c4fc5b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb71f3f026dc16865ba79f3dff1ffcc4"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a> (struct kvm_vcpu *vcpu, const struct kvm_smm_seg_state_32 *<a class="el" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>, u16 selector, int n)</td></tr>
<tr class="separator:afb71f3f026dc16865ba79f3dff1ffcc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c50da2c4874eda6d67766974a476019"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a0c50da2c4874eda6d67766974a476019">rsm_enter_protected_mode</a> (struct kvm_vcpu *vcpu, u64 cr0, u64 cr3, u64 cr4)</td></tr>
<tr class="separator:a0c50da2c4874eda6d67766974a476019"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0136cd1aa193ad29565961ea839a99a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#ae0136cd1aa193ad29565961ea839a99a">rsm_load_state_32</a> (struct <a class="el" href="structx86__emulate__ctxt.html">x86_emulate_ctxt</a> *ctxt, const struct kvm_smram_state_32 *smstate)</td></tr>
<tr class="separator:ae0136cd1aa193ad29565961ea839a99a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0943012ff008c7999f582998f0f9167a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="smm_8c.html#a0943012ff008c7999f582998f0f9167a">emulator_leave_smm</a> (struct <a class="el" href="structx86__emulate__ctxt.html">x86_emulate_ctxt</a> *ctxt)</td></tr>
<tr class="separator:a0943012ff008c7999f582998f0f9167a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a4744b0c85cabfb51a8651614b3d24068"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4744b0c85cabfb51a8651614b3d24068">&#9670;&nbsp;</a></span>CHECK_SMRAM32_OFFSET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHECK_SMRAM32_OFFSET</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">field, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">offset&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;	ASSERT_STRUCT_OFFSET(struct kvm_smram_state_32, field, offset - 0xFE00)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00012">12</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>

</div>
</div>
<a id="aa62e77eee225992050fc4a81084fdaa1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa62e77eee225992050fc4a81084fdaa1">&#9670;&nbsp;</a></span>CHECK_SMRAM64_OFFSET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHECK_SMRAM64_OFFSET</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">field, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">offset&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;	ASSERT_STRUCT_OFFSET(struct kvm_smram_state_64, field, offset - 0xFE00)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00015">15</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>

</div>
</div>
<a id="a1f8c165bf4196327bc3abff648276d92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f8c165bf4196327bc3abff648276d92">&#9670;&nbsp;</a></span>pr_fmt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pr_fmt</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">fmt</td><td>)</td>
          <td>&#160;&#160;&#160;KBUILD_MODNAME &quot;: &quot; fmt</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00002">2</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a7812ad37d9dd48c3fa0a85cad91e6241"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7812ad37d9dd48c3fa0a85cad91e6241">&#9670;&nbsp;</a></span>check_smram_offsets()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void check_smram_offsets </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00018">18</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;{</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment">/* 32 bit SMRAM image */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(reserved1,         0xFE00);</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(smbase,            0xFEF8);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(smm_revision,      0xFEFC);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(io_inst_restart,       0xFF00);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(auto_hlt_restart,      0xFF02);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(io_restart_rdi,        0xFF04);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(io_restart_rcx,        0xFF08);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(io_restart_rsi,        0xFF0C);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(io_restart_rip,        0xFF10);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(cr4,           0xFF14);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(reserved2,         0xFF18);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(int_shadow,        0xFF1A);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(reserved3,         0xFF1B);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(ds,            0xFF2C);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(fs,            0xFF38);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(gs,            0xFF44);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(idtr,          0xFF50);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(tr,            0xFF5C);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(gdtr,          0xFF6C);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(ldtr,          0xFF78);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(es,            0xFF84);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(cs,            0xFF90);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(ss,            0xFF9C);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(es_sel,            0xFFA8);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(cs_sel,            0xFFAC);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(ss_sel,            0xFFB0);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(ds_sel,            0xFFB4);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(fs_sel,            0xFFB8);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(gs_sel,            0xFFBC);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(ldtr_sel,          0xFFC0);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(tr_sel,            0xFFC4);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(dr7,           0xFFC8);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(dr6,           0xFFCC);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(gprs,          0xFFD0);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(eip,           0xFFF0);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(eflags,            0xFFF4);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(cr3,           0xFFF8);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a>(cr0,           0xFFFC);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">/* 64 bit SMRAM image */</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(es,            0xFE00);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(cs,            0xFE10);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(ss,            0xFE20);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(ds,            0xFE30);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(fs,            0xFE40);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(gs,            0xFE50);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(gdtr,          0xFE60);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(ldtr,          0xFE70);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(idtr,          0xFE80);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(tr,            0xFE90);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(io_restart_rip,        0xFEA0);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(io_restart_rcx,        0xFEA8);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(io_restart_rsi,        0xFEB0);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(io_restart_rdi,        0xFEB8);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(io_restart_dword,      0xFEC0);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(reserved1,         0xFEC4);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(io_inst_restart,       0xFEC8);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(auto_hlt_restart,      0xFEC9);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(amd_nmi_mask,      0xFECA);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(int_shadow,        0xFECB);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(reserved2,         0xFECC);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(efer,          0xFED0);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(svm_guest_flag,        0xFED8);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(svm_guest_vmcb_gpa,    0xFEE0);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(svm_guest_virtual_int, 0xFEE8);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(reserved3,         0xFEF0);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(smm_revison,       0xFEFC);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(smbase,            0xFF00);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(reserved4,         0xFF04);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(ssp,           0xFF18);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(svm_guest_pat,     0xFF20);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(svm_host_efer,     0xFF28);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(svm_host_cr4,      0xFF30);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(svm_host_cr3,      0xFF38);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(svm_host_cr0,      0xFF40);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(cr4,           0xFF48);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(cr3,           0xFF50);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(cr0,           0xFF58);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(dr7,           0xFF60);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(dr6,           0xFF68);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(rflags,            0xFF70);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(rip,           0xFF78);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a>(gprs,          0xFF80);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    BUILD_BUG_ON(<span class="keyword">sizeof</span>(<span class="keyword">union</span> kvm_smram) != 512);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div>
<div class="ttc" id="asmm_8c_html_a4744b0c85cabfb51a8651614b3d24068"><div class="ttname"><a href="smm_8c.html#a4744b0c85cabfb51a8651614b3d24068">CHECK_SMRAM32_OFFSET</a></div><div class="ttdeci">#define CHECK_SMRAM32_OFFSET(field, offset)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00012">smm.c:12</a></div></div>
<div class="ttc" id="asmm_8c_html_aa62e77eee225992050fc4a81084fdaa1"><div class="ttname"><a href="smm_8c.html#aa62e77eee225992050fc4a81084fdaa1">CHECK_SMRAM64_OFFSET</a></div><div class="ttdeci">#define CHECK_SMRAM64_OFFSET(field, offset)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00015">smm.c:15</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a7812ad37d9dd48c3fa0a85cad91e6241_icgraph.png" border="0" usemap="#asmm_8c_a7812ad37d9dd48c3fa0a85cad91e6241_icgraph" alt=""/></div>
<map name="asmm_8c_a7812ad37d9dd48c3fa0a85cad91e6241_icgraph" id="asmm_8c_a7812ad37d9dd48c3fa0a85cad91e6241_icgraph">
<area shape="rect" title=" " alt="" coords="1089,13,1253,39"/>
<area shape="rect" href="smm_8c.html#ae1445727a8459a6cc7d2e49e5a63c0d5" title=" " alt="" coords="945,13,1041,39"/>
<area shape="rect" href="x86_8c.html#a2b372d06c72b7d8c25e9004bb3a3fd3b" title=" " alt="" coords="727,5,897,47"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="541,13,679,39"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,13,493,39"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,13,364,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a0943012ff008c7999f582998f0f9167a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0943012ff008c7999f582998f0f9167a">&#9670;&nbsp;</a></span>emulator_leave_smm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int emulator_leave_smm </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structx86__emulate__ctxt.html">x86_emulate_ctxt</a> *&#160;</td>
          <td class="paramname"><em>ctxt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00571">571</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;{</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = ctxt-&gt;<a class="code" href="structx86__emulate__ctxt.html#ab957da78003b9336cb805fad802aa4fb">vcpu</a>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cr0;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keyword">union </span>kvm_smram smram;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    u64 smbase;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    smbase = vcpu-&gt;arch.smbase;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    ret = <a class="code" href="kvm__main_8c.html#ae63a6f386d39aff5ffc5645780018b7a">kvm_vcpu_read_guest</a>(vcpu, smbase + 0xfe00, smram.bytes, <span class="keyword">sizeof</span>(smram));</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">if</span> ((vcpu-&gt;arch.hflags &amp; HF_SMM_INSIDE_NMI_MASK) == 0)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        static_call(kvm_x86_set_nmi_mask)(vcpu, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <a class="code" href="smm_8c.html#a5382946234c910e05c6e2c09aff15713">kvm_smm_changed</a>(vcpu, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">     * Get back to real mode, to prepare a safe state in which to load</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">     * CR0/CR3/CR4/EFER.  It&#39;s all a bit more complicated if the vCPU</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">     * supports long mode.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9">guest_cpuid_has</a>(vcpu, X86_FEATURE_LM)) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keyword">struct </span>kvm_segment cs_desc;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cr4;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="comment">/* Zero CR4.PCIDE before CR0.PG.  */</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        cr4 = <a class="code" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba">kvm_read_cr4</a>(vcpu);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordflow">if</span> (cr4 &amp; X86_CR4_PCIDE)</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <a class="code" href="x86_8c.html#a39acca4a1624a86a5d8e547339729536">kvm_set_cr4</a>(vcpu, cr4 &amp; ~X86_CR4_PCIDE);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="comment">/* A 32-bit code segment is required to clear EFER.LMA.  */</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        memset(&amp;cs_desc, 0, <span class="keyword">sizeof</span>(cs_desc));</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        cs_desc.type = 0xb;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        cs_desc.s = cs_desc.g = cs_desc.present = 1;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <a class="code" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18">kvm_set_segment</a>(vcpu, &amp;cs_desc, VCPU_SREG_CS);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">/* For the 64-bit case, this will clear EFER.LMA.  */</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    cr0 = <a class="code" href="kvm__cache__regs_8h.html#a66188c5384cbd688acd880f8de16fbff">kvm_read_cr0</a>(vcpu);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">if</span> (cr0 &amp; X86_CR0_PE)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <a class="code" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4">kvm_set_cr0</a>(vcpu, cr0 &amp; ~(X86_CR0_PG | X86_CR0_PE));</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9">guest_cpuid_has</a>(vcpu, X86_FEATURE_LM)) {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cr4, efer;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160; </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="comment">/* Clear CR4.PAE before clearing EFER.LME. */</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        cr4 = <a class="code" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba">kvm_read_cr4</a>(vcpu);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keywordflow">if</span> (cr4 &amp; X86_CR4_PAE)</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            <a class="code" href="x86_8c.html#a39acca4a1624a86a5d8e547339729536">kvm_set_cr4</a>(vcpu, cr4 &amp; ~X86_CR4_PAE);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="comment">/* And finally go back to 32-bit mode.  */</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        efer = 0;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <a class="code" href="x86_8c.html#af472ca24da6c9cd65800b5fe67e4c506">kvm_set_msr</a>(vcpu, MSR_EFER, efer);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">     * Give leave_smm() a chance to make ISA-specific changes to the vCPU</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">     * state (e.g. enter guest mode) before loading state from the SMM</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">     * state-save area.</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">if</span> (static_call(kvm_x86_leave_smm)(vcpu, &amp;smram))</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9">guest_cpuid_has</a>(vcpu, X86_FEATURE_LM))</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">return</span> rsm_load_state_64(ctxt, &amp;smram.smram64);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="smm_8c.html#ae0136cd1aa193ad29565961ea839a99a">rsm_load_state_32</a>(ctxt, &amp;smram.smram32);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;}</div>
<div class="ttc" id="acpuid_8h_html_ad8c2a90f2f099af1d7ca23750d9d2eb9"><div class="ttname"><a href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9">guest_cpuid_has</a></div><div class="ttdeci">static __always_inline bool guest_cpuid_has(struct kvm_vcpu *vcpu, unsigned int x86_feature)</div><div class="ttdef"><b>Definition:</b> <a href="cpuid_8h_source.html#l00083">cpuid.h:83</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_a66188c5384cbd688acd880f8de16fbff"><div class="ttname"><a href="kvm__cache__regs_8h.html#a66188c5384cbd688acd880f8de16fbff">kvm_read_cr0</a></div><div class="ttdeci">static ulong kvm_read_cr0(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00168">kvm_cache_regs.h:168</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_ad479d598f0b5de90bd6062237ccb9eba"><div class="ttname"><a href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba">kvm_read_cr4</a></div><div class="ttdeci">static ulong kvm_read_cr4(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00197">kvm_cache_regs.h:197</a></div></div>
<div class="ttc" id="akvm__emulate_8h_html_a4370bae0613d80c5a2647f57f446a502"><div class="ttname"><a href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a></div><div class="ttdeci">#define X86EMUL_UNHANDLEABLE</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00083">kvm_emulate.h:83</a></div></div>
<div class="ttc" id="akvm__main_8c_html_ae63a6f386d39aff5ffc5645780018b7a"><div class="ttname"><a href="kvm__main_8c.html#ae63a6f386d39aff5ffc5645780018b7a">kvm_vcpu_read_guest</a></div><div class="ttdeci">int kvm_vcpu_read_guest(struct kvm_vcpu *vcpu, gpa_t gpa, void *data, unsigned long len)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03366">kvm_main.c:3366</a></div></div>
<div class="ttc" id="asmm_8c_html_a5382946234c910e05c6e2c09aff15713"><div class="ttname"><a href="smm_8c.html#a5382946234c910e05c6e2c09aff15713">kvm_smm_changed</a></div><div class="ttdeci">void kvm_smm_changed(struct kvm_vcpu *vcpu, bool entering_smm)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00112">smm.c:112</a></div></div>
<div class="ttc" id="asmm_8c_html_ae0136cd1aa193ad29565961ea839a99a"><div class="ttname"><a href="smm_8c.html#ae0136cd1aa193ad29565961ea839a99a">rsm_load_state_32</a></div><div class="ttdeci">static int rsm_load_state_32(struct x86_emulate_ctxt *ctxt, const struct kvm_smram_state_32 *smstate)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00466">smm.c:466</a></div></div>
<div class="ttc" id="astructx86__emulate__ctxt_html_ab957da78003b9336cb805fad802aa4fb"><div class="ttname"><a href="structx86__emulate__ctxt.html#ab957da78003b9336cb805fad802aa4fb">x86_emulate_ctxt::vcpu</a></div><div class="ttdeci">void * vcpu</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00308">kvm_emulate.h:308</a></div></div>
<div class="ttc" id="ax86_8c_html_a39acca4a1624a86a5d8e547339729536"><div class="ttname"><a href="x86_8c.html#a39acca4a1624a86a5d8e547339729536">kvm_set_cr4</a></div><div class="ttdeci">int kvm_set_cr4(struct kvm_vcpu *vcpu, unsigned long cr4)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l01192">x86.c:1192</a></div></div>
<div class="ttc" id="ax86_8c_html_a6818ed0db6dca9dc6dfc7b59963a0e18"><div class="ttname"><a href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18">kvm_set_segment</a></div><div class="ttdeci">void kvm_set_segment(struct kvm_vcpu *vcpu, struct kvm_segment *var, int seg)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l07456">x86.c:7456</a></div></div>
<div class="ttc" id="ax86_8c_html_aa9556b4ebb06617f66625ff73a3f56b4"><div class="ttname"><a href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4">kvm_set_cr0</a></div><div class="ttdeci">int kvm_set_cr0(struct kvm_vcpu *vcpu, unsigned long cr0)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l00971">x86.c:971</a></div></div>
<div class="ttc" id="ax86_8c_html_af472ca24da6c9cd65800b5fe67e4c506"><div class="ttname"><a href="x86_8c.html#af472ca24da6c9cd65800b5fe67e4c506">kvm_set_msr</a></div><div class="ttdeci">int kvm_set_msr(struct kvm_vcpu *vcpu, u32 index, u64 data)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l01987">x86.c:1987</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a0943012ff008c7999f582998f0f9167a_cgraph.png" border="0" usemap="#asmm_8c_a0943012ff008c7999f582998f0f9167a_cgraph" alt=""/></div>
<map name="asmm_8c_a0943012ff008c7999f582998f0f9167a_cgraph" id="asmm_8c_a0943012ff008c7999f582998f0f9167a_cgraph">
<area shape="rect" title=" " alt="" coords="5,738,169,765"/>
<area shape="rect" href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9" title=" " alt="" coords="236,198,367,225"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a66188c5384cbd688acd880f8de16fbff" title=" " alt="" coords="921,325,1035,351"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba" title=" " alt="" coords="921,941,1035,967"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="714,586,819,613"/>
<area shape="rect" href="x86_8c.html#a39acca4a1624a86a5d8e547339729536" title=" " alt="" coords="714,789,819,815"/>
<area shape="rect" href="x86_8c.html#af472ca24da6c9cd65800b5fe67e4c506" title=" " alt="" coords="246,1021,357,1047"/>
<area shape="rect" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18" title=" " alt="" coords="695,839,838,866"/>
<area shape="rect" href="smm_8c.html#a5382946234c910e05c6e2c09aff15713" title=" " alt="" coords="225,329,378,355"/>
<area shape="rect" href="kvm__main_8c.html#ae63a6f386d39aff5ffc5645780018b7a" title=" " alt="" coords="217,941,385,967"/>
<area shape="rect" href="smm_8c.html#ae0136cd1aa193ad29565961ea839a99a" title=" " alt="" coords="229,687,374,714"/>
<area shape="rect" href="reverse__cpuid_8h.html#aeac4cdaa1c8b53f46ea791f355b1d08c" title=" " alt="" coords="481,198,587,225"/>
<area shape="rect" href="cpuid_8h.html#af2af2645f203b5d9bad2088af0da5c1e" title=" " alt="" coords="441,97,627,123"/>
<area shape="rect" href="reverse__cpuid_8h.html#a76ac51b62ef170b755204cb8b958e585" title=" " alt="" coords="693,173,841,199"/>
<area shape="rect" href="reverse__cpuid_8h.html#ae10c1644e90cb8443e5a32554acfd700" title=" " alt="" coords="899,147,1057,174"/>
<area shape="rect" href="reverse__cpuid_8h.html#adf3299d46978c685ba9b46ebb1536680" title=" " alt="" coords="683,122,851,149"/>
<area shape="rect" href="cpuid_8h.html#a638557b30255883157acafa55a351d0d" title=" " alt="" coords="684,5,849,47"/>
<area shape="rect" href="reverse__cpuid_8h.html#a3f7e53c68e5610be44d760fd4854f892" title=" " alt="" coords="695,71,838,98"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="1360,687,1505,714"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1553,789,1747,815"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a24ffc81fe5ed7998e29134351275b4dd" title=" " alt="" coords="1360,789,1505,815"/>
<area shape="rect" href="x86_8h.html#ada9d5e605374059a5e34c42817ed5118" title=" " alt="" coords="916,637,1040,663"/>
<area shape="rect" href="x86_8h.html#abc2ffd79aced13c24f0c4143465d3d51" title=" " alt="" coords="946,586,1010,613"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65" title=" " alt="" coords="1135,586,1282,613"/>
<area shape="rect" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878" title=" " alt="" coords="936,687,1020,714"/>
<area shape="rect" href="x86_8c.html#a482306c58fa14c6da89a052965364037" title=" " alt="" coords="911,375,1045,402"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="908,477,1048,503"/>
<area shape="rect" href="kvm__cache__regs_8h.html#aa80de2ba11d877ef825788b0c9768378" title=" " alt="" coords="921,839,1035,866"/>
<area shape="rect" href="x86_8c.html#ae69bdd054a70a95d99b79bae770372cf" title=" " alt="" coords="929,789,1027,815"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="1153,637,1265,663"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="1135,687,1282,714"/>
<area shape="rect" href="x86_8c.html#ad850a917f349195334a4ef07b53ca379" title=" " alt="" coords="1111,302,1306,329"/>
<area shape="rect" href="x86_8h.html#adf8330176a8805826ed4711a51ce93cf" title=" " alt="" coords="1125,353,1292,379"/>
<area shape="rect" href="async__pf_8c.html#ad351bddfe80f107dfc95c6ab2768fe4f" title=" " alt="" coords="1131,404,1286,445"/>
<area shape="rect" href="mmu_8c.html#a88ade1c65bbbb9b25a78e82003a71a7c" title=" " alt="" coords="1373,201,1493,227"/>
<area shape="rect" href="mmu_8h.html#a11c275bc8cfad409c0681f0c953ebcae" title=" " alt="" coords="1115,469,1302,511"/>
<area shape="rect" href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f" title=" " alt="" coords="1115,150,1303,177"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="1132,535,1285,562"/>
<area shape="rect" href="mmu_8c.html#ab7d4e418cb85a72507e384df5027293e" title=" " alt="" coords="1126,738,1291,765"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a0f6830d8a03ec49d8ac457e2a9c1d687" title=" " alt="" coords="1115,789,1302,815"/>
<area shape="rect" href="mmu_8h.html#a937b5147c498fb7bdafb70240b735089" title=" " alt="" coords="1135,839,1282,866"/>
<area shape="rect" href="kvm__main_8c.html#adfef9b2c2d6359fd443d98f51be19605" title=" " alt="" coords="1105,991,1312,1018"/>
<area shape="rect" href="x86_8c.html#ad45419cfec5d4a35d1dd6778689061b7" title=" " alt="" coords="911,890,1045,917"/>
<area shape="rect" href="x86_8c.html#afb193fb2b1c3f240d0ad5a5378afc118" title=" " alt="" coords="908,426,1048,453"/>
<area shape="rect" href="x86_8c.html#a4a7acb17f522083e1a9edc95e3788295" title=" " alt="" coords="451,1043,617,1084"/>
<area shape="rect" href="kvm__main_8c.html#a03aae88de564edba8a3a2d10bc5e7b20" title=" " alt="" coords="477,941,591,967"/>
<area shape="rect" href="x86_8c.html#a0df3660fa575d077f3dd97de063e5215" title=" " alt="" coords="485,637,583,663"/>
<area shape="rect" href="kvm__emulate_8h.html#a6765223c3d699954a57bfb199c37130d" title=" " alt="" coords="493,687,575,714"/>
<area shape="rect" href="smm_8c.html#a0c50da2c4874eda6d67766974a476019" title=" " alt="" coords="433,586,635,613"/>
<area shape="rect" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4" title=" " alt="" coords="467,738,601,765"/>
</map>
</div>

</div>
</div>
<a id="ae1445727a8459a6cc7d2e49e5a63c0d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1445727a8459a6cc7d2e49e5a63c0d5">&#9670;&nbsp;</a></span>enter_smm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void enter_smm </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00281">281</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;{</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keyword">struct </span>kvm_segment cs, ds;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keyword">struct </span>desc_ptr dt;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cr0;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keyword">union </span>kvm_smram smram;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="smm_8c.html#a7812ad37d9dd48c3fa0a85cad91e6241">check_smram_offsets</a>();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    memset(smram.bytes, 0, <span class="keyword">sizeof</span>(smram.bytes));</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9">guest_cpuid_has</a>(vcpu, X86_FEATURE_LM))</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        enter_smm_save_state_64(vcpu, &amp;smram.smram64);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <a class="code" href="smm_8c.html#a441459cf488188fad0f4147293e000ec">enter_smm_save_state_32</a>(vcpu, &amp;smram.smram32);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">     * Give enter_smm() a chance to make ISA-specific changes to the vCPU</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">     * state (e.g. leave guest mode) after we&#39;ve saved the state into the</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">     * SMM state-save area.</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">     * Kill the VM in the unlikely case of failure, because the VM</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">     * can be in undefined state in this case.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (static_call(kvm_x86_enter_smm)(vcpu, &amp;smram))</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">goto</span> error;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="smm_8c.html#a5382946234c910e05c6e2c09aff15713">kvm_smm_changed</a>(vcpu, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kvm__main_8c.html#aff9f069d82daf13f02f262eaf6a23ca5">kvm_vcpu_write_guest</a>(vcpu, vcpu-&gt;arch.smbase + 0xfe00, &amp;smram, <span class="keyword">sizeof</span>(smram)))</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordflow">goto</span> error;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (static_call(kvm_x86_get_nmi_mask)(vcpu))</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        vcpu-&gt;arch.hflags |= HF_SMM_INSIDE_NMI_MASK;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        static_call(kvm_x86_set_nmi_mask)(vcpu, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="x86_8c.html#a12826c3f941e4dbf381d4d085ce42110">kvm_set_rflags</a>(vcpu, X86_EFLAGS_FIXED);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="kvm__cache__regs_8h.html#aa70071fd3a98f236b0b57a30cbec124f">kvm_rip_write</a>(vcpu, 0x8000);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    static_call(kvm_x86_set_interrupt_shadow)(vcpu, 0);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    cr0 = vcpu-&gt;arch.cr0 &amp; ~(X86_CR0_PE | X86_CR0_EM | X86_CR0_TS | X86_CR0_PG);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    static_call(kvm_x86_set_cr0)(vcpu, cr0);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    static_call(kvm_x86_set_cr4)(vcpu, 0);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">/* Undocumented: IDT limit is set to zero on entry to SMM.  */</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    dt.address = dt.size = 0;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    static_call(kvm_x86_set_idt)(vcpu, &amp;dt);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (WARN_ON_ONCE(<a class="code" href="x86_8c.html#a0df3660fa575d077f3dd97de063e5215">kvm_set_dr</a>(vcpu, 7, DR7_FIXED_1)))</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">goto</span> error;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    cs.selector = (vcpu-&gt;arch.smbase &gt;&gt; 4) &amp; 0xffff;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    cs.base = vcpu-&gt;arch.smbase;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    ds.selector = 0;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    ds.base = 0;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    cs.limit    = ds.limit = 0xffffffff;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    cs.type     = ds.type = 0x3;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    cs.dpl      = ds.dpl = 0;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    cs.db       = ds.db = 0;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    cs.s        = ds.s = 1;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    cs.l        = ds.l = 0;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    cs.g        = ds.g = 1;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    cs.avl      = ds.avl = 0;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    cs.present  = ds.present = 1;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    cs.unusable = ds.unusable = 0;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    cs.padding  = ds.padding = 0;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18">kvm_set_segment</a>(vcpu, &amp;cs, VCPU_SREG_CS);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <a class="code" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18">kvm_set_segment</a>(vcpu, &amp;ds, VCPU_SREG_DS);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18">kvm_set_segment</a>(vcpu, &amp;ds, VCPU_SREG_ES);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18">kvm_set_segment</a>(vcpu, &amp;ds, VCPU_SREG_FS);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <a class="code" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18">kvm_set_segment</a>(vcpu, &amp;ds, VCPU_SREG_GS);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18">kvm_set_segment</a>(vcpu, &amp;ds, VCPU_SREG_SS);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9">guest_cpuid_has</a>(vcpu, X86_FEATURE_LM))</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordflow">if</span> (static_call(kvm_x86_set_efer)(vcpu, 0))</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="keywordflow">goto</span> error;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="cpuid_8c.html#a537512099e11c7ab0553aeae5e38d9ea">kvm_update_cpuid_runtime</a>(vcpu);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f">kvm_mmu_reset_context</a>(vcpu);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;error:</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    kvm_vm_dead(vcpu-&gt;kvm);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;}</div>
<div class="ttc" id="acpuid_8c_html_a537512099e11c7ab0553aeae5e38d9ea"><div class="ttname"><a href="cpuid_8c.html#a537512099e11c7ab0553aeae5e38d9ea">kvm_update_cpuid_runtime</a></div><div class="ttdeci">void kvm_update_cpuid_runtime(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="cpuid_8c_source.html#l00309">cpuid.c:309</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_aa70071fd3a98f236b0b57a30cbec124f"><div class="ttname"><a href="kvm__cache__regs_8h.html#aa70071fd3a98f236b0b57a30cbec124f">kvm_rip_write</a></div><div class="ttdeci">static void kvm_rip_write(struct kvm_vcpu *vcpu, unsigned long val)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00121">kvm_cache_regs.h:121</a></div></div>
<div class="ttc" id="akvm__main_8c_html_aff9f069d82daf13f02f262eaf6a23ca5"><div class="ttname"><a href="kvm__main_8c.html#aff9f069d82daf13f02f262eaf6a23ca5">kvm_vcpu_write_guest</a></div><div class="ttdeci">int kvm_vcpu_write_guest(struct kvm_vcpu *vcpu, gpa_t gpa, const void *data, unsigned long len)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03470">kvm_main.c:3470</a></div></div>
<div class="ttc" id="ammu_8c_html_a56f1568115a55fdacc188e9b41159b8f"><div class="ttname"><a href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f">kvm_mmu_reset_context</a></div><div class="ttdeci">void kvm_mmu_reset_context(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l05581">mmu.c:5581</a></div></div>
<div class="ttc" id="asmm_8c_html_a441459cf488188fad0f4147293e000ec"><div class="ttname"><a href="smm_8c.html#a441459cf488188fad0f4147293e000ec">enter_smm_save_state_32</a></div><div class="ttdeci">static void enter_smm_save_state_32(struct kvm_vcpu *vcpu, struct kvm_smram_state_32 *smram)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00183">smm.c:183</a></div></div>
<div class="ttc" id="asmm_8c_html_a7812ad37d9dd48c3fa0a85cad91e6241"><div class="ttname"><a href="smm_8c.html#a7812ad37d9dd48c3fa0a85cad91e6241">check_smram_offsets</a></div><div class="ttdeci">static void check_smram_offsets(void)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00018">smm.c:18</a></div></div>
<div class="ttc" id="ax86_8c_html_a0df3660fa575d077f3dd97de063e5215"><div class="ttname"><a href="x86_8c.html#a0df3660fa575d077f3dd97de063e5215">kvm_set_dr</a></div><div class="ttdeci">int kvm_set_dr(struct kvm_vcpu *vcpu, int dr, unsigned long val)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l01373">x86.c:1373</a></div></div>
<div class="ttc" id="ax86_8c_html_a12826c3f941e4dbf381d4d085ce42110"><div class="ttname"><a href="x86_8c.html#a12826c3f941e4dbf381d4d085ce42110">kvm_set_rflags</a></div><div class="ttdeci">void kvm_set_rflags(struct kvm_vcpu *vcpu, unsigned long rflags)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l13189">x86.c:13189</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_ae1445727a8459a6cc7d2e49e5a63c0d5_cgraph.png" border="0" usemap="#asmm_8c_ae1445727a8459a6cc7d2e49e5a63c0d5_cgraph" alt=""/></div>
<map name="asmm_8c_ae1445727a8459a6cc7d2e49e5a63c0d5_cgraph" id="asmm_8c_ae1445727a8459a6cc7d2e49e5a63c0d5_cgraph">
<area shape="rect" title=" " alt="" coords="5,703,101,730"/>
<area shape="rect" href="smm_8c.html#a7812ad37d9dd48c3fa0a85cad91e6241" title=" " alt="" coords="169,197,333,223"/>
<area shape="rect" href="smm_8c.html#a441459cf488188fad0f4147293e000ec" title=" " alt="" coords="152,247,349,274"/>
<area shape="rect" href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9" title=" " alt="" coords="687,489,818,515"/>
<area shape="rect" href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f" title=" " alt="" coords="411,729,599,755"/>
<area shape="rect" href="kvm__cache__regs_8h.html#aa70071fd3a98f236b0b57a30cbec124f" title=" " alt="" coords="193,475,308,502"/>
<area shape="rect" href="x86_8c.html#a0df3660fa575d077f3dd97de063e5215" title=" " alt="" coords="201,577,300,603"/>
<area shape="rect" href="x86_8c.html#a12826c3f941e4dbf381d4d085ce42110" title=" " alt="" coords="190,855,311,882"/>
<area shape="rect" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18" title=" " alt="" coords="179,805,322,831"/>
<area shape="rect" href="smm_8c.html#a5382946234c910e05c6e2c09aff15713" title=" " alt="" coords="174,703,327,730"/>
<area shape="rect" href="cpuid_8c.html#a537512099e11c7ab0553aeae5e38d9ea" title=" " alt="" coords="149,906,352,933"/>
<area shape="rect" href="kvm__main_8c.html#aff9f069d82daf13f02f262eaf6a23ca5" title=" " alt="" coords="165,965,337,991"/>
<area shape="rect" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027" title=" " alt="" coords="412,121,599,147"/>
<area shape="rect" href="x86_8c.html#ab7339348823eb8883ba0bd2c98d827d3" title=" " alt="" coords="456,222,555,249"/>
<area shape="rect" href="x86_8c.html#aeca964de04721f39e3ec34f195707b5c" title=" " alt="" coords="444,273,567,299"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a66188c5384cbd688acd880f8de16fbff" title=" " alt="" coords="448,374,563,401"/>
<area shape="rect" href="kvm__cache__regs_8h.html#aa80de2ba11d877ef825788b0c9768378" title=" " alt="" coords="695,19,810,46"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba" title=" " alt="" coords="448,70,563,97"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5d9eb0563cffb1e3ed1cccebabcf2df6" title=" " alt="" coords="665,238,840,265"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad97ff6b975b461b815e6749d29c65446" title=" " alt="" coords="450,171,561,198"/>
<area shape="rect" href="smm_8c.html#a0e93139a6ea69860969bd5bd0fcb5de5" title=" " alt="" coords="659,172,847,213"/>
<area shape="rect" href="x86_8c.html#a50008deef9c4ea0555bf2d6294cd9813" title=" " alt="" coords="681,121,824,147"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="680,331,825,358"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="895,154,1088,181"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a24ffc81fe5ed7998e29134351275b4dd" title=" " alt="" coords="680,70,825,97"/>
<area shape="rect" href="reverse__cpuid_8h.html#aeac4cdaa1c8b53f46ea791f355b1d08c" title=" " alt="" coords="938,434,1045,461"/>
<area shape="rect" href="cpuid_8h.html#af2af2645f203b5d9bad2088af0da5c1e" title=" " alt="" coords="899,514,1084,541"/>
<area shape="rect" href="reverse__cpuid_8h.html#a76ac51b62ef170b755204cb8b958e585" title=" " alt="" coords="1146,383,1294,410"/>
<area shape="rect" href="reverse__cpuid_8h.html#ae10c1644e90cb8443e5a32554acfd700" title=" " alt="" coords="1352,459,1511,486"/>
<area shape="rect" href="reverse__cpuid_8h.html#adf3299d46978c685ba9b46ebb1536680" title=" " alt="" coords="1136,602,1304,629"/>
<area shape="rect" href="cpuid_8h.html#a638557b30255883157acafa55a351d0d" title=" " alt="" coords="1137,536,1303,577"/>
<area shape="rect" href="reverse__cpuid_8h.html#a3f7e53c68e5610be44d760fd4854f892" title=" " alt="" coords="1149,485,1291,511"/>
<area shape="rect" href="mmu_8c.html#a88ade1c65bbbb9b25a78e82003a71a7c" title=" " alt="" coords="693,818,813,845"/>
<area shape="rect" href="mmu_8c.html#a7bf770a114656f992dd1c0aff57fe9e5" title=" " alt="" coords="681,717,824,743"/>
<area shape="rect" href="mmu_8c.html#a8a6a76a1ef24ce48ce2378ac59cf5b20" title=" " alt="" coords="906,869,1077,895"/>
<area shape="rect" href="mmu_8c.html#a37d0224d142272ad59fd35b4a22c5937" title=" " alt="" coords="919,919,1063,946"/>
<area shape="rect" href="mmu_8c.html#a2346100ce00fd4d842c51c4be6cbfe35" title=" " alt="" coords="917,970,1065,997"/>
<area shape="rect" href="mmu_8c.html#a39c690691d8b166be323cb09d89be57d" title=" " alt="" coords="918,717,1065,743"/>
<area shape="rect" href="x86_8h.html#a661bc84e256a87cbd929ffb7c1f61b2f" title=" " alt="" coords="929,767,1054,794"/>
<area shape="rect" href="mmu_8c.html#abef7a85395cc30529b7306fb12566ecd" title=" " alt="" coords="921,818,1061,845"/>
<area shape="rect" href="mmu_8c.html#ab7d4e418cb85a72507e384df5027293e" title=" " alt="" coords="909,666,1074,693"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5117377174dc7ebf722e4976c0ae736b" title=" " alt="" coords="416,425,595,451"/>
<area shape="rect" href="x86_8c.html#a2aeff0b787a2133f4809c6a94c6458d7" title=" " alt="" coords="447,475,564,502"/>
<area shape="rect" href="x86_8h.html#a401b9fcb1381d2fbfc488f8520093cee" title=" " alt="" coords="446,526,565,553"/>
<area shape="rect" href="x86_8h.html#a6d86e9ee10c2cd72b82aef25cabafd82" title=" " alt="" coords="446,577,565,603"/>
<area shape="rect" href="x86_8c.html#afed36c545d27cca59caddf31fdfd054a" title=" " alt="" coords="440,627,571,654"/>
<area shape="rect" href="x86_8c.html#a02687f1819d3a24cafdda1660be6ec9b" title=" " alt="" coords="438,847,573,874"/>
<area shape="rect" href="cpuid_8c.html#aba2a2f99dbe3b8848b6ffc19effa6294" title=" " alt="" coords="426,899,585,940"/>
<area shape="rect" href="kvm__main_8c.html#a11bfd7eb429f6121f6999a8a404eac33" title=" " alt="" coords="400,1015,611,1042"/>
<area shape="rect" href="kvm__main_8c.html#a03aae88de564edba8a3a2d10bc5e7b20" title=" " alt="" coords="448,965,563,991"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_ae1445727a8459a6cc7d2e49e5a63c0d5_icgraph.png" border="0" usemap="#asmm_8c_ae1445727a8459a6cc7d2e49e5a63c0d5_icgraph" alt=""/></div>
<map name="asmm_8c_ae1445727a8459a6cc7d2e49e5a63c0d5_icgraph" id="asmm_8c_ae1445727a8459a6cc7d2e49e5a63c0d5_icgraph">
<area shape="rect" title=" " alt="" coords="945,13,1041,39"/>
<area shape="rect" href="x86_8c.html#a2b372d06c72b7d8c25e9004bb3a3fd3b" title=" " alt="" coords="727,5,897,47"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="541,13,679,39"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,13,493,39"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,13,364,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a0e93139a6ea69860969bd5bd0fcb5de5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e93139a6ea69860969bd5bd0fcb5de5">&#9670;&nbsp;</a></span>enter_smm_get_segment_flags()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u32 enter_smm_get_segment_flags </td>
          <td>(</td>
          <td class="paramtype">struct kvm_segment *&#160;</td>
          <td class="paramname"><em>seg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00141">141</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    u32 <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> = 0;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= seg-&gt;g       &lt;&lt; 23;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= seg-&gt;db      &lt;&lt; 22;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= seg-&gt;l       &lt;&lt; 21;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= seg-&gt;avl     &lt;&lt; 20;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= seg-&gt;present &lt;&lt; 15;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= seg-&gt;dpl     &lt;&lt; 13;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= seg-&gt;s       &lt;&lt; 12;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> |= seg-&gt;type    &lt;&lt; 8;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_a773b39d480759f67926cb18ae2219281"><div class="ttname"><a href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a></div><div class="ttdeci">uint32_t flags</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00001">xen.c:1</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a0e93139a6ea69860969bd5bd0fcb5de5_icgraph.png" border="0" usemap="#asmm_8c_a0e93139a6ea69860969bd5bd0fcb5de5_icgraph" alt=""/></div>
<map name="asmm_8c_a0e93139a6ea69860969bd5bd0fcb5de5_icgraph" id="asmm_8c_a0e93139a6ea69860969bd5bd0fcb5de5_icgraph">
<area shape="rect" title=" " alt="" coords="1569,5,1757,47"/>
<area shape="rect" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027" title=" " alt="" coords="1335,13,1521,39"/>
<area shape="rect" href="smm_8c.html#a441459cf488188fad0f4147293e000ec" title=" " alt="" coords="1089,13,1287,39"/>
<area shape="rect" href="smm_8c.html#ae1445727a8459a6cc7d2e49e5a63c0d5" title=" " alt="" coords="945,13,1041,39"/>
<area shape="rect" href="x86_8c.html#a2b372d06c72b7d8c25e9004bb3a3fd3b" title=" " alt="" coords="727,5,897,47"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="541,13,679,39"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,13,493,39"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,13,364,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a194dfeabd35eaaf3f958a037fe4dc027"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a194dfeabd35eaaf3f958a037fe4dc027">&#9670;&nbsp;</a></span>enter_smm_save_seg_32()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void enter_smm_save_seg_32 </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_smm_seg_state_32 *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32 *&#160;</td>
          <td class="paramname"><em>selector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00155">155</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;{</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keyword">struct </span>kvm_segment seg;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="x86_8c.html#a50008deef9c4ea0555bf2d6294cd9813">kvm_get_segment</a>(vcpu, &amp;seg, n);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    *selector = seg.selector;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>-&gt;base = seg.base;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>-&gt;limit = seg.limit;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>-&gt;flags = <a class="code" href="smm_8c.html#a0e93139a6ea69860969bd5bd0fcb5de5">enter_smm_get_segment_flags</a>(&amp;seg);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;}</div>
<div class="ttc" id="asmm_8c_html_a0e93139a6ea69860969bd5bd0fcb5de5"><div class="ttname"><a href="smm_8c.html#a0e93139a6ea69860969bd5bd0fcb5de5">enter_smm_get_segment_flags</a></div><div class="ttdeci">static u32 enter_smm_get_segment_flags(struct kvm_segment *seg)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00141">smm.c:141</a></div></div>
<div class="ttc" id="ax86_8c_html_a50008deef9c4ea0555bf2d6294cd9813"><div class="ttname"><a href="x86_8c.html#a50008deef9c4ea0555bf2d6294cd9813">kvm_get_segment</a></div><div class="ttdeci">void kvm_get_segment(struct kvm_vcpu *vcpu, struct kvm_segment *var, int seg)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l07462">x86.c:7462</a></div></div>
<div class="ttc" id="axen_8h_html_a89f234133d3efe315836311cbf21c64b"><div class="ttname"><a href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a></div><div class="ttdeci">int state</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00000">xen.h:0</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a194dfeabd35eaaf3f958a037fe4dc027_cgraph.png" border="0" usemap="#asmm_8c_a194dfeabd35eaaf3f958a037fe4dc027_cgraph" alt=""/></div>
<map name="asmm_8c_a194dfeabd35eaaf3f958a037fe4dc027_cgraph" id="asmm_8c_a194dfeabd35eaaf3f958a037fe4dc027_cgraph">
<area shape="rect" title=" " alt="" coords="5,42,192,69"/>
<area shape="rect" href="smm_8c.html#a0e93139a6ea69860969bd5bd0fcb5de5" title=" " alt="" coords="240,5,428,47"/>
<area shape="rect" href="x86_8c.html#a50008deef9c4ea0555bf2d6294cd9813" title=" " alt="" coords="263,71,405,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a194dfeabd35eaaf3f958a037fe4dc027_icgraph.png" border="0" usemap="#asmm_8c_a194dfeabd35eaaf3f958a037fe4dc027_icgraph" alt=""/></div>
<map name="asmm_8c_a194dfeabd35eaaf3f958a037fe4dc027_icgraph" id="asmm_8c_a194dfeabd35eaaf3f958a037fe4dc027_icgraph">
<area shape="rect" title=" " alt="" coords="1335,13,1521,39"/>
<area shape="rect" href="smm_8c.html#a441459cf488188fad0f4147293e000ec" title=" " alt="" coords="1089,13,1287,39"/>
<area shape="rect" href="smm_8c.html#ae1445727a8459a6cc7d2e49e5a63c0d5" title=" " alt="" coords="945,13,1041,39"/>
<area shape="rect" href="x86_8c.html#a2b372d06c72b7d8c25e9004bb3a3fd3b" title=" " alt="" coords="727,5,897,47"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="541,13,679,39"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,13,493,39"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,13,364,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a441459cf488188fad0f4147293e000ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a441459cf488188fad0f4147293e000ec">&#9670;&nbsp;</a></span>enter_smm_save_state_32()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void enter_smm_save_state_32 </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_smram_state_32 *&#160;</td>
          <td class="paramname"><em>smram</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00183">183</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;{</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">struct </span>desc_ptr dt;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> val;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    smram-&gt;cr0     = <a class="code" href="kvm__cache__regs_8h.html#a66188c5384cbd688acd880f8de16fbff">kvm_read_cr0</a>(vcpu);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    smram-&gt;cr3     = <a class="code" href="kvm__cache__regs_8h.html#aa80de2ba11d877ef825788b0c9768378">kvm_read_cr3</a>(vcpu);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    smram-&gt;eflags  = <a class="code" href="x86_8c.html#aeca964de04721f39e3ec34f195707b5c">kvm_get_rflags</a>(vcpu);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    smram-&gt;eip     = <a class="code" href="kvm__cache__regs_8h.html#ad97ff6b975b461b815e6749d29c65446">kvm_rip_read</a>(vcpu);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; 8; i++)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        smram-&gt;gprs[i] = <a class="code" href="kvm__cache__regs_8h.html#a5d9eb0563cffb1e3ed1cccebabcf2df6">kvm_register_read_raw</a>(vcpu, i);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="x86_8c.html#ab7339348823eb8883ba0bd2c98d827d3">kvm_get_dr</a>(vcpu, 6, &amp;val);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    smram-&gt;dr6     = (u32)val;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="x86_8c.html#ab7339348823eb8883ba0bd2c98d827d3">kvm_get_dr</a>(vcpu, 7, &amp;val);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    smram-&gt;dr7     = (u32)val;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a>(vcpu, &amp;smram-&gt;tr, &amp;smram-&gt;tr_sel, VCPU_SREG_TR);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a>(vcpu, &amp;smram-&gt;ldtr, &amp;smram-&gt;ldtr_sel, VCPU_SREG_LDTR);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    static_call(kvm_x86_get_gdt)(vcpu, &amp;dt);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    smram-&gt;gdtr.base = dt.address;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    smram-&gt;gdtr.limit = dt.size;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    static_call(kvm_x86_get_idt)(vcpu, &amp;dt);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    smram-&gt;idtr.base = dt.address;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    smram-&gt;idtr.limit = dt.size;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a>(vcpu, &amp;smram-&gt;es, &amp;smram-&gt;es_sel, VCPU_SREG_ES);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <a class="code" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a>(vcpu, &amp;smram-&gt;cs, &amp;smram-&gt;cs_sel, VCPU_SREG_CS);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a>(vcpu, &amp;smram-&gt;ss, &amp;smram-&gt;ss_sel, VCPU_SREG_SS);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a>(vcpu, &amp;smram-&gt;ds, &amp;smram-&gt;ds_sel, VCPU_SREG_DS);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a>(vcpu, &amp;smram-&gt;fs, &amp;smram-&gt;fs_sel, VCPU_SREG_FS);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a>(vcpu, &amp;smram-&gt;gs, &amp;smram-&gt;gs_sel, VCPU_SREG_GS);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    smram-&gt;cr4 = <a class="code" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba">kvm_read_cr4</a>(vcpu);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    smram-&gt;smm_revision = 0x00020000;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    smram-&gt;smbase = vcpu-&gt;arch.smbase;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    smram-&gt;int_shadow = static_call(kvm_x86_get_interrupt_shadow)(vcpu);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;}</div>
<div class="ttc" id="akvm__cache__regs_8h_html_a5d9eb0563cffb1e3ed1cccebabcf2df6"><div class="ttname"><a href="kvm__cache__regs_8h.html#a5d9eb0563cffb1e3ed1cccebabcf2df6">kvm_register_read_raw</a></div><div class="ttdeci">static unsigned long kvm_register_read_raw(struct kvm_vcpu *vcpu, int reg)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00095">kvm_cache_regs.h:95</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_aa80de2ba11d877ef825788b0c9768378"><div class="ttname"><a href="kvm__cache__regs_8h.html#aa80de2ba11d877ef825788b0c9768378">kvm_read_cr3</a></div><div class="ttdeci">static ulong kvm_read_cr3(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00190">kvm_cache_regs.h:190</a></div></div>
<div class="ttc" id="akvm__cache__regs_8h_html_ad97ff6b975b461b815e6749d29c65446"><div class="ttname"><a href="kvm__cache__regs_8h.html#ad97ff6b975b461b815e6749d29c65446">kvm_rip_read</a></div><div class="ttdeci">static unsigned long kvm_rip_read(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__cache__regs_8h_source.html#l00116">kvm_cache_regs.h:116</a></div></div>
<div class="ttc" id="asmm_8c_html_a194dfeabd35eaaf3f958a037fe4dc027"><div class="ttname"><a href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027">enter_smm_save_seg_32</a></div><div class="ttdeci">static void enter_smm_save_seg_32(struct kvm_vcpu *vcpu, struct kvm_smm_seg_state_32 *state, u32 *selector, int n)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00155">smm.c:155</a></div></div>
<div class="ttc" id="ax86_8c_html_ab7339348823eb8883ba0bd2c98d827d3"><div class="ttname"><a href="x86_8c.html#ab7339348823eb8883ba0bd2c98d827d3">kvm_get_dr</a></div><div class="ttdeci">void kvm_get_dr(struct kvm_vcpu *vcpu, int dr, unsigned long *val)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l01402">x86.c:1402</a></div></div>
<div class="ttc" id="ax86_8c_html_aeca964de04721f39e3ec34f195707b5c"><div class="ttname"><a href="x86_8c.html#aeca964de04721f39e3ec34f195707b5c">kvm_get_rflags</a></div><div class="ttdeci">unsigned long kvm_get_rflags(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l13170">x86.c:13170</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a441459cf488188fad0f4147293e000ec_cgraph.png" border="0" usemap="#asmm_8c_a441459cf488188fad0f4147293e000ec_cgraph" alt=""/></div>
<map name="asmm_8c_a441459cf488188fad0f4147293e000ec_cgraph" id="asmm_8c_a441459cf488188fad0f4147293e000ec_cgraph">
<area shape="rect" title=" " alt="" coords="5,219,203,246"/>
<area shape="rect" href="smm_8c.html#a194dfeabd35eaaf3f958a037fe4dc027" title=" " alt="" coords="251,42,437,69"/>
<area shape="rect" href="x86_8c.html#ab7339348823eb8883ba0bd2c98d827d3" title=" " alt="" coords="295,93,393,119"/>
<area shape="rect" href="x86_8c.html#aeca964de04721f39e3ec34f195707b5c" title=" " alt="" coords="283,143,405,170"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a66188c5384cbd688acd880f8de16fbff" title=" " alt="" coords="287,194,401,221"/>
<area shape="rect" href="kvm__cache__regs_8h.html#aa80de2ba11d877ef825788b0c9768378" title=" " alt="" coords="522,245,637,271"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba" title=" " alt="" coords="287,295,401,322"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5d9eb0563cffb1e3ed1cccebabcf2df6" title=" " alt="" coords="492,346,667,373"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad97ff6b975b461b815e6749d29c65446" title=" " alt="" coords="289,397,399,423"/>
<area shape="rect" href="smm_8c.html#a0e93139a6ea69860969bd5bd0fcb5de5" title=" " alt="" coords="485,5,673,47"/>
<area shape="rect" href="x86_8c.html#a50008deef9c4ea0555bf2d6294cd9813" title=" " alt="" coords="508,71,651,98"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="507,194,652,221"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="721,270,915,297"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a24ffc81fe5ed7998e29134351275b4dd" title=" " alt="" coords="507,295,652,322"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a441459cf488188fad0f4147293e000ec_icgraph.png" border="0" usemap="#asmm_8c_a441459cf488188fad0f4147293e000ec_icgraph" alt=""/></div>
<map name="asmm_8c_a441459cf488188fad0f4147293e000ec_icgraph" id="asmm_8c_a441459cf488188fad0f4147293e000ec_icgraph">
<area shape="rect" title=" " alt="" coords="1089,13,1287,39"/>
<area shape="rect" href="smm_8c.html#ae1445727a8459a6cc7d2e49e5a63c0d5" title=" " alt="" coords="945,13,1041,39"/>
<area shape="rect" href="x86_8c.html#a2b372d06c72b7d8c25e9004bb3a3fd3b" title=" " alt="" coords="727,5,897,47"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="541,13,679,39"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,13,493,39"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,13,364,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a5382946234c910e05c6e2c09aff15713"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5382946234c910e05c6e2c09aff15713">&#9670;&nbsp;</a></span>kvm_smm_changed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_smm_changed </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>entering_smm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00112">112</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;{</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    trace_kvm_smm_transition(vcpu-&gt;vcpu_id, vcpu-&gt;arch.smbase, entering_smm);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">if</span> (entering_smm) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        vcpu-&gt;arch.hflags |= HF_SMM_MASK;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        vcpu-&gt;arch.hflags &amp;= ~(HF_SMM_MASK | HF_SMM_INSIDE_NMI_MASK);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="comment">/* Process a latched INIT or SMI, if any.  */</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        kvm_make_request(KVM_REQ_EVENT, vcpu);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">         * Even if KVM_SET_SREGS2 loaded PDPTRs out of band,</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">         * on SMM exit we still need to reload them from</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">         * guest memory</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        vcpu-&gt;arch.pdptrs_from_userspace = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f">kvm_mmu_reset_context</a>(vcpu);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a5382946234c910e05c6e2c09aff15713_cgraph.png" border="0" usemap="#asmm_8c_a5382946234c910e05c6e2c09aff15713_cgraph" alt=""/></div>
<map name="asmm_8c_a5382946234c910e05c6e2c09aff15713_cgraph" id="asmm_8c_a5382946234c910e05c6e2c09aff15713_cgraph">
<area shape="rect" title=" " alt="" coords="5,829,159,856"/>
<area shape="rect" href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f" title=" " alt="" coords="207,829,395,856"/>
<area shape="rect" href="mmu_8c.html#a88ade1c65bbbb9b25a78e82003a71a7c" title=" " alt="" coords="454,427,574,453"/>
<area shape="rect" href="mmu_8c.html#a7bf770a114656f992dd1c0aff57fe9e5" title=" " alt="" coords="443,1207,585,1233"/>
<area shape="rect" href="mmu_8c.html#a8a6a76a1ef24ce48ce2378ac59cf5b20" title=" " alt="" coords="633,376,804,403"/>
<area shape="rect" href="mmu_8c.html#a37d0224d142272ad59fd35b4a22c5937" title=" " alt="" coords="647,427,791,453"/>
<area shape="rect" href="mmu_8c.html#a2346100ce00fd4d842c51c4be6cbfe35" title=" " alt="" coords="645,503,793,529"/>
<area shape="rect" href="mmu_8c.html#a39c690691d8b166be323cb09d89be57d" title=" " alt="" coords="645,553,792,580"/>
<area shape="rect" href="x86_8h.html#a661bc84e256a87cbd929ffb7c1f61b2f" title=" " alt="" coords="656,275,781,301"/>
<area shape="rect" href="mmu_8c.html#abef7a85395cc30529b7306fb12566ecd" title=" " alt="" coords="649,325,789,352"/>
<area shape="rect" href="mmu_8c.html#ad46ec95426c3d1db277984090f2ecbd1" title=" " alt="" coords="905,427,1018,453"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="905,5,1017,32"/>
<area shape="rect" href="x86_8h.html#abc2ffd79aced13c24f0c4143465d3d51" title=" " alt="" coords="929,56,993,83"/>
<area shape="rect" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878" title=" " alt="" coords="919,107,1003,133"/>
<area shape="rect" href="x86_8c.html#a868acd995069b75c021828d8990ce659" title=" " alt="" coords="876,376,1047,403"/>
<area shape="rect" href="kvm__cache__regs_8h.html#af767224dbef857e41165cd41a18e0c7d" title=" " alt="" coords="897,325,1025,352"/>
<area shape="rect" href="mmu_8c.html#a2484adc402a0dc25cf9978152a678b00" title=" " alt="" coords="875,477,1047,504"/>
<area shape="rect" href="mmu_8c.html#ac7b31af26c029f185ab41ed060228847" title=" " alt="" coords="1391,517,1540,558"/>
<area shape="rect" href="kvm__cache__regs_8h.html#aa80de2ba11d877ef825788b0c9768378" title=" " alt="" coords="1161,427,1275,453"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1369,317,1562,344"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65" title=" " alt="" coords="1145,56,1291,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="1145,107,1291,133"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="1158,259,1278,285"/>
<area shape="rect" href="x86_8c.html#a25ebb513e6e81d17277fadec1597835a" title=" " alt="" coords="1119,309,1317,336"/>
<area shape="rect" href="x86_8c.html#a28de704e0172e28f1f108b20d606458b" title=" " alt="" coords="1133,361,1303,402"/>
<area shape="rect" href="mmu_8h.html#a937b5147c498fb7bdafb70240b735089" title=" " alt="" coords="1145,477,1291,504"/>
<area shape="rect" href="mmu_8c.html#acf22177805abdc960c48327675111025" title=" " alt="" coords="1679,625,1762,652"/>
<area shape="rect" href="mmu_8c.html#a7c03a09eaa19dd03710b5221a58f49db" title=" " alt="" coords="1613,575,1828,601"/>
<area shape="rect" href="mmu_8c.html#a2e6bb9bbf6a14b07e8c12c8926547c04" title=" " alt="" coords="1617,473,1824,500"/>
<area shape="rect" href="mmu_8c.html#aa8502cc81aa39d5c4631d6208ce15732" title=" " alt="" coords="1639,524,1802,551"/>
<area shape="rect" href="mmu_8c.html#aca62a749439306019073c5d5e04fe3e9" title=" " alt="" coords="1876,655,2061,681"/>
<area shape="rect" href="mmu_8c.html#a3e794d802eeb843cd6d7b699b74d8bf3" title=" " alt="" coords="873,579,1050,605"/>
<area shape="rect" href="mmu_8c.html#abd9285ed33f21279b97f214287ab49bf" title=" " alt="" coords="1119,579,1317,605"/>
<area shape="rect" href="mmu_8c.html#ab10aac90278ac25bf40eccc8b199e407" title=" " alt="" coords="1420,633,1511,660"/>
<area shape="rect" href="mmu_8c.html#a07ee66bdf73e200ebc9bbf56be2ebe35" title=" " alt="" coords="868,1047,1055,1089"/>
<area shape="rect" href="mmu_8c.html#a4bd7a8fd81e65c4e06e025d92c5787d9" title=" " alt="" coords="884,819,1039,845"/>
<area shape="rect" href="mmu_8c.html#aa07388cb60927549be1da4ea8e2bea60" title=" " alt="" coords="874,630,1049,671"/>
<area shape="rect" href="cpuid_8h.html#a1678e00b10264045277c1abfcb6eec3e" title=" " alt="" coords="1145,1080,1291,1107"/>
<area shape="rect" href="mmu_8c.html#aebe1e577e70e9f77f0bfea48bab7c83d" title=" " alt="" coords="1151,1029,1285,1056"/>
<area shape="rect" href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5" title=" " alt="" coords="1143,877,1293,904"/>
<area shape="rect" href="mmu_8h.html#a11c275bc8cfad409c0681f0c953ebcae" title=" " alt="" coords="1125,746,1311,787"/>
<area shape="rect" href="mtrr_8c.html#ae3f4e197f50db225e34de21d65633fcb" title=" " alt="" coords="1139,811,1297,853"/>
<area shape="rect" href="mmu__internal_8h.html#a6491934fd3538f608b4b91245943b6fc" title=" " alt="" coords="1365,1131,1565,1157"/>
<area shape="rect" href="mmu_8c.html#a933710db54d61c7ed41888c23c37f37d" title=" " alt="" coords="1147,681,1289,722"/>
<area shape="rect" href="mmu_8c.html#ab7d4e418cb85a72507e384df5027293e" title=" " alt="" coords="636,1207,801,1233"/>
<area shape="rect" href="x86_8h.html#a0647452067d01e527a8cd1da2fb6b897" title=" " alt="" coords="634,1257,803,1284"/>
<area shape="rect" href="mmu_8c.html#ab8e14476297a48107341bc44a29b6af9" title=" " alt="" coords="852,1181,1071,1208"/>
<area shape="rect" href="kvm__main_8c.html#aa8688eb80c9acaf8b0aa783b6ac68c16" title=" " alt="" coords="915,1232,1008,1259"/>
<area shape="rect" href="mmu_8c.html#a5b648a843c7267d204fe81facbc9f84f" title=" " alt="" coords="881,1283,1042,1309"/>
<area shape="rect" href="spte_8h.html#ab169c1872e98b9731a05121e0439f244" title=" " alt="" coords="1173,1283,1263,1309"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a5382946234c910e05c6e2c09aff15713_icgraph.png" border="0" usemap="#asmm_8c_a5382946234c910e05c6e2c09aff15713_icgraph" alt=""/></div>
<map name="asmm_8c_a5382946234c910e05c6e2c09aff15713_icgraph" id="asmm_8c_a5382946234c910e05c6e2c09aff15713_icgraph">
<area shape="rect" title=" " alt="" coords="1180,56,1333,83"/>
<area shape="rect" href="smm_8c.html#a0943012ff008c7999f582998f0f9167a" title=" " alt="" coords="968,5,1132,32"/>
<area shape="rect" href="smm_8c.html#ae1445727a8459a6cc7d2e49e5a63c0d5" title=" " alt="" coords="1002,56,1098,83"/>
<area shape="rect" href="x86_8c.html#ad6f80d324684bb9f6674522e5d84dccc" title=" " alt="" coords="547,103,701,145"/>
<area shape="rect" href="x86_8c.html#a2b372d06c72b7d8c25e9004bb3a3fd3b" title=" " alt="" coords="749,45,920,86"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="555,52,693,79"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="415,52,496,79"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,103,364,129"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,128,129,155"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="191,153,350,180"/>
<area shape="rect" href="x86_8c.html#ade4b46f56f9ee72375fa967f97e62b56" title=" " alt="" coords="412,103,499,129"/>
</map>
</div>

</div>
</div>
<a id="a638e02081e08ea00a30c71d82fccf9d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a638e02081e08ea00a30c71d82fccf9d7">&#9670;&nbsp;</a></span>process_smi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void process_smi </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00135">135</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    vcpu-&gt;arch.smi_pending = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    kvm_make_request(KVM_REQ_EVENT, vcpu);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a638e02081e08ea00a30c71d82fccf9d7_icgraph.png" border="0" usemap="#asmm_8c_a638e02081e08ea00a30c71d82fccf9d7_icgraph" alt=""/></div>
<map name="asmm_8c_a638e02081e08ea00a30c71d82fccf9d7_icgraph" id="asmm_8c_a638e02081e08ea00a30c71d82fccf9d7_icgraph">
<area shape="rect" title=" " alt="" coords="753,77,856,104"/>
<area shape="rect" href="x86_8c.html#a01b930125151430b8ee3e2fe910ca69f" title=" " alt="" coords="551,41,705,82"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="559,107,697,133"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="191,5,350,32"/>
<area shape="rect" href="x86_8c.html#aedf3017b9048be5cee8ed8cba72809f0" title=" " alt="" coords="412,56,503,83"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,31,129,57"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,56,364,83"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="417,107,498,133"/>
</map>
</div>

</div>
</div>
<a id="a0c50da2c4874eda6d67766974a476019"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c50da2c4874eda6d67766974a476019">&#9670;&nbsp;</a></span>rsm_enter_protected_mode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int rsm_enter_protected_mode </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>cr0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>cr3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>cr4</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00421">421</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;{</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordtype">int</span> bad;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    u64 pcid;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">/* In order to later set CR4.PCIDE, CR3[11:0] must be zero.  */</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    pcid = 0;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">if</span> (cr4 &amp; X86_CR4_PCIDE) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        pcid = cr3 &amp; 0xfff;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        cr3 &amp;= ~0xfff;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    bad = <a class="code" href="x86_8c.html#a75f57f1f4494df7f35fcdf0e0e582a31">kvm_set_cr3</a>(vcpu, cr3);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">if</span> (bad)</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">     * First enable PAE, long mode needs it before CR0.PG = 1 is set.</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">     * Then enable protected mode.  However, PCID cannot be enabled</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">     * if EFER.LMA=0, so set it separately.</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    bad = <a class="code" href="x86_8c.html#a39acca4a1624a86a5d8e547339729536">kvm_set_cr4</a>(vcpu, cr4 &amp; ~X86_CR4_PCIDE);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">if</span> (bad)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    bad = <a class="code" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4">kvm_set_cr0</a>(vcpu, cr0);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (bad)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">if</span> (cr4 &amp; X86_CR4_PCIDE) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        bad = <a class="code" href="x86_8c.html#a39acca4a1624a86a5d8e547339729536">kvm_set_cr4</a>(vcpu, cr4);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">if</span> (bad)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">if</span> (pcid) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            bad = <a class="code" href="x86_8c.html#a75f57f1f4494df7f35fcdf0e0e582a31">kvm_set_cr3</a>(vcpu, cr3 | pcid);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordflow">if</span> (bad)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a591057243ede58e1608aed5cd024e898">X86EMUL_CONTINUE</a>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;}</div>
<div class="ttc" id="akvm__emulate_8h_html_a591057243ede58e1608aed5cd024e898"><div class="ttname"><a href="kvm__emulate_8h.html#a591057243ede58e1608aed5cd024e898">X86EMUL_CONTINUE</a></div><div class="ttdeci">#define X86EMUL_CONTINUE</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00081">kvm_emulate.h:81</a></div></div>
<div class="ttc" id="ax86_8c_html_a75f57f1f4494df7f35fcdf0e0e582a31"><div class="ttname"><a href="x86_8c.html#a75f57f1f4494df7f35fcdf0e0e582a31">kvm_set_cr3</a></div><div class="ttdeci">int kvm_set_cr3(struct kvm_vcpu *vcpu, unsigned long cr3)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l01266">x86.c:1266</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a0c50da2c4874eda6d67766974a476019_cgraph.png" border="0" usemap="#asmm_8c_a0c50da2c4874eda6d67766974a476019_cgraph" alt=""/></div>
<map name="asmm_8c_a0c50da2c4874eda6d67766974a476019_cgraph" id="asmm_8c_a0c50da2c4874eda6d67766974a476019_cgraph">
<area shape="rect" title=" " alt="" coords="5,1155,207,1181"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="255,505,360,532"/>
<area shape="rect" href="x86_8c.html#a75f57f1f4494df7f35fcdf0e0e582a31" title=" " alt="" coords="425,1155,531,1181"/>
<area shape="rect" href="x86_8c.html#a39acca4a1624a86a5d8e547339729536" title=" " alt="" coords="255,1635,360,1661"/>
<area shape="rect" href="x86_8h.html#ada9d5e605374059a5e34c42817ed5118" title=" " alt="" coords="1117,1324,1241,1351"/>
<area shape="rect" href="x86_8h.html#abc2ffd79aced13c24f0c4143465d3d51" title=" " alt="" coords="1336,645,1400,672"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65" title=" " alt="" coords="1472,821,1619,848"/>
<area shape="rect" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878" title=" " alt="" coords="1326,569,1410,596"/>
<area shape="rect" href="x86_8c.html#a482306c58fa14c6da89a052965364037" title=" " alt="" coords="411,269,545,296"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="408,320,548,347"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a66188c5384cbd688acd880f8de16fbff" title=" " alt="" coords="1488,249,1603,276"/>
<area shape="rect" href="kvm__cache__regs_8h.html#aa80de2ba11d877ef825788b0c9768378" title=" " alt="" coords="1121,1661,1236,1688"/>
<area shape="rect" href="x86_8c.html#ae69bdd054a70a95d99b79bae770372cf" title=" " alt="" coords="644,1369,743,1396"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="1312,911,1424,937"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a24ffc81fe5ed7998e29134351275b4dd" title=" " alt="" coords="1667,1055,1812,1081"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1860,1055,2053,1081"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="1472,569,1619,596"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="1667,569,1812,596"/>
<area shape="rect" href="x86_8c.html#ad850a917f349195334a4ef07b53ca379" title=" " alt="" coords="596,211,791,237"/>
<area shape="rect" href="x86_8h.html#adf8330176a8805826ed4711a51ce93cf" title=" " alt="" coords="610,261,777,288"/>
<area shape="rect" href="async__pf_8c.html#ad351bddfe80f107dfc95c6ab2768fe4f" title=" " alt="" coords="616,313,771,354"/>
<area shape="rect" href="mmu_8c.html#a88ade1c65bbbb9b25a78e82003a71a7c" title=" " alt="" coords="882,531,1002,557"/>
<area shape="rect" href="mmu_8h.html#a11c275bc8cfad409c0681f0c953ebcae" title=" " alt="" coords="600,94,787,135"/>
<area shape="rect" href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f" title=" " alt="" coords="599,531,787,557"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="617,160,770,187"/>
<area shape="rect" href="async__pf_8c.html#a5b03475159778ff1b6a78dbbfc913a01" title=" " alt="" coords="865,313,1019,354"/>
<area shape="rect" href="mmu_8c.html#a8a6a76a1ef24ce48ce2378ac59cf5b20" title=" " alt="" coords="1093,581,1264,608"/>
<area shape="rect" href="mmu_8c.html#a37d0224d142272ad59fd35b4a22c5937" title=" " alt="" coords="1107,531,1251,557"/>
<area shape="rect" href="mmu_8c.html#a7bf770a114656f992dd1c0aff57fe9e5" title=" " alt="" coords="871,632,1013,659"/>
<area shape="rect" href="mmu_8c.html#ab7d4e418cb85a72507e384df5027293e" title=" " alt="" coords="1096,1037,1261,1064"/>
<area shape="rect" href="x86_8h.html#a0647452067d01e527a8cd1da2fb6b897" title=" " alt="" coords="1094,733,1263,760"/>
<area shape="rect" href="spte_8h.html#ab169c1872e98b9731a05121e0439f244" title=" " alt="" coords="1323,1012,1413,1039"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a0f6830d8a03ec49d8ac457e2a9c1d687" title=" " alt="" coords="849,1509,1035,1536"/>
<area shape="rect" href="mmu_8h.html#a937b5147c498fb7bdafb70240b735089" title=" " alt="" coords="869,1408,1015,1435"/>
<area shape="rect" href="kvm__main_8c.html#adfef9b2c2d6359fd443d98f51be19605" title=" " alt="" coords="839,1459,1045,1485"/>
<area shape="rect" href="x86_8c.html#aee0eed4ae7aae6d67d9db92d30f029d8" title=" " alt="" coords="881,1357,1003,1384"/>
<area shape="rect" href="x86_8h.html#aaa36cdb43bbf6ed6af3b10deed46a436" title=" " alt="" coords="1121,683,1236,709"/>
<area shape="rect" href="x86_8c.html#aa792359250f034a2a29b0c809df64ff3" title=" " alt="" coords="615,1104,772,1131"/>
<area shape="rect" href="mmu_8c.html#a40fe74f8abc723be216276bf005e4be8" title=" " alt="" coords="615,987,772,1013"/>
<area shape="rect" href="cpuid_8h.html#a8f4d8ed96a58f11e51539641257987c2" title=" " alt="" coords="607,1205,780,1232"/>
<area shape="rect" href="mmu_8h.html#ad1aee9e6e5e9d85568a734930c8a084a" title=" " alt="" coords="862,1104,1022,1131"/>
<area shape="rect" href="mmu_8h.html#a573994365668ea7cc32c0858f96d8e64" title=" " alt="" coords="1122,936,1235,963"/>
<area shape="rect" href="mmu_8c.html#abb5019ac7518fb7c882332a480e20896" title=" " alt="" coords="847,1038,1037,1079"/>
<area shape="rect" href="mmu_8c.html#a0e7f249026693e08d3c8b70f7ffd5003" title=" " alt="" coords="879,987,1005,1013"/>
<area shape="rect" href="cpuid_8h.html#acf67f5848a2ddd59dc852e37bc330390" title=" " alt="" coords="883,1256,1001,1283"/>
<area shape="rect" href="cpuid_8h.html#a79ede0627c3b2d96bb1e5c0ff8e98cd0" title=" " alt="" coords="853,1205,1031,1232"/>
<area shape="rect" href="x86_8c.html#ad45419cfec5d4a35d1dd6778689061b7" title=" " alt="" coords="411,1839,545,1865"/>
<area shape="rect" href="x86_8c.html#afb193fb2b1c3f240d0ad5a5378afc118" title=" " alt="" coords="408,632,548,659"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba" title=" " alt="" coords="1488,1324,1603,1351"/>
<area shape="rect" href="x86_8c.html#af08b5422fd770e61736c80ba64d811f8" title=" " alt="" coords="619,1839,768,1865"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a0c50da2c4874eda6d67766974a476019_icgraph.png" border="0" usemap="#asmm_8c_a0c50da2c4874eda6d67766974a476019_icgraph" alt=""/></div>
<map name="asmm_8c_a0c50da2c4874eda6d67766974a476019_icgraph" id="asmm_8c_a0c50da2c4874eda6d67766974a476019_icgraph">
<area shape="rect" title=" " alt="" coords="411,5,612,32"/>
<area shape="rect" href="smm_8c.html#ae0136cd1aa193ad29565961ea839a99a" title=" " alt="" coords="217,5,363,32"/>
<area shape="rect" href="smm_8c.html#a0943012ff008c7999f582998f0f9167a" title=" " alt="" coords="5,5,169,32"/>
</map>
</div>

</div>
</div>
<a id="afb71f3f026dc16865ba79f3dff1ffcc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb71f3f026dc16865ba79f3dff1ffcc4">&#9670;&nbsp;</a></span>rsm_load_seg_32()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int rsm_load_seg_32 </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_smm_seg_state_32 *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u16&#160;</td>
          <td class="paramname"><em>selector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00390">390</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;{</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keyword">struct </span>kvm_segment desc;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    desc.selector =           selector;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    desc.base =               <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>-&gt;base;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    desc.limit =              <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>-&gt;limit;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="smm_8c.html#a295c8b394815c953fba753d42c4fc5b6">rsm_set_desc_flags</a>(&amp;desc, <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>-&gt;flags);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <a class="code" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18">kvm_set_segment</a>(vcpu, &amp;desc, n);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a591057243ede58e1608aed5cd024e898">X86EMUL_CONTINUE</a>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
<div class="ttc" id="asmm_8c_html_a295c8b394815c953fba753d42c4fc5b6"><div class="ttname"><a href="smm_8c.html#a295c8b394815c953fba753d42c4fc5b6">rsm_set_desc_flags</a></div><div class="ttdeci">static void rsm_set_desc_flags(struct kvm_segment *desc, u32 flags)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00375">smm.c:375</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_afb71f3f026dc16865ba79f3dff1ffcc4_cgraph.png" border="0" usemap="#asmm_8c_afb71f3f026dc16865ba79f3dff1ffcc4_cgraph" alt=""/></div>
<map name="asmm_8c_afb71f3f026dc16865ba79f3dff1ffcc4_cgraph" id="asmm_8c_afb71f3f026dc16865ba79f3dff1ffcc4_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,140,57"/>
<area shape="rect" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18" title=" " alt="" coords="191,5,334,32"/>
<area shape="rect" href="smm_8c.html#a295c8b394815c953fba753d42c4fc5b6" title=" " alt="" coords="188,56,337,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_afb71f3f026dc16865ba79f3dff1ffcc4_icgraph.png" border="0" usemap="#asmm_8c_afb71f3f026dc16865ba79f3dff1ffcc4_icgraph" alt=""/></div>
<map name="asmm_8c_afb71f3f026dc16865ba79f3dff1ffcc4_icgraph" id="asmm_8c_afb71f3f026dc16865ba79f3dff1ffcc4_icgraph">
<area shape="rect" title=" " alt="" coords="411,5,545,32"/>
<area shape="rect" href="smm_8c.html#ae0136cd1aa193ad29565961ea839a99a" title=" " alt="" coords="217,5,363,32"/>
<area shape="rect" href="smm_8c.html#a0943012ff008c7999f582998f0f9167a" title=" " alt="" coords="5,5,169,32"/>
</map>
</div>

</div>
</div>
<a id="ae0136cd1aa193ad29565961ea839a99a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0136cd1aa193ad29565961ea839a99a">&#9670;&nbsp;</a></span>rsm_load_state_32()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int rsm_load_state_32 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structx86__emulate__ctxt.html">x86_emulate_ctxt</a> *&#160;</td>
          <td class="paramname"><em>ctxt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_smram_state_32 *&#160;</td>
          <td class="paramname"><em>smstate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00466">466</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;{</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = ctxt-&gt;<a class="code" href="structx86__emulate__ctxt.html#ab957da78003b9336cb805fad802aa4fb">vcpu</a>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keyword">struct </span>desc_ptr dt;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordtype">int</span> i, r;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    ctxt-&gt;<a class="code" href="structx86__emulate__ctxt.html#a32c0b3da6b683a97c859ef9b06fd07e5">eflags</a> =  smstate-&gt;eflags | X86_EFLAGS_FIXED;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    ctxt-&gt;<a class="code" href="structx86__emulate__ctxt.html#a81496753913f053b25ba53832242d917">_eip</a> =  smstate-&gt;eip;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; 8; i++)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        *<a class="code" href="kvm__emulate_8h.html#a6765223c3d699954a57bfb199c37130d">reg_write</a>(ctxt, i) = smstate-&gt;gprs[i];</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a0df3660fa575d077f3dd97de063e5215">kvm_set_dr</a>(vcpu, 6, smstate-&gt;dr6))</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a>;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a0df3660fa575d077f3dd97de063e5215">kvm_set_dr</a>(vcpu, 7, smstate-&gt;dr7))</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="kvm__emulate_8h.html#a4370bae0613d80c5a2647f57f446a502">X86EMUL_UNHANDLEABLE</a>;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a>(vcpu, &amp;smstate-&gt;tr, smstate-&gt;tr_sel, VCPU_SREG_TR);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <a class="code" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a>(vcpu, &amp;smstate-&gt;ldtr, smstate-&gt;ldtr_sel, VCPU_SREG_LDTR);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    dt.address =               smstate-&gt;gdtr.base;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    dt.size =                  smstate-&gt;gdtr.limit;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    static_call(kvm_x86_set_gdt)(vcpu, &amp;dt);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    dt.address =               smstate-&gt;idtr.base;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    dt.size =                  smstate-&gt;idtr.limit;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    static_call(kvm_x86_set_idt)(vcpu, &amp;dt);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a>(vcpu, &amp;smstate-&gt;es, smstate-&gt;es_sel, VCPU_SREG_ES);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <a class="code" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a>(vcpu, &amp;smstate-&gt;cs, smstate-&gt;cs_sel, VCPU_SREG_CS);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <a class="code" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a>(vcpu, &amp;smstate-&gt;ss, smstate-&gt;ss_sel, VCPU_SREG_SS);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a>(vcpu, &amp;smstate-&gt;ds, smstate-&gt;ds_sel, VCPU_SREG_DS);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a>(vcpu, &amp;smstate-&gt;fs, smstate-&gt;fs_sel, VCPU_SREG_FS);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a>(vcpu, &amp;smstate-&gt;gs, smstate-&gt;gs_sel, VCPU_SREG_GS);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    vcpu-&gt;arch.smbase = smstate-&gt;smbase;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    r = <a class="code" href="smm_8c.html#a0c50da2c4874eda6d67766974a476019">rsm_enter_protected_mode</a>(vcpu, smstate-&gt;cr0,</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                    smstate-&gt;cr3, smstate-&gt;cr4);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">if</span> (r != <a class="code" href="kvm__emulate_8h.html#a591057243ede58e1608aed5cd024e898">X86EMUL_CONTINUE</a>)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    static_call(kvm_x86_set_interrupt_shadow)(vcpu, 0);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    ctxt-&gt;<a class="code" href="structx86__emulate__ctxt.html#af4850311f4a57ec9eb1d3a6e4ccd4274">interruptibility</a> = (u8)smstate-&gt;int_shadow;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;}</div>
<div class="ttc" id="akvm__emulate_8h_html_a6765223c3d699954a57bfb199c37130d"><div class="ttname"><a href="kvm__emulate_8h.html#a6765223c3d699954a57bfb199c37130d">reg_write</a></div><div class="ttdeci">static ulong * reg_write(struct x86_emulate_ctxt *ctxt, unsigned nr)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00531">kvm_emulate.h:531</a></div></div>
<div class="ttc" id="asmm_8c_html_a0c50da2c4874eda6d67766974a476019"><div class="ttname"><a href="smm_8c.html#a0c50da2c4874eda6d67766974a476019">rsm_enter_protected_mode</a></div><div class="ttdeci">static int rsm_enter_protected_mode(struct kvm_vcpu *vcpu, u64 cr0, u64 cr3, u64 cr4)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00421">smm.c:421</a></div></div>
<div class="ttc" id="asmm_8c_html_afb71f3f026dc16865ba79f3dff1ffcc4"><div class="ttname"><a href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4">rsm_load_seg_32</a></div><div class="ttdeci">static int rsm_load_seg_32(struct kvm_vcpu *vcpu, const struct kvm_smm_seg_state_32 *state, u16 selector, int n)</div><div class="ttdef"><b>Definition:</b> <a href="smm_8c_source.html#l00390">smm.c:390</a></div></div>
<div class="ttc" id="astructx86__emulate__ctxt_html_a32c0b3da6b683a97c859ef9b06fd07e5"><div class="ttname"><a href="structx86__emulate__ctxt.html#a32c0b3da6b683a97c859ef9b06fd07e5">x86_emulate_ctxt::eflags</a></div><div class="ttdeci">unsigned long eflags</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00312">kvm_emulate.h:312</a></div></div>
<div class="ttc" id="astructx86__emulate__ctxt_html_a81496753913f053b25ba53832242d917"><div class="ttname"><a href="structx86__emulate__ctxt.html#a81496753913f053b25ba53832242d917">x86_emulate_ctxt::_eip</a></div><div class="ttdeci">unsigned long _eip</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00362">kvm_emulate.h:362</a></div></div>
<div class="ttc" id="astructx86__emulate__ctxt_html_af4850311f4a57ec9eb1d3a6e4ccd4274"><div class="ttname"><a href="structx86__emulate__ctxt.html#af4850311f4a57ec9eb1d3a6e4ccd4274">x86_emulate_ctxt::interruptibility</a></div><div class="ttdeci">int interruptibility</div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00318">kvm_emulate.h:318</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_ae0136cd1aa193ad29565961ea839a99a_cgraph.png" border="0" usemap="#asmm_8c_ae0136cd1aa193ad29565961ea839a99a_cgraph" alt=""/></div>
<map name="asmm_8c_ae0136cd1aa193ad29565961ea839a99a_cgraph" id="asmm_8c_ae0136cd1aa193ad29565961ea839a99a_cgraph">
<area shape="rect" title=" " alt="" coords="5,566,151,593"/>
<area shape="rect" href="x86_8c.html#a0df3660fa575d077f3dd97de063e5215" title=" " alt="" coords="250,287,349,314"/>
<area shape="rect" href="kvm__emulate_8h.html#a6765223c3d699954a57bfb199c37130d" title=" " alt="" coords="258,541,341,567"/>
<area shape="rect" href="smm_8c.html#a0c50da2c4874eda6d67766974a476019" title=" " alt="" coords="199,591,400,618"/>
<area shape="rect" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4" title=" " alt="" coords="232,819,367,846"/>
<area shape="rect" href="x86_8c.html#a2aeff0b787a2133f4809c6a94c6458d7" title=" " alt="" coords="464,237,581,263"/>
<area shape="rect" href="x86_8h.html#a401b9fcb1381d2fbfc488f8520093cee" title=" " alt="" coords="463,287,582,314"/>
<area shape="rect" href="x86_8h.html#a6d86e9ee10c2cd72b82aef25cabafd82" title=" " alt="" coords="463,338,582,365"/>
<area shape="rect" href="x86_8c.html#afed36c545d27cca59caddf31fdfd054a" title=" " alt="" coords="457,186,588,213"/>
<area shape="rect" href="cpuid_8h.html#ad8c2a90f2f099af1d7ca23750d9d2eb9" title=" " alt="" coords="667,135,797,162"/>
<area shape="rect" href="reverse__cpuid_8h.html#aeac4cdaa1c8b53f46ea791f355b1d08c" title=" " alt="" coords="906,135,1013,162"/>
<area shape="rect" href="cpuid_8h.html#af2af2645f203b5d9bad2088af0da5c1e" title=" " alt="" coords="867,85,1052,111"/>
<area shape="rect" href="x86_8c.html#aa9556b4ebb06617f66625ff73a3f56b4" title=" " alt="" coords="679,591,785,618"/>
<area shape="rect" href="x86_8c.html#a75f57f1f4494df7f35fcdf0e0e582a31" title=" " alt="" coords="470,769,575,795"/>
<area shape="rect" href="x86_8c.html#a39acca4a1624a86a5d8e547339729536" title=" " alt="" coords="679,414,785,441"/>
<area shape="rect" href="x86_8h.html#ada9d5e605374059a5e34c42817ed5118" title=" " alt="" coords="897,642,1021,669"/>
<area shape="rect" href="x86_8h.html#abc2ffd79aced13c24f0c4143465d3d51" title=" " alt="" coords="927,794,991,821"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a2b779657b20f7afa44c0172b1478ac65" title=" " alt="" coords="1130,925,1277,951"/>
<area shape="rect" href="x86_8h.html#a716c9d1b6fc76fd454097cf39d640878" title=" " alt="" coords="917,490,1001,517"/>
<area shape="rect" href="x86_8c.html#a482306c58fa14c6da89a052965364037" title=" " alt="" coords="892,591,1027,618"/>
<area shape="rect" href="x86_8c.html#a3df01e8bd995bb72420812ea1d39df4b" title=" " alt="" coords="889,338,1029,365"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a66188c5384cbd688acd880f8de16fbff" title=" " alt="" coords="902,693,1017,719"/>
<area shape="rect" href="kvm__cache__regs_8h.html#aa80de2ba11d877ef825788b0c9768378" title=" " alt="" coords="902,186,1017,213"/>
<area shape="rect" href="x86_8c.html#ae69bdd054a70a95d99b79bae770372cf" title=" " alt="" coords="910,541,1009,567"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="1147,722,1259,749"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a24ffc81fe5ed7998e29134351275b4dd" title=" " alt="" coords="1355,519,1500,546"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1548,469,1741,495"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="1130,469,1277,495"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5fbb40e1f7661ccfd5accdaef3d8c378" title=" " alt="" coords="1355,469,1500,495"/>
<area shape="rect" href="x86_8c.html#ad850a917f349195334a4ef07b53ca379" title=" " alt="" coords="1106,185,1301,211"/>
<area shape="rect" href="x86_8h.html#adf8330176a8805826ed4711a51ce93cf" title=" " alt="" coords="1120,235,1287,262"/>
<area shape="rect" href="async__pf_8c.html#ad351bddfe80f107dfc95c6ab2768fe4f" title=" " alt="" coords="1126,287,1281,328"/>
<area shape="rect" href="mmu_8c.html#a88ade1c65bbbb9b25a78e82003a71a7c" title=" " alt="" coords="1367,109,1487,135"/>
<area shape="rect" href="mmu_8h.html#a11c275bc8cfad409c0681f0c953ebcae" title=" " alt="" coords="1110,352,1297,393"/>
<area shape="rect" href="mmu_8c.html#a56f1568115a55fdacc188e9b41159b8f" title=" " alt="" coords="1109,83,1297,110"/>
<area shape="rect" href="mmu_8c.html#a8b2588158566c9bb798cdb77760e6446" title=" " alt="" coords="1127,418,1280,445"/>
<area shape="rect" href="mmu_8c.html#ab7d4e418cb85a72507e384df5027293e" title=" " alt="" coords="1121,874,1286,901"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a0f6830d8a03ec49d8ac457e2a9c1d687" title=" " alt="" coords="1110,823,1297,850"/>
<area shape="rect" href="mmu_8h.html#a937b5147c498fb7bdafb70240b735089" title=" " alt="" coords="1130,570,1277,597"/>
<area shape="rect" href="kvm__main_8c.html#adfef9b2c2d6359fd443d98f51be19605" title=" " alt="" coords="1100,621,1307,647"/>
<area shape="rect" href="x86_8c.html#aee0eed4ae7aae6d67d9db92d30f029d8" title=" " alt="" coords="1142,671,1265,698"/>
<area shape="rect" href="x86_8h.html#aaa36cdb43bbf6ed6af3b10deed46a436" title=" " alt="" coords="675,743,789,770"/>
<area shape="rect" href="x86_8c.html#aa792359250f034a2a29b0c809df64ff3" title=" " alt="" coords="881,946,1038,973"/>
<area shape="rect" href="mmu_8c.html#a40fe74f8abc723be216276bf005e4be8" title=" " alt="" coords="653,794,811,821"/>
<area shape="rect" href="cpuid_8h.html#a8f4d8ed96a58f11e51539641257987c2" title=" " alt="" coords="645,895,819,922"/>
<area shape="rect" href="x86_8c.html#ad45419cfec5d4a35d1dd6778689061b7" title=" " alt="" coords="892,287,1027,314"/>
<area shape="rect" href="x86_8c.html#afb193fb2b1c3f240d0ad5a5378afc118" title=" " alt="" coords="889,237,1029,263"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad479d598f0b5de90bd6062237ccb9eba" title=" " alt="" coords="902,389,1017,415"/>
<area shape="rect" href="x86_8c.html#a6818ed0db6dca9dc6dfc7b59963a0e18" title=" " alt="" coords="451,870,594,897"/>
<area shape="rect" href="smm_8c.html#a295c8b394815c953fba753d42c4fc5b6" title=" " alt="" coords="448,819,597,846"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_ae0136cd1aa193ad29565961ea839a99a_icgraph.png" border="0" usemap="#asmm_8c_ae0136cd1aa193ad29565961ea839a99a_icgraph" alt=""/></div>
<map name="asmm_8c_ae0136cd1aa193ad29565961ea839a99a_icgraph" id="asmm_8c_ae0136cd1aa193ad29565961ea839a99a_icgraph">
<area shape="rect" title=" " alt="" coords="217,5,363,32"/>
<area shape="rect" href="smm_8c.html#a0943012ff008c7999f582998f0f9167a" title=" " alt="" coords="5,5,169,32"/>
</map>
</div>

</div>
</div>
<a id="a295c8b394815c953fba753d42c4fc5b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a295c8b394815c953fba753d42c4fc5b6">&#9670;&nbsp;</a></span>rsm_set_desc_flags()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void rsm_set_desc_flags </td>
          <td>(</td>
          <td class="paramtype">struct kvm_segment *&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="smm_8c_source.html#l00375">375</a> of file <a class="el" href="smm_8c_source.html">smm.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;{</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    desc-&gt;g    = (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &gt;&gt; 23) &amp; 1;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    desc-&gt;db   = (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &gt;&gt; 22) &amp; 1;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    desc-&gt;l    = (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &gt;&gt; 21) &amp; 1;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    desc-&gt;avl  = (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &gt;&gt; 20) &amp; 1;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    desc-&gt;present = (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &gt;&gt; 15) &amp; 1;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    desc-&gt;dpl  = (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &gt;&gt; 13) &amp; 3;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    desc-&gt;s    = (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &gt;&gt; 12) &amp; 1;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    desc-&gt;type = (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &gt;&gt;  8) &amp; 15;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    desc-&gt;unusable = !desc-&gt;present;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    desc-&gt;padding = 0;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="smm_8c_a295c8b394815c953fba753d42c4fc5b6_icgraph.png" border="0" usemap="#asmm_8c_a295c8b394815c953fba753d42c4fc5b6_icgraph" alt=""/></div>
<map name="asmm_8c_a295c8b394815c953fba753d42c4fc5b6_icgraph" id="asmm_8c_a295c8b394815c953fba753d42c4fc5b6_icgraph">
<area shape="rect" title=" " alt="" coords="593,5,743,32"/>
<area shape="rect" href="smm_8c.html#afb71f3f026dc16865ba79f3dff1ffcc4" title=" " alt="" coords="411,5,545,32"/>
<area shape="rect" href="smm_8c.html#ae0136cd1aa193ad29565961ea839a99a" title=" " alt="" coords="217,5,363,32"/>
<area shape="rect" href="smm_8c.html#a0943012ff008c7999f582998f0f9167a" title=" " alt="" coords="5,5,169,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
