<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/x86/kvm/i8254.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_c21774f8bc9f0de15163573e5f5fa2b5.html">x86</a></li><li class="navelem"><a class="el" href="dir_fde450fd4b58e2560c53a1e73bfa4d6d.html">kvm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">i8254.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/kthread.h&gt;</code><br />
<code>#include &lt;kvm/iodev.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for i8254.h:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h__incl.png" border="0" usemap="#aarch_2x86_2kvm_2i8254_8h" alt=""/></div>
<map name="aarch_2x86_2kvm_2i8254_8h" id="aarch_2x86_2kvm_2i8254_8h">
<area shape="rect" title=" " alt="" coords="52,5,215,32"/>
<area shape="rect" title=" " alt="" coords="5,80,125,107"/>
<area shape="rect" title=" " alt="" coords="150,80,253,107"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h__dep__incl.png" border="0" usemap="#aarch_2x86_2kvm_2i8254_8hdep" alt=""/></div>
<map name="aarch_2x86_2kvm_2i8254_8hdep" id="aarch_2x86_2kvm_2i8254_8hdep">
<area shape="rect" title=" " alt="" coords="173,5,335,32"/>
<area shape="rect" href="irq_8c.html" title=" " alt="" coords="5,80,148,107"/>
<area shape="rect" href="i8254_8c.html" title=" " alt="" coords="173,80,335,107"/>
<area shape="rect" href="x86_8c.html" title=" " alt="" coords="360,80,511,107"/>
</map>
</div>
</div>
<p><a href="i8254_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkvm__kpit__channel__state.html">kvm_kpit_channel_state</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkvm__kpit__state.html">kvm_kpit_state</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkvm__pit.html">kvm_pit</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a29ff2679e1d784a3e9a32f8d50b77a49"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#a29ff2679e1d784a3e9a32f8d50b77a49">KVM_PIT_BASE_ADDRESS</a>&#160;&#160;&#160;0x40</td></tr>
<tr class="separator:a29ff2679e1d784a3e9a32f8d50b77a49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae1b5e67486f34b709bd5e4167b1b650"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#aae1b5e67486f34b709bd5e4167b1b650">KVM_SPEAKER_BASE_ADDRESS</a>&#160;&#160;&#160;0x61</td></tr>
<tr class="separator:aae1b5e67486f34b709bd5e4167b1b650"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae179872c91f404069dc0a79926a97859"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#ae179872c91f404069dc0a79926a97859">KVM_PIT_MEM_LENGTH</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:ae179872c91f404069dc0a79926a97859"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a885ffb61a8d53e2284ef960da7bebdd0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#a885ffb61a8d53e2284ef960da7bebdd0">KVM_PIT_FREQ</a>&#160;&#160;&#160;1193181</td></tr>
<tr class="separator:a885ffb61a8d53e2284ef960da7bebdd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca09c6f2de4e652e3b4c63924c39868b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#aca09c6f2de4e652e3b4c63924c39868b">KVM_MAX_PIT_INTR_INTERVAL</a>&#160;&#160;&#160;HZ / 100</td></tr>
<tr class="separator:aca09c6f2de4e652e3b4c63924c39868b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7efcb3a4b11b1e07476949bc064aa4c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#aa7efcb3a4b11b1e07476949bc064aa4c">KVM_PIT_CHANNEL_MASK</a>&#160;&#160;&#160;0x3</td></tr>
<tr class="separator:aa7efcb3a4b11b1e07476949bc064aa4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a13a38debbd4e494ffd488ef8abb5406c"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structkvm__pit.html">kvm_pit</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#a13a38debbd4e494ffd488ef8abb5406c">kvm_create_pit</a> (struct kvm *kvm, u32 <a class="el" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>)</td></tr>
<tr class="separator:a13a38debbd4e494ffd488ef8abb5406c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a7ca7f5194b378ba7f0ae7a38cc26ba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#a2a7ca7f5194b378ba7f0ae7a38cc26ba">kvm_free_pit</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a2a7ca7f5194b378ba7f0ae7a38cc26ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1923c65ac30fa3d71f7b76ab4b1797cc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#a1923c65ac30fa3d71f7b76ab4b1797cc">kvm_pit_load_count</a> (struct <a class="el" href="structkvm__pit.html">kvm_pit</a> *pit, int channel, u32 val, int hpet_legacy_start)</td></tr>
<tr class="separator:a1923c65ac30fa3d71f7b76ab4b1797cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27233516d999d8230f70ee545f0afd5f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i8254_8h.html#a27233516d999d8230f70ee545f0afd5f">kvm_pit_set_reinject</a> (struct <a class="el" href="structkvm__pit.html">kvm_pit</a> *pit, bool reinject)</td></tr>
<tr class="separator:a27233516d999d8230f70ee545f0afd5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aca09c6f2de4e652e3b4c63924c39868b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca09c6f2de4e652e3b4c63924c39868b">&#9670;&nbsp;</a></span>KVM_MAX_PIT_INTR_INTERVAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_MAX_PIT_INTR_INTERVAL&#160;&#160;&#160;HZ / 100</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8h_source.html#l00055">55</a> of file <a class="el" href="i8254_8h_source.html">i8254.h</a>.</p>

</div>
</div>
<a id="a29ff2679e1d784a3e9a32f8d50b77a49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29ff2679e1d784a3e9a32f8d50b77a49">&#9670;&nbsp;</a></span>KVM_PIT_BASE_ADDRESS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_PIT_BASE_ADDRESS&#160;&#160;&#160;0x40</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8h_source.html#l00051">51</a> of file <a class="el" href="i8254_8h_source.html">i8254.h</a>.</p>

</div>
</div>
<a id="aa7efcb3a4b11b1e07476949bc064aa4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7efcb3a4b11b1e07476949bc064aa4c">&#9670;&nbsp;</a></span>KVM_PIT_CHANNEL_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_PIT_CHANNEL_MASK&#160;&#160;&#160;0x3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8h_source.html#l00056">56</a> of file <a class="el" href="i8254_8h_source.html">i8254.h</a>.</p>

</div>
</div>
<a id="a885ffb61a8d53e2284ef960da7bebdd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a885ffb61a8d53e2284ef960da7bebdd0">&#9670;&nbsp;</a></span>KVM_PIT_FREQ</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_PIT_FREQ&#160;&#160;&#160;1193181</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8h_source.html#l00054">54</a> of file <a class="el" href="i8254_8h_source.html">i8254.h</a>.</p>

</div>
</div>
<a id="ae179872c91f404069dc0a79926a97859"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae179872c91f404069dc0a79926a97859">&#9670;&nbsp;</a></span>KVM_PIT_MEM_LENGTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_PIT_MEM_LENGTH&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8h_source.html#l00053">53</a> of file <a class="el" href="i8254_8h_source.html">i8254.h</a>.</p>

</div>
</div>
<a id="aae1b5e67486f34b709bd5e4167b1b650"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae1b5e67486f34b709bd5e4167b1b650">&#9670;&nbsp;</a></span>KVM_SPEAKER_BASE_ADDRESS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KVM_SPEAKER_BASE_ADDRESS&#160;&#160;&#160;0x61</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8h_source.html#l00052">52</a> of file <a class="el" href="i8254_8h_source.html">i8254.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a13a38debbd4e494ffd488ef8abb5406c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13a38debbd4e494ffd488ef8abb5406c">&#9670;&nbsp;</a></span>kvm_create_pit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structkvm__pit.html">kvm_pit</a>* kvm_create_pit </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8c_source.html#l00662">662</a> of file <a class="el" href="i8254_8c_source.html">i8254.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;{</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__pit.html">kvm_pit</a> *pit;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__kpit__state.html">kvm_kpit_state</a> *pit_state;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keyword">struct </span>pid *pid;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    pid_t pid_nr;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    pit = kzalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structkvm__pit.html">kvm_pit</a>), GFP_KERNEL_ACCOUNT);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span> (!pit)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    pit-&gt;<a class="code" href="structkvm__pit.html#a523b37c05bd13e6f9b55861269537e85">irq_source_id</a> = <a class="code" href="irq__comm_8c.html#a42a016687e649ff8df697ec693ebccf3">kvm_request_irq_source_id</a>(kvm);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">if</span> (pit-&gt;<a class="code" href="structkvm__pit.html#a523b37c05bd13e6f9b55861269537e85">irq_source_id</a> &lt; 0)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">goto</span> fail_request;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    mutex_init(&amp;pit-&gt;<a class="code" href="structkvm__pit.html#abb2e4885b13425334895695603579ba9">pit_state</a>.<a class="code" href="structkvm__kpit__state.html#a0f46a0a453711ca8668d56c9f009b431">lock</a>);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    pid = get_pid(task_tgid(current));</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    pid_nr = pid_vnr(pid);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    put_pid(pid);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    pit-&gt;<a class="code" href="structkvm__pit.html#a84645911923311ad3fab2d4abf5c78b2">worker</a> = kthread_create_worker(0, <span class="stringliteral">&quot;kvm-pit/%d&quot;</span>, pid_nr);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">if</span> (IS_ERR(pit-&gt;<a class="code" href="structkvm__pit.html#a84645911923311ad3fab2d4abf5c78b2">worker</a>))</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="keywordflow">goto</span> fail_kthread;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    kthread_init_work(&amp;pit-&gt;<a class="code" href="structkvm__pit.html#a4480a16753b1893becb34c4e4c09af97">expired</a>, <a class="code" href="i8254_8c.html#acbae41d4a0d42e597f4bf44b3c1e9f99">pit_do_work</a>);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    pit-&gt;<a class="code" href="structkvm__pit.html#a34c504c36cc54dbdd9529c5be8ce851e">kvm</a> = kvm;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160; </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    pit_state = &amp;pit-&gt;<a class="code" href="structkvm__pit.html#abb2e4885b13425334895695603579ba9">pit_state</a>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    hrtimer_init(&amp;pit_state-&gt;<a class="code" href="structkvm__kpit__state.html#a45ff2ad602463461e13fafc4e95ef46c">timer</a>, CLOCK_MONOTONIC, HRTIMER_MODE_ABS);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    pit_state-&gt;<a class="code" href="structkvm__kpit__state.html#a45ff2ad602463461e13fafc4e95ef46c">timer</a>.function = <a class="code" href="i8254_8c.html#a6c2a5749c7efd072513fe86e68121fb7">pit_timer_fn</a>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    pit_state-&gt;<a class="code" href="structkvm__kpit__state.html#adeaad7cdf8669923ea66be2165c37169">irq_ack_notifier</a>.gsi = 0;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    pit_state-&gt;<a class="code" href="structkvm__kpit__state.html#adeaad7cdf8669923ea66be2165c37169">irq_ack_notifier</a>.irq_acked = <a class="code" href="i8254_8c.html#ac7643b0b6fa918507479a46e83f18807">kvm_pit_ack_irq</a>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    pit-&gt;<a class="code" href="structkvm__pit.html#a5e43edb76a6111447bb76fd30ef05aaa">mask_notifier</a>.func = <a class="code" href="i8254_8c.html#adfc2f249b73853c3a1817f99f3a95508">pit_mask_notifer</a>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <a class="code" href="i8254_8c.html#a2220e9832e86b37dc7fc6d22ce395ec6">kvm_pit_reset</a>(pit);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <a class="code" href="i8254_8c.html#a27233516d999d8230f70ee545f0afd5f">kvm_pit_set_reinject</a>(pit, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    mutex_lock(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    kvm_iodevice_init(&amp;pit-&gt;<a class="code" href="structkvm__pit.html#ab4b3784d112ba1278d47425b1d4d35ea">dev</a>, &amp;<a class="code" href="i8254_8c.html#ad4aa4a6ef2a2b714d719f7ba25b02abb">pit_dev_ops</a>);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    ret = <a class="code" href="kvm__main_8c.html#a0afe5ce3e9ff1105328b06ec985e3374">kvm_io_bus_register_dev</a>(kvm, KVM_PIO_BUS, <a class="code" href="i8254_8h.html#a29ff2679e1d784a3e9a32f8d50b77a49">KVM_PIT_BASE_ADDRESS</a>,</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                      <a class="code" href="i8254_8h.html#ae179872c91f404069dc0a79926a97859">KVM_PIT_MEM_LENGTH</a>, &amp;pit-&gt;<a class="code" href="structkvm__pit.html#ab4b3784d112ba1278d47425b1d4d35ea">dev</a>);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="keywordflow">goto</span> fail_register_pit;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a> &amp; KVM_PIT_SPEAKER_DUMMY) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        kvm_iodevice_init(&amp;pit-&gt;<a class="code" href="structkvm__pit.html#ad86795e9b81dc0e3db3039a25cfea8c6">speaker_dev</a>, &amp;<a class="code" href="i8254_8c.html#a711b36e5ade1cd105a98c4a59690befd">speaker_dev_ops</a>);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        ret = <a class="code" href="kvm__main_8c.html#a0afe5ce3e9ff1105328b06ec985e3374">kvm_io_bus_register_dev</a>(kvm, KVM_PIO_BUS,</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                          <a class="code" href="i8254_8h.html#aae1b5e67486f34b709bd5e4167b1b650">KVM_SPEAKER_BASE_ADDRESS</a>, 4,</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                          &amp;pit-&gt;<a class="code" href="structkvm__pit.html#ad86795e9b81dc0e3db3039a25cfea8c6">speaker_dev</a>);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            <span class="keywordflow">goto</span> fail_register_speaker;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    mutex_unlock(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">return</span> pit;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;fail_register_speaker:</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <a class="code" href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897">kvm_io_bus_unregister_dev</a>(kvm, KVM_PIO_BUS, &amp;pit-&gt;<a class="code" href="structkvm__pit.html#ab4b3784d112ba1278d47425b1d4d35ea">dev</a>);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;fail_register_pit:</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    mutex_unlock(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="i8254_8c.html#a27233516d999d8230f70ee545f0afd5f">kvm_pit_set_reinject</a>(pit, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    kthread_destroy_worker(pit-&gt;<a class="code" href="structkvm__pit.html#a84645911923311ad3fab2d4abf5c78b2">worker</a>);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;fail_kthread:</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <a class="code" href="irq__comm_8c.html#affd624d06afb4fc277fb7a08e06bd942">kvm_free_irq_source_id</a>(kvm, pit-&gt;<a class="code" href="structkvm__pit.html#a523b37c05bd13e6f9b55861269537e85">irq_source_id</a>);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;fail_request:</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    kfree(pit);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;}</div>
<div class="ttc" id="ai8254_8c_html_a2220e9832e86b37dc7fc6d22ce395ec6"><div class="ttname"><a href="i8254_8c.html#a2220e9832e86b37dc7fc6d22ce395ec6">kvm_pit_reset</a></div><div class="ttdeci">static void kvm_pit_reset(struct kvm_pit *pit)</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00628">i8254.c:628</a></div></div>
<div class="ttc" id="ai8254_8c_html_a27233516d999d8230f70ee545f0afd5f"><div class="ttname"><a href="i8254_8c.html#a27233516d999d8230f70ee545f0afd5f">kvm_pit_set_reinject</a></div><div class="ttdeci">void kvm_pit_set_reinject(struct kvm_pit *pit, bool reinject)</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00291">i8254.c:291</a></div></div>
<div class="ttc" id="ai8254_8c_html_a6c2a5749c7efd072513fe86e68121fb7"><div class="ttname"><a href="i8254_8c.html#a6c2a5749c7efd072513fe86e68121fb7">pit_timer_fn</a></div><div class="ttdeci">static enum hrtimer_restart pit_timer_fn(struct hrtimer *data)</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00240">i8254.c:268</a></div></div>
<div class="ttc" id="ai8254_8c_html_a711b36e5ade1cd105a98c4a59690befd"><div class="ttname"><a href="i8254_8c.html#a711b36e5ade1cd105a98c4a59690befd">speaker_dev_ops</a></div><div class="ttdeci">static const struct kvm_io_device_ops speaker_dev_ops</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00644">i8254.c:657</a></div></div>
<div class="ttc" id="ai8254_8c_html_ac7643b0b6fa918507479a46e83f18807"><div class="ttname"><a href="i8254_8c.html#ac7643b0b6fa918507479a46e83f18807">kvm_pit_ack_irq</a></div><div class="ttdeci">static void kvm_pit_ack_irq(struct kvm_irq_ack_notifier *kian)</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00203">i8254.c:203</a></div></div>
<div class="ttc" id="ai8254_8c_html_acbae41d4a0d42e597f4bf44b3c1e9f99"><div class="ttname"><a href="i8254_8c.html#acbae41d4a0d42e597f4bf44b3c1e9f99">pit_do_work</a></div><div class="ttdeci">static void pit_do_work(struct kthread_work *work)</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00240">i8254.c:240</a></div></div>
<div class="ttc" id="ai8254_8c_html_ad4aa4a6ef2a2b714d719f7ba25b02abb"><div class="ttname"><a href="i8254_8c.html#ad4aa4a6ef2a2b714d719f7ba25b02abb">pit_dev_ops</a></div><div class="ttdeci">static const struct kvm_io_device_ops pit_dev_ops</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00644">i8254.c:652</a></div></div>
<div class="ttc" id="ai8254_8c_html_adfc2f249b73853c3a1817f99f3a95508"><div class="ttname"><a href="i8254_8c.html#adfc2f249b73853c3a1817f99f3a95508">pit_mask_notifer</a></div><div class="ttdeci">static void pit_mask_notifer(struct kvm_irq_mask_notifier *kimn, bool mask)</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00644">i8254.c:644</a></div></div>
<div class="ttc" id="ai8254_8h_html_a29ff2679e1d784a3e9a32f8d50b77a49"><div class="ttname"><a href="i8254_8h.html#a29ff2679e1d784a3e9a32f8d50b77a49">KVM_PIT_BASE_ADDRESS</a></div><div class="ttdeci">#define KVM_PIT_BASE_ADDRESS</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00051">i8254.h:51</a></div></div>
<div class="ttc" id="ai8254_8h_html_aae1b5e67486f34b709bd5e4167b1b650"><div class="ttname"><a href="i8254_8h.html#aae1b5e67486f34b709bd5e4167b1b650">KVM_SPEAKER_BASE_ADDRESS</a></div><div class="ttdeci">#define KVM_SPEAKER_BASE_ADDRESS</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00052">i8254.h:52</a></div></div>
<div class="ttc" id="ai8254_8h_html_ae179872c91f404069dc0a79926a97859"><div class="ttname"><a href="i8254_8h.html#ae179872c91f404069dc0a79926a97859">KVM_PIT_MEM_LENGTH</a></div><div class="ttdeci">#define KVM_PIT_MEM_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00053">i8254.h:53</a></div></div>
<div class="ttc" id="airq__comm_8c_html_a42a016687e649ff8df697ec693ebccf3"><div class="ttname"><a href="irq__comm_8c.html#a42a016687e649ff8df697ec693ebccf3">kvm_request_irq_source_id</a></div><div class="ttdeci">int kvm_request_irq_source_id(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="irq__comm_8c_source.html#l00197">irq_comm.c:197</a></div></div>
<div class="ttc" id="airq__comm_8c_html_affd624d06afb4fc277fb7a08e06bd942"><div class="ttname"><a href="irq__comm_8c.html#affd624d06afb4fc277fb7a08e06bd942">kvm_free_irq_source_id</a></div><div class="ttdeci">void kvm_free_irq_source_id(struct kvm *kvm, int irq_source_id)</div><div class="ttdef"><b>Definition:</b> <a href="irq__comm_8c_source.html#l00220">irq_comm.c:220</a></div></div>
<div class="ttc" id="akvm__main_8c_html_a0afe5ce3e9ff1105328b06ec985e3374"><div class="ttname"><a href="kvm__main_8c.html#a0afe5ce3e9ff1105328b06ec985e3374">kvm_io_bus_register_dev</a></div><div class="ttdeci">int kvm_io_bus_register_dev(struct kvm *kvm, enum kvm_bus bus_idx, gpa_t addr, int len, struct kvm_io_device *dev)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l05897">kvm_main.c:5897</a></div></div>
<div class="ttc" id="akvm__main_8c_html_a103c02eb7ca545106f3130776c2a8897"><div class="ttname"><a href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897">kvm_io_bus_unregister_dev</a></div><div class="ttdeci">int kvm_io_bus_unregister_dev(struct kvm *kvm, enum kvm_bus bus_idx, struct kvm_io_device *dev)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l05941">kvm_main.c:5941</a></div></div>
<div class="ttc" id="astructkvm__kpit__state_html"><div class="ttname"><a href="structkvm__kpit__state.html">kvm_kpit_state</a></div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00025">i8254.h:25</a></div></div>
<div class="ttc" id="astructkvm__kpit__state_html_a0f46a0a453711ca8668d56c9f009b431"><div class="ttname"><a href="structkvm__kpit__state.html#a0f46a0a453711ca8668d56c9f009b431">kvm_kpit_state::lock</a></div><div class="ttdeci">struct mutex lock</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00030">i8254.h:33</a></div></div>
<div class="ttc" id="astructkvm__kpit__state_html_a45ff2ad602463461e13fafc4e95ef46c"><div class="ttname"><a href="structkvm__kpit__state.html#a45ff2ad602463461e13fafc4e95ef46c">kvm_kpit_state::timer</a></div><div class="ttdeci">struct hrtimer timer</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00030">i8254.h:31</a></div></div>
<div class="ttc" id="astructkvm__kpit__state_html_adeaad7cdf8669923ea66be2165c37169"><div class="ttname"><a href="structkvm__kpit__state.html#adeaad7cdf8669923ea66be2165c37169">kvm_kpit_state::irq_ack_notifier</a></div><div class="ttdeci">struct kvm_irq_ack_notifier irq_ack_notifier</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00036">i8254.h:37</a></div></div>
<div class="ttc" id="astructkvm__pit_html"><div class="ttname"><a href="structkvm__pit.html">kvm_pit</a></div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00040">i8254.h:40</a></div></div>
<div class="ttc" id="astructkvm__pit_html_a34c504c36cc54dbdd9529c5be8ce851e"><div class="ttname"><a href="structkvm__pit.html#a34c504c36cc54dbdd9529c5be8ce851e">kvm_pit::kvm</a></div><div class="ttdeci">struct kvm * kvm</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00043">i8254.h:43</a></div></div>
<div class="ttc" id="astructkvm__pit_html_a4480a16753b1893becb34c4e4c09af97"><div class="ttname"><a href="structkvm__pit.html#a4480a16753b1893becb34c4e4c09af97">kvm_pit::expired</a></div><div class="ttdeci">struct kthread_work expired</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00047">i8254.h:48</a></div></div>
<div class="ttc" id="astructkvm__pit_html_a523b37c05bd13e6f9b55861269537e85"><div class="ttname"><a href="structkvm__pit.html#a523b37c05bd13e6f9b55861269537e85">kvm_pit::irq_source_id</a></div><div class="ttdeci">int irq_source_id</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00045">i8254.h:45</a></div></div>
<div class="ttc" id="astructkvm__pit_html_a5e43edb76a6111447bb76fd30ef05aaa"><div class="ttname"><a href="structkvm__pit.html#a5e43edb76a6111447bb76fd30ef05aaa">kvm_pit::mask_notifier</a></div><div class="ttdeci">struct kvm_irq_mask_notifier mask_notifier</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00045">i8254.h:46</a></div></div>
<div class="ttc" id="astructkvm__pit_html_a84645911923311ad3fab2d4abf5c78b2"><div class="ttname"><a href="structkvm__pit.html#a84645911923311ad3fab2d4abf5c78b2">kvm_pit::worker</a></div><div class="ttdeci">struct kthread_worker * worker</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00047">i8254.h:47</a></div></div>
<div class="ttc" id="astructkvm__pit_html_ab4b3784d112ba1278d47425b1d4d35ea"><div class="ttname"><a href="structkvm__pit.html#ab4b3784d112ba1278d47425b1d4d35ea">kvm_pit::dev</a></div><div class="ttdeci">struct kvm_io_device dev</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00036">i8254.h:41</a></div></div>
<div class="ttc" id="astructkvm__pit_html_abb2e4885b13425334895695603579ba9"><div class="ttname"><a href="structkvm__pit.html#abb2e4885b13425334895695603579ba9">kvm_pit::pit_state</a></div><div class="ttdeci">struct kvm_kpit_state pit_state</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00043">i8254.h:44</a></div></div>
<div class="ttc" id="astructkvm__pit_html_ad86795e9b81dc0e3db3039a25cfea8c6"><div class="ttname"><a href="structkvm__pit.html#ad86795e9b81dc0e3db3039a25cfea8c6">kvm_pit::speaker_dev</a></div><div class="ttdeci">struct kvm_io_device speaker_dev</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00036">i8254.h:42</a></div></div>
<div class="ttc" id="axen_8c_html_a773b39d480759f67926cb18ae2219281"><div class="ttname"><a href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a></div><div class="ttdeci">uint32_t flags</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00001">xen.c:1</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h_a13a38debbd4e494ffd488ef8abb5406c_cgraph.png" border="0" usemap="#ai8254_8h_a13a38debbd4e494ffd488ef8abb5406c_cgraph" alt=""/></div>
<map name="ai8254_8h_a13a38debbd4e494ffd488ef8abb5406c_cgraph" id="ai8254_8h_a13a38debbd4e494ffd488ef8abb5406c_cgraph">
<area shape="rect" title=" " alt="" coords="5,512,128,539"/>
<area shape="rect" href="irq__comm_8c.html#affd624d06afb4fc277fb7a08e06bd942" title=" " alt="" coords="189,171,367,197"/>
<area shape="rect" href="kvm__main_8c.html#a0afe5ce3e9ff1105328b06ec985e3374" title=" " alt="" coords="184,247,372,273"/>
<area shape="rect" href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897" title=" " alt="" coords="176,335,380,361"/>
<area shape="rect" href="i8254_8c.html#ac7643b0b6fa918507479a46e83f18807" title=" " alt="" coords="213,411,343,437"/>
<area shape="rect" href="i8254_8c.html#a2220e9832e86b37dc7fc6d22ce395ec6" title=" " alt="" coords="221,487,335,513"/>
<area shape="rect" href="i8254_8c.html#a27233516d999d8230f70ee545f0afd5f" title=" " alt="" coords="199,541,357,568"/>
<area shape="rect" href="irq__comm_8c.html#a42a016687e649ff8df697ec693ebccf3" title=" " alt="" coords="178,592,378,619"/>
<area shape="rect" href="i8254_8c.html#acbae41d4a0d42e597f4bf44b3c1e9f99" title=" " alt="" coords="227,643,329,669"/>
<area shape="rect" href="i8254_8c.html#adfc2f249b73853c3a1817f99f3a95508" title=" " alt="" coords="212,693,344,720"/>
<area shape="rect" href="i8254_8c.html#a6c2a5749c7efd072513fe86e68121fb7" title=" " alt="" coords="227,744,329,771"/>
<area shape="rect" href="irq_8h.html#aeedc8b3b9e709414b2db2436224b75e8" title=" " alt="" coords="1191,284,1305,311"/>
<area shape="rect" href="ioapic_8c.html#af53faf50e1deb43c645b04e30aebc18d" title=" " alt="" coords="446,81,605,108"/>
<area shape="rect" href="i8259_8c.html#a4fef735273cc243ab0c60985526cf753" title=" " alt="" coords="456,132,595,159"/>
<area shape="rect" href="i8259_8c.html#ac4af2817e73f33914b0f546581363266" title=" " alt="" coords="727,132,801,159"/>
<area shape="rect" href="i8259_8c.html#a1f534b69587aeb30f8853f3eb4a35071" title=" " alt="" coords="719,81,809,108"/>
<area shape="rect" href="lapic_8c.html#a1f4df169625f9c4c2cb06f7443698af4" title=" " alt="" coords="905,107,1096,133"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="939,56,1062,83"/>
<area shape="rect" href="lapic_8h.html#a1d8660ecbda996b11b10b179013e52d4" title=" " alt="" coords="1163,157,1333,184"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="1175,107,1321,133"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1400,107,1559,133"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1144,56,1352,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1171,5,1325,32"/>
<area shape="rect" href="kvm__main_8c.html#a75ccec7a81fef145fb3c3a3b5479a86f" title=" " alt="" coords="458,233,593,260"/>
<area shape="rect" href="kvm__main_8c.html#a3089edf2c0e5790aab7e8ed723f34b5b" title=" " alt="" coords="447,284,603,311"/>
<area shape="rect" href="kvm__main_8c.html#aa6d7dea09a0b657f29e92f424e5d0633" title=" " alt="" coords="671,309,857,336"/>
<area shape="rect" href="i8254_8c.html#a463a7ca46214654b0e8211d073fabe85" title=" " alt="" coords="464,385,587,412"/>
<area shape="rect" href="i8254_8c.html#ae2e061e06e6f24f6abb8d5c9f25117e7" title=" " alt="" coords="915,487,1086,513"/>
<area shape="rect" href="i8254_8c.html#a6a8ef8d836b61d44d7d0c09f47c0947d" title=" " alt="" coords="467,436,584,463"/>
<area shape="rect" href="i8254_8c.html#a89b5cec96a780f0f09cec72ac80ab7a0" title=" " alt="" coords="699,385,829,412"/>
<area shape="rect" href="i8254_8c.html#ae6008f5371680c0e5c243fa9172afc2a" title=" " alt="" coords="695,436,833,463"/>
<area shape="rect" href="ioapic_8h.html#a5efb8a822bd7119cfc8db075f12bf452" title=" " alt="" coords="937,348,1064,375"/>
<area shape="rect" href="irq__comm_8c.html#aa0e8495c42bef0a27d11e33d57141a78" title=" " alt="" coords="438,538,613,579"/>
<area shape="rect" href="irq__comm_8c.html#ab7342d01a08ebc59d23dc42d7feceaac" title=" " alt="" coords="451,603,599,645"/>
<area shape="rect" href="irq_8h.html#a504357f1b937154f9789bbff3e8c4db2" title=" " alt="" coords="428,720,623,747"/>
<area shape="rect" href="irqchip_8c.html#ae74716a6aebb89cbf4203d125f4afcf1" title=" " alt="" coords="474,771,577,797"/>
<area shape="rect" href="irqchip_8c.html#acc7a240bd02576a1c110b95979b88790" title=" " alt="" coords="695,771,833,797"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h_a13a38debbd4e494ffd488ef8abb5406c_icgraph.png" border="0" usemap="#ai8254_8h_a13a38debbd4e494ffd488ef8abb5406c_icgraph" alt=""/></div>
<map name="ai8254_8h_a13a38debbd4e494ffd488ef8abb5406c_icgraph" id="ai8254_8h_a13a38debbd4e494ffd488ef8abb5406c_icgraph">
<area shape="rect" title=" " alt="" coords="203,5,325,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a2a7ca7f5194b378ba7f0ae7a38cc26ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a7ca7f5194b378ba7f0ae7a38cc26ba">&#9670;&nbsp;</a></span>kvm_free_pit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_free_pit </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8c_source.html#l00736">736</a> of file <a class="el" href="i8254_8c_source.html">i8254.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;{</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__pit.html">kvm_pit</a> *pit = <a class="code" href="structkvm__pit.html#a34c504c36cc54dbdd9529c5be8ce851e">kvm</a>-&gt;arch.vpit;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">if</span> (pit) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        mutex_lock(&amp;<a class="code" href="structkvm__pit.html#a34c504c36cc54dbdd9529c5be8ce851e">kvm</a>-&gt;slots_lock);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <a class="code" href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897">kvm_io_bus_unregister_dev</a>(<a class="code" href="structkvm__pit.html#a34c504c36cc54dbdd9529c5be8ce851e">kvm</a>, KVM_PIO_BUS, &amp;pit-&gt;<a class="code" href="structkvm__pit.html#ab4b3784d112ba1278d47425b1d4d35ea">dev</a>);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <a class="code" href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897">kvm_io_bus_unregister_dev</a>(<a class="code" href="structkvm__pit.html#a34c504c36cc54dbdd9529c5be8ce851e">kvm</a>, KVM_PIO_BUS, &amp;pit-&gt;<a class="code" href="structkvm__pit.html#ad86795e9b81dc0e3db3039a25cfea8c6">speaker_dev</a>);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        mutex_unlock(&amp;<a class="code" href="structkvm__pit.html#a34c504c36cc54dbdd9529c5be8ce851e">kvm</a>-&gt;slots_lock);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <a class="code" href="i8254_8c.html#a27233516d999d8230f70ee545f0afd5f">kvm_pit_set_reinject</a>(pit, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        hrtimer_cancel(&amp;pit-&gt;<a class="code" href="structkvm__pit.html#abb2e4885b13425334895695603579ba9">pit_state</a>.<a class="code" href="structkvm__kpit__state.html#a45ff2ad602463461e13fafc4e95ef46c">timer</a>);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        kthread_destroy_worker(pit-&gt;<a class="code" href="structkvm__pit.html#a84645911923311ad3fab2d4abf5c78b2">worker</a>);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <a class="code" href="irq__comm_8c.html#affd624d06afb4fc277fb7a08e06bd942">kvm_free_irq_source_id</a>(<a class="code" href="structkvm__pit.html#a34c504c36cc54dbdd9529c5be8ce851e">kvm</a>, pit-&gt;<a class="code" href="structkvm__pit.html#a523b37c05bd13e6f9b55861269537e85">irq_source_id</a>);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        kfree(pit);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h_a2a7ca7f5194b378ba7f0ae7a38cc26ba_cgraph.png" border="0" usemap="#ai8254_8h_a2a7ca7f5194b378ba7f0ae7a38cc26ba_cgraph" alt=""/></div>
<map name="ai8254_8h_a2a7ca7f5194b378ba7f0ae7a38cc26ba_cgraph" id="ai8254_8h_a2a7ca7f5194b378ba7f0ae7a38cc26ba_cgraph">
<area shape="rect" title=" " alt="" coords="5,193,113,220"/>
<area shape="rect" href="irq__comm_8c.html#affd624d06afb4fc277fb7a08e06bd942" title=" " alt="" coords="175,81,352,108"/>
<area shape="rect" href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897" title=" " alt="" coords="161,193,365,220"/>
<area shape="rect" href="i8254_8c.html#a27233516d999d8230f70ee545f0afd5f" title=" " alt="" coords="184,273,343,300"/>
<area shape="rect" href="irq_8h.html#aeedc8b3b9e709414b2db2436224b75e8" title=" " alt="" coords="444,5,557,32"/>
<area shape="rect" href="ioapic_8c.html#af53faf50e1deb43c645b04e30aebc18d" title=" " alt="" coords="421,56,580,83"/>
<area shape="rect" href="i8259_8c.html#a4fef735273cc243ab0c60985526cf753" title=" " alt="" coords="431,107,570,133"/>
<area shape="rect" href="i8259_8c.html#ac4af2817e73f33914b0f546581363266" title=" " alt="" coords="692,69,767,96"/>
<area shape="rect" href="i8259_8c.html#a1f534b69587aeb30f8853f3eb4a35071" title=" " alt="" coords="684,120,775,147"/>
<area shape="rect" href="lapic_8c.html#a1f4df169625f9c4c2cb06f7443698af4" title=" " alt="" coords="871,95,1061,121"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="905,145,1027,172"/>
<area shape="rect" href="lapic_8h.html#a1d8660ecbda996b11b10b179013e52d4" title=" " alt="" coords="1128,44,1299,71"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="1141,95,1286,121"/>
<area shape="rect" href="lapic_8h.html#aa28a43e0f54449e2ec4d25e1f8ecb178" title=" " alt="" coords="1365,95,1524,121"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1109,145,1317,172"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1137,196,1290,223"/>
<area shape="rect" href="kvm__main_8c.html#a3089edf2c0e5790aab7e8ed723f34b5b" title=" " alt="" coords="423,157,579,184"/>
<area shape="rect" href="kvm__main_8c.html#aa6d7dea09a0b657f29e92f424e5d0633" title=" " alt="" coords="636,183,823,209"/>
<area shape="rect" href="i8254_8c.html#ae2e061e06e6f24f6abb8d5c9f25117e7" title=" " alt="" coords="415,259,586,285"/>
<area shape="rect" href="irq__comm_8c.html#aa0e8495c42bef0a27d11e33d57141a78" title=" " alt="" coords="413,310,588,351"/>
<area shape="rect" href="irq__comm_8c.html#ab7342d01a08ebc59d23dc42d7feceaac" title=" " alt="" coords="427,375,575,417"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h_a2a7ca7f5194b378ba7f0ae7a38cc26ba_icgraph.png" border="0" usemap="#ai8254_8h_a2a7ca7f5194b378ba7f0ae7a38cc26ba_icgraph" alt=""/></div>
<map name="ai8254_8h_a2a7ca7f5194b378ba7f0ae7a38cc26ba_icgraph" id="ai8254_8h_a2a7ca7f5194b378ba7f0ae7a38cc26ba_icgraph">
<area shape="rect" title=" " alt="" coords="1121,208,1229,235"/>
<area shape="rect" href="x86_8c.html#a6f324dc73c5f97fe0b9dfa35f303d5f9" title=" " alt="" coords="899,208,1073,235"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="716,208,851,235"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="553,208,668,235"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="325,5,475,32"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="317,56,483,83"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="303,107,497,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="323,157,477,184"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="295,208,505,235"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="314,259,486,301"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="333,325,467,352"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="329,376,471,403"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="335,427,465,453"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="47,5,205,32"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="5,376,247,403"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="59,427,193,453"/>
</map>
</div>

</div>
</div>
<a id="a1923c65ac30fa3d71f7b76ab4b1797cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1923c65ac30fa3d71f7b76ab4b1797cc">&#9670;&nbsp;</a></span>kvm_pit_load_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pit_load_count </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkvm__pit.html">kvm_pit</a> *&#160;</td>
          <td class="paramname"><em>pit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>hpet_legacy_start</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8c_source.html#l00403">403</a> of file <a class="el" href="i8254_8c_source.html">i8254.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;{</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    u8 saved_mode;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    WARN_ON_ONCE(!mutex_is_locked(&amp;pit-&gt;<a class="code" href="structkvm__pit.html#abb2e4885b13425334895695603579ba9">pit_state</a>.<a class="code" href="structkvm__kpit__state.html#a0f46a0a453711ca8668d56c9f009b431">lock</a>));</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> (hpet_legacy_start) {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="comment">/* save existing mode for later reenablement */</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        WARN_ON(channel != 0);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        saved_mode = pit-&gt;<a class="code" href="structkvm__pit.html#abb2e4885b13425334895695603579ba9">pit_state</a>.<a class="code" href="structkvm__kpit__state.html#abff57a03b2a54626002dde51a7201b7c">channels</a>[0].<a class="code" href="structkvm__kpit__channel__state.html#acb6e59e6196f649750d883e3a7dee25b">mode</a>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        pit-&gt;<a class="code" href="structkvm__pit.html#abb2e4885b13425334895695603579ba9">pit_state</a>.<a class="code" href="structkvm__kpit__state.html#abff57a03b2a54626002dde51a7201b7c">channels</a>[0].<a class="code" href="structkvm__kpit__channel__state.html#acb6e59e6196f649750d883e3a7dee25b">mode</a> = 0xff; <span class="comment">/* disable timer */</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <a class="code" href="i8254_8c.html#a6a8ef8d836b61d44d7d0c09f47c0947d">pit_load_count</a>(pit, channel, val);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        pit-&gt;<a class="code" href="structkvm__pit.html#abb2e4885b13425334895695603579ba9">pit_state</a>.<a class="code" href="structkvm__kpit__state.html#abff57a03b2a54626002dde51a7201b7c">channels</a>[0].<a class="code" href="structkvm__kpit__channel__state.html#acb6e59e6196f649750d883e3a7dee25b">mode</a> = saved_mode;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="i8254_8c.html#a6a8ef8d836b61d44d7d0c09f47c0947d">pit_load_count</a>(pit, channel, val);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div>
<div class="ttc" id="ai8254_8c_html_a6a8ef8d836b61d44d7d0c09f47c0947d"><div class="ttname"><a href="i8254_8c.html#a6a8ef8d836b61d44d7d0c09f47c0947d">pit_load_count</a></div><div class="ttdeci">static void pit_load_count(struct kvm_pit *pit, int channel, u32 val)</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00365">i8254.c:365</a></div></div>
<div class="ttc" id="astructkvm__kpit__channel__state_html_acb6e59e6196f649750d883e3a7dee25b"><div class="ttname"><a href="structkvm__kpit__channel__state.html#acb6e59e6196f649750d883e3a7dee25b">kvm_kpit_channel_state::mode</a></div><div class="ttdeci">u8 mode</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00019">i8254.h:19</a></div></div>
<div class="ttc" id="astructkvm__kpit__state_html_abff57a03b2a54626002dde51a7201b7c"><div class="ttname"><a href="structkvm__kpit__state.html#abff57a03b2a54626002dde51a7201b7c">kvm_kpit_state::channels</a></div><div class="ttdeci">struct kvm_kpit_channel_state channels[3]</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00022">i8254.h:27</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h_a1923c65ac30fa3d71f7b76ab4b1797cc_cgraph.png" border="0" usemap="#ai8254_8h_a1923c65ac30fa3d71f7b76ab4b1797cc_cgraph" alt=""/></div>
<map name="ai8254_8h_a1923c65ac30fa3d71f7b76ab4b1797cc_cgraph" id="ai8254_8h_a1923c65ac30fa3d71f7b76ab4b1797cc_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,159,83"/>
<area shape="rect" href="i8254_8c.html#a6a8ef8d836b61d44d7d0c09f47c0947d" title=" " alt="" coords="207,56,324,83"/>
<area shape="rect" href="i8254_8c.html#a89b5cec96a780f0f09cec72ac80ab7a0" title=" " alt="" coords="376,31,505,57"/>
<area shape="rect" href="i8254_8c.html#ae6008f5371680c0e5c243fa9172afc2a" title=" " alt="" coords="372,81,509,108"/>
<area shape="rect" href="ioapic_8h.html#a5efb8a822bd7119cfc8db075f12bf452" title=" " alt="" coords="579,5,706,32"/>
<area shape="rect" href="i8254_8c.html#ae2e061e06e6f24f6abb8d5c9f25117e7" title=" " alt="" coords="557,56,728,83"/>
<area shape="rect" href="irq_8h.html#aeedc8b3b9e709414b2db2436224b75e8" title=" " alt="" coords="776,5,889,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h_a1923c65ac30fa3d71f7b76ab4b1797cc_icgraph.png" border="0" usemap="#ai8254_8h_a1923c65ac30fa3d71f7b76ab4b1797cc_icgraph" alt=""/></div>
<map name="ai8254_8h_a1923c65ac30fa3d71f7b76ab4b1797cc_icgraph" id="ai8254_8h_a1923c65ac30fa3d71f7b76ab4b1797cc_icgraph">
<area shape="rect" title=" " alt="" coords="424,31,577,57"/>
<area shape="rect" href="x86_8c.html#a90567ae1ea3bae8ea80f4f1b4879e386" title=" " alt="" coords="207,5,372,32"/>
<area shape="rect" href="x86_8c.html#ae5fcca42c431b017a3f1f4597679737e" title=" " alt="" coords="203,56,376,83"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,31,155,57"/>
</map>
</div>

</div>
</div>
<a id="a27233516d999d8230f70ee545f0afd5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27233516d999d8230f70ee545f0afd5f">&#9670;&nbsp;</a></span>kvm_pit_set_reinject()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pit_set_reinject </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkvm__pit.html">kvm_pit</a> *&#160;</td>
          <td class="paramname"><em>pit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reinject</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="i8254_8c_source.html#l00291">291</a> of file <a class="el" href="i8254_8c_source.html">i8254.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;{</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__kpit__state.html">kvm_kpit_state</a> *ps = &amp;pit-&gt;<a class="code" href="structkvm__pit.html#abb2e4885b13425334895695603579ba9">pit_state</a>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keyword">struct </span>kvm *kvm = pit-&gt;<a class="code" href="structkvm__pit.html#a34c504c36cc54dbdd9529c5be8ce851e">kvm</a>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span> (atomic_read(&amp;ps-&gt;<a class="code" href="structkvm__kpit__state.html#a52ccb035612a44372a60a8b455c35ddc">reinject</a>) == reinject)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">     * AMD SVM AVIC accelerates EOI write and does not trap.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">     * This cause in-kernel PIT re-inject mode to fail</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">     * since it checks ps-&gt;irq_ack before kvm_set_irq()</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">     * and relies on the ack notifier to timely queue</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">     * the pt-&gt;worker work iterm and reinject the missed tick.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">     * So, deactivate APICv when PIT is in reinject mode.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (reinject) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        kvm_set_apicv_inhibit(kvm, APICV_INHIBIT_REASON_PIT_REINJ);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="comment">/* The initial state is preserved while ps-&gt;reinject == 0. */</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <a class="code" href="i8254_8c.html#ae2e061e06e6f24f6abb8d5c9f25117e7">kvm_pit_reset_reinject</a>(pit);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        kvm_register_irq_ack_notifier(kvm, &amp;ps-&gt;<a class="code" href="structkvm__kpit__state.html#adeaad7cdf8669923ea66be2165c37169">irq_ack_notifier</a>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <a class="code" href="irq__comm_8c.html#aa0e8495c42bef0a27d11e33d57141a78">kvm_register_irq_mask_notifier</a>(kvm, 0, &amp;pit-&gt;<a class="code" href="structkvm__pit.html#a5e43edb76a6111447bb76fd30ef05aaa">mask_notifier</a>);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        kvm_clear_apicv_inhibit(kvm, APICV_INHIBIT_REASON_PIT_REINJ);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        kvm_unregister_irq_ack_notifier(kvm, &amp;ps-&gt;<a class="code" href="structkvm__kpit__state.html#adeaad7cdf8669923ea66be2165c37169">irq_ack_notifier</a>);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <a class="code" href="irq__comm_8c.html#ab7342d01a08ebc59d23dc42d7feceaac">kvm_unregister_irq_mask_notifier</a>(kvm, 0, &amp;pit-&gt;<a class="code" href="structkvm__pit.html#a5e43edb76a6111447bb76fd30ef05aaa">mask_notifier</a>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    atomic_set(&amp;ps-&gt;<a class="code" href="structkvm__kpit__state.html#a52ccb035612a44372a60a8b455c35ddc">reinject</a>, reinject);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;}</div>
<div class="ttc" id="ai8254_8c_html_ae2e061e06e6f24f6abb8d5c9f25117e7"><div class="ttname"><a href="i8254_8c.html#ae2e061e06e6f24f6abb8d5c9f25117e7">kvm_pit_reset_reinject</a></div><div class="ttdeci">static void kvm_pit_reset_reinject(struct kvm_pit *pit)</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8c_source.html#l00285">i8254.c:285</a></div></div>
<div class="ttc" id="airq__comm_8c_html_aa0e8495c42bef0a27d11e33d57141a78"><div class="ttname"><a href="irq__comm_8c.html#aa0e8495c42bef0a27d11e33d57141a78">kvm_register_irq_mask_notifier</a></div><div class="ttdeci">void kvm_register_irq_mask_notifier(struct kvm *kvm, int irq, struct kvm_irq_mask_notifier *kimn)</div><div class="ttdef"><b>Definition:</b> <a href="irq__comm_8c_source.html#l00241">irq_comm.c:241</a></div></div>
<div class="ttc" id="airq__comm_8c_html_ab7342d01a08ebc59d23dc42d7feceaac"><div class="ttname"><a href="irq__comm_8c.html#ab7342d01a08ebc59d23dc42d7feceaac">kvm_unregister_irq_mask_notifier</a></div><div class="ttdeci">void kvm_unregister_irq_mask_notifier(struct kvm *kvm, int irq, struct kvm_irq_mask_notifier *kimn)</div><div class="ttdef"><b>Definition:</b> <a href="irq__comm_8c_source.html#l00250">irq_comm.c:250</a></div></div>
<div class="ttc" id="astructkvm__kpit__state_html_a52ccb035612a44372a60a8b455c35ddc"><div class="ttname"><a href="structkvm__kpit__state.html#a52ccb035612a44372a60a8b455c35ddc">kvm_kpit_state::reinject</a></div><div class="ttdeci">atomic_t reinject</div><div class="ttdef"><b>Definition:</b> <a href="i8254_8h_source.html#l00034">i8254.h:34</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h_a27233516d999d8230f70ee545f0afd5f_cgraph.png" border="0" usemap="#ai8254_8h_a27233516d999d8230f70ee545f0afd5f_cgraph" alt=""/></div>
<map name="ai8254_8h_a27233516d999d8230f70ee545f0afd5f_cgraph" id="ai8254_8h_a27233516d999d8230f70ee545f0afd5f_cgraph">
<area shape="rect" title=" " alt="" coords="5,64,164,91"/>
<area shape="rect" href="i8254_8c.html#ae2e061e06e6f24f6abb8d5c9f25117e7" title=" " alt="" coords="214,5,385,32"/>
<area shape="rect" href="irq__comm_8c.html#aa0e8495c42bef0a27d11e33d57141a78" title=" " alt="" coords="212,57,387,98"/>
<area shape="rect" href="irq__comm_8c.html#ab7342d01a08ebc59d23dc42d7feceaac" title=" " alt="" coords="225,122,373,163"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="i8254_8h_a27233516d999d8230f70ee545f0afd5f_icgraph.png" border="0" usemap="#ai8254_8h_a27233516d999d8230f70ee545f0afd5f_icgraph" alt=""/></div>
<map name="ai8254_8h_a27233516d999d8230f70ee545f0afd5f_icgraph" id="ai8254_8h_a27233516d999d8230f70ee545f0afd5f_icgraph">
<area shape="rect" title=" " alt="" coords="1340,157,1499,184"/>
<area shape="rect" href="i8254_8c.html#a13a38debbd4e494ffd488ef8abb5406c" title=" " alt="" coords="1145,107,1268,133"/>
<area shape="rect" href="i8254_8c.html#a2a7ca7f5194b378ba7f0ae7a38cc26ba" title=" " alt="" coords="1153,208,1261,235"/>
<area shape="rect" href="x86_8c.html#a38137bd6d02c5ae30d3751637d6f16bf" title=" " alt="" coords="1121,157,1292,184"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="911,132,1061,159"/>
<area shape="rect" href="x86_8c.html#a6f324dc73c5f97fe0b9dfa35f303d5f9" title=" " alt="" coords="899,208,1073,235"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="716,208,851,235"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="553,208,668,235"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="325,5,475,32"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="317,56,483,83"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="303,107,497,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="323,157,477,184"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="295,208,505,235"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="314,259,486,301"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="333,325,467,352"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="329,376,471,403"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="335,427,465,453"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="47,5,205,32"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="5,376,247,403"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="59,427,193,453"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
