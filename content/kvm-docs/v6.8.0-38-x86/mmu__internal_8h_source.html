<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/x86/kvm/mmu/mmu_internal.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_c21774f8bc9f0de15163573e5f5fa2b5.html">x86</a></li><li class="navelem"><a class="el" href="dir_fde450fd4b58e2560c53a1e73bfa4d6d.html">kvm</a></li><li class="navelem"><a class="el" href="dir_5b5419bab78eb3e26ed0c43edf6fed27.html">mmu</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">mmu_internal.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mmu__internal_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* SPDX-License-Identifier: GPL-2.0 */</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#ifndef __KVM_X86_MMU_INTERNAL_H</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#define __KVM_X86_MMU_INTERNAL_H</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;linux/types.h&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;linux/kvm_host.h&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;asm/kvm_host.h&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#ifdef CONFIG_KVM_PROVE_MMU</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#define KVM_MMU_WARN_ON(x) WARN_ON_ONCE(x)</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00012"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a687a3432a6f9b4c6f600cb8b945ff3af">   12</a></span>&#160;<span class="preprocessor">#define KVM_MMU_WARN_ON(x) BUILD_BUG_ON_INVALID(x)</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/* Page table builder macros common to shadow (host) PTEs and guest PTEs. */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a4b6970d6633932672fc70d928d33caf7">   16</a></span>&#160;<span class="preprocessor">#define __PT_BASE_ADDR_MASK GENMASK_ULL(51, 12)</span></div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a04121414999dc564561467fb67c56e20">   17</a></span>&#160;<span class="preprocessor">#define __PT_LEVEL_SHIFT(level, bits_per_level) \</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">    (PAGE_SHIFT + ((level) - 1) * (bits_per_level))</span></div>
<div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ae517cada2296a9b8146861ea38acb20f">   19</a></span>&#160;<span class="preprocessor">#define __PT_INDEX(address, level, bits_per_level) \</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">    (((address) &gt;&gt; __PT_LEVEL_SHIFT(level, bits_per_level)) &amp; ((1 &lt;&lt; (bits_per_level)) - 1))</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a7834b038f6e9c92ecb58615b0dde56cb">   22</a></span>&#160;<span class="preprocessor">#define __PT_LVL_ADDR_MASK(base_addr_mask, level, bits_per_level) \</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">    ((base_addr_mask) &amp; ~((1ULL &lt;&lt; (PAGE_SHIFT + (((level) - 1) * (bits_per_level)))) - 1))</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ad6693d6a5ca8c28c635e8e64d200ecd1">   25</a></span>&#160;<span class="preprocessor">#define __PT_LVL_OFFSET_MASK(base_addr_mask, level, bits_per_level) \</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">    ((base_addr_mask) &amp; ((1ULL &lt;&lt; (PAGE_SHIFT + (((level) - 1) * (bits_per_level)))) - 1))</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a199e92057728f48c65a7f4a50f20837c">   28</a></span>&#160;<span class="preprocessor">#define __PT_ENT_PER_PAGE(bits_per_level)  (1 &lt;&lt; (bits_per_level))</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * Unlike regular MMU roots, PAE &quot;roots&quot;, a.k.a. PDPTEs/PDPTRs, have a PRESENT</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * bit, and thus are guaranteed to be non-zero when valid.  And, when a guest</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * PDPTR is !PRESENT, its corresponding PAE root cannot be set to INVALID_PAGE,</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * as the CPU would treat that as PRESENT PDPTR with reserved bits set.  Use</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * &#39;0&#39; instead of INVALID_PAGE to indicate an invalid PAE root.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a8f1ae2be3c5d65c1cf9f7e05a1b1865f">   37</a></span>&#160;<span class="preprocessor">#define INVALID_PAE_ROOT    0</span></div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a14bc6bffc6f94f99aefd177e15fb6d90">   38</a></span>&#160;<span class="preprocessor">#define IS_VALID_PAE_ROOT(x)    (!!(x))</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a0eb4da3250f15ed351ae2f0acc485870">   40</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> hpa_t <a class="code" href="mmu__internal_8h.html#a0eb4da3250f15ed351ae2f0acc485870">kvm_mmu_get_dummy_root</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;{</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">return</span> my_zero_pfn(0) &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a6491934fd3538f608b4b91245943b6fc">   45</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="mmu__internal_8h.html#a6491934fd3538f608b4b91245943b6fc">kvm_mmu_is_dummy_root</a>(hpa_t shadow_page)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">return</span> is_zero_pfn(shadow_page &gt;&gt; PAGE_SHIFT);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">   50</a></span>&#160;<span class="keyword">typedef</span> u64 __rcu *<a class="code" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html">   52</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">     * Note, &quot;link&quot; through &quot;spt&quot; fit in a single 64 byte cache line on</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">     * 64-bit kernels, keep it that way unless there&#39;s a reason not to.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keyword">struct </span>list_head <a class="code" href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">link</a>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keyword">struct </span>hlist_node <a class="code" href="structkvm__mmu__page.html#a0ec9f1326e5a7d1f191512f0b2e327c3">hash_link</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#aaa85f786ecee91a190d244221531622b">   60</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structkvm__mmu__page.html#aaa85f786ecee91a190d244221531622b">tdp_mmu_page</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#a9bd31c4eeee99f7c16e11b9c0fd4c347">   61</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structkvm__mmu__page.html#a9bd31c4eeee99f7c16e11b9c0fd4c347">unsync</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keyword">union </span>{</div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#ab4beaf5fd91de28bba9ed52bc0b01ba3">   63</a></span>&#160;        u8 <a class="code" href="structkvm__mmu__page.html#ab4beaf5fd91de28bba9ed52bc0b01ba3">mmu_valid_gen</a>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="comment">/* Only accessed under slots_lock.  */</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#a4be3912894be6a937cad4c54708edaa4">   66</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="structkvm__mmu__page.html#a4be3912894be6a937cad4c54708edaa4">tdp_mmu_scheduled_root_to_zap</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    };</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;     <span class="comment">/*</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">      * The shadow page can&#39;t be replaced by an equivalent huge page</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">      * because it is being used to map an executable page in the guest</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">      * and the NX huge page mitigation is enabled.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#a48fdf70976937b2e4cc3e8265ffa5676">   74</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structkvm__mmu__page.html#a48fdf70976937b2e4cc3e8265ffa5676">nx_huge_page_disallowed</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">     * The following two entries are used to key the shadow page in the</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">     * hash table.</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keyword">union </span>kvm_mmu_page_role <a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">   81</a></span>&#160;    gfn_t <a class="code" href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">gfn</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">   83</a></span>&#160;    u64 *<a class="code" href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">spt</a>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">     * Stores the result of the guest translation being shadowed by each</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">     * SPTE.  KVM shadows two types of guest translations: nGPA -&gt; GPA</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">     * (shadow EPT/NPT) and GVA -&gt; GPA (traditional shadow paging). In both</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">     * cases the result of the translation is a GPA and a set of access</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">     * constraints.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">     * The GFN is stored in the upper bits (PAGE_SHIFT) and the shadowed</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">     * access permissions are stored in the lower bits. Note, for</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">     * convenience and uniformity across guests, the access permissions are</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">     * stored in KVM format (e.g.  ACC_EXEC_MASK) not the raw guest format.</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#a9cf2fdfa558f2e17f959875d9f1a22df">   97</a></span>&#160;    u64 *<a class="code" href="structkvm__mmu__page.html#a9cf2fdfa558f2e17f959875d9f1a22df">shadowed_translation</a>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">/* Currently serving as active root */</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keyword">union </span>{</div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#aa2708cf3e50a50dc58798c0e672f401a">  101</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="structkvm__mmu__page.html#aa2708cf3e50a50dc58798c0e672f401a">root_count</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#ad2696be212b4eb39f555e55eac226b7f">  102</a></span>&#160;        refcount_t <a class="code" href="structkvm__mmu__page.html#a41397fd72948cc7002b169d2fb3aba5f">tdp_mmu_root_count</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    };</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#a052dfb1302a401b2b4032fb469870e48">  104</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkvm__mmu__page.html#a052dfb1302a401b2b4032fb469870e48">unsync_children</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keyword">union </span>{</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keyword">struct </span>kvm_rmap_head <a class="code" href="structkvm__mmu__page.html#ad2696be212b4eb39f555e55eac226b7f">parent_ptes</a>; <span class="comment">/* rmap pointers to parent sptes */</span></div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#a354e43de3a7ea16fee41005505982422">  107</a></span>&#160;        <a class="code" href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a> <a class="code" href="structkvm__mmu__page.html#a354e43de3a7ea16fee41005505982422">ptep</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    };</div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#a65e8d93a777ad8a7fae49173f4b59061">  109</a></span>&#160;    <a class="code" href="structkvm__mmu__page.html#a65e8d93a777ad8a7fae49173f4b59061">DECLARE_BITMAP</a>(unsync_child_bitmap, 512);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">     * Tracks shadow pages that, if zapped, would allow KVM to create an NX</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">     * huge page.  A shadow page will have nx_huge_page_disallowed set but</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">     * not be on the list if a huge page is disallowed for other reasons,</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">     * e.g. because KVM is shadowing a PTE at the same gfn, the memslot</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">     * isn&#39;t properly aligned, etc...</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keyword">struct </span>list_head <a class="code" href="structkvm__mmu__page.html#a6a67c3f1dd304ec2730973d68f6ac4f7">possible_nx_huge_page_link</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_32</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">     * Used out of the mmu-lock to avoid reading spte values while an</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">     * update is in progress; see the comments in __get_spte_lockless().</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">int</span> clear_spte_count;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">/* Number of writes since the last time traversal visited this page.  */</span></div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#aef1e01f2353ce632d7ce416124d2e557">  128</a></span>&#160;    atomic_t <a class="code" href="structkvm__mmu__page.html#aef1e01f2353ce632d7ce416124d2e557">write_flooding_count</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">/* Used for freeing the page asynchronously if it is a TDP MMU page. */</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keyword">struct </span>rcu_head rcu_head;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;};</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="keyword">extern</span> <span class="keyword">struct </span>kmem_cache *<a class="code" href="mmu__internal_8h.html#a3634b84158ea95896b7dcbbb228c309c">mmu_page_header_cache</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac">  138</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac">kvm_mmu_role_as_id</a>(<span class="keyword">union</span> kvm_mmu_page_role role)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;{</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">return</span> role.smm ? 1 : 0;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79">  143</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79">kvm_mmu_page_as_id</a>(<span class="keyword">struct</span> <a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac">kvm_mmu_role_as_id</a>(sp-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5">  148</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5">kvm_mmu_page_ad_need_write_protect</a>(<span class="keyword">struct</span> <a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;{</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">     * When using the EPT page-modification log, the GPAs in the CPU dirty</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">     * log would come from L2 rather than L1.  Therefore, we need to rely</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">     * on write protection to record dirty pages, which bypasses PML, since</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">     * writes now result in a vmexit.  Note, the check on CPU dirty logging</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">     * being enabled is mandatory as the bits used to denote WP-only SPTEs</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">     * are reserved for PAE paging (32-bit KVM).</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">return</span> kvm_x86_ops.cpu_dirty_log_size &amp;&amp; sp-&gt;<a class="code" href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">role</a>.guest_mode;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5">  161</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> gfn_t <a class="code" href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5">gfn_round_for_level</a>(gfn_t gfn, <span class="keywordtype">int</span> level)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">return</span> gfn &amp; -KVM_PAGES_PER_HPAGE(level);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keywordtype">int</span> <a class="code" href="mmu__internal_8h.html#af8846daf6e76a8d619fba16ff979245b">mmu_try_to_unsync_pages</a>(<span class="keyword">struct</span> kvm *kvm, <span class="keyword">const</span> <span class="keyword">struct</span> kvm_memory_slot *slot,</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                gfn_t gfn, <span class="keywordtype">bool</span> can_unsync, <span class="keywordtype">bool</span> prefetch);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keywordtype">void</span> <a class="code" href="mmu__internal_8h.html#ae0ba561823d6dcc90bc489e0a51867a7">kvm_mmu_gfn_disallow_lpage</a>(<span class="keyword">const</span> <span class="keyword">struct</span> kvm_memory_slot *slot, gfn_t gfn);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="keywordtype">void</span> <a class="code" href="mmu__internal_8h.html#a8726aec6b800501379c831dad5432043">kvm_mmu_gfn_allow_lpage</a>(<span class="keyword">const</span> <span class="keyword">struct</span> kvm_memory_slot *slot, gfn_t gfn);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="mmu__internal_8h.html#a1f49638b71a482e4b0c3a6af10d0711e">kvm_mmu_slot_gfn_write_protect</a>(<span class="keyword">struct</span> kvm *kvm,</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    <span class="keyword">struct</span> kvm_memory_slot *slot, u64 gfn,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    <span class="keywordtype">int</span> min_level);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">/* Flush the given page (huge or not) of guest memory. */</span></div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e">  176</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e">kvm_flush_remote_tlbs_gfn</a>(<span class="keyword">struct</span> kvm *kvm, gfn_t gfn, <span class="keywordtype">int</span> level)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f">kvm_flush_remote_tlbs_range</a>(kvm, <a class="code" href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5">gfn_round_for_level</a>(gfn, level),</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                    KVM_PAGES_PER_HPAGE(level));</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mmu__internal_8h.html#a4dc99f06253cd18d05d8260cc30447ea">pte_list_count</a>(<span class="keyword">struct</span> kvm_rmap_head *rmap_head);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="mmu__internal_8h.html#a44e186baf100df677a2d62072a7959ad">nx_huge_pages</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a8a367cbfff40c5c72d6f19049da9fc51">  185</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="mmu__internal_8h.html#a8a367cbfff40c5c72d6f19049da9fc51">is_nx_huge_page_enabled</a>(<span class="keyword">struct</span> kvm *kvm)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;{</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">return</span> READ_ONCE(<a class="code" href="mmu__internal_8h.html#a44e186baf100df677a2d62072a7959ad">nx_huge_pages</a>) &amp;&amp; !kvm-&gt;arch.disable_nx_huge_pages;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html">  190</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structkvm__page__fault.html">kvm_page_fault</a> {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">/* arguments to kvm_mmu_do_page_fault.  */</span></div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#ad365933476cc66359bfc9233440ddab0">  192</a></span>&#160;    <span class="keyword">const</span> gpa_t <a class="code" href="structkvm__page__fault.html#ad365933476cc66359bfc9233440ddab0">addr</a>;</div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a336b33c76427ea615bafb91e1021fa13">  193</a></span>&#160;    <span class="keyword">const</span> u32 <a class="code" href="structkvm__page__fault.html#a336b33c76427ea615bafb91e1021fa13">error_code</a>;</div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a2226254b058797ac61a2b5347d1877bd">  194</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#a2226254b058797ac61a2b5347d1877bd">prefetch</a>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">/* Derived from error_code.  */</span></div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#aebd17cd723773f8d26e5910faa4f6b7d">  197</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#aebd17cd723773f8d26e5910faa4f6b7d">exec</a>;</div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a366b2dee3b9a362d1b8a759bfd92bcae">  198</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#a366b2dee3b9a362d1b8a759bfd92bcae">write</a>;</div>
<div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#aab31660ce259b441376e3c2ba4ce7ea4">  199</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#aab31660ce259b441376e3c2ba4ce7ea4">present</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#af09b3cf7b0f69922b629bd2c257a4133">  200</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#af09b3cf7b0f69922b629bd2c257a4133">rsvd</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a518c55075aa2d4de37d777fe9e1c936b">  201</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#a518c55075aa2d4de37d777fe9e1c936b">user</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">/* Derived from mmu and global state.  */</span></div>
<div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a76a59490f94982c504342f55b98fa989">  204</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#a76a59490f94982c504342f55b98fa989">is_tdp</a>;</div>
<div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#ab2de0f5ce7803d5f87dfbecc552541e4">  205</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#ab2de0f5ce7803d5f87dfbecc552541e4">is_private</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a8c1b32bdc3f59a2c3ffca8cc919b5ef3">  206</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#a8c1b32bdc3f59a2c3ffca8cc919b5ef3">nx_huge_page_workaround_enabled</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">     * Whether a &gt;4KB mapping can be created or is forbidden due to NX</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">     * hugepages.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a421a772100b124af81fb35768801c6bc">  212</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#a421a772100b124af81fb35768801c6bc">huge_page_disallowed</a>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">     * Maximum page size that can be created for this fault; input to</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">     * FNAME(fetch), direct_map() and kvm_tdp_mmu_map().</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#ab5cc4b80577775008ffd38c21b75d2b6">  218</a></span>&#160;    u8 <a class="code" href="structkvm__page__fault.html#ab5cc4b80577775008ffd38c21b75d2b6">max_level</a>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">     * Page size that can be created based on the max_level and the</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">     * page size used by the host mapping.</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a8ffa43a08e1131c59b2597d86a616b26">  224</a></span>&#160;    u8 <a class="code" href="structkvm__page__fault.html#a8ffa43a08e1131c59b2597d86a616b26">req_level</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">     * Page size that will be created based on the req_level and</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">     * huge_page_disallowed.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#ad6705ad5f00efe4e9e47328860e9634a">  230</a></span>&#160;    u8 <a class="code" href="structkvm__page__fault.html#ad6705ad5f00efe4e9e47328860e9634a">goal_level</a>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">/* Shifted addr, or result of guest page table walk if addr is a gva.  */</span></div>
<div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a27031ff0dd2c0b28283774456a29f066">  233</a></span>&#160;    gfn_t <a class="code" href="structkvm__page__fault.html#a27031ff0dd2c0b28283774456a29f066">gfn</a>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">/* The memslot containing gfn. May be NULL. */</span></div>
<div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a94ca2315c94da3e5ab0273b78ff6da3a">  236</a></span>&#160;    <span class="keyword">struct </span>kvm_memory_slot *<a class="code" href="structkvm__page__fault.html#a94ca2315c94da3e5ab0273b78ff6da3a">slot</a>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">/* Outputs of kvm_faultin_pfn.  */</span></div>
<div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a344ea13707eed7d867de69c640f996c4">  239</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structkvm__page__fault.html#a344ea13707eed7d867de69c640f996c4">mmu_seq</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a784cc6d936bf4aa03731c0620e334553">  240</a></span>&#160;    kvm_pfn_t <a class="code" href="structkvm__page__fault.html#a784cc6d936bf4aa03731c0620e334553">pfn</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a65ea5c8294b46a4efcd7db0ba9f77446">  241</a></span>&#160;    hva_t <a class="code" href="structkvm__page__fault.html#a65ea5c8294b46a4efcd7db0ba9f77446">hva</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#aff41947455b49de1c0e9d1fddc7273e5">  242</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#aff41947455b49de1c0e9d1fddc7273e5">map_writable</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">     * Indicates the guest is trying to write a gfn that contains one or</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">     * more of the PTEs used to translate the write itself, i.e. the access</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">     * is changing its own translation in the guest page tables.</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="structkvm__page__fault.html#a126cca48df9411a45bb88d3c1a74d95c">  249</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structkvm__page__fault.html#a126cca48df9411a45bb88d3c1a74d95c">write_fault_to_shadow_pgtable</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;};</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="keywordtype">int</span> <a class="code" href="mmu__internal_8h.html#a4bd7a8fd81e65c4e06e025d92c5787d9">kvm_tdp_page_fault</a>(<span class="keyword">struct</span> kvm_vcpu *vcpu, <span class="keyword">struct</span> <a class="code" href="structkvm__page__fault.html">kvm_page_fault</a> *fault);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"> * Return values of handle_mmio_page_fault(), mmu.page_fault(), fast_page_fault(),</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"> * and of course kvm_mmu_do_page_fault().</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment"> * RET_PF_CONTINUE: So far, so good, keep handling the page fault.</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment"> * RET_PF_RETRY: let CPU fault again on the address.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"> * RET_PF_EMULATE: mmio page fault, emulate the instruction directly.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"> * RET_PF_INVALID: the spte is invalid, let the real page fault path update it.</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment"> * RET_PF_FIXED: The faulting entry has been fixed.</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"> * RET_PF_SPURIOUS: The faulting entry was already fixed, e.g. by another vCPU.</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"> * Any names added to this enum should be exported to userspace for use in</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"> * tracepoints via TRACE_DEFINE_ENUM() in mmutrace.h</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment"> * Note, all values must be greater than or equal to zero so as not to encroach</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment"> * on -errno return values.  Somewhat arbitrarily use &#39;0&#39; for CONTINUE, which</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"> * will allow for efficient machine code when checking for CONTINUE, e.g.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment"> * &quot;TEST %rax, %rax, JNZ&quot;, as all &quot;stop!&quot; values are non-zero.</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="keyword">enum</span> {</div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ae095ef51afca86f2bdb6c756039c88fb">  274</a></span>&#160;    <a class="code" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ae095ef51afca86f2bdb6c756039c88fb">RET_PF_CONTINUE</a> = 0,</div>
<div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5f8c25625c45554fecc5a5b95e63a2e5">  275</a></span>&#160;    <a class="code" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5f8c25625c45554fecc5a5b95e63a2e5">RET_PF_RETRY</a>,</div>
<div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ad03187d2c9f578d70424cf6ecd860cc8">  276</a></span>&#160;    <a class="code" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ad03187d2c9f578d70424cf6ecd860cc8">RET_PF_EMULATE</a>,</div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a848d76ce4cf848d7b559313511e95513">  277</a></span>&#160;    <a class="code" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a848d76ce4cf848d7b559313511e95513">RET_PF_INVALID</a>,</div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57abfabef9865271880389a5b0a0e3dbd60">  278</a></span>&#160;    <a class="code" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57abfabef9865271880389a5b0a0e3dbd60">RET_PF_FIXED</a>,</div>
<div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57adacf3084387ea47f12bc11e866c6ec99">  279</a></span>&#160;    <a class="code" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57adacf3084387ea47f12bc11e866c6ec99">RET_PF_SPURIOUS</a>,</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;};</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#ae3c71be306692107b4d90bfb8d24d7f5">  282</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="mmu__internal_8h.html#ae3c71be306692107b4d90bfb8d24d7f5">kvm_mmu_do_page_fault</a>(<span class="keyword">struct</span> kvm_vcpu *vcpu, gpa_t cr2_or_gpa,</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    u32 err, <span class="keywordtype">bool</span> prefetch, <span class="keywordtype">int</span> *emulation_type)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;{</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keyword">struct </span><a class="code" href="structkvm__page__fault.html">kvm_page_fault</a> fault = {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        .<a class="code" href="structkvm__page__fault.html#ad365933476cc66359bfc9233440ddab0">addr</a> = cr2_or_gpa,</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        .error_code = err,</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        .exec = err &amp; PFERR_FETCH_MASK,</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        .write = err &amp; PFERR_WRITE_MASK,</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        .present = err &amp; PFERR_PRESENT_MASK,</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        .rsvd = err &amp; PFERR_RSVD_MASK,</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        .user = err &amp; PFERR_USER_MASK,</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        .prefetch = <a class="code" href="structkvm__page__fault.html#a2226254b058797ac61a2b5347d1877bd">prefetch</a>,</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        .is_tdp = likely(vcpu-&gt;arch.mmu-&gt;page_fault == <a class="code" href="mmu__internal_8h.html#a4bd7a8fd81e65c4e06e025d92c5787d9">kvm_tdp_page_fault</a>),</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        .nx_huge_page_workaround_enabled =</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <a class="code" href="mmu__internal_8h.html#a8a367cbfff40c5c72d6f19049da9fc51">is_nx_huge_page_enabled</a>(vcpu-&gt;kvm),</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        .max_level = KVM_MAX_HUGEPAGE_LEVEL,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        .req_level = PG_LEVEL_4K,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        .goal_level = PG_LEVEL_4K,</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        .is_private = kvm_mem_is_private(vcpu-&gt;kvm, cr2_or_gpa &gt;&gt; PAGE_SHIFT),</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    };</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordtype">int</span> r;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span> (vcpu-&gt;arch.mmu-&gt;root_role.direct) {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        fault.<a class="code" href="structkvm__page__fault.html#a27031ff0dd2c0b28283774456a29f066">gfn</a> = fault.<a class="code" href="structkvm__page__fault.html#ad365933476cc66359bfc9233440ddab0">addr</a> &gt;&gt; PAGE_SHIFT;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        fault.<a class="code" href="structkvm__page__fault.html#a94ca2315c94da3e5ab0273b78ff6da3a">slot</a> = <a class="code" href="kvm__main_8c.html#ac4b56de4919be80c9cd4289f20437c64">kvm_vcpu_gfn_to_memslot</a>(vcpu, fault.<a class="code" href="structkvm__page__fault.html#a27031ff0dd2c0b28283774456a29f066">gfn</a>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">     * Async #PF &quot;faults&quot;, a.k.a. prefetch faults, are not faults from the</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">     * guest perspective and have already been counted at the time of the</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">     * original fault.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structkvm__page__fault.html#a2226254b058797ac61a2b5347d1877bd">prefetch</a>)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        vcpu-&gt;stat.pf_taken++;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_RETPOLINE) &amp;&amp; fault.<a class="code" href="structkvm__page__fault.html#a76a59490f94982c504342f55b98fa989">is_tdp</a>)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        r = <a class="code" href="mmu__internal_8h.html#a4bd7a8fd81e65c4e06e025d92c5787d9">kvm_tdp_page_fault</a>(vcpu, &amp;fault);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        r = vcpu-&gt;arch.mmu-&gt;page_fault(vcpu, &amp;fault);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">if</span> (fault.<a class="code" href="structkvm__page__fault.html#a126cca48df9411a45bb88d3c1a74d95c">write_fault_to_shadow_pgtable</a> &amp;&amp; emulation_type)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        *emulation_type |= EMULTYPE_WRITE_PF_TO_SP;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">     * Similar to above, prefetch faults aren&#39;t truly spurious, and the</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">     * async #PF path doesn&#39;t do emulation.  Do count faults that are fixed</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">     * by the async #PF handler though, otherwise they&#39;ll never be counted.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">if</span> (r == <a class="code" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57abfabef9865271880389a5b0a0e3dbd60">RET_PF_FIXED</a>)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        vcpu-&gt;stat.pf_fixed++;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="structkvm__page__fault.html#a2226254b058797ac61a2b5347d1877bd">prefetch</a>)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        ;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == <a class="code" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ad03187d2c9f578d70424cf6ecd860cc8">RET_PF_EMULATE</a>)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        vcpu-&gt;stat.pf_emulate++;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == <a class="code" href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57adacf3084387ea47f12bc11e866c6ec99">RET_PF_SPURIOUS</a>)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        vcpu-&gt;stat.pf_spurious++;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keywordtype">int</span> <a class="code" href="mmu__internal_8h.html#a514b4601388e83cb56ffe210d5123b50">kvm_mmu_max_mapping_level</a>(<span class="keyword">struct</span> kvm *kvm,</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                  <span class="keyword">const</span> <span class="keyword">struct</span> kvm_memory_slot *<a class="code" href="structkvm__page__fault.html#a94ca2315c94da3e5ab0273b78ff6da3a">slot</a>, gfn_t <a class="code" href="structkvm__page__fault.html#a27031ff0dd2c0b28283774456a29f066">gfn</a>,</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                  <span class="keywordtype">int</span> <a class="code" href="structkvm__page__fault.html#ab5cc4b80577775008ffd38c21b75d2b6">max_level</a>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordtype">void</span> <a class="code" href="mmu__internal_8h.html#ab3ace8d82fe9d5e1653277159c5ad4df">kvm_mmu_hugepage_adjust</a>(<span class="keyword">struct</span> kvm_vcpu *vcpu, <span class="keyword">struct</span> <a class="code" href="structkvm__page__fault.html">kvm_page_fault</a> *fault);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordtype">void</span> <a class="code" href="mmu__internal_8h.html#ae810dbeb6cd413090f54ca0cf864fe49">disallowed_hugepage_adjust</a>(<span class="keyword">struct</span> <a class="code" href="structkvm__page__fault.html">kvm_page_fault</a> *fault, u64 spte, <span class="keywordtype">int</span> cur_level);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno"><a class="line" href="mmu__internal_8h.html#a2af71cd012ce4f9032d1fdab87110cca">  348</a></span>&#160;<span class="keywordtype">void</span> *<a class="code" href="mmu__internal_8h.html#a2af71cd012ce4f9032d1fdab87110cca">mmu_memory_cache_alloc</a>(<span class="keyword">struct</span> kvm_mmu_memory_cache *mc);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="keywordtype">void</span> <a class="code" href="mmu__internal_8h.html#ad3e86bf491c8c2726e3bc6702166cfdf">track_possible_nx_huge_page</a>(<span class="keyword">struct</span> kvm *kvm, <span class="keyword">struct</span> <a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp);</div>
<div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="structkvm__mmu__page.html#a0ec9f1326e5a7d1f191512f0b2e327c3">  351</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="mmu__internal_8h.html#a2fba0b2dd67723bfbc4349ea7c8e019a">untrack_possible_nx_huge_page</a>(<span class="keyword">struct</span> kvm *kvm, <span class="keyword">struct</span> <a class="code" href="structkvm__mmu__page.html">kvm_mmu_page</a> *sp);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* __KVM_X86_MMU_INTERNAL_H */</span><span class="preprocessor"></span></div>
<div class="ttc" id="akvm__main_8c_html_a523d3c698dd532d3fbc1bb046246ea5f"><div class="ttname"><a href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f">kvm_flush_remote_tlbs_range</a></div><div class="ttdeci">void kvm_flush_remote_tlbs_range(struct kvm *kvm, gfn_t gfn, u64 nr_pages)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l00367">kvm_main.c:367</a></div></div>
<div class="ttc" id="akvm__main_8c_html_ac4b56de4919be80c9cd4289f20437c64"><div class="ttname"><a href="kvm__main_8c.html#ac4b56de4919be80c9cd4289f20437c64">kvm_vcpu_gfn_to_memslot</a></div><div class="ttdeci">struct kvm_memory_slot * kvm_vcpu_gfn_to_memslot(struct kvm_vcpu *vcpu, gfn_t gfn)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l02636">kvm_main.c:2636</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a0eb4da3250f15ed351ae2f0acc485870"><div class="ttname"><a href="mmu__internal_8h.html#a0eb4da3250f15ed351ae2f0acc485870">kvm_mmu_get_dummy_root</a></div><div class="ttdeci">static hpa_t kvm_mmu_get_dummy_root(void)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00040">mmu_internal.h:40</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a1f49638b71a482e4b0c3a6af10d0711e"><div class="ttname"><a href="mmu__internal_8h.html#a1f49638b71a482e4b0c3a6af10d0711e">kvm_mmu_slot_gfn_write_protect</a></div><div class="ttdeci">bool kvm_mmu_slot_gfn_write_protect(struct kvm *kvm, struct kvm_memory_slot *slot, u64 gfn, int min_level)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01414">mmu.c:1414</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a2af71cd012ce4f9032d1fdab87110cca"><div class="ttname"><a href="mmu__internal_8h.html#a2af71cd012ce4f9032d1fdab87110cca">mmu_memory_cache_alloc</a></div><div class="ttdeci">void * mmu_memory_cache_alloc(struct kvm_mmu_memory_cache *mc)</div></div>
<div class="ttc" id="ammu__internal_8h_html_a2fba0b2dd67723bfbc4349ea7c8e019a"><div class="ttname"><a href="mmu__internal_8h.html#a2fba0b2dd67723bfbc4349ea7c8e019a">untrack_possible_nx_huge_page</a></div><div class="ttdeci">void untrack_possible_nx_huge_page(struct kvm *kvm, struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00891">mmu.c:891</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a32da0c4cb2494f355e66aabe82bc1bb5"><div class="ttname"><a href="mmu__internal_8h.html#a32da0c4cb2494f355e66aabe82bc1bb5">kvm_mmu_page_ad_need_write_protect</a></div><div class="ttdeci">static bool kvm_mmu_page_ad_need_write_protect(struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00148">mmu_internal.h:148</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a3634b84158ea95896b7dcbbb228c309c"><div class="ttname"><a href="mmu__internal_8h.html#a3634b84158ea95896b7dcbbb228c309c">mmu_page_header_cache</a></div><div class="ttdeci">struct kmem_cache * mmu_page_header_cache</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00181">mmu.c:181</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a44e186baf100df677a2d62072a7959ad"><div class="ttname"><a href="mmu__internal_8h.html#a44e186baf100df677a2d62072a7959ad">nx_huge_pages</a></div><div class="ttdeci">int nx_huge_pages</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00064">mmu.c:64</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a4bd7a8fd81e65c4e06e025d92c5787d9"><div class="ttname"><a href="mmu__internal_8h.html#a4bd7a8fd81e65c4e06e025d92c5787d9">kvm_tdp_page_fault</a></div><div class="ttdeci">int kvm_tdp_page_fault(struct kvm_vcpu *vcpu, struct kvm_page_fault *fault)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l04623">mmu.c:4623</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a4dc99f06253cd18d05d8260cc30447ea"><div class="ttname"><a href="mmu__internal_8h.html#a4dc99f06253cd18d05d8260cc30447ea">pte_list_count</a></div><div class="ttdeci">unsigned int pte_list_count(struct kvm_rmap_head *rmap_head)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01073">mmu.c:1073</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a514b4601388e83cb56ffe210d5123b50"><div class="ttname"><a href="mmu__internal_8h.html#a514b4601388e83cb56ffe210d5123b50">kvm_mmu_max_mapping_level</a></div><div class="ttdeci">int kvm_mmu_max_mapping_level(struct kvm *kvm, const struct kvm_memory_slot *slot, gfn_t gfn, int max_level)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l03170">mmu.c:3170</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a5334557775f77a151865c95f1cd224ac"><div class="ttname"><a href="mmu__internal_8h.html#a5334557775f77a151865c95f1cd224ac">kvm_mmu_role_as_id</a></div><div class="ttdeci">static int kvm_mmu_role_as_id(union kvm_mmu_page_role role)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00138">mmu_internal.h:138</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a6491934fd3538f608b4b91245943b6fc"><div class="ttname"><a href="mmu__internal_8h.html#a6491934fd3538f608b4b91245943b6fc">kvm_mmu_is_dummy_root</a></div><div class="ttdeci">static bool kvm_mmu_is_dummy_root(hpa_t shadow_page)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00045">mmu_internal.h:45</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a6798167b4e223d54b53a69a2c3c892c3"><div class="ttname"><a href="mmu__internal_8h.html#a6798167b4e223d54b53a69a2c3c892c3">tdp_ptep_t</a></div><div class="ttdeci">u64 __rcu * tdp_ptep_t</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00050">mmu_internal.h:50</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a8726aec6b800501379c831dad5432043"><div class="ttname"><a href="mmu__internal_8h.html#a8726aec6b800501379c831dad5432043">kvm_mmu_gfn_allow_lpage</a></div><div class="ttdeci">void kvm_mmu_gfn_allow_lpage(const struct kvm_memory_slot *slot, gfn_t gfn)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00822">mmu.c:822</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a8805295a6f11129455d5b87a86fd3db5"><div class="ttname"><a href="mmu__internal_8h.html#a8805295a6f11129455d5b87a86fd3db5">gfn_round_for_level</a></div><div class="ttdeci">static gfn_t gfn_round_for_level(gfn_t gfn, int level)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00161">mmu_internal.h:161</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a8a367cbfff40c5c72d6f19049da9fc51"><div class="ttname"><a href="mmu__internal_8h.html#a8a367cbfff40c5c72d6f19049da9fc51">is_nx_huge_page_enabled</a></div><div class="ttdeci">static bool is_nx_huge_page_enabled(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00185">mmu_internal.h:185</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_a993d31328977f0bf21610ad74fa55a79"><div class="ttname"><a href="mmu__internal_8h.html#a993d31328977f0bf21610ad74fa55a79">kvm_mmu_page_as_id</a></div><div class="ttdeci">static int kvm_mmu_page_as_id(struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00143">mmu_internal.h:143</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ab04a0655cd1e3bcac5e8f48c18df1a57a5f8c25625c45554fecc5a5b95e63a2e5"><div class="ttname"><a href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5f8c25625c45554fecc5a5b95e63a2e5">RET_PF_RETRY</a></div><div class="ttdeci">@ RET_PF_RETRY</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00275">mmu_internal.h:275</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ab04a0655cd1e3bcac5e8f48c18df1a57a848d76ce4cf848d7b559313511e95513"><div class="ttname"><a href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a848d76ce4cf848d7b559313511e95513">RET_PF_INVALID</a></div><div class="ttdeci">@ RET_PF_INVALID</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00277">mmu_internal.h:277</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ab04a0655cd1e3bcac5e8f48c18df1a57abfabef9865271880389a5b0a0e3dbd60"><div class="ttname"><a href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57abfabef9865271880389a5b0a0e3dbd60">RET_PF_FIXED</a></div><div class="ttdeci">@ RET_PF_FIXED</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00278">mmu_internal.h:278</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ab04a0655cd1e3bcac5e8f48c18df1a57ad03187d2c9f578d70424cf6ecd860cc8"><div class="ttname"><a href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ad03187d2c9f578d70424cf6ecd860cc8">RET_PF_EMULATE</a></div><div class="ttdeci">@ RET_PF_EMULATE</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00276">mmu_internal.h:276</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ab04a0655cd1e3bcac5e8f48c18df1a57adacf3084387ea47f12bc11e866c6ec99"><div class="ttname"><a href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57adacf3084387ea47f12bc11e866c6ec99">RET_PF_SPURIOUS</a></div><div class="ttdeci">@ RET_PF_SPURIOUS</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00279">mmu_internal.h:279</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ab04a0655cd1e3bcac5e8f48c18df1a57ae095ef51afca86f2bdb6c756039c88fb"><div class="ttname"><a href="mmu__internal_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ae095ef51afca86f2bdb6c756039c88fb">RET_PF_CONTINUE</a></div><div class="ttdeci">@ RET_PF_CONTINUE</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00274">mmu_internal.h:274</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ab3ace8d82fe9d5e1653277159c5ad4df"><div class="ttname"><a href="mmu__internal_8h.html#ab3ace8d82fe9d5e1653277159c5ad4df">kvm_mmu_hugepage_adjust</a></div><div class="ttdeci">void kvm_mmu_hugepage_adjust(struct kvm_vcpu *vcpu, struct kvm_page_fault *fault)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l03180">mmu.c:3180</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ad3e86bf491c8c2726e3bc6702166cfdf"><div class="ttname"><a href="mmu__internal_8h.html#ad3e86bf491c8c2726e3bc6702166cfdf">track_possible_nx_huge_page</a></div><div class="ttdeci">void track_possible_nx_huge_page(struct kvm *kvm, struct kvm_mmu_page *sp)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00848">mmu.c:848</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ae0ba561823d6dcc90bc489e0a51867a7"><div class="ttname"><a href="mmu__internal_8h.html#ae0ba561823d6dcc90bc489e0a51867a7">kvm_mmu_gfn_disallow_lpage</a></div><div class="ttdeci">void kvm_mmu_gfn_disallow_lpage(const struct kvm_memory_slot *slot, gfn_t gfn)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00817">mmu.c:817</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ae152dfa402f5fe629bd4b1f4f931de1e"><div class="ttname"><a href="mmu__internal_8h.html#ae152dfa402f5fe629bd4b1f4f931de1e">kvm_flush_remote_tlbs_gfn</a></div><div class="ttdeci">static void kvm_flush_remote_tlbs_gfn(struct kvm *kvm, gfn_t gfn, int level)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00176">mmu_internal.h:176</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ae3c71be306692107b4d90bfb8d24d7f5"><div class="ttname"><a href="mmu__internal_8h.html#ae3c71be306692107b4d90bfb8d24d7f5">kvm_mmu_do_page_fault</a></div><div class="ttdeci">static int kvm_mmu_do_page_fault(struct kvm_vcpu *vcpu, gpa_t cr2_or_gpa, u32 err, bool prefetch, int *emulation_type)</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00282">mmu_internal.h:282</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_ae810dbeb6cd413090f54ca0cf864fe49"><div class="ttname"><a href="mmu__internal_8h.html#ae810dbeb6cd413090f54ca0cf864fe49">disallowed_hugepage_adjust</a></div><div class="ttdeci">void disallowed_hugepage_adjust(struct kvm_page_fault *fault, u64 spte, int cur_level)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l03216">mmu.c:3216</a></div></div>
<div class="ttc" id="ammu__internal_8h_html_af8846daf6e76a8d619fba16ff979245b"><div class="ttname"><a href="mmu__internal_8h.html#af8846daf6e76a8d619fba16ff979245b">mmu_try_to_unsync_pages</a></div><div class="ttdeci">int mmu_try_to_unsync_pages(struct kvm *kvm, const struct kvm_memory_slot *slot, gfn_t gfn, bool can_unsync, bool prefetch)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l02805">mmu.c:2805</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html"><div class="ttname"><a href="structkvm__mmu__page.html">kvm_mmu_page</a></div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00052">mmu_internal.h:52</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a052dfb1302a401b2b4032fb469870e48"><div class="ttname"><a href="structkvm__mmu__page.html#a052dfb1302a401b2b4032fb469870e48">kvm_mmu_page::unsync_children</a></div><div class="ttdeci">unsigned int unsync_children</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00104">mmu_internal.h:104</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a0ec9f1326e5a7d1f191512f0b2e327c3"><div class="ttname"><a href="structkvm__mmu__page.html#a0ec9f1326e5a7d1f191512f0b2e327c3">kvm_mmu_page::hash_link</a></div><div class="ttdeci">struct hlist_node hash_link</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00351">mmu_internal.h:58</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a1bb8925c750e6b17d3a66a54c5df7c50"><div class="ttname"><a href="structkvm__mmu__page.html#a1bb8925c750e6b17d3a66a54c5df7c50">kvm_mmu_page::spt</a></div><div class="ttdeci">u64 * spt</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00083">mmu_internal.h:83</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a354e43de3a7ea16fee41005505982422"><div class="ttname"><a href="structkvm__mmu__page.html#a354e43de3a7ea16fee41005505982422">kvm_mmu_page::ptep</a></div><div class="ttdeci">tdp_ptep_t ptep</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00107">mmu_internal.h:107</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a41397fd72948cc7002b169d2fb3aba5f"><div class="ttname"><a href="structkvm__mmu__page.html#a41397fd72948cc7002b169d2fb3aba5f">kvm_mmu_page::tdp_mmu_root_count</a></div><div class="ttdeci">refcount_t tdp_mmu_root_count</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00102">mmu_internal.h:102</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a48fdf70976937b2e4cc3e8265ffa5676"><div class="ttname"><a href="structkvm__mmu__page.html#a48fdf70976937b2e4cc3e8265ffa5676">kvm_mmu_page::nx_huge_page_disallowed</a></div><div class="ttdeci">bool nx_huge_page_disallowed</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00074">mmu_internal.h:74</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a4be3912894be6a937cad4c54708edaa4"><div class="ttname"><a href="structkvm__mmu__page.html#a4be3912894be6a937cad4c54708edaa4">kvm_mmu_page::tdp_mmu_scheduled_root_to_zap</a></div><div class="ttdeci">bool tdp_mmu_scheduled_root_to_zap</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00066">mmu_internal.h:66</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a65e8d93a777ad8a7fae49173f4b59061"><div class="ttname"><a href="structkvm__mmu__page.html#a65e8d93a777ad8a7fae49173f4b59061">kvm_mmu_page::DECLARE_BITMAP</a></div><div class="ttdeci">DECLARE_BITMAP(unsync_child_bitmap, 512)</div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a6a67c3f1dd304ec2730973d68f6ac4f7"><div class="ttname"><a href="structkvm__mmu__page.html#a6a67c3f1dd304ec2730973d68f6ac4f7">kvm_mmu_page::possible_nx_huge_page_link</a></div><div class="ttdeci">struct list_head possible_nx_huge_page_link</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00109">mmu_internal.h:118</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a9a054096d38bb2789139b0ef5aa8fec3"><div class="ttname"><a href="structkvm__mmu__page.html#a9a054096d38bb2789139b0ef5aa8fec3">kvm_mmu_page::role</a></div><div class="ttdeci">union kvm_mmu_page_role role</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00074">mmu_internal.h:80</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a9bd31c4eeee99f7c16e11b9c0fd4c347"><div class="ttname"><a href="structkvm__mmu__page.html#a9bd31c4eeee99f7c16e11b9c0fd4c347">kvm_mmu_page::unsync</a></div><div class="ttdeci">bool unsync</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00061">mmu_internal.h:61</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_a9cf2fdfa558f2e17f959875d9f1a22df"><div class="ttname"><a href="structkvm__mmu__page.html#a9cf2fdfa558f2e17f959875d9f1a22df">kvm_mmu_page::shadowed_translation</a></div><div class="ttdeci">u64 * shadowed_translation</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00097">mmu_internal.h:97</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_aa2708cf3e50a50dc58798c0e672f401a"><div class="ttname"><a href="structkvm__mmu__page.html#aa2708cf3e50a50dc58798c0e672f401a">kvm_mmu_page::root_count</a></div><div class="ttdeci">int root_count</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00101">mmu_internal.h:101</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_aa5dc0ace123000668489891db69aa600"><div class="ttname"><a href="structkvm__mmu__page.html#aa5dc0ace123000668489891db69aa600">kvm_mmu_page::link</a></div><div class="ttdeci">struct list_head link</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00351">mmu_internal.h:57</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_aaa85f786ecee91a190d244221531622b"><div class="ttname"><a href="structkvm__mmu__page.html#aaa85f786ecee91a190d244221531622b">kvm_mmu_page::tdp_mmu_page</a></div><div class="ttdeci">bool tdp_mmu_page</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00060">mmu_internal.h:60</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_ab4beaf5fd91de28bba9ed52bc0b01ba3"><div class="ttname"><a href="structkvm__mmu__page.html#ab4beaf5fd91de28bba9ed52bc0b01ba3">kvm_mmu_page::mmu_valid_gen</a></div><div class="ttdeci">u8 mmu_valid_gen</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00063">mmu_internal.h:63</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_ad2696be212b4eb39f555e55eac226b7f"><div class="ttname"><a href="structkvm__mmu__page.html#ad2696be212b4eb39f555e55eac226b7f">kvm_mmu_page::parent_ptes</a></div><div class="ttdeci">struct kvm_rmap_head parent_ptes</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00102">mmu_internal.h:106</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_ad833bc48e1885408b2b5c7deca9a6232"><div class="ttname"><a href="structkvm__mmu__page.html#ad833bc48e1885408b2b5c7deca9a6232">kvm_mmu_page::gfn</a></div><div class="ttdeci">gfn_t gfn</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00081">mmu_internal.h:81</a></div></div>
<div class="ttc" id="astructkvm__mmu__page_html_aef1e01f2353ce632d7ce416124d2e557"><div class="ttname"><a href="structkvm__mmu__page.html#aef1e01f2353ce632d7ce416124d2e557">kvm_mmu_page::write_flooding_count</a></div><div class="ttdeci">atomic_t write_flooding_count</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00128">mmu_internal.h:128</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html"><div class="ttname"><a href="structkvm__page__fault.html">kvm_page_fault</a></div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00190">mmu_internal.h:190</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a126cca48df9411a45bb88d3c1a74d95c"><div class="ttname"><a href="structkvm__page__fault.html#a126cca48df9411a45bb88d3c1a74d95c">kvm_page_fault::write_fault_to_shadow_pgtable</a></div><div class="ttdeci">bool write_fault_to_shadow_pgtable</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00249">mmu_internal.h:249</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a2226254b058797ac61a2b5347d1877bd"><div class="ttname"><a href="structkvm__page__fault.html#a2226254b058797ac61a2b5347d1877bd">kvm_page_fault::prefetch</a></div><div class="ttdeci">const bool prefetch</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00194">mmu_internal.h:194</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a27031ff0dd2c0b28283774456a29f066"><div class="ttname"><a href="structkvm__page__fault.html#a27031ff0dd2c0b28283774456a29f066">kvm_page_fault::gfn</a></div><div class="ttdeci">gfn_t gfn</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00233">mmu_internal.h:233</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a336b33c76427ea615bafb91e1021fa13"><div class="ttname"><a href="structkvm__page__fault.html#a336b33c76427ea615bafb91e1021fa13">kvm_page_fault::error_code</a></div><div class="ttdeci">const u32 error_code</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00193">mmu_internal.h:193</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a344ea13707eed7d867de69c640f996c4"><div class="ttname"><a href="structkvm__page__fault.html#a344ea13707eed7d867de69c640f996c4">kvm_page_fault::mmu_seq</a></div><div class="ttdeci">unsigned long mmu_seq</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00239">mmu_internal.h:239</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a366b2dee3b9a362d1b8a759bfd92bcae"><div class="ttname"><a href="structkvm__page__fault.html#a366b2dee3b9a362d1b8a759bfd92bcae">kvm_page_fault::write</a></div><div class="ttdeci">const bool write</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00198">mmu_internal.h:198</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a421a772100b124af81fb35768801c6bc"><div class="ttname"><a href="structkvm__page__fault.html#a421a772100b124af81fb35768801c6bc">kvm_page_fault::huge_page_disallowed</a></div><div class="ttdeci">bool huge_page_disallowed</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00212">mmu_internal.h:212</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a518c55075aa2d4de37d777fe9e1c936b"><div class="ttname"><a href="structkvm__page__fault.html#a518c55075aa2d4de37d777fe9e1c936b">kvm_page_fault::user</a></div><div class="ttdeci">const bool user</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00201">mmu_internal.h:201</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a65ea5c8294b46a4efcd7db0ba9f77446"><div class="ttname"><a href="structkvm__page__fault.html#a65ea5c8294b46a4efcd7db0ba9f77446">kvm_page_fault::hva</a></div><div class="ttdeci">hva_t hva</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00241">mmu_internal.h:241</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a76a59490f94982c504342f55b98fa989"><div class="ttname"><a href="structkvm__page__fault.html#a76a59490f94982c504342f55b98fa989">kvm_page_fault::is_tdp</a></div><div class="ttdeci">const bool is_tdp</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00204">mmu_internal.h:204</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a784cc6d936bf4aa03731c0620e334553"><div class="ttname"><a href="structkvm__page__fault.html#a784cc6d936bf4aa03731c0620e334553">kvm_page_fault::pfn</a></div><div class="ttdeci">kvm_pfn_t pfn</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00240">mmu_internal.h:240</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a8c1b32bdc3f59a2c3ffca8cc919b5ef3"><div class="ttname"><a href="structkvm__page__fault.html#a8c1b32bdc3f59a2c3ffca8cc919b5ef3">kvm_page_fault::nx_huge_page_workaround_enabled</a></div><div class="ttdeci">const bool nx_huge_page_workaround_enabled</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00206">mmu_internal.h:206</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a8ffa43a08e1131c59b2597d86a616b26"><div class="ttname"><a href="structkvm__page__fault.html#a8ffa43a08e1131c59b2597d86a616b26">kvm_page_fault::req_level</a></div><div class="ttdeci">u8 req_level</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00224">mmu_internal.h:224</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_a94ca2315c94da3e5ab0273b78ff6da3a"><div class="ttname"><a href="structkvm__page__fault.html#a94ca2315c94da3e5ab0273b78ff6da3a">kvm_page_fault::slot</a></div><div class="ttdeci">struct kvm_memory_slot * slot</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00236">mmu_internal.h:236</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_aab31660ce259b441376e3c2ba4ce7ea4"><div class="ttname"><a href="structkvm__page__fault.html#aab31660ce259b441376e3c2ba4ce7ea4">kvm_page_fault::present</a></div><div class="ttdeci">const bool present</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00199">mmu_internal.h:199</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_ab2de0f5ce7803d5f87dfbecc552541e4"><div class="ttname"><a href="structkvm__page__fault.html#ab2de0f5ce7803d5f87dfbecc552541e4">kvm_page_fault::is_private</a></div><div class="ttdeci">const bool is_private</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00205">mmu_internal.h:205</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_ab5cc4b80577775008ffd38c21b75d2b6"><div class="ttname"><a href="structkvm__page__fault.html#ab5cc4b80577775008ffd38c21b75d2b6">kvm_page_fault::max_level</a></div><div class="ttdeci">u8 max_level</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00218">mmu_internal.h:218</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_ad365933476cc66359bfc9233440ddab0"><div class="ttname"><a href="structkvm__page__fault.html#ad365933476cc66359bfc9233440ddab0">kvm_page_fault::addr</a></div><div class="ttdeci">const gpa_t addr</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00192">mmu_internal.h:192</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_ad6705ad5f00efe4e9e47328860e9634a"><div class="ttname"><a href="structkvm__page__fault.html#ad6705ad5f00efe4e9e47328860e9634a">kvm_page_fault::goal_level</a></div><div class="ttdeci">u8 goal_level</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00230">mmu_internal.h:230</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_aebd17cd723773f8d26e5910faa4f6b7d"><div class="ttname"><a href="structkvm__page__fault.html#aebd17cd723773f8d26e5910faa4f6b7d">kvm_page_fault::exec</a></div><div class="ttdeci">const bool exec</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00197">mmu_internal.h:197</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_af09b3cf7b0f69922b629bd2c257a4133"><div class="ttname"><a href="structkvm__page__fault.html#af09b3cf7b0f69922b629bd2c257a4133">kvm_page_fault::rsvd</a></div><div class="ttdeci">const bool rsvd</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00200">mmu_internal.h:200</a></div></div>
<div class="ttc" id="astructkvm__page__fault_html_aff41947455b49de1c0e9d1fddc7273e5"><div class="ttname"><a href="structkvm__page__fault.html#aff41947455b49de1c0e9d1fddc7273e5">kvm_page_fault::map_writable</a></div><div class="ttdeci">bool map_writable</div><div class="ttdef"><b>Definition:</b> <a href="mmu__internal_8h_source.html#l00242">mmu_internal.h:242</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
