<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/x86/kvm/xen.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_c21774f8bc9f0de15163573e5f5fa2b5.html">x86</a></li><li class="navelem"><a class="el" href="dir_fde450fd4b58e2560c53a1e73bfa4d6d.html">kvm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">xen.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="x86_8h_source.html">x86.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="xen_8h_source.html">xen.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hyperv_8h_source.html">hyperv.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="lapic_8h_source.html">lapic.h</a>&quot;</code><br />
<code>#include &lt;linux/eventfd.h&gt;</code><br />
<code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &lt;linux/sched/stat.h&gt;</code><br />
<code>#include &lt;trace/events/kvm.h&gt;</code><br />
<code>#include &lt;xen/interface/xen.h&gt;</code><br />
<code>#include &lt;xen/interface/vcpu.h&gt;</code><br />
<code>#include &lt;xen/interface/version.h&gt;</code><br />
<code>#include &lt;xen/interface/event_channel.h&gt;</code><br />
<code>#include &lt;xen/interface/sched.h&gt;</code><br />
<code>#include &lt;asm/xen/cpuid.h&gt;</code><br />
<code>#include &quot;<a class="el" href="cpuid_8h_source.html">cpuid.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="trace_8h_source.html">trace.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for xen.c:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c__incl.png" border="0" usemap="#aarch_2x86_2kvm_2xen_8c" alt=""/></div>
<map name="aarch_2x86_2kvm_2xen_8c" id="aarch_2x86_2kvm_2xen_8c">
<area shape="rect" title=" " alt="" coords="1999,5,2148,32"/>
<area shape="rect" href="x86_8h.html" title=" " alt="" coords="628,244,687,271"/>
<area shape="rect" title=" " alt="" coords="327,393,462,420"/>
<area shape="rect" href="xen_8h.html" title=" " alt="" coords="1930,87,1987,114"/>
<area shape="rect" title=" " alt="" coords="2744,169,2899,196"/>
<area shape="rect" href="hyperv_8h.html" title=" " alt="" coords="490,169,569,196"/>
<area shape="rect" href="lapic_8h.html" title=" " alt="" coords="335,87,401,114"/>
<area shape="rect" title=" " alt="" coords="2063,87,2183,114"/>
<area shape="rect" title=" " alt="" coords="2207,87,2345,114"/>
<area shape="rect" title=" " alt="" coords="2369,87,2517,114"/>
<area shape="rect" title=" " alt="" coords="2541,87,2688,114"/>
<area shape="rect" title=" " alt="" coords="2712,87,2883,114"/>
<area shape="rect" title=" " alt="" coords="2907,80,3055,121"/>
<area shape="rect" title=" " alt="" coords="3079,87,3241,114"/>
<area shape="rect" title=" " alt="" coords="3265,87,3393,114"/>
<area shape="rect" href="cpuid_8h.html" title=" " alt="" coords="1077,87,1147,114"/>
<area shape="rect" href="trace_8h.html" title=" " alt="" coords="1839,87,1905,114"/>
<area shape="rect" title=" " alt="" coords="910,319,1042,345"/>
<area shape="rect" title=" " alt="" coords="433,319,527,345"/>
<area shape="rect" title=" " alt="" coords="551,319,667,345"/>
<area shape="rect" href="kvm__cache__regs_8h.html" title=" " alt="" coords="743,319,886,345"/>
<area shape="rect" href="kvm__emulate_8h.html" title=" " alt="" coords="1066,319,1190,345"/>
<area shape="rect" title=" " alt="" coords="1121,393,1252,420"/>
<area shape="rect" href="fpu_8h.html" title=" " alt="" coords="1042,393,1097,420"/>
<area shape="rect" title=" " alt="" coords="1014,468,1125,495"/>
<area shape="rect" title=" " alt="" coords="2558,169,2719,196"/>
<area shape="rect" title=" " alt="" coords="2217,169,2359,196"/>
<area shape="rect" title=" " alt="" coords="2383,169,2534,196"/>
<area shape="rect" href="iodev_8h.html" title=" " alt="" coords="317,169,419,196"/>
<area shape="rect" href="smm_8h.html" title=" " alt="" coords="176,169,243,196"/>
<area shape="rect" title=" " alt="" coords="251,244,394,271"/>
<area shape="rect" title=" " alt="" coords="419,244,523,271"/>
<area shape="rect" title=" " alt="" coords="93,244,227,271"/>
<area shape="rect" href="reverse__cpuid_8h.html" title=" " alt="" coords="1215,169,1340,196"/>
<area shape="rect" title=" " alt="" coords="1365,169,1454,196"/>
<area shape="rect" title=" " alt="" coords="695,169,823,196"/>
<area shape="rect" title=" " alt="" coords="847,169,1009,196"/>
<area shape="rect" href="governed__features_8h.html" title=" " alt="" coords="1034,169,1190,196"/>
<area shape="rect" title=" " alt="" coords="1373,244,1499,271"/>
<area shape="rect" title=" " alt="" coords="1045,244,1181,271"/>
<area shape="rect" title=" " alt="" coords="1206,244,1349,271"/>
<area shape="rect" title=" " alt="" coords="2057,169,2193,196"/>
<area shape="rect" title=" " alt="" coords="1478,169,1573,196"/>
<area shape="rect" title=" " alt="" coords="1597,169,1691,196"/>
<area shape="rect" title=" " alt="" coords="1715,169,1858,196"/>
<area shape="rect" title=" " alt="" coords="1882,169,2033,196"/>
</map>
</div>
</div>
<p><a href="xen_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcompat__vcpu__set__singleshot__timer.html">compat_vcpu_set_singleshot_timer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structevtchnfd.html">evtchnfd</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1f8c165bf4196327bc3abff648276d92"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a1f8c165bf4196327bc3abff648276d92">pr_fmt</a>(fmt)&#160;&#160;&#160;KBUILD_MODNAME &quot;: &quot; fmt</td></tr>
<tr class="separator:a1f8c165bf4196327bc3abff648276d92"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a59091fb436633f85ba3e28187f5794d0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0">kvm_xen_set_evtchn</a> (struct kvm_xen_evtchn *xe, struct kvm *kvm)</td></tr>
<tr class="separator:a59091fb436633f85ba3e28187f5794d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c5ff8f2966ec21633bf34f39f981d3c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a2c5ff8f2966ec21633bf34f39f981d3c">kvm_xen_setattr_evtchn</a> (struct kvm *kvm, struct kvm_xen_hvm_attr *data)</td></tr>
<tr class="separator:a2c5ff8f2966ec21633bf34f39f981d3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42cb09290dc39689baca95686be1ff69"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a42cb09290dc39689baca95686be1ff69">kvm_xen_hcall_evtchn_send</a> (struct kvm_vcpu *vcpu, u64 param, u64 *r)</td></tr>
<tr class="separator:a42cb09290dc39689baca95686be1ff69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae5e7772477e2ebd18c5ff39a91e3b37"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#aae5e7772477e2ebd18c5ff39a91e3b37">DEFINE_STATIC_KEY_DEFERRED_FALSE</a> (kvm_xen_enabled, HZ)</td></tr>
<tr class="separator:aae5e7772477e2ebd18c5ff39a91e3b37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a302274d0dadb3dc482dbf4efca0c51d0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a302274d0dadb3dc482dbf4efca0c51d0">kvm_xen_shared_info_init</a> (struct kvm *kvm, gfn_t gfn)</td></tr>
<tr class="separator:a302274d0dadb3dc482dbf4efca0c51d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab30962c07569543c2879269c4ec40d70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#ab30962c07569543c2879269c4ec40d70">kvm_xen_inject_timer_irqs</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ab30962c07569543c2879269c4ec40d70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4017950790585b6ba8d51d7b8bb2d5f7"><td class="memItemLeft" align="right" valign="top">static enum hrtimer_restart&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a4017950790585b6ba8d51d7b8bb2d5f7">xen_timer_callback</a> (struct hrtimer *timer)</td></tr>
<tr class="separator:a4017950790585b6ba8d51d7b8bb2d5f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0187b2f16608bbdf5525ad8c8e882459"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459">kvm_xen_start_timer</a> (struct kvm_vcpu *vcpu, u64 guest_abs, s64 delta_ns)</td></tr>
<tr class="separator:a0187b2f16608bbdf5525ad8c8e882459"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e98609584a6375fe160f81dfafbf2f2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2">kvm_xen_stop_timer</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a3e98609584a6375fe160f81dfafbf2f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac3b8d94d9d44e46e1b03789bbcbd3a3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#aac3b8d94d9d44e46e1b03789bbcbd3a3">kvm_xen_init_timer</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aac3b8d94d9d44e46e1b03789bbcbd3a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6eefd0c967fad2f6ef73e77bc0dc50d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#ab6eefd0c967fad2f6ef73e77bc0dc50d">kvm_xen_update_runstate_guest</a> (struct kvm_vcpu *v, bool atomic)</td></tr>
<tr class="separator:ab6eefd0c967fad2f6ef73e77bc0dc50d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6acde067fc775eb22a4c49b5ca434963"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a6acde067fc775eb22a4c49b5ca434963">kvm_xen_update_runstate</a> (struct kvm_vcpu *v, int <a class="el" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>)</td></tr>
<tr class="separator:a6acde067fc775eb22a4c49b5ca434963"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ba53f4f869b74569192380f1adfd40c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c">kvm_xen_inject_vcpu_vector</a> (struct kvm_vcpu *v)</td></tr>
<tr class="separator:a7ba53f4f869b74569192380f1adfd40c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fb0356e88890003922daf35627420a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a0fb0356e88890003922daf35627420a8">kvm_xen_inject_pending_events</a> (struct kvm_vcpu *v)</td></tr>
<tr class="separator:a0fb0356e88890003922daf35627420a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02f3f67054c9bb0d9a1bd14c36a2e2df"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a02f3f67054c9bb0d9a1bd14c36a2e2df">__kvm_xen_has_interrupt</a> (struct kvm_vcpu *v)</td></tr>
<tr class="separator:a02f3f67054c9bb0d9a1bd14c36a2e2df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97a02cd2ae7319635c2de6370b82cb1b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a97a02cd2ae7319635c2de6370b82cb1b">kvm_xen_hvm_set_attr</a> (struct kvm *kvm, struct kvm_xen_hvm_attr *data)</td></tr>
<tr class="separator:a97a02cd2ae7319635c2de6370b82cb1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abffcd537f5794ca49a6942dade53a715"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#abffcd537f5794ca49a6942dade53a715">kvm_xen_hvm_get_attr</a> (struct kvm *kvm, struct kvm_xen_hvm_attr *data)</td></tr>
<tr class="separator:abffcd537f5794ca49a6942dade53a715"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a475f17b008ae9643247453de0018df17"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a475f17b008ae9643247453de0018df17">kvm_xen_vcpu_set_attr</a> (struct kvm_vcpu *vcpu, struct kvm_xen_vcpu_attr *data)</td></tr>
<tr class="separator:a475f17b008ae9643247453de0018df17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0446c241eff9babb33e990edd1347b96"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a0446c241eff9babb33e990edd1347b96">kvm_xen_vcpu_get_attr</a> (struct kvm_vcpu *vcpu, struct kvm_xen_vcpu_attr *data)</td></tr>
<tr class="separator:a0446c241eff9babb33e990edd1347b96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ee930b1f9fc4736a86b12bf73d43f74"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a8ee930b1f9fc4736a86b12bf73d43f74">kvm_xen_write_hypercall_page</a> (struct kvm_vcpu *vcpu, u64 data)</td></tr>
<tr class="separator:a8ee930b1f9fc4736a86b12bf73d43f74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6a83667716abc62955e742bba62ba17"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#ab6a83667716abc62955e742bba62ba17">kvm_xen_hvm_config</a> (struct kvm *kvm, struct kvm_xen_hvm_config *xhc)</td></tr>
<tr class="separator:ab6a83667716abc62955e742bba62ba17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af793a9d50c928bc2c920b78b807c45da"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#af793a9d50c928bc2c920b78b807c45da">kvm_xen_hypercall_set_result</a> (struct kvm_vcpu *vcpu, u64 result)</td></tr>
<tr class="separator:af793a9d50c928bc2c920b78b807c45da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a373b446476992601f9f6b3e33c0f086d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a373b446476992601f9f6b3e33c0f086d">kvm_xen_hypercall_complete_userspace</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a373b446476992601f9f6b3e33c0f086d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfe301f067b5181a7028ad5e62629e6d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d">max_evtchn_port</a> (struct kvm *kvm)</td></tr>
<tr class="separator:abfe301f067b5181a7028ad5e62629e6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc36c59baef58a2af910272a8dd3e923"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#acc36c59baef58a2af910272a8dd3e923">wait_pending_event</a> (struct kvm_vcpu *vcpu, int nr_ports, evtchn_port_t *ports)</td></tr>
<tr class="separator:acc36c59baef58a2af910272a8dd3e923"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bcdab8c7d597fa93d30ff9e9185cbc6"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a4bcdab8c7d597fa93d30ff9e9185cbc6">kvm_xen_schedop_poll</a> (struct kvm_vcpu *vcpu, bool longmode, u64 param, u64 *r)</td></tr>
<tr class="separator:a4bcdab8c7d597fa93d30ff9e9185cbc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f374264fad08f9502cba60764e46d57"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a9f374264fad08f9502cba60764e46d57">cancel_evtchn_poll</a> (struct timer_list *t)</td></tr>
<tr class="separator:a9f374264fad08f9502cba60764e46d57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af82c8d988242af84bb833157369454b4"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#af82c8d988242af84bb833157369454b4">kvm_xen_hcall_sched_op</a> (struct kvm_vcpu *vcpu, bool longmode, int cmd, u64 param, u64 *r)</td></tr>
<tr class="separator:af82c8d988242af84bb833157369454b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8910a0f422594766001b1c5a5f59e6e"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structcompat__vcpu__set__singleshot__timer.html">compat_vcpu_set_singleshot_timer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#ab8910a0f422594766001b1c5a5f59e6e">__attribute__</a> ((packed))</td></tr>
<tr class="separator:ab8910a0f422594766001b1c5a5f59e6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a770531539245dce08f6187702354032c"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a770531539245dce08f6187702354032c">kvm_xen_hcall_vcpu_op</a> (struct kvm_vcpu *vcpu, bool longmode, int cmd, int vcpu_id, u64 param, u64 *r)</td></tr>
<tr class="separator:a770531539245dce08f6187702354032c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee859a411f74e3aa2dd986c561eb72dc"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#aee859a411f74e3aa2dd986c561eb72dc">kvm_xen_hcall_set_timer_op</a> (struct kvm_vcpu *vcpu, uint64_t timeout, u64 *r)</td></tr>
<tr class="separator:aee859a411f74e3aa2dd986c561eb72dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf398a8803a79984b06fbf9e2a64193c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c">kvm_xen_hypercall</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aaf398a8803a79984b06fbf9e2a64193c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a920a89da9fa627b54860f838c736b003"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a920a89da9fa627b54860f838c736b003">kvm_xen_check_poller</a> (struct kvm_vcpu *vcpu, int port)</td></tr>
<tr class="separator:a920a89da9fa627b54860f838c736b003"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48738df3c98025631e2412d90758136c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a48738df3c98025631e2412d90758136c">kvm_xen_set_evtchn_fast</a> (struct kvm_xen_evtchn *xe, struct kvm *kvm)</td></tr>
<tr class="separator:a48738df3c98025631e2412d90758136c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7432a92fb771aeb9f60ca4d89c10f15b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a7432a92fb771aeb9f60ca4d89c10f15b">evtchn_set_fn</a> (struct kvm_kernel_irq_routing_entry *e, struct kvm *kvm, int irq_source_id, int level, bool line_status)</td></tr>
<tr class="separator:a7432a92fb771aeb9f60ca4d89c10f15b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a508e4ef7a5f613f8e7daf8a633ae8ee5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a508e4ef7a5f613f8e7daf8a633ae8ee5">kvm_xen_setup_evtchn</a> (struct kvm *kvm, struct kvm_kernel_irq_routing_entry *e, const struct kvm_irq_routing_entry *ue)</td></tr>
<tr class="separator:a508e4ef7a5f613f8e7daf8a633ae8ee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a952a322aa5cce4d0bd3fe372d820de13"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a952a322aa5cce4d0bd3fe372d820de13">kvm_xen_hvm_evtchn_send</a> (struct kvm *kvm, struct kvm_irq_routing_xen_evtchn *uxe)</td></tr>
<tr class="separator:a952a322aa5cce4d0bd3fe372d820de13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43566f69e0b71f82cbd528428cd50c13"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a43566f69e0b71f82cbd528428cd50c13">kvm_xen_eventfd_update</a> (struct kvm *kvm, struct kvm_xen_hvm_attr *data)</td></tr>
<tr class="separator:a43566f69e0b71f82cbd528428cd50c13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af22ffcd81793c28d8f1952ed94e0d051"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#af22ffcd81793c28d8f1952ed94e0d051">kvm_xen_eventfd_assign</a> (struct kvm *kvm, struct kvm_xen_hvm_attr *data)</td></tr>
<tr class="separator:af22ffcd81793c28d8f1952ed94e0d051"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32bc1d5ae7e58f301dd76cc65e585f81"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a32bc1d5ae7e58f301dd76cc65e585f81">kvm_xen_eventfd_deassign</a> (struct kvm *kvm, u32 port)</td></tr>
<tr class="separator:a32bc1d5ae7e58f301dd76cc65e585f81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac62834296caffe4f21f173993a510823"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#ac62834296caffe4f21f173993a510823">kvm_xen_eventfd_reset</a> (struct kvm *kvm)</td></tr>
<tr class="separator:ac62834296caffe4f21f173993a510823"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb16147443c1deb060bf5a57799ab580"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#abb16147443c1deb060bf5a57799ab580">kvm_xen_init_vcpu</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:abb16147443c1deb060bf5a57799ab580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b39fb3ff349ca2ab87179dc95d5d105"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a3b39fb3ff349ca2ab87179dc95d5d105">kvm_xen_destroy_vcpu</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a3b39fb3ff349ca2ab87179dc95d5d105"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf531b186f63f085d94a6c47ab72f473"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#adf531b186f63f085d94a6c47ab72f473">kvm_xen_update_tsc_info</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:adf531b186f63f085d94a6c47ab72f473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14c3c2aa10d6c0c29f040de32e1d6054"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a14c3c2aa10d6c0c29f040de32e1d6054">kvm_xen_init_vm</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a14c3c2aa10d6c0c29f040de32e1d6054"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2de7c50ba573dd74c833c6b0bc675909"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a2de7c50ba573dd74c833c6b0bc675909">kvm_xen_destroy_vm</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a2de7c50ba573dd74c833c6b0bc675909"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2091e51764159d2bda5738c2a1f2382a"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a2091e51764159d2bda5738c2a1f2382a">timeout_abs_ns</a></td></tr>
<tr class="separator:a2091e51764159d2bda5738c2a1f2382a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a773b39d480759f67926cb18ae2219281"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a></td></tr>
<tr class="separator:a773b39d480759f67926cb18ae2219281"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bf9c69aa77adb5d6380d44f7d33daaf"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structevtchnfd.html">evtchnfd</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xen_8c.html#a1bf9c69aa77adb5d6380d44f7d33daaf">__attribute__</a></td></tr>
<tr class="separator:a1bf9c69aa77adb5d6380d44f7d33daaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a1f8c165bf4196327bc3abff648276d92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f8c165bf4196327bc3abff648276d92">&#9670;&nbsp;</a></span>pr_fmt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pr_fmt</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">fmt</td><td>)</td>
          <td>&#160;&#160;&#160;KBUILD_MODNAME &quot;: &quot; fmt</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00008">8</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab8910a0f422594766001b1c5a5f59e6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8910a0f422594766001b1c5a5f59e6e">&#9670;&nbsp;</a></span>__attribute__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structcompat__vcpu__set__singleshot__timer.html">compat_vcpu_set_singleshot_timer</a> __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(packed)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_ab8910a0f422594766001b1c5a5f59e6e_cgraph.png" border="0" usemap="#axen_8c_ab8910a0f422594766001b1c5a5f59e6e_cgraph" alt=""/></div>
<map name="axen_8c_ab8910a0f422594766001b1c5a5f59e6e_cgraph" id="axen_8c_ab8910a0f422594766001b1c5a5f59e6e_cgraph">
<area shape="rect" title=" " alt="" coords="5,567,112,593"/>
<area shape="rect" href="kvm__main_8c.html#a7373edb7b1c787b14e657cd691e64d20" title=" " alt="" coords="173,301,320,328"/>
<area shape="rect" href="xen_8c.html#a4bcdab8c7d597fa93d30ff9e9185cbc6" title=" " alt="" coords="160,693,333,720"/>
<area shape="rect" href="kvm__main_8c.html#a51faeec43f0c1f5fe8a68cd44f7ff046" title=" " alt="" coords="381,147,580,189"/>
<area shape="rect" href="x86_8c.html#a81fd299a20cbefe3205c4524e9c90e7e" title=" " alt="" coords="385,213,576,240"/>
<area shape="rect" href="kvm__main_8c.html#a6c41937c88f6e58c4c2cc8b235921b8e" title=" " alt="" coords="396,265,565,306"/>
<area shape="rect" href="kvm__main_8c.html#a9bf210089ca6fb3f4b38293588ab53c5" title=" " alt="" coords="407,331,555,357"/>
<area shape="rect" href="kvm__main_8c.html#a06ed191cebec13ce2c4a7d15fdeb5a60" title=" " alt="" coords="411,381,551,408"/>
<area shape="rect" href="kvm__main_8c.html#ac5a3afd8e2d8d1139dc7711c4b9e07e3" title=" " alt="" coords="647,213,820,240"/>
<area shape="rect" href="kvm__main_8c.html#aac20f0d987f71a47c6701c7e93a0e261" title=" " alt="" coords="903,323,1077,349"/>
<area shape="rect" href="x86_8c.html#a951bd40e58d87204d565c6cb5fc664e6" title=" " alt="" coords="1149,323,1337,349"/>
<area shape="rect" href="x86_8c.html#a54ec69b24c80207e4e6122994db0a466" title=" " alt="" coords="1403,323,1573,349"/>
<area shape="rect" href="x86_8c.html#a50b142cb27db85027825ca5630046d8f" title=" " alt="" coords="1415,272,1561,299"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="1921,107,2041,133"/>
<area shape="rect" href="lapic_8h.html#a106127db5f69d94e5ea9d6d2982c23fd" title=" " alt="" coords="1894,183,2069,225"/>
<area shape="rect" href="lapic_8h.html#a58bae1ee856b1b5c5c44903c9f83a4f7" title=" " alt="" coords="1667,510,1809,551"/>
<area shape="rect" href="x86_8c.html#a4593bb3c3619c24c8f7f0af1a224fdbd" title=" " alt="" coords="1663,342,1813,383"/>
<area shape="rect" href="irq_8c.html#ae3151f072a1bb4a732ee3854ab6cf619" title=" " alt="" coords="1651,291,1825,317"/>
<area shape="rect" href="x86_8c.html#a476f3f8eb9f578c4867ba7deb7ab9f6e" title=" " alt="" coords="1659,57,1817,98"/>
<area shape="rect" href="hyperv_8h.html#a59866dd9026115f7614a5433badf0851" title=" " alt="" coords="1632,408,1844,435"/>
<area shape="rect" href="x86_8h.html#aa9890500a8e1721d97bbeb847c932d2b" title=" " alt="" coords="1639,459,1837,485"/>
<area shape="rect" href="xen_8h.html#aba35176a813cb38333a3db33ba222726" title=" " alt="" coords="1653,225,1823,266"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="2119,459,2237,485"/>
<area shape="rect" href="smm_8h.html#aa0d6bb14bef67edc441fccd36d205a67" title=" " alt="" coords="1945,517,2018,544"/>
<area shape="rect" href="lapic_8c.html#aa421165466ac455ff3fff91fb9afe7bf" title=" " alt="" coords="1892,291,2071,317"/>
<area shape="rect" href="irq_8c.html#a0ba50d6865653a9d307102d8f0b36630" title=" " alt="" coords="1903,400,2059,427"/>
<area shape="rect" href="x86_8c.html#a7064cd8944dd550352cef83c72612045" title=" " alt="" coords="401,483,560,509"/>
<area shape="rect" href="kvm__main_8c.html#a7256a8615584a9ae83a46c071f6aa0e9" title=" " alt="" coords="420,617,541,644"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="413,845,548,872"/>
<area shape="rect" href="xen_8c.html#acc36c59baef58a2af910272a8dd3e923" title=" " alt="" coords="404,896,557,923"/>
<area shape="rect" href="x86_8c.html#ab9c276fafa298a76b0f6a9f001db989b" title=" " alt="" coords="654,374,813,415"/>
<area shape="rect" href="kvm__main_8c.html#adfef9b2c2d6359fd443d98f51be19605" title=" " alt="" coords="887,164,1093,191"/>
<area shape="rect" href="kvm__main_8c.html#acc4698e3f076cdbbd5d8ca788a94decf" title=" " alt="" coords="1151,87,1334,113"/>
<area shape="rect" href="kvm__main_8c.html#ac4b56de4919be80c9cd4289f20437c64" title=" " alt="" coords="1141,164,1344,191"/>
<area shape="rect" href="kvm__main_8c.html#adb8a0a4f675ca16ea81acd3b88089f13" title=" " alt="" coords="1392,33,1584,60"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1662,5,1814,32"/>
<area shape="rect" href="kvm__main_8c.html#a1045a615093ccd8e87dcd6f6a0e03e9e" title=" " alt="" coords="664,744,803,771"/>
<area shape="rect" href="x86_8c.html#a98e66fde0ecb40ea667a003bf1e5aa53" title=" " alt="" coords="663,440,803,467"/>
<area shape="rect" href="kvm__main_8c.html#a8e18df0287ddedfd516454aeeb669807" title=" " alt="" coords="668,541,799,568"/>
<area shape="rect" href="kvm__main_8c.html#a3de4d6991bdd1a714e8afa6a55136cdd" title=" " alt="" coords="902,584,1078,611"/>
<area shape="rect" href="kvm__main_8c.html#afc3c9c56d305921c317259e18c9c8a59" title=" " alt="" coords="628,491,839,517"/>
<area shape="rect" href="kvm__main_8c.html#a22600b8a76a84f58d97f1a465293e63c" title=" " alt="" coords="660,592,807,619"/>
<area shape="rect" href="kvm__main_8c.html#aaa76576c021037e516218db81c147ca0" title=" " alt="" coords="649,643,818,669"/>
<area shape="rect" href="irq_8c.html#a78e23e83bece8c269268f3a263fbb114" title=" " alt="" coords="1157,619,1328,661"/>
<area shape="rect" href="irq_8h.html#afcf66d0c1c15dcbd414e2dbf830d7b29" title=" " alt="" coords="1398,677,1578,704"/>
<area shape="rect" href="xen_8h.html#ab737e94ddc49624447bfc9c3387d5c2d" title=" " alt="" coords="1403,729,1573,770"/>
<area shape="rect" href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d" title=" " alt="" coords="1397,627,1579,653"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1684,652,1792,679"/>
<area shape="rect" href="lapic_8c.html#a2800acddbbe439c5ae4fab24c1eaf9ff" title=" " alt="" coords="1672,703,1804,729"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="670,896,797,923"/>
</map>
</div>

</div>
</div>
<a id="a02f3f67054c9bb0d9a1bd14c36a2e2df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02f3f67054c9bb0d9a1bd14c36a2e2df">&#9670;&nbsp;</a></span>__kvm_xen_has_interrupt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __kvm_xen_has_interrupt </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00577">577</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;{</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keyword">struct </span>gfn_to_pfn_cache *gpc = &amp;v-&gt;arch.xen.vcpu_info_cache;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    u8 rc = 0;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">     * If the global upcall vector (HVMIRQ_callback_vector) is set and</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">     * the vCPU&#39;s evtchn_upcall_pending flag is set, the IRQ is pending.</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="comment">/* No need for compat handling here */</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> vcpu_info, evtchn_upcall_pending) !=</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;             offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__info.html">compat_vcpu_info</a>, evtchn_upcall_pending));</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    BUILD_BUG_ON(<span class="keyword">sizeof</span>(rc) !=</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;             sizeof_field(<span class="keyword">struct</span> vcpu_info, evtchn_upcall_pending));</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    BUILD_BUG_ON(<span class="keyword">sizeof</span>(rc) !=</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;             sizeof_field(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__info.html">compat_vcpu_info</a>, evtchn_upcall_pending));</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    read_lock_irqsave(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d">kvm_gpc_check</a>(gpc, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> vcpu_info))) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        read_unlock_irqrestore(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">         * This function gets called from kvm_vcpu_block() after setting the</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">         * task to TASK_INTERRUPTIBLE, to see if it needs to wake immediately</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">         * from a HLT. So we really mustn&#39;t sleep. If the page ended up absent</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">         * at that point, just return 1 in order to trigger an immediate wake,</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">         * and we&#39;ll end up getting called again from a context where we *can*</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">         * fault in the page and wait for it.</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">if</span> (in_atomic() || !task_is_running(current))</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe">kvm_gpc_refresh</a>(gpc, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> vcpu_info))) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">             * If this failed, userspace has screwed up the</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">             * vcpu_info mapping. No interrupts for you.</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        read_lock_irqsave(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    rc = ((<span class="keyword">struct </span>vcpu_info *)gpc-&gt;khva)-&gt;evtchn_upcall_pending;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    read_unlock_irqrestore(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;}</div>
<div class="ttc" id="apfncache_8c_html_a8fbb2514a5bf34fb8640c09e6e01294d"><div class="ttname"><a href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d">kvm_gpc_check</a></div><div class="ttdeci">bool kvm_gpc_check(struct gfn_to_pfn_cache *gpc, unsigned long len)</div><div class="ttdef"><b>Definition:</b> <a href="pfncache_8c_source.html#l00079">pfncache.c:79</a></div></div>
<div class="ttc" id="apfncache_8c_html_a95f177f84574a53b04762338d48238fe"><div class="ttname"><a href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe">kvm_gpc_refresh</a></div><div class="ttdeci">int kvm_gpc_refresh(struct gfn_to_pfn_cache *gpc, unsigned long len)</div><div class="ttdef"><b>Definition:</b> <a href="pfncache_8c_source.html#l00334">pfncache.c:334</a></div></div>
<div class="ttc" id="astructcompat__vcpu__info_html"><div class="ttname"><a href="structcompat__vcpu__info.html">compat_vcpu_info</a></div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00199">xen.h:199</a></div></div>
<div class="ttc" id="axen_8c_html_a773b39d480759f67926cb18ae2219281"><div class="ttname"><a href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a></div><div class="ttdeci">uint32_t flags</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00001">xen.c:1</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a02f3f67054c9bb0d9a1bd14c36a2e2df_cgraph.png" border="0" usemap="#axen_8c_a02f3f67054c9bb0d9a1bd14c36a2e2df_cgraph" alt=""/></div>
<map name="axen_8c_a02f3f67054c9bb0d9a1bd14c36a2e2df_cgraph" id="axen_8c_a02f3f67054c9bb0d9a1bd14c36a2e2df_cgraph">
<area shape="rect" title=" " alt="" coords="5,120,193,147"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="245,95,372,121"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="241,145,376,172"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="424,145,572,172"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="620,69,779,96"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="847,145,983,172"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="633,196,765,223"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="845,19,984,45"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1076,5,1228,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1312,5,1475,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="867,196,962,223"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="827,284,1003,311"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="841,335,988,377"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1051,56,1253,83"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1089,107,1215,133"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1069,157,1235,184"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1087,208,1217,235"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1098,259,1206,285"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1327,208,1459,235"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1533,259,1748,285"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="1796,259,1992,285"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1059,360,1245,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1301,360,1485,387"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1547,360,1734,387"/>
</map>
</div>

</div>
</div>
<a id="a9f374264fad08f9502cba60764e46d57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f374264fad08f9502cba60764e46d57">&#9670;&nbsp;</a></span>cancel_evtchn_poll()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void cancel_evtchn_poll </td>
          <td>(</td>
          <td class="paramtype">struct timer_list *&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01362">1362</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;{</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = from_timer(vcpu, t, arch.xen.poll_timer);</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160; </div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    kvm_make_request(KVM_REQ_UNBLOCK, vcpu);</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <a class="code" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44">kvm_vcpu_kick</a>(vcpu);</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_ac82f28c95da4a0cc137c5a37f08d1f44"><div class="ttname"><a href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44">kvm_vcpu_kick</a></div><div class="ttdeci">void kvm_vcpu_kick(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03931">kvm_main.c:3931</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a9f374264fad08f9502cba60764e46d57_cgraph.png" border="0" usemap="#axen_8c_a9f374264fad08f9502cba60764e46d57_cgraph" alt=""/></div>
<map name="axen_8c_a9f374264fad08f9502cba60764e46d57_cgraph" id="axen_8c_a9f374264fad08f9502cba60764e46d57_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,152,57"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="200,31,323,57"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="371,5,579,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="398,56,551,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a9f374264fad08f9502cba60764e46d57_icgraph.png" border="0" usemap="#axen_8c_a9f374264fad08f9502cba60764e46d57_icgraph" alt=""/></div>
<map name="axen_8c_a9f374264fad08f9502cba60764e46d57_icgraph" id="axen_8c_a9f374264fad08f9502cba60764e46d57_icgraph">
<area shape="rect" title=" " alt="" coords="668,5,815,32"/>
<area shape="rect" href="xen_8c.html#abb16147443c1deb060bf5a57799ab580" title=" " alt="" coords="473,5,620,32"/>
<area shape="rect" href="x86_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="253,5,425,32"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="5,5,205,32"/>
</map>
</div>

</div>
</div>
<a id="aae5e7772477e2ebd18c5ff39a91e3b37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae5e7772477e2ebd18c5ff39a91e3b37">&#9670;&nbsp;</a></span>DEFINE_STATIC_KEY_DEFERRED_FALSE()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DEFINE_STATIC_KEY_DEFERRED_FALSE </td>
          <td>(</td>
          <td class="paramtype">kvm_xen_enabled&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HZ&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7432a92fb771aeb9f60ca4d89c10f15b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7432a92fb771aeb9f60ca4d89c10f15b">&#9670;&nbsp;</a></span>evtchn_set_fn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int evtchn_set_fn </td>
          <td>(</td>
          <td class="paramtype">struct kvm_kernel_irq_routing_entry *&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>irq_source_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>line_status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01772">1772</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;{</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <span class="keywordflow">if</span> (!level)</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160; </div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0">kvm_xen_set_evtchn</a>(&amp;e-&gt;xen_evtchn, kvm);</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_a59091fb436633f85ba3e28187f5794d0"><div class="ttname"><a href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0">kvm_xen_set_evtchn</a></div><div class="ttdeci">static int kvm_xen_set_evtchn(struct kvm_xen_evtchn *xe, struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01713">xen.c:1713</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a7432a92fb771aeb9f60ca4d89c10f15b_cgraph.png" border="0" usemap="#axen_8c_a7432a92fb771aeb9f60ca4d89c10f15b_cgraph" alt=""/></div>
<map name="axen_8c_a7432a92fb771aeb9f60ca4d89c10f15b_cgraph" id="axen_8c_a7432a92fb771aeb9f60ca4d89c10f15b_cgraph">
<area shape="rect" title=" " alt="" coords="5,360,119,387"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="167,360,325,387"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="401,247,536,273"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="373,385,564,412"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="619,183,767,209"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="829,56,987,83"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1065,157,1201,184"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="842,208,974,235"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1064,31,1203,57"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1315,5,1467,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1567,5,1729,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1086,208,1181,235"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="1045,276,1221,303"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1060,327,1207,369"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1289,208,1492,235"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1327,259,1454,285"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1307,56,1474,83"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1325,107,1456,133"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1337,157,1445,184"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1582,157,1714,184"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1788,233,2003,260"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="2051,233,2247,260"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1297,360,1484,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1556,360,1740,387"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1802,360,1989,387"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="630,360,757,387"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1587,411,1709,437"/>
<area shape="rect" href="xen_8c.html#a920a89da9fa627b54860f838c736b003" title=" " alt="" coords="823,461,993,488"/>
<area shape="rect" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c" title=" " alt="" coords="612,513,775,554"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="626,309,761,336"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1791,411,1999,437"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1819,461,1972,488"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="831,534,985,575"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="1041,727,1225,769"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="1065,541,1201,568"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="1300,760,1481,787"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="1298,811,1483,853"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="1286,877,1495,904"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="1273,928,1508,955"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="1294,592,1487,619"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="1312,643,1469,685"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="1309,709,1472,736"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1577,877,1719,904"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="1322,541,1459,568"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1594,461,1702,488"/>
<area shape="rect" href="lapic_8c.html#ad063ed2f42a913efa82bad52d1b58aa8" title=" " alt="" coords="1583,512,1713,539"/>
<area shape="rect" href="x86_8c.html#a09da0747db3b012bff918f94816f0bd0" title=" " alt="" coords="1585,563,1711,589"/>
<area shape="rect" href="smm_8h.html#adbee86ed847633616e1e3afcc7e98e6e" title=" " alt="" coords="1585,613,1711,640"/>
<area shape="rect" href="lapic_8h.html#ada4d7479e3c0f2e45cb1565dab78c198" title=" " alt="" coords="1560,664,1736,691"/>
<area shape="rect" href="lapic_8h.html#aecd6ca5347dbb81047584149b2291019" title=" " alt="" coords="1566,715,1730,741"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a7432a92fb771aeb9f60ca4d89c10f15b_icgraph.png" border="0" usemap="#axen_8c_a7432a92fb771aeb9f60ca4d89c10f15b_icgraph" alt=""/></div>
<map name="axen_8c_a7432a92fb771aeb9f60ca4d89c10f15b_icgraph" id="axen_8c_a7432a92fb771aeb9f60ca4d89c10f15b_icgraph">
<area shape="rect" title=" " alt="" coords="1521,13,1635,39"/>
<area shape="rect" href="xen_8c.html#a508e4ef7a5f613f8e7daf8a633ae8ee5" title=" " alt="" coords="1299,13,1473,39"/>
<area shape="rect" href="irq__comm_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1079,13,1251,39"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="879,13,1031,39"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="676,13,831,39"/>
<area shape="rect" href="irq_8h.html#aaf23e09ccf4b445556e56ea8598e1311" title=" " alt="" coords="461,5,628,47"/>
<area shape="rect" href="x86_8c.html#aaf3dbbe842e06195f2e46694ea837380" title=" " alt="" coords="219,13,413,39"/>
<area shape="rect" href="kvm__main_8c.html#aaeec02d207c8ce5ca12b1ef2ac36fae0" title=" " alt="" coords="5,5,171,47"/>
</map>
</div>

</div>
</div>
<a id="a920a89da9fa627b54860f838c736b003"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a920a89da9fa627b54860f838c736b003">&#9670;&nbsp;</a></span>kvm_xen_check_poller()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_xen_check_poller </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01583">1583</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;{</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordtype">int</span> poll_evtchn = vcpu-&gt;arch.xen.poll_evtchn;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160; </div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="keywordflow">if</span> ((poll_evtchn == port || poll_evtchn == -1) &amp;&amp;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        test_and_clear_bit(vcpu-&gt;vcpu_idx, vcpu-&gt;kvm-&gt;arch.xen.poll_mask)) {</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        kvm_make_request(KVM_REQ_UNBLOCK, vcpu);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        <a class="code" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44">kvm_vcpu_kick</a>(vcpu);</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    }</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a920a89da9fa627b54860f838c736b003_cgraph.png" border="0" usemap="#axen_8c_a920a89da9fa627b54860f838c736b003_cgraph" alt=""/></div>
<map name="axen_8c_a920a89da9fa627b54860f838c736b003_cgraph" id="axen_8c_a920a89da9fa627b54860f838c736b003_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,176,57"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="224,31,347,57"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="395,5,603,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="422,56,575,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a920a89da9fa627b54860f838c736b003_icgraph.png" border="0" usemap="#axen_8c_a920a89da9fa627b54860f838c736b003_icgraph" alt=""/></div>
<map name="axen_8c_a920a89da9fa627b54860f838c736b003_icgraph" id="axen_8c_a920a89da9fa627b54860f838c736b003_icgraph">
<area shape="rect" title=" " alt="" coords="2309,63,2480,90"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="2071,63,2261,90"/>
<area shape="rect" href="irq__comm_8c.html#ae7b7837b6e17bc60af3f4d81e9a4147e" title=" " alt="" coords="1821,38,2023,65"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="1843,89,2001,115"/>
<area shape="rect" href="xen_8c.html#a7432a92fb771aeb9f60ca4d89c10f15b" title=" " alt="" coords="1613,13,1726,39"/>
<area shape="rect" href="xen_8c.html#a42cb09290dc39689baca95686be1ff69" title=" " alt="" coords="1565,63,1773,90"/>
<area shape="rect" href="xen_8c.html#a952a322aa5cce4d0bd3fe372d820de13" title=" " alt="" coords="1566,114,1773,141"/>
<area shape="rect" href="xen_8c.html#ab30962c07569543c2879269c4ec40d70" title=" " alt="" coords="1571,173,1768,199"/>
<area shape="rect" href="xen_8c.html#a508e4ef7a5f613f8e7daf8a633ae8ee5" title=" " alt="" coords="1341,13,1516,39"/>
<area shape="rect" href="irq__comm_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1117,13,1289,39"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="896,13,1048,39"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="676,13,831,39"/>
<area shape="rect" href="irq_8h.html#aaf23e09ccf4b445556e56ea8598e1311" title=" " alt="" coords="461,5,628,47"/>
<area shape="rect" href="x86_8c.html#aaf3dbbe842e06195f2e46694ea837380" title=" " alt="" coords="219,13,413,39"/>
<area shape="rect" href="kvm__main_8c.html#aaeec02d207c8ce5ca12b1ef2ac36fae0" title=" " alt="" coords="5,5,171,47"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="1355,63,1503,90"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="1113,63,1292,90"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="1354,114,1503,141"/>
<area shape="rect" href="irq_8c.html#a2d54275d9e142ae8e337298689483728" title=" " alt="" coords="1352,165,1505,207"/>
<area shape="rect" href="xen_8c.html#a0446c241eff9babb33e990edd1347b96" title=" " alt="" coords="1340,231,1517,258"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="1162,177,1243,203"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="879,177,1065,203"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="691,202,815,229"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="893,227,1051,254"/>
</map>
</div>

</div>
</div>
<a id="a3b39fb3ff349ca2ab87179dc95d5d105"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b39fb3ff349ca2ab87179dc95d5d105">&#9670;&nbsp;</a></span>kvm_xen_destroy_vcpu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_xen_destroy_vcpu </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l02122">2122</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;{</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d">kvm_xen_timer_enabled</a>(vcpu))</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        <a class="code" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2">kvm_xen_stop_timer</a>(vcpu);</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160; </div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;vcpu-&gt;arch.xen.runstate_cache);</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;vcpu-&gt;arch.xen.runstate2_cache);</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;vcpu-&gt;arch.xen.vcpu_info_cache);</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;vcpu-&gt;arch.xen.vcpu_time_info_cache);</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160; </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    del_timer_sync(&amp;vcpu-&gt;arch.xen.poll_timer);</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;}</div>
<div class="ttc" id="apfncache_8c_html_a028c789975722f39987f72cf8340f9d2"><div class="ttname"><a href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a></div><div class="ttdeci">void kvm_gpc_deactivate(struct gfn_to_pfn_cache *gpc)</div><div class="ttdef"><b>Definition:</b> <a href="pfncache_8c_source.html#l00382">pfncache.c:382</a></div></div>
<div class="ttc" id="axen_8c_html_a3e98609584a6375fe160f81dfafbf2f2"><div class="ttname"><a href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2">kvm_xen_stop_timer</a></div><div class="ttdeci">static void kvm_xen_stop_timer(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00184">xen.c:184</a></div></div>
<div class="ttc" id="axen_8h_html_a4219d1f48739ef7e6ccf35229c343a4d"><div class="ttname"><a href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d">kvm_xen_timer_enabled</a></div><div class="ttdeci">static bool kvm_xen_timer_enabled(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00155">xen.h:155</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a3b39fb3ff349ca2ab87179dc95d5d105_cgraph.png" border="0" usemap="#axen_8c_a3b39fb3ff349ca2ab87179dc95d5d105_cgraph" alt=""/></div>
<map name="axen_8c_a3b39fb3ff349ca2ab87179dc95d5d105_cgraph" id="axen_8c_a3b39fb3ff349ca2ab87179dc95d5d105_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,180,83"/>
<area shape="rect" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2" title=" " alt="" coords="241,5,398,32"/>
<area shape="rect" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2" title=" " alt="" coords="240,56,399,83"/>
<area shape="rect" href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d" title=" " alt="" coords="228,107,411,133"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="459,5,595,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a3b39fb3ff349ca2ab87179dc95d5d105_icgraph.png" border="0" usemap="#axen_8c_a3b39fb3ff349ca2ab87179dc95d5d105_icgraph" alt=""/></div>
<map name="axen_8c_a3b39fb3ff349ca2ab87179dc95d5d105_icgraph" id="axen_8c_a3b39fb3ff349ca2ab87179dc95d5d105_icgraph">
<area shape="rect" title=" " alt="" coords="1805,183,1980,209"/>
<area shape="rect" href="x86_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1577,183,1757,209"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1357,157,1502,184"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1329,208,1529,235"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1129,157,1281,184"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="911,157,1081,184"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="553,69,680,96"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="728,183,863,209"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="303,5,497,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="559,183,674,209"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="325,56,475,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="317,107,483,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="323,157,477,184"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="295,208,505,235"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="314,259,486,301"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="333,325,467,352"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="329,376,471,403"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="335,427,465,453"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="47,56,205,83"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="5,376,247,403"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="59,427,193,453"/>
</map>
</div>

</div>
</div>
<a id="a2de7c50ba573dd74c833c6b0bc675909"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2de7c50ba573dd74c833c6b0bc675909">&#9670;&nbsp;</a></span>kvm_xen_destroy_vm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_xen_destroy_vm </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l02165">2165</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;{</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="keyword">struct </span><a class="code" href="structevtchnfd.html">evtchnfd</a> *<a class="code" href="structevtchnfd.html">evtchnfd</a>;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160; </div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;kvm-&gt;arch.xen.shinfo_cache);</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160; </div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    idr_for_each_entry(&amp;kvm-&gt;arch.xen.evtchn_ports, <a class="code" href="structevtchnfd.html">evtchnfd</a>, i) {</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.port)</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;            eventfd_ctx_put(<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>.ctx);</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;        kfree(<a class="code" href="structevtchnfd.html">evtchnfd</a>);</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    }</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    idr_destroy(&amp;kvm-&gt;arch.xen.evtchn_ports);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160; </div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="keywordflow">if</span> (kvm-&gt;arch.xen_hvm_config.msr)</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        static_branch_slow_dec_deferred(&amp;kvm_xen_enabled);</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;}</div>
<div class="ttc" id="astructevtchnfd_html"><div class="ttname"><a href="structevtchnfd.html">evtchnfd</a></div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01856">xen.c:1856</a></div></div>
<div class="ttc" id="astructevtchnfd_html_a1dc1325dc2b1555d8f00a62c31cc9af1"><div class="ttname"><a href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">evtchnfd::eventfd</a></div><div class="ttdeci">struct evtchnfd::@47::@48 eventfd</div></div>
<div class="ttc" id="astructevtchnfd_html_a779636cd724a7537174fa794364853cf"><div class="ttname"><a href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">evtchnfd::port</a></div><div class="ttdeci">struct kvm_xen_evtchn port</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01858">xen.c:1860</a></div></div>
<div class="ttc" id="astructevtchnfd_html_a80cf5f28a421e245eeb4d6bd9bb2b161"><div class="ttname"><a href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">evtchnfd::deliver</a></div><div class="ttdeci">union evtchnfd::@47 deliver</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a2de7c50ba573dd74c833c6b0bc675909_cgraph.png" border="0" usemap="#axen_8c_a2de7c50ba573dd74c833c6b0bc675909_cgraph" alt=""/></div>
<map name="axen_8c_a2de7c50ba573dd74c833c6b0bc675909_cgraph" id="axen_8c_a2de7c50ba573dd74c833c6b0bc675909_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,171,32"/>
<area shape="rect" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2" title=" " alt="" coords="219,5,376,32"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="424,5,560,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a2de7c50ba573dd74c833c6b0bc675909_icgraph.png" border="0" usemap="#axen_8c_a2de7c50ba573dd74c833c6b0bc675909_icgraph" alt=""/></div>
<map name="axen_8c_a2de7c50ba573dd74c833c6b0bc675909_icgraph" id="axen_8c_a2de7c50ba573dd74c833c6b0bc675909_icgraph">
<area shape="rect" title=" " alt="" coords="1129,157,1295,184"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="911,157,1081,184"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="553,69,680,96"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="728,183,863,209"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="303,5,497,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="559,183,674,209"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="325,56,475,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="317,107,483,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="323,157,477,184"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="295,208,505,235"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="314,259,486,301"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="333,325,467,352"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="329,376,471,403"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="335,427,465,453"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="47,56,205,83"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="5,376,247,403"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="59,427,193,453"/>
</map>
</div>

</div>
</div>
<a id="af22ffcd81793c28d8f1952ed94e0d051"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af22ffcd81793c28d8f1952ed94e0d051">&#9670;&nbsp;</a></span>kvm_xen_eventfd_assign()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_xen_eventfd_assign </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_xen_hvm_attr *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01918">1918</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;{</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    u32 port = data-&gt;u.evtchn.send_port;</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    <span class="keyword">struct </span>eventfd_ctx *eventfd = NULL;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    <span class="keyword">struct </span><a class="code" href="structevtchnfd.html">evtchnfd</a> *<a class="code" href="structevtchnfd.html">evtchnfd</a>;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <span class="keywordtype">int</span> ret = -EINVAL;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160; </div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    <a class="code" href="structevtchnfd.html">evtchnfd</a> = kzalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structevtchnfd.html">evtchnfd</a>), GFP_KERNEL);</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structevtchnfd.html">evtchnfd</a>)</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <span class="keywordflow">switch</span>(data-&gt;u.evtchn.type) {</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="keywordflow">case</span> EVTCHNSTAT_ipi:</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;        <span class="comment">/* IPI  must map back to the same port# */</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.evtchn.deliver.port.port != data-&gt;u.evtchn.send_port)</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;            <span class="keywordflow">goto</span> out_noeventfd; <span class="comment">/* -EINVAL */</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160; </div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    <span class="keywordflow">case</span> EVTCHNSTAT_interdomain:</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.evtchn.deliver.port.port) {</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;            <span class="keywordflow">if</span> (data-&gt;u.evtchn.deliver.port.port &gt;= <a class="code" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d">max_evtchn_port</a>(kvm))</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                <span class="keywordflow">goto</span> out_noeventfd; <span class="comment">/* -EINVAL */</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;            <a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a> = eventfd_ctx_fdget(data-&gt;u.evtchn.deliver.eventfd.fd);</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;            <span class="keywordflow">if</span> (IS_ERR(<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>)) {</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                ret = PTR_ERR(<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>);</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                <span class="keywordflow">goto</span> out_noeventfd;</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;            }</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        }</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160; </div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    <span class="keywordflow">case</span> EVTCHNSTAT_virq:</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <span class="keywordflow">case</span> EVTCHNSTAT_closed:</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <span class="keywordflow">case</span> EVTCHNSTAT_unbound:</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <span class="keywordflow">case</span> EVTCHNSTAT_pirq:</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <span class="keywordflow">default</span>: <span class="comment">/* Unknown event channel type */</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        <span class="keywordflow">goto</span> out; <span class="comment">/* -EINVAL */</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    }</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160; </div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a243a7ac757eb756d21c0bf1de01f721a">send_port</a> = data-&gt;u.evtchn.send_port;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#abed32146cf6f6d463783d09542547650">type</a> = data-&gt;u.evtchn.type;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>) {</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>.ctx = <a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        <span class="comment">/* We only support 2 level event channels for now */</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.evtchn.deliver.port.priority != KVM_IRQ_ROUTING_XEN_EVTCHN_PRIO_2LEVEL)</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;            <span class="keywordflow">goto</span> out; <span class="comment">/* -EINVAL; */</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160; </div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.port = data-&gt;u.evtchn.deliver.port.port;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.vcpu_id = data-&gt;u.evtchn.deliver.port.vcpu;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;        <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.vcpu_idx = -1;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;        <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.priority = data-&gt;u.evtchn.deliver.port.priority;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    }</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160; </div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    ret = idr_alloc(&amp;kvm-&gt;arch.xen.evtchn_ports, <a class="code" href="structevtchnfd.html">evtchnfd</a>, <a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>, <a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a> + 1,</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;            GFP_KERNEL);</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <span class="keywordflow">if</span> (ret &gt;= 0)</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160; </div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="keywordflow">if</span> (ret == -ENOSPC)</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        ret = -EEXIST;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;out:</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>)</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        eventfd_ctx_put(<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>);</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;out_noeventfd:</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    kfree(<a class="code" href="structevtchnfd.html">evtchnfd</a>);</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;}</div>
<div class="ttc" id="astructevtchnfd_html_a243a7ac757eb756d21c0bf1de01f721a"><div class="ttname"><a href="structevtchnfd.html#a243a7ac757eb756d21c0bf1de01f721a">evtchnfd::send_port</a></div><div class="ttdeci">u32 send_port</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01857">xen.c:1857</a></div></div>
<div class="ttc" id="astructevtchnfd_html_abed32146cf6f6d463783d09542547650"><div class="ttname"><a href="structevtchnfd.html#abed32146cf6f6d463783d09542547650">evtchnfd::type</a></div><div class="ttdeci">u32 type</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01858">xen.c:1858</a></div></div>
<div class="ttc" id="axen_8c_html_abfe301f067b5181a7028ad5e62629e6d"><div class="ttname"><a href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d">max_evtchn_port</a></div><div class="ttdeci">static int max_evtchn_port(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01215">xen.c:1215</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_af22ffcd81793c28d8f1952ed94e0d051_cgraph.png" border="0" usemap="#axen_8c_af22ffcd81793c28d8f1952ed94e0d051_cgraph" alt=""/></div>
<map name="axen_8c_af22ffcd81793c28d8f1952ed94e0d051_cgraph" id="axen_8c_af22ffcd81793c28d8f1952ed94e0d051_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,192,32"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="240,5,375,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_af22ffcd81793c28d8f1952ed94e0d051_icgraph.png" border="0" usemap="#axen_8c_af22ffcd81793c28d8f1952ed94e0d051_icgraph" alt=""/></div>
<map name="axen_8c_af22ffcd81793c28d8f1952ed94e0d051_icgraph" id="axen_8c_af22ffcd81793c28d8f1952ed94e0d051_icgraph">
<area shape="rect" title=" " alt="" coords="656,5,843,32"/>
<area shape="rect" href="xen_8c.html#a2c5ff8f2966ec21633bf34f39f981d3c" title=" " alt="" coords="425,5,608,32"/>
<area shape="rect" href="xen_8c.html#a97a02cd2ae7319635c2de6370b82cb1b" title=" " alt="" coords="203,5,377,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a32bc1d5ae7e58f301dd76cc65e585f81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32bc1d5ae7e58f301dd76cc65e585f81">&#9670;&nbsp;</a></span>kvm_xen_eventfd_deassign()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_xen_eventfd_deassign </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01990">1990</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;{</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="keyword">struct </span><a class="code" href="structevtchnfd.html">evtchnfd</a> *<a class="code" href="structevtchnfd.html">evtchnfd</a>;</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160; </div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <a class="code" href="structevtchnfd.html">evtchnfd</a> = idr_remove(&amp;kvm-&gt;arch.xen.evtchn_ports, <a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>);</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160; </div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structevtchnfd.html">evtchnfd</a>)</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160; </div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    synchronize_srcu(&amp;kvm-&gt;srcu);</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.port)</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        eventfd_ctx_put(<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>.ctx);</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    kfree(<a class="code" href="structevtchnfd.html">evtchnfd</a>);</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a32bc1d5ae7e58f301dd76cc65e585f81_icgraph.png" border="0" usemap="#axen_8c_a32bc1d5ae7e58f301dd76cc65e585f81_icgraph" alt=""/></div>
<map name="axen_8c_a32bc1d5ae7e58f301dd76cc65e585f81_icgraph" id="axen_8c_a32bc1d5ae7e58f301dd76cc65e585f81_icgraph">
<area shape="rect" title=" " alt="" coords="656,5,859,32"/>
<area shape="rect" href="xen_8c.html#a2c5ff8f2966ec21633bf34f39f981d3c" title=" " alt="" coords="425,5,608,32"/>
<area shape="rect" href="xen_8c.html#a97a02cd2ae7319635c2de6370b82cb1b" title=" " alt="" coords="203,5,377,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="ac62834296caffe4f21f173993a510823"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac62834296caffe4f21f173993a510823">&#9670;&nbsp;</a></span>kvm_xen_eventfd_reset()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_xen_eventfd_reset </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l02008">2008</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;{</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="keyword">struct </span><a class="code" href="structevtchnfd.html">evtchnfd</a> *<a class="code" href="structevtchnfd.html">evtchnfd</a>, **all_evtchnfds;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <span class="keywordtype">int</span> n = 0;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160; </div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160; </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment">     * Because synchronize_srcu() cannot be called inside the</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">     * critical section, first collect all the evtchnfd objects</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">     * in an array as they are removed from evtchn_ports.</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    idr_for_each_entry(&amp;kvm-&gt;arch.xen.evtchn_ports, <a class="code" href="structevtchnfd.html">evtchnfd</a>, i)</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        n++;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160; </div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    all_evtchnfds = kmalloc_array(n, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structevtchnfd.html">evtchnfd</a> *), GFP_KERNEL);</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="keywordflow">if</span> (!all_evtchnfds) {</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    }</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160; </div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    n = 0;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    idr_for_each_entry(&amp;kvm-&gt;arch.xen.evtchn_ports, <a class="code" href="structevtchnfd.html">evtchnfd</a>, i) {</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        all_evtchnfds[n++] = <a class="code" href="structevtchnfd.html">evtchnfd</a>;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        idr_remove(&amp;kvm-&gt;arch.xen.evtchn_ports, <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a243a7ac757eb756d21c0bf1de01f721a">send_port</a>);</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    }</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160; </div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    synchronize_srcu(&amp;kvm-&gt;srcu);</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160; </div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    <span class="keywordflow">while</span> (n--) {</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        <a class="code" href="structevtchnfd.html">evtchnfd</a> = all_evtchnfds[n];</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.port)</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;            eventfd_ctx_put(<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>.ctx);</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        kfree(<a class="code" href="structevtchnfd.html">evtchnfd</a>);</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    }</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    kfree(all_evtchnfds);</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160; </div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_ac62834296caffe4f21f173993a510823_icgraph.png" border="0" usemap="#axen_8c_ac62834296caffe4f21f173993a510823_icgraph" alt=""/></div>
<map name="axen_8c_ac62834296caffe4f21f173993a510823_icgraph" id="axen_8c_ac62834296caffe4f21f173993a510823_icgraph">
<area shape="rect" title=" " alt="" coords="656,5,835,32"/>
<area shape="rect" href="xen_8c.html#a2c5ff8f2966ec21633bf34f39f981d3c" title=" " alt="" coords="425,5,608,32"/>
<area shape="rect" href="xen_8c.html#a97a02cd2ae7319635c2de6370b82cb1b" title=" " alt="" coords="203,5,377,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a43566f69e0b71f82cbd528428cd50c13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43566f69e0b71f82cbd528428cd50c13">&#9670;&nbsp;</a></span>kvm_xen_eventfd_update()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_xen_eventfd_update </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_xen_hvm_attr *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01871">1871</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;{</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    u32 port = data-&gt;u.evtchn.send_port;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keyword">struct </span><a class="code" href="structevtchnfd.html">evtchnfd</a> *<a class="code" href="structevtchnfd.html">evtchnfd</a>;</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160; </div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="comment">/* Protect writes to evtchnfd as well as the idr lookup.  */</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <a class="code" href="structevtchnfd.html">evtchnfd</a> = idr_find(&amp;kvm-&gt;arch.xen.evtchn_ports, <a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>);</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160; </div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    ret = -ENOENT;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structevtchnfd.html">evtchnfd</a>)</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160; </div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="comment">/* For an UPDATE, nothing may change except the priority/vcpu */</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    ret = -EINVAL;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#abed32146cf6f6d463783d09542547650">type</a> != data-&gt;u.evtchn.type)</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160; </div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">     * Port cannot change, and if it&#39;s zero that was an eventfd</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">     * which can&#39;t be changed either.</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.port ||</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.port != data-&gt;u.evtchn.deliver.port.port)</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160; </div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="comment">/* We only support 2 level event channels for now */</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    <span class="keywordflow">if</span> (data-&gt;u.evtchn.deliver.port.priority != KVM_IRQ_ROUTING_XEN_EVTCHN_PRIO_2LEVEL)</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160; </div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.priority = data-&gt;u.evtchn.deliver.port.priority;</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.vcpu_id != data-&gt;u.evtchn.deliver.port.vcpu) {</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.vcpu_id = data-&gt;u.evtchn.deliver.port.vcpu;</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.vcpu_idx = -1;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    }</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    ret = 0;</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;out_unlock:</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a43566f69e0b71f82cbd528428cd50c13_icgraph.png" border="0" usemap="#axen_8c_a43566f69e0b71f82cbd528428cd50c13_icgraph" alt=""/></div>
<map name="axen_8c_a43566f69e0b71f82cbd528428cd50c13_icgraph" id="axen_8c_a43566f69e0b71f82cbd528428cd50c13_icgraph">
<area shape="rect" title=" " alt="" coords="656,5,847,32"/>
<area shape="rect" href="xen_8c.html#a2c5ff8f2966ec21633bf34f39f981d3c" title=" " alt="" coords="425,5,608,32"/>
<area shape="rect" href="xen_8c.html#a97a02cd2ae7319635c2de6370b82cb1b" title=" " alt="" coords="203,5,377,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a42cb09290dc39689baca95686be1ff69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42cb09290dc39689baca95686be1ff69">&#9670;&nbsp;</a></span>kvm_xen_hcall_evtchn_send()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_xen_hcall_evtchn_send </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64 *&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l02070">2070</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;{</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    <span class="keyword">struct </span><a class="code" href="structevtchnfd.html">evtchnfd</a> *<a class="code" href="structevtchnfd.html">evtchnfd</a>;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="keyword">struct </span>evtchn_send send;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="keyword">struct </span><a class="code" href="structx86__exception.html">x86_exception</a> e;</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160; </div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <span class="comment">/* Sanity check: this structure is the same for 32-bit and 64-bit */</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    BUILD_BUG_ON(<span class="keyword">sizeof</span>(send) != 4);</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a7064cd8944dd550352cef83c72612045">kvm_read_guest_virt</a>(vcpu, param, &amp;send, <span class="keyword">sizeof</span>(send), &amp;e)) {</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        *r = -EFAULT;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    }</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160; </div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="comment">     * evtchnfd is protected by kvm-&gt;srcu; the idr lookup instead</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="comment">     * is protected by RCU.</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    rcu_read_lock();</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <a class="code" href="structevtchnfd.html">evtchnfd</a> = idr_find(&amp;vcpu-&gt;kvm-&gt;arch.xen.evtchn_ports, send.port);</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    rcu_read_unlock();</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="structevtchnfd.html">evtchnfd</a>)</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160; </div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>.port) {</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        <span class="keywordtype">int</span> ret = <a class="code" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0">kvm_xen_set_evtchn</a>(&amp;<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a779636cd724a7537174fa794364853cf">port</a>, vcpu-&gt;kvm);</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;        <span class="keywordflow">if</span> (ret &lt; 0 &amp;&amp; ret != -ENOTCONN)</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        eventfd_signal(<a class="code" href="structevtchnfd.html">evtchnfd</a>-&gt;<a class="code" href="structevtchnfd.html#a80cf5f28a421e245eeb4d6bd9bb2b161">deliver</a>.<a class="code" href="structevtchnfd.html#a1dc1325dc2b1555d8f00a62c31cc9af1">eventfd</a>.ctx);</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    }</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160; </div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    *r = 0;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;}</div>
<div class="ttc" id="astructx86__exception_html"><div class="ttname"><a href="structx86__exception.html">x86_exception</a></div><div class="ttdef"><b>Definition:</b> <a href="kvm__emulate_8h_source.html#l00022">kvm_emulate.h:22</a></div></div>
<div class="ttc" id="ax86_8c_html_a7064cd8944dd550352cef83c72612045"><div class="ttname"><a href="x86_8c.html#a7064cd8944dd550352cef83c72612045">kvm_read_guest_virt</a></div><div class="ttdeci">int kvm_read_guest_virt(struct kvm_vcpu *vcpu, gva_t addr, void *val, unsigned int bytes, struct x86_exception *exception)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l07572">x86.c:7572</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a42cb09290dc39689baca95686be1ff69_cgraph.png" border="0" usemap="#axen_8c_a42cb09290dc39689baca95686be1ff69_cgraph" alt=""/></div>
<map name="axen_8c_a42cb09290dc39689baca95686be1ff69_cgraph" id="axen_8c_a42cb09290dc39689baca95686be1ff69_cgraph">
<area shape="rect" title=" " alt="" coords="5,157,213,184"/>
<area shape="rect" href="x86_8c.html#a7064cd8944dd550352cef83c72612045" title=" " alt="" coords="261,128,420,155"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="261,183,420,209"/>
<area shape="rect" href="x86_8c.html#ab9c276fafa298a76b0f6a9f001db989b" title=" " alt="" coords="484,95,643,137"/>
<area shape="rect" href="kvm__main_8c.html#adfef9b2c2d6359fd443d98f51be19605" title=" " alt="" coords="707,81,913,108"/>
<area shape="rect" href="kvm__main_8c.html#acc4698e3f076cdbbd5d8ca788a94decf" title=" " alt="" coords="971,31,1154,57"/>
<area shape="rect" href="kvm__main_8c.html#ac4b56de4919be80c9cd4289f20437c64" title=" " alt="" coords="961,81,1164,108"/>
<area shape="rect" href="kvm__main_8c.html#adb8a0a4f675ca16ea81acd3b88089f13" title=" " alt="" coords="1212,31,1404,57"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1493,31,1645,57"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1745,5,1908,32"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="496,183,631,209"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="468,461,659,488"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="736,183,884,209"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="983,132,1142,159"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1240,183,1376,209"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="997,233,1129,260"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1239,107,1377,133"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1261,233,1355,260"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="1220,301,1396,328"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1235,353,1381,394"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1468,81,1671,108"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1506,132,1633,159"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1486,183,1653,209"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1504,233,1635,260"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1515,284,1623,311"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1761,233,1893,260"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1967,284,2181,311"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="2229,284,2425,311"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1476,385,1663,412"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1735,385,1919,412"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="747,385,873,412"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1765,487,1888,513"/>
<area shape="rect" href="xen_8c.html#a920a89da9fa627b54860f838c736b003" title=" " alt="" coords="977,487,1148,513"/>
<area shape="rect" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c" title=" " alt="" coords="729,538,891,579"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="743,604,877,631"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1970,461,2178,488"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1997,512,2151,539"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="985,538,1140,579"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="1216,723,1400,765"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="1240,541,1376,568"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="1479,588,1660,615"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="1477,639,1662,681"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="1465,705,1674,732"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="1452,756,1687,783"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="1473,807,1666,833"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="1491,858,1648,899"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="1488,924,1651,951"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1755,705,1898,732"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="1501,537,1638,564"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1773,537,1881,564"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a42cb09290dc39689baca95686be1ff69_icgraph.png" border="0" usemap="#axen_8c_a42cb09290dc39689baca95686be1ff69_icgraph" alt=""/></div>
<map name="axen_8c_a42cb09290dc39689baca95686be1ff69_icgraph" id="axen_8c_a42cb09290dc39689baca95686be1ff69_icgraph">
<area shape="rect" title=" " alt="" coords="428,5,636,32"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="232,5,380,32"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="5,5,184,32"/>
</map>
</div>

</div>
</div>
<a id="af82c8d988242af84bb833157369454b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af82c8d988242af84bb833157369454b4">&#9670;&nbsp;</a></span>kvm_xen_hcall_sched_op()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_xen_hcall_sched_op </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>longmode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64 *&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01370">1370</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;{</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="keywordflow">switch</span> (cmd) {</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keywordflow">case</span> SCHEDOP_poll:</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="xen_8c.html#a4bcdab8c7d597fa93d30ff9e9185cbc6">kvm_xen_schedop_poll</a>(vcpu, longmode, param, r))</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        fallthrough;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">case</span> SCHEDOP_yield:</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        <a class="code" href="kvm__main_8c.html#a7373edb7b1c787b14e657cd691e64d20">kvm_vcpu_on_spin</a>(vcpu, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        *r = 0;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    }</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160; </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_a7373edb7b1c787b14e657cd691e64d20"><div class="ttname"><a href="kvm__main_8c.html#a7373edb7b1c787b14e657cd691e64d20">kvm_vcpu_on_spin</a></div><div class="ttdeci">void kvm_vcpu_on_spin(struct kvm_vcpu *me, bool yield_to_kernel_mode)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l04056">kvm_main.c:4056</a></div></div>
<div class="ttc" id="axen_8c_html_a4bcdab8c7d597fa93d30ff9e9185cbc6"><div class="ttname"><a href="xen_8c.html#a4bcdab8c7d597fa93d30ff9e9185cbc6">kvm_xen_schedop_poll</a></div><div class="ttdeci">static bool kvm_xen_schedop_poll(struct kvm_vcpu *vcpu, bool longmode, u64 param, u64 *r)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01261">xen.c:1261</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_af82c8d988242af84bb833157369454b4_icgraph.png" border="0" usemap="#axen_8c_af82c8d988242af84bb833157369454b4_icgraph" alt=""/></div>
<map name="axen_8c_af82c8d988242af84bb833157369454b4_icgraph" id="axen_8c_af82c8d988242af84bb833157369454b4_icgraph">
<area shape="rect" title=" " alt="" coords="428,5,615,32"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="232,5,380,32"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="5,5,184,32"/>
</map>
</div>

</div>
</div>
<a id="aee859a411f74e3aa2dd986c561eb72dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee859a411f74e3aa2dd986c561eb72dc">&#9670;&nbsp;</a></span>kvm_xen_hcall_set_timer_op()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_xen_hcall_set_timer_op </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64 *&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01452">1452</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;{</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d">kvm_xen_timer_enabled</a>(vcpu))</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160; </div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">if</span> (timeout) {</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        uint64_t guest_now = <a class="code" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2">get_kvmclock_ns</a>(vcpu-&gt;kvm);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        int64_t delta = timeout - guest_now;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160; </div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        <span class="comment">/* Xen has a &#39;Linux workaround&#39; in do_set_timer_op() which</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment">         * checks for negative absolute timeout values (caused by</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">         * integer overflow), and for values about 13 days in the</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">         * future (2^50ns) which would be caused by jiffies</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">         * overflow. For those cases, it sets the timeout 100ms in</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="comment">         * the future (not *too* soon, since if a guest really did</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment">         * set a long timeout on purpose we don&#39;t want to keep</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">         * churning CPU time by waking it up).</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <span class="keywordflow">if</span> (unlikely((int64_t)timeout &lt; 0 ||</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                 (delta &gt; 0 &amp;&amp; (uint32_t) (delta &gt;&gt; 50) != 0))) {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            delta = 100 * NSEC_PER_MSEC;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            timeout = guest_now + delta;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        }</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160; </div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <a class="code" href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459">kvm_xen_start_timer</a>(vcpu, timeout, delta);</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <a class="code" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2">kvm_xen_stop_timer</a>(vcpu);</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    }</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160; </div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    *r = 0;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;}</div>
<div class="ttc" id="ax86_8c_html_abd4913c1a5c4c66a089ccadc445cd9a2"><div class="ttname"><a href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2">get_kvmclock_ns</a></div><div class="ttdeci">u64 get_kvmclock_ns(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l03105">x86.c:3105</a></div></div>
<div class="ttc" id="axen_8c_html_a0187b2f16608bbdf5525ad8c8e882459"><div class="ttname"><a href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459">kvm_xen_start_timer</a></div><div class="ttdeci">static void kvm_xen_start_timer(struct kvm_vcpu *vcpu, u64 guest_abs, s64 delta_ns)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00161">xen.c:161</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_aee859a411f74e3aa2dd986c561eb72dc_cgraph.png" border="0" usemap="#axen_8c_aee859a411f74e3aa2dd986c561eb72dc_cgraph" alt=""/></div>
<map name="axen_8c_aee859a411f74e3aa2dd986c561eb72dc_cgraph" id="axen_8c_aee859a411f74e3aa2dd986c561eb72dc_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,216,159"/>
<area shape="rect" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2" title=" " alt="" coords="288,56,423,83"/>
<area shape="rect" href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459" title=" " alt="" coords="275,107,435,133"/>
<area shape="rect" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2" title=" " alt="" coords="276,157,435,184"/>
<area shape="rect" href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d" title=" " alt="" coords="264,208,447,235"/>
<area shape="rect" href="x86_8c.html#a860bfcc41711ba017de704d71fe362a1" title=" " alt="" coords="512,56,625,83"/>
<area shape="rect" href="x86_8c.html#a5fb8061b510d35a89dc02d72eba913fc" title=" " alt="" coords="691,56,817,83"/>
<area shape="rect" href="x86_8c.html#ada3ebfd54ed70054113191d6575e5a71" title=" " alt="" coords="887,5,1017,32"/>
<area shape="rect" href="x86_8c.html#abb79b4397b27e4e42529a46cccbad62c" title=" " alt="" coords="865,56,1039,83"/>
<area shape="rect" href="x86_8c.html#aa540b8d63c340bf4bad96578dfe9c329" title=" " alt="" coords="873,107,1031,133"/>
<area shape="rect" href="x86_8c.html#a7c2c90d8aa6d48b108bbbe630d120f95" title=" " alt="" coords="1087,107,1161,133"/>
<area shape="rect" href="xen_8c.html#a4017950790585b6ba8d51d7b8bb2d5f7" title=" " alt="" coords="495,107,643,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_aee859a411f74e3aa2dd986c561eb72dc_icgraph.png" border="0" usemap="#axen_8c_aee859a411f74e3aa2dd986c561eb72dc_icgraph" alt=""/></div>
<map name="axen_8c_aee859a411f74e3aa2dd986c561eb72dc_icgraph" id="axen_8c_aee859a411f74e3aa2dd986c561eb72dc_icgraph">
<area shape="rect" title=" " alt="" coords="428,5,639,32"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="232,5,380,32"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="5,5,184,32"/>
</map>
</div>

</div>
</div>
<a id="a770531539245dce08f6187702354032c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a770531539245dce08f6187702354032c">&#9670;&nbsp;</a></span>kvm_xen_hcall_vcpu_op()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_xen_hcall_vcpu_op </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>longmode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>vcpu_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64 *&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01394">1394</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;{</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keyword">struct </span>vcpu_set_singleshot_timer oneshot;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keyword">struct </span><a class="code" href="structx86__exception.html">x86_exception</a> e;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    s64 delta;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160; </div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d">kvm_xen_timer_enabled</a>(vcpu))</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160; </div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordflow">switch</span> (cmd) {</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="keywordflow">case</span> VCPUOP_set_singleshot_timer:</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        <span class="keywordflow">if</span> (vcpu-&gt;arch.xen.vcpu_id != vcpu_id) {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            *r = -EINVAL;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        }</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160; </div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">         * The only difference for 32-bit compat is the 4 bytes of</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">         * padding after the interesting part of the structure. So</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">         * for a faithful emulation of Xen we have to *try* to copy</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">         * the padding and return -EFAULT if we can&#39;t. Otherwise we</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">         * might as well just have copied the 12-byte 32-bit struct.</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__set__singleshot__timer.html">compat_vcpu_set_singleshot_timer</a>, <a class="code" href="xen_8c.html#a2091e51764159d2bda5738c2a1f2382a">timeout_abs_ns</a>) !=</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                 offsetof(<span class="keyword">struct</span> vcpu_set_singleshot_timer, <a class="code" href="xen_8c.html#a2091e51764159d2bda5738c2a1f2382a">timeout_abs_ns</a>));</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        BUILD_BUG_ON(sizeof_field(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__set__singleshot__timer.html">compat_vcpu_set_singleshot_timer</a>, <a class="code" href="xen_8c.html#a2091e51764159d2bda5738c2a1f2382a">timeout_abs_ns</a>) !=</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                 sizeof_field(<span class="keyword">struct</span> vcpu_set_singleshot_timer, <a class="code" href="xen_8c.html#a2091e51764159d2bda5738c2a1f2382a">timeout_abs_ns</a>));</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;        BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__set__singleshot__timer.html">compat_vcpu_set_singleshot_timer</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>) !=</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                 offsetof(<span class="keyword">struct</span> vcpu_set_singleshot_timer, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>));</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        BUILD_BUG_ON(sizeof_field(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__set__singleshot__timer.html">compat_vcpu_set_singleshot_timer</a>, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>) !=</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                 sizeof_field(<span class="keyword">struct</span> vcpu_set_singleshot_timer, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>));</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160; </div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a7064cd8944dd550352cef83c72612045">kvm_read_guest_virt</a>(vcpu, param, &amp;oneshot, longmode ? <span class="keyword">sizeof</span>(oneshot) :</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                    <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__set__singleshot__timer.html">compat_vcpu_set_singleshot_timer</a>), &amp;e)) {</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            *r = -EFAULT;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        }</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160; </div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        <span class="comment">/* A delta &lt;= 0 results in an immediate callback, which is what we want */</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        delta = oneshot.timeout_abs_ns - <a class="code" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2">get_kvmclock_ns</a>(vcpu-&gt;kvm);</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        <a class="code" href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459">kvm_xen_start_timer</a>(vcpu, oneshot.timeout_abs_ns, delta);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        *r = 0;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160; </div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <span class="keywordflow">case</span> VCPUOP_stop_singleshot_timer:</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        <span class="keywordflow">if</span> (vcpu-&gt;arch.xen.vcpu_id != vcpu_id) {</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;            *r = -EINVAL;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        }</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <a class="code" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2">kvm_xen_stop_timer</a>(vcpu);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        *r = 0;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    }</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160; </div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;}</div>
<div class="ttc" id="astructcompat__vcpu__set__singleshot__timer_html"><div class="ttname"><a href="structcompat__vcpu__set__singleshot__timer.html">compat_vcpu_set_singleshot_timer</a></div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01389">xen.c:1389</a></div></div>
<div class="ttc" id="axen_8c_html_a2091e51764159d2bda5738c2a1f2382a"><div class="ttname"><a href="xen_8c.html#a2091e51764159d2bda5738c2a1f2382a">timeout_abs_ns</a></div><div class="ttdeci">uint64_t timeout_abs_ns</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00000">xen.c:0</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a770531539245dce08f6187702354032c_cgraph.png" border="0" usemap="#axen_8c_a770531539245dce08f6187702354032c_cgraph" alt=""/></div>
<map name="axen_8c_a770531539245dce08f6187702354032c_cgraph" id="axen_8c_a770531539245dce08f6187702354032c_cgraph">
<area shape="rect" title=" " alt="" coords="5,203,185,229"/>
<area shape="rect" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2" title=" " alt="" coords="257,87,392,113"/>
<area shape="rect" href="x86_8c.html#a7064cd8944dd550352cef83c72612045" title=" " alt="" coords="245,152,404,179"/>
<area shape="rect" href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459" title=" " alt="" coords="245,203,405,229"/>
<area shape="rect" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2" title=" " alt="" coords="245,253,404,280"/>
<area shape="rect" href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d" title=" " alt="" coords="233,304,416,331"/>
<area shape="rect" href="x86_8c.html#a860bfcc41711ba017de704d71fe362a1" title=" " alt="" coords="487,72,600,99"/>
<area shape="rect" href="x86_8c.html#a5fb8061b510d35a89dc02d72eba913fc" title=" " alt="" coords="711,61,837,88"/>
<area shape="rect" href="x86_8c.html#ada3ebfd54ed70054113191d6575e5a71" title=" " alt="" coords="962,5,1091,32"/>
<area shape="rect" href="x86_8c.html#abb79b4397b27e4e42529a46cccbad62c" title=" " alt="" coords="940,56,1113,83"/>
<area shape="rect" href="x86_8c.html#aa540b8d63c340bf4bad96578dfe9c329" title=" " alt="" coords="948,107,1105,133"/>
<area shape="rect" href="x86_8c.html#a7c2c90d8aa6d48b108bbbe630d120f95" title=" " alt="" coords="1235,107,1309,133"/>
<area shape="rect" href="x86_8c.html#ab9c276fafa298a76b0f6a9f001db989b" title=" " alt="" coords="464,145,623,186"/>
<area shape="rect" href="kvm__main_8c.html#adfef9b2c2d6359fd443d98f51be19605" title=" " alt="" coords="671,157,877,184"/>
<area shape="rect" href="kvm__main_8c.html#acc4698e3f076cdbbd5d8ca788a94decf" title=" " alt="" coords="935,157,1118,184"/>
<area shape="rect" href="kvm__main_8c.html#ac4b56de4919be80c9cd4289f20437c64" title=" " alt="" coords="925,208,1128,235"/>
<area shape="rect" href="kvm__main_8c.html#adb8a0a4f675ca16ea81acd3b88089f13" title=" " alt="" coords="1176,157,1368,184"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1416,132,1568,159"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1616,157,1779,184"/>
<area shape="rect" href="xen_8c.html#a4017950790585b6ba8d51d7b8bb2d5f7" title=" " alt="" coords="469,211,617,237"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a770531539245dce08f6187702354032c_icgraph.png" border="0" usemap="#axen_8c_a770531539245dce08f6187702354032c_icgraph" alt=""/></div>
<map name="axen_8c_a770531539245dce08f6187702354032c_icgraph" id="axen_8c_a770531539245dce08f6187702354032c_icgraph">
<area shape="rect" title=" " alt="" coords="428,5,608,32"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="232,5,380,32"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="5,5,184,32"/>
</map>
</div>

</div>
</div>
<a id="ab6a83667716abc62955e742bba62ba17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6a83667716abc62955e742bba62ba17">&#9670;&nbsp;</a></span>kvm_xen_hvm_config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_hvm_config </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_xen_hvm_config *&#160;</td>
          <td class="paramname"><em>xhc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01161">1161</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;{</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="comment">/* Only some feature flags need to be *enabled* by userspace */</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    u32 permitted_flags = KVM_XEN_HVM_CONFIG_INTERCEPT_HCALL |</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        KVM_XEN_HVM_CONFIG_EVTCHN_SEND |</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        KVM_XEN_HVM_CONFIG_PVCLOCK_TSC_UNSTABLE;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    u32 old_flags;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; </div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">if</span> (xhc-&gt;flags &amp; ~permitted_flags)</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">     * With hypercall interception the kernel generates its own</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">     * hypercall page so it must not be provided.</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="keywordflow">if</span> ((xhc-&gt;flags &amp; KVM_XEN_HVM_CONFIG_INTERCEPT_HCALL) &amp;&amp;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        (xhc-&gt;blob_addr_32 || xhc-&gt;blob_addr_64 ||</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;         xhc-&gt;blob_size_32 || xhc-&gt;blob_size_64))</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160; </div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160; </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="keywordflow">if</span> (xhc-&gt;msr &amp;&amp; !kvm-&gt;arch.xen_hvm_config.msr)</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        static_branch_inc(&amp;kvm_xen_enabled.key);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!xhc-&gt;msr &amp;&amp; kvm-&gt;arch.xen_hvm_config.msr)</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        static_branch_slow_dec_deferred(&amp;kvm_xen_enabled);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160; </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    old_flags = kvm-&gt;arch.xen_hvm_config.flags;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    memcpy(&amp;kvm-&gt;arch.xen_hvm_config, xhc, <span class="keyword">sizeof</span>(*xhc));</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160; </div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="keywordflow">if</span> ((old_flags ^ xhc-&gt;flags) &amp; KVM_XEN_HVM_CONFIG_PVCLOCK_TSC_UNSTABLE)</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        <a class="code" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6">kvm_make_all_cpus_request</a>(kvm, KVM_REQ_CLOCK_UPDATE);</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_abaa3f5ff00150487b52dd21c1617bab6"><div class="ttname"><a href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6">kvm_make_all_cpus_request</a></div><div class="ttdeci">bool kvm_make_all_cpus_request(struct kvm *kvm, unsigned int req)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l00340">kvm_main.c:340</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_ab6a83667716abc62955e742bba62ba17_cgraph.png" border="0" usemap="#axen_8c_ab6a83667716abc62955e742bba62ba17_cgraph" alt=""/></div>
<map name="axen_8c_ab6a83667716abc62955e742bba62ba17_cgraph" id="axen_8c_ab6a83667716abc62955e742bba62ba17_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,168,57"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="216,31,427,57"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="475,23,685,65"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="744,5,911,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="733,56,921,83"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1018,5,1097,32"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="969,56,1145,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="981,107,1134,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_ab6a83667716abc62955e742bba62ba17_icgraph.png" border="0" usemap="#axen_8c_ab6a83667716abc62955e742bba62ba17_icgraph" alt=""/></div>
<map name="axen_8c_ab6a83667716abc62955e742bba62ba17_icgraph" id="axen_8c_ab6a83667716abc62955e742bba62ba17_icgraph">
<area shape="rect" title=" " alt="" coords="203,5,365,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a952a322aa5cce4d0bd3fe372d820de13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a952a322aa5cce4d0bd3fe372d820de13">&#9670;&nbsp;</a></span>kvm_xen_hvm_evtchn_send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_hvm_evtchn_send </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_irq_routing_xen_evtchn *&#160;</td>
          <td class="paramname"><em>uxe</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01824">1824</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;{</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keyword">struct </span>kvm_xen_evtchn e;</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160; </div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="keywordflow">if</span> (!uxe-&gt;port || uxe-&gt;port &gt;= <a class="code" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d">max_evtchn_port</a>(kvm))</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160; </div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="comment">/* We only support 2 level event channels for now */</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="keywordflow">if</span> (uxe-&gt;priority != KVM_IRQ_ROUTING_XEN_EVTCHN_PRIO_2LEVEL)</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160; </div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    e.port = uxe-&gt;port;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    e.vcpu_id = uxe-&gt;vcpu;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    e.vcpu_idx = -1;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    e.priority = uxe-&gt;priority;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160; </div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    ret = <a class="code" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0">kvm_xen_set_evtchn</a>(&amp;e, kvm);</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160; </div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">     * None of that &#39;return 1 if it actually got delivered&#39; nonsense.</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment">     * We don&#39;t care if it was masked (-ENOTCONN) either.</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keywordflow">if</span> (ret &gt; 0 || ret == -ENOTCONN)</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        ret = 0;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160; </div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a952a322aa5cce4d0bd3fe372d820de13_cgraph.png" border="0" usemap="#axen_8c_a952a322aa5cce4d0bd3fe372d820de13_cgraph" alt=""/></div>
<map name="axen_8c_a952a322aa5cce4d0bd3fe372d820de13_cgraph" id="axen_8c_a952a322aa5cce4d0bd3fe372d820de13_cgraph">
<area shape="rect" title=" " alt="" coords="5,520,212,547"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="260,461,419,488"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="719,579,854,605"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="495,284,629,311"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="467,461,657,488"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="713,183,861,209"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="922,56,1081,83"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1159,157,1295,184"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="935,208,1067,235"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1157,31,1296,57"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1408,5,1560,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1660,5,1823,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1179,208,1274,235"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="1139,276,1315,303"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1153,327,1300,369"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1383,56,1585,83"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1421,107,1547,133"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1401,157,1567,184"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1419,208,1549,235"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1430,259,1538,285"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1675,208,1807,235"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1881,259,2096,285"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="2144,259,2340,285"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1391,360,1577,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1649,360,1833,387"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1895,360,2082,387"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="723,360,850,387"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1680,411,1803,437"/>
<area shape="rect" href="xen_8c.html#a920a89da9fa627b54860f838c736b003" title=" " alt="" coords="916,461,1087,488"/>
<area shape="rect" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c" title=" " alt="" coords="705,513,868,554"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1885,411,2093,437"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1912,461,2065,488"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="924,555,1079,597"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="1135,766,1319,807"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="1159,563,1295,589"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="1393,631,1575,657"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="1391,682,1577,723"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="1379,748,1589,775"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="1367,799,1601,825"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="1387,849,1581,876"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="1405,901,1563,942"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="1403,967,1565,993"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1670,765,1813,792"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="1415,563,1553,589"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1687,461,1795,488"/>
<area shape="rect" href="lapic_8c.html#ad063ed2f42a913efa82bad52d1b58aa8" title=" " alt="" coords="1677,512,1806,539"/>
<area shape="rect" href="x86_8c.html#a09da0747db3b012bff918f94816f0bd0" title=" " alt="" coords="1678,563,1805,589"/>
<area shape="rect" href="smm_8h.html#adbee86ed847633616e1e3afcc7e98e6e" title=" " alt="" coords="1679,613,1804,640"/>
<area shape="rect" href="lapic_8h.html#ada4d7479e3c0f2e45cb1565dab78c198" title=" " alt="" coords="1653,664,1829,691"/>
<area shape="rect" href="lapic_8h.html#aecd6ca5347dbb81047584149b2291019" title=" " alt="" coords="1659,715,1823,741"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a952a322aa5cce4d0bd3fe372d820de13_icgraph.png" border="0" usemap="#axen_8c_a952a322aa5cce4d0bd3fe372d820de13_icgraph" alt=""/></div>
<map name="axen_8c_a952a322aa5cce4d0bd3fe372d820de13_icgraph" id="axen_8c_a952a322aa5cce4d0bd3fe372d820de13_icgraph">
<area shape="rect" title=" " alt="" coords="203,5,409,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="abffcd537f5794ca49a6942dade53a715"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abffcd537f5794ca49a6942dade53a715">&#9670;&nbsp;</a></span>kvm_xen_hvm_get_attr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_hvm_get_attr </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_xen_hvm_attr *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00689">689</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;{</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordtype">int</span> r = -ENOENT;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">switch</span> (data-&gt;type) {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_LONG_MODE:</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        data-&gt;u.long_mode = kvm-&gt;arch.xen.long_mode;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        r = 0;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160; </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_SHARED_INFO:</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">if</span> (kvm-&gt;arch.xen.shinfo_cache.active)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            data-&gt;u.shared_info.gfn = gpa_to_gfn(kvm-&gt;arch.xen.shinfo_cache.gpa);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            data-&gt;u.shared_info.gfn = KVM_XEN_INVALID_GFN;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        r = 0;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_UPCALL_VECTOR:</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        data-&gt;u.vector = kvm-&gt;arch.xen.upcall_vector;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        r = 0;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_XEN_VERSION:</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        data-&gt;u.xen_version = kvm-&gt;arch.xen.xen_version;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        r = 0;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_RUNSTATE_UPDATE_FLAG:</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">if</span> (!sched_info_on()) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            r = -EOPNOTSUPP;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        }</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        data-&gt;u.runstate_update_flag = kvm-&gt;arch.xen.runstate_update_flag;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        r = 0;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_abffcd537f5794ca49a6942dade53a715_icgraph.png" border="0" usemap="#axen_8c_abffcd537f5794ca49a6942dade53a715_icgraph" alt=""/></div>
<map name="axen_8c_abffcd537f5794ca49a6942dade53a715_icgraph" id="axen_8c_abffcd537f5794ca49a6942dade53a715_icgraph">
<area shape="rect" title=" " alt="" coords="203,5,377,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a97a02cd2ae7319635c2de6370b82cb1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97a02cd2ae7319635c2de6370b82cb1b">&#9670;&nbsp;</a></span>kvm_xen_hvm_set_attr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_hvm_set_attr </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_xen_hvm_attr *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00626">626</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;{</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordtype">int</span> r = -ENOENT;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">switch</span> (data-&gt;type) {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_LONG_MODE:</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keywordflow">if</span> (!IS_ENABLED(CONFIG_64BIT) &amp;&amp; data-&gt;u.long_mode) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            kvm-&gt;arch.xen.long_mode = !!data-&gt;u.long_mode;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            r = 0;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_SHARED_INFO:</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        r = <a class="code" href="xen_8c.html#a302274d0dadb3dc482dbf4efca0c51d0">kvm_xen_shared_info_init</a>(kvm, data-&gt;u.shared_info.gfn);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_UPCALL_VECTOR:</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.vector &amp;&amp; data-&gt;u.vector &lt; 0x10)</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            kvm-&gt;arch.xen.upcall_vector = data-&gt;u.vector;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            r = 0;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_EVTCHN:</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        r = <a class="code" href="xen_8c.html#a2c5ff8f2966ec21633bf34f39f981d3c">kvm_xen_setattr_evtchn</a>(kvm, data);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_XEN_VERSION:</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        kvm-&gt;arch.xen.xen_version = data-&gt;u.xen_version;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        r = 0;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_ATTR_TYPE_RUNSTATE_UPDATE_FLAG:</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordflow">if</span> (!sched_info_on()) {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            r = -EOPNOTSUPP;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        kvm-&gt;arch.xen.runstate_update_flag = !!data-&gt;u.runstate_update_flag;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        r = 0;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_a2c5ff8f2966ec21633bf34f39f981d3c"><div class="ttname"><a href="xen_8c.html#a2c5ff8f2966ec21633bf34f39f981d3c">kvm_xen_setattr_evtchn</a></div><div class="ttdeci">static int kvm_xen_setattr_evtchn(struct kvm *kvm, struct kvm_xen_hvm_attr *data)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l02050">xen.c:2050</a></div></div>
<div class="ttc" id="axen_8c_html_a302274d0dadb3dc482dbf4efca0c51d0"><div class="ttname"><a href="xen_8c.html#a302274d0dadb3dc482dbf4efca0c51d0">kvm_xen_shared_info_init</a></div><div class="ttdeci">static int kvm_xen_shared_info_init(struct kvm *kvm, gfn_t gfn)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00037">xen.c:37</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a97a02cd2ae7319635c2de6370b82cb1b_cgraph.png" border="0" usemap="#axen_8c_a97a02cd2ae7319635c2de6370b82cb1b_cgraph" alt=""/></div>
<map name="axen_8c_a97a02cd2ae7319635c2de6370b82cb1b_cgraph" id="axen_8c_a97a02cd2ae7319635c2de6370b82cb1b_cgraph">
<area shape="rect" title=" " alt="" coords="5,240,180,267"/>
<area shape="rect" href="xen_8c.html#a2c5ff8f2966ec21633bf34f39f981d3c" title=" " alt="" coords="233,139,415,165"/>
<area shape="rect" href="xen_8c.html#a302274d0dadb3dc482dbf4efca0c51d0" title=" " alt="" coords="228,316,420,343"/>
<area shape="rect" href="xen_8c.html#af22ffcd81793c28d8f1952ed94e0d051" title=" " alt="" coords="480,113,667,140"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="765,139,899,165"/>
<area shape="rect" href="xen_8c.html#a32bc1d5ae7e58f301dd76cc65e585f81" title=" " alt="" coords="472,215,675,241"/>
<area shape="rect" href="xen_8c.html#ac62834296caffe4f21f173993a510823" title=" " alt="" coords="484,12,663,39"/>
<area shape="rect" href="xen_8c.html#a43566f69e0b71f82cbd528428cd50c13" title=" " alt="" coords="478,63,669,89"/>
<area shape="rect" href="x86_8c.html#a3a7c3d562176e798101d21bfaaae77a9" title=" " alt="" coords="496,487,651,529"/>
<area shape="rect" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559" title=" " alt="" coords="503,265,644,292"/>
<area shape="rect" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2" title=" " alt="" coords="753,313,911,340"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="468,371,679,397"/>
<area shape="rect" href="x86_8c.html#ada3ebfd54ed70054113191d6575e5a71" title=" " alt="" coords="1482,469,1611,496"/>
<area shape="rect" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2" title=" " alt="" coords="765,520,899,547"/>
<area shape="rect" href="x86_8c.html#aa540b8d63c340bf4bad96578dfe9c329" title=" " alt="" coords="1468,571,1625,597"/>
<area shape="rect" href="x86_8c.html#a860bfcc41711ba017de704d71fe362a1" title=" " alt="" coords="1023,520,1136,547"/>
<area shape="rect" href="x86_8c.html#a5fb8061b510d35a89dc02d72eba913fc" title=" " alt="" coords="1246,520,1373,547"/>
<area shape="rect" href="x86_8c.html#abb79b4397b27e4e42529a46cccbad62c" title=" " alt="" coords="1460,520,1633,547"/>
<area shape="rect" href="x86_8c.html#a7c2c90d8aa6d48b108bbbe630d120f95" title=" " alt="" coords="1751,571,1825,597"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="758,237,906,264"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="1000,95,1159,121"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1241,267,1377,293"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="1013,212,1145,239"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1240,31,1379,57"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1471,5,1623,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1707,5,1869,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1262,216,1357,243"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="1221,99,1397,125"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1236,150,1383,191"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1445,157,1648,184"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1483,259,1610,285"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1463,208,1630,235"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1481,309,1612,336"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1493,360,1601,387"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1722,183,1854,209"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1928,132,2143,159"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="2191,132,2387,159"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1453,56,1640,83"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1696,56,1880,83"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1942,56,2129,83"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="727,365,937,406"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="996,419,1163,445"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="985,368,1173,395"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1270,419,1349,445"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1221,317,1397,344"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1233,368,1386,395"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a97a02cd2ae7319635c2de6370b82cb1b_icgraph.png" border="0" usemap="#axen_8c_a97a02cd2ae7319635c2de6370b82cb1b_icgraph" alt=""/></div>
<map name="axen_8c_a97a02cd2ae7319635c2de6370b82cb1b_icgraph" id="axen_8c_a97a02cd2ae7319635c2de6370b82cb1b_icgraph">
<area shape="rect" title=" " alt="" coords="203,5,377,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="aaf398a8803a79984b06fbf9e2a64193c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf398a8803a79984b06fbf9e2a64193c">&#9670;&nbsp;</a></span>kvm_xen_hypercall()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_hypercall </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01486">1486</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;{</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordtype">bool</span> longmode;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    u64 input, params[6], r = -ENOSYS;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="keywordtype">bool</span> handled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    u8 cpl;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    input = (u64)<a class="code" href="x86_8h.html#a9f7e7cd8d352da04de3bf53cbb3b4e57">kvm_register_read</a>(vcpu, VCPU_REGS_RAX);</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160; </div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="comment">/* Hyper-V hypercalls get bit 31 set in EAX */</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordflow">if</span> ((input &amp; 0x80000000) &amp;&amp;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <a class="code" href="hyperv_8h.html#a31d5079cda04b8db1683c722a4c1dc20">kvm_hv_hypercall_enabled</a>(vcpu))</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hyperv_8c.html#ac96f1fa9ec6ac0ac26c24ca65cc1547e">kvm_hv_hypercall</a>(vcpu);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160; </div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    longmode = <a class="code" href="x86_8h.html#af110270e09fabc54923cc5a9fbd6c543">is_64_bit_hypercall</a>(vcpu);</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keywordflow">if</span> (!longmode) {</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        params[0] = (u32)kvm_rbx_read(vcpu);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        params[1] = (u32)kvm_rcx_read(vcpu);</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        params[2] = (u32)kvm_rdx_read(vcpu);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        params[3] = (u32)kvm_rsi_read(vcpu);</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        params[4] = (u32)kvm_rdi_read(vcpu);</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        params[5] = (u32)kvm_rbp_read(vcpu);</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    }</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        params[0] = (u64)kvm_rdi_read(vcpu);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        params[1] = (u64)kvm_rsi_read(vcpu);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        params[2] = (u64)kvm_rdx_read(vcpu);</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        params[3] = (u64)kvm_r10_read(vcpu);</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        params[4] = (u64)kvm_r8_read(vcpu);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        params[5] = (u64)kvm_r9_read(vcpu);</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    }</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    cpl = static_call(kvm_x86_get_cpl)(vcpu);</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    trace_kvm_xen_hypercall(cpl, input, params[0], params[1], params[2],</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                params[3], params[4], params[5]);</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160; </div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">     * Only allow hypercall acceleration for CPL0. The rare hypercalls that</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment">     * are permitted in guest userspace can be handled by the VMM.</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="keywordflow">if</span> (unlikely(cpl &gt; 0))</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="keywordflow">goto</span> handle_in_userspace;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160; </div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">switch</span> (input) {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="keywordflow">case</span> __HYPERVISOR_xen_version:</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        <span class="keywordflow">if</span> (params[0] == XENVER_version &amp;&amp; vcpu-&gt;kvm-&gt;arch.xen.xen_version) {</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            r = vcpu-&gt;kvm-&gt;arch.xen.xen_version;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            handled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        }</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keywordflow">case</span> __HYPERVISOR_event_channel_op:</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <span class="keywordflow">if</span> (params[0] == EVTCHNOP_send)</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            handled = <a class="code" href="xen_8c.html#a42cb09290dc39689baca95686be1ff69">kvm_xen_hcall_evtchn_send</a>(vcpu, params[1], &amp;r);</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="keywordflow">case</span> __HYPERVISOR_sched_op:</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        handled = <a class="code" href="xen_8c.html#af82c8d988242af84bb833157369454b4">kvm_xen_hcall_sched_op</a>(vcpu, longmode, params[0],</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                         params[1], &amp;r);</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">case</span> __HYPERVISOR_vcpu_op:</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        handled = <a class="code" href="xen_8c.html#a770531539245dce08f6187702354032c">kvm_xen_hcall_vcpu_op</a>(vcpu, longmode, params[0], params[1],</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                        params[2], &amp;r);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordflow">case</span> __HYPERVISOR_set_timer_op: {</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        u64 timeout = params[0];</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <span class="comment">/* In 32-bit mode, the 64-bit timeout is in two 32-bit params. */</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="keywordflow">if</span> (!longmode)</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            timeout |= params[1] &lt;&lt; 32;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        handled = <a class="code" href="xen_8c.html#aee859a411f74e3aa2dd986c561eb72dc">kvm_xen_hcall_set_timer_op</a>(vcpu, timeout, &amp;r);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    }</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    }</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160; </div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <span class="keywordflow">if</span> (handled)</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="xen_8c.html#af793a9d50c928bc2c920b78b807c45da">kvm_xen_hypercall_set_result</a>(vcpu, r);</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160; </div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;handle_in_userspace:</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    vcpu-&gt;run-&gt;exit_reason = KVM_EXIT_XEN;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    vcpu-&gt;run-&gt;xen.type = KVM_EXIT_XEN_HCALL;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    vcpu-&gt;run-&gt;xen.u.hcall.longmode = longmode;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    vcpu-&gt;run-&gt;xen.u.hcall.cpl = cpl;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    vcpu-&gt;run-&gt;xen.u.hcall.input = input;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    vcpu-&gt;run-&gt;xen.u.hcall.params[0] = params[0];</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    vcpu-&gt;run-&gt;xen.u.hcall.params[1] = params[1];</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    vcpu-&gt;run-&gt;xen.u.hcall.params[2] = params[2];</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    vcpu-&gt;run-&gt;xen.u.hcall.params[3] = params[3];</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    vcpu-&gt;run-&gt;xen.u.hcall.params[4] = params[4];</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    vcpu-&gt;run-&gt;xen.u.hcall.params[5] = params[5];</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    vcpu-&gt;arch.xen.hypercall_rip = <a class="code" href="x86_8c.html#a02711c553f435f66f21d0d417fa74202">kvm_get_linear_rip</a>(vcpu);</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    vcpu-&gt;arch.complete_userspace_io =</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;        <a class="code" href="xen_8c.html#a373b446476992601f9f6b3e33c0f086d">kvm_xen_hypercall_complete_userspace</a>;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160; </div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;}</div>
<div class="ttc" id="ahyperv_8c_html_ac96f1fa9ec6ac0ac26c24ca65cc1547e"><div class="ttname"><a href="hyperv_8c.html#ac96f1fa9ec6ac0ac26c24ca65cc1547e">kvm_hv_hypercall</a></div><div class="ttdeci">int kvm_hv_hypercall(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="hyperv_8c_source.html#l02519">hyperv.c:2519</a></div></div>
<div class="ttc" id="ahyperv_8h_html_a31d5079cda04b8db1683c722a4c1dc20"><div class="ttname"><a href="hyperv_8h.html#a31d5079cda04b8db1683c722a4c1dc20">kvm_hv_hypercall_enabled</a></div><div class="ttdeci">static bool kvm_hv_hypercall_enabled(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="hyperv_8h_source.html#l00280">hyperv.h:280</a></div></div>
<div class="ttc" id="ax86_8c_html_a02711c553f435f66f21d0d417fa74202"><div class="ttname"><a href="x86_8c.html#a02711c553f435f66f21d0d417fa74202">kvm_get_linear_rip</a></div><div class="ttdeci">unsigned long kvm_get_linear_rip(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l13151">x86.c:13151</a></div></div>
<div class="ttc" id="ax86_8h_html_a9f7e7cd8d352da04de3bf53cbb3b4e57"><div class="ttname"><a href="x86_8h.html#a9f7e7cd8d352da04de3bf53cbb3b4e57">kvm_register_read</a></div><div class="ttdeci">static unsigned long kvm_register_read(struct kvm_vcpu *vcpu, int reg)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00273">x86.h:273</a></div></div>
<div class="ttc" id="ax86_8h_html_af110270e09fabc54923cc5a9fbd6c543"><div class="ttname"><a href="x86_8h.html#af110270e09fabc54923cc5a9fbd6c543">is_64_bit_hypercall</a></div><div class="ttdeci">static bool is_64_bit_hypercall(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00164">x86.h:164</a></div></div>
<div class="ttc" id="axen_8c_html_a373b446476992601f9f6b3e33c0f086d"><div class="ttname"><a href="xen_8c.html#a373b446476992601f9f6b3e33c0f086d">kvm_xen_hypercall_complete_userspace</a></div><div class="ttdeci">static int kvm_xen_hypercall_complete_userspace(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01205">xen.c:1205</a></div></div>
<div class="ttc" id="axen_8c_html_a42cb09290dc39689baca95686be1ff69"><div class="ttname"><a href="xen_8c.html#a42cb09290dc39689baca95686be1ff69">kvm_xen_hcall_evtchn_send</a></div><div class="ttdeci">static bool kvm_xen_hcall_evtchn_send(struct kvm_vcpu *vcpu, u64 param, u64 *r)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l02070">xen.c:2070</a></div></div>
<div class="ttc" id="axen_8c_html_a770531539245dce08f6187702354032c"><div class="ttname"><a href="xen_8c.html#a770531539245dce08f6187702354032c">kvm_xen_hcall_vcpu_op</a></div><div class="ttdeci">static bool kvm_xen_hcall_vcpu_op(struct kvm_vcpu *vcpu, bool longmode, int cmd, int vcpu_id, u64 param, u64 *r)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01394">xen.c:1394</a></div></div>
<div class="ttc" id="axen_8c_html_aee859a411f74e3aa2dd986c561eb72dc"><div class="ttname"><a href="xen_8c.html#aee859a411f74e3aa2dd986c561eb72dc">kvm_xen_hcall_set_timer_op</a></div><div class="ttdeci">static bool kvm_xen_hcall_set_timer_op(struct kvm_vcpu *vcpu, uint64_t timeout, u64 *r)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01452">xen.c:1452</a></div></div>
<div class="ttc" id="axen_8c_html_af793a9d50c928bc2c920b78b807c45da"><div class="ttname"><a href="xen_8c.html#af793a9d50c928bc2c920b78b807c45da">kvm_xen_hypercall_set_result</a></div><div class="ttdeci">static int kvm_xen_hypercall_set_result(struct kvm_vcpu *vcpu, u64 result)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01199">xen.c:1199</a></div></div>
<div class="ttc" id="axen_8c_html_af82c8d988242af84bb833157369454b4"><div class="ttname"><a href="xen_8c.html#af82c8d988242af84bb833157369454b4">kvm_xen_hcall_sched_op</a></div><div class="ttdeci">static bool kvm_xen_hcall_sched_op(struct kvm_vcpu *vcpu, bool longmode, int cmd, u64 param, u64 *r)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01370">xen.c:1370</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_aaf398a8803a79984b06fbf9e2a64193c_cgraph.png" border="0" usemap="#axen_8c_aaf398a8803a79984b06fbf9e2a64193c_cgraph" alt=""/></div>
<map name="axen_8c_aaf398a8803a79984b06fbf9e2a64193c_cgraph" id="axen_8c_aaf398a8803a79984b06fbf9e2a64193c_cgraph">
<area shape="rect" title=" " alt="" coords="5,605,153,631"/>
<area shape="rect" href="x86_8h.html#af110270e09fabc54923cc5a9fbd6c543" title=" " alt="" coords="1290,593,1437,619"/>
<area shape="rect" href="x86_8c.html#a02711c553f435f66f21d0d417fa74202" title=" " alt="" coords="763,50,910,77"/>
<area shape="rect" href="hyperv_8c.html#ac96f1fa9ec6ac0ac26c24ca65cc1547e" title=" " alt="" coords="239,605,380,631"/>
<area shape="rect" href="hyperv_8h.html#a31d5079cda04b8db1683c722a4c1dc20" title=" " alt="" coords="209,503,409,530"/>
<area shape="rect" href="x86_8h.html#a9f7e7cd8d352da04de3bf53cbb3b4e57" title=" " alt="" coords="1037,151,1181,178"/>
<area shape="rect" href="xen_8c.html#a42cb09290dc39689baca95686be1ff69" title=" " alt="" coords="205,959,413,986"/>
<area shape="rect" href="xen_8c.html#af82c8d988242af84bb833157369454b4" title=" " alt="" coords="216,655,403,682"/>
<area shape="rect" href="xen_8c.html#aee859a411f74e3aa2dd986c561eb72dc" title=" " alt="" coords="204,1111,415,1138"/>
<area shape="rect" href="xen_8c.html#a770531539245dce08f6187702354032c" title=" " alt="" coords="219,1061,399,1087"/>
<area shape="rect" href="xen_8c.html#a373b446476992601f9f6b3e33c0f086d" title=" " alt="" coords="201,203,417,244"/>
<area shape="rect" href="xen_8c.html#af793a9d50c928bc2c920b78b807c45da" title=" " alt="" coords="487,203,662,244"/>
<area shape="rect" href="x86_8h.html#ada9d5e605374059a5e34c42817ed5118" title=" " alt="" coords="1499,151,1623,178"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="1671,151,1783,178"/>
<area shape="rect" href="x86_8c.html#a45ce50c8a83f9e81b45ea94d89c55271" title=" " alt="" coords="1036,101,1181,127"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad97ff6b975b461b815e6749d29c65446" title=" " alt="" coords="1053,50,1164,77"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5d9eb0563cffb1e3ed1cccebabcf2df6" title=" " alt="" coords="1276,75,1451,102"/>
<area shape="rect" href="hyperv_8c.html#a895db5a96f7a23025edc0c848dabd751" title=" " alt="" coords="499,437,650,479"/>
<area shape="rect" href="hyperv_8c.html#a3ff90845aad5b5a08ab49a4d4edb3347" title=" " alt="" coords="734,457,939,483"/>
<area shape="rect" href="x86_8h.html#a134b4e55e4ea92a3519e9538f05d4e6b" title=" " alt="" coords="523,757,626,783"/>
<area shape="rect" href="hyperv_8c.html#afef840609e5b6143a1086162a6d98e5e" title=" " alt="" coords="488,269,661,295"/>
<area shape="rect" href="hyperv_8c.html#a9ff462f663c5b81608332c950959101c" title=" " alt="" coords="769,622,905,649"/>
<area shape="rect" href="hyperv_8c.html#a53ee45cbb2222a320ec661fc698fb277" title=" " alt="" coords="732,331,941,358"/>
<area shape="rect" href="hyperv_8c.html#a61cb36e1717e5607fdc0ede7d0a76392" title=" " alt="" coords="470,320,679,361"/>
<area shape="rect" href="hyperv_8c.html#a97999cfaa461190e9a55a694e678801b" title=" " alt="" coords="465,503,684,530"/>
<area shape="rect" href="hyperv_8c.html#a4ca4f7e6e021870753e15fa1072e828d" title=" " alt="" coords="769,565,904,591"/>
<area shape="rect" href="hyperv_8c.html#a914511fb763bca1c9dcd46590bccf737" title=" " alt="" coords="481,554,668,581"/>
<area shape="rect" href="x86_8c.html#ac9502ee8f018301047c80e19ab79f7e2" title=" " alt="" coords="490,605,659,631"/>
<area shape="rect" href="kvm__main_8c.html#a7373edb7b1c787b14e657cd691e64d20" title=" " alt="" coords="501,655,648,682"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a16b29ca8796e3da212a8faf1b2dc7ff3" title=" " alt="" coords="763,514,910,541"/>
<area shape="rect" href="vmx_8c.html#a4a5b71928180de4229b920eec470bcaf" title=" " alt="" coords="1039,487,1179,514"/>
<area shape="rect" href="hyperv_8c.html#a67c70e65c821570b8c22eb305b16f445" title=" " alt="" coords="1021,538,1196,565"/>
<area shape="rect" href="hyperv_8c.html#a5f74eb35e0b8cde59fec4c5d318d9f70" title=" " alt="" coords="1027,589,1190,615"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="1049,335,1169,362"/>
<area shape="rect" href="hyperv_8c.html#a29ca172bbcb8deb7aa7d0ef0f2f994c8" title=" " alt="" coords="1019,437,1198,463"/>
<area shape="rect" href="hyperv_8c.html#a99c57fba09738829db16a73f48a371b8" title=" " alt="" coords="1027,640,1191,681"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="1003,706,1214,733"/>
<area shape="rect" href="kvm__main_8c.html#a1bab423c7aa7e0ad2c109ae0fd25de75" title=" " alt="" coords="989,757,1228,783"/>
<area shape="rect" href="kvm__main_8c.html#a3cc887a9ecfdd6e9f5ab90dc2ce8de4a" title=" " alt="" coords="1043,386,1174,413"/>
<area shape="rect" href="hyperv_8c.html#a285329422d512a538b616dbad1e0b256" title=" " alt="" coords="1012,807,1205,834"/>
<area shape="rect" href="mmu_8h.html#aa47e04c0739bc10134b493cc8bfb0dc6" title=" " alt="" coords="1027,858,1190,885"/>
<area shape="rect" href="hyperv_8c.html#ab47df5eac94a81a807b1c11708a7e0a0" title=" " alt="" coords="1025,269,1193,311"/>
<area shape="rect" href="x86_8c.html#aba69f77338abd9dcd861fd8921d5011a" title=" " alt="" coords="993,215,1224,242"/>
<area shape="rect" href="x86_8c.html#a7064cd8944dd550352cef83c72612045" title=" " alt="" coords="495,1010,654,1037"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="495,959,654,986"/>
<area shape="rect" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2" title=" " alt="" coords="507,1111,642,1138"/>
<area shape="rect" href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459" title=" " alt="" coords="495,1162,655,1189"/>
<area shape="rect" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2" title=" " alt="" coords="495,1213,654,1239"/>
<area shape="rect" href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d" title=" " alt="" coords="483,1061,666,1087"/>
<area shape="rect" href="x86_8c.html#a333df16e0456af479cb64edbd93345d6" title=" " alt="" coords="506,151,643,178"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_aaf398a8803a79984b06fbf9e2a64193c_icgraph.png" border="0" usemap="#axen_8c_aaf398a8803a79984b06fbf9e2a64193c_icgraph" alt=""/></div>
<map name="axen_8c_aaf398a8803a79984b06fbf9e2a64193c_icgraph" id="axen_8c_aaf398a8803a79984b06fbf9e2a64193c_icgraph">
<area shape="rect" title=" " alt="" coords="232,5,380,32"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="5,5,184,32"/>
</map>
</div>

</div>
</div>
<a id="a373b446476992601f9f6b3e33c0f086d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a373b446476992601f9f6b3e33c0f086d">&#9670;&nbsp;</a></span>kvm_xen_hypercall_complete_userspace()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_xen_hypercall_complete_userspace </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01205">1205</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;{</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keyword">struct </span>kvm_run *run = vcpu-&gt;run;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">if</span> (unlikely(!<a class="code" href="x86_8c.html#a333df16e0456af479cb64edbd93345d6">kvm_is_linear_rip</a>(vcpu, vcpu-&gt;arch.xen.hypercall_rip)))</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160; </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="xen_8c.html#af793a9d50c928bc2c920b78b807c45da">kvm_xen_hypercall_set_result</a>(vcpu, run-&gt;xen.u.hcall.result);</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;}</div>
<div class="ttc" id="ax86_8c_html_a333df16e0456af479cb64edbd93345d6"><div class="ttname"><a href="x86_8c.html#a333df16e0456af479cb64edbd93345d6">kvm_is_linear_rip</a></div><div class="ttdeci">bool kvm_is_linear_rip(struct kvm_vcpu *vcpu, unsigned long linear_rip)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l13164">x86.c:13164</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a373b446476992601f9f6b3e33c0f086d_cgraph.png" border="0" usemap="#axen_8c_a373b446476992601f9f6b3e33c0f086d_cgraph" alt=""/></div>
<map name="axen_8c_a373b446476992601f9f6b3e33c0f086d_cgraph" id="axen_8c_a373b446476992601f9f6b3e33c0f086d_cgraph">
<area shape="rect" title=" " alt="" coords="5,207,221,249"/>
<area shape="rect" href="x86_8c.html#a333df16e0456af479cb64edbd93345d6" title=" " alt="" coords="539,139,676,165"/>
<area shape="rect" href="xen_8c.html#af793a9d50c928bc2c920b78b807c45da" title=" " alt="" coords="269,237,444,278"/>
<area shape="rect" href="x86_8c.html#a02711c553f435f66f21d0d417fa74202" title=" " alt="" coords="1024,107,1171,133"/>
<area shape="rect" href="x86_8c.html#a45ce50c8a83f9e81b45ea94d89c55271" title=" " alt="" coords="1264,5,1409,32"/>
<area shape="rect" href="x86_8h.html#ada9d5e605374059a5e34c42817ed5118" title=" " alt="" coords="1275,56,1399,83"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad97ff6b975b461b815e6749d29c65446" title=" " alt="" coords="1281,107,1392,133"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="1541,55,1653,81"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5d9eb0563cffb1e3ed1cccebabcf2df6" title=" " alt="" coords="1509,105,1684,132"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1757,105,1951,132"/>
<area shape="rect" href="x86_8c.html#aba69f77338abd9dcd861fd8921d5011a" title=" " alt="" coords="492,328,723,355"/>
<area shape="rect" href="pmu_8c.html#a0b4da757f734ef55ec71a70808bc50d4" title=" " alt="" coords="773,593,955,620"/>
<area shape="rect" href="x86_8c.html#aaad1e1c79fc8780110beaebf328ea7f9" title=" " alt="" coords="771,328,957,355"/>
<area shape="rect" href="pmu_8c.html#a82f21621653f5a1b16e8aeeca1571933" title=" " alt="" coords="1036,593,1159,620"/>
<area shape="rect" href="pmu_8c.html#abb936a26c4c8f2bcd5abc2aa85f8d44f" title=" " alt="" coords="1018,645,1177,686"/>
<area shape="rect" href="pmu_8c.html#a71b19ab0f332b8f09e63bad068ffc2fd" title=" " alt="" coords="1010,711,1185,737"/>
<area shape="rect" href="pmu_8c.html#ade55b96e482f31963470d3ceb4f49df0" title=" " alt="" coords="1012,543,1183,569"/>
<area shape="rect" href="pmu_8h.html#a5024a14da9d7fdac47fefed9449d0d2d" title=" " alt="" coords="1551,695,1642,721"/>
<area shape="rect" href="pmu_8h.html#abbf4b99efff2cdd22398e2992085c36f" title=" " alt="" coords="1237,703,1436,745"/>
<area shape="rect" href="pmu_8c.html#af08b63fb7910be3ee65e8036b4e48aad" title=" " alt="" coords="1248,595,1425,621"/>
<area shape="rect" href="pmu_8h.html#a156ede05e2f3b40ccf7a68f471f574b2" title=" " alt="" coords="1243,492,1430,519"/>
<area shape="rect" href="pmu_8h.html#a276700643eefb3c6911a7ae0dc0e3809" title=" " alt="" coords="1246,543,1427,569"/>
<area shape="rect" href="pmu_8c.html#aa6928ea92eba53de872c3bd3e966c3c6" title=" " alt="" coords="1510,644,1683,671"/>
<area shape="rect" href="pmu_8c.html#a6407f24f826977c89137761aae28662a" title=" " alt="" coords="1517,593,1676,620"/>
<area shape="rect" href="pmu_8c.html#a7dbc4f0e4caa09f8aeb319f991e2c69f" title=" " alt="" coords="1773,593,1935,620"/>
<area shape="rect" href="pmu_8c.html#ac4adcf0013fcc455189fe088174040a5" title=" " alt="" coords="2205,568,2336,595"/>
<area shape="rect" href="pmu_8c.html#a9c8de681910157a36451cebc31149dff" title=" " alt="" coords="2015,593,2141,620"/>
<area shape="rect" href="pmu_8c.html#a27436377a7d8effa003c7dcc6d63e0b9" title=" " alt="" coords="1999,644,2157,671"/>
<area shape="rect" href="pmu_8c.html#ab2f6db97a2dac78800c74becd388bc90" title=" " alt="" coords="2384,568,2471,595"/>
<area shape="rect" href="pmu_8h.html#ad8246d56b5d561e26e120ebcc9f2c2e7" title=" " alt="" coords="1484,492,1709,519"/>
<area shape="rect" href="pmu_8h.html#a121f90ace23861db2f644f0b36a08be6" title=" " alt="" coords="1543,543,1650,569"/>
<area shape="rect" href="x86_8c.html#ade9d1daa53933c6d5907c8a7b1045f01" title=" " alt="" coords="1005,331,1189,357"/>
<area shape="rect" href="x86_8c.html#a9a6f9a3892e36b8251d551192dc20a6f" title=" " alt="" coords="1245,332,1428,359"/>
<area shape="rect" href="x86_8c.html#aceb2924baf63df8bf7e8a4515976bd27" title=" " alt="" coords="1533,223,1660,249"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="1537,273,1657,300"/>
<area shape="rect" href="x86_8c.html#a92e1a819da31f9776852acd897808e99" title=" " alt="" coords="1509,325,1684,366"/>
<area shape="rect" href="x86_8h.html#aa9890500a8e1721d97bbeb847c932d2b" title=" " alt="" coords="1497,391,1696,417"/>
<area shape="rect" href="x86_8c.html#aac24bace71b27dc8ae2ee3ecae145d0f" title=" " alt="" coords="1505,441,1689,468"/>
<area shape="rect" href="x86_8c.html#a28de704e0172e28f1f108b20d606458b" title=" " alt="" coords="1512,157,1681,198"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a373b446476992601f9f6b3e33c0f086d_icgraph.png" border="0" usemap="#axen_8c_a373b446476992601f9f6b3e33c0f086d_icgraph" alt=""/></div>
<map name="axen_8c_a373b446476992601f9f6b3e33c0f086d_icgraph" id="axen_8c_a373b446476992601f9f6b3e33c0f086d_icgraph">
<area shape="rect" title=" " alt="" coords="428,5,644,47"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="232,13,380,39"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="5,13,184,39"/>
</map>
</div>

</div>
</div>
<a id="af793a9d50c928bc2c920b78b807c45da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af793a9d50c928bc2c920b78b807c45da">&#9670;&nbsp;</a></span>kvm_xen_hypercall_set_result()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_xen_hypercall_set_result </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01199">1199</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;{</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    kvm_rax_write(vcpu, result);</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="x86_8c.html#aba69f77338abd9dcd861fd8921d5011a">kvm_skip_emulated_instruction</a>(vcpu);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;}</div>
<div class="ttc" id="ax86_8c_html_aba69f77338abd9dcd861fd8921d5011a"><div class="ttname"><a href="x86_8c.html#aba69f77338abd9dcd861fd8921d5011a">kvm_skip_emulated_instruction</a></div><div class="ttdeci">int kvm_skip_emulated_instruction(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l08916">x86.c:8916</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_af793a9d50c928bc2c920b78b807c45da_cgraph.png" border="0" usemap="#axen_8c_af793a9d50c928bc2c920b78b807c45da_cgraph" alt=""/></div>
<map name="axen_8c_af793a9d50c928bc2c920b78b807c45da_cgraph" id="axen_8c_af793a9d50c928bc2c920b78b807c45da_cgraph">
<area shape="rect" title=" " alt="" coords="5,217,180,258"/>
<area shape="rect" href="x86_8c.html#aba69f77338abd9dcd861fd8921d5011a" title=" " alt="" coords="228,224,459,251"/>
<area shape="rect" href="pmu_8c.html#a0b4da757f734ef55ec71a70808bc50d4" title=" " alt="" coords="509,123,691,149"/>
<area shape="rect" href="x86_8c.html#aaad1e1c79fc8780110beaebf328ea7f9" title=" " alt="" coords="507,325,693,352"/>
<area shape="rect" href="pmu_8c.html#a82f21621653f5a1b16e8aeeca1571933" title=" " alt="" coords="772,5,895,32"/>
<area shape="rect" href="pmu_8c.html#abb936a26c4c8f2bcd5abc2aa85f8d44f" title=" " alt="" coords="754,57,913,98"/>
<area shape="rect" href="pmu_8c.html#a71b19ab0f332b8f09e63bad068ffc2fd" title=" " alt="" coords="746,123,921,149"/>
<area shape="rect" href="pmu_8c.html#ade55b96e482f31963470d3ceb4f49df0" title=" " alt="" coords="748,173,919,200"/>
<area shape="rect" href="pmu_8h.html#a5024a14da9d7fdac47fefed9449d0d2d" title=" " alt="" coords="1287,13,1378,40"/>
<area shape="rect" href="pmu_8h.html#abbf4b99efff2cdd22398e2992085c36f" title=" " alt="" coords="973,57,1172,98"/>
<area shape="rect" href="pmu_8c.html#af08b63fb7910be3ee65e8036b4e48aad" title=" " alt="" coords="984,123,1161,149"/>
<area shape="rect" href="pmu_8h.html#a156ede05e2f3b40ccf7a68f471f574b2" title=" " alt="" coords="979,173,1166,200"/>
<area shape="rect" href="pmu_8h.html#a276700643eefb3c6911a7ae0dc0e3809" title=" " alt="" coords="982,224,1163,251"/>
<area shape="rect" href="pmu_8c.html#aa6928ea92eba53de872c3bd3e966c3c6" title=" " alt="" coords="1246,72,1419,99"/>
<area shape="rect" href="pmu_8c.html#a6407f24f826977c89137761aae28662a" title=" " alt="" coords="1253,123,1412,149"/>
<area shape="rect" href="pmu_8c.html#a7dbc4f0e4caa09f8aeb319f991e2c69f" title=" " alt="" coords="1509,123,1671,149"/>
<area shape="rect" href="pmu_8c.html#ac4adcf0013fcc455189fe088174040a5" title=" " alt="" coords="1941,97,2072,124"/>
<area shape="rect" href="pmu_8c.html#a9c8de681910157a36451cebc31149dff" title=" " alt="" coords="1751,123,1877,149"/>
<area shape="rect" href="pmu_8c.html#a27436377a7d8effa003c7dcc6d63e0b9" title=" " alt="" coords="1735,173,1893,200"/>
<area shape="rect" href="pmu_8c.html#ab2f6db97a2dac78800c74becd388bc90" title=" " alt="" coords="2120,97,2207,124"/>
<area shape="rect" href="pmu_8h.html#ad8246d56b5d561e26e120ebcc9f2c2e7" title=" " alt="" coords="1220,173,1445,200"/>
<area shape="rect" href="pmu_8h.html#a121f90ace23861db2f644f0b36a08be6" title=" " alt="" coords="1279,224,1386,251"/>
<area shape="rect" href="x86_8c.html#a02711c553f435f66f21d0d417fa74202" title=" " alt="" coords="760,325,907,352"/>
<area shape="rect" href="x86_8c.html#ade9d1daa53933c6d5907c8a7b1045f01" title=" " alt="" coords="741,456,925,483"/>
<area shape="rect" href="x86_8c.html#a45ce50c8a83f9e81b45ea94d89c55271" title=" " alt="" coords="1000,275,1145,301"/>
<area shape="rect" href="x86_8h.html#ada9d5e605374059a5e34c42817ed5118" title=" " alt="" coords="1011,325,1135,352"/>
<area shape="rect" href="kvm__cache__regs_8h.html#ad97ff6b975b461b815e6749d29c65446" title=" " alt="" coords="1017,376,1128,403"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="1277,325,1389,352"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a5d9eb0563cffb1e3ed1cccebabcf2df6" title=" " alt="" coords="1245,376,1420,403"/>
<area shape="rect" href="kvm__cache__regs_8h.html#a6b9ea8c019490183db2a81569aad2bf9" title=" " alt="" coords="1493,376,1687,403"/>
<area shape="rect" href="x86_8c.html#a9a6f9a3892e36b8251d551192dc20a6f" title=" " alt="" coords="981,565,1164,592"/>
<area shape="rect" href="x86_8c.html#aceb2924baf63df8bf7e8a4515976bd27" title=" " alt="" coords="1269,427,1396,453"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="1273,477,1393,504"/>
<area shape="rect" href="x86_8c.html#a92e1a819da31f9776852acd897808e99" title=" " alt="" coords="1245,529,1420,570"/>
<area shape="rect" href="x86_8h.html#aa9890500a8e1721d97bbeb847c932d2b" title=" " alt="" coords="1233,595,1432,621"/>
<area shape="rect" href="x86_8c.html#aac24bace71b27dc8ae2ee3ecae145d0f" title=" " alt="" coords="1241,645,1425,672"/>
<area shape="rect" href="x86_8c.html#a28de704e0172e28f1f108b20d606458b" title=" " alt="" coords="1248,697,1417,738"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_af793a9d50c928bc2c920b78b807c45da_icgraph.png" border="0" usemap="#axen_8c_af793a9d50c928bc2c920b78b807c45da_icgraph" alt=""/></div>
<map name="axen_8c_af793a9d50c928bc2c920b78b807c45da_icgraph" id="axen_8c_af793a9d50c928bc2c920b78b807c45da_icgraph">
<area shape="rect" title=" " alt="" coords="692,5,867,47"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="232,13,380,39"/>
<area shape="rect" href="xen_8c.html#a373b446476992601f9f6b3e33c0f086d" title=" " alt="" coords="428,35,644,76"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="5,13,184,39"/>
</map>
</div>

</div>
</div>
<a id="aac3b8d94d9d44e46e1b03789bbcbd3a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac3b8d94d9d44e46e1b03789bbcbd3a3">&#9670;&nbsp;</a></span>kvm_xen_init_timer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_xen_init_timer </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00191">191</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    hrtimer_init(&amp;vcpu-&gt;arch.xen.timer, CLOCK_MONOTONIC,</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;             HRTIMER_MODE_ABS_HARD);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    vcpu-&gt;arch.xen.timer.function = <a class="code" href="xen_8c.html#a4017950790585b6ba8d51d7b8bb2d5f7">xen_timer_callback</a>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_a4017950790585b6ba8d51d7b8bb2d5f7"><div class="ttname"><a href="xen_8c.html#a4017950790585b6ba8d51d7b8bb2d5f7">xen_timer_callback</a></div><div class="ttdeci">static enum hrtimer_restart xen_timer_callback(struct hrtimer *timer)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00116">xen.c:133</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_aac3b8d94d9d44e46e1b03789bbcbd3a3_cgraph.png" border="0" usemap="#axen_8c_aac3b8d94d9d44e46e1b03789bbcbd3a3_cgraph" alt=""/></div>
<map name="axen_8c_aac3b8d94d9d44e46e1b03789bbcbd3a3_cgraph" id="axen_8c_aac3b8d94d9d44e46e1b03789bbcbd3a3_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,156,32"/>
<area shape="rect" href="xen_8c.html#a4017950790585b6ba8d51d7b8bb2d5f7" title=" " alt="" coords="204,5,352,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_aac3b8d94d9d44e46e1b03789bbcbd3a3_icgraph.png" border="0" usemap="#axen_8c_aac3b8d94d9d44e46e1b03789bbcbd3a3_icgraph" alt=""/></div>
<map name="axen_8c_aac3b8d94d9d44e46e1b03789bbcbd3a3_icgraph" id="axen_8c_aac3b8d94d9d44e46e1b03789bbcbd3a3_icgraph">
<area shape="rect" title=" " alt="" coords="608,5,759,32"/>
<area shape="rect" href="xen_8c.html#a475f17b008ae9643247453de0018df17" title=" " alt="" coords="384,5,560,32"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="abb16147443c1deb060bf5a57799ab580"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb16147443c1deb060bf5a57799ab580">&#9670;&nbsp;</a></span>kvm_xen_init_vcpu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_xen_init_vcpu </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l02105">2105</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;{</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    vcpu-&gt;arch.xen.vcpu_id = vcpu-&gt;vcpu_idx;</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;    vcpu-&gt;arch.xen.poll_evtchn = 0;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160; </div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    timer_setup(&amp;vcpu-&gt;arch.xen.poll_timer, <a class="code" href="xen_8c.html#a9f374264fad08f9502cba60764e46d57">cancel_evtchn_poll</a>, 0);</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160; </div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    <a class="code" href="pfncache_8c.html#a1b712bb7d64ce60682e93f606277ec21">kvm_gpc_init</a>(&amp;vcpu-&gt;arch.xen.runstate_cache, vcpu-&gt;kvm, NULL,</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;             KVM_HOST_USES_PFN);</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    <a class="code" href="pfncache_8c.html#a1b712bb7d64ce60682e93f606277ec21">kvm_gpc_init</a>(&amp;vcpu-&gt;arch.xen.runstate2_cache, vcpu-&gt;kvm, NULL,</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;             KVM_HOST_USES_PFN);</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    <a class="code" href="pfncache_8c.html#a1b712bb7d64ce60682e93f606277ec21">kvm_gpc_init</a>(&amp;vcpu-&gt;arch.xen.vcpu_info_cache, vcpu-&gt;kvm, NULL,</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;             KVM_HOST_USES_PFN);</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <a class="code" href="pfncache_8c.html#a1b712bb7d64ce60682e93f606277ec21">kvm_gpc_init</a>(&amp;vcpu-&gt;arch.xen.vcpu_time_info_cache, vcpu-&gt;kvm, NULL,</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;             KVM_HOST_USES_PFN);</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;}</div>
<div class="ttc" id="apfncache_8c_html_a1b712bb7d64ce60682e93f606277ec21"><div class="ttname"><a href="pfncache_8c.html#a1b712bb7d64ce60682e93f606277ec21">kvm_gpc_init</a></div><div class="ttdeci">void kvm_gpc_init(struct gfn_to_pfn_cache *gpc, struct kvm *kvm, struct kvm_vcpu *vcpu, enum pfn_cache_usage usage)</div><div class="ttdef"><b>Definition:</b> <a href="pfncache_8c_source.html#l00340">pfncache.c:340</a></div></div>
<div class="ttc" id="axen_8c_html_a9f374264fad08f9502cba60764e46d57"><div class="ttname"><a href="xen_8c.html#a9f374264fad08f9502cba60764e46d57">cancel_evtchn_poll</a></div><div class="ttdeci">static void cancel_evtchn_poll(struct timer_list *t)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01362">xen.c:1362</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_abb16147443c1deb060bf5a57799ab580_cgraph.png" border="0" usemap="#axen_8c_abb16147443c1deb060bf5a57799ab580_cgraph" alt=""/></div>
<map name="axen_8c_abb16147443c1deb060bf5a57799ab580_cgraph" id="axen_8c_abb16147443c1deb060bf5a57799ab580_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,152,83"/>
<area shape="rect" href="xen_8c.html#a9f374264fad08f9502cba60764e46d57" title=" " alt="" coords="200,31,347,57"/>
<area shape="rect" href="pfncache_8c.html#a1b712bb7d64ce60682e93f606277ec21" title=" " alt="" coords="219,81,328,108"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="395,31,517,57"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="565,5,773,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="593,56,746,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_abb16147443c1deb060bf5a57799ab580_icgraph.png" border="0" usemap="#axen_8c_abb16147443c1deb060bf5a57799ab580_icgraph" alt=""/></div>
<map name="axen_8c_abb16147443c1deb060bf5a57799ab580_icgraph" id="axen_8c_abb16147443c1deb060bf5a57799ab580_icgraph">
<area shape="rect" title=" " alt="" coords="473,5,620,32"/>
<area shape="rect" href="x86_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="253,5,425,32"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="5,5,205,32"/>
</map>
</div>

</div>
</div>
<a id="a14c3c2aa10d6c0c29f040de32e1d6054"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14c3c2aa10d6c0c29f040de32e1d6054">&#9670;&nbsp;</a></span>kvm_xen_init_vm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_xen_init_vm </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l02158">2158</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;{</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    mutex_init(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    idr_init(&amp;kvm-&gt;arch.xen.evtchn_ports);</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    <a class="code" href="pfncache_8c.html#a1b712bb7d64ce60682e93f606277ec21">kvm_gpc_init</a>(&amp;kvm-&gt;arch.xen.shinfo_cache, kvm, NULL, KVM_HOST_USES_PFN);</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a14c3c2aa10d6c0c29f040de32e1d6054_cgraph.png" border="0" usemap="#axen_8c_a14c3c2aa10d6c0c29f040de32e1d6054_cgraph" alt=""/></div>
<map name="axen_8c_a14c3c2aa10d6c0c29f040de32e1d6054_cgraph" id="axen_8c_a14c3c2aa10d6c0c29f040de32e1d6054_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,143,32"/>
<area shape="rect" href="pfncache_8c.html#a1b712bb7d64ce60682e93f606277ec21" title=" " alt="" coords="191,5,300,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a14c3c2aa10d6c0c29f040de32e1d6054_icgraph.png" border="0" usemap="#axen_8c_a14c3c2aa10d6c0c29f040de32e1d6054_icgraph" alt=""/></div>
<map name="axen_8c_a14c3c2aa10d6c0c29f040de32e1d6054_icgraph" id="axen_8c_a14c3c2aa10d6c0c29f040de32e1d6054_icgraph">
<area shape="rect" title=" " alt="" coords="612,5,749,32"/>
<area shape="rect" href="x86_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="421,5,564,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="247,5,373,32"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="5,5,199,32"/>
</map>
</div>

</div>
</div>
<a id="a0fb0356e88890003922daf35627420a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fb0356e88890003922daf35627420a8">&#9670;&nbsp;</a></span>kvm_xen_inject_pending_events()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_xen_inject_pending_events </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00519">519</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;{</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> evtchn_pending_sel = READ_ONCE(v-&gt;arch.xen.evtchn_pending_sel);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keyword">struct </span>gfn_to_pfn_cache *gpc = &amp;v-&gt;arch.xen.vcpu_info_cache;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span> (!evtchn_pending_sel)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">     * Yes, this is an open-coded loop. But that&#39;s just what put_user()</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">     * does anyway. Page it in and retry the instruction. We&#39;re just a</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">     * little more honest about it.</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    read_lock_irqsave(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d">kvm_gpc_check</a>(gpc, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> vcpu_info))) {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        read_unlock_irqrestore(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe">kvm_gpc_refresh</a>(gpc, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> vcpu_info)))</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        read_lock_irqsave(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">/* Now gpc-&gt;khva is a valid kernel address for the vcpu_info */</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_64BIT) &amp;&amp; v-&gt;kvm-&gt;arch.xen.long_mode) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keyword">struct </span>vcpu_info *vi = gpc-&gt;khva;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keyword">asm</span> <span class="keyword">volatile</span>(LOCK_PREFIX <span class="stringliteral">&quot;orq %0, %1\n&quot;</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                 <span class="stringliteral">&quot;notq %0\n&quot;</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                 LOCK_PREFIX <span class="stringliteral">&quot;andq %0, %2\n&quot;</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                 : <span class="stringliteral">&quot;=r&quot;</span> (evtchn_pending_sel),</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                   <span class="stringliteral">&quot;+m&quot;</span> (vi-&gt;evtchn_pending_sel),</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                   <span class="stringliteral">&quot;+m&quot;</span> (v-&gt;arch.xen.evtchn_pending_sel)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                 : <span class="stringliteral">&quot;0&quot;</span> (evtchn_pending_sel));</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        WRITE_ONCE(vi-&gt;evtchn_upcall_pending, 1);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        u32 evtchn_pending_sel32 = evtchn_pending_sel;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keyword">struct </span><a class="code" href="structcompat__vcpu__info.html">compat_vcpu_info</a> *vi = gpc-&gt;khva;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keyword">asm</span> <span class="keyword">volatile</span>(LOCK_PREFIX <span class="stringliteral">&quot;orl %0, %1\n&quot;</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                 <span class="stringliteral">&quot;notl %0\n&quot;</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                 LOCK_PREFIX <span class="stringliteral">&quot;andl %0, %2\n&quot;</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                 : <span class="stringliteral">&quot;=r&quot;</span> (evtchn_pending_sel32),</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                   <span class="stringliteral">&quot;+m&quot;</span> (vi-&gt;<a class="code" href="structcompat__vcpu__info.html#a06c970331d52960e66a96bd22d52d5b7">evtchn_pending_sel</a>),</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                   <span class="stringliteral">&quot;+m&quot;</span> (v-&gt;arch.xen.evtchn_pending_sel)</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                 : <span class="stringliteral">&quot;0&quot;</span> (evtchn_pending_sel32));</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        WRITE_ONCE(vi-&gt;<a class="code" href="structcompat__vcpu__info.html#abd6c499b130bb26e4ffa8473fa95518d">evtchn_upcall_pending</a>, 1);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    read_unlock_irqrestore(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">/* For the per-vCPU lapic vector, deliver it as MSI. */</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span> (v-&gt;arch.xen.upcall_vector)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <a class="code" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c">kvm_xen_inject_vcpu_vector</a>(v);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15">mark_page_dirty_in_slot</a>(v-&gt;kvm, gpc-&gt;memslot, gpc-&gt;gpa &gt;&gt; PAGE_SHIFT);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_ae4806d9a69b751639c175cb98e468f15"><div class="ttname"><a href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15">mark_page_dirty_in_slot</a></div><div class="ttdeci">void mark_page_dirty_in_slot(struct kvm *kvm, const struct kvm_memory_slot *memslot, gfn_t gfn)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03635">kvm_main.c:3635</a></div></div>
<div class="ttc" id="astructcompat__vcpu__info_html_a06c970331d52960e66a96bd22d52d5b7"><div class="ttname"><a href="structcompat__vcpu__info.html#a06c970331d52960e66a96bd22d52d5b7">compat_vcpu_info::evtchn_pending_sel</a></div><div class="ttdeci">uint32_t evtchn_pending_sel</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00203">xen.h:203</a></div></div>
<div class="ttc" id="astructcompat__vcpu__info_html_abd6c499b130bb26e4ffa8473fa95518d"><div class="ttname"><a href="structcompat__vcpu__info.html#abd6c499b130bb26e4ffa8473fa95518d">compat_vcpu_info::evtchn_upcall_pending</a></div><div class="ttdeci">uint8_t evtchn_upcall_pending</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00200">xen.h:200</a></div></div>
<div class="ttc" id="axen_8c_html_a7ba53f4f869b74569192380f1adfd40c"><div class="ttname"><a href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c">kvm_xen_inject_vcpu_vector</a></div><div class="ttdeci">void kvm_xen_inject_vcpu_vector(struct kvm_vcpu *v)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00496">xen.c:496</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a0fb0356e88890003922daf35627420a8_cgraph.png" border="0" usemap="#axen_8c_a0fb0356e88890003922daf35627420a8_cgraph" alt=""/></div>
<map name="axen_8c_a0fb0356e88890003922daf35627420a8_cgraph" id="axen_8c_a0fb0356e88890003922daf35627420a8_cgraph">
<area shape="rect" title=" " alt="" coords="5,537,188,578"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="264,464,391,491"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="260,515,395,541"/>
<area shape="rect" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c" title=" " alt="" coords="246,566,409,607"/>
<area shape="rect" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15" title=" " alt="" coords="236,689,419,716"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="479,171,627,197"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="705,44,863,71"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="977,145,1113,172"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="718,196,850,223"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="976,19,1115,45"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1236,5,1388,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1461,5,1624,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="998,196,1093,223"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="957,247,1133,273"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="972,298,1119,339"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1211,56,1413,83"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1249,107,1375,133"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1229,157,1395,184"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1247,208,1377,235"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1258,259,1366,285"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1477,195,1609,221"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1672,233,1887,260"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="1935,233,2131,260"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1219,360,1405,387"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="476,566,631,607"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="692,555,876,597"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="716,628,852,655"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="955,364,1136,391"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="953,415,1138,457"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="941,481,1150,508"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="928,532,1163,559"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="949,583,1142,609"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="967,634,1124,675"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="964,700,1127,727"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1241,481,1383,508"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="977,751,1114,777"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1258,599,1366,625"/>
<area shape="rect" href="lapic_8c.html#ad063ed2f42a913efa82bad52d1b58aa8" title=" " alt="" coords="1247,649,1377,676"/>
<area shape="rect" href="x86_8c.html#a09da0747db3b012bff918f94816f0bd0" title=" " alt="" coords="1249,700,1375,727"/>
<area shape="rect" href="smm_8h.html#adbee86ed847633616e1e3afcc7e98e6e" title=" " alt="" coords="1249,751,1375,777"/>
<area shape="rect" href="lapic_8h.html#ada4d7479e3c0f2e45cb1565dab78c198" title=" " alt="" coords="1224,801,1400,828"/>
<area shape="rect" href="lapic_8h.html#aecd6ca5347dbb81047584149b2291019" title=" " alt="" coords="1230,852,1394,879"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1251,903,1373,929"/>
<area shape="rect" href="dirty__ring_8c.html#ac1878b63f1f337e93cf186ebd4fffcc4" title=" " alt="" coords="467,653,639,694"/>
<area shape="rect" href="dirty__ring_8c.html#a81ebbf462440ed5392d6d3412a859ae7" title=" " alt="" coords="474,719,633,745"/>
<area shape="rect" href="kvm__main_8c.html#ac5a3afd8e2d8d1139dc7711c4b9e07e3" title=" " alt="" coords="467,769,640,796"/>
<area shape="rect" href="dirty__ring_8c.html#ad6e626257c739b2ac3d397119a7cf798" title=" " alt="" coords="688,700,880,727"/>
<area shape="rect" href="dirty__ring_8c.html#a6fe5cd75b9bac6497e1ae7340f2a5f7b" title=" " alt="" coords="710,751,858,777"/>
<area shape="rect" href="dirty__ring_8c.html#a22c9a239acf3463a8599a21c0a756538" title=" " alt="" coords="695,801,873,828"/>
<area shape="rect" href="dirty__ring_8c.html#acd0a1e586324b4c49b429c7a392db73f" title=" " alt="" coords="966,801,1125,828"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a0fb0356e88890003922daf35627420a8_icgraph.png" border="0" usemap="#axen_8c_a0fb0356e88890003922daf35627420a8_icgraph" alt=""/></div>
<map name="axen_8c_a0fb0356e88890003922daf35627420a8_icgraph" id="axen_8c_a0fb0356e88890003922daf35627420a8_icgraph">
<area shape="rect" title=" " alt="" coords="541,5,724,47"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,13,493,39"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,13,364,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="ab30962c07569543c2879269c4ec40d70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab30962c07569543c2879269c4ec40d70">&#9670;&nbsp;</a></span>kvm_xen_inject_timer_irqs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_xen_inject_timer_irqs </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00116">116</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;{</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> (atomic_read(&amp;vcpu-&gt;arch.xen.timer_pending) &gt; 0) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keyword">struct </span>kvm_xen_evtchn e;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        e.vcpu_id = vcpu-&gt;vcpu_id;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        e.vcpu_idx = vcpu-&gt;vcpu_idx;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        e.port = vcpu-&gt;arch.xen.timer_virq;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        e.priority = KVM_IRQ_ROUTING_XEN_EVTCHN_PRIO_2LEVEL;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <a class="code" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0">kvm_xen_set_evtchn</a>(&amp;e, vcpu-&gt;kvm);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        vcpu-&gt;arch.xen.timer_expires = 0;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        atomic_set(&amp;vcpu-&gt;arch.xen.timer_pending, 0);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_ab30962c07569543c2879269c4ec40d70_cgraph.png" border="0" usemap="#axen_8c_ab30962c07569543c2879269c4ec40d70_cgraph" alt=""/></div>
<map name="axen_8c_ab30962c07569543c2879269c4ec40d70_cgraph" id="axen_8c_ab30962c07569543c2879269c4ec40d70_cgraph">
<area shape="rect" title=" " alt="" coords="5,360,203,387"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="251,360,409,387"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="485,247,620,273"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="457,385,648,412"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="703,183,851,209"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="913,56,1071,83"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1149,157,1285,184"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="926,208,1058,235"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1148,31,1287,57"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1399,5,1551,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1651,5,1813,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1170,208,1265,235"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="1129,276,1305,303"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1144,327,1291,369"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1373,208,1576,235"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1411,259,1538,285"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1391,56,1558,83"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1409,107,1540,133"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1421,157,1529,184"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1666,157,1798,184"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1872,233,2087,260"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="2135,233,2331,260"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1381,360,1568,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1640,360,1824,387"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1886,360,2073,387"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="714,360,841,387"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1671,411,1793,437"/>
<area shape="rect" href="xen_8c.html#a920a89da9fa627b54860f838c736b003" title=" " alt="" coords="907,461,1077,488"/>
<area shape="rect" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c" title=" " alt="" coords="696,513,859,554"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="710,309,845,336"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1875,411,2083,437"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1903,461,2056,488"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="915,534,1069,575"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="1125,727,1309,769"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="1149,541,1285,568"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="1384,760,1565,787"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="1382,811,1567,853"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="1370,877,1579,904"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="1357,928,1592,955"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="1378,592,1571,619"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="1396,643,1553,685"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="1393,709,1556,736"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1661,877,1803,904"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="1406,541,1543,568"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1678,461,1786,488"/>
<area shape="rect" href="lapic_8c.html#ad063ed2f42a913efa82bad52d1b58aa8" title=" " alt="" coords="1667,512,1797,539"/>
<area shape="rect" href="x86_8c.html#a09da0747db3b012bff918f94816f0bd0" title=" " alt="" coords="1669,563,1795,589"/>
<area shape="rect" href="smm_8h.html#adbee86ed847633616e1e3afcc7e98e6e" title=" " alt="" coords="1669,613,1795,640"/>
<area shape="rect" href="lapic_8h.html#ada4d7479e3c0f2e45cb1565dab78c198" title=" " alt="" coords="1644,664,1820,691"/>
<area shape="rect" href="lapic_8h.html#aecd6ca5347dbb81047584149b2291019" title=" " alt="" coords="1650,715,1814,741"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_ab30962c07569543c2879269c4ec40d70_icgraph.png" border="0" usemap="#axen_8c_ab30962c07569543c2879269c4ec40d70_icgraph" alt=""/></div>
<map name="axen_8c_ab30962c07569543c2879269c4ec40d70_icgraph" id="axen_8c_ab30962c07569543c2879269c4ec40d70_icgraph">
<area shape="rect" title=" " alt="" coords="767,42,964,69"/>
<area shape="rect" href="irq_8c.html#a2d54275d9e142ae8e337298689483728" title=" " alt="" coords="553,5,707,47"/>
<area shape="rect" href="xen_8c.html#a0446c241eff9babb33e990edd1347b96" title=" " alt="" coords="541,71,719,98"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,15,493,42"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,17,364,43"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,42,129,69"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="191,67,350,94"/>
</map>
</div>

</div>
</div>
<a id="a7ba53f4f869b74569192380f1adfd40c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ba53f4f869b74569192380f1adfd40c">&#9670;&nbsp;</a></span>kvm_xen_inject_vcpu_vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_xen_inject_vcpu_vector </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00496">496</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;{</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keyword">struct </span>kvm_lapic_irq irq = { };</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordtype">int</span> r;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    irq.dest_id = v-&gt;vcpu_id;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    irq.vector = v-&gt;arch.xen.upcall_vector;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    irq.dest_mode = APIC_DEST_PHYSICAL;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    irq.shorthand = <a class="code" href="lapic_8h.html#acc73bace457403e7d23ff22afac7df0f">APIC_DEST_NOSHORT</a>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    irq.delivery_mode = APIC_DM_FIXED;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    irq.level = 1;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">/* The fast version will always work for physical unicast */</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    WARN_ON_ONCE(!<a class="code" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045">kvm_irq_delivery_to_apic_fast</a>(v-&gt;kvm, NULL, &amp;irq, &amp;r, NULL));</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;}</div>
<div class="ttc" id="alapic_8c_html_a17eee4051fa1d41b805b09a195f64045"><div class="ttname"><a href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045">kvm_irq_delivery_to_apic_fast</a></div><div class="ttdeci">bool kvm_irq_delivery_to_apic_fast(struct kvm *kvm, struct kvm_lapic *src, struct kvm_lapic_irq *irq, int *r, struct dest_map *dest_map)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8c_source.html#l01208">lapic.c:1208</a></div></div>
<div class="ttc" id="alapic_8h_html_acc73bace457403e7d23ff22afac7df0f"><div class="ttname"><a href="lapic_8h.html#acc73bace457403e7d23ff22afac7df0f">APIC_DEST_NOSHORT</a></div><div class="ttdeci">#define APIC_DEST_NOSHORT</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00016">lapic.h:16</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a7ba53f4f869b74569192380f1adfd40c_cgraph.png" border="0" usemap="#axen_8c_a7ba53f4f869b74569192380f1adfd40c_cgraph" alt=""/></div>
<map name="axen_8c_a7ba53f4f869b74569192380f1adfd40c_cgraph" id="axen_8c_a7ba53f4f869b74569192380f1adfd40c_cgraph">
<area shape="rect" title=" " alt="" coords="5,275,168,317"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="216,275,371,317"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="419,191,603,233"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="443,312,579,339"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="677,5,859,32"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="675,57,861,98"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="663,123,873,149"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="651,173,885,200"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="671,224,865,251"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="689,275,847,317"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="687,341,849,368"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="950,123,1093,149"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="699,392,837,419"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="967,240,1075,267"/>
<area shape="rect" href="lapic_8c.html#ad063ed2f42a913efa82bad52d1b58aa8" title=" " alt="" coords="957,291,1086,317"/>
<area shape="rect" href="x86_8c.html#a09da0747db3b012bff918f94816f0bd0" title=" " alt="" coords="958,341,1085,368"/>
<area shape="rect" href="smm_8h.html#adbee86ed847633616e1e3afcc7e98e6e" title=" " alt="" coords="959,392,1084,419"/>
<area shape="rect" href="lapic_8h.html#ada4d7479e3c0f2e45cb1565dab78c198" title=" " alt="" coords="933,443,1109,469"/>
<area shape="rect" href="lapic_8h.html#aecd6ca5347dbb81047584149b2291019" title=" " alt="" coords="939,493,1103,520"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="960,544,1083,571"/>
<area shape="rect" href="lapic_8h.html#a1d8660ecbda996b11b10b179013e52d4" title=" " alt="" coords="1176,215,1347,241"/>
<area shape="rect" href="lapic_8h.html#a447b1b971acaf871dd62669b4aa3116f" title=" " alt="" coords="1177,265,1346,292"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1157,519,1365,545"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1185,569,1338,596"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a7ba53f4f869b74569192380f1adfd40c_icgraph.png" border="0" usemap="#axen_8c_a7ba53f4f869b74569192380f1adfd40c_icgraph" alt=""/></div>
<map name="axen_8c_a7ba53f4f869b74569192380f1adfd40c_icgraph" id="axen_8c_a7ba53f4f869b74569192380f1adfd40c_icgraph">
<area shape="rect" title=" " alt="" coords="2309,113,2472,154"/>
<area shape="rect" href="xen_8c.html#a0fb0356e88890003922daf35627420a8" title=" " alt="" coords="2075,29,2257,70"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="2071,150,2261,176"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="1162,40,1243,67"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="879,42,1065,68"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="691,71,815,98"/>
<area shape="rect" href="irq__comm_8c.html#ae7b7837b6e17bc60af3f4d81e9a4147e" title=" " alt="" coords="1821,200,2023,227"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="1843,150,2001,176"/>
<area shape="rect" href="xen_8c.html#a7432a92fb771aeb9f60ca4d89c10f15b" title=" " alt="" coords="1613,150,1726,176"/>
<area shape="rect" href="xen_8c.html#a42cb09290dc39689baca95686be1ff69" title=" " alt="" coords="1565,200,1773,227"/>
<area shape="rect" href="xen_8c.html#a952a322aa5cce4d0bd3fe372d820de13" title=" " alt="" coords="1566,251,1773,278"/>
<area shape="rect" href="xen_8c.html#ab30962c07569543c2879269c4ec40d70" title=" " alt="" coords="1571,99,1768,126"/>
<area shape="rect" href="xen_8c.html#a508e4ef7a5f613f8e7daf8a633ae8ee5" title=" " alt="" coords="1341,150,1516,176"/>
<area shape="rect" href="irq__comm_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1117,150,1289,176"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="896,150,1048,176"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="676,150,831,176"/>
<area shape="rect" href="irq_8h.html#aaf23e09ccf4b445556e56ea8598e1311" title=" " alt="" coords="461,142,628,184"/>
<area shape="rect" href="x86_8c.html#aaf3dbbe842e06195f2e46694ea837380" title=" " alt="" coords="219,150,413,176"/>
<area shape="rect" href="kvm__main_8c.html#aaeec02d207c8ce5ca12b1ef2ac36fae0" title=" " alt="" coords="5,142,171,184"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="1355,200,1503,227"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="1113,200,1292,227"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="1354,251,1503,278"/>
<area shape="rect" href="irq_8c.html#a2d54275d9e142ae8e337298689483728" title=" " alt="" coords="1352,33,1505,74"/>
<area shape="rect" href="xen_8c.html#a0446c241eff9babb33e990edd1347b96" title=" " alt="" coords="1340,99,1517,126"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="893,96,1051,123"/>
</map>
</div>

</div>
</div>
<a id="a4bcdab8c7d597fa93d30ff9e9185cbc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bcdab8c7d597fa93d30ff9e9185cbc6">&#9670;&nbsp;</a></span>kvm_xen_schedop_poll()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_xen_schedop_poll </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>longmode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64 *&#160;</td>
          <td class="paramname"><em>r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01261">1261</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;{</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keyword">struct </span>sched_poll sched_poll;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    evtchn_port_t port, *ports;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keyword">struct </span><a class="code" href="structx86__exception.html">x86_exception</a> e;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4">lapic_in_kernel</a>(vcpu) ||</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        !(vcpu-&gt;kvm-&gt;arch.xen_hvm_config.flags &amp; KVM_XEN_HVM_CONFIG_EVTCHN_SEND))</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_64BIT) &amp;&amp; !longmode) {</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keyword">struct </span><a class="code" href="structcompat__sched__poll.html">compat_sched_poll</a> sp32;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160; </div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;        <span class="comment">/* Sanity check that the compat struct definition is correct */</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        BUILD_BUG_ON(<span class="keyword">sizeof</span>(sp32) != 16);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a7064cd8944dd550352cef83c72612045">kvm_read_guest_virt</a>(vcpu, param, &amp;sp32, <span class="keyword">sizeof</span>(sp32), &amp;e)) {</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            *r = -EFAULT;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        }</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160; </div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment">         * This is a 32-bit pointer to an array of evtchn_port_t which</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">         * are uint32_t, so once it&#39;s converted no further compat</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">         * handling is needed.</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        sched_poll.ports = (<span class="keywordtype">void</span> *)(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(sp32.ports);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        sched_poll.nr_ports = sp32.nr_ports;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        sched_poll.timeout = sp32.timeout;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a7064cd8944dd550352cef83c72612045">kvm_read_guest_virt</a>(vcpu, param, &amp;sched_poll,</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                    <span class="keyword">sizeof</span>(sched_poll), &amp;e)) {</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            *r = -EFAULT;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        }</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    }</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160; </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">if</span> (unlikely(sched_poll.nr_ports &gt; 1)) {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="comment">/* Xen (unofficially) limits number of pollers to 128 */</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="keywordflow">if</span> (sched_poll.nr_ports &gt; 128) {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            *r = -EINVAL;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        }</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160; </div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        <a class="code" href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">ports</a> = kmalloc_array(sched_poll.nr_ports,</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                      <span class="keyword">sizeof</span>(*<a class="code" href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">ports</a>), GFP_KERNEL);</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">ports</a>) {</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            *r = -ENOMEM;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <a class="code" href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">ports</a> = &amp;port;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160; </div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#a7064cd8944dd550352cef83c72612045">kvm_read_guest_virt</a>(vcpu, (gva_t)sched_poll.ports, <a class="code" href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">ports</a>,</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                sched_poll.nr_ports * <span class="keyword">sizeof</span>(*<a class="code" href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">ports</a>), &amp;e)) {</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        *r = -EFAULT;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    }</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; sched_poll.nr_ports; i++) {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">ports</a>[i] &gt;= <a class="code" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d">max_evtchn_port</a>(vcpu-&gt;kvm)) {</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            *r = -EINVAL;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    }</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keywordflow">if</span> (sched_poll.nr_ports == 1)</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        vcpu-&gt;arch.xen.poll_evtchn = port;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        vcpu-&gt;arch.xen.poll_evtchn = -1;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160; </div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    set_bit(vcpu-&gt;vcpu_idx, vcpu-&gt;kvm-&gt;arch.xen.poll_mask);</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160; </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="xen_8c.html#acc36c59baef58a2af910272a8dd3e923">wait_pending_event</a>(vcpu, sched_poll.nr_ports, <a class="code" href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">ports</a>)) {</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        vcpu-&gt;arch.mp_state = KVM_MP_STATE_HALTED;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160; </div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="keywordflow">if</span> (sched_poll.timeout)</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;            mod_timer(&amp;vcpu-&gt;arch.xen.poll_timer,</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                  jiffies + nsecs_to_jiffies(sched_poll.timeout));</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160; </div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        <a class="code" href="kvm__main_8c.html#a7256a8615584a9ae83a46c071f6aa0e9">kvm_vcpu_halt</a>(vcpu);</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160; </div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;        <span class="keywordflow">if</span> (sched_poll.timeout)</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            del_timer(&amp;vcpu-&gt;arch.xen.poll_timer);</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160; </div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        vcpu-&gt;arch.mp_state = KVM_MP_STATE_RUNNABLE;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    }</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160; </div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    vcpu-&gt;arch.xen.poll_evtchn = 0;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    *r = 0;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;out:</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="comment">/* Really, this is only needed in case of timeout */</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    clear_bit(vcpu-&gt;vcpu_idx, vcpu-&gt;kvm-&gt;arch.xen.poll_mask);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160; </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="keywordflow">if</span> (unlikely(sched_poll.nr_ports &gt; 1))</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        kfree(<a class="code" href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">ports</a>);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_a7256a8615584a9ae83a46c071f6aa0e9"><div class="ttname"><a href="kvm__main_8c.html#a7256a8615584a9ae83a46c071f6aa0e9">kvm_vcpu_halt</a></div><div class="ttdeci">void kvm_vcpu_halt(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03842">kvm_main.c:3842</a></div></div>
<div class="ttc" id="alapic_8h_html_a1d8c9378fcbf62390a89dc3b7f0bdbd4"><div class="ttname"><a href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4">lapic_in_kernel</a></div><div class="ttdeci">static bool lapic_in_kernel(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="lapic_8h_source.html#l00186">lapic.h:186</a></div></div>
<div class="ttc" id="astructcompat__sched__poll_html"><div class="ttname"><a href="structcompat__sched__poll.html">compat_sched_poll</a></div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00235">xen.h:235</a></div></div>
<div class="ttc" id="astructcompat__sched__poll_html_a33f795274e22aee8efb6a5045bc22d44"><div class="ttname"><a href="structcompat__sched__poll.html#a33f795274e22aee8efb6a5045bc22d44">compat_sched_poll::ports</a></div><div class="ttdeci">uint32_t ports</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00237">xen.h:237</a></div></div>
<div class="ttc" id="axen_8c_html_acc36c59baef58a2af910272a8dd3e923"><div class="ttname"><a href="xen_8c.html#acc36c59baef58a2af910272a8dd3e923">wait_pending_event</a></div><div class="ttdeci">static bool wait_pending_event(struct kvm_vcpu *vcpu, int nr_ports, evtchn_port_t *ports)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01223">xen.c:1223</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a4bcdab8c7d597fa93d30ff9e9185cbc6_cgraph.png" border="0" usemap="#axen_8c_a4bcdab8c7d597fa93d30ff9e9185cbc6_cgraph" alt=""/></div>
<map name="axen_8c_a4bcdab8c7d597fa93d30ff9e9185cbc6_cgraph" id="axen_8c_a4bcdab8c7d597fa93d30ff9e9185cbc6_cgraph">
<area shape="rect" title=" " alt="" coords="5,843,179,869"/>
<area shape="rect" href="x86_8c.html#a7064cd8944dd550352cef83c72612045" title=" " alt="" coords="227,344,385,371"/>
<area shape="rect" href="kvm__main_8c.html#a7256a8615584a9ae83a46c071f6aa0e9" title=" " alt="" coords="245,665,367,692"/>
<area shape="rect" href="lapic_8h.html#a1d8c9378fcbf62390a89dc3b7f0bdbd4" title=" " alt="" coords="2193,376,2311,403"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="239,893,373,920"/>
<area shape="rect" href="xen_8c.html#acc36c59baef58a2af910272a8dd3e923" title=" " alt="" coords="229,944,383,971"/>
<area shape="rect" href="x86_8c.html#ab9c276fafa298a76b0f6a9f001db989b" title=" " alt="" coords="459,275,618,317"/>
<area shape="rect" href="kvm__main_8c.html#adfef9b2c2d6359fd443d98f51be19605" title=" " alt="" coords="692,137,899,164"/>
<area shape="rect" href="kvm__main_8c.html#acc4698e3f076cdbbd5d8ca788a94decf" title=" " alt="" coords="957,137,1139,164"/>
<area shape="rect" href="kvm__main_8c.html#ac4b56de4919be80c9cd4289f20437c64" title=" " alt="" coords="947,87,1149,113"/>
<area shape="rect" href="kvm__main_8c.html#adb8a0a4f675ca16ea81acd3b88089f13" title=" " alt="" coords="1197,77,1389,104"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1467,77,1619,104"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1707,27,1870,53"/>
<area shape="rect" href="kvm__main_8c.html#a1045a615093ccd8e87dcd6f6a0e03e9e" title=" " alt="" coords="469,589,608,616"/>
<area shape="rect" href="x86_8c.html#a98e66fde0ecb40ea667a003bf1e5aa53" title=" " alt="" coords="469,691,609,717"/>
<area shape="rect" href="kvm__main_8c.html#a8e18df0287ddedfd516454aeeb669807" title=" " alt="" coords="473,640,604,667"/>
<area shape="rect" href="kvm__main_8c.html#a3de4d6991bdd1a714e8afa6a55136cdd" title=" " alt="" coords="707,489,883,516"/>
<area shape="rect" href="kvm__main_8c.html#afc3c9c56d305921c317259e18c9c8a59" title=" " alt="" coords="433,741,644,768"/>
<area shape="rect" href="kvm__main_8c.html#a22600b8a76a84f58d97f1a465293e63c" title=" " alt="" coords="465,792,612,819"/>
<area shape="rect" href="kvm__main_8c.html#aaa76576c021037e516218db81c147ca0" title=" " alt="" coords="454,539,623,565"/>
<area shape="rect" href="x86_8c.html#a951bd40e58d87204d565c6cb5fc664e6" title=" " alt="" coords="954,491,1142,517"/>
<area shape="rect" href="irq_8c.html#a78e23e83bece8c269268f3a263fbb114" title=" " alt="" coords="1458,201,1629,242"/>
<area shape="rect" href="x86_8c.html#a54ec69b24c80207e4e6122994db0a466" title=" " alt="" coords="1208,544,1379,571"/>
<area shape="rect" href="x86_8c.html#a50b142cb27db85027825ca5630046d8f" title=" " alt="" coords="1221,491,1366,517"/>
<area shape="rect" href="kvm__cache__regs_8h.html#afbcfc413ceedb460734eb5fd7c5c4fbc" title=" " alt="" coords="1729,607,1849,633"/>
<area shape="rect" href="lapic_8h.html#a106127db5f69d94e5ea9d6d2982c23fd" title=" " alt="" coords="1936,478,2111,519"/>
<area shape="rect" href="lapic_8h.html#a58bae1ee856b1b5c5c44903c9f83a4f7" title=" " alt="" coords="1472,478,1615,519"/>
<area shape="rect" href="x86_8c.html#a4593bb3c3619c24c8f7f0af1a224fdbd" title=" " alt="" coords="1469,726,1618,767"/>
<area shape="rect" href="irq_8c.html#ae3151f072a1bb4a732ee3854ab6cf619" title=" " alt="" coords="1456,325,1631,352"/>
<area shape="rect" href="x86_8c.html#a476f3f8eb9f578c4867ba7deb7ab9f6e" title=" " alt="" coords="1464,661,1623,702"/>
<area shape="rect" href="hyperv_8h.html#a59866dd9026115f7614a5433badf0851" title=" " alt="" coords="1437,792,1649,819"/>
<area shape="rect" href="x86_8h.html#aa9890500a8e1721d97bbeb847c932d2b" title=" " alt="" coords="1444,376,1643,403"/>
<area shape="rect" href="xen_8h.html#aba35176a813cb38333a3db33ba222726" title=" " alt="" coords="1458,595,1629,637"/>
<area shape="rect" href="smm_8h.html#aa0d6bb14bef67edc441fccd36d205a67" title=" " alt="" coords="1752,485,1825,512"/>
<area shape="rect" href="lapic_8c.html#aa421165466ac455ff3fff91fb9afe7bf" title=" " alt="" coords="1699,267,1878,293"/>
<area shape="rect" href="irq_8c.html#a0ba50d6865653a9d307102d8f0b36630" title=" " alt="" coords="1711,376,1867,403"/>
<area shape="rect" href="lapic_8c.html#a1bb0a1640f9f291f5c3154c6a2c40986" title=" " alt="" coords="1952,107,2095,133"/>
<area shape="rect" href="lapic_8c.html#ac1c99098894f4751a556057800e906e0" title=" " alt="" coords="1952,259,2095,301"/>
<area shape="rect" href="lapic_8h.html#ae7e74fde3e4fb01f561634e789b5eab4" title=" " alt="" coords="1953,208,2094,235"/>
<area shape="rect" href="lapic_8h.html#a8cd1df8b4c079c23a522d09c964da0ee" title=" " alt="" coords="2179,107,2325,133"/>
<area shape="rect" href="lapic_8h.html#a1d8660ecbda996b11b10b179013e52d4" title=" " alt="" coords="2167,157,2337,184"/>
<area shape="rect" href="irq_8h.html#a68413268c1f1f354270e9a0de9c2fe44" title=" " alt="" coords="1973,427,2074,453"/>
<area shape="rect" href="lapic_8c.html#a1f4df169625f9c4c2cb06f7443698af4" title=" " alt="" coords="1928,157,2119,184"/>
<area shape="rect" href="irq_8h.html#afcf66d0c1c15dcbd414e2dbf830d7b29" title=" " alt="" coords="1699,77,1879,104"/>
<area shape="rect" href="xen_8h.html#ab737e94ddc49624447bfc9c3387d5c2d" title=" " alt="" coords="1703,201,1874,242"/>
<area shape="rect" href="xen_8h.html#a4219d1f48739ef7e6ccf35229c343a4d" title=" " alt="" coords="1697,149,1880,176"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1969,5,2077,32"/>
<area shape="rect" href="lapic_8c.html#a2800acddbbe439c5ae4fab24c1eaf9ff" title=" " alt="" coords="1957,56,2089,83"/>
<area shape="rect" href="lapic_8h.html#a447b1b971acaf871dd62669b4aa3116f" title=" " alt="" coords="2167,5,2337,32"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="475,944,602,971"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a4bcdab8c7d597fa93d30ff9e9185cbc6_icgraph.png" border="0" usemap="#axen_8c_a4bcdab8c7d597fa93d30ff9e9185cbc6_icgraph" alt=""/></div>
<map name="axen_8c_a4bcdab8c7d597fa93d30ff9e9185cbc6_icgraph" id="axen_8c_a4bcdab8c7d597fa93d30ff9e9185cbc6_icgraph">
<area shape="rect" title=" " alt="" coords="160,5,333,32"/>
<area shape="rect" href="xen_8c.html#ab8910a0f422594766001b1c5a5f59e6e" title=" " alt="" coords="5,5,112,32"/>
</map>
</div>

</div>
</div>
<a id="a59091fb436633f85ba3e28187f5794d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59091fb436633f85ba3e28187f5794d0">&#9670;&nbsp;</a></span>kvm_xen_set_evtchn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_xen_set_evtchn </td>
          <td>(</td>
          <td class="paramtype">struct kvm_xen_evtchn *&#160;</td>
          <td class="paramname"><em>xe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01713">1713</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;{</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="keywordtype">bool</span> mm_borrowed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="keywordtype">int</span> rc;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160; </div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    rc = <a class="code" href="xen_8c.html#a48738df3c98025631e2412d90758136c">kvm_xen_set_evtchn_fast</a>(xe, kvm);</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keywordflow">if</span> (rc != -EWOULDBLOCK)</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160; </div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">if</span> (current-&gt;mm != kvm-&gt;mm) {</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="comment">         * If not on a thread which already belongs to this KVM,</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">         * we&#39;d better be in the irqfd workqueue.</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="keywordflow">if</span> (WARN_ON_ONCE(current-&gt;mm))</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160; </div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        kthread_use_mm(kvm-&gt;mm);</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        mm_borrowed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    }</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160; </div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160; </div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment">     * It is theoretically possible for the page to be unmapped</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">     * and the MMU notifier to invalidate the shared_info before</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">     * we even get to use it. In that case, this looks like an</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">     * infinite loop. It was tempting to do it via the userspace</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">     * HVA instead... but that just *hides* the fact that it&#39;s</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">     * an infinite loop, because if a fault occurs and it waits</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">     * for the page to come back, it can *still* immediately</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">     * fault and have to wait again, repeatedly.</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">     * Conversely, the page could also have been reinstated by</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">     * another thread before we even obtain the mutex above, so</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">     * check again *first* before remapping it.</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        <span class="keyword">struct </span>gfn_to_pfn_cache *gpc = &amp;kvm-&gt;arch.xen.shinfo_cache;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;        <span class="keywordtype">int</span> idx;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160; </div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        rc = <a class="code" href="xen_8c.html#a48738df3c98025631e2412d90758136c">kvm_xen_set_evtchn_fast</a>(xe, kvm);</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        <span class="keywordflow">if</span> (rc != -EWOULDBLOCK)</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160; </div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        idx = srcu_read_lock(&amp;kvm-&gt;srcu);</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        rc = <a class="code" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe">kvm_gpc_refresh</a>(gpc, PAGE_SIZE);</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        srcu_read_unlock(&amp;kvm-&gt;srcu, idx);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    } <span class="keywordflow">while</span>(!rc);</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160; </div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160; </div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordflow">if</span> (mm_borrowed)</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        kthread_unuse_mm(kvm-&gt;mm);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160; </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_a48738df3c98025631e2412d90758136c"><div class="ttname"><a href="xen_8c.html#a48738df3c98025631e2412d90758136c">kvm_xen_set_evtchn_fast</a></div><div class="ttdeci">int kvm_xen_set_evtchn_fast(struct kvm_xen_evtchn *xe, struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01604">xen.c:1604</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a59091fb436633f85ba3e28187f5794d0_cgraph.png" border="0" usemap="#axen_8c_a59091fb436633f85ba3e28187f5794d0_cgraph" alt=""/></div>
<map name="axen_8c_a59091fb436633f85ba3e28187f5794d0_cgraph" id="axen_8c_a59091fb436633f85ba3e28187f5794d0_cgraph">
<area shape="rect" title=" " alt="" coords="5,381,164,408"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="240,268,375,295"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="212,407,403,433"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="458,183,606,209"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="667,56,826,83"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="904,157,1040,184"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="681,208,813,235"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="903,31,1041,57"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1153,5,1305,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1405,5,1568,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="925,208,1019,235"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="884,284,1060,311"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="899,335,1045,377"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1128,208,1331,235"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1166,259,1293,285"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1146,56,1313,83"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1164,107,1295,133"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1175,157,1283,184"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1421,157,1553,184"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1627,228,1841,255"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="1889,228,2085,255"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1136,360,1323,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1395,360,1579,387"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1641,355,1827,381"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="469,381,595,408"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1425,441,1548,468"/>
<area shape="rect" href="xen_8c.html#a920a89da9fa627b54860f838c736b003" title=" " alt="" coords="661,483,832,509"/>
<area shape="rect" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c" title=" " alt="" coords="451,534,613,575"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="465,331,599,357"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1630,456,1838,483"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1657,405,1811,432"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="669,545,824,586"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="880,738,1064,779"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="904,552,1040,579"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="1139,771,1320,797"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="1137,822,1322,863"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="1125,888,1334,915"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="1112,939,1347,965"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="1133,603,1326,629"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="1151,654,1308,695"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="1148,720,1311,747"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1415,888,1558,915"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="1161,552,1298,579"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1433,492,1541,519"/>
<area shape="rect" href="lapic_8c.html#ad063ed2f42a913efa82bad52d1b58aa8" title=" " alt="" coords="1422,543,1551,569"/>
<area shape="rect" href="x86_8c.html#a09da0747db3b012bff918f94816f0bd0" title=" " alt="" coords="1423,593,1550,620"/>
<area shape="rect" href="smm_8h.html#adbee86ed847633616e1e3afcc7e98e6e" title=" " alt="" coords="1424,644,1549,671"/>
<area shape="rect" href="lapic_8h.html#ada4d7479e3c0f2e45cb1565dab78c198" title=" " alt="" coords="1399,695,1575,721"/>
<area shape="rect" href="lapic_8h.html#aecd6ca5347dbb81047584149b2291019" title=" " alt="" coords="1405,745,1569,772"/>
<area shape="rect" href="lapic_8h.html#a1d8660ecbda996b11b10b179013e52d4" title=" " alt="" coords="1649,507,1819,533"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a59091fb436633f85ba3e28187f5794d0_icgraph.png" border="0" usemap="#axen_8c_a59091fb436633f85ba3e28187f5794d0_icgraph" alt=""/></div>
<map name="axen_8c_a59091fb436633f85ba3e28187f5794d0_icgraph" id="axen_8c_a59091fb436633f85ba3e28187f5794d0_icgraph">
<area shape="rect" title=" " alt="" coords="1821,89,1980,115"/>
<area shape="rect" href="xen_8c.html#a7432a92fb771aeb9f60ca4d89c10f15b" title=" " alt="" coords="1613,13,1726,39"/>
<area shape="rect" href="xen_8c.html#a42cb09290dc39689baca95686be1ff69" title=" " alt="" coords="1565,63,1773,90"/>
<area shape="rect" href="xen_8c.html#a952a322aa5cce4d0bd3fe372d820de13" title=" " alt="" coords="1566,114,1773,141"/>
<area shape="rect" href="xen_8c.html#ab30962c07569543c2879269c4ec40d70" title=" " alt="" coords="1571,173,1768,199"/>
<area shape="rect" href="xen_8c.html#a508e4ef7a5f613f8e7daf8a633ae8ee5" title=" " alt="" coords="1341,13,1516,39"/>
<area shape="rect" href="irq__comm_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1117,13,1289,39"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="896,13,1048,39"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="676,13,831,39"/>
<area shape="rect" href="irq_8h.html#aaf23e09ccf4b445556e56ea8598e1311" title=" " alt="" coords="461,5,628,47"/>
<area shape="rect" href="x86_8c.html#aaf3dbbe842e06195f2e46694ea837380" title=" " alt="" coords="219,13,413,39"/>
<area shape="rect" href="kvm__main_8c.html#aaeec02d207c8ce5ca12b1ef2ac36fae0" title=" " alt="" coords="5,5,171,47"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="1355,63,1503,90"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="1113,63,1292,90"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="1354,114,1503,141"/>
<area shape="rect" href="irq_8c.html#a2d54275d9e142ae8e337298689483728" title=" " alt="" coords="1352,165,1505,207"/>
<area shape="rect" href="xen_8c.html#a0446c241eff9babb33e990edd1347b96" title=" " alt="" coords="1340,231,1517,258"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="1162,177,1243,203"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="879,177,1065,203"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="691,202,815,229"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="893,227,1051,254"/>
</map>
</div>

</div>
</div>
<a id="a48738df3c98025631e2412d90758136c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48738df3c98025631e2412d90758136c">&#9670;&nbsp;</a></span>kvm_xen_set_evtchn_fast()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_set_evtchn_fast </td>
          <td>(</td>
          <td class="paramtype">struct kvm_xen_evtchn *&#160;</td>
          <td class="paramname"><em>xe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01604">1604</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;{</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keyword">struct </span>gfn_to_pfn_cache *gpc = &amp;kvm-&gt;arch.xen.shinfo_cache;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *pending_bits, *mask_bits;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordtype">int</span> port_word_bit;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    <span class="keywordtype">bool</span> kick_vcpu = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="keywordtype">int</span> vcpu_idx, idx, rc;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160; </div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    vcpu_idx = READ_ONCE(xe-&gt;vcpu_idx);</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="keywordflow">if</span> (vcpu_idx &gt;= 0)</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        vcpu = kvm_get_vcpu(kvm, vcpu_idx);</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        vcpu = kvm_get_vcpu_by_id(kvm, xe-&gt;vcpu_id);</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        <span class="keywordflow">if</span> (!vcpu)</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        WRITE_ONCE(xe-&gt;vcpu_idx, vcpu-&gt;vcpu_idx);</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    }</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160; </div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <span class="keywordflow">if</span> (!vcpu-&gt;arch.xen.vcpu_info_cache.active)</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160; </div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="keywordflow">if</span> (xe-&gt;port &gt;= <a class="code" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d">max_evtchn_port</a>(kvm))</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160; </div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    rc = -EWOULDBLOCK;</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160; </div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    idx = srcu_read_lock(&amp;kvm-&gt;srcu);</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160; </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    read_lock_irqsave(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d">kvm_gpc_check</a>(gpc, PAGE_SIZE))</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <span class="keywordflow">goto</span> out_rcu;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160; </div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_64BIT) &amp;&amp; kvm-&gt;arch.xen.long_mode) {</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        <span class="keyword">struct </span>shared_info *shinfo = gpc-&gt;khva;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        pending_bits = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;shinfo-&gt;evtchn_pending;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        mask_bits = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;shinfo-&gt;evtchn_mask;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        port_word_bit = xe-&gt;port / 64;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        <span class="keyword">struct </span><a class="code" href="structcompat__shared__info.html">compat_shared_info</a> *shinfo = gpc-&gt;khva;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        pending_bits = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;shinfo-&gt;<a class="code" href="structcompat__shared__info.html#a0409369064685dd9e5fce85f46451d1f">evtchn_pending</a>;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        mask_bits = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;shinfo-&gt;<a class="code" href="structcompat__shared__info.html#aa01c4e73843ba2c9ed859875ed4fed94">evtchn_mask</a>;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        port_word_bit = xe-&gt;port / 32;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    }</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160; </div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="comment">     * If this port wasn&#39;t already set, and if it isn&#39;t masked, then</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="comment">     * we try to set the corresponding bit in the in-kernel shadow of</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment">     * evtchn_pending_sel for the target vCPU. And if *that* wasn&#39;t</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="comment">     * already set, then we kick the vCPU in question to write to the</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="comment">     * *real* evtchn_pending_sel in its own guest vcpu_info struct.</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="keywordflow">if</span> (test_and_set_bit(xe-&gt;port, pending_bits)) {</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        rc = 0; <span class="comment">/* It was already raised */</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (test_bit(xe-&gt;port, mask_bits)) {</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        rc = -ENOTCONN; <span class="comment">/* Masked */</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <a class="code" href="xen_8c.html#a920a89da9fa627b54860f838c736b003">kvm_xen_check_poller</a>(vcpu, xe-&gt;port);</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        rc = 1; <span class="comment">/* Delivered to the bitmap in shared_info. */</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="comment">/* Now switch to the vCPU&#39;s vcpu_info to set the index and pending_sel */</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        read_unlock_irqrestore(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;        gpc = &amp;vcpu-&gt;arch.xen.vcpu_info_cache;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160; </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        read_lock_irqsave(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d">kvm_gpc_check</a>(gpc, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcompat__shared__info.html#a98fec998af2641ea3ed7eb206fdb5d3d">vcpu_info</a>))) {</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment">             * Could not access the vcpu_info. Set the bit in-kernel</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="comment">             * and prod the vCPU to deliver it for itself.</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            <span class="keywordflow">if</span> (!test_and_set_bit(port_word_bit, &amp;vcpu-&gt;arch.xen.evtchn_pending_sel))</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                kick_vcpu = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;            <span class="keywordflow">goto</span> out_rcu;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        }</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160; </div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_64BIT) &amp;&amp; kvm-&gt;arch.xen.long_mode) {</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;            <span class="keyword">struct </span>vcpu_info *vcpu_info = gpc-&gt;khva;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;            <span class="keywordflow">if</span> (!test_and_set_bit(port_word_bit, &amp;vcpu_info-&gt;evtchn_pending_sel)) {</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                WRITE_ONCE(vcpu_info-&gt;evtchn_upcall_pending, 1);</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                kick_vcpu = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            }</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;            <span class="keyword">struct </span><a class="code" href="structcompat__vcpu__info.html">compat_vcpu_info</a> *vcpu_info = gpc-&gt;khva;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;            <span class="keywordflow">if</span> (!test_and_set_bit(port_word_bit,</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;vcpu_info-&gt;<a class="code" href="structcompat__vcpu__info.html#a06c970331d52960e66a96bd22d52d5b7">evtchn_pending_sel</a>)) {</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                WRITE_ONCE(vcpu_info-&gt;<a class="code" href="structcompat__vcpu__info.html#abd6c499b130bb26e4ffa8473fa95518d">evtchn_upcall_pending</a>, 1);</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                kick_vcpu = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            }</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        }</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160; </div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        <span class="comment">/* For the per-vCPU lapic vector, deliver it as MSI. */</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        <span class="keywordflow">if</span> (kick_vcpu &amp;&amp; vcpu-&gt;arch.xen.upcall_vector) {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;            <a class="code" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c">kvm_xen_inject_vcpu_vector</a>(vcpu);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;            kick_vcpu = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        }</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    }</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160; out_rcu:</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    read_unlock_irqrestore(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    srcu_read_unlock(&amp;kvm-&gt;srcu, idx);</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160; </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordflow">if</span> (kick_vcpu) {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        kvm_make_request(KVM_REQ_UNBLOCK, vcpu);</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        <a class="code" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44">kvm_vcpu_kick</a>(vcpu);</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    }</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160; </div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;}</div>
<div class="ttc" id="astructcompat__shared__info_html"><div class="ttname"><a href="structcompat__shared__info.html">compat_shared_info</a></div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00218">xen.h:218</a></div></div>
<div class="ttc" id="astructcompat__shared__info_html_a0409369064685dd9e5fce85f46451d1f"><div class="ttname"><a href="structcompat__shared__info.html#a0409369064685dd9e5fce85f46451d1f">compat_shared_info::evtchn_pending</a></div><div class="ttdeci">uint32_t evtchn_pending[32]</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00220">xen.h:220</a></div></div>
<div class="ttc" id="astructcompat__shared__info_html_a98fec998af2641ea3ed7eb206fdb5d3d"><div class="ttname"><a href="structcompat__shared__info.html#a98fec998af2641ea3ed7eb206fdb5d3d">compat_shared_info::vcpu_info</a></div><div class="ttdeci">struct compat_vcpu_info vcpu_info[MAX_VIRT_CPUS]</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00215">xen.h:219</a></div></div>
<div class="ttc" id="astructcompat__shared__info_html_aa01c4e73843ba2c9ed859875ed4fed94"><div class="ttname"><a href="structcompat__shared__info.html#aa01c4e73843ba2c9ed859875ed4fed94">compat_shared_info::evtchn_mask</a></div><div class="ttdeci">uint32_t evtchn_mask[32]</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00221">xen.h:221</a></div></div>
<div class="ttc" id="axen_8c_html_a920a89da9fa627b54860f838c736b003"><div class="ttname"><a href="xen_8c.html#a920a89da9fa627b54860f838c736b003">kvm_xen_check_poller</a></div><div class="ttdeci">static void kvm_xen_check_poller(struct kvm_vcpu *vcpu, int port)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01583">xen.c:1583</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a48738df3c98025631e2412d90758136c_cgraph.png" border="0" usemap="#axen_8c_a48738df3c98025631e2412d90758136c_cgraph" alt=""/></div>
<map name="axen_8c_a48738df3c98025631e2412d90758136c_cgraph" id="axen_8c_a48738df3c98025631e2412d90758136c_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,196,133"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="262,5,389,32"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1215,56,1337,83"/>
<area shape="rect" href="xen_8c.html#a920a89da9fa627b54860f838c736b003" title=" " alt="" coords="455,107,625,133"/>
<area shape="rect" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c" title=" " alt="" coords="244,158,407,199"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="258,224,393,251"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1412,5,1620,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1439,56,1593,83"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="463,201,617,242"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="673,411,857,453"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="697,208,833,235"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="932,276,1113,303"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="930,327,1115,369"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="918,393,1127,420"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="905,444,1140,471"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="926,495,1119,521"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="944,546,1101,587"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="941,612,1104,639"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1205,411,1347,437"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="954,208,1091,235"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1222,107,1330,133"/>
<area shape="rect" href="lapic_8c.html#ad063ed2f42a913efa82bad52d1b58aa8" title=" " alt="" coords="1211,157,1341,184"/>
<area shape="rect" href="x86_8c.html#a09da0747db3b012bff918f94816f0bd0" title=" " alt="" coords="1213,208,1339,235"/>
<area shape="rect" href="smm_8h.html#adbee86ed847633616e1e3afcc7e98e6e" title=" " alt="" coords="1213,259,1339,285"/>
<area shape="rect" href="lapic_8h.html#ada4d7479e3c0f2e45cb1565dab78c198" title=" " alt="" coords="1188,309,1364,336"/>
<area shape="rect" href="lapic_8h.html#aecd6ca5347dbb81047584149b2291019" title=" " alt="" coords="1194,360,1358,387"/>
<area shape="rect" href="lapic_8h.html#a1d8660ecbda996b11b10b179013e52d4" title=" " alt="" coords="1431,107,1601,133"/>
<area shape="rect" href="lapic_8h.html#a447b1b971acaf871dd62669b4aa3116f" title=" " alt="" coords="1431,157,1601,184"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a48738df3c98025631e2412d90758136c_icgraph.png" border="0" usemap="#axen_8c_a48738df3c98025631e2412d90758136c_icgraph" alt=""/></div>
<map name="axen_8c_a48738df3c98025631e2412d90758136c_icgraph" id="axen_8c_a48738df3c98025631e2412d90758136c_icgraph">
<area shape="rect" title=" " alt="" coords="2071,63,2261,90"/>
<area shape="rect" href="irq__comm_8c.html#ae7b7837b6e17bc60af3f4d81e9a4147e" title=" " alt="" coords="1821,38,2023,65"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="1843,89,2001,115"/>
<area shape="rect" href="xen_8c.html#a7432a92fb771aeb9f60ca4d89c10f15b" title=" " alt="" coords="1613,13,1726,39"/>
<area shape="rect" href="xen_8c.html#a42cb09290dc39689baca95686be1ff69" title=" " alt="" coords="1565,63,1773,90"/>
<area shape="rect" href="xen_8c.html#a952a322aa5cce4d0bd3fe372d820de13" title=" " alt="" coords="1566,114,1773,141"/>
<area shape="rect" href="xen_8c.html#ab30962c07569543c2879269c4ec40d70" title=" " alt="" coords="1571,173,1768,199"/>
<area shape="rect" href="xen_8c.html#a508e4ef7a5f613f8e7daf8a633ae8ee5" title=" " alt="" coords="1341,13,1516,39"/>
<area shape="rect" href="irq__comm_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1117,13,1289,39"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="896,13,1048,39"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="676,13,831,39"/>
<area shape="rect" href="irq_8h.html#aaf23e09ccf4b445556e56ea8598e1311" title=" " alt="" coords="461,5,628,47"/>
<area shape="rect" href="x86_8c.html#aaf3dbbe842e06195f2e46694ea837380" title=" " alt="" coords="219,13,413,39"/>
<area shape="rect" href="kvm__main_8c.html#aaeec02d207c8ce5ca12b1ef2ac36fae0" title=" " alt="" coords="5,5,171,47"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="1355,63,1503,90"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="1113,63,1292,90"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="1354,114,1503,141"/>
<area shape="rect" href="irq_8c.html#a2d54275d9e142ae8e337298689483728" title=" " alt="" coords="1352,165,1505,207"/>
<area shape="rect" href="xen_8c.html#a0446c241eff9babb33e990edd1347b96" title=" " alt="" coords="1340,231,1517,258"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="1162,177,1243,203"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="879,177,1065,203"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="691,202,815,229"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="893,227,1051,254"/>
</map>
</div>

</div>
</div>
<a id="a2c5ff8f2966ec21633bf34f39f981d3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c5ff8f2966ec21633bf34f39f981d3c">&#9670;&nbsp;</a></span>kvm_xen_setattr_evtchn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_xen_setattr_evtchn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_xen_hvm_attr *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l02050">2050</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;{</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    u32 port = data-&gt;u.evtchn.send_port;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160; </div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="keywordflow">if</span> (data-&gt;u.evtchn.flags == KVM_XEN_EVTCHN_RESET)</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="xen_8c.html#ac62834296caffe4f21f173993a510823">kvm_xen_eventfd_reset</a>(kvm);</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160; </div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    <span class="keywordflow">if</span> (!port || port &gt;= <a class="code" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d">max_evtchn_port</a>(kvm))</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160; </div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="keywordflow">if</span> (data-&gt;u.evtchn.flags == KVM_XEN_EVTCHN_DEASSIGN)</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="xen_8c.html#a32bc1d5ae7e58f301dd76cc65e585f81">kvm_xen_eventfd_deassign</a>(kvm, port);</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <span class="keywordflow">if</span> (data-&gt;u.evtchn.flags == KVM_XEN_EVTCHN_UPDATE)</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="xen_8c.html#a43566f69e0b71f82cbd528428cd50c13">kvm_xen_eventfd_update</a>(kvm, data);</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    <span class="keywordflow">if</span> (data-&gt;u.evtchn.flags)</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160; </div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="xen_8c.html#af22ffcd81793c28d8f1952ed94e0d051">kvm_xen_eventfd_assign</a>(kvm, data);</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_a32bc1d5ae7e58f301dd76cc65e585f81"><div class="ttname"><a href="xen_8c.html#a32bc1d5ae7e58f301dd76cc65e585f81">kvm_xen_eventfd_deassign</a></div><div class="ttdeci">static int kvm_xen_eventfd_deassign(struct kvm *kvm, u32 port)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01990">xen.c:1990</a></div></div>
<div class="ttc" id="axen_8c_html_a43566f69e0b71f82cbd528428cd50c13"><div class="ttname"><a href="xen_8c.html#a43566f69e0b71f82cbd528428cd50c13">kvm_xen_eventfd_update</a></div><div class="ttdeci">static int kvm_xen_eventfd_update(struct kvm *kvm, struct kvm_xen_hvm_attr *data)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01871">xen.c:1871</a></div></div>
<div class="ttc" id="axen_8c_html_ac62834296caffe4f21f173993a510823"><div class="ttname"><a href="xen_8c.html#ac62834296caffe4f21f173993a510823">kvm_xen_eventfd_reset</a></div><div class="ttdeci">static int kvm_xen_eventfd_reset(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l02008">xen.c:2008</a></div></div>
<div class="ttc" id="axen_8c_html_af22ffcd81793c28d8f1952ed94e0d051"><div class="ttname"><a href="xen_8c.html#af22ffcd81793c28d8f1952ed94e0d051">kvm_xen_eventfd_assign</a></div><div class="ttdeci">static int kvm_xen_eventfd_assign(struct kvm *kvm, struct kvm_xen_hvm_attr *data)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01918">xen.c:1918</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a2c5ff8f2966ec21633bf34f39f981d3c_cgraph.png" border="0" usemap="#axen_8c_a2c5ff8f2966ec21633bf34f39f981d3c_cgraph" alt=""/></div>
<map name="axen_8c_a2c5ff8f2966ec21633bf34f39f981d3c_cgraph" id="axen_8c_a2c5ff8f2966ec21633bf34f39f981d3c_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,188,133"/>
<area shape="rect" href="xen_8c.html#af22ffcd81793c28d8f1952ed94e0d051" title=" " alt="" coords="244,5,431,32"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="487,31,621,57"/>
<area shape="rect" href="xen_8c.html#a32bc1d5ae7e58f301dd76cc65e585f81" title=" " alt="" coords="236,107,439,133"/>
<area shape="rect" href="xen_8c.html#ac62834296caffe4f21f173993a510823" title=" " alt="" coords="248,157,427,184"/>
<area shape="rect" href="xen_8c.html#a43566f69e0b71f82cbd528428cd50c13" title=" " alt="" coords="242,208,433,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a2c5ff8f2966ec21633bf34f39f981d3c_icgraph.png" border="0" usemap="#axen_8c_a2c5ff8f2966ec21633bf34f39f981d3c_icgraph" alt=""/></div>
<map name="axen_8c_a2c5ff8f2966ec21633bf34f39f981d3c_icgraph" id="axen_8c_a2c5ff8f2966ec21633bf34f39f981d3c_icgraph">
<area shape="rect" title=" " alt="" coords="425,5,608,32"/>
<area shape="rect" href="xen_8c.html#a97a02cd2ae7319635c2de6370b82cb1b" title=" " alt="" coords="203,5,377,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a508e4ef7a5f613f8e7daf8a633ae8ee5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a508e4ef7a5f613f8e7daf8a633ae8ee5">&#9670;&nbsp;</a></span>kvm_xen_setup_evtchn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_setup_evtchn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_kernel_irq_routing_entry *&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_irq_routing_entry *&#160;</td>
          <td class="paramname"><em>ue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01785">1785</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;{</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160; </div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="keywordflow">if</span> (ue-&gt;u.xen_evtchn.port &gt;= <a class="code" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d">max_evtchn_port</a>(kvm))</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160; </div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="comment">/* We only support 2 level event channels for now */</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="keywordflow">if</span> (ue-&gt;u.xen_evtchn.priority != KVM_IRQ_ROUTING_XEN_EVTCHN_PRIO_2LEVEL)</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160; </div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="comment">     * Xen gives us interesting mappings from vCPU index to APIC ID,</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment">     * which means kvm_get_vcpu_by_id() has to iterate over all vCPUs</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment">     * to find it. Do that once at setup time, instead of every time.</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="comment">     * But beware that on live update / live migration, the routing</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="comment">     * table might be reinstated before the vCPU threads have finished</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">     * recreating their vCPUs.</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    vcpu = kvm_get_vcpu_by_id(kvm, ue-&gt;u.xen_evtchn.vcpu);</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="keywordflow">if</span> (vcpu)</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        e-&gt;xen_evtchn.vcpu_idx = vcpu-&gt;vcpu_idx;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        e-&gt;xen_evtchn.vcpu_idx = -1;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160; </div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    e-&gt;xen_evtchn.port = ue-&gt;u.xen_evtchn.port;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    e-&gt;xen_evtchn.vcpu_id = ue-&gt;u.xen_evtchn.vcpu;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    e-&gt;xen_evtchn.priority = ue-&gt;u.xen_evtchn.priority;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    e-&gt;set = <a class="code" href="xen_8c.html#a7432a92fb771aeb9f60ca4d89c10f15b">evtchn_set_fn</a>;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160; </div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_a7432a92fb771aeb9f60ca4d89c10f15b"><div class="ttname"><a href="xen_8c.html#a7432a92fb771aeb9f60ca4d89c10f15b">evtchn_set_fn</a></div><div class="ttdeci">static int evtchn_set_fn(struct kvm_kernel_irq_routing_entry *e, struct kvm *kvm, int irq_source_id, int level, bool line_status)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l01772">xen.c:1772</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a508e4ef7a5f613f8e7daf8a633ae8ee5_cgraph.png" border="0" usemap="#axen_8c_a508e4ef7a5f613f8e7daf8a633ae8ee5_cgraph" alt=""/></div>
<map name="axen_8c_a508e4ef7a5f613f8e7daf8a633ae8ee5_cgraph" id="axen_8c_a508e4ef7a5f613f8e7daf8a633ae8ee5_cgraph">
<area shape="rect" title=" " alt="" coords="5,520,180,547"/>
<area shape="rect" href="xen_8c.html#a7432a92fb771aeb9f60ca4d89c10f15b" title=" " alt="" coords="228,495,341,521"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="849,579,983,605"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="389,461,548,488"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="624,284,759,311"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="596,461,787,488"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="842,183,990,209"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="1051,56,1210,83"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1288,157,1424,184"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="1065,208,1197,235"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1287,31,1425,57"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1537,5,1689,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1789,5,1952,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1309,208,1403,235"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="1268,276,1444,303"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1283,327,1429,369"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1512,56,1715,83"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1550,107,1677,133"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1530,157,1697,184"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1548,208,1679,235"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1559,259,1667,285"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1805,208,1937,235"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="2011,259,2225,285"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="2273,259,2469,285"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1520,360,1707,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1779,360,1963,387"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="853,360,979,387"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1809,411,1932,437"/>
<area shape="rect" href="xen_8c.html#a920a89da9fa627b54860f838c736b003" title=" " alt="" coords="1045,461,1216,488"/>
<area shape="rect" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c" title=" " alt="" coords="835,513,997,554"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="2014,385,2222,412"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="2041,436,2195,463"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="1053,555,1208,597"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="1264,766,1448,807"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="1288,563,1424,589"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="1523,631,1704,657"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="1521,682,1706,723"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="1509,748,1718,775"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="1496,799,1731,825"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="1517,849,1710,876"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="1535,901,1692,942"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="1532,967,1695,993"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1799,765,1942,792"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="1545,563,1682,589"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1817,461,1925,488"/>
<area shape="rect" href="lapic_8c.html#ad063ed2f42a913efa82bad52d1b58aa8" title=" " alt="" coords="1806,512,1935,539"/>
<area shape="rect" href="x86_8c.html#a09da0747db3b012bff918f94816f0bd0" title=" " alt="" coords="1807,563,1934,589"/>
<area shape="rect" href="smm_8h.html#adbee86ed847633616e1e3afcc7e98e6e" title=" " alt="" coords="1808,613,1933,640"/>
<area shape="rect" href="lapic_8h.html#ada4d7479e3c0f2e45cb1565dab78c198" title=" " alt="" coords="1783,664,1959,691"/>
<area shape="rect" href="lapic_8h.html#aecd6ca5347dbb81047584149b2291019" title=" " alt="" coords="1789,715,1953,741"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a508e4ef7a5f613f8e7daf8a633ae8ee5_icgraph.png" border="0" usemap="#axen_8c_a508e4ef7a5f613f8e7daf8a633ae8ee5_icgraph" alt=""/></div>
<map name="axen_8c_a508e4ef7a5f613f8e7daf8a633ae8ee5_icgraph" id="axen_8c_a508e4ef7a5f613f8e7daf8a633ae8ee5_icgraph">
<area shape="rect" title=" " alt="" coords="1299,13,1473,39"/>
<area shape="rect" href="irq__comm_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1079,13,1251,39"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="879,13,1031,39"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="676,13,831,39"/>
<area shape="rect" href="irq_8h.html#aaf23e09ccf4b445556e56ea8598e1311" title=" " alt="" coords="461,5,628,47"/>
<area shape="rect" href="x86_8c.html#aaf3dbbe842e06195f2e46694ea837380" title=" " alt="" coords="219,13,413,39"/>
<area shape="rect" href="kvm__main_8c.html#aaeec02d207c8ce5ca12b1ef2ac36fae0" title=" " alt="" coords="5,5,171,47"/>
</map>
</div>

</div>
</div>
<a id="a302274d0dadb3dc482dbf4efca0c51d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a302274d0dadb3dc482dbf4efca0c51d0">&#9670;&nbsp;</a></span>kvm_xen_shared_info_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_xen_shared_info_init </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00037">37</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keyword">struct </span>gfn_to_pfn_cache *gpc = &amp;kvm-&gt;arch.xen.shinfo_cache;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">struct </span>pvclock_wall_clock *wc;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    gpa_t gpa = gfn_to_gpa(gfn);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    u32 *wc_sec_hi;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    u32 wc_version;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    u64 wall_nsec;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordtype">int</span> idx = srcu_read_lock(&amp;kvm-&gt;srcu);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">if</span> (gfn == KVM_XEN_INVALID_GFN) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(gpc);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        ret = <a class="code" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559">kvm_gpc_activate</a>(gpc, gpa, PAGE_SIZE);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">         * This code mirrors kvm_write_wall_clock() except that it writes</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">         * directly through the pfn cache and doesn&#39;t mark the page dirty.</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        wall_nsec = <a class="code" href="x86_8c.html#a3a7c3d562176e798101d21bfaaae77a9">kvm_get_wall_clock_epoch</a>(kvm);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="comment">/* It could be invalid again already, so we need to check */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        read_lock_irq(&amp;gpc-&gt;lock);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">if</span> (gpc-&gt;valid)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        read_unlock_irq(&amp;gpc-&gt;lock);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    } <span class="keywordflow">while</span> (1);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">/* Paranoia checks on the 32-bit struct layout */</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__shared__info.html">compat_shared_info</a>, wc) != 0x900);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__shared__info.html">compat_shared_info</a>, arch.wc_sec_hi) != 0x924);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> pvclock_vcpu_time_info, version) != 0);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* Paranoia checks on the 64-bit struct layout */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> shared_info, wc) != 0xc00);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> shared_info, wc_sec_hi) != 0xc0c);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_64BIT) &amp;&amp; kvm-&gt;arch.xen.long_mode) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keyword">struct </span>shared_info *shinfo = gpc-&gt;khva;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        wc_sec_hi = &amp;shinfo-&gt;wc_sec_hi;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        wc = &amp;shinfo-&gt;wc;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keyword">struct </span><a class="code" href="structcompat__shared__info.html">compat_shared_info</a> *shinfo = gpc-&gt;khva;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        wc_sec_hi = &amp;shinfo-&gt;<a class="code" href="structcompat__shared__info.html#a5b2992b5400bf63f53040e5e24143008">arch</a>.<a class="code" href="structcompat__arch__shared__info.html#a953b5fee6bfbdcd3c0b539e1aedf7771">wc_sec_hi</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <a class="code" href="structcompat__shared__info.html#a742934b5403f9fc9d7a936c95037b66f">wc</a> = &amp;shinfo-&gt;<a class="code" href="structcompat__shared__info.html#a742934b5403f9fc9d7a936c95037b66f">wc</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">/* Increment and ensure an odd value */</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    wc_version = <a class="code" href="structcompat__shared__info.html#a742934b5403f9fc9d7a936c95037b66f">wc</a>-&gt;version = (<a class="code" href="structcompat__shared__info.html#a742934b5403f9fc9d7a936c95037b66f">wc</a>-&gt;version + 1) | 1;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    smp_wmb();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="structcompat__shared__info.html#a742934b5403f9fc9d7a936c95037b66f">wc</a>-&gt;nsec = do_div(wall_nsec, NSEC_PER_SEC);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="structcompat__shared__info.html#a742934b5403f9fc9d7a936c95037b66f">wc</a>-&gt;sec = (u32)wall_nsec;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    *wc_sec_hi = wall_nsec &gt;&gt; 32;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    smp_wmb();</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="structcompat__shared__info.html#a742934b5403f9fc9d7a936c95037b66f">wc</a>-&gt;version = wc_version + 1;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    read_unlock_irq(&amp;gpc-&gt;lock);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6">kvm_make_all_cpus_request</a>(kvm, KVM_REQ_MASTERCLOCK_UPDATE);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;out:</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    srcu_read_unlock(&amp;kvm-&gt;srcu, idx);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;}</div>
<div class="ttc" id="apfncache_8c_html_ae773cab9370378e6751f76cb0abc8559"><div class="ttname"><a href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559">kvm_gpc_activate</a></div><div class="ttdeci">int kvm_gpc_activate(struct gfn_to_pfn_cache *gpc, gpa_t gpa, unsigned long len)</div><div class="ttdef"><b>Definition:</b> <a href="pfncache_8c_source.html#l00357">pfncache.c:357</a></div></div>
<div class="ttc" id="astructcompat__arch__shared__info_html_a953b5fee6bfbdcd3c0b539e1aedf7771"><div class="ttname"><a href="structcompat__arch__shared__info.html#a953b5fee6bfbdcd3c0b539e1aedf7771">compat_arch_shared_info::wc_sec_hi</a></div><div class="ttdeci">uint32_t wc_sec_hi</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00215">xen.h:215</a></div></div>
<div class="ttc" id="astructcompat__shared__info_html_a5b2992b5400bf63f53040e5e24143008"><div class="ttname"><a href="structcompat__shared__info.html#a5b2992b5400bf63f53040e5e24143008">compat_shared_info::arch</a></div><div class="ttdeci">struct compat_arch_shared_info arch</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00221">xen.h:223</a></div></div>
<div class="ttc" id="astructcompat__shared__info_html_a742934b5403f9fc9d7a936c95037b66f"><div class="ttname"><a href="structcompat__shared__info.html#a742934b5403f9fc9d7a936c95037b66f">compat_shared_info::wc</a></div><div class="ttdeci">struct pvclock_wall_clock wc</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00221">xen.h:222</a></div></div>
<div class="ttc" id="ax86_8c_html_a3a7c3d562176e798101d21bfaaae77a9"><div class="ttname"><a href="x86_8c.html#a3a7c3d562176e798101d21bfaaae77a9">kvm_get_wall_clock_epoch</a></div><div class="ttdeci">uint64_t kvm_get_wall_clock_epoch(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8c_source.html#l03298">x86.c:3298</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a302274d0dadb3dc482dbf4efca0c51d0_cgraph.png" border="0" usemap="#axen_8c_a302274d0dadb3dc482dbf4efca0c51d0_cgraph" alt=""/></div>
<map name="axen_8c_a302274d0dadb3dc482dbf4efca0c51d0_cgraph" id="axen_8c_a302274d0dadb3dc482dbf4efca0c51d0_cgraph">
<area shape="rect" title=" " alt="" coords="5,440,197,467"/>
<area shape="rect" href="x86_8c.html#a3a7c3d562176e798101d21bfaaae77a9" title=" " alt="" coords="273,74,428,115"/>
<area shape="rect" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559" title=" " alt="" coords="280,393,421,420"/>
<area shape="rect" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2" title=" " alt="" coords="531,471,688,497"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="245,520,456,547"/>
<area shape="rect" href="x86_8c.html#ada3ebfd54ed70054113191d6575e5a71" title=" " alt="" coords="1259,5,1389,32"/>
<area shape="rect" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2" title=" " alt="" coords="542,56,677,83"/>
<area shape="rect" href="x86_8c.html#aa540b8d63c340bf4bad96578dfe9c329" title=" " alt="" coords="1245,107,1403,133"/>
<area shape="rect" href="x86_8c.html#a860bfcc41711ba017de704d71fe362a1" title=" " alt="" coords="800,56,913,83"/>
<area shape="rect" href="x86_8c.html#a5fb8061b510d35a89dc02d72eba913fc" title=" " alt="" coords="1023,56,1150,83"/>
<area shape="rect" href="x86_8c.html#abb79b4397b27e4e42529a46cccbad62c" title=" " alt="" coords="1237,56,1411,83"/>
<area shape="rect" href="x86_8c.html#a7c2c90d8aa6d48b108bbbe630d120f95" title=" " alt="" coords="1528,107,1603,133"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="535,387,683,413"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="777,267,936,293"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1019,477,1155,504"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="791,376,923,403"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1017,208,1156,235"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1248,157,1400,184"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1484,157,1647,184"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1039,309,1134,336"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="999,360,1175,387"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1013,411,1160,453"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1223,259,1425,285"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1261,309,1387,336"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1241,411,1407,437"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1259,360,1389,387"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1270,208,1378,235"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1499,411,1631,437"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1705,436,1920,463"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="1968,436,2164,463"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1231,512,1417,539"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1473,512,1657,539"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1719,512,1906,539"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="504,527,715,569"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="773,611,940,637"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="763,535,951,561"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1047,629,1126,656"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="999,579,1175,605"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1010,528,1163,555"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a302274d0dadb3dc482dbf4efca0c51d0_icgraph.png" border="0" usemap="#axen_8c_a302274d0dadb3dc482dbf4efca0c51d0_icgraph" alt=""/></div>
<map name="axen_8c_a302274d0dadb3dc482dbf4efca0c51d0_icgraph" id="axen_8c_a302274d0dadb3dc482dbf4efca0c51d0_icgraph">
<area shape="rect" title=" " alt="" coords="425,5,617,32"/>
<area shape="rect" href="xen_8c.html#a97a02cd2ae7319635c2de6370b82cb1b" title=" " alt="" coords="203,5,377,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
</map>
</div>

</div>
</div>
<a id="a0187b2f16608bbdf5525ad8c8e882459"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0187b2f16608bbdf5525ad8c8e882459">&#9670;&nbsp;</a></span>kvm_xen_start_timer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_xen_start_timer </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>guest_abs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">s64&#160;</td>
          <td class="paramname"><em>delta_ns</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00161">161</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">     * Avoid races with the old timer firing. Checking timer_expires</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">     * to avoid calling hrtimer_cancel() will only have false positives</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">     * so is fine.</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">if</span> (vcpu-&gt;arch.xen.timer_expires)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        hrtimer_cancel(&amp;vcpu-&gt;arch.xen.timer);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    atomic_set(&amp;vcpu-&gt;arch.xen.timer_pending, 0);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    vcpu-&gt;arch.xen.timer_expires = guest_abs;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span> (delta_ns &lt;= 0) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="xen_8c.html#a4017950790585b6ba8d51d7b8bb2d5f7">xen_timer_callback</a>(&amp;vcpu-&gt;arch.xen.timer);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        ktime_t ktime_now = ktime_get();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        hrtimer_start(&amp;vcpu-&gt;arch.xen.timer,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                  ktime_add_ns(ktime_now, delta_ns),</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                  HRTIMER_MODE_ABS_HARD);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a0187b2f16608bbdf5525ad8c8e882459_cgraph.png" border="0" usemap="#axen_8c_a0187b2f16608bbdf5525ad8c8e882459_cgraph" alt=""/></div>
<map name="axen_8c_a0187b2f16608bbdf5525ad8c8e882459_cgraph" id="axen_8c_a0187b2f16608bbdf5525ad8c8e882459_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,165,32"/>
<area shape="rect" href="xen_8c.html#a4017950790585b6ba8d51d7b8bb2d5f7" title=" " alt="" coords="213,5,361,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a0187b2f16608bbdf5525ad8c8e882459_icgraph.png" border="0" usemap="#axen_8c_a0187b2f16608bbdf5525ad8c8e882459_icgraph" alt=""/></div>
<map name="axen_8c_a0187b2f16608bbdf5525ad8c8e882459_icgraph" id="axen_8c_a0187b2f16608bbdf5525ad8c8e882459_icgraph">
<area shape="rect" title=" " alt="" coords="697,56,857,83"/>
<area shape="rect" href="xen_8c.html#aee859a411f74e3aa2dd986c561eb72dc" title=" " alt="" coords="439,5,649,32"/>
<area shape="rect" href="xen_8c.html#a770531539245dce08f6187702354032c" title=" " alt="" coords="454,56,634,83"/>
<area shape="rect" href="xen_8c.html#a475f17b008ae9643247453de0018df17" title=" " alt="" coords="456,107,632,133"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="237,31,385,57"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="5,31,184,57"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="232,107,391,133"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="33,107,157,133"/>
</map>
</div>

</div>
</div>
<a id="a3e98609584a6375fe160f81dfafbf2f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e98609584a6375fe160f81dfafbf2f2">&#9670;&nbsp;</a></span>kvm_xen_stop_timer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_xen_stop_timer </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00184">184</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;{</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    hrtimer_cancel(&amp;vcpu-&gt;arch.xen.timer);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    vcpu-&gt;arch.xen.timer_expires = 0;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    atomic_set(&amp;vcpu-&gt;arch.xen.timer_pending, 0);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a3e98609584a6375fe160f81dfafbf2f2_icgraph.png" border="0" usemap="#axen_8c_a3e98609584a6375fe160f81dfafbf2f2_icgraph" alt=""/></div>
<map name="axen_8c_a3e98609584a6375fe160f81dfafbf2f2_icgraph" id="axen_8c_a3e98609584a6375fe160f81dfafbf2f2_icgraph">
<area shape="rect" title=" " alt="" coords="2064,272,2223,299"/>
<area shape="rect" href="xen_8c.html#a3b39fb3ff349ca2ab87179dc95d5d105" title=" " alt="" coords="1823,196,1998,223"/>
<area shape="rect" href="xen_8c.html#aee859a411f74e3aa2dd986c561eb72dc" title=" " alt="" coords="1805,247,2016,273"/>
<area shape="rect" href="xen_8c.html#a770531539245dce08f6187702354032c" title=" " alt="" coords="1821,297,2001,324"/>
<area shape="rect" href="xen_8c.html#a475f17b008ae9643247453de0018df17" title=" " alt="" coords="1823,348,1999,375"/>
<area shape="rect" href="x86_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1577,196,1757,223"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1357,157,1502,184"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1329,208,1529,235"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1129,157,1281,184"/>
<area shape="rect" href="x86_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="911,157,1081,184"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="553,69,680,96"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="728,183,863,209"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="303,5,497,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="559,183,674,209"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="325,56,475,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="317,107,483,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="323,157,477,184"/>
<area shape="rect" href="debugfs_8c.html#ae48a8d31368e51cbe5f950df129f5285" title=" " alt="" coords="295,208,505,235"/>
<area shape="rect" href="debugfs_8c.html#af0427db3ec1a8c38ea51591abbefde57" title=" " alt="" coords="314,259,486,301"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="333,325,467,352"/>
<area shape="rect" href="sev_8c.html#ad28fd793149997c912b52490f6ca139a" title=" " alt="" coords="329,376,471,403"/>
<area shape="rect" href="sev_8c.html#af1eb77eac84f085b0a943b87f783e30d" title=" " alt="" coords="335,427,465,453"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="47,56,205,83"/>
<area shape="rect" href="sev_8c.html#abe3c569b297da3b78824074b8c08f9a7" title=" " alt="" coords="5,376,247,403"/>
<area shape="rect" href="svm_8c.html#a0e69cefce46e7b11e1e8e056ea5b6561" title=" " alt="" coords="59,427,193,453"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="1593,272,1741,299"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="1340,272,1519,299"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="1588,348,1747,375"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="1367,348,1491,375"/>
</map>
</div>

</div>
</div>
<a id="a6acde067fc775eb22a4c49b5ca434963"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6acde067fc775eb22a4c49b5ca434963">&#9670;&nbsp;</a></span>kvm_xen_update_runstate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_xen_update_runstate </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00465">465</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;{</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keyword">struct </span>kvm_vcpu_xen *vx = &amp;v-&gt;arch.xen;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    u64 now = <a class="code" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2">get_kvmclock_ns</a>(v-&gt;kvm);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    u64 delta_ns = now - vx-&gt;runstate_entry_time;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    u64 run_delay = current-&gt;sched_info.run_delay;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span> (unlikely(!vx-&gt;runstate_entry_time))</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        vx-&gt;current_runstate = RUNSTATE_offline;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">     * Time waiting for the scheduler isn&#39;t &quot;stolen&quot; if the</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">     * vCPU wasn&#39;t running anyway.</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">if</span> (vx-&gt;current_runstate == RUNSTATE_running) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        u64 steal_ns = run_delay - vx-&gt;last_steal;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        delta_ns -= steal_ns;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        vx-&gt;runstate_times[RUNSTATE_runnable] += steal_ns;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    vx-&gt;last_steal = run_delay;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    vx-&gt;runstate_times[vx-&gt;current_runstate] += delta_ns;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    vx-&gt;current_runstate = <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    vx-&gt;runstate_entry_time = now;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">if</span> (vx-&gt;runstate_cache.active)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <a class="code" href="xen_8c.html#ab6eefd0c967fad2f6ef73e77bc0dc50d">kvm_xen_update_runstate_guest</a>(v, <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a> == RUNSTATE_runnable);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_ab6eefd0c967fad2f6ef73e77bc0dc50d"><div class="ttname"><a href="xen_8c.html#ab6eefd0c967fad2f6ef73e77bc0dc50d">kvm_xen_update_runstate_guest</a></div><div class="ttdeci">static void kvm_xen_update_runstate_guest(struct kvm_vcpu *v, bool atomic)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00198">xen.c:198</a></div></div>
<div class="ttc" id="axen_8h_html_a89f234133d3efe315836311cbf21c64b"><div class="ttname"><a href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a></div><div class="ttdeci">int state</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00000">xen.h:0</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a6acde067fc775eb22a4c49b5ca434963_cgraph.png" border="0" usemap="#axen_8c_a6acde067fc775eb22a4c49b5ca434963_cgraph" alt=""/></div>
<map name="axen_8c_a6acde067fc775eb22a4c49b5ca434963_cgraph" id="axen_8c_a6acde067fc775eb22a4c49b5ca434963_cgraph">
<area shape="rect" title=" " alt="" coords="5,205,200,232"/>
<area shape="rect" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2" title=" " alt="" coords="278,155,413,181"/>
<area shape="rect" href="xen_8c.html#ab6eefd0c967fad2f6ef73e77bc0dc50d" title=" " alt="" coords="248,227,443,269"/>
<area shape="rect" href="x86_8c.html#a860bfcc41711ba017de704d71fe362a1" title=" " alt="" coords="525,132,639,159"/>
<area shape="rect" href="x86_8c.html#a5fb8061b510d35a89dc02d72eba913fc" title=" " alt="" coords="745,81,871,108"/>
<area shape="rect" href="x86_8c.html#ada3ebfd54ed70054113191d6575e5a71" title=" " alt="" coords="974,5,1103,32"/>
<area shape="rect" href="x86_8c.html#abb79b4397b27e4e42529a46cccbad62c" title=" " alt="" coords="952,56,1125,83"/>
<area shape="rect" href="x86_8c.html#aa540b8d63c340bf4bad96578dfe9c329" title=" " alt="" coords="960,107,1117,133"/>
<area shape="rect" href="x86_8c.html#a7c2c90d8aa6d48b108bbbe630d120f95" title=" " alt="" coords="1233,107,1308,133"/>
<area shape="rect" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559" title=" " alt="" coords="511,184,653,211"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="519,235,645,261"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="515,285,649,312"/>
<area shape="rect" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15" title=" " alt="" coords="491,340,673,367"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="734,208,882,235"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="959,157,1118,184"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1203,208,1339,235"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="973,259,1105,285"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1201,157,1340,184"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1432,81,1584,108"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1668,81,1831,108"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1223,259,1318,285"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="1183,309,1359,336"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1197,361,1344,402"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1407,132,1609,159"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1445,183,1571,209"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1425,233,1591,260"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1443,284,1573,311"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1454,335,1562,361"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1683,284,1815,311"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1889,335,2104,361"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="2152,335,2348,361"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1415,436,1601,463"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1657,436,1841,463"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1903,436,2090,463"/>
<area shape="rect" href="dirty__ring_8c.html#ac1878b63f1f337e93cf186ebd4fffcc4" title=" " alt="" coords="722,282,894,323"/>
<area shape="rect" href="dirty__ring_8c.html#a81ebbf462440ed5392d6d3412a859ae7" title=" " alt="" coords="729,348,887,375"/>
<area shape="rect" href="kvm__main_8c.html#ac5a3afd8e2d8d1139dc7711c4b9e07e3" title=" " alt="" coords="721,399,895,425"/>
<area shape="rect" href="dirty__ring_8c.html#ad6e626257c739b2ac3d397119a7cf798" title=" " alt="" coords="943,325,1135,352"/>
<area shape="rect" href="dirty__ring_8c.html#a6fe5cd75b9bac6497e1ae7340f2a5f7b" title=" " alt="" coords="965,376,1113,403"/>
<area shape="rect" href="dirty__ring_8c.html#a22c9a239acf3463a8599a21c0a756538" title=" " alt="" coords="949,427,1128,453"/>
<area shape="rect" href="dirty__ring_8c.html#acd0a1e586324b4c49b429c7a392db73f" title=" " alt="" coords="1191,427,1350,453"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a6acde067fc775eb22a4c49b5ca434963_icgraph.png" border="0" usemap="#axen_8c_a6acde067fc775eb22a4c49b5ca434963_icgraph" alt=""/></div>
<map name="axen_8c_a6acde067fc775eb22a4c49b5ca434963_icgraph" id="axen_8c_a6acde067fc775eb22a4c49b5ca434963_icgraph">
<area shape="rect" title=" " alt="" coords="1159,64,1353,91"/>
<area shape="rect" href="xen_8h.html#a6dc8eb655a6c4a3171762dac569dc009" title=" " alt="" coords="969,5,1076,32"/>
<area shape="rect" href="xen_8h.html#add4ddcdd75d9c6f180241f289ec1d48d" title=" " alt="" coords="938,57,1107,98"/>
<area shape="rect" href="xen_8c.html#a475f17b008ae9643247453de0018df17" title=" " alt="" coords="935,123,1111,149"/>
<area shape="rect" href="x86_8c.html#a187212c772cf6e896de2a5304f88b9fb" title=" " alt="" coords="748,67,887,93"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="552,68,689,95"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,68,493,95"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,68,364,95"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,93,129,120"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="541,119,700,145"/>
</map>
</div>

</div>
</div>
<a id="ab6eefd0c967fad2f6ef73e77bc0dc50d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6eefd0c967fad2f6ef73e77bc0dc50d">&#9670;&nbsp;</a></span>kvm_xen_update_runstate_guest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_xen_update_runstate_guest </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>atomic</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00198">198</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;{</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keyword">struct </span>kvm_vcpu_xen *vx = &amp;v-&gt;arch.xen;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keyword">struct </span>gfn_to_pfn_cache *gpc1 = &amp;vx-&gt;runstate_cache;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keyword">struct </span>gfn_to_pfn_cache *gpc2 = &amp;vx-&gt;runstate2_cache;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordtype">size_t</span> user_len, user_len1, user_len2;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keyword">struct </span>vcpu_runstate_info rs;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordtype">size_t</span> times_ofs;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    uint8_t *update_bit = NULL;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    uint64_t entry_time;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    uint64_t *rs_times;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordtype">int</span> *rs_state;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">     * The only difference between 32-bit and 64-bit versions of the</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">     * runstate struct is the alignment of uint64_t in 32-bit, which</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">     * means that the 64-bit version has an additional 4 bytes of</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">     * padding after the first field &#39;state&#39;. Let&#39;s be really really</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">     * paranoid about that, and matching it with our internal data</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">     * structures that we memcpy into it...</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>) != 0);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>, <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>) != 0);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    BUILD_BUG_ON(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>) != 0x2c);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">     * The 64-bit structure has 4 bytes of padding before &#39;state_entry_time&#39;</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">     * so each subsequent field is shifted by 4, and it&#39;s 4 bytes longer.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a>) !=</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;             offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>, <a class="code" href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a>) + 4);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a>) !=</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;             offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>, <a class="code" href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a>) + 4);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    BUILD_BUG_ON(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> vcpu_runstate_info) != 0x2c + 4);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">     * The state field is in the same place at the start of both structs,</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">     * and is the same size (int) as vx-&gt;current_runstate.</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>) !=</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;             offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>, <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>));</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    BUILD_BUG_ON(sizeof_field(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>) !=</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;             <span class="keyword">sizeof</span>(vx-&gt;current_runstate));</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    BUILD_BUG_ON(sizeof_field(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>, <a class="code" href="xen_8h.html#a89f234133d3efe315836311cbf21c64b">state</a>) !=</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;             <span class="keyword">sizeof</span>(vx-&gt;current_runstate));</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">     * The state_entry_time field is 64 bits in both versions, and the</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">     * XEN_RUNSTATE_UPDATE flag is in the top bit, which given that x86</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">     * is little-endian means that it&#39;s in the last *byte* of the word.</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">     * That detail is important later.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    BUILD_BUG_ON(sizeof_field(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a>) !=</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;             <span class="keyword">sizeof</span>(uint64_t));</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    BUILD_BUG_ON(sizeof_field(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>, <a class="code" href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a>) !=</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;             <span class="keyword">sizeof</span>(uint64_t));</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    BUILD_BUG_ON((XEN_RUNSTATE_UPDATE &gt;&gt; 56) != 0x80);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">     * The time array is four 64-bit quantities in both versions, matching</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">     * the vx-&gt;runstate_times and immediately following state_entry_time.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a>) !=</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;             offsetof(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a>) - <span class="keyword">sizeof</span>(uint64_t));</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>, <a class="code" href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a>) !=</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;             offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>, <a class="code" href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a>) - <span class="keyword">sizeof</span>(uint64_t));</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    BUILD_BUG_ON(sizeof_field(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a>) !=</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;             sizeof_field(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>, <a class="code" href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a>));</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    BUILD_BUG_ON(sizeof_field(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a>) !=</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;             <span class="keyword">sizeof</span>(vx-&gt;runstate_times));</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_64BIT) &amp;&amp; v-&gt;kvm-&gt;arch.xen.long_mode) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        user_len = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>vcpu_runstate_info);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        times_ofs = offsetof(<span class="keyword">struct</span> vcpu_runstate_info,</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                     <a class="code" href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a>);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        user_len = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        times_ofs = offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                     <a class="code" href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">     * There are basically no alignment constraints. The guest can set it</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">     * up so it crosses from one page to the next, and at arbitrary byte</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">     * alignment (and the 32-bit ABI doesn&#39;t align the 64-bit integers</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">     * anyway, even if the overall struct had been 64-bit aligned).</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> ((gpc1-&gt;gpa &amp; ~PAGE_MASK) + user_len &gt;= PAGE_SIZE) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        user_len1 = PAGE_SIZE - (gpc1-&gt;gpa &amp; ~PAGE_MASK);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        user_len2 = user_len - user_len1;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        user_len1 = user_len;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        user_len2 = 0;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    BUG_ON(user_len1 + user_len2 != user_len);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; retry:</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">     * Attempt to obtain the GPC lock on *both* (if there are two)</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">     * gfn_to_pfn caches that cover the region.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">if</span> (atomic) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        local_irq_save(<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span> (!read_trylock(&amp;gpc1-&gt;lock)) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            local_irq_restore(<a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        read_lock_irqsave(&amp;gpc1-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d">kvm_gpc_check</a>(gpc1, user_len1)) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        read_unlock_irqrestore(&amp;gpc1-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="comment">/* When invoked from kvm_sched_out() we cannot sleep */</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordflow">if</span> (atomic)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe">kvm_gpc_refresh</a>(gpc1, user_len1))</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        read_lock_irqsave(&amp;gpc1-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (likely(!user_len2)) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">         * Set up three pointers directly to the runstate_info</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">         * struct in the guest (via the GPC).</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">         *   @rs_state    state field</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">         *   @rs_times    state_entry_time field.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">         *   @update_bit  last byte of state_entry_time, which</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">         *                  contains the XEN_RUNSTATE_UPDATE bit.</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        rs_state = gpc1-&gt;khva;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        rs_times = gpc1-&gt;khva + times_ofs;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">if</span> (v-&gt;kvm-&gt;arch.xen.runstate_update_flag)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            update_bit = ((<span class="keywordtype">void</span> *)(&amp;rs_times[1])) - 1;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">         * The guest&#39;s runstate_info is split across two pages and we</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">         * need to hold and validate both GPCs simultaneously. We can</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">         * declare a lock ordering GPC1 &gt; GPC2 because nothing else</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">         * takes them more than one at a time. Set a subclass on the</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">         * gpc1 lock to make lockdep shut up about it.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        lock_set_subclass(&amp;gpc1-&gt;lock.dep_map, 1, _THIS_IP_);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">if</span> (atomic) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">if</span> (!read_trylock(&amp;gpc2-&gt;lock)) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                read_unlock_irqrestore(&amp;gpc1-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            read_lock(&amp;gpc2-&gt;lock);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d">kvm_gpc_check</a>(gpc2, user_len2)) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            read_unlock(&amp;gpc2-&gt;lock);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            read_unlock_irqrestore(&amp;gpc1-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="comment">/* When invoked from kvm_sched_out() we cannot sleep */</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">if</span> (atomic)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">             * Use kvm_gpc_activate() here because if the runstate</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">             * area was configured in 32-bit mode and only extends</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">             * to the second page now because the guest changed to</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">             * 64-bit mode, the second GPC won&#39;t have been set up.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559">kvm_gpc_activate</a>(gpc2, gpc1-&gt;gpa + user_len1,</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                         user_len2))</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">             * We dropped the lock on GPC1 so we have to go all the</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">             * way back and revalidate that too.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <span class="keywordflow">goto</span> retry;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">         * In this case, the runstate_info struct will be assembled on</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">         * the kernel stack (compat or not as appropriate) and will</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">         * be copied to GPC1/GPC2 with a dual memcpy. Set up the three</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">         * rs pointers accordingly.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        rs_times = &amp;rs.state_entry_time;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">         * The rs_state pointer points to the start of what we&#39;ll</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">         * copy to the guest, which in the case of a compat guest</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">         * is the 32-bit field that the compiler thinks is padding.</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        rs_state = ((<span class="keywordtype">void</span> *)rs_times) - times_ofs;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">         * The update_bit is still directly in the guest memory,</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">         * via one GPC or the other.</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">if</span> (v-&gt;kvm-&gt;arch.xen.runstate_update_flag) {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keywordflow">if</span> (user_len1 &gt;= times_ofs + <span class="keyword">sizeof</span>(uint64_t))</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                update_bit = gpc1-&gt;khva + times_ofs +</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    <span class="keyword">sizeof</span>(uint64_t) - 1;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                update_bit = gpc2-&gt;khva + times_ofs +</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    <span class="keyword">sizeof</span>(uint64_t) - 1 - user_len1;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="preprocessor">#ifdef CONFIG_X86_64</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">         * Don&#39;t leak kernel memory through the padding in the 64-bit</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">         * version of the struct.</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        memset(&amp;rs, 0, offsetof(<span class="keyword">struct</span> vcpu_runstate_info, <a class="code" href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a>));</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">     * First, set the XEN_RUNSTATE_UPDATE bit in the top bit of the</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">     * state_entry_time field, directly in the guest. We need to set</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">     * that (and write-barrier) before writing to the rest of the</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">     * structure, and clear it last. Just as Xen does, we address the</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">     * single *byte* in which it resides because it might be in a</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">     * different cache line to the rest of the 64-bit word, due to</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">     * the (lack of) alignment constraints.</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    entry_time = vx-&gt;runstate_entry_time;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">if</span> (update_bit) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        entry_time |= XEN_RUNSTATE_UPDATE;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        *update_bit = (vx-&gt;runstate_entry_time | XEN_RUNSTATE_UPDATE) &gt;&gt; 56;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        smp_wmb();</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">     * Now assemble the actual structure, either on our kernel stack</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">     * or directly in the guest according to how the rs_state and</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">     * rs_times pointers were set up above.</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    *rs_state = vx-&gt;current_runstate;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    rs_times[0] = entry_time;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    memcpy(rs_times + 1, vx-&gt;runstate_times, <span class="keyword">sizeof</span>(vx-&gt;runstate_times));</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">/* For the split case, we have to then copy it to the guest. */</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">if</span> (user_len2) {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        memcpy(gpc1-&gt;khva, rs_state, user_len1);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        memcpy(gpc2-&gt;khva, ((<span class="keywordtype">void</span> *)rs_state) + user_len1, user_len2);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    smp_wmb();</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">/* Finally, clear the XEN_RUNSTATE_UPDATE bit. */</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span> (update_bit) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        entry_time &amp;= ~XEN_RUNSTATE_UPDATE;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        *update_bit = entry_time &gt;&gt; 56;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        smp_wmb();</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">if</span> (user_len2)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        read_unlock(&amp;gpc2-&gt;lock);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    read_unlock_irqrestore(&amp;gpc1-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <a class="code" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15">mark_page_dirty_in_slot</a>(v-&gt;kvm, gpc1-&gt;memslot, gpc1-&gt;gpa &gt;&gt; PAGE_SHIFT);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> (user_len2)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <a class="code" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15">mark_page_dirty_in_slot</a>(v-&gt;kvm, gpc2-&gt;memslot, gpc2-&gt;gpa &gt;&gt; PAGE_SHIFT);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;}</div>
<div class="ttc" id="astructcompat__vcpu__runstate__info_html"><div class="ttname"><a href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a></div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00229">xen.h:229</a></div></div>
<div class="ttc" id="axen_8h_html_a9064dc5f67f06766b1f5b2e1968b4f72"><div class="ttname"><a href="xen_8h.html#a9064dc5f67f06766b1f5b2e1968b4f72">state_entry_time</a></div><div class="ttdeci">uint64_t state_entry_time</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00001">xen.h:1</a></div></div>
<div class="ttc" id="axen_8h_html_aae48202dcaab37c9a13a4b624014da49"><div class="ttname"><a href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a></div><div class="ttdeci">uint64_t time[4]</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00002">xen.h:2</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_ab6eefd0c967fad2f6ef73e77bc0dc50d_cgraph.png" border="0" usemap="#axen_8c_ab6eefd0c967fad2f6ef73e77bc0dc50d_cgraph" alt=""/></div>
<map name="axen_8c_ab6eefd0c967fad2f6ef73e77bc0dc50d_cgraph" id="axen_8c_ab6eefd0c967fad2f6ef73e77bc0dc50d_cgraph">
<area shape="rect" title=" " alt="" coords="5,215,200,257"/>
<area shape="rect" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559" title=" " alt="" coords="269,147,410,173"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="276,197,403,224"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="272,248,407,275"/>
<area shape="rect" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15" title=" " alt="" coords="248,303,431,329"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="491,147,639,173"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="717,69,875,96"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="960,145,1096,172"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="730,196,862,223"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="959,19,1097,45"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1189,5,1341,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1425,5,1588,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="981,196,1075,223"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="940,247,1116,273"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="955,298,1101,339"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1164,56,1367,83"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1202,107,1329,133"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1182,157,1349,184"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1200,208,1331,235"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1211,259,1319,285"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1441,208,1573,235"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1647,259,1861,285"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="1909,259,2105,285"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1172,360,1359,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1415,360,1599,387"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="1661,360,1847,387"/>
<area shape="rect" href="dirty__ring_8c.html#ac1878b63f1f337e93cf186ebd4fffcc4" title=" " alt="" coords="479,245,651,286"/>
<area shape="rect" href="dirty__ring_8c.html#a81ebbf462440ed5392d6d3412a859ae7" title=" " alt="" coords="486,311,645,337"/>
<area shape="rect" href="kvm__main_8c.html#ac5a3afd8e2d8d1139dc7711c4b9e07e3" title=" " alt="" coords="479,361,652,388"/>
<area shape="rect" href="dirty__ring_8c.html#ad6e626257c739b2ac3d397119a7cf798" title=" " alt="" coords="700,263,892,289"/>
<area shape="rect" href="dirty__ring_8c.html#a6fe5cd75b9bac6497e1ae7340f2a5f7b" title=" " alt="" coords="722,313,870,340"/>
<area shape="rect" href="dirty__ring_8c.html#a22c9a239acf3463a8599a21c0a756538" title=" " alt="" coords="707,364,885,391"/>
<area shape="rect" href="dirty__ring_8c.html#acd0a1e586324b4c49b429c7a392db73f" title=" " alt="" coords="949,364,1107,391"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_ab6eefd0c967fad2f6ef73e77bc0dc50d_icgraph.png" border="0" usemap="#axen_8c_ab6eefd0c967fad2f6ef73e77bc0dc50d_icgraph" alt=""/></div>
<map name="axen_8c_ab6eefd0c967fad2f6ef73e77bc0dc50d_icgraph" id="axen_8c_ab6eefd0c967fad2f6ef73e77bc0dc50d_icgraph">
<area shape="rect" title=" " alt="" coords="1401,86,1596,127"/>
<area shape="rect" href="xen_8c.html#a6acde067fc775eb22a4c49b5ca434963" title=" " alt="" coords="1159,67,1353,93"/>
<area shape="rect" href="xen_8c.html#a475f17b008ae9643247453de0018df17" title=" " alt="" coords="935,123,1111,149"/>
<area shape="rect" href="xen_8h.html#a6dc8eb655a6c4a3171762dac569dc009" title=" " alt="" coords="969,5,1076,32"/>
<area shape="rect" href="xen_8h.html#add4ddcdd75d9c6f180241f289ec1d48d" title=" " alt="" coords="938,57,1107,98"/>
<area shape="rect" href="x86_8c.html#a187212c772cf6e896de2a5304f88b9fb" title=" " alt="" coords="748,67,887,93"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="552,68,689,95"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,68,493,95"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,68,364,95"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,93,129,120"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="541,119,700,145"/>
</map>
</div>

</div>
</div>
<a id="adf531b186f63f085d94a6c47ab72f473"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf531b186f63f085d94a6c47ab72f473">&#9670;&nbsp;</a></span>kvm_xen_update_tsc_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_xen_update_tsc_info </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l02135">2135</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;{</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <span class="keyword">struct </span>kvm_cpuid_entry2 *entry;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    u32 <span class="keyword">function</span>;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160; </div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">if</span> (!vcpu-&gt;arch.xen.cpuid.base)</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160; </div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    <span class="keyword">function</span> = vcpu-&gt;arch.xen.cpuid.base | XEN_CPUID_LEAF(3);</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">function</span> &gt; vcpu-&gt;arch.xen.cpuid.limit)</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160; </div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    entry = <a class="code" href="cpuid_8c.html#a638557b30255883157acafa55a351d0d">kvm_find_cpuid_entry_index</a>(vcpu, <span class="keyword">function</span>, 1);</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    <span class="keywordflow">if</span> (entry) {</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        entry-&gt;ecx = vcpu-&gt;arch.hv_clock.tsc_to_system_mul;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        entry-&gt;edx = vcpu-&gt;arch.hv_clock.tsc_shift;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    }</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160; </div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    entry = <a class="code" href="cpuid_8c.html#a638557b30255883157acafa55a351d0d">kvm_find_cpuid_entry_index</a>(vcpu, <span class="keyword">function</span>, 2);</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    <span class="keywordflow">if</span> (entry)</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        entry-&gt;eax = vcpu-&gt;arch.hw_tsc_khz;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;}</div>
<div class="ttc" id="acpuid_8c_html_a638557b30255883157acafa55a351d0d"><div class="ttname"><a href="cpuid_8c.html#a638557b30255883157acafa55a351d0d">kvm_find_cpuid_entry_index</a></div><div class="ttdeci">struct kvm_cpuid_entry2 * kvm_find_cpuid_entry_index(struct kvm_vcpu *vcpu, u32 function, u32 index)</div><div class="ttdef"><b>Definition:</b> <a href="cpuid_8c_source.html#l01447">cpuid.c:1447</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_adf531b186f63f085d94a6c47ab72f473_cgraph.png" border="0" usemap="#axen_8c_adf531b186f63f085d94a6c47ab72f473_cgraph" alt=""/></div>
<map name="axen_8c_adf531b186f63f085d94a6c47ab72f473_cgraph" id="axen_8c_adf531b186f63f085d94a6c47ab72f473_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,196,39"/>
<area shape="rect" href="cpuid_8c.html#a638557b30255883157acafa55a351d0d" title=" " alt="" coords="244,5,409,47"/>
<area shape="rect" href="cpuid_8c.html#a7220f0f9a6d0047aef7619e272fa9518" title=" " alt="" coords="457,13,595,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_adf531b186f63f085d94a6c47ab72f473_icgraph.png" border="0" usemap="#axen_8c_adf531b186f63f085d94a6c47ab72f473_icgraph" alt=""/></div>
<map name="axen_8c_adf531b186f63f085d94a6c47ab72f473_icgraph" id="axen_8c_adf531b186f63f085d94a6c47ab72f473_icgraph">
<area shape="rect" title=" " alt="" coords="957,5,1148,32"/>
<area shape="rect" href="x86_8c.html#a6c4cf532744434dffd1685085eedbaff" title=" " alt="" coords="727,5,909,32"/>
<area shape="rect" href="x86_8c.html#a3361a1b517035bb0595ead223a3cb349" title=" " alt="" coords="541,5,679,32"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="412,5,493,32"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,5,364,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a0446c241eff9babb33e990edd1347b96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0446c241eff9babb33e990edd1347b96">&#9670;&nbsp;</a></span>kvm_xen_vcpu_get_attr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_vcpu_get_attr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_xen_vcpu_attr *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00972">972</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;{</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordtype">int</span> r = -ENOENT;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    mutex_lock(&amp;vcpu-&gt;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160; </div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">switch</span> (data-&gt;type) {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_VCPU_INFO:</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="keywordflow">if</span> (vcpu-&gt;arch.xen.vcpu_info_cache.active)</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            data-&gt;u.gpa = vcpu-&gt;arch.xen.vcpu_info_cache.gpa;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            data-&gt;u.gpa = KVM_XEN_INVALID_GPA;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        r = 0;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_VCPU_TIME_INFO:</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordflow">if</span> (vcpu-&gt;arch.xen.vcpu_time_info_cache.active)</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            data-&gt;u.gpa = vcpu-&gt;arch.xen.vcpu_time_info_cache.gpa;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            data-&gt;u.gpa = KVM_XEN_INVALID_GPA;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        r = 0;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_RUNSTATE_ADDR:</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="keywordflow">if</span> (!sched_info_on()) {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            r = -EOPNOTSUPP;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordflow">if</span> (vcpu-&gt;arch.xen.runstate_cache.active) {</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            data-&gt;u.gpa = vcpu-&gt;arch.xen.runstate_cache.gpa;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            r = 0;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        }</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_RUNSTATE_CURRENT:</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordflow">if</span> (!sched_info_on()) {</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            r = -EOPNOTSUPP;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        data-&gt;u.runstate.state = vcpu-&gt;arch.xen.current_runstate;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        r = 0;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_RUNSTATE_DATA:</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keywordflow">if</span> (!sched_info_on()) {</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            r = -EOPNOTSUPP;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        }</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        data-&gt;u.runstate.state = vcpu-&gt;arch.xen.current_runstate;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        data-&gt;u.runstate.state_entry_time =</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            vcpu-&gt;arch.xen.runstate_entry_time;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        data-&gt;u.runstate.time_running =</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;            vcpu-&gt;arch.xen.runstate_times[RUNSTATE_running];</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        data-&gt;u.runstate.time_runnable =</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            vcpu-&gt;arch.xen.runstate_times[RUNSTATE_runnable];</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        data-&gt;u.runstate.time_blocked =</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            vcpu-&gt;arch.xen.runstate_times[RUNSTATE_blocked];</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        data-&gt;u.runstate.time_offline =</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            vcpu-&gt;arch.xen.runstate_times[RUNSTATE_offline];</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        r = 0;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160; </div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_RUNSTATE_ADJUST:</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        r = -EINVAL;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160; </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_VCPU_ID:</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        data-&gt;u.vcpu_id = vcpu-&gt;arch.xen.vcpu_id;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        r = 0;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_TIMER:</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">         * Ensure a consistent snapshot of state is captured, with a</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">         * timer either being pending, or the event channel delivered</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">         * to the corresponding bit in the shared_info. Not still</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">         * lurking in the timer_pending flag for deferred delivery.</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">         * Purely as an optimisation, if the timer_expires field is</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">         * zero, that means the timer isn&#39;t active (or even in the</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">         * timer_pending flag) and there is no need to cancel it.</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="keywordflow">if</span> (vcpu-&gt;arch.xen.timer_expires) {</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            hrtimer_cancel(&amp;vcpu-&gt;arch.xen.timer);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            <a class="code" href="xen_8c.html#ab30962c07569543c2879269c4ec40d70">kvm_xen_inject_timer_irqs</a>(vcpu);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        }</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160; </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        data-&gt;u.timer.port = vcpu-&gt;arch.xen.timer_virq;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        data-&gt;u.timer.priority = KVM_IRQ_ROUTING_XEN_EVTCHN_PRIO_2LEVEL;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        data-&gt;u.timer.expires_ns = vcpu-&gt;arch.xen.timer_expires;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">         * The hrtimer may trigger and raise the IRQ immediately,</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">         * while the returned state causes it to be set up and</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">         * raised again on the destination system after migration.</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">         * That&#39;s fine, as the guest won&#39;t even have had a chance</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">         * to run and handle the interrupt. Asserting an already</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">         * pending event channel is idempotent.</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        <span class="keywordflow">if</span> (vcpu-&gt;arch.xen.timer_expires)</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            hrtimer_start_expires(&amp;vcpu-&gt;arch.xen.timer,</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                          HRTIMER_MODE_ABS_HARD);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        r = 0;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_UPCALL_VECTOR:</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        data-&gt;u.vector = vcpu-&gt;arch.xen.upcall_vector;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        r = 0;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160; </div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    }</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    mutex_unlock(&amp;vcpu-&gt;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_ab30962c07569543c2879269c4ec40d70"><div class="ttname"><a href="xen_8c.html#ab30962c07569543c2879269c4ec40d70">kvm_xen_inject_timer_irqs</a></div><div class="ttdeci">void kvm_xen_inject_timer_irqs(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00116">xen.c:116</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a0446c241eff9babb33e990edd1347b96_cgraph.png" border="0" usemap="#axen_8c_a0446c241eff9babb33e990edd1347b96_cgraph" alt=""/></div>
<map name="axen_8c_a0446c241eff9babb33e990edd1347b96_cgraph" id="axen_8c_a0446c241eff9babb33e990edd1347b96_cgraph">
<area shape="rect" title=" " alt="" coords="5,360,183,387"/>
<area shape="rect" href="xen_8c.html#ab30962c07569543c2879269c4ec40d70" title=" " alt="" coords="231,360,428,387"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="476,360,635,387"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="711,247,845,273"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="683,385,873,412"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="929,183,1077,209"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="1138,56,1297,83"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1375,157,1511,184"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="1151,208,1283,235"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1373,31,1512,57"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1624,5,1776,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1876,5,2039,32"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1395,208,1490,235"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="1355,276,1531,303"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1369,327,1516,369"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1599,208,1801,235"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1637,259,1763,285"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1617,56,1783,83"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1635,107,1765,133"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1646,157,1754,184"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1891,157,2023,184"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="2097,233,2312,260"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="2360,233,2556,260"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1607,360,1793,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1865,360,2049,387"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="939,360,1066,387"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1896,411,2019,437"/>
<area shape="rect" href="xen_8c.html#a920a89da9fa627b54860f838c736b003" title=" " alt="" coords="1132,461,1303,488"/>
<area shape="rect" href="xen_8c.html#a7ba53f4f869b74569192380f1adfd40c" title=" " alt="" coords="921,513,1084,554"/>
<area shape="rect" href="xen_8c.html#abfe301f067b5181a7028ad5e62629e6d" title=" " alt="" coords="935,309,1070,336"/>
<area shape="rect" href="x86_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="2101,436,2309,463"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="2128,385,2281,412"/>
<area shape="rect" href="lapic_8c.html#a17eee4051fa1d41b805b09a195f64045" title=" " alt="" coords="1140,534,1295,575"/>
<area shape="rect" href="lapic_8c.html#aee815bad0e899bbf195750d2d9b5470f" title=" " alt="" coords="1351,727,1535,769"/>
<area shape="rect" href="lapic_8c.html#a3d272e1b73f22f797955e7ddea84b741" title=" " alt="" coords="1375,541,1511,568"/>
<area shape="rect" href="lapic_8c.html#a47d52843df792ef8e7bffdfb66a3b40b" title=" " alt="" coords="1609,760,1791,787"/>
<area shape="rect" href="lapic_8c.html#a079d589509607a9d9baa6bed3eae7fa6" title=" " alt="" coords="1607,811,1793,853"/>
<area shape="rect" href="lapic_8c.html#abbce6da431ef5f15d85b5fc741d3ef72" title=" " alt="" coords="1595,877,1805,904"/>
<area shape="rect" href="lapic_8c.html#a2381239fbfde7c282aabdd2c01f50ad3" title=" " alt="" coords="1583,928,1817,955"/>
<area shape="rect" href="lapic_8h.html#adfbea71ac96b210fb91bef47c77194f1" title=" " alt="" coords="1603,592,1797,619"/>
<area shape="rect" href="x86_8c.html#a47d88660a2a5f8ee22df1253604d1ed7" title=" " alt="" coords="1621,643,1779,685"/>
<area shape="rect" href="lapic_8c.html#ac9fecb7d9f4574931650af9abb4b9f4c" title=" " alt="" coords="1619,709,1781,736"/>
<area shape="rect" href="lapic_8h.html#a07d3e1e4090a62753325dfa11d232cea" title=" " alt="" coords="1886,877,2029,904"/>
<area shape="rect" href="lapic_8c.html#a10d887046aaccb6cf4178421594dee10" title=" " alt="" coords="1631,541,1769,568"/>
<area shape="rect" href="lapic_8c.html#ab0bd88f2e9609cef51f64e40f0635c9d" title=" " alt="" coords="1903,461,2011,488"/>
<area shape="rect" href="lapic_8c.html#ad063ed2f42a913efa82bad52d1b58aa8" title=" " alt="" coords="1893,512,2022,539"/>
<area shape="rect" href="x86_8c.html#a09da0747db3b012bff918f94816f0bd0" title=" " alt="" coords="1894,563,2021,589"/>
<area shape="rect" href="smm_8h.html#adbee86ed847633616e1e3afcc7e98e6e" title=" " alt="" coords="1895,613,2020,640"/>
<area shape="rect" href="lapic_8h.html#ada4d7479e3c0f2e45cb1565dab78c198" title=" " alt="" coords="1869,664,2045,691"/>
<area shape="rect" href="lapic_8h.html#aecd6ca5347dbb81047584149b2291019" title=" " alt="" coords="1875,715,2039,741"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a0446c241eff9babb33e990edd1347b96_icgraph.png" border="0" usemap="#axen_8c_a0446c241eff9babb33e990edd1347b96_icgraph" alt=""/></div>
<map name="axen_8c_a0446c241eff9babb33e990edd1347b96_icgraph" id="axen_8c_a0446c241eff9babb33e990edd1347b96_icgraph">
<area shape="rect" title=" " alt="" coords="384,5,561,32"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a475f17b008ae9643247453de0018df17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a475f17b008ae9643247453de0018df17">&#9670;&nbsp;</a></span>kvm_xen_vcpu_set_attr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_vcpu_set_attr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_xen_vcpu_attr *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00736">736</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;{</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keywordtype">int</span> idx, r = -ENOENT;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    mutex_lock(&amp;vcpu-&gt;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    idx = srcu_read_lock(&amp;vcpu-&gt;kvm-&gt;srcu);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keywordflow">switch</span> (data-&gt;type) {</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_VCPU_INFO:</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="comment">/* No compat necessary here. */</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        BUILD_BUG_ON(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> vcpu_info) !=</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                 <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__info.html">compat_vcpu_info</a>));</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        BUILD_BUG_ON(offsetof(<span class="keyword">struct</span> vcpu_info, <a class="code" href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a>) !=</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                 offsetof(<span class="keyword">struct</span> <a class="code" href="structcompat__vcpu__info.html">compat_vcpu_info</a>, <a class="code" href="xen_8h.html#aae48202dcaab37c9a13a4b624014da49">time</a>));</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.gpa == KVM_XEN_INVALID_GPA) {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;vcpu-&gt;arch.xen.vcpu_info_cache);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            r = 0;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        r = <a class="code" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559">kvm_gpc_activate</a>(&amp;vcpu-&gt;arch.xen.vcpu_info_cache,</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                     data-&gt;u.gpa, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> vcpu_info));</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">if</span> (!r)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            kvm_make_request(KVM_REQ_CLOCK_UPDATE, vcpu);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_VCPU_TIME_INFO:</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.gpa == KVM_XEN_INVALID_GPA) {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;vcpu-&gt;arch.xen.vcpu_time_info_cache);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            r = 0;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        r = <a class="code" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559">kvm_gpc_activate</a>(&amp;vcpu-&gt;arch.xen.vcpu_time_info_cache,</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                     data-&gt;u.gpa,</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                     <span class="keyword">sizeof</span>(<span class="keyword">struct</span> pvclock_vcpu_time_info));</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordflow">if</span> (!r)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            kvm_make_request(KVM_REQ_CLOCK_UPDATE, vcpu);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_RUNSTATE_ADDR: {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordtype">size_t</span> sz, sz1, sz2;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <span class="keywordflow">if</span> (!sched_info_on()) {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            r = -EOPNOTSUPP;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.gpa == KVM_XEN_INVALID_GPA) {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            r = 0;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        deactivate_out:</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;vcpu-&gt;arch.xen.runstate_cache);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;vcpu-&gt;arch.xen.runstate2_cache);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160; </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">         * If the guest switches to 64-bit mode after setting the runstate</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">         * address, that&#39;s actually OK. kvm_xen_update_runstate_guest()</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">         * will cope.</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_64BIT) &amp;&amp; vcpu-&gt;kvm-&gt;arch.xen.long_mode)</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            sz = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>vcpu_runstate_info);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            sz = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structcompat__vcpu__runstate__info.html">compat_vcpu_runstate_info</a>);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="comment">/* How much fits in the (first) page? */</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        sz1 = PAGE_SIZE - (data-&gt;u.gpa &amp; ~PAGE_MASK);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        r = <a class="code" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559">kvm_gpc_activate</a>(&amp;vcpu-&gt;arch.xen.runstate_cache,</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                     data-&gt;u.gpa, sz1);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keywordflow">if</span> (r)</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="keywordflow">goto</span> deactivate_out;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="comment">/* Either map the second page, or deactivate the second GPC */</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keywordflow">if</span> (sz1 &gt;= sz) {</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <a class="code" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2">kvm_gpc_deactivate</a>(&amp;vcpu-&gt;arch.xen.runstate2_cache);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            sz2 = sz - sz1;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            BUG_ON((data-&gt;u.gpa + sz1) &amp; ~PAGE_MASK);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            r = <a class="code" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559">kvm_gpc_activate</a>(&amp;vcpu-&gt;arch.xen.runstate2_cache,</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                         data-&gt;u.gpa + sz1, sz2);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            <span class="keywordflow">if</span> (r)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                <span class="keywordflow">goto</span> deactivate_out;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <a class="code" href="xen_8c.html#ab6eefd0c967fad2f6ef73e77bc0dc50d">kvm_xen_update_runstate_guest</a>(vcpu, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_RUNSTATE_CURRENT:</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">if</span> (!sched_info_on()) {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            r = -EOPNOTSUPP;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.runstate.state &gt; RUNSTATE_offline) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <a class="code" href="xen_8c.html#a6acde067fc775eb22a4c49b5ca434963">kvm_xen_update_runstate</a>(vcpu, data-&gt;u.runstate.state);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        r = 0;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_RUNSTATE_DATA:</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="keywordflow">if</span> (!sched_info_on()) {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            r = -EOPNOTSUPP;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.runstate.state &gt; RUNSTATE_offline) {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        }</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.runstate.state_entry_time !=</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            (data-&gt;u.runstate.time_running +</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;             data-&gt;u.runstate.time_runnable +</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;             data-&gt;u.runstate.time_blocked +</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;             data-&gt;u.runstate.time_offline)) {</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2">get_kvmclock_ns</a>(vcpu-&gt;kvm) &lt;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            data-&gt;u.runstate.state_entry_time) {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        }</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160; </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        vcpu-&gt;arch.xen.current_runstate = data-&gt;u.runstate.state;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        vcpu-&gt;arch.xen.runstate_entry_time =</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            data-&gt;u.runstate.state_entry_time;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        vcpu-&gt;arch.xen.runstate_times[RUNSTATE_running] =</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            data-&gt;u.runstate.time_running;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        vcpu-&gt;arch.xen.runstate_times[RUNSTATE_runnable] =</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            data-&gt;u.runstate.time_runnable;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        vcpu-&gt;arch.xen.runstate_times[RUNSTATE_blocked] =</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            data-&gt;u.runstate.time_blocked;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        vcpu-&gt;arch.xen.runstate_times[RUNSTATE_offline] =</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            data-&gt;u.runstate.time_offline;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        vcpu-&gt;arch.xen.last_steal = current-&gt;sched_info.run_delay;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        r = 0;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_RUNSTATE_ADJUST:</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="keywordflow">if</span> (!sched_info_on()) {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            r = -EOPNOTSUPP;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.runstate.state &gt; RUNSTATE_offline &amp;&amp;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            data-&gt;u.runstate.state != (u64)-1) {</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="comment">/* The adjustment must add up */</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.runstate.state_entry_time !=</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            (data-&gt;u.runstate.time_running +</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;             data-&gt;u.runstate.time_runnable +</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;             data-&gt;u.runstate.time_blocked +</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;             data-&gt;u.runstate.time_offline)) {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        }</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2">get_kvmclock_ns</a>(vcpu-&gt;kvm) &lt;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            (vcpu-&gt;arch.xen.runstate_entry_time +</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;             data-&gt;u.runstate.state_entry_time)) {</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        vcpu-&gt;arch.xen.runstate_entry_time +=</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            data-&gt;u.runstate.state_entry_time;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        vcpu-&gt;arch.xen.runstate_times[RUNSTATE_running] +=</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            data-&gt;u.runstate.time_running;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        vcpu-&gt;arch.xen.runstate_times[RUNSTATE_runnable] +=</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            data-&gt;u.runstate.time_runnable;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        vcpu-&gt;arch.xen.runstate_times[RUNSTATE_blocked] +=</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            data-&gt;u.runstate.time_blocked;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        vcpu-&gt;arch.xen.runstate_times[RUNSTATE_offline] +=</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            data-&gt;u.runstate.time_offline;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160; </div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.runstate.state &lt;= RUNSTATE_offline)</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <a class="code" href="xen_8c.html#a6acde067fc775eb22a4c49b5ca434963">kvm_xen_update_runstate</a>(vcpu, data-&gt;u.runstate.state);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vcpu-&gt;arch.xen.runstate_cache.active)</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            <a class="code" href="xen_8c.html#ab6eefd0c967fad2f6ef73e77bc0dc50d">kvm_xen_update_runstate_guest</a>(vcpu, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        r = 0;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_VCPU_ID:</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.vcpu_id &gt;= KVM_MAX_VCPUS)</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            vcpu-&gt;arch.xen.vcpu_id = data-&gt;u.vcpu_id;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            r = 0;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_TIMER:</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.timer.port &amp;&amp;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            data-&gt;u.timer.priority != KVM_IRQ_ROUTING_XEN_EVTCHN_PRIO_2LEVEL) {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        }</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160; </div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="keywordflow">if</span> (!vcpu-&gt;arch.xen.timer.function)</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <a class="code" href="xen_8c.html#aac3b8d94d9d44e46e1b03789bbcbd3a3">kvm_xen_init_timer</a>(vcpu);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="comment">/* Stop the timer (if it&#39;s running) before changing the vector */</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <a class="code" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2">kvm_xen_stop_timer</a>(vcpu);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        vcpu-&gt;arch.xen.timer_virq = data-&gt;u.timer.port;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="comment">/* Start the timer if the new value has a valid vector+expiry. */</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.timer.port &amp;&amp; data-&gt;u.timer.expires_ns)</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            <a class="code" href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459">kvm_xen_start_timer</a>(vcpu, data-&gt;u.timer.expires_ns,</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                        data-&gt;u.timer.expires_ns -</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                        <a class="code" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2">get_kvmclock_ns</a>(vcpu-&gt;kvm));</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        r = 0;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keywordflow">case</span> KVM_XEN_VCPU_ATTR_TYPE_UPCALL_VECTOR:</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">if</span> (data-&gt;u.vector &amp;&amp; data-&gt;u.vector &lt; 0x10)</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            r = -EINVAL;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            vcpu-&gt;arch.xen.upcall_vector = data-&gt;u.vector;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            r = 0;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    srcu_read_unlock(&amp;vcpu-&gt;kvm-&gt;srcu, idx);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    mutex_unlock(&amp;vcpu-&gt;kvm-&gt;arch.xen.xen_lock);</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;}</div>
<div class="ttc" id="axen_8c_html_a6acde067fc775eb22a4c49b5ca434963"><div class="ttname"><a href="xen_8c.html#a6acde067fc775eb22a4c49b5ca434963">kvm_xen_update_runstate</a></div><div class="ttdeci">void kvm_xen_update_runstate(struct kvm_vcpu *v, int state)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00465">xen.c:465</a></div></div>
<div class="ttc" id="axen_8c_html_aac3b8d94d9d44e46e1b03789bbcbd3a3"><div class="ttname"><a href="xen_8c.html#aac3b8d94d9d44e46e1b03789bbcbd3a3">kvm_xen_init_timer</a></div><div class="ttdeci">static void kvm_xen_init_timer(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8c_source.html#l00191">xen.c:191</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a475f17b008ae9643247453de0018df17_cgraph.png" border="0" usemap="#axen_8c_a475f17b008ae9643247453de0018df17_cgraph" alt=""/></div>
<map name="axen_8c_a475f17b008ae9643247453de0018df17_cgraph" id="axen_8c_a475f17b008ae9643247453de0018df17_cgraph">
<area shape="rect" title=" " alt="" coords="5,257,181,284"/>
<area shape="rect" href="x86_8c.html#abd4913c1a5c4c66a089ccadc445cd9a2" title=" " alt="" coords="502,80,637,107"/>
<area shape="rect" href="pfncache_8c.html#ae773cab9370378e6751f76cb0abc8559" title=" " alt="" coords="735,224,877,251"/>
<area shape="rect" href="pfncache_8c.html#a028c789975722f39987f72cf8340f9d2" title=" " alt="" coords="491,304,648,331"/>
<area shape="rect" href="xen_8c.html#aac3b8d94d9d44e46e1b03789bbcbd3a3" title=" " alt="" coords="251,333,402,360"/>
<area shape="rect" href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459" title=" " alt="" coords="247,384,407,411"/>
<area shape="rect" href="xen_8c.html#a3e98609584a6375fe160f81dfafbf2f2" title=" " alt="" coords="247,435,406,461"/>
<area shape="rect" href="xen_8c.html#a6acde067fc775eb22a4c49b5ca434963" title=" " alt="" coords="229,131,424,157"/>
<area shape="rect" href="xen_8c.html#ab6eefd0c967fad2f6ef73e77bc0dc50d" title=" " alt="" coords="472,166,667,207"/>
<area shape="rect" href="x86_8c.html#a860bfcc41711ba017de704d71fe362a1" title=" " alt="" coords="749,64,863,91"/>
<area shape="rect" href="x86_8c.html#a5fb8061b510d35a89dc02d72eba913fc" title=" " alt="" coords="969,60,1095,87"/>
<area shape="rect" href="x86_8c.html#ada3ebfd54ed70054113191d6575e5a71" title=" " alt="" coords="1198,107,1327,133"/>
<area shape="rect" href="x86_8c.html#abb79b4397b27e4e42529a46cccbad62c" title=" " alt="" coords="1176,5,1349,32"/>
<area shape="rect" href="x86_8c.html#aa540b8d63c340bf4bad96578dfe9c329" title=" " alt="" coords="1184,56,1341,83"/>
<area shape="rect" href="x86_8c.html#a7c2c90d8aa6d48b108bbbe630d120f95" title=" " alt="" coords="1457,56,1532,83"/>
<area shape="rect" href="pfncache_8c.html#ad89a0151985747829394713298d1ff88" title=" " alt="" coords="958,157,1106,184"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="1183,157,1342,184"/>
<area shape="rect" href="pfncache_8c.html#a55707e7c42672e24bcc37f1571f8f697" title=" " alt="" coords="1427,325,1563,352"/>
<area shape="rect" href="pfncache_8c.html#a3f895e1277e3e92c84724776f73424f5" title=" " alt="" coords="1197,224,1329,251"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1425,107,1564,133"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1656,47,1808,73"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1892,47,2055,73"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="1447,224,1542,251"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="1407,275,1583,301"/>
<area shape="rect" href="pfncache_8c.html#a83f3cb45d6ce928dec21c73f488d9101" title=" " alt="" coords="1421,158,1568,199"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="1631,199,1833,225"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="1669,300,1795,327"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="1649,249,1815,276"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="1667,97,1797,124"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="1678,148,1786,175"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="1907,275,2039,301"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="2113,313,2328,340"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="2376,313,2572,340"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="1639,401,1825,428"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="1881,401,2065,428"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="2127,401,2314,428"/>
<area shape="rect" href="xen_8c.html#a4017950790585b6ba8d51d7b8bb2d5f7" title=" " alt="" coords="495,359,643,385"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="743,173,869,200"/>
<area shape="rect" href="pfncache_8c.html#a95f177f84574a53b04762338d48238fe" title=" " alt="" coords="739,123,873,149"/>
<area shape="rect" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15" title=" " alt="" coords="715,275,897,301"/>
<area shape="rect" href="dirty__ring_8c.html#ac1878b63f1f337e93cf186ebd4fffcc4" title=" " alt="" coords="946,209,1118,250"/>
<area shape="rect" href="dirty__ring_8c.html#a81ebbf462440ed5392d6d3412a859ae7" title=" " alt="" coords="953,401,1111,428"/>
<area shape="rect" href="kvm__main_8c.html#ac5a3afd8e2d8d1139dc7711c4b9e07e3" title=" " alt="" coords="945,275,1119,301"/>
<area shape="rect" href="dirty__ring_8c.html#ad6e626257c739b2ac3d397119a7cf798" title=" " alt="" coords="1167,376,1359,403"/>
<area shape="rect" href="dirty__ring_8c.html#a6fe5cd75b9bac6497e1ae7340f2a5f7b" title=" " alt="" coords="1189,427,1337,453"/>
<area shape="rect" href="dirty__ring_8c.html#a22c9a239acf3463a8599a21c0a756538" title=" " alt="" coords="1173,477,1352,504"/>
<area shape="rect" href="dirty__ring_8c.html#acd0a1e586324b4c49b429c7a392db73f" title=" " alt="" coords="1415,452,1574,479"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a475f17b008ae9643247453de0018df17_icgraph.png" border="0" usemap="#axen_8c_a475f17b008ae9643247453de0018df17_icgraph" alt=""/></div>
<map name="axen_8c_a475f17b008ae9643247453de0018df17_icgraph" id="axen_8c_a475f17b008ae9643247453de0018df17_icgraph">
<area shape="rect" title=" " alt="" coords="384,5,560,32"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a8ee930b1f9fc4736a86b12bf73d43f74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ee930b1f9fc4736a86b12bf73d43f74">&#9670;&nbsp;</a></span>kvm_xen_write_hypercall_page()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_xen_write_hypercall_page </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01090">1090</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;{</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    u32 page_num = data &amp; ~PAGE_MASK;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    u64 page_addr = data &amp; PAGE_MASK;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keywordtype">bool</span> lm = <a class="code" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d">is_long_mode</a>(vcpu);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">/* Latch long_mode for shared_info pages etc. */</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    vcpu-&gt;kvm-&gt;arch.xen.long_mode = lm;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160; </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">     * If Xen hypercall intercept is enabled, fill the hypercall</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">     * page with VMCALL/VMMCALL instructions since that&#39;s what</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">     * we catch. Else the VMM has provided the hypercall pages</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">     * with instructions of its own choosing, so use those.</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="xen_8h.html#a0fe74f156a7da98cd1be3a1e762a00d7">kvm_xen_hypercall_enabled</a>(kvm)) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        u8 instructions[32];</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <span class="keywordflow">if</span> (page_num)</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="comment">/* mov imm32, %eax */</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        instructions[0] = 0xb8;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <span class="comment">/* vmcall / vmmcall */</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        static_call(kvm_x86_patch_hypercall)(vcpu, instructions + 5);</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <span class="comment">/* ret */</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        instructions[8] = 0xc3;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        <span class="comment">/* int3 to pad */</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        memset(instructions + 9, 0xcc, <span class="keyword">sizeof</span>(instructions) - 9);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; PAGE_SIZE / <span class="keyword">sizeof</span>(instructions); i++) {</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            *(u32 *)&amp;instructions[1] = i;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="kvm__main_8c.html#aff9f069d82daf13f02f262eaf6a23ca5">kvm_vcpu_write_guest</a>(vcpu,</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                         page_addr + (i * <span class="keyword">sizeof</span>(instructions)),</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                         instructions, <span class="keyword">sizeof</span>(instructions)))</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        }</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">         * Note, truncation is a non-issue as &#39;lm&#39; is guaranteed to be</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">         * false for a 32-bit kernel, i.e. when hva_t is only 4 bytes.</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        hva_t blob_addr = lm ? kvm-&gt;arch.xen_hvm_config.blob_addr_64</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                     : kvm-&gt;arch.xen_hvm_config.blob_addr_32;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        u8 blob_size = lm ? kvm-&gt;arch.xen_hvm_config.blob_size_64</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                  : kvm-&gt;arch.xen_hvm_config.blob_size_32;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        u8 *page;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keywordflow">if</span> (page_num &gt;= blob_size)</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160; </div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        blob_addr += page_num * PAGE_SIZE;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        page = memdup_user((u8 __user *)blob_addr, PAGE_SIZE);</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keywordflow">if</span> (IS_ERR(page))</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            <span class="keywordflow">return</span> PTR_ERR(page);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160; </div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        ret = <a class="code" href="kvm__main_8c.html#aff9f069d82daf13f02f262eaf6a23ca5">kvm_vcpu_write_guest</a>(vcpu, page_addr, page, PAGE_SIZE);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        kfree(page);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_aff9f069d82daf13f02f262eaf6a23ca5"><div class="ttname"><a href="kvm__main_8c.html#aff9f069d82daf13f02f262eaf6a23ca5">kvm_vcpu_write_guest</a></div><div class="ttdeci">int kvm_vcpu_write_guest(struct kvm_vcpu *vcpu, gpa_t gpa, const void *data, unsigned long len)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03470">kvm_main.c:3470</a></div></div>
<div class="ttc" id="ax86_8h_html_aad3ee550e50892e0e340061479bb284d"><div class="ttname"><a href="x86_8h.html#aad3ee550e50892e0e340061479bb284d">is_long_mode</a></div><div class="ttdeci">static bool is_long_mode(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="x86_8h_source.html#l00143">x86.h:143</a></div></div>
<div class="ttc" id="axen_8h_html_a0fe74f156a7da98cd1be3a1e762a00d7"><div class="ttname"><a href="xen_8h.html#a0fe74f156a7da98cd1be3a1e762a00d7">kvm_xen_hypercall_enabled</a></div><div class="ttdeci">static bool kvm_xen_hypercall_enabled(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00127">xen.h:127</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a8ee930b1f9fc4736a86b12bf73d43f74_cgraph.png" border="0" usemap="#axen_8c_a8ee930b1f9fc4736a86b12bf73d43f74_cgraph" alt=""/></div>
<map name="axen_8c_a8ee930b1f9fc4736a86b12bf73d43f74_cgraph" id="axen_8c_a8ee930b1f9fc4736a86b12bf73d43f74_cgraph">
<area shape="rect" title=" " alt="" coords="5,109,232,136"/>
<area shape="rect" href="x86_8h.html#aad3ee550e50892e0e340061479bb284d" title=" " alt="" coords="327,59,439,85"/>
<area shape="rect" href="kvm__main_8c.html#aff9f069d82daf13f02f262eaf6a23ca5" title=" " alt="" coords="297,109,469,136"/>
<area shape="rect" href="xen_8h.html#a0fe74f156a7da98cd1be3a1e762a00d7" title=" " alt="" coords="280,160,487,187"/>
<area shape="rect" href="kvm__main_8c.html#a11bfd7eb429f6121f6999a8a404eac33" title=" " alt="" coords="535,84,745,111"/>
<area shape="rect" href="kvm__main_8c.html#a03aae88de564edba8a3a2d10bc5e7b20" title=" " alt="" coords="583,135,697,161"/>
<area shape="rect" href="kvm__main_8c.html#a7079b0256c7572c701a6e1526f58fdac" title=" " alt="" coords="801,59,988,85"/>
<area shape="rect" href="kvm__main_8c.html#ac4b56de4919be80c9cd4289f20437c64" title=" " alt="" coords="793,109,996,136"/>
<area shape="rect" href="kvm__main_8c.html#a04c9651c5f9a0485fd1e7152bdb01353" title=" " alt="" coords="1056,24,1215,51"/>
<area shape="rect" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15" title=" " alt="" coords="1044,93,1227,120"/>
<area shape="rect" href="kvm__main_8c.html#ae374ebe48072080788db56075dd9a762" title=" " alt="" coords="1292,5,1431,32"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="1516,5,1668,32"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="1736,5,1899,32"/>
<area shape="rect" href="dirty__ring_8c.html#ac1878b63f1f337e93cf186ebd4fffcc4" title=" " alt="" coords="1275,57,1447,98"/>
<area shape="rect" href="dirty__ring_8c.html#a81ebbf462440ed5392d6d3412a859ae7" title=" " alt="" coords="1282,123,1441,149"/>
<area shape="rect" href="kvm__main_8c.html#ac5a3afd8e2d8d1139dc7711c4b9e07e3" title=" " alt="" coords="1275,173,1448,200"/>
<area shape="rect" href="dirty__ring_8c.html#ad6e626257c739b2ac3d397119a7cf798" title=" " alt="" coords="1496,72,1688,99"/>
<area shape="rect" href="dirty__ring_8c.html#a6fe5cd75b9bac6497e1ae7340f2a5f7b" title=" " alt="" coords="1518,123,1666,149"/>
<area shape="rect" href="dirty__ring_8c.html#a22c9a239acf3463a8599a21c0a756538" title=" " alt="" coords="1503,173,1681,200"/>
<area shape="rect" href="dirty__ring_8c.html#acd0a1e586324b4c49b429c7a392db73f" title=" " alt="" coords="1738,148,1897,175"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a8ee930b1f9fc4736a86b12bf73d43f74_icgraph.png" border="0" usemap="#axen_8c_a8ee930b1f9fc4736a86b12bf73d43f74_icgraph" alt=""/></div>
<map name="axen_8c_a8ee930b1f9fc4736a86b12bf73d43f74_icgraph" id="axen_8c_a8ee930b1f9fc4736a86b12bf73d43f74_icgraph">
<area shape="rect" title=" " alt="" coords="387,56,613,83"/>
<area shape="rect" href="x86_8c.html#aec2b7dd73668f030b4e2f8d8815d7299" title=" " alt="" coords="164,56,339,83"/>
<area shape="rect" href="svm_8c.html#acb46126747f78036462437a7bcdc2e47" title=" " alt="" coords="20,5,101,32"/>
<area shape="rect" href="svm_8c.html#aac18b9094154a2c8b8e27c3b08c9e359" title=" " alt="" coords="6,56,115,83"/>
<area shape="rect" href="vmx_8c.html#a0fb610ce041405729e4296dfc871c30e" title=" " alt="" coords="5,107,116,133"/>
</map>
</div>

</div>
</div>
<a id="abfe301f067b5181a7028ad5e62629e6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfe301f067b5181a7028ad5e62629e6d">&#9670;&nbsp;</a></span>max_evtchn_port()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int max_evtchn_port </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01215">1215</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;{</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_64BIT) &amp;&amp; kvm-&gt;arch.xen.long_mode)</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="keywordflow">return</span> EVTCHN_2L_NR_CHANNELS;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="xen_8h.html#aa3f84f197e4eb465bbe0fced6624ea02">COMPAT_EVTCHN_2L_NR_CHANNELS</a>;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;}</div>
<div class="ttc" id="axen_8h_html_aa3f84f197e4eb465bbe0fced6624ea02"><div class="ttname"><a href="xen_8h.html#aa3f84f197e4eb465bbe0fced6624ea02">COMPAT_EVTCHN_2L_NR_CHANNELS</a></div><div class="ttdeci">#define COMPAT_EVTCHN_2L_NR_CHANNELS</div><div class="ttdef"><b>Definition:</b> <a href="xen_8h_source.html#l00226">xen.h:226</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_abfe301f067b5181a7028ad5e62629e6d_icgraph.png" border="0" usemap="#axen_8c_abfe301f067b5181a7028ad5e62629e6d_icgraph" alt=""/></div>
<map name="axen_8c_abfe301f067b5181a7028ad5e62629e6d_icgraph" id="axen_8c_abfe301f067b5181a7028ad5e62629e6d_icgraph">
<area shape="rect" title=" " alt="" coords="2309,132,2444,159"/>
<area shape="rect" href="xen_8c.html#af22ffcd81793c28d8f1952ed94e0d051" title=" " alt="" coords="2073,56,2259,83"/>
<area shape="rect" href="xen_8c.html#a2c5ff8f2966ec21633bf34f39f981d3c" title=" " alt="" coords="1831,5,2013,32"/>
<area shape="rect" href="xen_8c.html#a952a322aa5cce4d0bd3fe372d820de13" title=" " alt="" coords="1566,56,1773,83"/>
<area shape="rect" href="xen_8c.html#a4bcdab8c7d597fa93d30ff9e9185cbc6" title=" " alt="" coords="2079,309,2253,336"/>
<area shape="rect" href="xen_8c.html#a48738df3c98025631e2412d90758136c" title=" " alt="" coords="2071,157,2261,184"/>
<area shape="rect" href="xen_8c.html#a508e4ef7a5f613f8e7daf8a633ae8ee5" title=" " alt="" coords="1341,259,1516,285"/>
<area shape="rect" href="xen_8c.html#a97a02cd2ae7319635c2de6370b82cb1b" title=" " alt="" coords="1582,5,1757,32"/>
<area shape="rect" href="x86_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="1354,23,1503,49"/>
<area shape="rect" href="xen_8c.html#ab8910a0f422594766001b1c5a5f59e6e" title=" " alt="" coords="1869,309,1975,336"/>
<area shape="rect" href="irq__comm_8c.html#ae7b7837b6e17bc60af3f4d81e9a4147e" title=" " alt="" coords="1821,208,2023,235"/>
<area shape="rect" href="xen_8c.html#a59091fb436633f85ba3e28187f5794d0" title=" " alt="" coords="1843,157,2001,184"/>
<area shape="rect" href="xen_8c.html#a7432a92fb771aeb9f60ca4d89c10f15b" title=" " alt="" coords="1613,208,1726,235"/>
<area shape="rect" href="xen_8c.html#a42cb09290dc39689baca95686be1ff69" title=" " alt="" coords="1565,107,1773,133"/>
<area shape="rect" href="xen_8c.html#ab30962c07569543c2879269c4ec40d70" title=" " alt="" coords="1571,157,1768,184"/>
<area shape="rect" href="irq__comm_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1117,259,1289,285"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="896,259,1048,285"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="676,259,831,285"/>
<area shape="rect" href="irq_8h.html#aaf23e09ccf4b445556e56ea8598e1311" title=" " alt="" coords="461,251,628,293"/>
<area shape="rect" href="x86_8c.html#aaf3dbbe842e06195f2e46694ea837380" title=" " alt="" coords="219,259,413,285"/>
<area shape="rect" href="kvm__main_8c.html#aaeec02d207c8ce5ca12b1ef2ac36fae0" title=" " alt="" coords="5,251,171,293"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="1355,91,1503,117"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="1113,91,1292,117"/>
<area shape="rect" href="irq_8c.html#a2d54275d9e142ae8e337298689483728" title=" " alt="" coords="1352,142,1505,183"/>
<area shape="rect" href="xen_8c.html#a0446c241eff9babb33e990edd1347b96" title=" " alt="" coords="1340,208,1517,235"/>
<area shape="rect" href="x86_8c.html#ae90d8433a234fc6ee73cd19322f11ada" title=" " alt="" coords="1162,153,1243,180"/>
<area shape="rect" href="x86_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="879,153,1065,180"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="691,179,815,205"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="893,204,1051,231"/>
</map>
</div>

</div>
</div>
<a id="acc36c59baef58a2af910272a8dd3e923"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc36c59baef58a2af910272a8dd3e923">&#9670;&nbsp;</a></span>wait_pending_event()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool wait_pending_event </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nr_ports</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">evtchn_port_t *&#160;</td>
          <td class="paramname"><em>ports</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l01223">1223</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;{</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keyword">struct </span>gfn_to_pfn_cache *gpc = &amp;kvm-&gt;arch.xen.shinfo_cache;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *pending_bits;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="keywordtype">int</span> idx, i;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160; </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    idx = srcu_read_lock(&amp;kvm-&gt;srcu);</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    read_lock_irqsave(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d">kvm_gpc_check</a>(gpc, PAGE_SIZE))</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keywordflow">goto</span> out_rcu;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160; </div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    ret = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordflow">if</span> (IS_ENABLED(CONFIG_64BIT) &amp;&amp; kvm-&gt;arch.xen.long_mode) {</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="keyword">struct </span>shared_info *shinfo = gpc-&gt;khva;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        pending_bits = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;shinfo-&gt;evtchn_pending;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keyword">struct </span><a class="code" href="structcompat__shared__info.html">compat_shared_info</a> *shinfo = gpc-&gt;khva;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        pending_bits = (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;shinfo-&gt;<a class="code" href="structcompat__shared__info.html#a0409369064685dd9e5fce85f46451d1f">evtchn_pending</a>;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; nr_ports; i++) {</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        <span class="keywordflow">if</span> (test_bit(ports[i], pending_bits)) {</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;            ret = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        }</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    }</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160; </div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160; out_rcu:</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    read_unlock_irqrestore(&amp;gpc-&gt;lock, <a class="code" href="xen_8c.html#a773b39d480759f67926cb18ae2219281">flags</a>);</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    srcu_read_unlock(&amp;kvm-&gt;srcu, idx);</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160; </div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_acc36c59baef58a2af910272a8dd3e923_cgraph.png" border="0" usemap="#axen_8c_acc36c59baef58a2af910272a8dd3e923_cgraph" alt=""/></div>
<map name="axen_8c_acc36c59baef58a2af910272a8dd3e923_cgraph" id="axen_8c_acc36c59baef58a2af910272a8dd3e923_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,159,32"/>
<area shape="rect" href="pfncache_8c.html#a8fbb2514a5bf34fb8640c09e6e01294d" title=" " alt="" coords="207,5,333,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_acc36c59baef58a2af910272a8dd3e923_icgraph.png" border="0" usemap="#axen_8c_acc36c59baef58a2af910272a8dd3e923_icgraph" alt=""/></div>
<map name="axen_8c_acc36c59baef58a2af910272a8dd3e923_icgraph" id="axen_8c_acc36c59baef58a2af910272a8dd3e923_icgraph">
<area shape="rect" title=" " alt="" coords="381,5,535,32"/>
<area shape="rect" href="xen_8c.html#a4bcdab8c7d597fa93d30ff9e9185cbc6" title=" " alt="" coords="160,5,333,32"/>
<area shape="rect" href="xen_8c.html#ab8910a0f422594766001b1c5a5f59e6e" title=" " alt="" coords="5,5,112,32"/>
</map>
</div>

</div>
</div>
<a id="a4017950790585b6ba8d51d7b8bb2d5f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4017950790585b6ba8d51d7b8bb2d5f7">&#9670;&nbsp;</a></span>xen_timer_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum hrtimer_restart xen_timer_callback </td>
          <td>(</td>
          <td class="paramtype">struct hrtimer *&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00116">116</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = container_of(timer, <span class="keyword">struct</span> kvm_vcpu,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                         arch.xen.timer);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keyword">struct </span>kvm_xen_evtchn e;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordtype">int</span> rc;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> (atomic_read(&amp;vcpu-&gt;arch.xen.timer_pending))</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">return</span> HRTIMER_NORESTART;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    e.vcpu_id = vcpu-&gt;vcpu_id;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    e.vcpu_idx = vcpu-&gt;vcpu_idx;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    e.port = vcpu-&gt;arch.xen.timer_virq;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    e.priority = KVM_IRQ_ROUTING_XEN_EVTCHN_PRIO_2LEVEL;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    rc = <a class="code" href="xen_8c.html#a48738df3c98025631e2412d90758136c">kvm_xen_set_evtchn_fast</a>(&amp;e, vcpu-&gt;kvm);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span> (rc != -EWOULDBLOCK) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        vcpu-&gt;arch.xen.timer_expires = 0;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">return</span> HRTIMER_NORESTART;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    atomic_inc(&amp;vcpu-&gt;arch.xen.timer_pending);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    kvm_make_request(KVM_REQ_UNBLOCK, vcpu);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44">kvm_vcpu_kick</a>(vcpu);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">return</span> HRTIMER_NORESTART;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="xen_8c_a4017950790585b6ba8d51d7b8bb2d5f7_icgraph.png" border="0" usemap="#axen_8c_a4017950790585b6ba8d51d7b8bb2d5f7_icgraph" alt=""/></div>
<map name="axen_8c_a4017950790585b6ba8d51d7b8bb2d5f7_icgraph" id="axen_8c_a4017950790585b6ba8d51d7b8bb2d5f7_icgraph">
<area shape="rect" title=" " alt="" coords="905,31,1053,57"/>
<area shape="rect" href="xen_8c.html#aac3b8d94d9d44e46e1b03789bbcbd3a3" title=" " alt="" coords="702,5,853,32"/>
<area shape="rect" href="xen_8c.html#a0187b2f16608bbdf5525ad8c8e882459" title=" " alt="" coords="697,56,857,83"/>
<area shape="rect" href="xen_8c.html#a475f17b008ae9643247453de0018df17" title=" " alt="" coords="456,5,632,32"/>
<area shape="rect" href="x86_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="232,5,391,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="33,5,157,32"/>
<area shape="rect" href="xen_8c.html#aee859a411f74e3aa2dd986c561eb72dc" title=" " alt="" coords="439,56,649,83"/>
<area shape="rect" href="xen_8c.html#a770531539245dce08f6187702354032c" title=" " alt="" coords="454,107,634,133"/>
<area shape="rect" href="xen_8c.html#aaf398a8803a79984b06fbf9e2a64193c" title=" " alt="" coords="237,81,385,108"/>
<area shape="rect" href="x86_8c.html#abc413db5ba414fb0a89e7ffc1fb81e60" title=" " alt="" coords="5,81,184,108"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a1bf9c69aa77adb5d6380d44f7d33daaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bf9c69aa77adb5d6380d44f7d33daaf">&#9670;&nbsp;</a></span>__attribute__</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structevtchnfd.html">evtchnfd</a> __attribute__</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a773b39d480759f67926cb18ae2219281"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a773b39d480759f67926cb18ae2219281">&#9670;&nbsp;</a></span>flags</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t flags</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00001">1</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>

</div>
</div>
<a id="a2091e51764159d2bda5738c2a1f2382a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2091e51764159d2bda5738c2a1f2382a">&#9670;&nbsp;</a></span>timeout_abs_ns</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t timeout_abs_ns</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="xen_8c_source.html#l00000">0</a> of file <a class="el" href="xen_8c_source.html">xen.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
