<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/arm64/kvm/mmu.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_67a9e021ce8db5d46236c6154ee454bc.html">arm64</a></li><li class="navelem"><a class="el" href="dir_42f87ef63ac4150166bf7887f68288e2.html">kvm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mmu.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/mman.h&gt;</code><br />
<code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &lt;linux/io.h&gt;</code><br />
<code>#include &lt;linux/hugetlb.h&gt;</code><br />
<code>#include &lt;linux/sched/signal.h&gt;</code><br />
<code>#include &lt;trace/events/kvm.h&gt;</code><br />
<code>#include &lt;asm/pgalloc.h&gt;</code><br />
<code>#include &lt;asm/cacheflush.h&gt;</code><br />
<code>#include &lt;asm/kvm_arm.h&gt;</code><br />
<code>#include &lt;asm/kvm_mmu.h&gt;</code><br />
<code>#include &lt;asm/kvm_pgtable.h&gt;</code><br />
<code>#include &lt;asm/kvm_ras.h&gt;</code><br />
<code>#include &lt;asm/kvm_asm.h&gt;</code><br />
<code>#include &lt;asm/kvm_emulate.h&gt;</code><br />
<code>#include &lt;asm/virt.h&gt;</code><br />
<code>#include &quot;<a class="el" href="trace_8h_source.html">trace.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for mmu.c:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c__incl.png" border="0" usemap="#aarch_2arm64_2kvm_2mmu_8c" alt=""/></div>
<map name="aarch_2arm64_2kvm_2mmu_8c" id="aarch_2arm64_2kvm_2mmu_8c">
<area shape="rect" title=" " alt="" coords="1091,5,1269,32"/>
<area shape="rect" title=" " alt="" coords="5,80,117,107"/>
<area shape="rect" title=" " alt="" coords="142,80,277,107"/>
<area shape="rect" title=" " alt="" coords="301,80,384,107"/>
<area shape="rect" title=" " alt="" coords="409,80,527,107"/>
<area shape="rect" title=" " alt="" coords="551,80,702,107"/>
<area shape="rect" title=" " alt="" coords="726,80,874,107"/>
<area shape="rect" title=" " alt="" coords="898,80,1011,107"/>
<area shape="rect" title=" " alt="" coords="1035,80,1170,107"/>
<area shape="rect" title=" " alt="" coords="1195,80,1323,107"/>
<area shape="rect" title=" " alt="" coords="1347,80,1483,107"/>
<area shape="rect" title=" " alt="" coords="1507,80,1658,107"/>
<area shape="rect" title=" " alt="" coords="1683,80,1805,107"/>
<area shape="rect" title=" " alt="" coords="1829,80,1960,107"/>
<area shape="rect" title=" " alt="" coords="1807,229,1963,256"/>
<area shape="rect" title=" " alt="" coords="2135,80,2223,107"/>
<area shape="rect" href="trace_8h.html" title=" " alt="" coords="2044,80,2111,107"/>
<area shape="rect" href="trace__arm_8h.html" title=" " alt="" coords="2035,155,2135,181"/>
<area shape="rect" href="trace__handle__exit_8h.html" title=" " alt="" coords="2258,155,2409,181"/>
<area shape="rect" title=" " alt="" coords="1987,229,2157,256"/>
<area shape="rect" title=" " alt="" coords="2181,229,2317,256"/>
<area shape="rect" title=" " alt="" coords="2342,229,2493,256"/>
<area shape="rect" href="sys__regs_8h.html" title=" " alt="" coords="2517,229,2608,256"/>
<area shape="rect" title=" " alt="" coords="2502,304,2623,331"/>
</map>
</div>
</div>
<p><a href="mmu_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structhyp__shared__pfn.html">hyp_shared_pfn</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3b511994c3e3ccd15f989fc7dd2653bd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a3b511994c3e3ccd15f989fc7dd2653bd">stage2_apply_range_resched</a>(mmu,  addr,  <a class="el" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>,  fn)&#160;&#160;&#160;	<a class="el" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6">stage2_apply_range</a>(mmu, addr, <a class="el" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, fn, true)</td></tr>
<tr class="separator:a3b511994c3e3ccd15f989fc7dd2653bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3b155a051326c0f7ffc7927f1bfbd35b"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a3b155a051326c0f7ffc7927f1bfbd35b">DEFINE_MUTEX</a> (kvm_hyp_pgd_mutex)</td></tr>
<tr class="separator:a3b155a051326c0f7ffc7927f1bfbd35b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a877e9a15c18a09d43fa73c90949caaa2"><td class="memItemLeft" align="right" valign="top">static phys_addr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2">__stage2_range_addr_end</a> (phys_addr_t addr, phys_addr_t <a class="el" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, phys_addr_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</td></tr>
<tr class="separator:a877e9a15c18a09d43fa73c90949caaa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f5d4fce669004cefa084be2a096c366"><td class="memItemLeft" align="right" valign="top">static phys_addr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366">stage2_range_addr_end</a> (phys_addr_t addr, phys_addr_t <a class="el" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>)</td></tr>
<tr class="separator:a6f5d4fce669004cefa084be2a096c366"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98bf34ceab6b426d1ac6d1a9e8f0b6e6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6">stage2_apply_range</a> (struct kvm_s2_mmu *mmu, phys_addr_t addr, phys_addr_t <a class="el" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, int(*fn)(struct kvm_pgtable *, u64, u64), bool resched)</td></tr>
<tr class="separator:a98bf34ceab6b426d1ac6d1a9e8f0b6e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62047c119e6707e0579424df7ab7bd77"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a62047c119e6707e0579424df7ab7bd77">kvm_mmu_split_nr_page_tables</a> (u64 range)</td></tr>
<tr class="separator:a62047c119e6707e0579424df7ab7bd77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfda6046e28c6dfc58730ef92bee6f3a"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#abfda6046e28c6dfc58730ef92bee6f3a">need_split_memcache_topup_or_resched</a> (struct kvm *kvm)</td></tr>
<tr class="separator:abfda6046e28c6dfc58730ef92bee6f3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf6f75ecf7d564f9aa7b446e6a236d2d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d">kvm_mmu_split_huge_pages</a> (struct kvm *kvm, phys_addr_t addr, phys_addr_t <a class="el" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>)</td></tr>
<tr class="separator:adf6f75ecf7d564f9aa7b446e6a236d2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae621c40a28e874f5d7bdb502c2dec724"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ae621c40a28e874f5d7bdb502c2dec724">memslot_is_logging</a> (struct kvm_memory_slot *memslot)</td></tr>
<tr class="separator:ae621c40a28e874f5d7bdb502c2dec724"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeef4d107a4492fde01f361171f3e36d5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#aeef4d107a4492fde01f361171f3e36d5">kvm_arch_flush_remote_tlbs</a> (struct kvm *kvm)</td></tr>
<tr class="separator:aeef4d107a4492fde01f361171f3e36d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21f706511628b7801b6daf25c927f28a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a21f706511628b7801b6daf25c927f28a">kvm_arch_flush_remote_tlbs_range</a> (struct kvm *kvm, gfn_t gfn, u64 nr_pages)</td></tr>
<tr class="separator:a21f706511628b7801b6daf25c927f28a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a207285372ad7944209b485ecfc10ee0f"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a207285372ad7944209b485ecfc10ee0f">kvm_is_device_pfn</a> (unsigned long pfn)</td></tr>
<tr class="separator:a207285372ad7944209b485ecfc10ee0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a007ad372dce7c2fa90ca652d5ef7ac01"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a007ad372dce7c2fa90ca652d5ef7ac01">stage2_memcache_zalloc_page</a> (void *arg)</td></tr>
<tr class="separator:a007ad372dce7c2fa90ca652d5ef7ac01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae792e5a1690d87277dc72552467b205e"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ae792e5a1690d87277dc72552467b205e">kvm_host_zalloc_pages_exact</a> (size_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</td></tr>
<tr class="separator:ae792e5a1690d87277dc72552467b205e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaaa2b0d256c20dcfcfae2767ce907846"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#aaaa2b0d256c20dcfcfae2767ce907846">kvm_s2_zalloc_pages_exact</a> (size_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</td></tr>
<tr class="separator:aaaa2b0d256c20dcfcfae2767ce907846"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad02e9dab83b5eeee68e5e9f558344be7"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ad02e9dab83b5eeee68e5e9f558344be7">kvm_s2_free_pages_exact</a> (void *virt, size_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</td></tr>
<tr class="separator:ad02e9dab83b5eeee68e5e9f558344be7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fae9a03ca40ca0fecad7a963d06242f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a9fae9a03ca40ca0fecad7a963d06242f">stage2_free_unlinked_table_rcu_cb</a> (struct rcu_head *head)</td></tr>
<tr class="separator:a9fae9a03ca40ca0fecad7a963d06242f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9ef59f6c6f5db240f93b35fb779255b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ae9ef59f6c6f5db240f93b35fb779255b">stage2_free_unlinked_table</a> (void *addr, s8 level)</td></tr>
<tr class="separator:ae9ef59f6c6f5db240f93b35fb779255b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c597babff3bfa97bd093b9dd7484487"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a6c597babff3bfa97bd093b9dd7484487">kvm_host_get_page</a> (void *addr)</td></tr>
<tr class="separator:a6c597babff3bfa97bd093b9dd7484487"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af821b375f4c13aa4b873b5110fa3b503"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#af821b375f4c13aa4b873b5110fa3b503">kvm_host_put_page</a> (void *addr)</td></tr>
<tr class="separator:af821b375f4c13aa4b873b5110fa3b503"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca0a36b009f5655a358bc4943d843cf1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#aca0a36b009f5655a358bc4943d843cf1">kvm_s2_put_page</a> (void *addr)</td></tr>
<tr class="separator:aca0a36b009f5655a358bc4943d843cf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20ef7c89f7bdbdb317ac7ec7174fff5f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a20ef7c89f7bdbdb317ac7ec7174fff5f">kvm_host_page_count</a> (void *addr)</td></tr>
<tr class="separator:a20ef7c89f7bdbdb317ac7ec7174fff5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a623efd55548e897162a46d8da0043070"><td class="memItemLeft" align="right" valign="top">static phys_addr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a623efd55548e897162a46d8da0043070">kvm_host_pa</a> (void *addr)</td></tr>
<tr class="separator:a623efd55548e897162a46d8da0043070"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a7af09cc56dc8cd69de6c8d2acacd12"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a2a7af09cc56dc8cd69de6c8d2acacd12">kvm_host_va</a> (phys_addr_t phys)</td></tr>
<tr class="separator:a2a7af09cc56dc8cd69de6c8d2acacd12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b75c96fdca4f9e2423274d19539732e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a7b75c96fdca4f9e2423274d19539732e">clean_dcache_guest_page</a> (void *va, size_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</td></tr>
<tr class="separator:a7b75c96fdca4f9e2423274d19539732e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaec0113601639e091ef92762b6dd8651"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#aaec0113601639e091ef92762b6dd8651">invalidate_icache_guest_page</a> (void *va, size_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</td></tr>
<tr class="separator:aaec0113601639e091ef92762b6dd8651"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56764314df54bd366f658572d48c7098"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a56764314df54bd366f658572d48c7098">__unmap_stage2_range</a> (struct kvm_s2_mmu *mmu, phys_addr_t start, u64 <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, bool may_block)</td></tr>
<tr class="separator:a56764314df54bd366f658572d48c7098"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43756116ea784c75fc9a88b4878667c6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6">unmap_stage2_range</a> (struct kvm_s2_mmu *mmu, phys_addr_t start, u64 <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</td></tr>
<tr class="separator:a43756116ea784c75fc9a88b4878667c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a27465e35c31f661ad2b811ae347c23"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a3a27465e35c31f661ad2b811ae347c23">stage2_flush_memslot</a> (struct kvm *kvm, struct kvm_memory_slot *memslot)</td></tr>
<tr class="separator:a3a27465e35c31f661ad2b811ae347c23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8fca1b7a8029fee45816e7e7eccdfd1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ae8fca1b7a8029fee45816e7e7eccdfd1">stage2_flush_vm</a> (struct kvm *kvm)</td></tr>
<tr class="separator:ae8fca1b7a8029fee45816e7e7eccdfd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcee4e8e3dc3b20fbb06db6d8d13c6db"><td class="memItemLeft" align="right" valign="top">void __init&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#adcee4e8e3dc3b20fbb06db6d8d13c6db">free_hyp_pgds</a> (void)</td></tr>
<tr class="separator:adcee4e8e3dc3b20fbb06db6d8d13c6db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af214df14aaaac0cc598374356bc3bc5b"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b">kvm_host_owns_hyp_mappings</a> (void)</td></tr>
<tr class="separator:af214df14aaaac0cc598374356bc3bc5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a528a37af3e2c56c76872b4113cff0877"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877">__create_hyp_mappings</a> (unsigned long start, unsigned long <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, unsigned long phys, enum kvm_pgtable_prot prot)</td></tr>
<tr class="separator:a528a37af3e2c56c76872b4113cff0877"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ba832c8135d5fbf5fed763356c0a2b7"><td class="memItemLeft" align="right" valign="top">static phys_addr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a5ba832c8135d5fbf5fed763356c0a2b7">kvm_kaddr_to_phys</a> (void *kaddr)</td></tr>
<tr class="separator:a5ba832c8135d5fbf5fed763356c0a2b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1153875d725bfb703db4518efe65d551"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a1153875d725bfb703db4518efe65d551">DEFINE_MUTEX</a> (hyp_shared_pfns_lock)</td></tr>
<tr class="separator:a1153875d725bfb703db4518efe65d551"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae872b392080198975a339e2351ec3abf"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structhyp__shared__pfn.html">hyp_shared_pfn</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ae872b392080198975a339e2351ec3abf">find_shared_pfn</a> (u64 pfn, struct rb_node ***node, struct rb_node **parent)</td></tr>
<tr class="separator:ae872b392080198975a339e2351ec3abf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7729a167573cc14881088e0516f28d5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#aa7729a167573cc14881088e0516f28d5">share_pfn_hyp</a> (u64 pfn)</td></tr>
<tr class="separator:aa7729a167573cc14881088e0516f28d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab784fb7eb70984bb7728e616c60ec1e2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ab784fb7eb70984bb7728e616c60ec1e2">unshare_pfn_hyp</a> (u64 pfn)</td></tr>
<tr class="separator:ab784fb7eb70984bb7728e616c60ec1e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b7a508d0431deb996e839b226bcda0d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d">kvm_share_hyp</a> (void *from, void *to)</td></tr>
<tr class="separator:a1b7a508d0431deb996e839b226bcda0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abeed34d3f32ae7e76a83700117b7b92a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#abeed34d3f32ae7e76a83700117b7b92a">kvm_unshare_hyp</a> (void *from, void *to)</td></tr>
<tr class="separator:abeed34d3f32ae7e76a83700117b7b92a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fae287f6a52db1bbfdcb7483ba623ca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a2fae287f6a52db1bbfdcb7483ba623ca">create_hyp_mappings</a> (void *from, void *to, enum kvm_pgtable_prot prot)</td></tr>
<tr class="separator:a2fae287f6a52db1bbfdcb7483ba623ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d84d21823759c9e6d2cd3bbcc5b8f48"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48">__hyp_alloc_private_va_range</a> (unsigned long <a class="el" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a>)</td></tr>
<tr class="separator:a3d84d21823759c9e6d2cd3bbcc5b8f48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a724954ee942f0f1223e75cd475c8e7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a1a724954ee942f0f1223e75cd475c8e7">hyp_alloc_private_va_range</a> (size_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, unsigned long *haddr)</td></tr>
<tr class="separator:a1a724954ee942f0f1223e75cd475c8e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae887a1611ab69f37917bb0f05530e62d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d">__create_hyp_private_mapping</a> (phys_addr_t phys_addr, size_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, unsigned long *haddr, enum kvm_pgtable_prot prot)</td></tr>
<tr class="separator:ae887a1611ab69f37917bb0f05530e62d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fba24b69d86984f627f9fcceae1832b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a3fba24b69d86984f627f9fcceae1832b">create_hyp_stack</a> (phys_addr_t phys_addr, unsigned long *haddr)</td></tr>
<tr class="separator:a3fba24b69d86984f627f9fcceae1832b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af062326f5ca9b42e66721620681afc52"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#af062326f5ca9b42e66721620681afc52">create_hyp_io_mappings</a> (phys_addr_t phys_addr, size_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, void __iomem **kaddr, void __iomem **haddr)</td></tr>
<tr class="separator:af062326f5ca9b42e66721620681afc52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a071b366c66edcb7357907375ecd4271d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a071b366c66edcb7357907375ecd4271d">create_hyp_exec_mappings</a> (phys_addr_t phys_addr, size_t <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, void **haddr)</td></tr>
<tr class="separator:a071b366c66edcb7357907375ecd4271d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8650c6f853eb15b4e2e872e8ddbbeb2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#af8650c6f853eb15b4e2e872e8ddbbeb2">get_user_mapping_size</a> (struct kvm *kvm, u64 addr)</td></tr>
<tr class="separator:af8650c6f853eb15b4e2e872e8ddbbeb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af680391e7bf182f929f772acd512f336"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#af680391e7bf182f929f772acd512f336">kvm_init_stage2_mmu</a> (struct kvm *kvm, struct kvm_s2_mmu *mmu, unsigned long type)</td></tr>
<tr class="separator:af680391e7bf182f929f772acd512f336"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad664ca4a2c0f1b4fc2ea6ec7cb9bf651"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ad664ca4a2c0f1b4fc2ea6ec7cb9bf651">kvm_uninit_stage2_mmu</a> (struct kvm *kvm)</td></tr>
<tr class="separator:ad664ca4a2c0f1b4fc2ea6ec7cb9bf651"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a333a2def5727ab3a2ba5d13f21e2b5bb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a333a2def5727ab3a2ba5d13f21e2b5bb">stage2_unmap_memslot</a> (struct kvm *kvm, struct kvm_memory_slot *memslot)</td></tr>
<tr class="separator:a333a2def5727ab3a2ba5d13f21e2b5bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac71af3662ba64cc112e0aa668743155a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ac71af3662ba64cc112e0aa668743155a">stage2_unmap_vm</a> (struct kvm *kvm)</td></tr>
<tr class="separator:ac71af3662ba64cc112e0aa668743155a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76627fba1f507a9bfe1705285406f893"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a76627fba1f507a9bfe1705285406f893">kvm_free_stage2_pgd</a> (struct kvm_s2_mmu *mmu)</td></tr>
<tr class="separator:a76627fba1f507a9bfe1705285406f893"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace8dc778dfd3f12f9944cb1f6cc1d40d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ace8dc778dfd3f12f9944cb1f6cc1d40d">hyp_mc_free_fn</a> (void *addr, void *unused)</td></tr>
<tr class="separator:ace8dc778dfd3f12f9944cb1f6cc1d40d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa02e57405b20691414428a41090844c6"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#aa02e57405b20691414428a41090844c6">hyp_mc_alloc_fn</a> (void *unused)</td></tr>
<tr class="separator:aa02e57405b20691414428a41090844c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee4de5a2c1110217af2d89d21e21a216"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#aee4de5a2c1110217af2d89d21e21a216">free_hyp_memcache</a> (struct kvm_hyp_memcache *mc)</td></tr>
<tr class="separator:aee4de5a2c1110217af2d89d21e21a216"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0635e0487ba31d99ba782cb5e43534ef"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a0635e0487ba31d99ba782cb5e43534ef">topup_hyp_memcache</a> (struct kvm_hyp_memcache *mc, unsigned long min_pages)</td></tr>
<tr class="separator:a0635e0487ba31d99ba782cb5e43534ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aceb0aaa6f23e8883c4fe0b6ef8001f04"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#aceb0aaa6f23e8883c4fe0b6ef8001f04">kvm_phys_addr_ioremap</a> (struct kvm *kvm, phys_addr_t guest_ipa, phys_addr_t pa, unsigned long <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, bool writable)</td></tr>
<tr class="separator:aceb0aaa6f23e8883c4fe0b6ef8001f04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fd92073128280eb5aeb2254fa60cb77"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a4fd92073128280eb5aeb2254fa60cb77">stage2_wp_range</a> (struct kvm_s2_mmu *mmu, phys_addr_t addr, phys_addr_t <a class="el" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>)</td></tr>
<tr class="separator:a4fd92073128280eb5aeb2254fa60cb77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61aef4ee44be349558f529158640ae57"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a61aef4ee44be349558f529158640ae57">kvm_mmu_wp_memory_region</a> (struct kvm *kvm, int slot)</td></tr>
<tr class="separator:a61aef4ee44be349558f529158640ae57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14911068d5606cb3780e93aabfd5da96"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a14911068d5606cb3780e93aabfd5da96">kvm_mmu_split_memory_region</a> (struct kvm *kvm, int slot)</td></tr>
<tr class="separator:a14911068d5606cb3780e93aabfd5da96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a035ec39ab60e2a3d382c272b15fc83a6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6">kvm_arch_mmu_enable_log_dirty_pt_masked</a> (struct kvm *kvm, struct kvm_memory_slot *slot, gfn_t gfn_offset, unsigned long mask)</td></tr>
<tr class="separator:a035ec39ab60e2a3d382c272b15fc83a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab06707336ef5d30b56abbfd801d2f756"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ab06707336ef5d30b56abbfd801d2f756">kvm_send_hwpoison_signal</a> (unsigned long address, short lsb)</td></tr>
<tr class="separator:ab06707336ef5d30b56abbfd801d2f756"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab90d07a850ec184a5284c06e0873d82d"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ab90d07a850ec184a5284c06e0873d82d">fault_supports_stage2_huge_mapping</a> (struct kvm_memory_slot *memslot, unsigned long hva, unsigned long map_size)</td></tr>
<tr class="separator:ab90d07a850ec184a5284c06e0873d82d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a713dc5a6d09de79232b38705dd1896"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a6a713dc5a6d09de79232b38705dd1896">transparent_hugepage_adjust</a> (struct kvm *kvm, struct kvm_memory_slot *memslot, unsigned long hva, kvm_pfn_t *pfnp, phys_addr_t *ipap)</td></tr>
<tr class="separator:a6a713dc5a6d09de79232b38705dd1896"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2478e510130e93368b79931c58135c1b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a2478e510130e93368b79931c58135c1b">get_vma_page_shift</a> (struct vm_area_struct *vma, unsigned long hva)</td></tr>
<tr class="separator:a2478e510130e93368b79931c58135c1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44914d574274fbd2a9a2afb90649f15c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a44914d574274fbd2a9a2afb90649f15c">sanitise_mte_tags</a> (struct kvm *kvm, kvm_pfn_t pfn, unsigned long <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</td></tr>
<tr class="separator:a44914d574274fbd2a9a2afb90649f15c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2c3caa2e6c80158e1818c521d188e45"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ad2c3caa2e6c80158e1818c521d188e45">kvm_vma_mte_allowed</a> (struct vm_area_struct *vma)</td></tr>
<tr class="separator:ad2c3caa2e6c80158e1818c521d188e45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fa1785b4cbf3b2668c883a3c79fdeeb"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb">user_mem_abort</a> (struct kvm_vcpu *vcpu, phys_addr_t fault_ipa, struct kvm_memory_slot *memslot, unsigned long hva, bool fault_is_perm)</td></tr>
<tr class="separator:a3fa1785b4cbf3b2668c883a3c79fdeeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac49a0d8ce00f0f9143e686541ed7a92e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ac49a0d8ce00f0f9143e686541ed7a92e">handle_access_fault</a> (struct kvm_vcpu *vcpu, phys_addr_t fault_ipa)</td></tr>
<tr class="separator:ac49a0d8ce00f0f9143e686541ed7a92e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c7559bf16232daf5d3187255f1cb70e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e">kvm_handle_guest_abort</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a2c7559bf16232daf5d3187255f1cb70e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa37fc9ea36d6c97e97d77af76eca5767"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767">kvm_unmap_gfn_range</a> (struct kvm *kvm, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:aa37fc9ea36d6c97e97d77af76eca5767"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a978186d69e4a1b753b9650294d80ca7d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a978186d69e4a1b753b9650294d80ca7d">kvm_set_spte_gfn</a> (struct kvm *kvm, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:a978186d69e4a1b753b9650294d80ca7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39977aaa99a2eb423e12429a5deb15dc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a39977aaa99a2eb423e12429a5deb15dc">kvm_age_gfn</a> (struct kvm *kvm, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:a39977aaa99a2eb423e12429a5deb15dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7045f4df80d26474c5fe995d02eebc35"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a7045f4df80d26474c5fe995d02eebc35">kvm_test_age_gfn</a> (struct kvm *kvm, struct kvm_gfn_range *range)</td></tr>
<tr class="separator:a7045f4df80d26474c5fe995d02eebc35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a026808c9bdc25fe4f5fe63ae798aa797"><td class="memItemLeft" align="right" valign="top">phys_addr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a026808c9bdc25fe4f5fe63ae798aa797">kvm_mmu_get_httbr</a> (void)</td></tr>
<tr class="separator:a026808c9bdc25fe4f5fe63ae798aa797"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e031fb4697dad17adcaeeffffc51faf"><td class="memItemLeft" align="right" valign="top">phys_addr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a2e031fb4697dad17adcaeeffffc51faf">kvm_get_idmap_vector</a> (void)</td></tr>
<tr class="separator:a2e031fb4697dad17adcaeeffffc51faf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20cb0043b9509d378ec75a5dc6d73490"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a20cb0043b9509d378ec75a5dc6d73490">kvm_map_idmap_text</a> (void)</td></tr>
<tr class="separator:a20cb0043b9509d378ec75a5dc6d73490"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab59f0fbc119723d99cf43ad72a22f70b"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ab59f0fbc119723d99cf43ad72a22f70b">kvm_hyp_zalloc_page</a> (void *arg)</td></tr>
<tr class="separator:ab59f0fbc119723d99cf43ad72a22f70b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8883f6dc057c02e4b13267961859208b"><td class="memItemLeft" align="right" valign="top">int __init&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a8883f6dc057c02e4b13267961859208b">kvm_mmu_init</a> (u32 *hyp_va_bits)</td></tr>
<tr class="separator:a8883f6dc057c02e4b13267961859208b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7325960c06aa482e6f168f881d83069"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069">kvm_arch_commit_memory_region</a> (struct kvm *kvm, struct kvm_memory_slot *old, const struct kvm_memory_slot *new, enum kvm_mr_change change)</td></tr>
<tr class="separator:af7325960c06aa482e6f168f881d83069"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14568e065745512e03b3088070848289"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a14568e065745512e03b3088070848289">kvm_arch_prepare_memory_region</a> (struct kvm *kvm, const struct kvm_memory_slot *old, struct kvm_memory_slot *new, enum kvm_mr_change change)</td></tr>
<tr class="separator:a14568e065745512e03b3088070848289"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a34304a4f0ec19e4bce34e0513fc3a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a5a34304a4f0ec19e4bce34e0513fc3a4">kvm_arch_free_memslot</a> (struct kvm *kvm, struct kvm_memory_slot *slot)</td></tr>
<tr class="separator:a5a34304a4f0ec19e4bce34e0513fc3a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7e25dec8e0af366fb3db41dc9881970"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#ae7e25dec8e0af366fb3db41dc9881970">kvm_arch_memslots_updated</a> (struct kvm *kvm, u64 gen)</td></tr>
<tr class="separator:ae7e25dec8e0af366fb3db41dc9881970"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a9d3382763ac1478855bd15907a98e2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2">kvm_arch_flush_shadow_all</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a6a9d3382763ac1478855bd15907a98e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58fe7b43995ae8c20c597e1bb9c4c007"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007">kvm_arch_flush_shadow_memslot</a> (struct kvm *kvm, struct kvm_memory_slot *slot)</td></tr>
<tr class="separator:a58fe7b43995ae8c20c597e1bb9c4c007"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02fcf6f3335d5fa450266c18e6e8f0a5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a02fcf6f3335d5fa450266c18e6e8f0a5">kvm_set_way_flush</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a02fcf6f3335d5fa450266c18e6e8f0a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b63a0026cbf8d3884da7ec58add5c0c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a9b63a0026cbf8d3884da7ec58add5c0c">kvm_toggle_cache</a> (struct kvm_vcpu *vcpu, bool was_enabled)</td></tr>
<tr class="separator:a9b63a0026cbf8d3884da7ec58add5c0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a56796191d3fb3abd9372b422b9abd52b"><td class="memItemLeft" align="right" valign="top">static struct kvm_pgtable *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a></td></tr>
<tr class="separator:a56796191d3fb3abd9372b422b9abd52b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bc1b7b9ac3d075fa1fe50ad08a3a200"><td class="memItemLeft" align="right" valign="top">static unsigned long <a class="el" href="vgic_8c.html#a025fcc986fe35380110649829fd8b7ea">__ro_after_init</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a></td></tr>
<tr class="separator:a2bc1b7b9ac3d075fa1fe50ad08a3a200"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6cad154e151b78389f796d53eab3e4a"><td class="memItemLeft" align="right" valign="top">static unsigned long <a class="el" href="vgic_8c.html#a025fcc986fe35380110649829fd8b7ea">__ro_after_init</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#af6cad154e151b78389f796d53eab3e4a">hyp_idmap_end</a></td></tr>
<tr class="separator:af6cad154e151b78389f796d53eab3e4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d2511e33617fa741938a584dc513895"><td class="memItemLeft" align="right" valign="top">static phys_addr_t <a class="el" href="vgic_8c.html#a025fcc986fe35380110649829fd8b7ea">__ro_after_init</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a5d2511e33617fa741938a584dc513895">hyp_idmap_vector</a></td></tr>
<tr class="separator:a5d2511e33617fa741938a584dc513895"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96b25c9a789e7df5d189d35f1ada4100"><td class="memItemLeft" align="right" valign="top">static unsigned long <a class="el" href="vgic_8c.html#a025fcc986fe35380110649829fd8b7ea">__ro_after_init</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a96b25c9a789e7df5d189d35f1ada4100">io_map_base</a></td></tr>
<tr class="separator:a96b25c9a789e7df5d189d35f1ada4100"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76e73dbe0eaa8e135824fd27a72cac9d"><td class="memItemLeft" align="right" valign="top">static struct kvm_pgtable_mm_ops&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a76e73dbe0eaa8e135824fd27a72cac9d">kvm_s2_mm_ops</a></td></tr>
<tr class="separator:a76e73dbe0eaa8e135824fd27a72cac9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50c37f7656dc83a4d640ece2b0e36e7b"><td class="memItemLeft" align="right" valign="top">static struct rb_root&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a50c37f7656dc83a4d640ece2b0e36e7b">hyp_shared_pfns</a> = RB_ROOT</td></tr>
<tr class="separator:a50c37f7656dc83a4d640ece2b0e36e7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2893a9b1718938c86a28dc9ff1c199f"><td class="memItemLeft" align="right" valign="top">static struct kvm_pgtable_mm_ops&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#af2893a9b1718938c86a28dc9ff1c199f">kvm_user_mm_ops</a></td></tr>
<tr class="separator:af2893a9b1718938c86a28dc9ff1c199f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a626ee9bc458a919c07c36ddd5af0fabe"><td class="memItemLeft" align="right" valign="top">static struct kvm_pgtable_mm_ops&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mmu_8c.html#a626ee9bc458a919c07c36ddd5af0fabe">kvm_hyp_mm_ops</a></td></tr>
<tr class="separator:a626ee9bc458a919c07c36ddd5af0fabe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3b511994c3e3ccd15f989fc7dd2653bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b511994c3e3ccd15f989fc7dd2653bd">&#9670;&nbsp;</a></span>stage2_apply_range_resched</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define stage2_apply_range_resched</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">mmu, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">addr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">fn&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;	<a class="el" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6">stage2_apply_range</a>(mmu, addr, <a class="el" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, fn, true)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00082">82</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a528a37af3e2c56c76872b4113cff0877"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a528a37af3e2c56c76872b4113cff0877">&#9670;&nbsp;</a></span>__create_hyp_mappings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __create_hyp_mappings </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>phys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum kvm_pgtable_prot&#160;</td>
          <td class="paramname"><em>prot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00404">404</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;{</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (WARN_ON(!<a class="code" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b">kvm_host_owns_hyp_mappings</a>()))</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    mutex_lock(&amp;kvm_hyp_pgd_mutex);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    err = <a class="code" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173">kvm_pgtable_hyp_map</a>(<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>, start, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, phys, prot);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    mutex_unlock(&amp;kvm_hyp_pgd_mutex);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;}</div>
<div class="ttc" id="agen-hyprel_8c_html_a854352f53b148adc24983a58a1866d66"><div class="ttname"><a href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="gen-hyprel_8c_source.html#l00133">gen-hyprel.c:133</a></div></div>
<div class="ttc" id="ammu_8c_html_a56796191d3fb3abd9372b422b9abd52b"><div class="ttname"><a href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a></div><div class="ttdeci">static struct kvm_pgtable * hyp_pgtable</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00025">mmu.c:25</a></div></div>
<div class="ttc" id="ammu_8c_html_af214df14aaaac0cc598374356bc3bc5b"><div class="ttname"><a href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b">kvm_host_owns_hyp_mappings</a></div><div class="ttdeci">static bool kvm_host_owns_hyp_mappings(void)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00383">mmu.c:383</a></div></div>
<div class="ttc" id="apgtable_8c_html_ad1a61b3aa251ca1150e9359c5c31a173"><div class="ttname"><a href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173">kvm_pgtable_hyp_map</a></div><div class="ttdeci">int kvm_pgtable_hyp_map(struct kvm_pgtable *pgt, u64 addr, u64 size, u64 phys, enum kvm_pgtable_prot prot)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l00489">pgtable.c:489</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a528a37af3e2c56c76872b4113cff0877_cgraph.png" border="0" usemap="#ammu_8c_a528a37af3e2c56c76872b4113cff0877_cgraph" alt=""/></div>
<map name="ammu_8c_a528a37af3e2c56c76872b4113cff0877_cgraph" id="ammu_8c_a528a37af3e2c56c76872b4113cff0877_cgraph">
<area shape="rect" title=" " alt="" coords="5,75,184,101"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="232,49,461,76"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="259,100,434,127"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="516,49,648,76"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="514,100,650,127"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="509,151,655,177"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="703,37,892,64"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="724,88,871,115"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="940,5,1169,32"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="965,56,1144,83"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1222,5,1369,32"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="721,151,873,177"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="975,125,1134,152"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="981,176,1129,203"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1217,125,1373,152"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1228,176,1363,203"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1437,49,1614,76"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1421,100,1629,127"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1462,151,1589,177"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1466,201,1585,228"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a528a37af3e2c56c76872b4113cff0877_icgraph.png" border="0" usemap="#ammu_8c_a528a37af3e2c56c76872b4113cff0877_icgraph" alt=""/></div>
<map name="ammu_8c_a528a37af3e2c56c76872b4113cff0877_icgraph" id="ammu_8c_a528a37af3e2c56c76872b4113cff0877_icgraph">
<area shape="rect" title=" " alt="" coords="1389,132,1568,159"/>
<area shape="rect" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d" title=" " alt="" coords="1177,41,1338,82"/>
<area shape="rect" href="mmu_8c.html#a2fae287f6a52db1bbfdcb7483ba623ca" title=" " alt="" coords="1175,233,1340,260"/>
<area shape="rect" href="mmu_8c.html#a3fba24b69d86984f627f9fcceae1832b" title=" " alt="" coords="1189,107,1325,133"/>
<area shape="rect" href="mmu_8c.html#a20cb0043b9509d378ec75a5dc6d73490" title=" " alt="" coords="1173,157,1341,184"/>
<area shape="rect" href="mmu_8c.html#a071b366c66edcb7357907375ecd4271d" title=" " alt="" coords="923,56,1125,83"/>
<area shape="rect" href="mmu_8c.html#af062326f5ca9b42e66721620681afc52" title=" " alt="" coords="932,5,1116,32"/>
<area shape="rect" href="arm_8c.html#a38e1fd55313dedd5e69b738bff1f88a8" title=" " alt="" coords="191,56,357,83"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="11,56,123,83"/>
<area shape="rect" href="vgic-v2_8c.html#aa3e64817232a1ce5658b7f3147f7f554" title=" " alt="" coords="713,5,829,32"/>
<area shape="rect" href="vgic-init_8c.html#aba3547aa220ca50b1eabca1a39c92943" title=" " alt="" coords="447,5,591,32"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="210,5,338,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="711,157,830,184"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="933,208,1115,235"/>
<area shape="rect" href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d" title=" " alt="" coords="961,309,1087,336"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="699,335,842,361"/>
<area shape="rect" href="arm_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="685,233,857,260"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="667,385,875,412"/>
<area shape="rect" href="reset_8c.html#a82e2644a8e182c72a70fa52b0a0acae9" title=" " alt="" coords="684,284,857,311"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="455,335,582,361"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="177,335,371,361"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="419,233,619,260"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="185,386,363,427"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,339,129,365"/>
<area shape="rect" href="reset_8c.html#ae95bc53f52db3e69595fd0a53c8bc8fb" title=" " alt="" coords="431,284,607,311"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="195,284,353,311"/>
<area shape="rect" href="mmu_8c.html#a8883f6dc057c02e4b13267961859208b" title=" " alt="" coords="964,157,1084,184"/>
</map>
</div>

</div>
</div>
<a id="ae887a1611ab69f37917bb0f05530e62d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae887a1611ab69f37917bb0f05530e62d">&#9670;&nbsp;</a></span>__create_hyp_private_mapping()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int __create_hyp_private_mapping </td>
          <td>(</td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>phys_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>haddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum kvm_pgtable_prot&#160;</td>
          <td class="paramname"><em>prot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00661">661</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;{</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b">kvm_host_owns_hyp_mappings</a>()) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        addr = kvm_call_hyp_nvhe(<a class="code" href="mm_8h.html#ae155403ed30abe044479dec517afc378">__pkvm_create_private_mapping</a>,</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                     phys_addr, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, prot);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">if</span> (IS_ERR_VALUE(addr))</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            <span class="keywordflow">return</span> addr;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        *haddr = addr;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = PAGE_ALIGN(<a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> + offset_in_page(phys_addr));</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    ret = <a class="code" href="mmu_8c.html#a1a724954ee942f0f1223e75cd475c8e7">hyp_alloc_private_va_range</a>(<a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, &amp;addr);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    ret = <a class="code" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877">__create_hyp_mappings</a>(addr, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, phys_addr, prot);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    *haddr = addr + offset_in_page(phys_addr);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;}</div>
<div class="ttc" id="amm_8h_html_ae155403ed30abe044479dec517afc378"><div class="ttname"><a href="mm_8h.html#ae155403ed30abe044479dec517afc378">__pkvm_create_private_mapping</a></div><div class="ttdeci">int __pkvm_create_private_mapping(phys_addr_t phys, size_t size, enum kvm_pgtable_prot prot, unsigned long *haddr)</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00093">mm.c:93</a></div></div>
<div class="ttc" id="ammu_8c_html_a1a724954ee942f0f1223e75cd475c8e7"><div class="ttname"><a href="mmu_8c.html#a1a724954ee942f0f1223e75cd475c8e7">hyp_alloc_private_va_range</a></div><div class="ttdeci">int hyp_alloc_private_va_range(size_t size, unsigned long *haddr)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00633">mmu.c:633</a></div></div>
<div class="ttc" id="ammu_8c_html_a528a37af3e2c56c76872b4113cff0877"><div class="ttname"><a href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877">__create_hyp_mappings</a></div><div class="ttdeci">int __create_hyp_mappings(unsigned long start, unsigned long size, unsigned long phys, enum kvm_pgtable_prot prot)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00404">mmu.c:404</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ae887a1611ab69f37917bb0f05530e62d_cgraph.png" border="0" usemap="#ammu_8c_ae887a1611ab69f37917bb0f05530e62d_cgraph" alt=""/></div>
<map name="ammu_8c_ae887a1611ab69f37917bb0f05530e62d_cgraph" id="ammu_8c_ae887a1611ab69f37917bb0f05530e62d_cgraph">
<area shape="rect" title=" " alt="" coords="5,117,167,158"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="215,95,393,121"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="441,44,671,71"/>
<area shape="rect" href="mm_8h.html#ae155403ed30abe044479dec517afc378" title=" " alt="" coords="217,146,391,187"/>
<area shape="rect" href="mmu_8c.html#a1a724954ee942f0f1223e75cd475c8e7" title=" " alt="" coords="224,237,384,278"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="719,95,893,121"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="957,44,1089,71"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="955,95,1091,121"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="950,145,1095,172"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="1152,44,1341,71"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1173,95,1320,121"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1389,5,1619,32"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1415,56,1593,83"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1671,5,1818,32"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1171,145,1323,172"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1425,132,1583,159"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1430,183,1578,209"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1667,132,1823,159"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1677,183,1812,209"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1886,56,2063,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1871,107,2079,133"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1911,157,2038,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1915,208,2034,235"/>
<area shape="rect" href="mm_8c.html#a74d2915c3948e76518d945f16a1ede94" title=" " alt="" coords="460,145,652,172"/>
<area shape="rect" href="mm_8c.html#ac26a679af9d176b079755c60fa2e1ce1" title=" " alt="" coords="481,197,631,238"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="749,196,863,223"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="741,145,871,172"/>
<area shape="rect" href="mm_8c.html#aa76ffe9cd77a903ae9b6e5de1617f3a5" title=" " alt="" coords="724,247,888,289"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="941,255,1104,281"/>
<area shape="rect" href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48" title=" " alt="" coords="481,262,631,303"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ae887a1611ab69f37917bb0f05530e62d_icgraph.png" border="0" usemap="#ammu_8c_ae887a1611ab69f37917bb0f05530e62d_icgraph" alt=""/></div>
<map name="ammu_8c_ae887a1611ab69f37917bb0f05530e62d_icgraph" id="ammu_8c_ae887a1611ab69f37917bb0f05530e62d_icgraph">
<area shape="rect" title=" " alt="" coords="969,23,1131,65"/>
<area shape="rect" href="mmu_8c.html#a071b366c66edcb7357907375ecd4271d" title=" " alt="" coords="719,5,921,32"/>
<area shape="rect" href="mmu_8c.html#af062326f5ca9b42e66721620681afc52" title=" " alt="" coords="728,56,912,83"/>
<area shape="rect" href="arm_8c.html#a38e1fd55313dedd5e69b738bff1f88a8" title=" " alt="" coords="341,5,507,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,31,117,57"/>
<area shape="rect" href="vgic-v2_8c.html#aa3e64817232a1ce5658b7f3147f7f554" title=" " alt="" coords="555,56,671,83"/>
<area shape="rect" href="vgic-init_8c.html#aba3547aa220ca50b1eabca1a39c92943" title=" " alt="" coords="352,56,496,83"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="165,56,293,83"/>
</map>
</div>

</div>
</div>
<a id="a3d84d21823759c9e6d2cd3bbcc5b8f48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d84d21823759c9e6d2cd3bbcc5b8f48">&#9670;&nbsp;</a></span>__hyp_alloc_private_va_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int __hyp_alloc_private_va_range </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>base</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00603">603</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;{</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    lockdep_assert_held(&amp;kvm_hyp_pgd_mutex);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span> (!PAGE_ALIGNED(<a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a>))</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">     * Verify that BIT(VA_BITS - 1) hasn&#39;t been flipped by</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">     * allocating the new area, as it would indicate we&#39;ve</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">     * overflowed the idmap/IO address range.</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> ^ <a class="code" href="mmu_8c.html#a96b25c9a789e7df5d189d35f1ada4100">io_map_base</a>) &amp; BIT(VA_BITS - 1))</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="mmu_8c.html#a96b25c9a789e7df5d189d35f1ada4100">io_map_base</a> = <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;}</div>
<div class="ttc" id="aearly__alloc_8c_html_a74f95eab64fb23344e30879684489f6f"><div class="ttname"><a href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a></div><div class="ttdeci">static unsigned long base</div><div class="ttdef"><b>Definition:</b> <a href="early__alloc_8c_source.html#l00015">early_alloc.c:15</a></div></div>
<div class="ttc" id="ammu_8c_html_a96b25c9a789e7df5d189d35f1ada4100"><div class="ttname"><a href="mmu_8c.html#a96b25c9a789e7df5d189d35f1ada4100">io_map_base</a></div><div class="ttdeci">static unsigned long __ro_after_init io_map_base</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00032">mmu.c:32</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a3d84d21823759c9e6d2cd3bbcc5b8f48_icgraph.png" border="0" usemap="#ammu_8c_a3d84d21823759c9e6d2cd3bbcc5b8f48_icgraph" alt=""/></div>
<map name="ammu_8c_a3d84d21823759c9e6d2cd3bbcc5b8f48_icgraph" id="ammu_8c_a3d84d21823759c9e6d2cd3bbcc5b8f48_icgraph">
<area shape="rect" title=" " alt="" coords="1403,27,1553,69"/>
<area shape="rect" href="mmu_8c.html#a3fba24b69d86984f627f9fcceae1832b" title=" " alt="" coords="1207,5,1343,32"/>
<area shape="rect" href="mmu_8c.html#a1a724954ee942f0f1223e75cd475c8e7" title=" " alt="" coords="1195,57,1355,98"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="391,5,510,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,56,117,83"/>
<area shape="rect" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d" title=" " alt="" coords="985,57,1147,98"/>
<area shape="rect" href="mmu_8c.html#a071b366c66edcb7357907375ecd4271d" title=" " alt="" coords="735,56,937,83"/>
<area shape="rect" href="mmu_8c.html#af062326f5ca9b42e66721620681afc52" title=" " alt="" coords="744,107,928,133"/>
<area shape="rect" href="arm_8c.html#a38e1fd55313dedd5e69b738bff1f88a8" title=" " alt="" coords="165,56,331,83"/>
<area shape="rect" href="vgic-v2_8c.html#aa3e64817232a1ce5658b7f3147f7f554" title=" " alt="" coords="571,107,687,133"/>
<area shape="rect" href="vgic-init_8c.html#aba3547aa220ca50b1eabca1a39c92943" title=" " alt="" coords="379,107,523,133"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="184,107,312,133"/>
</map>
</div>

</div>
</div>
<a id="a877e9a15c18a09d43fa73c90949caaa2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a877e9a15c18a09d43fa73c90949caaa2">&#9670;&nbsp;</a></span>__stage2_range_addr_end()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static phys_addr_t __stage2_range_addr_end </td>
          <td>(</td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00034">34</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;{</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    phys_addr_t boundary = ALIGN_DOWN(addr + <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">return</span> (boundary - 1 &lt; <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> - 1) ? boundary : <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;}</div>
<div class="ttc" id="aearly__alloc_8c_html_ac31c5196f50f192d5db1d85180b05aaf"><div class="ttname"><a href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a></div><div class="ttdeci">static unsigned long end</div><div class="ttdef"><b>Definition:</b> <a href="early__alloc_8c_source.html#l00016">early_alloc.c:16</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a877e9a15c18a09d43fa73c90949caaa2_icgraph.png" border="0" usemap="#ammu_8c_a877e9a15c18a09d43fa73c90949caaa2_icgraph" alt=""/></div>
<map name="ammu_8c_a877e9a15c18a09d43fa73c90949caaa2_icgraph" id="ammu_8c_a877e9a15c18a09d43fa73c90949caaa2_icgraph">
<area shape="rect" title=" " alt="" coords="2385,107,2576,134"/>
<area shape="rect" href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d" title=" " alt="" coords="2165,71,2332,112"/>
<area shape="rect" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366" title=" " alt="" coords="2160,137,2337,163"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="1928,5,2107,47"/>
<area shape="rect" href="mmu_8c.html#a14911068d5606cb3780e93aabfd5da96" title=" " alt="" coords="1923,71,2112,112"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="1694,13,1850,39"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="1454,13,1614,39"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1230,5,1385,47"/>
<area shape="rect" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1669,71,1875,112"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="949,81,1168,107"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="751,110,893,137"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,110,695,137"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,110,444,137"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,103,208,144"/>
<area shape="rect" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6" title=" " alt="" coords="1941,137,2094,163"/>
<area shape="rect" href="mmu_8c.html#a56764314df54bd366f658572d48c7098" title=" " alt="" coords="1684,137,1860,163"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="1447,133,1621,159"/>
<area shape="rect" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6" title=" " alt="" coords="1453,183,1615,210"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="1217,129,1398,171"/>
<area shape="rect" href="mmu_8c.html#a333a2def5727ab3a2ba5d13f21e2b5bb" title=" " alt="" coords="1216,195,1399,222"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="965,135,1153,162"/>
<area shape="rect" href="mmu_8c.html#ac71af3662ba64cc112e0aa668743155a" title=" " alt="" coords="985,195,1132,222"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="743,188,901,229"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="514,195,673,222"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="288,195,412,222"/>
</map>
</div>

</div>
</div>
<a id="a56764314df54bd366f658572d48c7098"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56764314df54bd366f658572d48c7098">&#9670;&nbsp;</a></span>__unmap_stage2_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __unmap_stage2_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm_s2_mmu *&#160;</td>
          <td class="paramname"><em>mmu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>may_block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>unmap_stage2_range &ndash; Clear stage2 page table entries to unmap a range @mmu: The KVM stage-2 MMU pointer @start: The intermediate physical base address of the range to unmap @size: The size of the area to unmap @may_block: Whether or not we are permitted to block</p>
<p>Clear a range of stage-2 mappings, lowering the various ref-counts. Must be called while holding mmu_lock (unless for freeing the stage2 pgd before destroying the VM), otherwise another faulting VCPU may come in and mess with things behind our backs. </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00319">319</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;{</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keyword">struct </span>kvm *kvm = kvm_s2_mmu_to_kvm(mmu);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    phys_addr_t <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = start + <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    WARN_ON(<a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &amp; ~PAGE_MASK);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    WARN_ON(<a class="code" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6">stage2_apply_range</a>(mmu, start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, <a class="code" href="pgtable_8c.html#aa3d59ae8b16d53c8703fb5ef66ff9cd5">kvm_pgtable_stage2_unmap</a>,</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                   may_block));</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a98bf34ceab6b426d1ac6d1a9e8f0b6e6"><div class="ttname"><a href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6">stage2_apply_range</a></div><div class="ttdeci">static int stage2_apply_range(struct kvm_s2_mmu *mmu, phys_addr_t addr, phys_addr_t end, int(*fn)(struct kvm_pgtable *, u64, u64), bool resched)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00056">mmu.c:56</a></div></div>
<div class="ttc" id="apgtable_8c_html_aa3d59ae8b16d53c8703fb5ef66ff9cd5"><div class="ttname"><a href="pgtable_8c.html#aa3d59ae8b16d53c8703fb5ef66ff9cd5">kvm_pgtable_stage2_unmap</a></div><div class="ttdeci">int kvm_pgtable_stage2_unmap(struct kvm_pgtable *pgt, u64 addr, u64 size)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01160">pgtable.c:1160</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a56764314df54bd366f658572d48c7098_cgraph.png" border="0" usemap="#ammu_8c_a56764314df54bd366f658572d48c7098_cgraph" alt=""/></div>
<map name="ammu_8c_a56764314df54bd366f658572d48c7098_cgraph" id="ammu_8c_a56764314df54bd366f658572d48c7098_cgraph">
<area shape="rect" title=" " alt="" coords="5,291,181,317"/>
<area shape="rect" href="pgtable_8c.html#aa3d59ae8b16d53c8703fb5ef66ff9cd5" title=" " alt="" coords="229,182,388,223"/>
<area shape="rect" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6" title=" " alt="" coords="232,320,385,347"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="452,139,597,165"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="680,57,833,98"/>
<area shape="rect" href="pgtable_8c.html#a2859617deff18c881bade8c3aa6ffbdc" title=" " alt="" coords="918,275,1077,317"/>
<area shape="rect" href="pgtable_8c.html#a2dc4b408fc00f4cfa78894810a50194c" title=" " alt="" coords="441,367,609,393"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="681,139,833,165"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="918,224,1077,251"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="923,123,1071,149"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1147,224,1303,251"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1158,275,1293,301"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1371,249,1549,276"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1356,199,1564,225"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1397,476,1523,503"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1401,341,1519,368"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="914,5,1081,32"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="914,57,1081,98"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="1143,39,1308,65"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="1147,89,1304,116"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="1385,89,1535,116"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="1162,359,1289,385"/>
<area shape="rect" href="pgtable_8c.html#a42620f6fca0390491a59340e88890864" title=" " alt="" coords="938,341,1057,368"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="673,493,840,520"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="671,291,842,317"/>
<area shape="rect" href="pgtable_8c.html#a0f7a52e6df76c52f1c0c148ae06f65a1" title=" " alt="" coords="669,240,844,267"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="900,173,1095,200"/>
<area shape="rect" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366" title=" " alt="" coords="436,519,613,545"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="661,595,852,621"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a56764314df54bd366f658572d48c7098_icgraph.png" border="0" usemap="#ammu_8c_a56764314df54bd366f658572d48c7098_icgraph" alt=""/></div>
<map name="ammu_8c_a56764314df54bd366f658572d48c7098_icgraph" id="ammu_8c_a56764314df54bd366f658572d48c7098_icgraph">
<area shape="rect" title=" " alt="" coords="1639,31,1815,57"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="1416,5,1591,32"/>
<area shape="rect" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6" title=" " alt="" coords="1422,56,1585,83"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="1186,19,1367,61"/>
<area shape="rect" href="mmu_8c.html#a333a2def5727ab3a2ba5d13f21e2b5bb" title=" " alt="" coords="1185,85,1368,112"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="949,27,1137,53"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="751,27,893,53"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,27,695,53"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,27,444,53"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,19,208,61"/>
<area shape="rect" href="mmu_8c.html#ac71af3662ba64cc112e0aa668743155a" title=" " alt="" coords="970,85,1117,112"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="743,78,901,119"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="514,85,673,112"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="288,85,412,112"/>
</map>
</div>

</div>
</div>
<a id="a7b75c96fdca4f9e2423274d19539732e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b75c96fdca4f9e2423274d19539732e">&#9670;&nbsp;</a></span>clean_dcache_guest_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void clean_dcache_guest_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00273">273</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;{</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    __clean_dcache_guest_page(va, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a071b366c66edcb7357907375ecd4271d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a071b366c66edcb7357907375ecd4271d">&#9670;&nbsp;</a></span>create_hyp_exec_mappings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_hyp_exec_mappings </td>
          <td>(</td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>phys_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>haddr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>create_hyp_exec_mappings - Map an executable range into HYP @phys_addr: The physical start address which gets mapped @size: Size of the region being mapped @haddr: HYP VA for this mapping </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00778">778</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;{</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    BUG_ON(is_kernel_in_hyp_mode());</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    ret = <a class="code" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d">__create_hyp_private_mapping</a>(phys_addr, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>,</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                       &amp;addr, PAGE_HYP_EXEC);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        *haddr = NULL;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160; </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    *haddr = (<span class="keywordtype">void</span> *)addr;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_ae887a1611ab69f37917bb0f05530e62d"><div class="ttname"><a href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d">__create_hyp_private_mapping</a></div><div class="ttdeci">static int __create_hyp_private_mapping(phys_addr_t phys_addr, size_t size, unsigned long *haddr, enum kvm_pgtable_prot prot)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00661">mmu.c:661</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a071b366c66edcb7357907375ecd4271d_cgraph.png" border="0" usemap="#ammu_8c_a071b366c66edcb7357907375ecd4271d_cgraph" alt=""/></div>
<map name="ammu_8c_a071b366c66edcb7357907375ecd4271d_cgraph" id="ammu_8c_a071b366c66edcb7357907375ecd4271d_cgraph">
<area shape="rect" title=" " alt="" coords="5,124,208,151"/>
<area shape="rect" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d" title=" " alt="" coords="256,117,417,158"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="465,95,644,121"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="692,44,921,71"/>
<area shape="rect" href="mm_8h.html#ae155403ed30abe044479dec517afc378" title=" " alt="" coords="467,146,642,187"/>
<area shape="rect" href="mmu_8c.html#a1a724954ee942f0f1223e75cd475c8e7" title=" " alt="" coords="475,237,635,278"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="969,95,1144,121"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="1207,44,1339,71"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="1205,95,1341,121"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1201,145,1346,172"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="1403,44,1592,71"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1424,95,1571,121"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1640,5,1869,32"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1665,56,1844,83"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1922,5,2069,32"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1421,145,1573,172"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1675,132,1834,159"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1681,183,1829,209"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1917,132,2073,159"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1928,183,2063,209"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="2137,56,2314,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="2121,107,2329,133"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="2162,157,2289,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2166,208,2285,235"/>
<area shape="rect" href="mm_8c.html#a74d2915c3948e76518d945f16a1ede94" title=" " alt="" coords="711,145,903,172"/>
<area shape="rect" href="mm_8c.html#ac26a679af9d176b079755c60fa2e1ce1" title=" " alt="" coords="731,197,882,238"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="999,196,1114,223"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="991,145,1122,172"/>
<area shape="rect" href="mm_8c.html#aa76ffe9cd77a903ae9b6e5de1617f3a5" title=" " alt="" coords="975,247,1139,289"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="1192,255,1355,281"/>
<area shape="rect" href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48" title=" " alt="" coords="731,262,882,303"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a071b366c66edcb7357907375ecd4271d_icgraph.png" border="0" usemap="#ammu_8c_a071b366c66edcb7357907375ecd4271d_icgraph" alt=""/></div>
<map name="ammu_8c_a071b366c66edcb7357907375ecd4271d_icgraph" id="ammu_8c_a071b366c66edcb7357907375ecd4271d_icgraph">
<area shape="rect" title=" " alt="" coords="379,5,581,32"/>
<area shape="rect" href="arm_8c.html#a38e1fd55313dedd5e69b738bff1f88a8" title=" " alt="" coords="165,5,331,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="af062326f5ca9b42e66721620681afc52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af062326f5ca9b42e66721620681afc52">&#9670;&nbsp;</a></span>create_hyp_io_mappings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_hyp_io_mappings </td>
          <td>(</td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>phys_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void __iomem **&#160;</td>
          <td class="paramname"><em>kaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void __iomem **&#160;</td>
          <td class="paramname"><em>haddr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>create_hyp_io_mappings - Map IO into both kernel and HYP @phys_addr: The physical start address which gets mapped @size: Size of the region being mapped @kaddr: Kernel VA for this mapping @haddr: HYP VA for this mapping </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00740">740</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;{</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">if</span> (is_protected_kvm_enabled())</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">return</span> -EPERM;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    *kaddr = ioremap(phys_addr, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">if</span> (!*kaddr)</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">if</span> (is_kernel_in_hyp_mode()) {</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        *haddr = *kaddr;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    ret = <a class="code" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d">__create_hyp_private_mapping</a>(phys_addr, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>,</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                       &amp;addr, PAGE_HYP_DEVICE);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        iounmap(*kaddr);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        *kaddr = NULL;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        *haddr = NULL;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    *haddr = (<span class="keywordtype">void</span> __iomem *)addr;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_af062326f5ca9b42e66721620681afc52_cgraph.png" border="0" usemap="#ammu_8c_af062326f5ca9b42e66721620681afc52_cgraph" alt=""/></div>
<map name="ammu_8c_af062326f5ca9b42e66721620681afc52_cgraph" id="ammu_8c_af062326f5ca9b42e66721620681afc52_cgraph">
<area shape="rect" title=" " alt="" coords="5,124,189,151"/>
<area shape="rect" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d" title=" " alt="" coords="237,117,399,158"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="447,95,625,121"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="673,44,903,71"/>
<area shape="rect" href="mm_8h.html#ae155403ed30abe044479dec517afc378" title=" " alt="" coords="449,146,623,187"/>
<area shape="rect" href="mmu_8c.html#a1a724954ee942f0f1223e75cd475c8e7" title=" " alt="" coords="456,237,616,278"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="951,95,1125,121"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="1189,44,1321,71"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="1187,95,1323,121"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1182,145,1327,172"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="1384,44,1573,71"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1405,95,1552,121"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1621,5,1851,32"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1647,56,1825,83"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1903,5,2050,32"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1403,145,1555,172"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1657,132,1815,159"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1662,183,1810,209"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1899,132,2055,159"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1909,183,2044,209"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="2118,56,2295,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="2103,107,2311,133"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="2143,157,2270,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2147,208,2266,235"/>
<area shape="rect" href="mm_8c.html#a74d2915c3948e76518d945f16a1ede94" title=" " alt="" coords="692,145,884,172"/>
<area shape="rect" href="mm_8c.html#ac26a679af9d176b079755c60fa2e1ce1" title=" " alt="" coords="713,197,863,238"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="981,196,1095,223"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="973,145,1103,172"/>
<area shape="rect" href="mm_8c.html#aa76ffe9cd77a903ae9b6e5de1617f3a5" title=" " alt="" coords="956,247,1120,289"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="1173,255,1336,281"/>
<area shape="rect" href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48" title=" " alt="" coords="713,262,863,303"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_af062326f5ca9b42e66721620681afc52_icgraph.png" border="0" usemap="#ammu_8c_af062326f5ca9b42e66721620681afc52_icgraph" alt=""/></div>
<map name="ammu_8c_af062326f5ca9b42e66721620681afc52_icgraph" id="ammu_8c_af062326f5ca9b42e66721620681afc52_icgraph">
<area shape="rect" title=" " alt="" coords="697,5,881,32"/>
<area shape="rect" href="vgic-v2_8c.html#aa3e64817232a1ce5658b7f3147f7f554" title=" " alt="" coords="533,5,649,32"/>
<area shape="rect" href="vgic-init_8c.html#aba3547aa220ca50b1eabca1a39c92943" title=" " alt="" coords="341,5,485,32"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="165,5,293,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="a2fae287f6a52db1bbfdcb7483ba623ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fae287f6a52db1bbfdcb7483ba623ca">&#9670;&nbsp;</a></span>create_hyp_mappings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_hyp_mappings </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum kvm_pgtable_prot&#160;</td>
          <td class="paramname"><em>prot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>create_hyp_mappings - duplicate a kernel virtual address range in Hyp mode @from: The virtual kernel start address of the range @to: The virtual kernel end address of the range (exclusive) @prot: The protection to be applied to this range</p>
<p>The same virtual address as the kernel virtual address is also used in Hyp-mode mapping (modulo HYP_PAGE_OFFSET) to the same underlying physical pages. </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00574">574</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;{</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    phys_addr_t phys_addr;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> virt_addr;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> start = kern_hyp_va((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)from);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = kern_hyp_va((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)to);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> (is_kernel_in_hyp_mode())</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b">kvm_host_owns_hyp_mappings</a>())</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">return</span> -EPERM;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    start = start &amp; PAGE_MASK;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = PAGE_ALIGN(<a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">for</span> (virt_addr = start; virt_addr &lt; <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>; virt_addr += PAGE_SIZE) {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        phys_addr = <a class="code" href="mmu_8c.html#a5ba832c8135d5fbf5fed763356c0a2b7">kvm_kaddr_to_phys</a>(from + virt_addr - start);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        err = <a class="code" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877">__create_hyp_mappings</a>(virt_addr, PAGE_SIZE, phys_addr,</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                        prot);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a5ba832c8135d5fbf5fed763356c0a2b7"><div class="ttname"><a href="mmu_8c.html#a5ba832c8135d5fbf5fed763356c0a2b7">kvm_kaddr_to_phys</a></div><div class="ttdeci">static phys_addr_t kvm_kaddr_to_phys(void *kaddr)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00419">mmu.c:419</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a2fae287f6a52db1bbfdcb7483ba623ca_cgraph.png" border="0" usemap="#ammu_8c_a2fae287f6a52db1bbfdcb7483ba623ca_cgraph" alt=""/></div>
<map name="ammu_8c_a2fae287f6a52db1bbfdcb7483ba623ca_cgraph" id="ammu_8c_a2fae287f6a52db1bbfdcb7483ba623ca_cgraph">
<area shape="rect" title=" " alt="" coords="5,100,171,127"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="219,100,397,127"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="445,49,675,76"/>
<area shape="rect" href="mmu_8c.html#a5ba832c8135d5fbf5fed763356c0a2b7" title=" " alt="" coords="232,151,384,177"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="473,100,647,127"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="729,49,861,76"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="727,100,863,127"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="723,151,868,177"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="916,37,1105,64"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="937,88,1084,115"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1153,5,1383,32"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1179,56,1357,83"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1435,5,1582,32"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="935,151,1087,177"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1189,125,1347,152"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1194,176,1342,203"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1431,125,1587,152"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1441,176,1576,203"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1650,49,1827,76"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1635,100,1843,127"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1675,151,1802,177"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1679,201,1798,228"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a2fae287f6a52db1bbfdcb7483ba623ca_icgraph.png" border="0" usemap="#ammu_8c_a2fae287f6a52db1bbfdcb7483ba623ca_icgraph" alt=""/></div>
<map name="ammu_8c_a2fae287f6a52db1bbfdcb7483ba623ca_icgraph" id="ammu_8c_a2fae287f6a52db1bbfdcb7483ba623ca_icgraph">
<area shape="rect" title=" " alt="" coords="1153,56,1319,83"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="711,5,830,32"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="923,56,1105,83"/>
<area shape="rect" href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d" title=" " alt="" coords="951,107,1077,133"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="463,5,575,32"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="699,56,842,83"/>
<area shape="rect" href="arm_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="685,107,857,133"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="667,157,875,184"/>
<area shape="rect" href="reset_8c.html#a82e2644a8e182c72a70fa52b0a0acae9" title=" " alt="" coords="684,208,857,235"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="455,56,582,83"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="177,56,371,83"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="419,107,619,133"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="185,147,363,189"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,184,129,211"/>
<area shape="rect" href="reset_8c.html#ae95bc53f52db3e69595fd0a53c8bc8fb" title=" " alt="" coords="431,209,607,236"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="195,213,353,240"/>
</map>
</div>

</div>
</div>
<a id="a3fba24b69d86984f627f9fcceae1832b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fba24b69d86984f627f9fcceae1832b">&#9670;&nbsp;</a></span>create_hyp_stack()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_hyp_stack </td>
          <td>(</td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>phys_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>haddr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00691">691</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;{</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    mutex_lock(&amp;kvm_hyp_pgd_mutex);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">     * Efficient stack verification using the PAGE_SHIFT bit implies</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">     * an alignment of our allocation on the order of the size.</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = PAGE_SIZE * 2;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> = ALIGN_DOWN(<a class="code" href="mmu_8c.html#a96b25c9a789e7df5d189d35f1ada4100">io_map_base</a> - <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    ret = <a class="code" href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48">__hyp_alloc_private_va_range</a>(<a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a>);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    mutex_unlock(&amp;kvm_hyp_pgd_mutex);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        kvm_err(<span class="stringliteral">&quot;Cannot allocate hyp stack guard page\n&quot;</span>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">     * Since the stack grows downwards, map the stack to the page</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">     * at the higher address and leave the lower guard page</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">     * unbacked.</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">     * Any valid stack address now has the PAGE_SHIFT bit as 1</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">     * and addresses corresponding to the guard page have the</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">     * PAGE_SHIFT bit as 0 - this is used for overflow detection.</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    ret = <a class="code" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877">__create_hyp_mappings</a>(<a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> + PAGE_SIZE, PAGE_SIZE, phys_addr,</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                    PAGE_HYP);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        kvm_err(<span class="stringliteral">&quot;Cannot map hyp stack\n&quot;</span>);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    *haddr = <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> + <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a3d84d21823759c9e6d2cd3bbcc5b8f48"><div class="ttname"><a href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48">__hyp_alloc_private_va_range</a></div><div class="ttdeci">static int __hyp_alloc_private_va_range(unsigned long base)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00603">mmu.c:603</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a3fba24b69d86984f627f9fcceae1832b_cgraph.png" border="0" usemap="#ammu_8c_a3fba24b69d86984f627f9fcceae1832b_cgraph" alt=""/></div>
<map name="ammu_8c_a3fba24b69d86984f627f9fcceae1832b_cgraph" id="ammu_8c_a3fba24b69d86984f627f9fcceae1832b_cgraph">
<area shape="rect" title=" " alt="" coords="5,99,141,125"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="189,69,368,96"/>
<area shape="rect" href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48" title=" " alt="" coords="203,121,354,162"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="416,44,645,71"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="443,95,618,121"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="700,44,832,71"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="698,95,834,121"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="693,145,839,172"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="887,44,1076,71"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="908,95,1055,121"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1124,5,1353,32"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1149,56,1328,83"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1406,5,1553,32"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="905,145,1057,172"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1159,132,1318,159"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1165,183,1313,209"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1401,132,1557,159"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1412,183,1547,209"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1621,56,1798,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1605,107,1813,133"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1646,157,1773,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1650,208,1769,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a3fba24b69d86984f627f9fcceae1832b_icgraph.png" border="0" usemap="#ammu_8c_a3fba24b69d86984f627f9fcceae1832b_icgraph" alt=""/></div>
<map name="ammu_8c_a3fba24b69d86984f627f9fcceae1832b_icgraph" id="ammu_8c_a3fba24b69d86984f627f9fcceae1832b_icgraph">
<area shape="rect" title=" " alt="" coords="332,5,468,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="a1153875d725bfb703db4518efe65d551"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1153875d725bfb703db4518efe65d551">&#9670;&nbsp;</a></span>DEFINE_MUTEX() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static DEFINE_MUTEX </td>
          <td>(</td>
          <td class="paramtype">hyp_shared_pfns_lock&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a3b155a051326c0f7ffc7927f1bfbd35b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b155a051326c0f7ffc7927f1bfbd35b">&#9670;&nbsp;</a></span>DEFINE_MUTEX() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static DEFINE_MUTEX </td>
          <td>(</td>
          <td class="paramtype">kvm_hyp_pgd_mutex&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ab90d07a850ec184a5284c06e0873d82d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab90d07a850ec184a5284c06e0873d82d">&#9670;&nbsp;</a></span>fault_supports_stage2_huge_mapping()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool fault_supports_stage2_huge_mapping </td>
          <td>(</td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>memslot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>hva</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>map_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01214">1214</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;{</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    gpa_t gpa_start;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    hva_t uaddr_start, uaddr_end;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="comment">/* The memslot and the VMA are guaranteed to be aligned to PAGE_SIZE */</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">if</span> (map_size == PAGE_SIZE)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = memslot-&gt;npages * PAGE_SIZE;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    gpa_start = memslot-&gt;base_gfn &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    uaddr_start = memslot-&gt;userspace_addr;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    uaddr_end = uaddr_start + <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160; </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">     * Pages belonging to memslots that don&#39;t have the same alignment</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">     * within a PMD/PUD for userspace and IPA cannot be mapped with stage-2</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment">     * PMD/PUD entries, because we&#39;ll end up mapping the wrong pages.</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">     * Consider a layout like the following:</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment">     *    memslot-&gt;userspace_addr:</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">     *    +-----+--------------------+--------------------+---+</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="comment">     *    |abcde|fgh  Stage-1 block  |    Stage-1 block tv|xyz|</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">     *    +-----+--------------------+--------------------+---+</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="comment">     *    memslot-&gt;base_gfn &lt;&lt; PAGE_SHIFT:</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="comment">     *      +---+--------------------+--------------------+-----+</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment">     *      |abc|def  Stage-2 block  |    Stage-2 block   |tvxyz|</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">     *      +---+--------------------+--------------------+-----+</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">     * If we create those stage-2 blocks, we&#39;ll end up with this incorrect</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">     * mapping:</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">     *   d -&gt; f</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">     *   e -&gt; g</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">     *   f -&gt; h</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keywordflow">if</span> ((gpa_start &amp; (map_size - 1)) != (uaddr_start &amp; (map_size - 1)))</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160; </div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">     * Next, let&#39;s make sure we&#39;re not trying to map anything not covered</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">     * by the memslot. This means we have to prohibit block size mappings</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment">     * for the beginning and end of a non-block aligned and non-block sized</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">     * memory slot (illustrated by the head and tail parts of the</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">     * userspace view above containing pages &#39;abcde&#39; and &#39;xyz&#39;,</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment">     * respectively).</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">     * Note that it doesn&#39;t matter if we do the check using the</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">     * userspace_addr or the base_gfn, as both are equally aligned (per</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">     * the check above) and equally sized.</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="keywordflow">return</span> (hva &amp; ~(map_size - 1)) &gt;= uaddr_start &amp;&amp;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;           (hva &amp; ~(map_size - 1)) + map_size &lt;= uaddr_end;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ab90d07a850ec184a5284c06e0873d82d_icgraph.png" border="0" usemap="#ammu_8c_ab90d07a850ec184a5284c06e0873d82d_icgraph" alt=""/></div>
<map name="ammu_8c_ab90d07a850ec184a5284c06e0873d82d_icgraph" id="ammu_8c_ab90d07a850ec184a5284c06e0873d82d_icgraph">
<area shape="rect" title=" " alt="" coords="636,35,803,76"/>
<area shape="rect" href="mmu_8c.html#a6a713dc5a6d09de79232b38705dd1896" title=" " alt="" coords="420,5,588,47"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="240,42,372,69"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,42,192,69"/>
</map>
</div>

</div>
</div>
<a id="ae872b392080198975a339e2351ec3abf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae872b392080198975a339e2351ec3abf">&#9670;&nbsp;</a></span>find_shared_pfn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structhyp__shared__pfn.html">hyp_shared_pfn</a>* find_shared_pfn </td>
          <td>(</td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>pfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct rb_node ***&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct rb_node **&#160;</td>
          <td class="paramname"><em>parent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00439">439</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;{</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhyp__shared__pfn.html">hyp_shared_pfn</a> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    *<a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a> = &amp;<a class="code" href="mmu_8c.html#a50c37f7656dc83a4d640ece2b0e36e7b">hyp_shared_pfns</a>.rb_node;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    *parent = NULL;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">while</span> (**<a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a>) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keyword">this</span> = container_of(**<a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a>, <span class="keyword">struct</span> <a class="code" href="structhyp__shared__pfn.html">hyp_shared_pfn</a>, <a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        *parent = **<a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a>;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">if</span> (this-&gt;<a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a> &lt; <a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a>)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            *<a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a> = &amp;((**node)-&gt;rb_left);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (this-&gt;<a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a> &gt; <a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a>)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            *<a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a> = &amp;((**node)-&gt;rb_right);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a50c37f7656dc83a4d640ece2b0e36e7b"><div class="ttname"><a href="mmu_8c.html#a50c37f7656dc83a4d640ece2b0e36e7b">hyp_shared_pfns</a></div><div class="ttdeci">static struct rb_root hyp_shared_pfns</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00436">mmu.c:437</a></div></div>
<div class="ttc" id="astructhyp__shared__pfn_html"><div class="ttname"><a href="structhyp__shared__pfn.html">hyp_shared_pfn</a></div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00430">mmu.c:430</a></div></div>
<div class="ttc" id="astructhyp__shared__pfn_html_a3694c21870a6cdf6efd3c7e07d6626ab"><div class="ttname"><a href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">hyp_shared_pfn::pfn</a></div><div class="ttdeci">u64 pfn</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00431">mmu.c:431</a></div></div>
<div class="ttc" id="astructhyp__shared__pfn_html_a95e3d06986e5a7e416e4d7d4d58c1450"><div class="ttname"><a href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">hyp_shared_pfn::node</a></div><div class="ttdeci">struct rb_node node</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00432">mmu.c:433</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ae872b392080198975a339e2351ec3abf_icgraph.png" border="0" usemap="#ammu_8c_ae872b392080198975a339e2351ec3abf_icgraph" alt=""/></div>
<map name="ammu_8c_ae872b392080198975a339e2351ec3abf_icgraph" id="ammu_8c_ae872b392080198975a339e2351ec3abf_icgraph">
<area shape="rect" title=" " alt="" coords="2571,195,2696,221"/>
<area shape="rect" href="mmu_8c.html#aa7729a167573cc14881088e0516f28d5" title=" " alt="" coords="2397,220,2515,247"/>
<area shape="rect" href="mmu_8c.html#ab784fb7eb70984bb7728e616c60ec1e2" title=" " alt="" coords="2389,157,2523,184"/>
<area shape="rect" href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d" title=" " alt="" coords="2208,245,2333,272"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="1979,195,2122,221"/>
<area shape="rect" href="arm_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="1711,240,1883,267"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="1693,295,1901,321"/>
<area shape="rect" href="reset_8c.html#a82e2644a8e182c72a70fa52b0a0acae9" title=" " alt="" coords="1964,348,2137,375"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="620,185,747,212"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,208,405,235"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1217,236,1417,263"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="1466,287,1645,329"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="1255,324,1379,351"/>
<area shape="rect" href="reset_8c.html#ae95bc53f52db3e69595fd0a53c8bc8fb" title=" " alt="" coords="1709,352,1885,379"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="1476,353,1635,380"/>
<area shape="rect" href="mmu_8c.html#abeed34d3f32ae7e76a83700117b7b92a" title=" " alt="" coords="2200,144,2341,171"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="799,113,969,140"/>
<area shape="rect" href="reset_8c.html#ae42f979a2e15b7e51c3e3dfc133cb473" title=" " alt="" coords="1708,115,1887,141"/>
<area shape="rect" href="fpsimd_8c.html#a4a413d27f1db48bf29f9bdb738ab0b94" title=" " alt="" coords="1949,144,2152,171"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="616,112,751,139"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="453,108,568,135"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,157,383,184"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,5,391,32"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,56,386,83"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,107,376,133"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,157,164,184"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1465,115,1645,141"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1245,115,1390,141"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1017,113,1169,140"/>
</map>
</div>

</div>
</div>
<a id="aee4de5a2c1110217af2d89d21e21a216"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee4de5a2c1110217af2d89d21e21a216">&#9670;&nbsp;</a></span>free_hyp_memcache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_hyp_memcache </td>
          <td>(</td>
          <td class="paramtype">struct kvm_hyp_memcache *&#160;</td>
          <td class="paramname"><em>mc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01041">1041</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;{</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keywordflow">if</span> (is_protected_kvm_enabled())</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        __free_hyp_memcache(mc, <a class="code" href="mmu_8c.html#ace8dc778dfd3f12f9944cb1f6cc1d40d">hyp_mc_free_fn</a>,</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                    <a class="code" href="mmu_8c.html#a2a7af09cc56dc8cd69de6c8d2acacd12">kvm_host_va</a>, NULL);</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a2a7af09cc56dc8cd69de6c8d2acacd12"><div class="ttname"><a href="mmu_8c.html#a2a7af09cc56dc8cd69de6c8d2acacd12">kvm_host_va</a></div><div class="ttdeci">static void * kvm_host_va(phys_addr_t phys)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00268">mmu.c:268</a></div></div>
<div class="ttc" id="ammu_8c_html_ace8dc778dfd3f12f9944cb1f6cc1d40d"><div class="ttname"><a href="mmu_8c.html#ace8dc778dfd3f12f9944cb1f6cc1d40d">hyp_mc_free_fn</a></div><div class="ttdeci">static void hyp_mc_free_fn(void *addr, void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01031">mmu.c:1031</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aee4de5a2c1110217af2d89d21e21a216_cgraph.png" border="0" usemap="#ammu_8c_aee4de5a2c1110217af2d89d21e21a216_cgraph" alt=""/></div>
<map name="ammu_8c_aee4de5a2c1110217af2d89d21e21a216_cgraph" id="ammu_8c_aee4de5a2c1110217af2d89d21e21a216_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,164,57"/>
<area shape="rect" href="mmu_8c.html#ace8dc778dfd3f12f9944cb1f6cc1d40d" title=" " alt="" coords="212,5,339,32"/>
<area shape="rect" href="mmu_8c.html#a2a7af09cc56dc8cd69de6c8d2acacd12" title=" " alt="" coords="221,56,330,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aee4de5a2c1110217af2d89d21e21a216_icgraph.png" border="0" usemap="#ammu_8c_aee4de5a2c1110217af2d89d21e21a216_icgraph" alt=""/></div>
<map name="ammu_8c_aee4de5a2c1110217af2d89d21e21a216_icgraph" id="ammu_8c_aee4de5a2c1110217af2d89d21e21a216_icgraph">
<area shape="rect" title=" " alt="" coords="1537,46,1696,73"/>
<area shape="rect" href="pkvm_8c.html#abd259bb0db17ae7c75a8940360667c32" title=" " alt="" coords="1301,46,1489,73"/>
<area shape="rect" href="pkvm_8c.html#ac6f8b05fc1474ed8f561ddb8f7fa3a96" title=" " alt="" coords="1073,21,1253,47"/>
<area shape="rect" href="pkvm_8c.html#a0de2dfe512399e7f17c01091bc3e8ae8" title=" " alt="" coords="1076,71,1251,98"/>
<area shape="rect" href="pkvm_8c.html#a9c8ae8a0a845f44545cd6b7819f3430e" title=" " alt="" coords="857,17,1023,43"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="628,5,807,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="455,13,579,39"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="855,71,1025,98"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="453,67,580,94"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="650,133,785,159"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,58,405,85"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="459,154,574,181"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,109,383,135"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,159,391,186"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,210,386,237"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,261,376,287"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,109,164,135"/>
</map>
</div>

</div>
</div>
<a id="adcee4e8e3dc3b20fbb06db6d8d13c6db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcee4e8e3dc3b20fbb06db6d8d13c6db">&#9670;&nbsp;</a></span>free_hyp_pgds()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __init free_hyp_pgds </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>free_hyp_pgds - free Hyp-mode page tables </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00372">372</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;{</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    mutex_lock(&amp;kvm_hyp_pgd_mutex);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>) {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="pgtable_8c.html#aea86ed51326c8d744c425824e91bc017">kvm_pgtable_hyp_destroy</a>(<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        kfree(<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a> = NULL;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    mutex_unlock(&amp;kvm_hyp_pgd_mutex);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;}</div>
<div class="ttc" id="apgtable_8c_html_aea86ed51326c8d744c425824e91bc017"><div class="ttname"><a href="pgtable_8c.html#aea86ed51326c8d744c425824e91bc017">kvm_pgtable_hyp_destroy</a></div><div class="ttdeci">void kvm_pgtable_hyp_destroy(struct kvm_pgtable *pgt)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l00607">pgtable.c:607</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_adcee4e8e3dc3b20fbb06db6d8d13c6db_cgraph.png" border="0" usemap="#ammu_8c_adcee4e8e3dc3b20fbb06db6d8d13c6db_cgraph" alt=""/></div>
<map name="ammu_8c_adcee4e8e3dc3b20fbb06db6d8d13c6db_cgraph" id="ammu_8c_adcee4e8e3dc3b20fbb06db6d8d13c6db_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,123,57"/>
<area shape="rect" href="pgtable_8c.html#aea86ed51326c8d744c425824e91bc017" title=" " alt="" coords="171,31,365,57"/>
<area shape="rect" href="pgtable_8c.html#a781f5f5589239d7f1de59faba9e39425" title=" " alt="" coords="1027,5,1156,32"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="413,56,559,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1258,5,1385,32"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1262,56,1381,83"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="607,56,759,83"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="807,107,965,133"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="812,56,960,83"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1013,107,1169,133"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1024,56,1159,83"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1233,107,1410,133"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1217,157,1425,184"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_adcee4e8e3dc3b20fbb06db6d8d13c6db_icgraph.png" border="0" usemap="#ammu_8c_adcee4e8e3dc3b20fbb06db6d8d13c6db_icgraph" alt=""/></div>
<map name="ammu_8c_adcee4e8e3dc3b20fbb06db6d8d13c6db_icgraph" id="ammu_8c_adcee4e8e3dc3b20fbb06db6d8d13c6db_icgraph">
<area shape="rect" title=" " alt="" coords="563,31,680,57"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#aa89f9ad66646fe5a47680f42c476b2d3" title=" " alt="" coords="344,56,503,83"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,31,117,57"/>
</map>
</div>

</div>
</div>
<a id="af8650c6f853eb15b4e2e872e8ddbbeb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8650c6f853eb15b4e2e872e8ddbbeb2">&#9670;&nbsp;</a></span>get_user_mapping_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_user_mapping_size </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00802">802</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;{</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keyword">struct </span>kvm_pgtable pgt = {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        .pgd        = (kvm_pteref_t)kvm-&gt;mm-&gt;pgd,</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        .ia_bits    = vabits_actual,</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        .start_level    = (KVM_PGTABLE_LAST_LEVEL -</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                   CONFIG_PGTABLE_LEVELS + 1),</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        .mm_ops     = &amp;<a class="code" href="mmu_8c.html#af2893a9b1718938c86a28dc9ff1c199f">kvm_user_mm_ops</a>,</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    };</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    kvm_pte_t pte = 0;  <span class="comment">/* Keep GCC quiet... */</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    s8 level = S8_MAX;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">     * Disable IRQs so that we hazard against a concurrent</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">     * teardown of the userspace page tables (which relies on</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">     * IPI-ing threads).</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    local_irq_save(flags);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    ret = <a class="code" href="pgtable_8c.html#af20a43d8934ae3cdc599bfa308f93531">kvm_pgtable_get_leaf</a>(&amp;pgt, addr, &amp;pte, &amp;level);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    local_irq_restore(flags);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment">     * Not seeing an error, but not updating level? Something went</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment">     * deeply wrong...</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">if</span> (WARN_ON(level &gt; KVM_PGTABLE_LAST_LEVEL))</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span> (WARN_ON(level &lt; KVM_PGTABLE_FIRST_LEVEL))</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="comment">/* Oops, the userspace PTs are gone... Replay the fault */</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">if</span> (!kvm_pte_valid(pte))</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="keywordflow">return</span> -EAGAIN;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">return</span> BIT(ARM64_HW_PGTABLE_LEVEL_SHIFT(level));</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_af2893a9b1718938c86a28dc9ff1c199f"><div class="ttname"><a href="mmu_8c.html#af2893a9b1718938c86a28dc9ff1c199f">kvm_user_mm_ops</a></div><div class="ttdeci">static struct kvm_pgtable_mm_ops kvm_user_mm_ops</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00778">mmu.c:797</a></div></div>
<div class="ttc" id="apgtable_8c_html_af20a43d8934ae3cdc599bfa308f93531"><div class="ttname"><a href="pgtable_8c.html#af20a43d8934ae3cdc599bfa308f93531">kvm_pgtable_get_leaf</a></div><div class="ttdeci">int kvm_pgtable_get_leaf(struct kvm_pgtable *pgt, u64 addr, kvm_pte_t *ptep, s8 *level)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l00361">pgtable.c:361</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_af8650c6f853eb15b4e2e872e8ddbbeb2_cgraph.png" border="0" usemap="#ammu_8c_af8650c6f853eb15b4e2e872e8ddbbeb2_cgraph" alt=""/></div>
<map name="ammu_8c_af8650c6f853eb15b4e2e872e8ddbbeb2_cgraph" id="ammu_8c_af8650c6f853eb15b4e2e872e8ddbbeb2_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,180,159"/>
<area shape="rect" href="pgtable_8c.html#af20a43d8934ae3cdc599bfa308f93531" title=" " alt="" coords="228,132,395,159"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="443,107,588,133"/>
<area shape="rect" href="pgtable_8c.html#a5cbdf9ac45fa98927c07779fecdef889" title=" " alt="" coords="467,157,564,184"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="636,107,788,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="836,81,995,108"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="841,132,989,159"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1043,81,1199,108"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1053,132,1188,159"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1262,5,1439,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1247,56,1455,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1287,107,1414,133"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1291,157,1410,184"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_af8650c6f853eb15b4e2e872e8ddbbeb2_icgraph.png" border="0" usemap="#ammu_8c_af8650c6f853eb15b4e2e872e8ddbbeb2_icgraph" alt=""/></div>
<map name="ammu_8c_af8650c6f853eb15b4e2e872e8ddbbeb2_icgraph" id="ammu_8c_af8650c6f853eb15b4e2e872e8ddbbeb2_icgraph">
<area shape="rect" title=" " alt="" coords="636,13,811,39"/>
<area shape="rect" href="mmu_8c.html#a6a713dc5a6d09de79232b38705dd1896" title=" " alt="" coords="420,5,588,47"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="240,13,372,39"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,13,192,39"/>
</map>
</div>

</div>
</div>
<a id="a2478e510130e93368b79931c58135c1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2478e510130e93368b79931c58135c1b">&#9670;&nbsp;</a></span>get_vma_page_shift()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_vma_page_shift </td>
          <td>(</td>
          <td class="paramtype">struct vm_area_struct *&#160;</td>
          <td class="paramname"><em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>hva</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01315">1315</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;{</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> pa;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160; </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="keywordflow">if</span> (is_vm_hugetlb_page(vma) &amp;&amp; !(vma-&gt;vm_flags &amp; VM_PFNMAP))</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        <span class="keywordflow">return</span> huge_page_shift(hstate_vma(vma));</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">if</span> (!(vma-&gt;vm_flags &amp; VM_PFNMAP))</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="keywordflow">return</span> PAGE_SHIFT;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    VM_BUG_ON(is_vm_hugetlb_page(vma));</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    pa = (vma-&gt;vm_pgoff &lt;&lt; PAGE_SHIFT) + (hva - vma-&gt;vm_start);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="preprocessor">#ifndef __PAGETABLE_PMD_FOLDED</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <span class="keywordflow">if</span> ((hva &amp; (PUD_SIZE - 1)) == (pa &amp; (PUD_SIZE - 1)) &amp;&amp;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        ALIGN_DOWN(hva, PUD_SIZE) &gt;= vma-&gt;vm_start &amp;&amp;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        ALIGN(hva, PUD_SIZE) &lt;= vma-&gt;vm_end)</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="keywordflow">return</span> PUD_SHIFT;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160; </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="keywordflow">if</span> ((hva &amp; (PMD_SIZE - 1)) == (pa &amp; (PMD_SIZE - 1)) &amp;&amp;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        ALIGN_DOWN(hva, PMD_SIZE) &gt;= vma-&gt;vm_start &amp;&amp;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        ALIGN(hva, PMD_SIZE) &lt;= vma-&gt;vm_end)</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="keywordflow">return</span> PMD_SHIFT;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160; </div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">return</span> PAGE_SHIFT;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a2478e510130e93368b79931c58135c1b_icgraph.png" border="0" usemap="#ammu_8c_a2478e510130e93368b79931c58135c1b_icgraph" alt=""/></div>
<map name="ammu_8c_a2478e510130e93368b79931c58135c1b_icgraph" id="ammu_8c_a2478e510130e93368b79931c58135c1b_icgraph">
<area shape="rect" title=" " alt="" coords="420,5,573,32"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="240,5,372,32"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,5,192,32"/>
</map>
</div>

</div>
</div>
<a id="ac49a0d8ce00f0f9143e686541ed7a92e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac49a0d8ce00f0f9143e686541ed7a92e">&#9670;&nbsp;</a></span>handle_access_fault()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_access_fault </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>fault_ipa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01592">1592</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;{</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    kvm_pte_t pte;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="keyword">struct </span>kvm_s2_mmu *mmu;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160; </div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    trace_kvm_access_fault(fault_ipa);</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160; </div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    read_lock(&amp;vcpu-&gt;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    mmu = vcpu-&gt;arch.hw_mmu;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    pte = <a class="code" href="pgtable_8c.html#a2e102d0b0bb3c8860d96423371454708">kvm_pgtable_stage2_mkyoung</a>(mmu-&gt;pgt, fault_ipa);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    read_unlock(&amp;vcpu-&gt;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160; </div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="keywordflow">if</span> (kvm_pte_valid(pte))</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        <a class="code" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb">kvm_set_pfn_accessed</a>(kvm_pte_to_pfn(pte));</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_ad88d3f7ece0c0ad7dce0c296133beccb"><div class="ttname"><a href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb">kvm_set_pfn_accessed</a></div><div class="ttdeci">void kvm_set_pfn_accessed(kvm_pfn_t pfn)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03295">kvm_main.c:3295</a></div></div>
<div class="ttc" id="apgtable_8c_html_a2e102d0b0bb3c8860d96423371454708"><div class="ttname"><a href="pgtable_8c.html#a2e102d0b0bb3c8860d96423371454708">kvm_pgtable_stage2_mkyoung</a></div><div class="ttdeci">kvm_pte_t kvm_pgtable_stage2_mkyoung(struct kvm_pgtable *pgt, u64 addr)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01257">pgtable.c:1257</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ac49a0d8ce00f0f9143e686541ed7a92e_cgraph.png" border="0" usemap="#ammu_8c_ac49a0d8ce00f0f9143e686541ed7a92e_cgraph" alt=""/></div>
<map name="ammu_8c_ac49a0d8ce00f0f9143e686541ed7a92e_cgraph" id="ammu_8c_ac49a0d8ce00f0f9143e686541ed7a92e_cgraph">
<area shape="rect" title=" " alt="" coords="5,221,160,248"/>
<area shape="rect" href="pgtable_8c.html#a2e102d0b0bb3c8860d96423371454708" title=" " alt="" coords="215,185,374,226"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="208,251,381,277"/>
<area shape="rect" href="pgtable_8c.html#a479db5e7d44bd0ef2092407a91bd04b3" title=" " alt="" coords="446,185,597,226"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="682,120,827,147"/>
<area shape="rect" href="pgtable_8c.html#ae8dfa2edb1072f647c283dd113a86ca0" title=" " alt="" coords="681,196,828,223"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="906,107,1058,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1116,56,1275,83"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1121,107,1269,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1323,56,1479,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1333,107,1468,133"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1542,5,1719,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1527,56,1735,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1567,157,1694,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1571,107,1690,133"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="896,208,1068,235"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="909,259,1055,285"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="429,251,613,277"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="661,251,848,277"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ac49a0d8ce00f0f9143e686541ed7a92e_icgraph.png" border="0" usemap="#ammu_8c_ac49a0d8ce00f0f9143e686541ed7a92e_icgraph" alt=""/></div>
<map name="ammu_8c_ac49a0d8ce00f0f9143e686541ed7a92e_icgraph" id="ammu_8c_ac49a0d8ce00f0f9143e686541ed7a92e_icgraph">
<area shape="rect" title=" " alt="" coords="240,5,395,32"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,5,192,32"/>
</map>
</div>

</div>
</div>
<a id="a1a724954ee942f0f1223e75cd475c8e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a724954ee942f0f1223e75cd475c8e7">&#9670;&nbsp;</a></span>hyp_alloc_private_va_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int hyp_alloc_private_va_range </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>haddr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>hyp_alloc_private_va_range - Allocates a private VA range. @size: The size of the VA range to reserve. @haddr: The hypervisor virtual start address of the allocation.</p>
<p>The private virtual address (VA) range is allocated below io_map_base and aligned based on the order of @size.</p>
<p>Return: 0 on success or negative error code on failure. </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00633">633</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;{</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    mutex_lock(&amp;kvm_hyp_pgd_mutex);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">     * This assumes that we have enough space below the idmap</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">     * page to allocate our VAs. If not, the check in</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">     * __hyp_alloc_private_va_range() will kick. A potential</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">     * alternative would be to detect that overflow and switch</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">     * to an allocation above the idmap.</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">     * The allocated size is always a multiple of PAGE_SIZE.</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = PAGE_ALIGN(<a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> = <a class="code" href="mmu_8c.html#a96b25c9a789e7df5d189d35f1ada4100">io_map_base</a> - <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    ret = <a class="code" href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48">__hyp_alloc_private_va_range</a>(<a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a>);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    mutex_unlock(&amp;kvm_hyp_pgd_mutex);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">if</span> (!ret)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        *haddr = <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a>;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a1a724954ee942f0f1223e75cd475c8e7_cgraph.png" border="0" usemap="#ammu_8c_a1a724954ee942f0f1223e75cd475c8e7_cgraph" alt=""/></div>
<map name="ammu_8c_a1a724954ee942f0f1223e75cd475c8e7_cgraph" id="ammu_8c_a1a724954ee942f0f1223e75cd475c8e7_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,165,47"/>
<area shape="rect" href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48" title=" " alt="" coords="213,5,364,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a1a724954ee942f0f1223e75cd475c8e7_icgraph.png" border="0" usemap="#ammu_8c_a1a724954ee942f0f1223e75cd475c8e7_icgraph" alt=""/></div>
<map name="ammu_8c_a1a724954ee942f0f1223e75cd475c8e7_icgraph" id="ammu_8c_a1a724954ee942f0f1223e75cd475c8e7_icgraph">
<area shape="rect" title=" " alt="" coords="1179,23,1339,65"/>
<area shape="rect" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d" title=" " alt="" coords="969,23,1131,65"/>
<area shape="rect" href="mmu_8c.html#a071b366c66edcb7357907375ecd4271d" title=" " alt="" coords="719,5,921,32"/>
<area shape="rect" href="mmu_8c.html#af062326f5ca9b42e66721620681afc52" title=" " alt="" coords="728,56,912,83"/>
<area shape="rect" href="arm_8c.html#a38e1fd55313dedd5e69b738bff1f88a8" title=" " alt="" coords="341,5,507,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,31,117,57"/>
<area shape="rect" href="vgic-v2_8c.html#aa3e64817232a1ce5658b7f3147f7f554" title=" " alt="" coords="555,56,671,83"/>
<area shape="rect" href="vgic-init_8c.html#aba3547aa220ca50b1eabca1a39c92943" title=" " alt="" coords="352,56,496,83"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="165,56,293,83"/>
</map>
</div>

</div>
</div>
<a id="aa02e57405b20691414428a41090844c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa02e57405b20691414428a41090844c6">&#9670;&nbsp;</a></span>hyp_mc_alloc_fn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* hyp_mc_alloc_fn </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>unused</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01036">1036</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;{</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)__get_free_page(GFP_KERNEL_ACCOUNT);</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aa02e57405b20691414428a41090844c6_icgraph.png" border="0" usemap="#ammu_8c_aa02e57405b20691414428a41090844c6_icgraph" alt=""/></div>
<map name="ammu_8c_aa02e57405b20691414428a41090844c6_icgraph" id="ammu_8c_aa02e57405b20691414428a41090844c6_icgraph">
<area shape="rect" title=" " alt="" coords="223,5,353,32"/>
<area shape="rect" href="mmu_8c.html#a0635e0487ba31d99ba782cb5e43534ef" title=" " alt="" coords="5,5,175,32"/>
</map>
</div>

</div>
</div>
<a id="ace8dc778dfd3f12f9944cb1f6cc1d40d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace8dc778dfd3f12f9944cb1f6cc1d40d">&#9670;&nbsp;</a></span>hyp_mc_free_fn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void hyp_mc_free_fn </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>unused</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01031">1031</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;{</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    free_page((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ace8dc778dfd3f12f9944cb1f6cc1d40d_icgraph.png" border="0" usemap="#ammu_8c_ace8dc778dfd3f12f9944cb1f6cc1d40d_icgraph" alt=""/></div>
<map name="ammu_8c_ace8dc778dfd3f12f9944cb1f6cc1d40d_icgraph" id="ammu_8c_ace8dc778dfd3f12f9944cb1f6cc1d40d_icgraph">
<area shape="rect" title=" " alt="" coords="1744,46,1871,73"/>
<area shape="rect" href="mmu_8c.html#aee4de5a2c1110217af2d89d21e21a216" title=" " alt="" coords="1537,46,1696,73"/>
<area shape="rect" href="pkvm_8c.html#abd259bb0db17ae7c75a8940360667c32" title=" " alt="" coords="1301,46,1489,73"/>
<area shape="rect" href="pkvm_8c.html#ac6f8b05fc1474ed8f561ddb8f7fa3a96" title=" " alt="" coords="1073,21,1253,47"/>
<area shape="rect" href="pkvm_8c.html#a0de2dfe512399e7f17c01091bc3e8ae8" title=" " alt="" coords="1076,71,1251,98"/>
<area shape="rect" href="pkvm_8c.html#a9c8ae8a0a845f44545cd6b7819f3430e" title=" " alt="" coords="857,17,1023,43"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="628,5,807,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="455,13,579,39"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="855,71,1025,98"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="453,67,580,94"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="650,133,785,159"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,58,405,85"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="459,154,574,181"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,109,383,135"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,159,391,186"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,210,386,237"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,261,376,287"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,109,164,135"/>
</map>
</div>

</div>
</div>
<a id="aaec0113601639e091ef92762b6dd8651"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaec0113601639e091ef92762b6dd8651">&#9670;&nbsp;</a></span>invalidate_icache_guest_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void invalidate_icache_guest_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00278">278</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    __invalidate_icache_guest_page(va, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a39977aaa99a2eb423e12429a5deb15dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39977aaa99a2eb423e12429a5deb15dc">&#9670;&nbsp;</a></span>kvm_age_gfn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_age_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01799">1799</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;{</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    u64 <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = (range-&gt;end - range-&gt;start) &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160; </div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">if</span> (!kvm-&gt;arch.mmu.pgt)</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160; </div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="pgtable_8c.html#adf1b38858c6a66c85db09f048712d203">kvm_pgtable_stage2_test_clear_young</a>(kvm-&gt;arch.mmu.pgt,</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                           range-&gt;start &lt;&lt; PAGE_SHIFT,</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                           <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;}</div>
<div class="ttc" id="apgtable_8c_html_adf1b38858c6a66c85db09f048712d203"><div class="ttname"><a href="pgtable_8c.html#adf1b38858c6a66c85db09f048712d203">kvm_pgtable_stage2_test_clear_young</a></div><div class="ttdeci">bool kvm_pgtable_stage2_test_clear_young(struct kvm_pgtable *pgt, u64 addr, u64 size, bool mkold)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01306">pgtable.c:1306</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a39977aaa99a2eb423e12429a5deb15dc_cgraph.png" border="0" usemap="#ammu_8c_a39977aaa99a2eb423e12429a5deb15dc_cgraph" alt=""/></div>
<map name="ammu_8c_a39977aaa99a2eb423e12429a5deb15dc_cgraph" id="ammu_8c_a39977aaa99a2eb423e12429a5deb15dc_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,116,159"/>
<area shape="rect" href="pgtable_8c.html#adf1b38858c6a66c85db09f048712d203" title=" " alt="" coords="164,125,323,166"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="371,107,517,133"/>
<area shape="rect" href="pgtable_8c.html#a8d78bd0f524cdfbacbaefd645e687138" title=" " alt="" coords="371,157,517,184"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="565,107,717,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="765,81,924,108"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="771,132,919,159"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="972,81,1128,108"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="983,132,1117,159"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1191,5,1369,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1176,56,1384,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1217,107,1343,133"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1221,157,1339,184"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="568,157,715,184"/>
</map>
</div>

</div>
</div>
<a id="af7325960c06aa482e6f168f881d83069"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7325960c06aa482e6f168f881d83069">&#9670;&nbsp;</a></span>kvm_arch_commit_memory_region()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_commit_memory_region </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum kvm_mr_change&#160;</td>
          <td class="paramname"><em>change</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01946">1946</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;{</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <span class="keywordtype">bool</span> log_dirty_pages = <span class="keyword">new</span> &amp;&amp; <span class="keyword">new</span>-&gt;flags &amp; KVM_MEM_LOG_DIRTY_PAGES;</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160; </div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment">     * At this point memslot has been committed and there is an</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="comment">     * allocated dirty_bitmap[], dirty pages will be tracked while the</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment">     * memory slot is write protected.</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="keywordflow">if</span> (log_dirty_pages) {</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160; </div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        <span class="keywordflow">if</span> (change == KVM_MR_DELETE)</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160; </div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment">         * Huge and normal pages are write-protected and split</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">         * on either of these two cases:</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment">         * 1. with initial-all-set: gradually with CLEAR ioctls,</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;        <span class="keywordflow">if</span> (kvm_dirty_log_manual_protect_and_init_set(kvm))</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment">         * or</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment">         * 2. without initial-all-set: all in one shot when</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">         *    enabling dirty logging.</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <a class="code" href="mmu_8c.html#a61aef4ee44be349558f529158640ae57">kvm_mmu_wp_memory_region</a>(kvm, new-&gt;id);</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        <a class="code" href="mmu_8c.html#a14911068d5606cb3780e93aabfd5da96">kvm_mmu_split_memory_region</a>(kvm, new-&gt;id);</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">         * Free any leftovers from the eager page splitting cache. Do</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment">         * this when deleting, moving, disabling dirty logging, or</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment">         * creating the memslot (a nop). Doing it for deletes makes</span></div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">         * sure we don&#39;t leak memory, and there&#39;s no need to keep the</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="comment">         * cache around for any of the other cases.</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        kvm_mmu_free_memory_cache(&amp;kvm-&gt;arch.mmu.split_page_cache);</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    }</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a14911068d5606cb3780e93aabfd5da96"><div class="ttname"><a href="mmu_8c.html#a14911068d5606cb3780e93aabfd5da96">kvm_mmu_split_memory_region</a></div><div class="ttdeci">static void kvm_mmu_split_memory_region(struct kvm *kvm, int slot)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01155">mmu.c:1155</a></div></div>
<div class="ttc" id="ammu_8c_html_a61aef4ee44be349558f529158640ae57"><div class="ttname"><a href="mmu_8c.html#a61aef4ee44be349558f529158640ae57">kvm_mmu_wp_memory_region</a></div><div class="ttdeci">static void kvm_mmu_wp_memory_region(struct kvm *kvm, int slot)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01128">mmu.c:1128</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_af7325960c06aa482e6f168f881d83069_cgraph.png" border="0" usemap="#ammu_8c_af7325960c06aa482e6f168f881d83069_cgraph" alt=""/></div>
<map name="ammu_8c_af7325960c06aa482e6f168f881d83069_cgraph" id="ammu_8c_af7325960c06aa482e6f168f881d83069_cgraph">
<area shape="rect" title=" " alt="" coords="5,247,211,289"/>
<area shape="rect" href="mmu_8c.html#a14911068d5606cb3780e93aabfd5da96" title=" " alt="" coords="278,182,467,223"/>
<area shape="rect" href="mmu_8c.html#a61aef4ee44be349558f529158640ae57" title=" " alt="" coords="259,284,487,311"/>
<area shape="rect" href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d" title=" " alt="" coords="539,146,705,187"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="757,44,948,71"/>
<area shape="rect" href="mmu_8c.html#a62047c119e6707e0579424df7ab7bd77" title=" " alt="" coords="996,97,1183,138"/>
<area shape="rect" href="pgtable_8c.html#ada18effe8d33594eb553244d41b31440" title=" " alt="" coords="773,211,932,253"/>
<area shape="rect" href="mmu_8c.html#abfda6046e28c6dfc58730ef92bee6f3a" title=" " alt="" coords="769,146,937,187"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1237,85,1383,112"/>
<area shape="rect" href="pgtable_8c.html#a3b565840929203745194549bed91c345" title=" " alt="" coords="1014,355,1165,381"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1441,5,1593,32"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1669,72,1827,99"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1674,5,1822,32"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1911,72,2067,99"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1922,123,2057,149"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="2169,173,2295,200"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2173,224,2291,251"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1916,477,2063,504"/>
<area shape="rect" href="pgtable_8c.html#a2102018cbbcc67615546476ed0d5e17c" title=" " alt="" coords="1231,187,1389,229"/>
<area shape="rect" href="pgtable_8c.html#a9b56b0328830763f594958b5df530e3a" title=" " alt="" coords="1437,107,1596,149"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="1921,376,2058,403"/>
<area shape="rect" href="pgtable_8c.html#a1a55037404d4eed23e8e3d0a6dc28dd8" title=" " alt="" coords="1908,427,2071,453"/>
<area shape="rect" href="pgtable_8c.html#abdc9b131f49e15973545e027058c45cc" title=" " alt="" coords="1231,503,1389,545"/>
<area shape="rect" href="pgtable_8c.html#a40f6d8a965fcfab12b7d62e9dd6a5870" title=" " alt="" coords="1232,569,1388,610"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="1441,173,1593,200"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="1439,224,1595,251"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="1915,224,2064,251"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="2147,325,2317,352"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="1662,427,1834,453"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="1644,173,1852,200"/>
<area shape="rect" href="pgtable_8c.html#a283484eeb78592a5189093e5529e7f8e" title=" " alt="" coords="2151,427,2313,453"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="2393,493,2588,520"/>
<area shape="rect" href="pgtable_8c.html#a33fe30cf22af4661bf16b18bdfebc1d4" title=" " alt="" coords="2143,529,2321,570"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="2155,594,2309,635"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="2159,376,2305,403"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="2644,568,2809,595"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="2407,627,2574,653"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="2407,561,2574,602"/>
<area shape="rect" href="kvm__main_8c.html#a9fbc5527db7bcb223ecfe95c59cf4c70" title=" " alt="" coords="535,477,709,518"/>
<area shape="rect" href="mmu_8c.html#a4fd92073128280eb5aeb2254fa60cb77" title=" " alt="" coords="554,284,690,311"/>
<area shape="rect" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f" title=" " alt="" coords="1661,627,1835,669"/>
<area shape="rect" href="mmu_8c.html#a21f706511628b7801b6daf25c927f28a" title=" " alt="" coords="1900,594,2079,635"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="1902,660,2077,687"/>
<area shape="rect" href="mmu_8c.html#aeef4d107a4492fde01f361171f3e36d5" title=" " alt="" coords="2127,660,2337,687"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="2127,711,2337,737"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="2385,703,2596,745"/>
<area shape="rect" href="pgtable_8c.html#a60648bc84ec35aba9f0f80106ba70c0e" title=" " alt="" coords="773,277,932,318"/>
<area shape="rect" href="pgtable_8c.html#a479db5e7d44bd0ef2092407a91bd04b3" title=" " alt="" coords="1014,267,1165,309"/>
<area shape="rect" href="pgtable_8c.html#ae8dfa2edb1072f647c283dd113a86ca0" title=" " alt="" coords="1916,275,2063,301"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="2146,275,2318,301"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_af7325960c06aa482e6f168f881d83069_icgraph.png" border="0" usemap="#ammu_8c_af7325960c06aa482e6f168f881d83069_icgraph" alt=""/></div>
<map name="ammu_8c_af7325960c06aa482e6f168f881d83069_icgraph" id="ammu_8c_af7325960c06aa482e6f168f881d83069_icgraph">
<area shape="rect" title=" " alt="" coords="1200,5,1405,47"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="933,13,1152,39"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="743,13,885,39"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,13,695,39"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,13,444,39"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="aeef4d107a4492fde01f361171f3e36d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeef4d107a4492fde01f361171f3e36d5">&#9670;&nbsp;</a></span>kvm_arch_flush_remote_tlbs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_arch_flush_remote_tlbs </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="mmu_8c.html#aeef4d107a4492fde01f361171f3e36d5">kvm_arch_flush_remote_tlbs()</a> - flush all VM TLB entries for v7/8 @kvm: pointer to kvm structure.</p>
<p>Interface to HYP function to flush all VM TLB entries </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00169">169</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;{</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    kvm_call_hyp(<a class="code" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a">__kvm_tlb_flush_vmid</a>, &amp;kvm-&gt;arch.mmu);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div>
<div class="ttc" id="anvhe_2tlb_8c_html_acd12cf2005a2acf1ce92ff165096726a"><div class="ttname"><a href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a">__kvm_tlb_flush_vmid</a></div><div class="ttdeci">void __kvm_tlb_flush_vmid(struct kvm_s2_mmu *mmu)</div><div class="ttdef"><b>Definition:</b> <a href="nvhe_2tlb_8c_source.html#l00168">tlb.c:168</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aeef4d107a4492fde01f361171f3e36d5_cgraph.png" border="0" usemap="#ammu_8c_aeef4d107a4492fde01f361171f3e36d5_cgraph" alt=""/></div>
<map name="ammu_8c_aeef4d107a4492fde01f361171f3e36d5_cgraph" id="ammu_8c_aeef4d107a4492fde01f361171f3e36d5_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,215,57"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="263,31,429,57"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="477,5,643,32"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="481,56,639,83"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="691,56,841,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aeef4d107a4492fde01f361171f3e36d5_icgraph.png" border="0" usemap="#ammu_8c_aeef4d107a4492fde01f361171f3e36d5_icgraph" alt=""/></div>
<map name="ammu_8c_aeef4d107a4492fde01f361171f3e36d5_icgraph" id="ammu_8c_aeef4d107a4492fde01f361171f3e36d5_icgraph">
<area shape="rect" title=" " alt="" coords="2404,78,2613,105"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="2181,78,2356,105"/>
<area shape="rect" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f" title=" " alt="" coords="1959,5,2133,47"/>
<area shape="rect" href="guest__memfd_8c.html#a4e29d3d611c0945252fa062d8ea298bb" title=" " alt="" coords="1960,71,2132,112"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="1969,136,2123,177"/>
<area shape="rect" href="kvm__main_8c.html#a9fbc5527db7bcb223ecfe95c59cf4c70" title=" " alt="" coords="1733,5,1907,47"/>
<area shape="rect" href="mmu_8c.html#a61aef4ee44be349558f529158640ae57" title=" " alt="" coords="1453,13,1681,39"/>
<area shape="rect" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1200,5,1405,47"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="933,13,1152,39"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="743,13,885,39"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,13,695,39"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,13,444,39"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
<area shape="rect" href="guest__memfd_8c.html#a6fc925c724bca13fe0ad8841b4c1e64f" title=" " alt="" coords="1729,74,1911,101"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="1743,125,1897,151"/>
<area shape="rect" href="guest__memfd_8c.html#a5f64708439468ee74348c33777199e0d" title=" " alt="" coords="1485,74,1649,101"/>
</map>
</div>

</div>
</div>
<a id="a21f706511628b7801b6daf25c927f28a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21f706511628b7801b6daf25c927f28a">&#9670;&nbsp;</a></span>kvm_arch_flush_remote_tlbs_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_arch_flush_remote_tlbs_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>nr_pages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00175">175</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61">kvm_tlb_flush_vmid_range</a>(&amp;kvm-&gt;arch.mmu,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                gfn &lt;&lt; PAGE_SHIFT, nr_pages &lt;&lt; PAGE_SHIFT);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;}</div>
<div class="ttc" id="apgtable_8c_html_a77759de2d077ab75250bb7d8b457bc61"><div class="ttname"><a href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61">kvm_tlb_flush_vmid_range</a></div><div class="ttdeci">void kvm_tlb_flush_vmid_range(struct kvm_s2_mmu *mmu, phys_addr_t addr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l00695">pgtable.c:695</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a21f706511628b7801b6daf25c927f28a_cgraph.png" border="0" usemap="#ammu_8c_a21f706511628b7801b6daf25c927f28a_cgraph" alt=""/></div>
<map name="ammu_8c_a21f706511628b7801b6daf25c927f28a_cgraph" id="ammu_8c_a21f706511628b7801b6daf25c927f28a_cgraph">
<area shape="rect" title=" " alt="" coords="5,27,184,69"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="232,27,385,69"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="433,5,600,32"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="433,57,600,98"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="648,8,813,35"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="652,60,809,87"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="861,60,1012,87"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a21f706511628b7801b6daf25c927f28a_icgraph.png" border="0" usemap="#ammu_8c_a21f706511628b7801b6daf25c927f28a_icgraph" alt=""/></div>
<map name="ammu_8c_a21f706511628b7801b6daf25c927f28a_icgraph" id="ammu_8c_a21f706511628b7801b6daf25c927f28a_icgraph">
<area shape="rect" title=" " alt="" coords="2175,5,2353,47"/>
<area shape="rect" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f" title=" " alt="" coords="1952,5,2127,47"/>
<area shape="rect" href="kvm__main_8c.html#a9fbc5527db7bcb223ecfe95c59cf4c70" title=" " alt="" coords="1729,5,1904,47"/>
<area shape="rect" href="mmu_8c.html#a61aef4ee44be349558f529158640ae57" title=" " alt="" coords="1453,13,1681,39"/>
<area shape="rect" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1200,5,1405,47"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="933,13,1152,39"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="743,13,885,39"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,13,695,39"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,13,444,39"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a6a9d3382763ac1478855bd15907a98e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a9d3382763ac1478855bd15907a98e2">&#9670;&nbsp;</a></span>kvm_arch_flush_shadow_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_flush_shadow_all </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l02058">2058</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;{</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <a class="code" href="mmu_8c.html#ad664ca4a2c0f1b4fc2ea6ec7cb9bf651">kvm_uninit_stage2_mmu</a>(kvm);</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_ad664ca4a2c0f1b4fc2ea6ec7cb9bf651"><div class="ttname"><a href="mmu_8c.html#ad664ca4a2c0f1b4fc2ea6ec7cb9bf651">kvm_uninit_stage2_mmu</a></div><div class="ttdeci">void kvm_uninit_stage2_mmu(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00937">mmu.c:937</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a6a9d3382763ac1478855bd15907a98e2_cgraph.png" border="0" usemap="#ammu_8c_a6a9d3382763ac1478855bd15907a98e2_cgraph" alt=""/></div>
<map name="ammu_8c_a6a9d3382763ac1478855bd15907a98e2_cgraph" id="ammu_8c_a6a9d3382763ac1478855bd15907a98e2_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,209,133"/>
<area shape="rect" href="mmu_8c.html#ad664ca4a2c0f1b4fc2ea6ec7cb9bf651" title=" " alt="" coords="257,107,444,133"/>
<area shape="rect" href="mmu_8c.html#a76627fba1f507a9bfe1705285406f893" title=" " alt="" coords="492,107,659,133"/>
<area shape="rect" href="pgtable_8c.html#ab0ed17e7108aa47fbba6cbdfea0b6606" title=" " alt="" coords="707,99,865,141"/>
<area shape="rect" href="pgtable_8c.html#ab68001fdf94eab0c95183a0d99df3576" title=" " alt="" coords="1119,56,1247,83"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="913,107,1059,133"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="1517,157,1666,184"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1312,56,1460,83"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1107,107,1259,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1307,107,1465,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1513,107,1669,133"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1524,56,1659,83"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1733,56,1910,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1717,5,1925,32"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1758,157,1885,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1762,107,1881,133"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1736,208,1907,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a6a9d3382763ac1478855bd15907a98e2_icgraph.png" border="0" usemap="#ammu_8c_a6a9d3382763ac1478855bd15907a98e2_icgraph" alt=""/></div>
<map name="ammu_8c_a6a9d3382763ac1478855bd15907a98e2_icgraph" id="ammu_8c_a6a9d3382763ac1478855bd15907a98e2_icgraph">
<area shape="rect" title=" " alt="" coords="1016,107,1220,133"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="799,107,968,133"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="616,107,751,133"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="453,107,568,133"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,5,383,32"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,56,391,83"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,107,405,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,157,386,184"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,208,376,235"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,5,164,32"/>
</map>
</div>

</div>
</div>
<a id="a58fe7b43995ae8c20c597e1bb9c4c007"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58fe7b43995ae8c20c597e1bb9c4c007">&#9670;&nbsp;</a></span>kvm_arch_flush_shadow_memslot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_flush_shadow_memslot </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l02063">2063</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;{</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    gpa_t gpa = slot-&gt;base_gfn &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    phys_addr_t <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = slot-&gt;npages &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160; </div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    write_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <a class="code" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6">unmap_stage2_range</a>(&amp;kvm-&gt;arch.mmu, gpa, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    write_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a43756116ea784c75fc9a88b4878667c6"><div class="ttname"><a href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6">unmap_stage2_range</a></div><div class="ttdeci">static void unmap_stage2_range(struct kvm_s2_mmu *mmu, phys_addr_t start, u64 size)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00331">mmu.c:331</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a58fe7b43995ae8c20c597e1bb9c4c007_cgraph.png" border="0" usemap="#ammu_8c_a58fe7b43995ae8c20c597e1bb9c4c007_cgraph" alt=""/></div>
<map name="ammu_8c_a58fe7b43995ae8c20c597e1bb9c4c007_cgraph" id="ammu_8c_a58fe7b43995ae8c20c597e1bb9c4c007_cgraph">
<area shape="rect" title=" " alt="" coords="5,283,187,325"/>
<area shape="rect" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6" title=" " alt="" coords="235,291,397,317"/>
<area shape="rect" href="mmu_8c.html#a56764314df54bd366f658572d48c7098" title=" " alt="" coords="445,291,621,317"/>
<area shape="rect" href="pgtable_8c.html#aa3d59ae8b16d53c8703fb5ef66ff9cd5" title=" " alt="" coords="669,182,828,223"/>
<area shape="rect" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6" title=" " alt="" coords="672,320,825,347"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="892,139,1037,165"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="1120,57,1273,98"/>
<area shape="rect" href="pgtable_8c.html#a2859617deff18c881bade8c3aa6ffbdc" title=" " alt="" coords="1358,275,1517,317"/>
<area shape="rect" href="pgtable_8c.html#a2dc4b408fc00f4cfa78894810a50194c" title=" " alt="" coords="881,367,1049,393"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1121,139,1273,165"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1358,224,1517,251"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1363,123,1511,149"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1587,224,1743,251"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1598,275,1733,301"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1811,249,1989,276"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1796,199,2004,225"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1837,476,1963,503"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1841,341,1959,368"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="1354,5,1521,32"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="1354,57,1521,98"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="1583,39,1748,65"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="1587,89,1744,116"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="1825,89,1975,116"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="1602,359,1729,385"/>
<area shape="rect" href="pgtable_8c.html#a42620f6fca0390491a59340e88890864" title=" " alt="" coords="1378,341,1497,368"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1113,493,1280,520"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1111,291,1282,317"/>
<area shape="rect" href="pgtable_8c.html#a0f7a52e6df76c52f1c0c148ae06f65a1" title=" " alt="" coords="1109,240,1284,267"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="1340,173,1535,200"/>
<area shape="rect" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366" title=" " alt="" coords="876,519,1053,545"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="1101,595,1292,621"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a58fe7b43995ae8c20c597e1bb9c4c007_icgraph.png" border="0" usemap="#ammu_8c_a58fe7b43995ae8c20c597e1bb9c4c007_icgraph" alt=""/></div>
<map name="ammu_8c_a58fe7b43995ae8c20c597e1bb9c4c007_icgraph" id="ammu_8c_a58fe7b43995ae8c20c597e1bb9c4c007_icgraph">
<area shape="rect" title=" " alt="" coords="1169,5,1351,47"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="933,13,1121,39"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="743,13,885,39"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,13,695,39"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,13,444,39"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a5a34304a4f0ec19e4bce34e0513fc3a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a34304a4f0ec19e4bce34e0513fc3a4">&#9670;&nbsp;</a></span>kvm_arch_free_memslot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_free_memslot </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l02050">2050</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;{</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a5a34304a4f0ec19e4bce34e0513fc3a4_icgraph.png" border="0" usemap="#ammu_8c_a5a34304a4f0ec19e4bce34e0513fc3a4_icgraph" alt=""/></div>
<map name="ammu_8c_a5a34304a4f0ec19e4bce34e0513fc3a4_icgraph" id="ammu_8c_a5a34304a4f0ec19e4bce34e0513fc3a4_icgraph">
<area shape="rect" title=" " alt="" coords="1403,119,1587,146"/>
<area shape="rect" href="kvm__main_8c.html#ae2d9291adcda0ba0f7a20350dabdd418" title=" " alt="" coords="1205,119,1355,146"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="939,94,1157,121"/>
<area shape="rect" href="kvm__main_8c.html#ae58ffa9a2b55027be40935dd4410bd30" title=" " alt="" coords="970,145,1126,171"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="748,94,891,121"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="497,57,700,83"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="259,14,447,41"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="752,145,887,171"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="541,145,656,171"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="278,69,427,95"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="270,119,435,146"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="256,170,449,197"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="275,221,430,247"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="285,271,420,298"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="27,71,186,98"/>
</map>
</div>

</div>
</div>
<a id="ae7e25dec8e0af366fb3db41dc9881970"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7e25dec8e0af366fb3db41dc9881970">&#9670;&nbsp;</a></span>kvm_arch_memslots_updated()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_memslots_updated </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>gen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l02054">2054</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;{</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ae7e25dec8e0af366fb3db41dc9881970_icgraph.png" border="0" usemap="#ammu_8c_ae7e25dec8e0af366fb3db41dc9881970_icgraph" alt=""/></div>
<map name="ammu_8c_ae7e25dec8e0af366fb3db41dc9881970_icgraph" id="ammu_8c_ae7e25dec8e0af366fb3db41dc9881970_icgraph">
<area shape="rect" title=" " alt="" coords="1683,183,1901,209"/>
<area shape="rect" href="kvm__main_8c.html#a6178ec8efee3ce8e53d84403b2a25401" title=" " alt="" coords="1424,183,1635,209"/>
<area shape="rect" href="kvm__main_8c.html#a52d56a5dc447602839375289b5bbffb2" title=" " alt="" coords="1194,132,1370,159"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="1188,208,1376,235"/>
<area shape="rect" href="kvm__main_8c.html#a8c9bd99a64bbedb0930e29ed4dcc7897" title=" " alt="" coords="955,5,1119,32"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="743,132,885,159"/>
<area shape="rect" href="kvm__main_8c.html#ac4ce014a99262ed5672a102c6d2ffdbd" title=" " alt="" coords="955,107,1119,133"/>
<area shape="rect" href="kvm__main_8c.html#afdb5cea8958921b2ea9bd3a29cf9d7a6" title=" " alt="" coords="957,157,1117,184"/>
<area shape="rect" href="kvm__main_8c.html#a192569033b972982f6b53e13666ef82b" title=" " alt="" coords="933,208,1140,235"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,132,695,159"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,132,444,159"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,125,208,166"/>
</map>
</div>

</div>
</div>
<a id="a035ec39ab60e2a3d382c272b15fc83a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a035ec39ab60e2a3d382c272b15fc83a6">&#9670;&nbsp;</a></span>kvm_arch_mmu_enable_log_dirty_pt_masked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_mmu_enable_log_dirty_pt_masked </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gfn_t&#160;</td>
          <td class="paramname"><em>gfn_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01185">1185</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;{</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    phys_addr_t base_gfn = slot-&gt;base_gfn + gfn_offset;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    phys_addr_t start = (base_gfn +  __ffs(mask)) &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    phys_addr_t <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = (base_gfn + __fls(mask) + 1) &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160; </div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <a class="code" href="mmu_8c.html#a4fd92073128280eb5aeb2254fa60cb77">stage2_wp_range</a>(&amp;kvm-&gt;arch.mmu, start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment">     * Eager-splitting is done when manual-protect is set.  We</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">     * also check for initially-all-set because we can avoid</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">     * eager-splitting if initially-all-set is false.</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment">     * Initially-all-set equal false implies that huge-pages were</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment">     * already split when enabling dirty logging: no need to do it</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment">     * again.</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordflow">if</span> (kvm_dirty_log_manual_protect_and_init_set(kvm))</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <a class="code" href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d">kvm_mmu_split_huge_pages</a>(kvm, start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>);</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a4fd92073128280eb5aeb2254fa60cb77"><div class="ttname"><a href="mmu_8c.html#a4fd92073128280eb5aeb2254fa60cb77">stage2_wp_range</a></div><div class="ttdeci">static void stage2_wp_range(struct kvm_s2_mmu *mmu, phys_addr_t addr, phys_addr_t end)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01110">mmu.c:1110</a></div></div>
<div class="ttc" id="ammu_8c_html_adf6f75ecf7d564f9aa7b446e6a236d2d"><div class="ttname"><a href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d">kvm_mmu_split_huge_pages</a></div><div class="ttdeci">static int kvm_mmu_split_huge_pages(struct kvm *kvm, phys_addr_t addr, phys_addr_t end)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00114">mmu.c:114</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a035ec39ab60e2a3d382c272b15fc83a6_cgraph.png" border="0" usemap="#ammu_8c_a035ec39ab60e2a3d382c272b15fc83a6_cgraph" alt=""/></div>
<map name="ammu_8c_a035ec39ab60e2a3d382c272b15fc83a6_cgraph" id="ammu_8c_a035ec39ab60e2a3d382c272b15fc83a6_cgraph">
<area shape="rect" title=" " alt="" coords="5,576,184,617"/>
<area shape="rect" href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d" title=" " alt="" coords="232,517,399,559"/>
<area shape="rect" href="mmu_8c.html#a4fd92073128280eb5aeb2254fa60cb77" title=" " alt="" coords="247,613,383,639"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="447,466,637,493"/>
<area shape="rect" href="mmu_8c.html#a62047c119e6707e0579424df7ab7bd77" title=" " alt="" coords="685,543,872,584"/>
<area shape="rect" href="pgtable_8c.html#ada18effe8d33594eb553244d41b31440" title=" " alt="" coords="463,400,621,441"/>
<area shape="rect" href="mmu_8c.html#abfda6046e28c6dfc58730ef92bee6f3a" title=" " alt="" coords="458,517,626,559"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="927,583,1072,610"/>
<area shape="rect" href="pgtable_8c.html#a3b565840929203745194549bed91c345" title=" " alt="" coords="703,263,854,290"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1130,583,1282,610"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1358,558,1517,585"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1363,609,1511,635"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1616,718,1772,745"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1627,609,1761,635"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1865,827,2043,854"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1850,777,2058,803"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1891,625,2017,651"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2139,574,2258,601"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1621,507,1767,534"/>
<area shape="rect" href="pgtable_8c.html#a2102018cbbcc67615546476ed0d5e17c" title=" " alt="" coords="920,332,1079,373"/>
<area shape="rect" href="pgtable_8c.html#a9b56b0328830763f594958b5df530e3a" title=" " alt="" coords="1127,441,1285,483"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="1885,187,2023,214"/>
<area shape="rect" href="pgtable_8c.html#a1a55037404d4eed23e8e3d0a6dc28dd8" title=" " alt="" coords="1873,137,2035,163"/>
<area shape="rect" href="pgtable_8c.html#abdc9b131f49e15973545e027058c45cc" title=" " alt="" coords="920,5,1079,47"/>
<area shape="rect" href="pgtable_8c.html#a40f6d8a965fcfab12b7d62e9dd6a5870" title=" " alt="" coords="921,71,1077,112"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="1130,289,1282,315"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="1128,339,1284,366"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="1619,457,1769,483"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="2113,238,2284,265"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="1351,289,1523,315"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="1333,365,1541,391"/>
<area shape="rect" href="pgtable_8c.html#a29a6724d2843672cf5db792f2beb968a" title=" " alt="" coords="1589,390,1799,417"/>
<area shape="rect" href="pgtable_8c.html#a283484eeb78592a5189093e5529e7f8e" title=" " alt="" coords="2118,187,2279,214"/>
<area shape="rect" href="pgtable_8c.html#adcfc585140832fbe68cdf3d3f0a918d4" title=" " alt="" coords="1873,407,2035,448"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1865,305,2043,331"/>
<area shape="rect" href="pgtable_8c.html#a5ab910dc5d47620683abb5d18fb4890f" title=" " alt="" coords="1847,355,2061,382"/>
<area shape="rect" href="pgtable_8c.html#a909c28888aa74e4a85ee0c267bb88cc9" title=" " alt="" coords="1873,239,2035,280"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="1868,473,2040,499"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="2336,130,2531,157"/>
<area shape="rect" href="pgtable_8c.html#a33fe30cf22af4661bf16b18bdfebc1d4" title=" " alt="" coords="2109,71,2288,112"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="2122,5,2275,47"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="2125,406,2272,433"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="2579,97,2744,123"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="2583,46,2740,73"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="2792,46,2943,73"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="2350,13,2517,39"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="2350,64,2517,105"/>
<area shape="rect" href="pgtable_8c.html#a60648bc84ec35aba9f0f80106ba70c0e" title=" " alt="" coords="463,635,621,676"/>
<area shape="rect" href="pgtable_8c.html#a479db5e7d44bd0ef2092407a91bd04b3" title=" " alt="" coords="703,635,854,676"/>
<area shape="rect" href="pgtable_8c.html#ae8dfa2edb1072f647c283dd113a86ca0" title=" " alt="" coords="1621,659,1767,686"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a035ec39ab60e2a3d382c272b15fc83a6_icgraph.png" border="0" usemap="#ammu_8c_a035ec39ab60e2a3d382c272b15fc83a6_icgraph" alt=""/></div>
<map name="ammu_8c_a035ec39ab60e2a3d382c272b15fc83a6_icgraph" id="ammu_8c_a035ec39ab60e2a3d382c272b15fc83a6_icgraph">
<area shape="rect" title=" " alt="" coords="620,5,799,47"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="416,13,572,39"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="208,13,368,39"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="5,5,160,47"/>
</map>
</div>

</div>
</div>
<a id="a14568e065745512e03b3088070848289"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14568e065745512e03b3088070848289">&#9670;&nbsp;</a></span>kvm_arch_prepare_memory_region()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_arch_prepare_memory_region </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum kvm_mr_change&#160;</td>
          <td class="paramname"><em>change</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01990">1990</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;{</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    hva_t hva, reg_end;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160; </div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="keywordflow">if</span> (change != KVM_MR_CREATE &amp;&amp; change != KVM_MR_MOVE &amp;&amp;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;            change != KVM_MR_FLAGS_ONLY)</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160; </div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment">     * Prevent userspace from creating a memory region outside of the IPA</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">     * space addressable by the KVM guest IPA space.</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    <span class="keywordflow">if</span> ((new-&gt;base_gfn + new-&gt;npages) &gt; (kvm_phys_size(&amp;kvm-&gt;arch.mmu) &gt;&gt; PAGE_SHIFT))</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160; </div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    hva = <span class="keyword">new</span>-&gt;userspace_addr;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    reg_end = hva + (<span class="keyword">new</span>-&gt;npages &lt;&lt; PAGE_SHIFT);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160; </div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    mmap_read_lock(current-&gt;mm);</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">     * A memory region could potentially cover multiple VMAs, and any holes</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment">     * between them, so iterate over all of them.</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment">     *     +--------------------------------------------+</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">     * +---------------+----------------+   +----------------+</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">     * |   : VMA 1     |      VMA 2     |   |    VMA 3  :    |</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment">     * +---------------+----------------+   +----------------+</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment">     *     |               memory region                |</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment">     *     +--------------------------------------------+</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <span class="keyword">struct </span>vm_area_struct *vma;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160; </div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        vma = find_vma_intersection(current-&gt;mm, hva, reg_end);</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        <span class="keywordflow">if</span> (!vma)</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160; </div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        <span class="keywordflow">if</span> (kvm_has_mte(kvm) &amp;&amp; !<a class="code" href="mmu_8c.html#ad2c3caa2e6c80158e1818c521d188e45">kvm_vma_mte_allowed</a>(vma)) {</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;            ret = -EINVAL;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;        }</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160; </div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        <span class="keywordflow">if</span> (vma-&gt;vm_flags &amp; VM_PFNMAP) {</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;            <span class="comment">/* IO region dirty page logging not allowed */</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;            <span class="keywordflow">if</span> (new-&gt;flags &amp; KVM_MEM_LOG_DIRTY_PAGES) {</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                ret = -EINVAL;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;            }</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;        }</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        hva = min(reg_end, vma-&gt;vm_end);</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    } <span class="keywordflow">while</span> (hva &lt; reg_end);</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160; </div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    mmap_read_unlock(current-&gt;mm);</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_ad2c3caa2e6c80158e1818c521d188e45"><div class="ttname"><a href="mmu_8c.html#ad2c3caa2e6c80158e1818c521d188e45">kvm_vma_mte_allowed</a></div><div class="ttdeci">static bool kvm_vma_mte_allowed(struct vm_area_struct *vma)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01372">mmu.c:1372</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a14568e065745512e03b3088070848289_cgraph.png" border="0" usemap="#ammu_8c_a14568e065745512e03b3088070848289_cgraph" alt=""/></div>
<map name="ammu_8c_a14568e065745512e03b3088070848289_cgraph" id="ammu_8c_a14568e065745512e03b3088070848289_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,211,47"/>
<area shape="rect" href="mmu_8c.html#ad2c3caa2e6c80158e1818c521d188e45" title=" " alt="" coords="259,13,437,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a14568e065745512e03b3088070848289_icgraph.png" border="0" usemap="#ammu_8c_a14568e065745512e03b3088070848289_icgraph" alt=""/></div>
<map name="ammu_8c_a14568e065745512e03b3088070848289_icgraph" id="ammu_8c_a14568e065745512e03b3088070848289_icgraph">
<area shape="rect" title=" " alt="" coords="1152,5,1357,47"/>
<area shape="rect" href="kvm__main_8c.html#a6dd13a049fee9663450eebbf2ac16faa" title=" " alt="" coords="933,5,1104,47"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="743,13,885,39"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,13,695,39"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,13,444,39"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a76627fba1f507a9bfe1705285406f893"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76627fba1f507a9bfe1705285406f893">&#9670;&nbsp;</a></span>kvm_free_stage2_pgd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_free_stage2_pgd </td>
          <td>(</td>
          <td class="paramtype">struct kvm_s2_mmu *&#160;</td>
          <td class="paramname"><em>mmu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01011">1011</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;{</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keyword">struct </span>kvm *kvm = kvm_s2_mmu_to_kvm(mmu);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keyword">struct </span>kvm_pgtable *pgt = NULL;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    write_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    pgt = mmu-&gt;pgt;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordflow">if</span> (pgt) {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        mmu-&gt;pgd_phys = 0;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        mmu-&gt;pgt = NULL;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        free_percpu(mmu-&gt;last_vcpu_ran);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    write_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span> (pgt) {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <a class="code" href="pgtable_8c.html#ab0ed17e7108aa47fbba6cbdfea0b6606">kvm_pgtable_stage2_destroy</a>(pgt);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        kfree(pgt);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;}</div>
<div class="ttc" id="apgtable_8c_html_ab0ed17e7108aa47fbba6cbdfea0b6606"><div class="ttname"><a href="pgtable_8c.html#ab0ed17e7108aa47fbba6cbdfea0b6606">kvm_pgtable_stage2_destroy</a></div><div class="ttdeci">void kvm_pgtable_stage2_destroy(struct kvm_pgtable *pgt)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01586">pgtable.c:1586</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a76627fba1f507a9bfe1705285406f893_cgraph.png" border="0" usemap="#ammu_8c_a76627fba1f507a9bfe1705285406f893_cgraph" alt=""/></div>
<map name="ammu_8c_a76627fba1f507a9bfe1705285406f893_cgraph" id="ammu_8c_a76627fba1f507a9bfe1705285406f893_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,172,133"/>
<area shape="rect" href="pgtable_8c.html#ab0ed17e7108aa47fbba6cbdfea0b6606" title=" " alt="" coords="220,99,379,141"/>
<area shape="rect" href="pgtable_8c.html#ab68001fdf94eab0c95183a0d99df3576" title=" " alt="" coords="632,56,760,83"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="427,107,572,133"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="1030,157,1179,184"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="825,56,973,83"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="620,107,772,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="820,107,979,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1027,107,1183,133"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1037,56,1172,83"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1246,56,1423,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1231,5,1439,32"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1271,157,1398,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1275,107,1394,133"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1249,208,1420,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a76627fba1f507a9bfe1705285406f893_icgraph.png" border="0" usemap="#ammu_8c_a76627fba1f507a9bfe1705285406f893_icgraph" alt=""/></div>
<map name="ammu_8c_a76627fba1f507a9bfe1705285406f893_icgraph" id="ammu_8c_a76627fba1f507a9bfe1705285406f893_icgraph">
<area shape="rect" title=" " alt="" coords="1503,107,1669,133"/>
<area shape="rect" href="mmu_8c.html#ad664ca4a2c0f1b4fc2ea6ec7cb9bf651" title=" " alt="" coords="1268,107,1455,133"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="1016,107,1220,133"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="799,107,968,133"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="616,107,751,133"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="453,107,568,133"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,5,383,32"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,56,391,83"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,107,405,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,157,386,184"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,208,376,235"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,5,164,32"/>
</map>
</div>

</div>
</div>
<a id="a2e031fb4697dad17adcaeeffffc51faf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e031fb4697dad17adcaeeffffc51faf">&#9670;&nbsp;</a></span>kvm_get_idmap_vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">phys_addr_t kvm_get_idmap_vector </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01828">1828</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;{</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="mmu_8c.html#a5d2511e33617fa741938a584dc513895">hyp_idmap_vector</a>;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a5d2511e33617fa741938a584dc513895"><div class="ttname"><a href="mmu_8c.html#a5d2511e33617fa741938a584dc513895">hyp_idmap_vector</a></div><div class="ttdeci">static phys_addr_t __ro_after_init hyp_idmap_vector</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00030">mmu.c:30</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a2e031fb4697dad17adcaeeffffc51faf_icgraph.png" border="0" usemap="#ammu_8c_a2e031fb4697dad17adcaeeffffc51faf_icgraph" alt=""/></div>
<map name="ammu_8c_a2e031fb4697dad17adcaeeffffc51faf_icgraph" id="ammu_8c_a2e031fb4697dad17adcaeeffffc51faf_icgraph">
<area shape="rect" title=" " alt="" coords="1443,81,1617,108"/>
<area shape="rect" href="arm_8c.html#ab28c902db0ff42c4bcafa99fab70a2f9" title=" " alt="" coords="1219,81,1395,108"/>
<area shape="rect" href="arm_8c.html#ac115744fefc54e1e1acd7d195ad340ea" title=" " alt="" coords="1023,81,1171,108"/>
<area shape="rect" href="arm_8c.html#a7ca62759ebd9298965cdc0a399e15a27" title=" " alt="" coords="815,81,975,108"/>
<area shape="rect" href="arm_8c.html#a2dfd4facec6b758ea01c34f9789486d8" title=" " alt="" coords="649,56,767,83"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="653,107,763,133"/>
<area shape="rect" href="arm_8c.html#a0769d67e6376c5081aac75ea3783df2f" title=" " alt="" coords="458,56,562,83"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="204,5,332,32"/>
<area shape="rect" href="arm_8c.html#ac1582780a8801f86aa06da8b95cbcfe9" title=" " alt="" coords="165,56,371,83"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,56,117,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="419,107,601,133"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="209,107,327,133"/>
</map>
</div>

</div>
</div>
<a id="a2c7559bf16232daf5d3187255f1cb70e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c7559bf16232daf5d3187255f1cb70e">&#9670;&nbsp;</a></span>kvm_handle_guest_abort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_handle_guest_abort </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_handle_guest_abort - handles all 2nd stage aborts @vcpu: the VCPU pointer</p>
<p>Any abort that gets to the host is almost guaranteed to be caused by a missing second stage translation table entry, which can mean that either the guest simply needs more memory and we must allocate an appropriate page or it can mean that the guest tried to access I/O memory, which is emulated by user space. The distinction is based on the IPA causing the fault and whether this memory region has been registered as standard RAM by user space. </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01619">1619</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;{</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> esr;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    phys_addr_t fault_ipa;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <span class="keyword">struct </span>kvm_memory_slot *memslot;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> hva;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <span class="keywordtype">bool</span> is_iabt, write_fault, writable;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    gfn_t gfn;</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="keywordtype">int</span> ret, idx;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160; </div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    esr = kvm_vcpu_get_esr(vcpu);</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160; </div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    fault_ipa = kvm_vcpu_get_fault_ipa(vcpu);</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    is_iabt = kvm_vcpu_trap_is_iabt(vcpu);</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160; </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keywordflow">if</span> (esr_fsc_is_translation_fault(esr)) {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        <span class="comment">/* Beyond sanitised PARange (which is the IPA limit) */</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <span class="keywordflow">if</span> (fault_ipa &gt;= BIT_ULL(<a class="code" href="reset_8c.html#a9412cd91f2536c51d45002e1e398b834">get_kvm_ipa_limit</a>())) {</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            <a class="code" href="inject__fault_8c.html#af06cf949a6213151a83a09f3ba25a090">kvm_inject_size_fault</a>(vcpu);</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        }</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160; </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <span class="comment">/* Falls between the IPA range and the PARange? */</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        <span class="keywordflow">if</span> (fault_ipa &gt;= BIT_ULL(vcpu-&gt;arch.hw_mmu-&gt;pgt-&gt;ia_bits)) {</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            fault_ipa |= kvm_vcpu_get_hfar(vcpu) &amp; GENMASK(11, 0);</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160; </div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;            <span class="keywordflow">if</span> (is_iabt)</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                <a class="code" href="inject__fault_8c.html#af59dbe65be21cee976e3dee7750211c6">kvm_inject_pabt</a>(vcpu, fault_ipa);</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                <a class="code" href="inject__fault_8c.html#a770ee85ef976fd0ff1957245fc67f8e6">kvm_inject_dabt</a>(vcpu, fault_ipa);</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        }</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    }</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160; </div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="comment">/* Synchronous External Abort? */</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordflow">if</span> (kvm_vcpu_abt_issea(vcpu)) {</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="comment">         * For RAS the host kernel may handle this abort.</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="comment">         * There is no need to pass the error into the guest.</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <span class="keywordflow">if</span> (kvm_handle_guest_sea(fault_ipa, kvm_vcpu_get_esr(vcpu)))</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            <a class="code" href="inject__fault_8c.html#a22de1c7e33612b2212ecdf333a228340">kvm_inject_vabt</a>(vcpu);</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160; </div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    }</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160; </div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    trace_kvm_guest_fault(*vcpu_pc(vcpu), kvm_vcpu_get_esr(vcpu),</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                  kvm_vcpu_get_hfar(vcpu), fault_ipa);</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160; </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="comment">/* Check the stage-2 fault is trans. fault or write fault */</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keywordflow">if</span> (!esr_fsc_is_translation_fault(esr) &amp;&amp;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        !esr_fsc_is_permission_fault(esr) &amp;&amp;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        !esr_fsc_is_access_flag_fault(esr)) {</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        kvm_err(<span class="stringliteral">&quot;Unsupported FSC: EC=%#x xFSC=%#lx ESR_EL2=%#lx\n&quot;</span>,</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;            kvm_vcpu_trap_get_class(vcpu),</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)kvm_vcpu_trap_get_fault(vcpu),</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)kvm_vcpu_get_esr(vcpu));</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    }</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160; </div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    idx = srcu_read_lock(&amp;vcpu-&gt;kvm-&gt;srcu);</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160; </div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    gfn = fault_ipa &gt;&gt; PAGE_SHIFT;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    memslot = <a class="code" href="kvm__main_8c.html#a7c20e0f654f0b4472c3833f0a563e11e">gfn_to_memslot</a>(vcpu-&gt;kvm, gfn);</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    hva = <a class="code" href="kvm__main_8c.html#adb8a0a4f675ca16ea81acd3b88089f13">gfn_to_hva_memslot_prot</a>(memslot, gfn, &amp;writable);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    write_fault = kvm_is_write_fault(vcpu);</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="keywordflow">if</span> (kvm_is_error_hva(hva) || (write_fault &amp;&amp; !writable)) {</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="comment">         * The guest has put either its instructions or its page-tables</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment">         * somewhere it shouldn&#39;t have. Userspace won&#39;t be able to do</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="comment">         * anything about this (there&#39;s no syndrome for a start), so</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment">         * re-inject the abort back into the guest.</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        <span class="keywordflow">if</span> (is_iabt) {</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;            ret = -ENOEXEC;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        }</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160; </div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="keywordflow">if</span> (kvm_vcpu_abt_iss1tw(vcpu)) {</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;            <a class="code" href="inject__fault_8c.html#a770ee85ef976fd0ff1957245fc67f8e6">kvm_inject_dabt</a>(vcpu, kvm_vcpu_get_hfar(vcpu));</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;            ret = 1;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;            <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        }</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160; </div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">         * Check for a cache maintenance operation. Since we</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">         * ended-up here, we know it is outside of any memory</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">         * slot. But we can&#39;t find out if that is for a device,</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">         * or if the guest is just being stupid. The only thing</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">         * we know for sure is that this range cannot be cached.</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">         * So let&#39;s assume that the guest is just being</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment">         * cautious, and skip the instruction.</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        <span class="keywordflow">if</span> (kvm_is_error_hva(hva) &amp;&amp; kvm_vcpu_dabt_is_cm(vcpu)) {</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;            kvm_incr_pc(vcpu);</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;            ret = 1;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;            <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        }</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160; </div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="comment">         * The IPA is reported as [MAX:12], so we need to</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment">         * complement it with the bottom 12 bits from the</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="comment">         * faulting VA. This is always 12 bits, irrespective</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="comment">         * of the page size.</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        fault_ipa |= kvm_vcpu_get_hfar(vcpu) &amp; ((1 &lt;&lt; 12) - 1);</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        ret = <a class="code" href="mmio_8c.html#adc096fcd3188033af748b5c7fc8fcf4d">io_mem_abort</a>(vcpu, fault_ipa);</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    }</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160; </div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    <span class="comment">/* Userspace should not be able to register out-of-bounds IPAs */</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    VM_BUG_ON(fault_ipa &gt;= kvm_phys_size(vcpu-&gt;arch.hw_mmu));</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <span class="keywordflow">if</span> (esr_fsc_is_access_flag_fault(esr)) {</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        <a class="code" href="mmu_8c.html#ac49a0d8ce00f0f9143e686541ed7a92e">handle_access_fault</a>(vcpu, fault_ipa);</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        ret = 1;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    }</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160; </div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    ret = <a class="code" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb">user_mem_abort</a>(vcpu, fault_ipa, memslot, hva,</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                 esr_fsc_is_permission_fault(esr));</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <span class="keywordflow">if</span> (ret == 0)</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        ret = 1;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;out:</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="keywordflow">if</span> (ret == -ENOEXEC) {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        <a class="code" href="inject__fault_8c.html#af59dbe65be21cee976e3dee7750211c6">kvm_inject_pabt</a>(vcpu, kvm_vcpu_get_hfar(vcpu));</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        ret = 1;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    }</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;out_unlock:</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    srcu_read_unlock(&amp;vcpu-&gt;kvm-&gt;srcu, idx);</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;}</div>
<div class="ttc" id="ainject__fault_8c_html_a22de1c7e33612b2212ecdf333a228340"><div class="ttname"><a href="inject__fault_8c.html#a22de1c7e33612b2212ecdf333a228340">kvm_inject_vabt</a></div><div class="ttdeci">void kvm_inject_vabt(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="inject__fault_8c_source.html#l00251">inject_fault.c:251</a></div></div>
<div class="ttc" id="ainject__fault_8c_html_a770ee85ef976fd0ff1957245fc67f8e6"><div class="ttname"><a href="inject__fault_8c.html#a770ee85ef976fd0ff1957245fc67f8e6">kvm_inject_dabt</a></div><div class="ttdeci">void kvm_inject_dabt(struct kvm_vcpu *vcpu, unsigned long addr)</div><div class="ttdef"><b>Definition:</b> <a href="inject__fault_8c_source.html#l00166">inject_fault.c:166</a></div></div>
<div class="ttc" id="ainject__fault_8c_html_af06cf949a6213151a83a09f3ba25a090"><div class="ttname"><a href="inject__fault_8c.html#af06cf949a6213151a83a09f3ba25a090">kvm_inject_size_fault</a></div><div class="ttdeci">void kvm_inject_size_fault(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="inject__fault_8c_source.html#l00190">inject_fault.c:190</a></div></div>
<div class="ttc" id="ainject__fault_8c_html_af59dbe65be21cee976e3dee7750211c6"><div class="ttname"><a href="inject__fault_8c.html#af59dbe65be21cee976e3dee7750211c6">kvm_inject_pabt</a></div><div class="ttdeci">void kvm_inject_pabt(struct kvm_vcpu *vcpu, unsigned long addr)</div><div class="ttdef"><b>Definition:</b> <a href="inject__fault_8c_source.html#l00182">inject_fault.c:182</a></div></div>
<div class="ttc" id="akvm__main_8c_html_a7c20e0f654f0b4472c3833f0a563e11e"><div class="ttname"><a href="kvm__main_8c.html#a7c20e0f654f0b4472c3833f0a563e11e">gfn_to_memslot</a></div><div class="ttdeci">struct kvm_memory_slot * gfn_to_memslot(struct kvm *kvm, gfn_t gfn)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l02630">kvm_main.c:2630</a></div></div>
<div class="ttc" id="akvm__main_8c_html_adb8a0a4f675ca16ea81acd3b88089f13"><div class="ttname"><a href="kvm__main_8c.html#adb8a0a4f675ca16ea81acd3b88089f13">gfn_to_hva_memslot_prot</a></div><div class="ttdeci">unsigned long gfn_to_hva_memslot_prot(struct kvm_memory_slot *slot, gfn_t gfn, bool *writable)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l02762">kvm_main.c:2762</a></div></div>
<div class="ttc" id="ammio_8c_html_adc096fcd3188033af748b5c7fc8fcf4d"><div class="ttname"><a href="mmio_8c.html#adc096fcd3188033af748b5c7fc8fcf4d">io_mem_abort</a></div><div class="ttdeci">int io_mem_abort(struct kvm_vcpu *vcpu, phys_addr_t fault_ipa)</div><div class="ttdef"><b>Definition:</b> <a href="mmio_8c_source.html#l00123">mmio.c:123</a></div></div>
<div class="ttc" id="ammu_8c_html_a3fa1785b4cbf3b2668c883a3c79fdeeb"><div class="ttname"><a href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb">user_mem_abort</a></div><div class="ttdeci">static int user_mem_abort(struct kvm_vcpu *vcpu, phys_addr_t fault_ipa, struct kvm_memory_slot *memslot, unsigned long hva, bool fault_is_perm)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01377">mmu.c:1377</a></div></div>
<div class="ttc" id="ammu_8c_html_ac49a0d8ce00f0f9143e686541ed7a92e"><div class="ttname"><a href="mmu_8c.html#ac49a0d8ce00f0f9143e686541ed7a92e">handle_access_fault</a></div><div class="ttdeci">static void handle_access_fault(struct kvm_vcpu *vcpu, phys_addr_t fault_ipa)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01592">mmu.c:1592</a></div></div>
<div class="ttc" id="areset_8c_html_a9412cd91f2536c51d45002e1e398b834"><div class="ttname"><a href="reset_8c.html#a9412cd91f2536c51d45002e1e398b834">get_kvm_ipa_limit</a></div><div class="ttdeci">u32 get_kvm_ipa_limit(void)</div><div class="ttdef"><b>Definition:</b> <a href="reset_8c_source.html#l00269">reset.c:269</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a2c7559bf16232daf5d3187255f1cb70e_cgraph.png" border="0" usemap="#ammu_8c_a2c7559bf16232daf5d3187255f1cb70e_cgraph" alt=""/></div>
<map name="ammu_8c_a2c7559bf16232daf5d3187255f1cb70e_cgraph" id="ammu_8c_a2c7559bf16232daf5d3187255f1cb70e_cgraph">
<area shape="rect" title=" " alt="" coords="5,323,192,349"/>
<area shape="rect" href="reset_8c.html#a9412cd91f2536c51d45002e1e398b834" title=" " alt="" coords="251,69,393,96"/>
<area shape="rect" href="kvm__main_8c.html#adb8a0a4f675ca16ea81acd3b88089f13" title=" " alt="" coords="458,1319,650,1345"/>
<area shape="rect" href="kvm__main_8c.html#a7c20e0f654f0b4472c3833f0a563e11e" title=" " alt="" coords="258,196,386,223"/>
<area shape="rect" href="mmu_8c.html#ac49a0d8ce00f0f9143e686541ed7a92e" title=" " alt="" coords="245,461,399,488"/>
<area shape="rect" href="mmio_8c.html#adc096fcd3188033af748b5c7fc8fcf4d" title=" " alt="" coords="264,120,380,147"/>
<area shape="rect" href="inject__fault_8c.html#a770ee85ef976fd0ff1957245fc67f8e6" title=" " alt="" coords="489,309,619,336"/>
<area shape="rect" href="inject__fault_8c.html#af59dbe65be21cee976e3dee7750211c6" title=" " alt="" coords="489,208,619,235"/>
<area shape="rect" href="inject__fault_8c.html#af06cf949a6213151a83a09f3ba25a090" title=" " alt="" coords="240,297,404,324"/>
<area shape="rect" href="inject__fault_8c.html#a22de1c7e33612b2212ecdf333a228340" title=" " alt="" coords="257,399,387,425"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="256,897,388,924"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="720,1319,872,1345"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="936,1319,1099,1345"/>
<area shape="rect" href="pgtable_8c.html#a2e102d0b0bb3c8860d96423371454708" title=" " alt="" coords="475,513,633,554"/>
<area shape="rect" href="kvm__main_8c.html#ad88d3f7ece0c0ad7dce0c296133beccb" title=" " alt="" coords="467,461,641,488"/>
<area shape="rect" href="pgtable_8c.html#a479db5e7d44bd0ef2092407a91bd04b3" title=" " alt="" coords="721,578,871,619"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="945,825,1090,852"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="704,461,888,488"/>
<area shape="rect" href="mmio_8c.html#a9f31b035a6b37c1f9183f31d083fa989" title=" " alt="" coords="457,107,651,133"/>
<area shape="rect" href="kvm__main_8c.html#a32f50a4f2293b3acdeece0c22abe8ecc" title=" " alt="" coords="486,157,622,184"/>
<area shape="rect" href="kvm__main_8c.html#ac2e936ae65c010ffa196cedbc40350ee" title=" " alt="" coords="484,5,624,32"/>
<area shape="rect" href="mmio_8c.html#a69a057e58ecb01c2cdf3d945b5b30504" title=" " alt="" coords="472,56,636,83"/>
<area shape="rect" href="mmio_8c.html#ad2b3112397caf922586ad4b13cf17576" title=" " alt="" coords="716,107,876,133"/>
<area shape="rect" href="kvm__main_8c.html#a7561a833c4222778fb37a7e0f9e97e96" title=" " alt="" coords="721,157,871,184"/>
<area shape="rect" href="kvm__main_8c.html#a484b5f7e2c7e682cb49450f611319077" title=" " alt="" coords="719,5,873,32"/>
<area shape="rect" href="inject__fault_8c.html#a2bfa90949caca5bddb96723105598b03" title=" " alt="" coords="745,309,847,336"/>
<area shape="rect" href="inject__fault_8c.html#a62c2f556fa6a43b0372827ca9a3a8017" title=" " alt="" coords="745,208,847,235"/>
<area shape="rect" href="sys__regs_8c.html#a79848758fc91bd6081326514833ffafa" title=" " alt="" coords="944,309,1091,336"/>
<area shape="rect" href="sys__regs_8c.html#adf66277e472bdae2cc839d450085bc4b" title=" " alt="" coords="942,259,1093,285"/>
<area shape="rect" href="sys__regs_8c.html#a8f5bcf4d21c4d9b1881dd3fec5bd6178" title=" " alt="" coords="1147,284,1328,311"/>
<area shape="rect" href="inject__fault_8c.html#a326fe690ce371beb7496d3ed3cbe1a6e" title=" " alt="" coords="953,157,1081,184"/>
<area shape="rect" href="inject__fault_8c.html#a887586bbc6bac834ae37cbf84711288c" title=" " alt="" coords="936,208,1099,235"/>
<area shape="rect" href="inject__fault_8c.html#add5913f66290fa09779d83f20800e7f1" title=" " alt="" coords="489,411,619,437"/>
<area shape="rect" href="kvm__main_8c.html#a63ec3e18db03a212e6e84391b5025689" title=" " alt="" coords="469,1268,639,1295"/>
<area shape="rect" href="mmu_8c.html#ab90d07a850ec184a5284c06e0873d82d" title=" " alt="" coords="713,993,879,1034"/>
<area shape="rect" href="mmu_8c.html#a2478e510130e93368b79931c58135c1b" title=" " alt="" coords="477,1116,631,1143"/>
<area shape="rect" href="mmu_8c.html#a207285372ad7944209b485ecfc10ee0f" title=" " alt="" coords="481,1217,627,1244"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="457,1167,651,1193"/>
<area shape="rect" href="pgtable_8c.html#a0b075f0350506df70d46e1744f9eb54b" title=" " alt="" coords="475,578,633,619"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="466,644,642,671"/>
<area shape="rect" href="mmu_8c.html#ab06707336ef5d30b56abbfd801d2f756" title=" " alt="" coords="452,695,656,721"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="483,745,625,772"/>
<area shape="rect" href="mmu_8c.html#ad2c3caa2e6c80158e1818c521d188e45" title=" " alt="" coords="465,796,643,823"/>
<area shape="rect" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15" title=" " alt="" coords="463,847,645,873"/>
<area shape="rect" href="mmu_8c.html#ae621c40a28e874f5d7bdb502c2dec724" title=" " alt="" coords="477,897,631,924"/>
<area shape="rect" href="mmu_8c.html#a44914d574274fbd2a9a2afb90649f15c" title=" " alt="" coords="483,948,625,975"/>
<area shape="rect" href="mmu_8c.html#a6a713dc5a6d09de79232b38705dd1896" title=" " alt="" coords="470,1050,638,1091"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="749,1217,843,1244"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="720,1116,872,1143"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="718,1167,874,1193"/>
</map>
</div>

</div>
</div>
<a id="a6c597babff3bfa97bd093b9dd7484487"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c597babff3bfa97bd093b9dd7484487">&#9670;&nbsp;</a></span>kvm_host_get_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_host_get_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00239">239</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;{</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    get_page(virt_to_page(addr));</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af214df14aaaac0cc598374356bc3bc5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af214df14aaaac0cc598374356bc3bc5b">&#9670;&nbsp;</a></span>kvm_host_owns_hyp_mappings()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_host_owns_hyp_mappings </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00383">383</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;{</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (is_kernel_in_hyp_mode())</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">if</span> (static_branch_likely(&amp;kvm_protected_mode_initialized))</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">     * This can happen at boot time when __create_hyp_mappings() is called</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">     * after the hyp protection has been enabled, but the static key has</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">     * not been flipped yet.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a> &amp;&amp; is_protected_kvm_enabled())</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    WARN_ON(!<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_af214df14aaaac0cc598374356bc3bc5b_icgraph.png" border="0" usemap="#ammu_8c_af214df14aaaac0cc598374356bc3bc5b_icgraph" alt=""/></div>
<map name="ammu_8c_af214df14aaaac0cc598374356bc3bc5b_icgraph" id="ammu_8c_af214df14aaaac0cc598374356bc3bc5b_icgraph">
<area shape="rect" title=" " alt="" coords="2476,237,2705,264"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="2249,165,2428,192"/>
<area shape="rect" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d" title=" " alt="" coords="2019,49,2181,90"/>
<area shape="rect" href="mmu_8c.html#a2fae287f6a52db1bbfdcb7483ba623ca" title=" " alt="" coords="2017,237,2183,264"/>
<area shape="rect" href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d" title=" " alt="" coords="1787,309,1912,336"/>
<area shape="rect" href="mmu_8c.html#abeed34d3f32ae7e76a83700117b7b92a" title=" " alt="" coords="2268,411,2409,437"/>
<area shape="rect" href="mmu_8c.html#a3fba24b69d86984f627f9fcceae1832b" title=" " alt="" coords="2032,165,2168,192"/>
<area shape="rect" href="mmu_8c.html#a20cb0043b9509d378ec75a5dc6d73490" title=" " alt="" coords="2016,115,2184,141"/>
<area shape="rect" href="mmu_8c.html#a071b366c66edcb7357907375ecd4271d" title=" " alt="" coords="1748,5,1951,32"/>
<area shape="rect" href="mmu_8c.html#af062326f5ca9b42e66721620681afc52" title=" " alt="" coords="1757,56,1941,83"/>
<area shape="rect" href="arm_8c.html#a38e1fd55313dedd5e69b738bff1f88a8" title=" " alt="" coords="1024,5,1189,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="828,56,940,83"/>
<area shape="rect" href="vgic-v2_8c.html#aa3e64817232a1ce5658b7f3147f7f554" title=" " alt="" coords="1538,56,1654,83"/>
<area shape="rect" href="vgic-init_8c.html#aba3547aa220ca50b1eabca1a39c92943" title=" " alt="" coords="1272,56,1416,83"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="1043,56,1171,83"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="1537,157,1655,184"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="1758,259,1941,285"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="1525,411,1667,437"/>
<area shape="rect" href="arm_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="1510,360,1682,387"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="1492,309,1700,336"/>
<area shape="rect" href="reset_8c.html#a82e2644a8e182c72a70fa52b0a0acae9" title=" " alt="" coords="1509,257,1683,284"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="620,411,747,437"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,407,405,433"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1244,360,1444,387"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="1017,306,1196,347"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="822,284,946,311"/>
<area shape="rect" href="reset_8c.html#ae95bc53f52db3e69595fd0a53c8bc8fb" title=" " alt="" coords="1256,256,1432,283"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="1027,255,1186,281"/>
<area shape="rect" href="mmu_8c.html#a8883f6dc057c02e4b13267961859208b" title=" " alt="" coords="1789,107,1909,133"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="799,464,969,491"/>
<area shape="rect" href="reset_8c.html#ae42f979a2e15b7e51c3e3dfc133cb473" title=" " alt="" coords="1760,411,1939,437"/>
<area shape="rect" href="fpsimd_8c.html#a4a413d27f1db48bf29f9bdb738ab0b94" title=" " alt="" coords="1999,360,2201,387"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="616,489,751,516"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="453,501,568,528"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,609,383,636"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,457,391,484"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,508,386,535"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,559,376,585"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,609,164,636"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1506,461,1686,488"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1271,461,1417,488"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1031,461,1183,488"/>
</map>
</div>

</div>
</div>
<a id="a623efd55548e897162a46d8da0043070"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a623efd55548e897162a46d8da0043070">&#9670;&nbsp;</a></span>kvm_host_pa()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static phys_addr_t kvm_host_pa </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00263">263</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;{</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">return</span> __pa(addr);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a623efd55548e897162a46d8da0043070_icgraph.png" border="0" usemap="#ammu_8c_a623efd55548e897162a46d8da0043070_icgraph" alt=""/></div>
<map name="ammu_8c_a623efd55548e897162a46d8da0043070_icgraph" id="ammu_8c_a623efd55548e897162a46d8da0043070_icgraph">
<area shape="rect" title=" " alt="" coords="223,5,332,32"/>
<area shape="rect" href="mmu_8c.html#a0635e0487ba31d99ba782cb5e43534ef" title=" " alt="" coords="5,5,175,32"/>
</map>
</div>

</div>
</div>
<a id="a20ef7c89f7bdbdb317ac7ec7174fff5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20ef7c89f7bdbdb317ac7ec7174fff5f">&#9670;&nbsp;</a></span>kvm_host_page_count()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_host_page_count </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00258">258</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;{</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">return</span> page_count(virt_to_page(addr));</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af821b375f4c13aa4b873b5110fa3b503"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af821b375f4c13aa4b873b5110fa3b503">&#9670;&nbsp;</a></span>kvm_host_put_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_host_put_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00244">244</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;{</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    put_page(virt_to_page(addr));</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2a7af09cc56dc8cd69de6c8d2acacd12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a7af09cc56dc8cd69de6c8d2acacd12">&#9670;&nbsp;</a></span>kvm_host_va()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* kvm_host_va </td>
          <td>(</td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>phys</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00268">268</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;{</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">return</span> __va(phys);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a2a7af09cc56dc8cd69de6c8d2acacd12_icgraph.png" border="0" usemap="#ammu_8c_a2a7af09cc56dc8cd69de6c8d2acacd12_icgraph" alt=""/></div>
<map name="ammu_8c_a2a7af09cc56dc8cd69de6c8d2acacd12_icgraph" id="ammu_8c_a2a7af09cc56dc8cd69de6c8d2acacd12_icgraph">
<area shape="rect" title=" " alt="" coords="1744,46,1853,73"/>
<area shape="rect" href="mmu_8c.html#aee4de5a2c1110217af2d89d21e21a216" title=" " alt="" coords="1537,46,1696,73"/>
<area shape="rect" href="pkvm_8c.html#abd259bb0db17ae7c75a8940360667c32" title=" " alt="" coords="1301,46,1489,73"/>
<area shape="rect" href="pkvm_8c.html#ac6f8b05fc1474ed8f561ddb8f7fa3a96" title=" " alt="" coords="1073,21,1253,47"/>
<area shape="rect" href="pkvm_8c.html#a0de2dfe512399e7f17c01091bc3e8ae8" title=" " alt="" coords="1076,71,1251,98"/>
<area shape="rect" href="pkvm_8c.html#a9c8ae8a0a845f44545cd6b7819f3430e" title=" " alt="" coords="857,17,1023,43"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="628,5,807,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="455,13,579,39"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="855,71,1025,98"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="453,67,580,94"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="650,133,785,159"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,58,405,85"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="459,154,574,181"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,109,383,135"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,159,391,186"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,210,386,237"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,261,376,287"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,109,164,135"/>
</map>
</div>

</div>
</div>
<a id="ae792e5a1690d87277dc72552467b205e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae792e5a1690d87277dc72552467b205e">&#9670;&nbsp;</a></span>kvm_host_zalloc_pages_exact()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* kvm_host_zalloc_pages_exact </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00200">200</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;{</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">return</span> alloc_pages_exact(<a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, GFP_KERNEL_ACCOUNT | __GFP_ZERO);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ae792e5a1690d87277dc72552467b205e_icgraph.png" border="0" usemap="#ammu_8c_ae792e5a1690d87277dc72552467b205e_icgraph" alt=""/></div>
<map name="ammu_8c_ae792e5a1690d87277dc72552467b205e_icgraph" id="ammu_8c_ae792e5a1690d87277dc72552467b205e_icgraph">
<area shape="rect" title=" " alt="" coords="217,5,395,47"/>
<area shape="rect" href="mmu_8c.html#aaaa2b0d256c20dcfcfae2767ce907846" title=" " alt="" coords="5,5,169,47"/>
</map>
</div>

</div>
</div>
<a id="ab59f0fbc119723d99cf43ad72a22f70b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab59f0fbc119723d99cf43ad72a22f70b">&#9670;&nbsp;</a></span>kvm_hyp_zalloc_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* kvm_hyp_zalloc_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01845">1845</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;{</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)get_zeroed_page(GFP_KERNEL);</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af680391e7bf182f929f772acd512f336"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af680391e7bf182f929f772acd512f336">&#9670;&nbsp;</a></span>kvm_init_stage2_mmu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_init_stage2_mmu </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_s2_mmu *&#160;</td>
          <td class="paramname"><em>mmu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_init_stage2_mmu - Initialise a S2 MMU structure @kvm: The pointer to the KVM structure @mmu: The pointer to the s2 MMU structure @type: The machine type of the virtual machine</p>
<p>Allocates only the stage-2 HW PGD level table(s). Note we don't need locking here as this is only called when the VM is created, which can only be done once. </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00868">868</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;{</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    u32 <a class="code" href="reset_8c.html#a9679fd9a1fc8d425b993f925a7f11e91">kvm_ipa_limit</a> = <a class="code" href="reset_8c.html#a9412cd91f2536c51d45002e1e398b834">get_kvm_ipa_limit</a>();</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordtype">int</span> cpu, err;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="keyword">struct </span>kvm_pgtable *pgt;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    u64 mmfr0, mmfr1;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    u32 phys_shift;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">if</span> (type &amp; ~KVM_VM_TYPE_ARM_IPA_SIZE_MASK)</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160; </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    phys_shift = KVM_VM_TYPE_ARM_IPA_SIZE(type);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keywordflow">if</span> (is_protected_kvm_enabled()) {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        phys_shift = <a class="code" href="reset_8c.html#a9679fd9a1fc8d425b993f925a7f11e91">kvm_ipa_limit</a>;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (phys_shift) {</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <span class="keywordflow">if</span> (phys_shift &gt; <a class="code" href="reset_8c.html#a9679fd9a1fc8d425b993f925a7f11e91">kvm_ipa_limit</a> ||</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            phys_shift &lt; ARM64_MIN_PARANGE_BITS)</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        phys_shift = KVM_PHYS_SHIFT;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">if</span> (phys_shift &gt; <a class="code" href="reset_8c.html#a9679fd9a1fc8d425b993f925a7f11e91">kvm_ipa_limit</a>) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            pr_warn_once(<span class="stringliteral">&quot;%s using unsupported default IPA limit, upgrade your VMM\n&quot;</span>,</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                     current-&gt;comm);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    mmfr0 = read_sanitised_ftr_reg(SYS_ID_AA64MMFR0_EL1);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    mmfr1 = read_sanitised_ftr_reg(SYS_ID_AA64MMFR1_EL1);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    mmu-&gt;vtcr = <a class="code" href="pgtable_8c.html#a948c862fc5ae665c8a41b4daa4a85518">kvm_get_vtcr</a>(mmfr0, mmfr1, phys_shift);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">if</span> (mmu-&gt;pgt != NULL) {</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        kvm_err(<span class="stringliteral">&quot;kvm_arch already initialized?\n&quot;</span>);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    pgt = kzalloc(<span class="keyword">sizeof</span>(*pgt), GFP_KERNEL_ACCOUNT);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">if</span> (!pgt)</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    mmu-&gt;arch = &amp;kvm-&gt;arch;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    err = kvm_pgtable_stage2_init(pgt, mmu, &amp;<a class="code" href="mmu_8c.html#a76e73dbe0eaa8e135824fd27a72cac9d">kvm_s2_mm_ops</a>);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keywordflow">goto</span> out_free_pgtable;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    mmu-&gt;last_vcpu_ran = alloc_percpu(typeof(*mmu-&gt;last_vcpu_ran));</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">if</span> (!mmu-&gt;last_vcpu_ran) {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        err = -ENOMEM;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="keywordflow">goto</span> out_destroy_pgtable;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    for_each_possible_cpu(cpu)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        *per_cpu_ptr(mmu-&gt;last_vcpu_ran, cpu) = -1;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;     <span class="comment">/* The eager page splitting is disabled by default */</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    mmu-&gt;split_page_chunk_size = KVM_ARM_EAGER_SPLIT_CHUNK_SIZE_DEFAULT;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    mmu-&gt;split_page_cache.gfp_zero = __GFP_ZERO;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; </div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    mmu-&gt;pgt = pgt;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    mmu-&gt;pgd_phys = __pa(pgt-&gt;pgd);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160; </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;out_destroy_pgtable:</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <a class="code" href="pgtable_8c.html#ab0ed17e7108aa47fbba6cbdfea0b6606">kvm_pgtable_stage2_destroy</a>(pgt);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;out_free_pgtable:</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    kfree(pgt);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a76e73dbe0eaa8e135824fd27a72cac9d"><div class="ttname"><a href="mmu_8c.html#a76e73dbe0eaa8e135824fd27a72cac9d">kvm_s2_mm_ops</a></div><div class="ttdeci">static struct kvm_pgtable_mm_ops kvm_s2_mm_ops</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00214">mmu.c:220</a></div></div>
<div class="ttc" id="apgtable_8c_html_a948c862fc5ae665c8a41b4daa4a85518"><div class="ttname"><a href="pgtable_8c.html#a948c862fc5ae665c8a41b4daa4a85518">kvm_get_vtcr</a></div><div class="ttdeci">u64 kvm_get_vtcr(u64 mmfr0, u64 mmfr1, u32 phys_shift)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l00634">pgtable.c:634</a></div></div>
<div class="ttc" id="areset_8c_html_a9679fd9a1fc8d425b993f925a7f11e91"><div class="ttname"><a href="reset_8c.html#a9679fd9a1fc8d425b993f925a7f11e91">kvm_ipa_limit</a></div><div class="ttdeci">static u32 __ro_after_init kvm_ipa_limit</div><div class="ttdef"><b>Definition:</b> <a href="reset_8c_source.html#l00034">reset.c:34</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_af680391e7bf182f929f772acd512f336_cgraph.png" border="0" usemap="#ammu_8c_af680391e7bf182f929f772acd512f336_cgraph" alt=""/></div>
<map name="ammu_8c_af680391e7bf182f929f772acd512f336_cgraph" id="ammu_8c_af680391e7bf182f929f772acd512f336_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,176,83"/>
<area shape="rect" href="reset_8c.html#a9412cd91f2536c51d45002e1e398b834" title=" " alt="" coords="232,5,375,32"/>
<area shape="rect" href="pgtable_8c.html#a948c862fc5ae665c8a41b4daa4a85518" title=" " alt="" coords="248,56,359,83"/>
<area shape="rect" href="pgtable_8c.html#ab0ed17e7108aa47fbba6cbdfea0b6606" title=" " alt="" coords="224,107,383,149"/>
<area shape="rect" href="pgtable_8c.html#ab68001fdf94eab0c95183a0d99df3576" title=" " alt="" coords="636,64,764,91"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="431,115,576,141"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="1034,165,1183,192"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="829,64,977,91"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="624,115,776,141"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="824,115,983,141"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1031,115,1187,141"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1041,64,1176,91"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1250,64,1427,91"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1235,13,1443,40"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1275,165,1402,192"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1279,115,1398,141"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1253,216,1424,243"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_af680391e7bf182f929f772acd512f336_icgraph.png" border="0" usemap="#ammu_8c_af680391e7bf182f929f772acd512f336_icgraph" alt=""/></div>
<map name="ammu_8c_af680391e7bf182f929f772acd512f336_icgraph" id="ammu_8c_af680391e7bf182f929f772acd512f336_icgraph">
<area shape="rect" title=" " alt="" coords="612,5,783,32"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="421,5,564,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="247,5,373,32"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="5,5,199,32"/>
</map>
</div>

</div>
</div>
<a id="a207285372ad7944209b485ecfc10ee0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a207285372ad7944209b485ecfc10ee0f">&#9670;&nbsp;</a></span>kvm_is_device_pfn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_is_device_pfn </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>pfn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00183">183</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> !pfn_is_map_memory(pfn);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a207285372ad7944209b485ecfc10ee0f_icgraph.png" border="0" usemap="#ammu_8c_a207285372ad7944209b485ecfc10ee0f_icgraph" alt=""/></div>
<map name="ammu_8c_a207285372ad7944209b485ecfc10ee0f_icgraph" id="ammu_8c_a207285372ad7944209b485ecfc10ee0f_icgraph">
<area shape="rect" title=" " alt="" coords="420,5,567,32"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="240,5,372,32"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,5,192,32"/>
</map>
</div>

</div>
</div>
<a id="a5ba832c8135d5fbf5fed763356c0a2b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ba832c8135d5fbf5fed763356c0a2b7">&#9670;&nbsp;</a></span>kvm_kaddr_to_phys()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static phys_addr_t kvm_kaddr_to_phys </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>kaddr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00419">419</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;{</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> (!is_vmalloc_addr(kaddr)) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        BUG_ON(!virt_addr_valid(kaddr));</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">return</span> __pa(kaddr);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">return</span> page_to_phys(vmalloc_to_page(kaddr)) +</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;               offset_in_page(kaddr);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a5ba832c8135d5fbf5fed763356c0a2b7_icgraph.png" border="0" usemap="#ammu_8c_a5ba832c8135d5fbf5fed763356c0a2b7_icgraph" alt=""/></div>
<map name="ammu_8c_a5ba832c8135d5fbf5fed763356c0a2b7_icgraph" id="ammu_8c_a5ba832c8135d5fbf5fed763356c0a2b7_icgraph">
<area shape="rect" title=" " alt="" coords="1367,56,1519,83"/>
<area shape="rect" href="mmu_8c.html#a2fae287f6a52db1bbfdcb7483ba623ca" title=" " alt="" coords="1153,56,1319,83"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="711,5,830,32"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="923,56,1105,83"/>
<area shape="rect" href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d" title=" " alt="" coords="951,107,1077,133"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="463,5,575,32"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="699,56,842,83"/>
<area shape="rect" href="arm_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="685,107,857,133"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="667,157,875,184"/>
<area shape="rect" href="reset_8c.html#a82e2644a8e182c72a70fa52b0a0acae9" title=" " alt="" coords="684,208,857,235"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="455,56,582,83"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="177,56,371,83"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="419,107,619,133"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="185,147,363,189"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,184,129,211"/>
<area shape="rect" href="reset_8c.html#ae95bc53f52db3e69595fd0a53c8bc8fb" title=" " alt="" coords="431,209,607,236"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="195,213,353,240"/>
</map>
</div>

</div>
</div>
<a id="a20cb0043b9509d378ec75a5dc6d73490"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20cb0043b9509d378ec75a5dc6d73490">&#9670;&nbsp;</a></span>kvm_map_idmap_text()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_map_idmap_text </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01833">1833</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;{</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = <a class="code" href="mmu_8c.html#af6cad154e151b78389f796d53eab3e4a">hyp_idmap_end</a> - <a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a>;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="keywordtype">int</span> err = <a class="code" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877">__create_hyp_mappings</a>(<a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a>, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a>,</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                    PAGE_HYP_EXEC);</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        kvm_err(<span class="stringliteral">&quot;Failed to idmap %lx-%lx\n&quot;</span>,</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;            <a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a>, <a class="code" href="mmu_8c.html#af6cad154e151b78389f796d53eab3e4a">hyp_idmap_end</a>);</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160; </div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a2bc1b7b9ac3d075fa1fe50ad08a3a200"><div class="ttname"><a href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a></div><div class="ttdeci">static unsigned long __ro_after_init hyp_idmap_start</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00028">mmu.c:28</a></div></div>
<div class="ttc" id="ammu_8c_html_af6cad154e151b78389f796d53eab3e4a"><div class="ttname"><a href="mmu_8c.html#af6cad154e151b78389f796d53eab3e4a">hyp_idmap_end</a></div><div class="ttdeci">static unsigned long __ro_after_init hyp_idmap_end</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00029">mmu.c:29</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a20cb0043b9509d378ec75a5dc6d73490_cgraph.png" border="0" usemap="#ammu_8c_a20cb0043b9509d378ec75a5dc6d73490_cgraph" alt=""/></div>
<map name="ammu_8c_a20cb0043b9509d378ec75a5dc6d73490_cgraph" id="ammu_8c_a20cb0043b9509d378ec75a5dc6d73490_cgraph">
<area shape="rect" title=" " alt="" coords="5,75,173,101"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="221,75,400,101"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="448,49,677,76"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="475,100,650,127"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="732,49,864,76"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="730,100,866,127"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="725,151,871,177"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="919,37,1108,64"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="940,88,1087,115"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1156,5,1385,32"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1181,56,1360,83"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1438,5,1585,32"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="937,151,1089,177"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1191,125,1350,152"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1197,176,1345,203"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1433,125,1589,152"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1444,176,1579,203"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1653,49,1830,76"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1637,100,1845,127"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1678,151,1805,177"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1682,201,1801,228"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a20cb0043b9509d378ec75a5dc6d73490_icgraph.png" border="0" usemap="#ammu_8c_a20cb0043b9509d378ec75a5dc6d73490_icgraph" alt=""/></div>
<map name="ammu_8c_a20cb0043b9509d378ec75a5dc6d73490_icgraph" id="ammu_8c_a20cb0043b9509d378ec75a5dc6d73490_icgraph">
<area shape="rect" title=" " alt="" coords="500,5,668,32"/>
<area shape="rect" href="mmu_8c.html#a8883f6dc057c02e4b13267961859208b" title=" " alt="" coords="332,5,452,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="a026808c9bdc25fe4f5fe63ae798aa797"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a026808c9bdc25fe4f5fe63ae798aa797">&#9670;&nbsp;</a></span>kvm_mmu_get_httbr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">phys_addr_t kvm_mmu_get_httbr </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01823">1823</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;{</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <span class="keywordflow">return</span> __pa(<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>-&gt;pgd);</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a026808c9bdc25fe4f5fe63ae798aa797_icgraph.png" border="0" usemap="#ammu_8c_a026808c9bdc25fe4f5fe63ae798aa797_icgraph" alt=""/></div>
<map name="ammu_8c_a026808c9bdc25fe4f5fe63ae798aa797_icgraph" id="ammu_8c_a026808c9bdc25fe4f5fe63ae798aa797_icgraph">
<area shape="rect" title=" " alt="" coords="557,5,716,32"/>
<area shape="rect" href="arm_8c.html#adc1e019ce38ec5466a2d38290629e776" title=" " alt="" coords="332,5,509,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="a8883f6dc057c02e4b13267961859208b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8883f6dc057c02e4b13267961859208b">&#9670;&nbsp;</a></span>kvm_mmu_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __init kvm_mmu_init </td>
          <td>(</td>
          <td class="paramtype">u32 *&#160;</td>
          <td class="paramname"><em>hyp_va_bits</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01858">1858</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;{</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    u32 idmap_bits;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    u32 kernel_bits;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160; </div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a> = __pa_symbol(__hyp_idmap_text_start);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a> = ALIGN_DOWN(<a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a>, PAGE_SIZE);</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <a class="code" href="mmu_8c.html#af6cad154e151b78389f796d53eab3e4a">hyp_idmap_end</a> = __pa_symbol(__hyp_idmap_text_end);</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <a class="code" href="mmu_8c.html#af6cad154e151b78389f796d53eab3e4a">hyp_idmap_end</a> = ALIGN(<a class="code" href="mmu_8c.html#af6cad154e151b78389f796d53eab3e4a">hyp_idmap_end</a>, PAGE_SIZE);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <a class="code" href="mmu_8c.html#a5d2511e33617fa741938a584dc513895">hyp_idmap_vector</a> = __pa_symbol(__kvm_hyp_init);</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160; </div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment">     * We rely on the linker script to ensure at build time that the HYP</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment">     * init code does not cross a page boundary.</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    BUG_ON((<a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a> ^ (<a class="code" href="mmu_8c.html#af6cad154e151b78389f796d53eab3e4a">hyp_idmap_end</a> - 1)) &amp; PAGE_MASK);</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160; </div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">     * The ID map may be configured to use an extended virtual address</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment">     * range. This is only the case if system RAM is out of range for the</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment">     * currently configured page size and VA_BITS_MIN, in which case we will</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">     * also need the extended virtual range for the HYP ID map, or we won&#39;t</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">     * be able to enable the EL2 MMU.</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">     * However, in some cases the ID map may be configured for fewer than</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">     * the number of VA bits used by the regular kernel stage 1. This</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">     * happens when VA_BITS=52 and the kernel image is placed in PA space</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">     * below 48 bits.</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">     * At EL2, there is only one TTBR register, and we can&#39;t switch between</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">     * translation tables *and* update TCR_EL2.T0SZ at the same time. Bottom</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">     * line: we need to use the extended range with *both* our translation</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">     * tables.</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">     * So use the maximum of the idmap VA bits and the regular kernel stage</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">     * 1 VA bits to assure that the hypervisor can both ID map its code page</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">     * and map any kernel memory.</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    idmap_bits = 64 - ((idmap_t0sz &amp; TCR_T0SZ_MASK) &gt;&gt; TCR_T0SZ_OFFSET);</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    kernel_bits = vabits_actual;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    *hyp_va_bits = max(idmap_bits, kernel_bits);</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160; </div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    kvm_debug(<span class="stringliteral">&quot;Using %u-bit virtual addresses at EL2\n&quot;</span>, *hyp_va_bits);</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    kvm_debug(<span class="stringliteral">&quot;IDMAP page: %lx\n&quot;</span>, <a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a>);</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    kvm_debug(<span class="stringliteral">&quot;HYP VA range: %lx:%lx\n&quot;</span>,</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;          kern_hyp_va(PAGE_OFFSET),</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;          kern_hyp_va((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)high_memory - 1));</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160; </div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a> &gt;= kern_hyp_va(PAGE_OFFSET) &amp;&amp;</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;        <a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a> &lt;  kern_hyp_va((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)high_memory - 1) &amp;&amp;</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a> != (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)__hyp_idmap_text_start) {</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment">         * The idmap page is intersecting with the VA space,</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment">         * it is not safe to continue further.</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        kvm_err(<span class="stringliteral">&quot;IDMAP intersecting with HYP VA, unable to continue\n&quot;</span>);</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        err = -EINVAL;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    }</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160; </div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a> = kzalloc(<span class="keyword">sizeof</span>(*<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>), GFP_KERNEL);</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>) {</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        kvm_err(<span class="stringliteral">&quot;Hyp mode page-table not allocated\n&quot;</span>);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        err = -ENOMEM;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    }</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160; </div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    err = <a class="code" href="pgtable_8c.html#a9bf9cde257aa21bdb012231087127d17">kvm_pgtable_hyp_init</a>(<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>, *hyp_va_bits, &amp;<a class="code" href="mmu_8c.html#a626ee9bc458a919c07c36ddd5af0fabe">kvm_hyp_mm_ops</a>);</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        <span class="keywordflow">goto</span> out_free_pgtable;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    err = <a class="code" href="mmu_8c.html#a20cb0043b9509d378ec75a5dc6d73490">kvm_map_idmap_text</a>();</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;        <span class="keywordflow">goto</span> out_destroy_pgtable;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160; </div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <a class="code" href="mmu_8c.html#a96b25c9a789e7df5d189d35f1ada4100">io_map_base</a> = <a class="code" href="mmu_8c.html#a2bc1b7b9ac3d075fa1fe50ad08a3a200">hyp_idmap_start</a>;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160; </div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;out_destroy_pgtable:</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <a class="code" href="pgtable_8c.html#aea86ed51326c8d744c425824e91bc017">kvm_pgtable_hyp_destroy</a>(<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>);</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;out_free_pgtable:</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    kfree(<a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a>);</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <a class="code" href="mmu_8c.html#a56796191d3fb3abd9372b422b9abd52b">hyp_pgtable</a> = NULL;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;out:</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a20cb0043b9509d378ec75a5dc6d73490"><div class="ttname"><a href="mmu_8c.html#a20cb0043b9509d378ec75a5dc6d73490">kvm_map_idmap_text</a></div><div class="ttdeci">static int kvm_map_idmap_text(void)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01833">mmu.c:1833</a></div></div>
<div class="ttc" id="ammu_8c_html_a626ee9bc458a919c07c36ddd5af0fabe"><div class="ttname"><a href="mmu_8c.html#a626ee9bc458a919c07c36ddd5af0fabe">kvm_hyp_mm_ops</a></div><div class="ttdeci">static struct kvm_pgtable_mm_ops kvm_hyp_mm_ops</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01845">mmu.c:1850</a></div></div>
<div class="ttc" id="apgtable_8c_html_a9bf9cde257aa21bdb012231087127d17"><div class="ttname"><a href="pgtable_8c.html#a9bf9cde257aa21bdb012231087127d17">kvm_pgtable_hyp_init</a></div><div class="ttdeci">int kvm_pgtable_hyp_init(struct kvm_pgtable *pgt, u32 va_bits, struct kvm_pgtable_mm_ops *mm_ops)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l00568">pgtable.c:568</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a8883f6dc057c02e4b13267961859208b_cgraph.png" border="0" usemap="#ammu_8c_a8883f6dc057c02e4b13267961859208b_cgraph" alt=""/></div>
<map name="ammu_8c_a8883f6dc057c02e4b13267961859208b_cgraph" id="ammu_8c_a8883f6dc057c02e4b13267961859208b_cgraph">
<area shape="rect" title=" " alt="" coords="5,215,125,241"/>
<area shape="rect" href="mmu_8c.html#a20cb0043b9509d378ec75a5dc6d73490" title=" " alt="" coords="173,164,341,191"/>
<area shape="rect" href="pgtable_8c.html#aea86ed51326c8d744c425824e91bc017" title=" " alt="" coords="633,215,828,241"/>
<area shape="rect" href="pgtable_8c.html#a9bf9cde257aa21bdb012231087127d17" title=" " alt="" coords="174,265,341,292"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="389,164,568,191"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="616,164,845,191"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="643,113,818,140"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="900,63,1032,89"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="898,113,1034,140"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="893,164,1039,191"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="1087,56,1276,83"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1108,107,1255,133"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1324,56,1553,83"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1349,5,1528,32"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1606,56,1753,83"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1105,157,1257,184"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1359,157,1518,184"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1365,107,1513,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1601,151,1757,177"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1612,201,1747,228"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1821,100,1998,127"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1805,151,2013,177"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1846,201,1973,228"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1850,252,1969,279"/>
<area shape="rect" href="pgtable_8c.html#a781f5f5589239d7f1de59faba9e39425" title=" " alt="" coords="1615,252,1744,279"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a8883f6dc057c02e4b13267961859208b_icgraph.png" border="0" usemap="#ammu_8c_a8883f6dc057c02e4b13267961859208b_icgraph" alt=""/></div>
<map name="ammu_8c_a8883f6dc057c02e4b13267961859208b_icgraph" id="ammu_8c_a8883f6dc057c02e4b13267961859208b_icgraph">
<area shape="rect" title=" " alt="" coords="332,5,452,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="adf6f75ecf7d564f9aa7b446e6a236d2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf6f75ecf7d564f9aa7b446e6a236d2d">&#9670;&nbsp;</a></span>kvm_mmu_split_huge_pages()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_mmu_split_huge_pages </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00114">114</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keyword">struct </span>kvm_mmu_memory_cache *cache;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keyword">struct </span>kvm_pgtable *pgt;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordtype">int</span> ret, cache_capacity;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    u64 next, chunk_size;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    lockdep_assert_held_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    chunk_size = kvm-&gt;arch.mmu.split_page_chunk_size;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    cache_capacity = <a class="code" href="mmu_8c.html#a62047c119e6707e0579424df7ab7bd77">kvm_mmu_split_nr_page_tables</a>(chunk_size);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">if</span> (chunk_size == 0)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    cache = &amp;kvm-&gt;arch.mmu.split_page_cache;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="mmu_8c.html#abfda6046e28c6dfc58730ef92bee6f3a">need_split_memcache_topup_or_resched</a>(kvm)) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            write_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            cond_resched();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            <span class="comment">/* Eager page splitting is best-effort. */</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            ret = __kvm_mmu_topup_memory_cache(cache,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                               cache_capacity,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                               cache_capacity);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            write_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        pgt = kvm-&gt;arch.mmu.pgt;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordflow">if</span> (!pgt)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        next = <a class="code" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2">__stage2_range_addr_end</a>(addr, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, chunk_size);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        ret = <a class="code" href="pgtable_8c.html#ada18effe8d33594eb553244d41b31440">kvm_pgtable_stage2_split</a>(pgt, addr, next - addr, cache);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    } <span class="keywordflow">while</span> (addr = next, addr != <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a62047c119e6707e0579424df7ab7bd77"><div class="ttname"><a href="mmu_8c.html#a62047c119e6707e0579424df7ab7bd77">kvm_mmu_split_nr_page_tables</a></div><div class="ttdeci">static int kvm_mmu_split_nr_page_tables(u64 range)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00090">mmu.c:90</a></div></div>
<div class="ttc" id="ammu_8c_html_a877e9a15c18a09d43fa73c90949caaa2"><div class="ttname"><a href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2">__stage2_range_addr_end</a></div><div class="ttdeci">static phys_addr_t __stage2_range_addr_end(phys_addr_t addr, phys_addr_t end, phys_addr_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00034">mmu.c:34</a></div></div>
<div class="ttc" id="ammu_8c_html_abfda6046e28c6dfc58730ef92bee6f3a"><div class="ttname"><a href="mmu_8c.html#abfda6046e28c6dfc58730ef92bee6f3a">need_split_memcache_topup_or_resched</a></div><div class="ttdeci">static bool need_split_memcache_topup_or_resched(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00100">mmu.c:100</a></div></div>
<div class="ttc" id="apgtable_8c_html_ada18effe8d33594eb553244d41b31440"><div class="ttname"><a href="pgtable_8c.html#ada18effe8d33594eb553244d41b31440">kvm_pgtable_stage2_split</a></div><div class="ttdeci">int kvm_pgtable_stage2_split(struct kvm_pgtable *pgt, u64 addr, u64 size, struct kvm_mmu_memory_cache *mc)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01521">pgtable.c:1521</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_adf6f75ecf7d564f9aa7b446e6a236d2d_cgraph.png" border="0" usemap="#ammu_8c_adf6f75ecf7d564f9aa7b446e6a236d2d_cgraph" alt=""/></div>
<map name="ammu_8c_adf6f75ecf7d564f9aa7b446e6a236d2d_cgraph" id="ammu_8c_adf6f75ecf7d564f9aa7b446e6a236d2d_cgraph">
<area shape="rect" title=" " alt="" coords="5,458,172,499"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="220,385,411,412"/>
<area shape="rect" href="mmu_8c.html#a62047c119e6707e0579424df7ab7bd77" title=" " alt="" coords="459,438,645,479"/>
<area shape="rect" href="pgtable_8c.html#ada18effe8d33594eb553244d41b31440" title=" " alt="" coords="236,552,395,594"/>
<area shape="rect" href="mmu_8c.html#abfda6046e28c6dfc58730ef92bee6f3a" title=" " alt="" coords="231,487,399,528"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="479,513,625,540"/>
<area shape="rect" href="pgtable_8c.html#a3b565840929203745194549bed91c345" title=" " alt="" coords="477,581,627,608"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="697,338,849,365"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1131,302,1290,329"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="905,288,1053,314"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1389,116,1545,142"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1400,192,1535,218"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1639,40,1816,66"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1623,90,1831,117"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1664,242,1791,269"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1938,141,2057,168"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1394,664,1541,690"/>
<area shape="rect" href="pgtable_8c.html#a2102018cbbcc67615546476ed0d5e17c" title=" " alt="" coords="693,551,852,592"/>
<area shape="rect" href="pgtable_8c.html#a9b56b0328830763f594958b5df530e3a" title=" " alt="" coords="900,392,1059,434"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="1659,781,1796,808"/>
<area shape="rect" href="pgtable_8c.html#a1a55037404d4eed23e8e3d0a6dc28dd8" title=" " alt="" coords="1646,832,1809,858"/>
<area shape="rect" href="pgtable_8c.html#abdc9b131f49e15973545e027058c45cc" title=" " alt="" coords="693,816,852,858"/>
<area shape="rect" href="pgtable_8c.html#a40f6d8a965fcfab12b7d62e9dd6a5870" title=" " alt="" coords="695,486,851,527"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="903,520,1055,546"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="901,570,1057,597"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="1393,242,1542,269"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1912,730,2083,757"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="1125,562,1297,589"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="1107,432,1315,458"/>
<area shape="rect" href="pgtable_8c.html#a29a6724d2843672cf5db792f2beb968a" title=" " alt="" coords="1363,512,1572,538"/>
<area shape="rect" href="pgtable_8c.html#a283484eeb78592a5189093e5529e7f8e" title=" " alt="" coords="1917,781,2078,808"/>
<area shape="rect" href="pgtable_8c.html#adcfc585140832fbe68cdf3d3f0a918d4" title=" " alt="" coords="1646,462,1809,503"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1638,528,1817,554"/>
<area shape="rect" href="pgtable_8c.html#a5ab910dc5d47620683abb5d18fb4890f" title=" " alt="" coords="1620,578,1835,605"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="2184,356,2331,382"/>
<area shape="rect" href="pgtable_8c.html#a909c28888aa74e4a85ee0c267bb88cc9" title=" " alt="" coords="1646,294,1809,335"/>
<area shape="rect" href="pgtable_8c.html#ab5d02dcf05715a75e3b1a83f4225fa0a" title=" " alt="" coords="1884,356,2111,382"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1644,680,1811,706"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="1641,730,1813,757"/>
<area shape="rect" href="pgtable_8c.html#a66b14675b92b1a0daa11af2d44d48efe" title=" " alt="" coords="1631,629,1823,656"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1883,302,2112,329"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="2160,897,2355,924"/>
<area shape="rect" href="pgtable_8c.html#a33fe30cf22af4661bf16b18bdfebc1d4" title=" " alt="" coords="1908,934,2087,975"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="1921,999,2074,1040"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="1924,832,2071,858"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="2403,922,2568,949"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="2407,973,2564,1000"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="2616,973,2767,1000"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="2174,948,2341,974"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="2174,999,2341,1040"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_adf6f75ecf7d564f9aa7b446e6a236d2d_icgraph.png" border="0" usemap="#ammu_8c_adf6f75ecf7d564f9aa7b446e6a236d2d_icgraph" alt=""/></div>
<map name="ammu_8c_adf6f75ecf7d564f9aa7b446e6a236d2d_icgraph" id="ammu_8c_adf6f75ecf7d564f9aa7b446e6a236d2d_icgraph">
<area shape="rect" title=" " alt="" coords="1703,39,1869,80"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="1471,5,1649,47"/>
<area shape="rect" href="mmu_8c.html#a14911068d5606cb3780e93aabfd5da96" title=" " alt="" coords="1465,71,1655,112"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="1237,13,1393,39"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="975,13,1135,39"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="743,5,897,47"/>
<area shape="rect" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1212,71,1417,112"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="945,78,1164,105"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="749,78,891,105"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,78,695,105"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,78,444,105"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,71,208,112"/>
</map>
</div>

</div>
</div>
<a id="a14911068d5606cb3780e93aabfd5da96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14911068d5606cb3780e93aabfd5da96">&#9670;&nbsp;</a></span>kvm_mmu_split_memory_region()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_mmu_split_memory_region </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="mmu_8c.html#a14911068d5606cb3780e93aabfd5da96">kvm_mmu_split_memory_region()</a> - split the stage 2 blocks into PAGE_SIZE pages for memory slot @kvm: The KVM pointer @slot: The memory slot to split</p>
<p>Acquires kvm-&gt;mmu_lock. Called with kvm-&gt;slots_lock mutex acquired, serializing operations for VM memory regions. </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01155">1155</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;{</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keyword">struct </span>kvm_memslots *slots;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keyword">struct </span>kvm_memory_slot *memslot;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    phys_addr_t start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    lockdep_assert_held(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    slots = kvm_memslots(kvm);</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    memslot = id_to_memslot(slots, slot);</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    start = memslot-&gt;base_gfn &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = (memslot-&gt;base_gfn + memslot-&gt;npages) &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; </div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    write_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <a class="code" href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d">kvm_mmu_split_huge_pages</a>(kvm, start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    write_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a14911068d5606cb3780e93aabfd5da96_cgraph.png" border="0" usemap="#ammu_8c_a14911068d5606cb3780e93aabfd5da96_cgraph" alt=""/></div>
<map name="ammu_8c_a14911068d5606cb3780e93aabfd5da96_cgraph" id="ammu_8c_a14911068d5606cb3780e93aabfd5da96_cgraph">
<area shape="rect" title=" " alt="" coords="5,435,195,477"/>
<area shape="rect" href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d" title=" " alt="" coords="243,435,409,477"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="457,363,648,389"/>
<area shape="rect" href="mmu_8c.html#a62047c119e6707e0579424df7ab7bd77" title=" " alt="" coords="696,415,883,457"/>
<area shape="rect" href="pgtable_8c.html#ada18effe8d33594eb553244d41b31440" title=" " alt="" coords="473,530,632,571"/>
<area shape="rect" href="mmu_8c.html#abfda6046e28c6dfc58730ef92bee6f3a" title=" " alt="" coords="469,465,637,506"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="717,491,862,517"/>
<area shape="rect" href="pgtable_8c.html#a3b565840929203745194549bed91c345" title=" " alt="" coords="714,559,865,585"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="934,289,1086,316"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1369,243,1527,269"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1143,239,1291,265"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1627,132,1783,159"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1637,208,1772,235"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1876,5,2053,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1861,56,2069,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1901,259,2028,285"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2174,157,2293,184"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1631,643,1778,669"/>
<area shape="rect" href="pgtable_8c.html#a2102018cbbcc67615546476ed0d5e17c" title=" " alt="" coords="931,475,1089,517"/>
<area shape="rect" href="pgtable_8c.html#a9b56b0328830763f594958b5df530e3a" title=" " alt="" coords="1137,401,1296,442"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="1896,797,2033,824"/>
<area shape="rect" href="pgtable_8c.html#a1a55037404d4eed23e8e3d0a6dc28dd8" title=" " alt="" coords="1883,848,2046,875"/>
<area shape="rect" href="pgtable_8c.html#abdc9b131f49e15973545e027058c45cc" title=" " alt="" coords="931,745,1089,786"/>
<area shape="rect" href="pgtable_8c.html#a40f6d8a965fcfab12b7d62e9dd6a5870" title=" " alt="" coords="932,358,1088,399"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="1141,529,1293,556"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="1139,479,1295,505"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="1630,259,1779,285"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="2148,739,2319,765"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="1362,541,1534,568"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="1344,447,1552,473"/>
<area shape="rect" href="pgtable_8c.html#a29a6724d2843672cf5db792f2beb968a" title=" " alt="" coords="1600,491,1809,517"/>
<area shape="rect" href="pgtable_8c.html#a283484eeb78592a5189093e5529e7f8e" title=" " alt="" coords="2153,789,2314,816"/>
<area shape="rect" href="pgtable_8c.html#adcfc585140832fbe68cdf3d3f0a918d4" title=" " alt="" coords="1883,579,2046,621"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1875,645,2054,672"/>
<area shape="rect" href="pgtable_8c.html#a5ab910dc5d47620683abb5d18fb4890f" title=" " alt="" coords="1857,696,2072,723"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="2419,401,2565,428"/>
<area shape="rect" href="pgtable_8c.html#a909c28888aa74e4a85ee0c267bb88cc9" title=" " alt="" coords="1883,310,2046,351"/>
<area shape="rect" href="pgtable_8c.html#ab5d02dcf05715a75e3b1a83f4225fa0a" title=" " alt="" coords="2120,376,2347,403"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1881,747,2048,773"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="1879,477,2051,504"/>
<area shape="rect" href="pgtable_8c.html#a66b14675b92b1a0daa11af2d44d48efe" title=" " alt="" coords="1869,528,2061,555"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="2395,907,2589,933"/>
<area shape="rect" href="pgtable_8c.html#a33fe30cf22af4661bf16b18bdfebc1d4" title=" " alt="" coords="2144,841,2323,882"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="2157,1009,2310,1050"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="2160,957,2307,984"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="2637,991,2803,1017"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="2641,940,2799,967"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="2851,940,3001,967"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="2409,1024,2575,1051"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="2409,958,2575,999"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a14911068d5606cb3780e93aabfd5da96_icgraph.png" border="0" usemap="#ammu_8c_a14911068d5606cb3780e93aabfd5da96_icgraph" alt=""/></div>
<map name="ammu_8c_a14911068d5606cb3780e93aabfd5da96_icgraph" id="ammu_8c_a14911068d5606cb3780e93aabfd5da96_icgraph">
<area shape="rect" title=" " alt="" coords="1453,5,1643,47"/>
<area shape="rect" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1200,5,1405,47"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="933,13,1152,39"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="743,13,885,39"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,13,695,39"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,13,444,39"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a62047c119e6707e0579424df7ab7bd77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62047c119e6707e0579424df7ab7bd77">&#9670;&nbsp;</a></span>kvm_mmu_split_nr_page_tables()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_mmu_split_nr_page_tables </td>
          <td>(</td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>range</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00090">90</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;{</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordtype">int</span> n = 0;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span> (KVM_PGTABLE_MIN_BLOCK_LEVEL &lt; 2)</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        n += DIV_ROUND_UP(range, PUD_SIZE);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    n += DIV_ROUND_UP(range, PMD_SIZE);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a62047c119e6707e0579424df7ab7bd77_icgraph.png" border="0" usemap="#ammu_8c_a62047c119e6707e0579424df7ab7bd77_icgraph" alt=""/></div>
<map name="ammu_8c_a62047c119e6707e0579424df7ab7bd77_icgraph" id="ammu_8c_a62047c119e6707e0579424df7ab7bd77_icgraph">
<area shape="rect" title=" " alt="" coords="2133,39,2320,80"/>
<area shape="rect" href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d" title=" " alt="" coords="1703,39,1869,80"/>
<area shape="rect" href="mmu_8c.html#abfda6046e28c6dfc58730ef92bee6f3a" title=" " alt="" coords="1917,68,2085,109"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="1471,5,1649,47"/>
<area shape="rect" href="mmu_8c.html#a14911068d5606cb3780e93aabfd5da96" title=" " alt="" coords="1465,71,1655,112"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="1237,13,1393,39"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="975,13,1135,39"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="743,5,897,47"/>
<area shape="rect" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1212,71,1417,112"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="945,78,1164,105"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="749,78,891,105"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,78,695,105"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,78,444,105"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,71,208,112"/>
</map>
</div>

</div>
</div>
<a id="a61aef4ee44be349558f529158640ae57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61aef4ee44be349558f529158640ae57">&#9670;&nbsp;</a></span>kvm_mmu_wp_memory_region()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_mmu_wp_memory_region </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="mmu_8c.html#a61aef4ee44be349558f529158640ae57">kvm_mmu_wp_memory_region()</a> - write protect stage 2 entries for memory slot @kvm: The KVM pointer @slot: The memory slot to write protect</p>
<p>Called to start logging dirty pages after memory region KVM_MEM_LOG_DIRTY_PAGES operation is called. After this function returns all present PUD, PMD and PTEs are write protected in the memory region. Afterwards read of dirty page log can be called.</p>
<p>Acquires kvm_mmu_lock. Called with kvm-&gt;slots_lock mutex acquired, serializing operations for VM memory regions. </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01128">1128</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;{</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="keyword">struct </span>kvm_memslots *slots = kvm_memslots(kvm);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="keyword">struct </span>kvm_memory_slot *memslot = id_to_memslot(slots, slot);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    phys_addr_t start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160; </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordflow">if</span> (WARN_ON_ONCE(!memslot))</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160; </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    start = memslot-&gt;base_gfn &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = (memslot-&gt;base_gfn + memslot-&gt;npages) &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    write_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <a class="code" href="mmu_8c.html#a4fd92073128280eb5aeb2254fa60cb77">stage2_wp_range</a>(&amp;kvm-&gt;arch.mmu, start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    write_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <a class="code" href="kvm__main_8c.html#a9fbc5527db7bcb223ecfe95c59cf4c70">kvm_flush_remote_tlbs_memslot</a>(kvm, memslot);</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_a9fbc5527db7bcb223ecfe95c59cf4c70"><div class="ttname"><a href="kvm__main_8c.html#a9fbc5527db7bcb223ecfe95c59cf4c70">kvm_flush_remote_tlbs_memslot</a></div><div class="ttdeci">void kvm_flush_remote_tlbs_memslot(struct kvm *kvm, const struct kvm_memory_slot *memslot)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l00380">kvm_main.c:380</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a61aef4ee44be349558f529158640ae57_cgraph.png" border="0" usemap="#ammu_8c_a61aef4ee44be349558f529158640ae57_cgraph" alt=""/></div>
<map name="ammu_8c_a61aef4ee44be349558f529158640ae57_cgraph" id="ammu_8c_a61aef4ee44be349558f529158640ae57_cgraph">
<area shape="rect" title=" " alt="" coords="5,273,233,300"/>
<area shape="rect" href="kvm__main_8c.html#a9fbc5527db7bcb223ecfe95c59cf4c70" title=" " alt="" coords="281,235,456,277"/>
<area shape="rect" href="mmu_8c.html#a4fd92073128280eb5aeb2254fa60cb77" title=" " alt="" coords="301,303,437,329"/>
<area shape="rect" href="kvm__main_8c.html#a523d3c698dd532d3fbc1bb046246ea5f" title=" " alt="" coords="504,211,679,253"/>
<area shape="rect" href="mmu_8c.html#a21f706511628b7801b6daf25c927f28a" title=" " alt="" coords="727,211,905,253"/>
<area shape="rect" href="kvm__main_8c.html#a54913b65d68c88909678d5cf9c983a6b" title=" " alt="" coords="729,160,903,187"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="982,211,1135,253"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="1234,160,1401,187"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="1234,211,1401,253"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="1482,217,1647,244"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="1486,163,1643,189"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="1719,163,1870,189"/>
<area shape="rect" href="mmu_8c.html#aeef4d107a4492fde01f361171f3e36d5" title=" " alt="" coords="954,160,1163,187"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="953,105,1164,132"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1212,94,1423,135"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1481,107,1648,133"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1471,56,1659,83"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1755,107,1834,133"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1707,56,1883,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1718,5,1871,32"/>
<area shape="rect" href="pgtable_8c.html#a60648bc84ec35aba9f0f80106ba70c0e" title=" " alt="" coords="512,298,671,339"/>
<area shape="rect" href="pgtable_8c.html#a479db5e7d44bd0ef2092407a91bd04b3" title=" " alt="" coords="741,321,891,362"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="986,404,1131,431"/>
<area shape="rect" href="pgtable_8c.html#ae8dfa2edb1072f647c283dd113a86ca0" title=" " alt="" coords="985,328,1132,355"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1241,429,1393,456"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1485,480,1644,507"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1491,429,1639,456"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1717,480,1873,507"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1727,429,1862,456"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1946,480,2123,507"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1931,531,2139,557"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1971,379,2098,405"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1975,429,2094,456"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="1231,277,1403,304"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="1244,328,1391,355"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a61aef4ee44be349558f529158640ae57_icgraph.png" border="0" usemap="#ammu_8c_a61aef4ee44be349558f529158640ae57_icgraph" alt=""/></div>
<map name="ammu_8c_a61aef4ee44be349558f529158640ae57_icgraph" id="ammu_8c_a61aef4ee44be349558f529158640ae57_icgraph">
<area shape="rect" title=" " alt="" coords="1453,13,1681,39"/>
<area shape="rect" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1200,5,1405,47"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="933,13,1152,39"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="743,13,885,39"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,13,695,39"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,13,444,39"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="aceb0aaa6f23e8883c4fe0b6ef8001f04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aceb0aaa6f23e8883c4fe0b6ef8001f04">&#9670;&nbsp;</a></span>kvm_phys_addr_ioremap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_phys_addr_ioremap </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>guest_ipa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>writable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_phys_addr_ioremap - map a device range to guest IPA</p>
<p>@kvm: The KVM pointer @guest_ipa: The IPA at which to insert the mapping @pa: The physical address of the device @size: The size of the mapping @writable: Whether or not to create a writable mapping </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01066">1066</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;{</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    phys_addr_t addr;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keyword">struct </span>kvm_mmu_memory_cache cache = { .gfp_zero = __GFP_ZERO };</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keyword">struct </span>kvm_s2_mmu *mmu = &amp;kvm-&gt;arch.mmu;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="keyword">struct </span>kvm_pgtable *pgt = mmu-&gt;pgt;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keyword">enum</span> kvm_pgtable_prot prot = KVM_PGTABLE_PROT_DEVICE |</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                     KVM_PGTABLE_PROT_R |</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                     (writable ? KVM_PGTABLE_PROT_W : 0);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">if</span> (is_protected_kvm_enabled())</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="keywordflow">return</span> -EPERM;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> += offset_in_page(guest_ipa);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    guest_ipa &amp;= PAGE_MASK;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160; </div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordflow">for</span> (addr = guest_ipa; addr &lt; guest_ipa + <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>; addr += PAGE_SIZE) {</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        ret = kvm_mmu_topup_memory_cache(&amp;cache,</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                         kvm_mmu_cache_min_pages(mmu));</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160; </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        write_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        ret = <a class="code" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084">kvm_pgtable_stage2_map</a>(pgt, addr, PAGE_SIZE, pa, prot,</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                         &amp;cache, 0);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        write_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        pa += PAGE_SIZE;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    }</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160; </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    kvm_mmu_free_memory_cache(&amp;cache);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;}</div>
<div class="ttc" id="apgtable_8c_html_aa6720ffb7274162e966c1995acefe084"><div class="ttname"><a href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084">kvm_pgtable_stage2_map</a></div><div class="ttdeci">int kvm_pgtable_stage2_map(struct kvm_pgtable *pgt, u64 addr, u64 size, u64 phys, enum kvm_pgtable_prot prot, void *mc, enum kvm_pgtable_walk_flags flags)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01061">pgtable.c:1061</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aceb0aaa6f23e8883c4fe0b6ef8001f04_cgraph.png" border="0" usemap="#ammu_8c_aceb0aaa6f23e8883c4fe0b6ef8001f04_cgraph" alt=""/></div>
<map name="ammu_8c_aceb0aaa6f23e8883c4fe0b6ef8001f04_cgraph" id="ammu_8c_aceb0aaa6f23e8883c4fe0b6ef8001f04_cgraph">
<area shape="rect" title=" " alt="" coords="5,216,192,243"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="240,216,435,243"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="488,111,633,137"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="485,216,637,243"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="483,267,639,293"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="715,56,867,83"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="968,5,1127,32"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="973,56,1121,83"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1229,56,1385,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1240,5,1375,32"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1489,56,1666,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1473,5,1681,32"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1514,107,1641,133"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1518,459,1637,485"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="705,515,877,541"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="687,216,895,243"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="974,515,1121,541"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="1239,696,1376,723"/>
<area shape="rect" href="pgtable_8c.html#a29a6724d2843672cf5db792f2beb968a" title=" " alt="" coords="943,444,1152,471"/>
<area shape="rect" href="pgtable_8c.html#a1a55037404d4eed23e8e3d0a6dc28dd8" title=" " alt="" coords="1226,747,1389,773"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1492,645,1663,672"/>
<area shape="rect" href="pgtable_8c.html#a283484eeb78592a5189093e5529e7f8e" title=" " alt="" coords="1497,696,1658,723"/>
<area shape="rect" href="pgtable_8c.html#adcfc585140832fbe68cdf3d3f0a918d4" title=" " alt="" coords="1226,427,1389,469"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1218,493,1397,520"/>
<area shape="rect" href="pgtable_8c.html#a5ab910dc5d47620683abb5d18fb4890f" title=" " alt="" coords="1200,544,1415,571"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1764,349,1911,376"/>
<area shape="rect" href="pgtable_8c.html#a909c28888aa74e4a85ee0c267bb88cc9" title=" " alt="" coords="1226,209,1389,250"/>
<area shape="rect" href="pgtable_8c.html#ab5d02dcf05715a75e3b1a83f4225fa0a" title=" " alt="" coords="1464,349,1691,376"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1224,275,1391,301"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="1221,325,1393,352"/>
<area shape="rect" href="pgtable_8c.html#a66b14675b92b1a0daa11af2d44d48efe" title=" " alt="" coords="1211,645,1403,672"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1463,271,1692,297"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="1740,923,1935,949"/>
<area shape="rect" href="pgtable_8c.html#a33fe30cf22af4661bf16b18bdfebc1d4" title=" " alt="" coords="1488,863,1667,905"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="1501,798,1654,839"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="1504,747,1651,773"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="1983,839,2148,865"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="1987,889,2144,916"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="2196,889,2347,916"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="1754,805,1921,832"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="1754,857,1921,898"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aceb0aaa6f23e8883c4fe0b6ef8001f04_icgraph.png" border="0" usemap="#ammu_8c_aceb0aaa6f23e8883c4fe0b6ef8001f04_icgraph" alt=""/></div>
<map name="ammu_8c_aceb0aaa6f23e8883c4fe0b6ef8001f04_icgraph" id="ammu_8c_aceb0aaa6f23e8883c4fe0b6ef8001f04_icgraph">
<area shape="rect" title=" " alt="" coords="869,13,1056,39"/>
<area shape="rect" href="vgic-v2_8c.html#ac8de91a1f816dcd3b3edba1d074a1aca" title=" " alt="" coords="643,13,821,39"/>
<area shape="rect" href="vgic-init_8c.html#a8411f235847aa56055a7a2fefce226c6" title=" " alt="" coords="404,13,595,39"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="177,5,356,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="ad02e9dab83b5eeee68e5e9f558344be7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad02e9dab83b5eeee68e5e9f558344be7">&#9670;&nbsp;</a></span>kvm_s2_free_pages_exact()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_s2_free_pages_exact </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>virt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00214">214</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;{</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    kvm_account_pgtable_pages(virt, -(<a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &gt;&gt; PAGE_SHIFT));</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    free_pages_exact(virt, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aca0a36b009f5655a358bc4943d843cf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca0a36b009f5655a358bc4943d843cf1">&#9670;&nbsp;</a></span>kvm_s2_put_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_s2_put_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00249">249</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;{</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keyword">struct </span>page *p = virt_to_page(addr);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">/* Dropping last refcount, the page will be freed */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (page_count(p) == 1)</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        kvm_account_pgtable_pages(addr, -1);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    put_page(p);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aaaa2b0d256c20dcfcfae2767ce907846"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaaa2b0d256c20dcfcfae2767ce907846">&#9670;&nbsp;</a></span>kvm_s2_zalloc_pages_exact()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* kvm_s2_zalloc_pages_exact </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00205">205</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;{</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordtype">void</span> *virt = <a class="code" href="mmu_8c.html#ae792e5a1690d87277dc72552467b205e">kvm_host_zalloc_pages_exact</a>(<a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">if</span> (virt)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        kvm_account_pgtable_pages(virt, (<a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &gt;&gt; PAGE_SHIFT));</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">return</span> virt;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_ae792e5a1690d87277dc72552467b205e"><div class="ttname"><a href="mmu_8c.html#ae792e5a1690d87277dc72552467b205e">kvm_host_zalloc_pages_exact</a></div><div class="ttdeci">static void * kvm_host_zalloc_pages_exact(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00200">mmu.c:200</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aaaa2b0d256c20dcfcfae2767ce907846_cgraph.png" border="0" usemap="#ammu_8c_aaaa2b0d256c20dcfcfae2767ce907846_cgraph" alt=""/></div>
<map name="ammu_8c_aaaa2b0d256c20dcfcfae2767ce907846_cgraph" id="ammu_8c_aaaa2b0d256c20dcfcfae2767ce907846_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,169,47"/>
<area shape="rect" href="mmu_8c.html#ae792e5a1690d87277dc72552467b205e" title=" " alt="" coords="217,5,395,47"/>
</map>
</div>

</div>
</div>
<a id="ab06707336ef5d30b56abbfd801d2f756"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab06707336ef5d30b56abbfd801d2f756">&#9670;&nbsp;</a></span>kvm_send_hwpoison_signal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_send_hwpoison_signal </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&#160;</td>
          <td class="paramname"><em>lsb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01209">1209</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;{</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    send_sig_mceerr(BUS_MCEERR_AR, (<span class="keywordtype">void</span> __user *)address, lsb, current);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ab06707336ef5d30b56abbfd801d2f756_icgraph.png" border="0" usemap="#ammu_8c_ab06707336ef5d30b56abbfd801d2f756_icgraph" alt=""/></div>
<map name="ammu_8c_ab06707336ef5d30b56abbfd801d2f756_icgraph" id="ammu_8c_ab06707336ef5d30b56abbfd801d2f756_icgraph">
<area shape="rect" title=" " alt="" coords="420,5,624,32"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="240,5,372,32"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,5,192,32"/>
</map>
</div>

</div>
</div>
<a id="a978186d69e4a1b753b9650294d80ca7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a978186d69e4a1b753b9650294d80ca7d">&#9670;&nbsp;</a></span>kvm_set_spte_gfn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_set_spte_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01765">1765</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;{</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    kvm_pfn_t pfn = pte_pfn(range-&gt;arg.pte);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160; </div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keywordflow">if</span> (!kvm-&gt;arch.mmu.pgt)</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160; </div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    WARN_ON(range-&gt;end - range-&gt;start != 1);</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160; </div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">     * If the page isn&#39;t tagged, defer to user_mem_abort() for sanitising</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">     * the MTE tags. The S2 pte should have been unmapped by</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment">     * mmu_notifier_invalidate_range_end().</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <span class="keywordflow">if</span> (kvm_has_mte(kvm) &amp;&amp; !page_mte_tagged(pfn_to_page(pfn)))</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160; </div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">     * We&#39;ve moved a page around, probably through CoW, so let&#39;s treat</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment">     * it just like a translation fault and the map handler will clean</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">     * the cache to the PoC.</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">     * The MMU notifiers will have unmapped a huge PMD before calling</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">     * -&gt;change_pte() (which in turn calls kvm_set_spte_gfn()) and</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment">     * therefore we never need to clear out a huge PMD through this</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment">     * calling path and a memcache is not required.</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <a class="code" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084">kvm_pgtable_stage2_map</a>(kvm-&gt;arch.mmu.pgt, range-&gt;start &lt;&lt; PAGE_SHIFT,</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                   PAGE_SIZE, __pfn_to_phys(pfn),</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                   KVM_PGTABLE_PROT_R, NULL, 0);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160; </div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a978186d69e4a1b753b9650294d80ca7d_cgraph.png" border="0" usemap="#ammu_8c_a978186d69e4a1b753b9650294d80ca7d_cgraph" alt=""/></div>
<map name="ammu_8c_a978186d69e4a1b753b9650294d80ca7d_cgraph" id="ammu_8c_a978186d69e4a1b753b9650294d80ca7d_cgraph">
<area shape="rect" title=" " alt="" coords="5,216,147,243"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="195,216,389,243"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="443,111,588,137"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="439,216,591,243"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="437,267,593,293"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="669,56,821,83"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="923,5,1081,32"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="928,56,1076,83"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1184,56,1340,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1195,5,1329,32"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1443,56,1621,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1428,5,1636,32"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1469,107,1595,133"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1473,459,1591,485"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="659,515,831,541"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="641,216,849,243"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="929,515,1075,541"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="1193,696,1331,723"/>
<area shape="rect" href="pgtable_8c.html#a29a6724d2843672cf5db792f2beb968a" title=" " alt="" coords="897,444,1107,471"/>
<area shape="rect" href="pgtable_8c.html#a1a55037404d4eed23e8e3d0a6dc28dd8" title=" " alt="" coords="1181,747,1343,773"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1447,645,1617,672"/>
<area shape="rect" href="pgtable_8c.html#a283484eeb78592a5189093e5529e7f8e" title=" " alt="" coords="1451,696,1613,723"/>
<area shape="rect" href="pgtable_8c.html#adcfc585140832fbe68cdf3d3f0a918d4" title=" " alt="" coords="1181,427,1343,469"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1173,493,1351,520"/>
<area shape="rect" href="pgtable_8c.html#a5ab910dc5d47620683abb5d18fb4890f" title=" " alt="" coords="1155,544,1369,571"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1719,349,1865,376"/>
<area shape="rect" href="pgtable_8c.html#a909c28888aa74e4a85ee0c267bb88cc9" title=" " alt="" coords="1181,209,1343,250"/>
<area shape="rect" href="pgtable_8c.html#ab5d02dcf05715a75e3b1a83f4225fa0a" title=" " alt="" coords="1419,349,1645,376"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1179,275,1345,301"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="1176,325,1348,352"/>
<area shape="rect" href="pgtable_8c.html#a66b14675b92b1a0daa11af2d44d48efe" title=" " alt="" coords="1166,645,1358,672"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1417,271,1647,297"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="1695,923,1889,949"/>
<area shape="rect" href="pgtable_8c.html#a33fe30cf22af4661bf16b18bdfebc1d4" title=" " alt="" coords="1443,863,1621,905"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="1455,798,1609,839"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="1459,747,1605,773"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="1937,839,2103,865"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="1941,889,2099,916"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="2151,889,2301,916"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="1709,805,1875,832"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="1709,857,1875,898"/>
</map>
</div>

</div>
</div>
<a id="a02fcf6f3335d5fa450266c18e6e8f0a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02fcf6f3335d5fa450266c18e6e8f0a5">&#9670;&nbsp;</a></span>kvm_set_way_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_set_way_flush </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l02102">2102</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;{</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> hcr = *vcpu_hcr(vcpu);</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160; </div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="comment">     * If this is the first time we do a S/W operation</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="comment">     * (i.e. HCR_TVM not set) flush the whole memory, and set the</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="comment">     * VM trapping.</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="comment">     * Otherwise, rely on the VM trapping to wait for the MMU +</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="comment">     * Caches to be turned off. At that point, we&#39;ll be able to</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="comment">     * clean the caches again.</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="keywordflow">if</span> (!(hcr &amp; HCR_TVM)) {</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        trace_kvm_set_way_flush(*vcpu_pc(vcpu),</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                    vcpu_has_cache_enabled(vcpu));</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        <a class="code" href="mmu_8c.html#ae8fca1b7a8029fee45816e7e7eccdfd1">stage2_flush_vm</a>(vcpu-&gt;kvm);</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;        *vcpu_hcr(vcpu) = hcr | HCR_TVM;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;    }</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_ae8fca1b7a8029fee45816e7e7eccdfd1"><div class="ttname"><a href="mmu_8c.html#ae8fca1b7a8029fee45816e7e7eccdfd1">stage2_flush_vm</a></div><div class="ttdeci">static void stage2_flush_vm(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00352">mmu.c:352</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a02fcf6f3335d5fa450266c18e6e8f0a5_cgraph.png" border="0" usemap="#ammu_8c_a02fcf6f3335d5fa450266c18e6e8f0a5_cgraph" alt=""/></div>
<map name="ammu_8c_a02fcf6f3335d5fa450266c18e6e8f0a5_cgraph" id="ammu_8c_a02fcf6f3335d5fa450266c18e6e8f0a5_cgraph">
<area shape="rect" title=" " alt="" coords="5,157,156,184"/>
<area shape="rect" href="mmu_8c.html#ae8fca1b7a8029fee45816e7e7eccdfd1" title=" " alt="" coords="204,157,336,184"/>
<area shape="rect" href="mmu_8c.html#a3a27465e35c31f661ad2b811ae347c23" title=" " alt="" coords="384,157,553,184"/>
<area shape="rect" href="pgtable_8c.html#a2d2b49cec6003de272a8894e958a9ee3" title=" " alt="" coords="601,150,760,191"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="813,107,958,133"/>
<area shape="rect" href="pgtable_8c.html#ad7410d161ea1f583ed8fe92581038069" title=" " alt="" coords="808,157,963,184"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="822,208,949,235"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1018,107,1170,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1225,56,1384,83"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1231,107,1379,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1432,56,1588,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1443,107,1577,133"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1651,5,1829,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1636,56,1844,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1677,157,1803,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1681,107,1799,133"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1011,208,1177,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a02fcf6f3335d5fa450266c18e6e8f0a5_icgraph.png" border="0" usemap="#ammu_8c_a02fcf6f3335d5fa450266c18e6e8f0a5_icgraph" alt=""/></div>
<map name="ammu_8c_a02fcf6f3335d5fa450266c18e6e8f0a5_icgraph" id="ammu_8c_a02fcf6f3335d5fa450266c18e6e8f0a5_icgraph">
<area shape="rect" title=" " alt="" coords="323,5,473,32"/>
<area shape="rect" href="sys__regs_8c.html#a921dd58e3a4f932dc4e7a8d9165588ac" title=" " alt="" coords="168,5,275,32"/>
<area shape="rect" href="sys__regs_8c.html#affcbc277fd697c88cc97fbbcce0bf78f" title=" " alt="" coords="5,5,120,32"/>
</map>
</div>

</div>
</div>
<a id="a1b7a508d0431deb996e839b226bcda0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b7a508d0431deb996e839b226bcda0d">&#9670;&nbsp;</a></span>kvm_share_hyp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_share_hyp </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>to</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00516">516</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;{</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    phys_addr_t start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, <a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    u64 pfn;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">if</span> (is_kernel_in_hyp_mode())</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">     * The share hcall maps things in the &#39;fixed-offset&#39; region of the hyp</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">     * VA space, so we can only share physically contiguous data-structures</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">     * for now.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (is_vmalloc_or_module_addr(from) || is_vmalloc_or_module_addr(to))</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b">kvm_host_owns_hyp_mappings</a>())</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="mmu_8c.html#a2fae287f6a52db1bbfdcb7483ba623ca">create_hyp_mappings</a>(from, to, PAGE_HYP);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    start = ALIGN_DOWN(__pa(from), PAGE_SIZE);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = PAGE_ALIGN(__pa(to));</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a> = start; <a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a> &lt; <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>; <a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a> += PAGE_SIZE) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        pfn = __phys_to_pfn(<a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a>);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        ret = <a class="code" href="mmu_8c.html#aa7729a167573cc14881088e0516f28d5">share_pfn_hyp</a>(pfn);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;}</div>
<div class="ttc" id="aearly__alloc_8c_html_a7eb8057942ed1846c6c3584dd9fa7bb5"><div class="ttname"><a href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a></div><div class="ttdeci">static unsigned long cur</div><div class="ttdef"><b>Definition:</b> <a href="early__alloc_8c_source.html#l00017">early_alloc.c:17</a></div></div>
<div class="ttc" id="ammu_8c_html_a2fae287f6a52db1bbfdcb7483ba623ca"><div class="ttname"><a href="mmu_8c.html#a2fae287f6a52db1bbfdcb7483ba623ca">create_hyp_mappings</a></div><div class="ttdeci">int create_hyp_mappings(void *from, void *to, enum kvm_pgtable_prot prot)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00574">mmu.c:574</a></div></div>
<div class="ttc" id="ammu_8c_html_aa7729a167573cc14881088e0516f28d5"><div class="ttname"><a href="mmu_8c.html#aa7729a167573cc14881088e0516f28d5">share_pfn_hyp</a></div><div class="ttdeci">static int share_pfn_hyp(u64 pfn)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00460">mmu.c:460</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a1b7a508d0431deb996e839b226bcda0d_cgraph.png" border="0" usemap="#ammu_8c_a1b7a508d0431deb996e839b226bcda0d_cgraph" alt=""/></div>
<map name="ammu_8c_a1b7a508d0431deb996e839b226bcda0d_cgraph" id="ammu_8c_a1b7a508d0431deb996e839b226bcda0d_cgraph">
<area shape="rect" title=" " alt="" coords="5,71,131,98"/>
<area shape="rect" href="mmu_8c.html#a2fae287f6a52db1bbfdcb7483ba623ca" title=" " alt="" coords="179,71,344,98"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="623,21,852,47"/>
<area shape="rect" href="mmu_8c.html#aa7729a167573cc14881088e0516f28d5" title=" " alt="" coords="203,198,320,225"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="394,71,573,98"/>
<area shape="rect" href="mmu_8c.html#a5ba832c8135d5fbf5fed763356c0a2b7" title=" " alt="" coords="407,122,559,149"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="1532,126,1707,153"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="1773,151,1905,178"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="1771,101,1907,127"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1767,309,1912,335"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="1960,177,2149,203"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1981,126,2128,153"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="2197,145,2427,171"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="2223,195,2401,222"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="2479,145,2626,171"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1979,309,2131,335"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="2233,283,2391,310"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="2238,334,2386,361"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="2475,283,2631,310"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="2485,233,2620,259"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="2694,233,2871,259"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="2679,283,2887,310"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="2719,334,2846,361"/>
<area shape="rect" href="mem__protect_8h.html#a5386cf2bf4917b7abcc5fb60845688d9" title=" " alt="" coords="392,198,575,225"/>
<area shape="rect" href="mmu_8c.html#ae872b392080198975a339e2351ec3abf" title=" " alt="" coords="421,249,546,275"/>
<area shape="rect" href="mem__protect_8c.html#a6bfbb53a58e0b5b5533cfc11957f42c2" title=" " alt="" coords="697,223,778,250"/>
<area shape="rect" href="mem__protect_8c.html#aa70b12df63f9379efa7fe11ade510b7c" title=" " alt="" coords="655,325,819,351"/>
<area shape="rect" href="mem__protect_8c.html#a21f32ced99ed31332ac532029100e42d" title=" " alt="" coords="647,173,827,199"/>
<area shape="rect" href="mem__protect_8c.html#abbc50e372d72deb41a021219c35e3589" title=" " alt="" coords="657,274,817,301"/>
<area shape="rect" href="mem__protect_8c.html#a024de911d90c8e8d57cc96c87fecb4d3" title=" " alt="" coords="649,122,825,149"/>
<area shape="rect" href="mem__protect_8c.html#a813121259f4344cbf372cbf3d7f50588" title=" " alt="" coords="918,179,1013,206"/>
<area shape="rect" href="mem__protect_8c.html#aaa8cef3120e457500b49a5de34545c24" title=" " alt="" coords="914,246,1017,273"/>
<area shape="rect" href="mem__protect_8c.html#a6fc6b31d003170e866222dffa08ae092" title=" " alt="" coords="1084,126,1231,153"/>
<area shape="rect" href="mem__protect_8c.html#a635909c724738612986586327fa71a0b" title=" " alt="" coords="1079,179,1236,206"/>
<area shape="rect" href="mem__protect_8c.html#a2b41e87ab661559f9f860797a14c914e" title=" " alt="" coords="1293,5,1463,47"/>
<area shape="rect" href="mem__protect_8c.html#adc131fc52bbb4443366cfbe93eb87839" title=" " alt="" coords="1520,13,1719,39"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="1559,69,1679,95"/>
<area shape="rect" href="mm_8h.html#a36a82f8cc52bf1bf431f904beddc6c18" title=" " alt="" coords="1289,173,1467,215"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="1538,227,1701,254"/>
<area shape="rect" href="memory_8h.html#aae436fb2b3f13c0954cde727104e80ac" title=" " alt="" coords="1553,177,1686,203"/>
<area shape="rect" href="mem__protect_8c.html#a5d4226b7d58b6d55f4d6d7195914f4c2" title=" " alt="" coords="1079,239,1235,280"/>
<area shape="rect" href="mem__protect_8c.html#a54456b5931c9badb4e3272081518a9c9" title=" " alt="" coords="1098,311,1217,338"/>
<area shape="rect" href="mem__protect_8c.html#ab45dbaed102ffbf3ccda18c0cc20a6dc" title=" " alt="" coords="1284,239,1472,280"/>
<area shape="rect" href="mem__protect_8c.html#a3ea605c8779e3d79d674c81a6d64919c" title=" " alt="" coords="1528,329,1711,355"/>
<area shape="rect" href="mem__protect_8c.html#a39c30c3fbf244570912cbd38c6e5606a" title=" " alt="" coords="1541,278,1698,305"/>
<area shape="rect" href="mem__protect_8c.html#a89057e6dfc7b241de73b439208bcf7d5" title=" " alt="" coords="1288,304,1468,345"/>
<area shape="rect" href="mem__protect_8c.html#a4ee4815f49f2d2a8397d1e2430193a3e" title=" " alt="" coords="1286,369,1470,411"/>
<area shape="rect" href="mem__protect_8c.html#a906b44af03f69892941d0b4e87d52fbd" title=" " alt="" coords="1543,379,1696,406"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="908,310,1023,337"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="900,126,1031,153"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a1b7a508d0431deb996e839b226bcda0d_icgraph.png" border="0" usemap="#ammu_8c_a1b7a508d0431deb996e839b226bcda0d_icgraph" alt=""/></div>
<map name="ammu_8c_a1b7a508d0431deb996e839b226bcda0d_icgraph" id="ammu_8c_a1b7a508d0431deb996e839b226bcda0d_icgraph">
<area shape="rect" title=" " alt="" coords="923,81,1048,108"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="699,5,842,32"/>
<area shape="rect" href="arm_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="685,56,857,83"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="667,107,875,133"/>
<area shape="rect" href="reset_8c.html#a82e2644a8e182c72a70fa52b0a0acae9" title=" " alt="" coords="684,157,857,184"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="455,5,582,32"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="177,5,371,32"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="419,56,619,83"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="185,97,363,138"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,133,129,160"/>
<area shape="rect" href="reset_8c.html#ae95bc53f52db3e69595fd0a53c8bc8fb" title=" " alt="" coords="431,159,607,185"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="195,163,353,189"/>
</map>
</div>

</div>
</div>
<a id="a7045f4df80d26474c5fe995d02eebc35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7045f4df80d26474c5fe995d02eebc35">&#9670;&nbsp;</a></span>kvm_test_age_gfn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_test_age_gfn </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01811">1811</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;{</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    u64 <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = (range-&gt;end - range-&gt;start) &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160; </div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <span class="keywordflow">if</span> (!kvm-&gt;arch.mmu.pgt)</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160; </div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="pgtable_8c.html#adf1b38858c6a66c85db09f048712d203">kvm_pgtable_stage2_test_clear_young</a>(kvm-&gt;arch.mmu.pgt,</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                           range-&gt;start &lt;&lt; PAGE_SHIFT,</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                           <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a7045f4df80d26474c5fe995d02eebc35_cgraph.png" border="0" usemap="#ammu_8c_a7045f4df80d26474c5fe995d02eebc35_cgraph" alt=""/></div>
<map name="ammu_8c_a7045f4df80d26474c5fe995d02eebc35_cgraph" id="ammu_8c_a7045f4df80d26474c5fe995d02eebc35_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,148,159"/>
<area shape="rect" href="pgtable_8c.html#adf1b38858c6a66c85db09f048712d203" title=" " alt="" coords="196,125,355,166"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="403,107,549,133"/>
<area shape="rect" href="pgtable_8c.html#a8d78bd0f524cdfbacbaefd645e687138" title=" " alt="" coords="403,157,549,184"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="597,107,749,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="797,81,956,108"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="803,132,951,159"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1004,81,1160,108"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1015,132,1149,159"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1223,5,1401,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1208,56,1416,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1249,107,1375,133"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1253,157,1371,184"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="600,157,747,184"/>
</map>
</div>

</div>
</div>
<a id="a9b63a0026cbf8d3884da7ec58add5c0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b63a0026cbf8d3884da7ec58add5c0c">&#9670;&nbsp;</a></span>kvm_toggle_cache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_toggle_cache </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>was_enabled</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l02123">2123</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;{</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    <span class="keywordtype">bool</span> now_enabled = vcpu_has_cache_enabled(vcpu);</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160; </div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="comment">     * If switching the MMU+caches on, need to invalidate the caches.</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="comment">     * If switching it off, need to clean the caches.</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">     * Clean + invalidate does the trick always.</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <span class="keywordflow">if</span> (now_enabled != was_enabled)</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        <a class="code" href="mmu_8c.html#ae8fca1b7a8029fee45816e7e7eccdfd1">stage2_flush_vm</a>(vcpu-&gt;kvm);</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160; </div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    <span class="comment">/* Caches are now on, stop trapping VM ops (until a S/W op) */</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    <span class="keywordflow">if</span> (now_enabled)</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        *vcpu_hcr(vcpu) &amp;= ~HCR_TVM;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160; </div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    trace_kvm_toggle_cache(*vcpu_pc(vcpu), was_enabled, now_enabled);</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a9b63a0026cbf8d3884da7ec58add5c0c_cgraph.png" border="0" usemap="#ammu_8c_a9b63a0026cbf8d3884da7ec58add5c0c_cgraph" alt=""/></div>
<map name="ammu_8c_a9b63a0026cbf8d3884da7ec58add5c0c_cgraph" id="ammu_8c_a9b63a0026cbf8d3884da7ec58add5c0c_cgraph">
<area shape="rect" title=" " alt="" coords="5,157,149,184"/>
<area shape="rect" href="mmu_8c.html#ae8fca1b7a8029fee45816e7e7eccdfd1" title=" " alt="" coords="197,157,329,184"/>
<area shape="rect" href="mmu_8c.html#a3a27465e35c31f661ad2b811ae347c23" title=" " alt="" coords="377,157,547,184"/>
<area shape="rect" href="pgtable_8c.html#a2d2b49cec6003de272a8894e958a9ee3" title=" " alt="" coords="595,150,753,191"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="806,107,951,133"/>
<area shape="rect" href="pgtable_8c.html#ad7410d161ea1f583ed8fe92581038069" title=" " alt="" coords="801,157,956,184"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="815,208,942,235"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1011,107,1163,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1219,56,1377,83"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1224,107,1372,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1425,56,1581,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1436,107,1571,133"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1645,5,1822,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1629,56,1837,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1670,157,1797,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1674,107,1793,133"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1004,208,1171,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a9b63a0026cbf8d3884da7ec58add5c0c_icgraph.png" border="0" usemap="#ammu_8c_a9b63a0026cbf8d3884da7ec58add5c0c_icgraph" alt=""/></div>
<map name="ammu_8c_a9b63a0026cbf8d3884da7ec58add5c0c_icgraph" id="ammu_8c_a9b63a0026cbf8d3884da7ec58add5c0c_icgraph">
<area shape="rect" title=" " alt="" coords="176,5,320,32"/>
<area shape="rect" href="sys__regs_8c.html#a01047bae0a6b3c1dbee152925e318110" title=" " alt="" coords="5,5,128,32"/>
</map>
</div>

</div>
</div>
<a id="ad664ca4a2c0f1b4fc2ea6ec7cb9bf651"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad664ca4a2c0f1b4fc2ea6ec7cb9bf651">&#9670;&nbsp;</a></span>kvm_uninit_stage2_mmu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_uninit_stage2_mmu </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00937">937</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;{</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <a class="code" href="mmu_8c.html#a76627fba1f507a9bfe1705285406f893">kvm_free_stage2_pgd</a>(&amp;kvm-&gt;arch.mmu);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    kvm_mmu_free_memory_cache(&amp;kvm-&gt;arch.mmu.split_page_cache);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a76627fba1f507a9bfe1705285406f893"><div class="ttname"><a href="mmu_8c.html#a76627fba1f507a9bfe1705285406f893">kvm_free_stage2_pgd</a></div><div class="ttdeci">void kvm_free_stage2_pgd(struct kvm_s2_mmu *mmu)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01011">mmu.c:1011</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ad664ca4a2c0f1b4fc2ea6ec7cb9bf651_cgraph.png" border="0" usemap="#ammu_8c_ad664ca4a2c0f1b4fc2ea6ec7cb9bf651_cgraph" alt=""/></div>
<map name="ammu_8c_ad664ca4a2c0f1b4fc2ea6ec7cb9bf651_cgraph" id="ammu_8c_ad664ca4a2c0f1b4fc2ea6ec7cb9bf651_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,192,133"/>
<area shape="rect" href="mmu_8c.html#a76627fba1f507a9bfe1705285406f893" title=" " alt="" coords="240,107,407,133"/>
<area shape="rect" href="pgtable_8c.html#ab0ed17e7108aa47fbba6cbdfea0b6606" title=" " alt="" coords="455,99,613,141"/>
<area shape="rect" href="pgtable_8c.html#ab68001fdf94eab0c95183a0d99df3576" title=" " alt="" coords="867,56,995,83"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="661,107,807,133"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="1265,157,1414,184"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1060,56,1208,83"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="855,107,1007,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1055,107,1213,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1261,107,1417,133"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1272,56,1407,83"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1481,56,1658,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1465,5,1673,32"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1506,157,1633,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1510,107,1629,133"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1484,208,1655,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ad664ca4a2c0f1b4fc2ea6ec7cb9bf651_icgraph.png" border="0" usemap="#ammu_8c_ad664ca4a2c0f1b4fc2ea6ec7cb9bf651_icgraph" alt=""/></div>
<map name="ammu_8c_ad664ca4a2c0f1b4fc2ea6ec7cb9bf651_icgraph" id="ammu_8c_ad664ca4a2c0f1b4fc2ea6ec7cb9bf651_icgraph">
<area shape="rect" title=" " alt="" coords="1268,107,1455,133"/>
<area shape="rect" href="mmu_8c.html#a6a9d3382763ac1478855bd15907a98e2" title=" " alt="" coords="1016,107,1220,133"/>
<area shape="rect" href="kvm__main_8c.html#ab6320575dc04178df16ea4d7dddff190" title=" " alt="" coords="799,107,968,133"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="616,107,751,133"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="453,107,568,133"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,5,383,32"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,56,391,83"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,107,405,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,157,386,184"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,208,376,235"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,5,164,32"/>
</map>
</div>

</div>
</div>
<a id="aa37fc9ea36d6c97e97d77af76eca5767"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa37fc9ea36d6c97e97d77af76eca5767">&#9670;&nbsp;</a></span>kvm_unmap_gfn_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_unmap_gfn_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_gfn_range *&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01753">1753</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;{</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordflow">if</span> (!kvm-&gt;arch.mmu.pgt)</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160; </div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <a class="code" href="mmu_8c.html#a56764314df54bd366f658572d48c7098">__unmap_stage2_range</a>(&amp;kvm-&gt;arch.mmu, range-&gt;start &lt;&lt; PAGE_SHIFT,</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                 (range-&gt;end - range-&gt;start) &lt;&lt; PAGE_SHIFT,</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                 range-&gt;may_block);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160; </div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a56764314df54bd366f658572d48c7098"><div class="ttname"><a href="mmu_8c.html#a56764314df54bd366f658572d48c7098">__unmap_stage2_range</a></div><div class="ttdeci">static void __unmap_stage2_range(struct kvm_s2_mmu *mmu, phys_addr_t start, u64 size, bool may_block)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00319">mmu.c:319</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aa37fc9ea36d6c97e97d77af76eca5767_cgraph.png" border="0" usemap="#ammu_8c_aa37fc9ea36d6c97e97d77af76eca5767_cgraph" alt=""/></div>
<map name="ammu_8c_aa37fc9ea36d6c97e97d77af76eca5767_cgraph" id="ammu_8c_aa37fc9ea36d6c97e97d77af76eca5767_cgraph">
<area shape="rect" title=" " alt="" coords="5,291,180,317"/>
<area shape="rect" href="mmu_8c.html#a56764314df54bd366f658572d48c7098" title=" " alt="" coords="228,291,404,317"/>
<area shape="rect" href="pgtable_8c.html#aa3d59ae8b16d53c8703fb5ef66ff9cd5" title=" " alt="" coords="452,182,611,223"/>
<area shape="rect" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6" title=" " alt="" coords="455,320,608,347"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="675,139,820,165"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="903,57,1056,98"/>
<area shape="rect" href="pgtable_8c.html#a2859617deff18c881bade8c3aa6ffbdc" title=" " alt="" coords="1141,275,1299,317"/>
<area shape="rect" href="pgtable_8c.html#a2dc4b408fc00f4cfa78894810a50194c" title=" " alt="" coords="663,367,831,393"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="903,139,1055,165"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1141,224,1299,251"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1146,123,1294,149"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1370,224,1526,251"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1381,275,1515,301"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1594,249,1771,276"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1579,199,1787,225"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1619,476,1746,503"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1623,341,1742,368"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="1137,5,1303,32"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="1137,57,1303,98"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="1365,39,1531,65"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="1369,89,1527,116"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="1607,89,1758,116"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="1385,359,1511,385"/>
<area shape="rect" href="pgtable_8c.html#a42620f6fca0390491a59340e88890864" title=" " alt="" coords="1161,341,1279,368"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="896,493,1063,520"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="894,291,1065,317"/>
<area shape="rect" href="pgtable_8c.html#a0f7a52e6df76c52f1c0c148ae06f65a1" title=" " alt="" coords="892,240,1067,267"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="1123,173,1317,200"/>
<area shape="rect" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366" title=" " alt="" coords="659,519,836,545"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="884,595,1075,621"/>
</map>
</div>

</div>
</div>
<a id="abeed34d3f32ae7e76a83700117b7b92a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abeed34d3f32ae7e76a83700117b7b92a">&#9670;&nbsp;</a></span>kvm_unshare_hyp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_unshare_hyp </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>to</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00548">548</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;{</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    phys_addr_t start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, <a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    u64 pfn;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> (is_kernel_in_hyp_mode() || <a class="code" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b">kvm_host_owns_hyp_mappings</a>() || !from)</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    start = ALIGN_DOWN(__pa(from), PAGE_SIZE);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = PAGE_ALIGN(__pa(to));</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a> = start; <a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a> &lt; <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>; <a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a> += PAGE_SIZE) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        pfn = __phys_to_pfn(<a class="code" href="early__alloc_8c.html#a7eb8057942ed1846c6c3584dd9fa7bb5">cur</a>);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        WARN_ON(<a class="code" href="mmu_8c.html#ab784fb7eb70984bb7728e616c60ec1e2">unshare_pfn_hyp</a>(pfn));</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_ab784fb7eb70984bb7728e616c60ec1e2"><div class="ttname"><a href="mmu_8c.html#ab784fb7eb70984bb7728e616c60ec1e2">unshare_pfn_hyp</a></div><div class="ttdeci">static int unshare_pfn_hyp(u64 pfn)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00490">mmu.c:490</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_abeed34d3f32ae7e76a83700117b7b92a_cgraph.png" border="0" usemap="#ammu_8c_abeed34d3f32ae7e76a83700117b7b92a_cgraph" alt=""/></div>
<map name="ammu_8c_abeed34d3f32ae7e76a83700117b7b92a_cgraph" id="ammu_8c_abeed34d3f32ae7e76a83700117b7b92a_cgraph">
<area shape="rect" title=" " alt="" coords="5,383,147,409"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="195,357,424,384"/>
<area shape="rect" href="mmu_8c.html#ab784fb7eb70984bb7728e616c60ec1e2" title=" " alt="" coords="243,408,376,435"/>
<area shape="rect" href="mem__protect_8h.html#a259c9aa4671e27b82908850ced15f83d" title=" " alt="" coords="472,383,671,409"/>
<area shape="rect" href="mmu_8c.html#ae872b392080198975a339e2351ec3abf" title=" " alt="" coords="509,433,634,460"/>
<area shape="rect" href="mem__protect_8c.html#ab6a32e622ae646989f8a020ce5f60ca4" title=" " alt="" coords="760,281,857,308"/>
<area shape="rect" href="mem__protect_8c.html#aa70b12df63f9379efa7fe11ade510b7c" title=" " alt="" coords="727,383,891,409"/>
<area shape="rect" href="mem__protect_8c.html#a21f32ced99ed31332ac532029100e42d" title=" " alt="" coords="719,484,899,511"/>
<area shape="rect" href="mem__protect_8c.html#abbc50e372d72deb41a021219c35e3589" title=" " alt="" coords="729,332,889,359"/>
<area shape="rect" href="mem__protect_8c.html#a024de911d90c8e8d57cc96c87fecb4d3" title=" " alt="" coords="721,433,897,460"/>
<area shape="rect" href="mem__protect_8c.html#a77ec896d00d3c2ebd6669edf6bc94847" title=" " alt="" coords="957,208,1067,235"/>
<area shape="rect" href="mem__protect_8c.html#aa930dbd95452ee88a3f91456675dca49" title=" " alt="" coords="953,295,1071,321"/>
<area shape="rect" href="mem__protect_8c.html#aad9e9a7b5fa0635f39dc96649d2eed00" title=" " alt="" coords="1131,153,1293,180"/>
<area shape="rect" href="mem__protect_8c.html#ad0fe4a77ba9585f7ad46c3d212e7559d" title=" " alt="" coords="1125,208,1299,235"/>
<area shape="rect" href="mem__protect_8c.html#a2b41e87ab661559f9f860797a14c914e" title=" " alt="" coords="1355,142,1526,183"/>
<area shape="rect" href="mem__protect_8c.html#adc131fc52bbb4443366cfbe93eb87839" title=" " alt="" coords="1583,157,1781,184"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="1622,107,1742,133"/>
<area shape="rect" href="mem__protect_8c.html#add960b8fe1ef188df3090aa2102c620d" title=" " alt="" coords="1829,157,1992,184"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="2040,157,2235,184"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="2288,208,2433,235"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="2285,107,2437,133"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="2283,157,2439,184"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="2515,208,2667,235"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="2743,107,2901,133"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="2748,208,2896,235"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="2949,56,3105,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="2960,107,3095,133"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="3169,56,3346,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="3153,5,3361,32"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="3194,157,3321,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="3198,107,3317,133"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="2505,69,2677,96"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="2487,132,2695,159"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="2749,56,2895,83"/>
<area shape="rect" href="pgtable_8c.html#af16196aa505cacc0ca294719f9575ce4" title=" " alt="" coords="2042,208,2233,235"/>
<area shape="rect" href="pgtable_8c.html#a7eb05408bfb8ee8e00dc693bbd018aa9" title=" " alt="" coords="2953,208,3101,235"/>
<area shape="rect" href="pgtable_8c.html#a42620f6fca0390491a59340e88890864" title=" " alt="" coords="3198,208,3317,235"/>
<area shape="rect" href="mem__protect_8c.html#adb6b6680efb04e5e509ccf68629283f8" title=" " alt="" coords="1129,295,1295,321"/>
<area shape="rect" href="mem__protect_8c.html#a29a8e46b3a5a7fdce3bf761585537d2d" title=" " alt="" coords="1145,392,1279,419"/>
<area shape="rect" href="mem__protect_8c.html#ab45dbaed102ffbf3ccda18c0cc20a6dc" title=" " alt="" coords="1347,287,1535,329"/>
<area shape="rect" href="mem__protect_8c.html#a3ea605c8779e3d79d674c81a6d64919c" title=" " alt="" coords="1591,309,1773,336"/>
<area shape="rect" href="mem__protect_8c.html#a39c30c3fbf244570912cbd38c6e5606a" title=" " alt="" coords="1603,259,1761,285"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="1601,360,1763,387"/>
<area shape="rect" href="mem__protect_8c.html#acef59d69975c27a7815896535bbb4e65" title=" " alt="" coords="1834,310,1987,351"/>
<area shape="rect" href="mem__protect_8c.html#a89057e6dfc7b241de73b439208bcf7d5" title=" " alt="" coords="1351,418,1531,459"/>
<area shape="rect" href="mem__protect_8c.html#a4ee4815f49f2d2a8397d1e2430193a3e" title=" " alt="" coords="1349,353,1533,394"/>
<area shape="rect" href="memory_8h.html#a3858889abb828afd54e20be3a55947d8" title=" " alt="" coords="1377,484,1505,511"/>
<area shape="rect" href="mem__protect_8c.html#a906b44af03f69892941d0b4e87d52fbd" title=" " alt="" coords="1605,411,1759,437"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="955,371,1069,397"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="947,459,1077,485"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_abeed34d3f32ae7e76a83700117b7b92a_icgraph.png" border="0" usemap="#ammu_8c_abeed34d3f32ae7e76a83700117b7b92a_icgraph" alt=""/></div>
<map name="ammu_8c_abeed34d3f32ae7e76a83700117b7b92a_icgraph" id="ammu_8c_abeed34d3f32ae7e76a83700117b7b92a_icgraph">
<area shape="rect" title=" " alt="" coords="2200,85,2341,112"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="799,85,969,112"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="1022,9,1165,36"/>
<area shape="rect" href="reset_8c.html#ae42f979a2e15b7e51c3e3dfc133cb473" title=" " alt="" coords="1708,121,1887,148"/>
<area shape="rect" href="fpsimd_8c.html#a4a413d27f1db48bf29f9bdb738ab0b94" title=" " alt="" coords="1949,161,2152,188"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="620,9,747,36"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="616,97,751,124"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,5,405,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="453,104,568,131"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,107,383,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,157,391,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,208,386,235"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,56,376,83"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,107,164,133"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1465,121,1645,148"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1245,161,1390,188"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1217,111,1417,137"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1017,136,1169,163"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="1693,176,1901,203"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="1466,194,1645,235"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="1255,212,1379,239"/>
</map>
</div>

</div>
</div>
<a id="ad2c3caa2e6c80158e1818c521d188e45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2c3caa2e6c80158e1818c521d188e45">&#9670;&nbsp;</a></span>kvm_vma_mte_allowed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_vma_mte_allowed </td>
          <td>(</td>
          <td class="paramtype">struct vm_area_struct *&#160;</td>
          <td class="paramname"><em>vma</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01372">1372</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;{</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keywordflow">return</span> vma-&gt;vm_flags &amp; VM_MTE_ALLOWED;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ad2c3caa2e6c80158e1818c521d188e45_icgraph.png" border="0" usemap="#ammu_8c_ad2c3caa2e6c80158e1818c521d188e45_icgraph" alt=""/></div>
<map name="ammu_8c_ad2c3caa2e6c80158e1818c521d188e45_icgraph" id="ammu_8c_ad2c3caa2e6c80158e1818c521d188e45_icgraph">
<area shape="rect" title=" " alt="" coords="1421,42,1600,69"/>
<area shape="rect" href="mmu_8c.html#a14568e065745512e03b3088070848289" title=" " alt="" coords="1168,5,1373,47"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="1205,71,1337,98"/>
<area shape="rect" href="kvm__main_8c.html#a6dd13a049fee9663450eebbf2ac16faa" title=" " alt="" coords="941,5,1112,47"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="743,13,885,39"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,13,695,39"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,13,444,39"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="933,71,1120,98"/>
</map>
</div>

</div>
</div>
<a id="ae621c40a28e874f5d7bdb502c2dec724"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae621c40a28e874f5d7bdb502c2dec724">&#9670;&nbsp;</a></span>memslot_is_logging()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool memslot_is_logging </td>
          <td>(</td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>memslot</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00158">158</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;{</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">return</span> memslot-&gt;dirty_bitmap &amp;&amp; !(memslot-&gt;flags &amp; KVM_MEM_READONLY);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ae621c40a28e874f5d7bdb502c2dec724_icgraph.png" border="0" usemap="#ammu_8c_ae621c40a28e874f5d7bdb502c2dec724_icgraph" alt=""/></div>
<map name="ammu_8c_ae621c40a28e874f5d7bdb502c2dec724_icgraph" id="ammu_8c_ae621c40a28e874f5d7bdb502c2dec724_icgraph">
<area shape="rect" title=" " alt="" coords="420,5,573,32"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="240,5,372,32"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,5,192,32"/>
</map>
</div>

</div>
</div>
<a id="abfda6046e28c6dfc58730ef92bee6f3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfda6046e28c6dfc58730ef92bee6f3a">&#9670;&nbsp;</a></span>need_split_memcache_topup_or_resched()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool need_split_memcache_topup_or_resched </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00100">100</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;{</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keyword">struct </span>kvm_mmu_memory_cache *cache;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    u64 chunk_size, min;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">if</span> (need_resched() || rwlock_needbreak(&amp;kvm-&gt;mmu_lock))</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    chunk_size = kvm-&gt;arch.mmu.split_page_chunk_size;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    min = <a class="code" href="mmu_8c.html#a62047c119e6707e0579424df7ab7bd77">kvm_mmu_split_nr_page_tables</a>(chunk_size);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    cache = &amp;kvm-&gt;arch.mmu.split_page_cache;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">return</span> kvm_mmu_memory_cache_nr_free_objects(cache) &lt; min;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_abfda6046e28c6dfc58730ef92bee6f3a_cgraph.png" border="0" usemap="#ammu_8c_abfda6046e28c6dfc58730ef92bee6f3a_cgraph" alt=""/></div>
<map name="ammu_8c_abfda6046e28c6dfc58730ef92bee6f3a_cgraph" id="ammu_8c_abfda6046e28c6dfc58730ef92bee6f3a_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,173,47"/>
<area shape="rect" href="mmu_8c.html#a62047c119e6707e0579424df7ab7bd77" title=" " alt="" coords="221,5,408,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_abfda6046e28c6dfc58730ef92bee6f3a_icgraph.png" border="0" usemap="#ammu_8c_abfda6046e28c6dfc58730ef92bee6f3a_icgraph" alt=""/></div>
<map name="ammu_8c_abfda6046e28c6dfc58730ef92bee6f3a_icgraph" id="ammu_8c_abfda6046e28c6dfc58730ef92bee6f3a_icgraph">
<area shape="rect" title=" " alt="" coords="1917,39,2085,80"/>
<area shape="rect" href="mmu_8c.html#adf6f75ecf7d564f9aa7b446e6a236d2d" title=" " alt="" coords="1703,39,1869,80"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="1471,5,1649,47"/>
<area shape="rect" href="mmu_8c.html#a14911068d5606cb3780e93aabfd5da96" title=" " alt="" coords="1465,71,1655,112"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="1237,13,1393,39"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="975,13,1135,39"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="743,5,897,47"/>
<area shape="rect" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1212,71,1417,112"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="945,78,1164,105"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="749,78,891,105"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,78,695,105"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,78,444,105"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,71,208,112"/>
</map>
</div>

</div>
</div>
<a id="a44914d574274fbd2a9a2afb90649f15c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44914d574274fbd2a9a2afb90649f15c">&#9670;&nbsp;</a></span>sanitise_mte_tags()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void sanitise_mte_tags </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">kvm_pfn_t&#160;</td>
          <td class="paramname"><em>pfn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01355">1355</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;{</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i, nr_pages = <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> &gt;&gt; PAGE_SHIFT;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keyword">struct </span>page *page = pfn_to_page(pfn);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordflow">if</span> (!kvm_has_mte(kvm))</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160; </div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; nr_pages; i++, page++) {</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <span class="keywordflow">if</span> (try_page_mte_tagging(page)) {</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            mte_clear_page_tags(page_address(page));</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            set_page_mte_tagged(page);</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        }</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a44914d574274fbd2a9a2afb90649f15c_icgraph.png" border="0" usemap="#ammu_8c_a44914d574274fbd2a9a2afb90649f15c_icgraph" alt=""/></div>
<map name="ammu_8c_a44914d574274fbd2a9a2afb90649f15c_icgraph" id="ammu_8c_a44914d574274fbd2a9a2afb90649f15c_icgraph">
<area shape="rect" title=" " alt="" coords="420,5,561,32"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="240,5,372,32"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,5,192,32"/>
</map>
</div>

</div>
</div>
<a id="aa7729a167573cc14881088e0516f28d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7729a167573cc14881088e0516f28d5">&#9670;&nbsp;</a></span>share_pfn_hyp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int share_pfn_hyp </td>
          <td>(</td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>pfn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00460">460</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;{</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keyword">struct </span>rb_node **node, *parent;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhyp__shared__pfn.html">hyp_shared_pfn</a> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    mutex_lock(&amp;hyp_shared_pfns_lock);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keyword">this</span> = <a class="code" href="mmu_8c.html#ae872b392080198975a339e2351ec3abf">find_shared_pfn</a>(<a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a>, &amp;<a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a>, &amp;parent);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">this</span>) {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        this-&gt;<a class="code" href="structhyp__shared__pfn.html#a15a490e1c3b9afc73efb02af4398c82d">count</a>++;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">goto</span> unlock;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keyword">this</span> = kzalloc(<span class="keyword">sizeof</span>(*<span class="keyword">this</span>), GFP_KERNEL);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> (!<span class="keyword">this</span>) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        ret = -ENOMEM;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">goto</span> unlock;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    this-&gt;<a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a> = <a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    this-&gt;<a class="code" href="structhyp__shared__pfn.html#a15a490e1c3b9afc73efb02af4398c82d">count</a> = 1;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    rb_link_node(&amp;this-&gt;node, parent, <a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a>);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    rb_insert_color(&amp;this-&gt;node, &amp;<a class="code" href="mmu_8c.html#a50c37f7656dc83a4d640ece2b0e36e7b">hyp_shared_pfns</a>);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    ret = kvm_call_hyp_nvhe(<a class="code" href="mem__protect_8h.html#a5386cf2bf4917b7abcc5fb60845688d9">__pkvm_host_share_hyp</a>, <a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a>, 1);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;unlock:</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    mutex_unlock(&amp;hyp_shared_pfns_lock);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div>
<div class="ttc" id="amem__protect_8h_html_a5386cf2bf4917b7abcc5fb60845688d9"><div class="ttname"><a href="mem__protect_8h.html#a5386cf2bf4917b7abcc5fb60845688d9">__pkvm_host_share_hyp</a></div><div class="ttdeci">int __pkvm_host_share_hyp(u64 pfn)</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8c_source.html#l01086">mem_protect.c:1086</a></div></div>
<div class="ttc" id="ammu_8c_html_ae872b392080198975a339e2351ec3abf"><div class="ttname"><a href="mmu_8c.html#ae872b392080198975a339e2351ec3abf">find_shared_pfn</a></div><div class="ttdeci">static struct hyp_shared_pfn * find_shared_pfn(u64 pfn, struct rb_node ***node, struct rb_node **parent)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00439">mmu.c:439</a></div></div>
<div class="ttc" id="astructhyp__shared__pfn_html_a15a490e1c3b9afc73efb02af4398c82d"><div class="ttname"><a href="structhyp__shared__pfn.html#a15a490e1c3b9afc73efb02af4398c82d">hyp_shared_pfn::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00432">mmu.c:432</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aa7729a167573cc14881088e0516f28d5_cgraph.png" border="0" usemap="#ammu_8c_aa7729a167573cc14881088e0516f28d5_cgraph" alt=""/></div>
<map name="ammu_8c_aa7729a167573cc14881088e0516f28d5_cgraph" id="ammu_8c_aa7729a167573cc14881088e0516f28d5_cgraph">
<area shape="rect" title=" " alt="" coords="5,329,123,356"/>
<area shape="rect" href="mem__protect_8h.html#a5386cf2bf4917b7abcc5fb60845688d9" title=" " alt="" coords="171,304,353,331"/>
<area shape="rect" href="mmu_8c.html#ae872b392080198975a339e2351ec3abf" title=" " alt="" coords="199,355,325,381"/>
<area shape="rect" href="mem__protect_8c.html#a6bfbb53a58e0b5b5533cfc11957f42c2" title=" " alt="" coords="451,203,532,229"/>
<area shape="rect" href="mem__protect_8c.html#aa70b12df63f9379efa7fe11ade510b7c" title=" " alt="" coords="409,253,573,280"/>
<area shape="rect" href="mem__protect_8c.html#a21f32ced99ed31332ac532029100e42d" title=" " alt="" coords="401,355,581,381"/>
<area shape="rect" href="mem__protect_8c.html#abbc50e372d72deb41a021219c35e3589" title=" " alt="" coords="411,304,571,331"/>
<area shape="rect" href="mem__protect_8c.html#a024de911d90c8e8d57cc96c87fecb4d3" title=" " alt="" coords="403,405,579,432"/>
<area shape="rect" href="mem__protect_8c.html#a813121259f4344cbf372cbf3d7f50588" title=" " alt="" coords="647,157,742,184"/>
<area shape="rect" href="mem__protect_8c.html#aaa8cef3120e457500b49a5de34545c24" title=" " alt="" coords="1037,223,1139,249"/>
<area shape="rect" href="mem__protect_8c.html#a6fc6b31d003170e866222dffa08ae092" title=" " alt="" coords="808,103,955,129"/>
<area shape="rect" href="mem__protect_8c.html#a635909c724738612986586327fa71a0b" title=" " alt="" coords="1009,157,1167,184"/>
<area shape="rect" href="mem__protect_8c.html#a2b41e87ab661559f9f860797a14c914e" title=" " alt="" coords="1003,91,1173,133"/>
<area shape="rect" href="mem__protect_8c.html#adc131fc52bbb4443366cfbe93eb87839" title=" " alt="" coords="1221,56,1420,83"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="1261,107,1381,133"/>
<area shape="rect" href="mem__protect_8c.html#add960b8fe1ef188df3090aa2102c620d" title=" " alt="" coords="1481,56,1643,83"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="1704,56,1899,83"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1952,208,2097,235"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="1949,56,2101,83"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="1947,5,2103,32"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="2179,196,2331,223"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="2442,196,2601,223"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="2447,145,2595,172"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="2684,196,2840,223"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="2695,145,2829,172"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="2169,5,2341,32"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="2151,56,2359,83"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="2448,81,2595,108"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="2453,5,2590,32"/>
<area shape="rect" href="mm_8h.html#a36a82f8cc52bf1bf431f904beddc6c18" title=" " alt="" coords="1473,150,1651,191"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="1720,208,1883,235"/>
<area shape="rect" href="memory_8h.html#aae436fb2b3f13c0954cde727104e80ac" title=" " alt="" coords="1735,107,1868,133"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="1714,157,1889,184"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="1959,107,2091,133"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="1957,157,2093,184"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="2160,247,2349,273"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="2407,247,2636,273"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="2432,297,2611,324"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="2689,247,2835,273"/>
<area shape="rect" href="mem__protect_8c.html#a5d4226b7d58b6d55f4d6d7195914f4c2" title=" " alt="" coords="1243,215,1399,257"/>
<area shape="rect" href="mem__protect_8c.html#a54456b5931c9badb4e3272081518a9c9" title=" " alt="" coords="1261,288,1380,315"/>
<area shape="rect" href="mem__protect_8c.html#ab45dbaed102ffbf3ccda18c0cc20a6dc" title=" " alt="" coords="1468,215,1656,257"/>
<area shape="rect" href="mem__protect_8c.html#a3ea605c8779e3d79d674c81a6d64919c" title=" " alt="" coords="1710,309,1893,336"/>
<area shape="rect" href="mem__protect_8c.html#a39c30c3fbf244570912cbd38c6e5606a" title=" " alt="" coords="1723,259,1880,285"/>
<area shape="rect" href="mem__protect_8c.html#acef59d69975c27a7815896535bbb4e65" title=" " alt="" coords="1948,302,2101,343"/>
<area shape="rect" href="mem__protect_8c.html#a89057e6dfc7b241de73b439208bcf7d5" title=" " alt="" coords="1472,281,1652,322"/>
<area shape="rect" href="mem__protect_8c.html#a4ee4815f49f2d2a8397d1e2430193a3e" title=" " alt="" coords="1470,346,1654,387"/>
<area shape="rect" href="mem__protect_8c.html#a906b44af03f69892941d0b4e87d52fbd" title=" " alt="" coords="1725,360,1878,387"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="637,292,752,319"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="629,380,760,407"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_aa7729a167573cc14881088e0516f28d5_icgraph.png" border="0" usemap="#ammu_8c_aa7729a167573cc14881088e0516f28d5_icgraph" alt=""/></div>
<map name="ammu_8c_aa7729a167573cc14881088e0516f28d5_icgraph" id="ammu_8c_aa7729a167573cc14881088e0516f28d5_icgraph">
<area shape="rect" title=" " alt="" coords="1096,81,1213,108"/>
<area shape="rect" href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d" title=" " alt="" coords="923,81,1048,108"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="699,5,842,32"/>
<area shape="rect" href="arm_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="685,56,857,83"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="667,107,875,133"/>
<area shape="rect" href="reset_8c.html#a82e2644a8e182c72a70fa52b0a0acae9" title=" " alt="" coords="684,157,857,184"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="455,5,582,32"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="177,5,371,32"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="419,56,619,83"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="185,97,363,138"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,133,129,160"/>
<area shape="rect" href="reset_8c.html#ae95bc53f52db3e69595fd0a53c8bc8fb" title=" " alt="" coords="431,159,607,185"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="195,163,353,189"/>
</map>
</div>

</div>
</div>
<a id="a98bf34ceab6b426d1ac6d1a9e8f0b6e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98bf34ceab6b426d1ac6d1a9e8f0b6e6">&#9670;&nbsp;</a></span>stage2_apply_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int stage2_apply_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm_s2_mmu *&#160;</td>
          <td class="paramname"><em>mmu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(struct kvm_pgtable *, u64, u64)&#160;</td>
          <td class="paramname"><em>fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>resched</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00056">56</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;{</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">struct </span>kvm *kvm = kvm_s2_mmu_to_kvm(mmu);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    u64 next;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keyword">struct </span>kvm_pgtable *pgt = mmu-&gt;pgt;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">if</span> (!pgt)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        next = <a class="code" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366">stage2_range_addr_end</a>(addr, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        ret = fn(pgt, addr, next - addr);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">if</span> (resched &amp;&amp; next != <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            cond_resched_rwlock_write(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    } <span class="keywordflow">while</span> (addr = next, addr != <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a6f5d4fce669004cefa084be2a096c366"><div class="ttname"><a href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366">stage2_range_addr_end</a></div><div class="ttdeci">static phys_addr_t stage2_range_addr_end(phys_addr_t addr, phys_addr_t end)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00042">mmu.c:42</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a98bf34ceab6b426d1ac6d1a9e8f0b6e6_cgraph.png" border="0" usemap="#ammu_8c_a98bf34ceab6b426d1ac6d1a9e8f0b6e6_cgraph" alt=""/></div>
<map name="ammu_8c_a98bf34ceab6b426d1ac6d1a9e8f0b6e6_cgraph" id="ammu_8c_a98bf34ceab6b426d1ac6d1a9e8f0b6e6_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,159,32"/>
<area shape="rect" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366" title=" " alt="" coords="207,5,384,32"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="432,5,623,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a98bf34ceab6b426d1ac6d1a9e8f0b6e6_icgraph.png" border="0" usemap="#ammu_8c_a98bf34ceab6b426d1ac6d1a9e8f0b6e6_icgraph" alt=""/></div>
<map name="ammu_8c_a98bf34ceab6b426d1ac6d1a9e8f0b6e6_icgraph" id="ammu_8c_a98bf34ceab6b426d1ac6d1a9e8f0b6e6_icgraph">
<area shape="rect" title=" " alt="" coords="1863,31,2016,57"/>
<area shape="rect" href="mmu_8c.html#a56764314df54bd366f658572d48c7098" title=" " alt="" coords="1639,31,1815,57"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="1416,5,1591,32"/>
<area shape="rect" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6" title=" " alt="" coords="1422,56,1585,83"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="1186,19,1367,61"/>
<area shape="rect" href="mmu_8c.html#a333a2def5727ab3a2ba5d13f21e2b5bb" title=" " alt="" coords="1185,85,1368,112"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="949,27,1137,53"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="751,27,893,53"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,27,695,53"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,27,444,53"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,19,208,61"/>
<area shape="rect" href="mmu_8c.html#ac71af3662ba64cc112e0aa668743155a" title=" " alt="" coords="970,85,1117,112"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="743,78,901,119"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="514,85,673,112"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="288,85,412,112"/>
</map>
</div>

</div>
</div>
<a id="a3a27465e35c31f661ad2b811ae347c23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a27465e35c31f661ad2b811ae347c23">&#9670;&nbsp;</a></span>stage2_flush_memslot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stage2_flush_memslot </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>memslot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00336">336</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;{</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    phys_addr_t addr = memslot-&gt;base_gfn &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    phys_addr_t <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = addr + PAGE_SIZE * memslot-&gt;npages;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="mmu_8c.html#a3b511994c3e3ccd15f989fc7dd2653bd">stage2_apply_range_resched</a>(&amp;kvm-&gt;arch.mmu, addr, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, <a class="code" href="pgtable_8c.html#a2d2b49cec6003de272a8894e958a9ee3">kvm_pgtable_stage2_flush</a>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a3b511994c3e3ccd15f989fc7dd2653bd"><div class="ttname"><a href="mmu_8c.html#a3b511994c3e3ccd15f989fc7dd2653bd">stage2_apply_range_resched</a></div><div class="ttdeci">#define stage2_apply_range_resched(mmu, addr, end, fn)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00082">mmu.c:82</a></div></div>
<div class="ttc" id="apgtable_8c_html_a2d2b49cec6003de272a8894e958a9ee3"><div class="ttname"><a href="pgtable_8c.html#a2d2b49cec6003de272a8894e958a9ee3">kvm_pgtable_stage2_flush</a></div><div class="ttdeci">int kvm_pgtable_stage2_flush(struct kvm_pgtable *pgt, u64 addr, u64 size)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01364">pgtable.c:1364</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a3a27465e35c31f661ad2b811ae347c23_cgraph.png" border="0" usemap="#ammu_8c_a3a27465e35c31f661ad2b811ae347c23_cgraph" alt=""/></div>
<map name="ammu_8c_a3a27465e35c31f661ad2b811ae347c23_cgraph" id="ammu_8c_a3a27465e35c31f661ad2b811ae347c23_cgraph">
<area shape="rect" title=" " alt="" coords="5,157,175,184"/>
<area shape="rect" href="pgtable_8c.html#a2d2b49cec6003de272a8894e958a9ee3" title=" " alt="" coords="223,150,381,191"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="434,107,579,133"/>
<area shape="rect" href="pgtable_8c.html#ad7410d161ea1f583ed8fe92581038069" title=" " alt="" coords="429,157,584,184"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="443,208,570,235"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="639,107,791,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="847,56,1005,83"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="852,107,1000,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1053,56,1209,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1064,107,1199,133"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1273,5,1450,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1257,56,1465,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1298,157,1425,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1302,107,1421,133"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="632,208,799,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a3a27465e35c31f661ad2b811ae347c23_icgraph.png" border="0" usemap="#ammu_8c_a3a27465e35c31f661ad2b811ae347c23_icgraph" alt=""/></div>
<map name="ammu_8c_a3a27465e35c31f661ad2b811ae347c23_icgraph" id="ammu_8c_a3a27465e35c31f661ad2b811ae347c23_icgraph">
<area shape="rect" title=" " alt="" coords="717,31,887,57"/>
<area shape="rect" href="mmu_8c.html#ae8fca1b7a8029fee45816e7e7eccdfd1" title=" " alt="" coords="537,31,669,57"/>
<area shape="rect" href="mmu_8c.html#a02fcf6f3335d5fa450266c18e6e8f0a5" title=" " alt="" coords="339,5,489,32"/>
<area shape="rect" href="mmu_8c.html#a9b63a0026cbf8d3884da7ec58add5c0c" title=" " alt="" coords="342,56,486,83"/>
<area shape="rect" href="sys__regs_8c.html#a921dd58e3a4f932dc4e7a8d9165588ac" title=" " alt="" coords="176,5,283,32"/>
<area shape="rect" href="sys__regs_8c.html#affcbc277fd697c88cc97fbbcce0bf78f" title=" " alt="" coords="5,5,120,32"/>
<area shape="rect" href="sys__regs_8c.html#a01047bae0a6b3c1dbee152925e318110" title=" " alt="" coords="168,56,291,83"/>
</map>
</div>

</div>
</div>
<a id="ae8fca1b7a8029fee45816e7e7eccdfd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8fca1b7a8029fee45816e7e7eccdfd1">&#9670;&nbsp;</a></span>stage2_flush_vm()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stage2_flush_vm </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>stage2_flush_vm - Invalidate cache for pages mapped in stage 2 @kvm: The struct kvm pointer</p>
<p>Go through the stage 2 page tables and invalidate any cache lines backing memory already mapped to the VM. </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00352">352</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keyword">struct </span>kvm_memslots *slots;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">struct </span>kvm_memory_slot *memslot;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordtype">int</span> idx, bkt;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    idx = srcu_read_lock(&amp;kvm-&gt;srcu);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    write_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    slots = kvm_memslots(kvm);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    kvm_for_each_memslot(memslot, bkt, slots)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <a class="code" href="mmu_8c.html#a3a27465e35c31f661ad2b811ae347c23">stage2_flush_memslot</a>(kvm, memslot);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    write_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    srcu_read_unlock(&amp;kvm-&gt;srcu, idx);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a3a27465e35c31f661ad2b811ae347c23"><div class="ttname"><a href="mmu_8c.html#a3a27465e35c31f661ad2b811ae347c23">stage2_flush_memslot</a></div><div class="ttdeci">static void stage2_flush_memslot(struct kvm *kvm, struct kvm_memory_slot *memslot)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00336">mmu.c:336</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ae8fca1b7a8029fee45816e7e7eccdfd1_cgraph.png" border="0" usemap="#ammu_8c_ae8fca1b7a8029fee45816e7e7eccdfd1_cgraph" alt=""/></div>
<map name="ammu_8c_ae8fca1b7a8029fee45816e7e7eccdfd1_cgraph" id="ammu_8c_ae8fca1b7a8029fee45816e7e7eccdfd1_cgraph">
<area shape="rect" title=" " alt="" coords="5,157,137,184"/>
<area shape="rect" href="mmu_8c.html#a3a27465e35c31f661ad2b811ae347c23" title=" " alt="" coords="185,157,355,184"/>
<area shape="rect" href="pgtable_8c.html#a2d2b49cec6003de272a8894e958a9ee3" title=" " alt="" coords="403,150,561,191"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="614,107,759,133"/>
<area shape="rect" href="pgtable_8c.html#ad7410d161ea1f583ed8fe92581038069" title=" " alt="" coords="609,157,764,184"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="623,208,750,235"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="819,107,971,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1027,56,1185,83"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1032,107,1180,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1233,56,1389,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1244,107,1379,133"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1453,5,1630,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1437,56,1645,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1478,157,1605,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1482,107,1601,133"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="812,208,979,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ae8fca1b7a8029fee45816e7e7eccdfd1_icgraph.png" border="0" usemap="#ammu_8c_ae8fca1b7a8029fee45816e7e7eccdfd1_icgraph" alt=""/></div>
<map name="ammu_8c_ae8fca1b7a8029fee45816e7e7eccdfd1_icgraph" id="ammu_8c_ae8fca1b7a8029fee45816e7e7eccdfd1_icgraph">
<area shape="rect" title=" " alt="" coords="537,31,669,57"/>
<area shape="rect" href="mmu_8c.html#a02fcf6f3335d5fa450266c18e6e8f0a5" title=" " alt="" coords="339,5,489,32"/>
<area shape="rect" href="mmu_8c.html#a9b63a0026cbf8d3884da7ec58add5c0c" title=" " alt="" coords="342,56,486,83"/>
<area shape="rect" href="sys__regs_8c.html#a921dd58e3a4f932dc4e7a8d9165588ac" title=" " alt="" coords="176,5,283,32"/>
<area shape="rect" href="sys__regs_8c.html#affcbc277fd697c88cc97fbbcce0bf78f" title=" " alt="" coords="5,5,120,32"/>
<area shape="rect" href="sys__regs_8c.html#a01047bae0a6b3c1dbee152925e318110" title=" " alt="" coords="168,56,291,83"/>
</map>
</div>

</div>
</div>
<a id="ae9ef59f6c6f5db240f93b35fb779255b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9ef59f6c6f5db240f93b35fb779255b">&#9670;&nbsp;</a></span>stage2_free_unlinked_table()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stage2_free_unlinked_table </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">s8&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00231">231</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keyword">struct </span>page *page = virt_to_page(addr);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    set_page_private(page, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)level);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    call_rcu(&amp;page-&gt;rcu_head, <a class="code" href="mmu_8c.html#a9fae9a03ca40ca0fecad7a963d06242f">stage2_free_unlinked_table_rcu_cb</a>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a9fae9a03ca40ca0fecad7a963d06242f"><div class="ttname"><a href="mmu_8c.html#a9fae9a03ca40ca0fecad7a963d06242f">stage2_free_unlinked_table_rcu_cb</a></div><div class="ttdeci">static void stage2_free_unlinked_table_rcu_cb(struct rcu_head *head)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00222">mmu.c:222</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ae9ef59f6c6f5db240f93b35fb779255b_cgraph.png" border="0" usemap="#ammu_8c_ae9ef59f6c6f5db240f93b35fb779255b_cgraph" alt=""/></div>
<map name="ammu_8c_ae9ef59f6c6f5db240f93b35fb779255b_cgraph" id="ammu_8c_ae9ef59f6c6f5db240f93b35fb779255b_cgraph">
<area shape="rect" title=" " alt="" coords="5,125,167,166"/>
<area shape="rect" href="mmu_8c.html#a9fae9a03ca40ca0fecad7a963d06242f" title=" " alt="" coords="215,125,376,166"/>
<area shape="rect" href="pgtable_8c.html#a9b56b0328830763f594958b5df530e3a" title=" " alt="" coords="424,125,583,166"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="631,107,789,133"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="841,157,990,184"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="837,107,993,133"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="848,56,983,83"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1057,56,1234,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1041,5,1249,32"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1082,157,1209,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1086,107,1205,133"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1060,208,1231,235"/>
</map>
</div>

</div>
</div>
<a id="a9fae9a03ca40ca0fecad7a963d06242f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fae9a03ca40ca0fecad7a963d06242f">&#9670;&nbsp;</a></span>stage2_free_unlinked_table_rcu_cb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stage2_free_unlinked_table_rcu_cb </td>
          <td>(</td>
          <td class="paramtype">struct rcu_head *&#160;</td>
          <td class="paramname"><em>head</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00222">222</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">struct </span>page *page = container_of(head, <span class="keyword">struct</span> page, rcu_head);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordtype">void</span> *pgtable = page_to_virt(page);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    s8 level = page_private(page);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="pgtable_8c.html#a9b56b0328830763f594958b5df530e3a">kvm_pgtable_stage2_free_unlinked</a>(&amp;<a class="code" href="mmu_8c.html#a76e73dbe0eaa8e135824fd27a72cac9d">kvm_s2_mm_ops</a>, pgtable, level);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div>
<div class="ttc" id="apgtable_8c_html_a9b56b0328830763f594958b5df530e3a"><div class="ttname"><a href="pgtable_8c.html#a9b56b0328830763f594958b5df530e3a">kvm_pgtable_stage2_free_unlinked</a></div><div class="ttdeci">void kvm_pgtable_stage2_free_unlinked(struct kvm_pgtable_mm_ops *mm_ops, void *pgtable, s8 level)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01601">pgtable.c:1601</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a9fae9a03ca40ca0fecad7a963d06242f_cgraph.png" border="0" usemap="#ammu_8c_a9fae9a03ca40ca0fecad7a963d06242f_cgraph" alt=""/></div>
<map name="ammu_8c_a9fae9a03ca40ca0fecad7a963d06242f_cgraph" id="ammu_8c_a9fae9a03ca40ca0fecad7a963d06242f_cgraph">
<area shape="rect" title=" " alt="" coords="5,125,167,166"/>
<area shape="rect" href="pgtable_8c.html#a9b56b0328830763f594958b5df530e3a" title=" " alt="" coords="215,125,373,166"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="421,107,580,133"/>
<area shape="rect" href="pgtable_8c.html#a28c492866ecf19d7caee51ffa130c6cb" title=" " alt="" coords="631,157,781,184"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="628,107,784,133"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="639,56,773,83"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="847,56,1025,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="832,5,1040,32"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="873,157,999,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="877,107,995,133"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="851,208,1021,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a9fae9a03ca40ca0fecad7a963d06242f_icgraph.png" border="0" usemap="#ammu_8c_a9fae9a03ca40ca0fecad7a963d06242f_icgraph" alt=""/></div>
<map name="ammu_8c_a9fae9a03ca40ca0fecad7a963d06242f_icgraph" id="ammu_8c_a9fae9a03ca40ca0fecad7a963d06242f_icgraph">
<area shape="rect" title=" " alt="" coords="215,5,376,47"/>
<area shape="rect" href="mmu_8c.html#ae9ef59f6c6f5db240f93b35fb779255b" title=" " alt="" coords="5,5,167,47"/>
</map>
</div>

</div>
</div>
<a id="a007ad372dce7c2fa90ca652d5ef7ac01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a007ad372dce7c2fa90ca652d5ef7ac01">&#9670;&nbsp;</a></span>stage2_memcache_zalloc_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* stage2_memcache_zalloc_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00188">188</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;{</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keyword">struct </span>kvm_mmu_memory_cache *mc = arg;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">void</span> *virt;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">/* Allocated with __GFP_ZERO, so no need to zero */</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    virt = kvm_mmu_memory_cache_alloc(mc);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (virt)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        kvm_account_pgtable_pages(virt, 1);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">return</span> virt;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6f5d4fce669004cefa084be2a096c366"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f5d4fce669004cefa084be2a096c366">&#9670;&nbsp;</a></span>stage2_range_addr_end()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static phys_addr_t stage2_range_addr_end </td>
          <td>(</td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00042">42</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    phys_addr_t <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = kvm_granule_size(KVM_PGTABLE_MIN_BLOCK_LEVEL);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2">__stage2_range_addr_end</a>(addr, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a6f5d4fce669004cefa084be2a096c366_cgraph.png" border="0" usemap="#ammu_8c_a6f5d4fce669004cefa084be2a096c366_cgraph" alt=""/></div>
<map name="ammu_8c_a6f5d4fce669004cefa084be2a096c366_cgraph" id="ammu_8c_a6f5d4fce669004cefa084be2a096c366_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,183,32"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="231,5,421,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a6f5d4fce669004cefa084be2a096c366_icgraph.png" border="0" usemap="#ammu_8c_a6f5d4fce669004cefa084be2a096c366_icgraph" alt=""/></div>
<map name="ammu_8c_a6f5d4fce669004cefa084be2a096c366_icgraph" id="ammu_8c_a6f5d4fce669004cefa084be2a096c366_icgraph">
<area shape="rect" title=" " alt="" coords="2064,31,2241,57"/>
<area shape="rect" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6" title=" " alt="" coords="1863,31,2016,57"/>
<area shape="rect" href="mmu_8c.html#a56764314df54bd366f658572d48c7098" title=" " alt="" coords="1639,31,1815,57"/>
<area shape="rect" href="mmu_8c.html#aa37fc9ea36d6c97e97d77af76eca5767" title=" " alt="" coords="1416,5,1591,32"/>
<area shape="rect" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6" title=" " alt="" coords="1422,56,1585,83"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="1186,19,1367,61"/>
<area shape="rect" href="mmu_8c.html#a333a2def5727ab3a2ba5d13f21e2b5bb" title=" " alt="" coords="1185,85,1368,112"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="949,27,1137,53"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="751,27,893,53"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,27,695,53"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,27,444,53"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,19,208,61"/>
<area shape="rect" href="mmu_8c.html#ac71af3662ba64cc112e0aa668743155a" title=" " alt="" coords="970,85,1117,112"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="743,78,901,119"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="514,85,673,112"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="288,85,412,112"/>
</map>
</div>

</div>
</div>
<a id="a333a2def5727ab3a2ba5d13f21e2b5bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a333a2def5727ab3a2ba5d13f21e2b5bb">&#9670;&nbsp;</a></span>stage2_unmap_memslot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stage2_unmap_memslot </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>memslot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00943">943</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;{</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    hva_t hva = memslot-&gt;userspace_addr;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    phys_addr_t addr = memslot-&gt;base_gfn &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    phys_addr_t <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a> = PAGE_SIZE * memslot-&gt;npages;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    hva_t reg_end = hva + <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">     * A memory region could potentially cover multiple VMAs, and any holes</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">     * between them, so iterate over all of them to find out if we should</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">     * unmap any of them.</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">     *     +--------------------------------------------+</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">     * +---------------+----------------+   +----------------+</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">     * |   : VMA 1     |      VMA 2     |   |    VMA 3  :    |</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">     * +---------------+----------------+   +----------------+</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">     *     |               memory region                |</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">     *     +--------------------------------------------+</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keyword">struct </span>vm_area_struct *vma;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        hva_t vm_start, vm_end;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        vma = find_vma_intersection(current-&gt;mm, hva, reg_end);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <span class="keywordflow">if</span> (!vma)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">         * Take the intersection of this VMA with the memory region</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        vm_start = max(hva, vma-&gt;vm_start);</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        vm_end = min(reg_end, vma-&gt;vm_end);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        <span class="keywordflow">if</span> (!(vma-&gt;vm_flags &amp; VM_PFNMAP)) {</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            gpa_t gpa = addr + (vm_start - memslot-&gt;userspace_addr);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            <a class="code" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6">unmap_stage2_range</a>(&amp;kvm-&gt;arch.mmu, gpa, vm_end - vm_start);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        hva = vm_end;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    } <span class="keywordflow">while</span> (hva &lt; reg_end);</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a333a2def5727ab3a2ba5d13f21e2b5bb_cgraph.png" border="0" usemap="#ammu_8c_a333a2def5727ab3a2ba5d13f21e2b5bb_cgraph" alt=""/></div>
<map name="ammu_8c_a333a2def5727ab3a2ba5d13f21e2b5bb_cgraph" id="ammu_8c_a333a2def5727ab3a2ba5d13f21e2b5bb_cgraph">
<area shape="rect" title=" " alt="" coords="5,291,188,317"/>
<area shape="rect" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6" title=" " alt="" coords="236,291,399,317"/>
<area shape="rect" href="mmu_8c.html#a56764314df54bd366f658572d48c7098" title=" " alt="" coords="447,291,623,317"/>
<area shape="rect" href="pgtable_8c.html#aa3d59ae8b16d53c8703fb5ef66ff9cd5" title=" " alt="" coords="671,182,829,223"/>
<area shape="rect" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6" title=" " alt="" coords="673,320,827,347"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="893,139,1039,165"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="1121,57,1275,98"/>
<area shape="rect" href="pgtable_8c.html#a2859617deff18c881bade8c3aa6ffbdc" title=" " alt="" coords="1359,275,1518,317"/>
<area shape="rect" href="pgtable_8c.html#a2dc4b408fc00f4cfa78894810a50194c" title=" " alt="" coords="882,367,1050,393"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1122,139,1274,165"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1359,224,1518,251"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1365,123,1513,149"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1589,224,1745,251"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1599,275,1734,301"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1813,249,1990,276"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1797,199,2005,225"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1838,476,1965,503"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1842,341,1961,368"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="1355,5,1522,32"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="1355,57,1522,98"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="1584,39,1749,65"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="1588,89,1745,116"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="1826,89,1977,116"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="1603,359,1730,385"/>
<area shape="rect" href="pgtable_8c.html#a42620f6fca0390491a59340e88890864" title=" " alt="" coords="1379,341,1498,368"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1115,493,1281,520"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1113,291,1283,317"/>
<area shape="rect" href="pgtable_8c.html#a0f7a52e6df76c52f1c0c148ae06f65a1" title=" " alt="" coords="1111,240,1285,267"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="1341,173,1536,200"/>
<area shape="rect" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366" title=" " alt="" coords="877,519,1055,545"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="1103,595,1293,621"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a333a2def5727ab3a2ba5d13f21e2b5bb_icgraph.png" border="0" usemap="#ammu_8c_a333a2def5727ab3a2ba5d13f21e2b5bb_icgraph" alt=""/></div>
<map name="ammu_8c_a333a2def5727ab3a2ba5d13f21e2b5bb_icgraph" id="ammu_8c_a333a2def5727ab3a2ba5d13f21e2b5bb_icgraph">
<area shape="rect" title=" " alt="" coords="785,13,968,39"/>
<area shape="rect" href="mmu_8c.html#ac71af3662ba64cc112e0aa668743155a" title=" " alt="" coords="591,13,737,39"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="384,5,543,47"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,13,336,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="ac71af3662ba64cc112e0aa668743155a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac71af3662ba64cc112e0aa668743155a">&#9670;&nbsp;</a></span>stage2_unmap_vm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stage2_unmap_vm </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>stage2_unmap_vm - Unmap Stage-2 RAM mappings @kvm: The struct kvm pointer</p>
<p>Go through the memregions and unmap any regular RAM backing memory already mapped to the VM. </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00992">992</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;{</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keyword">struct </span>kvm_memslots *slots;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keyword">struct </span>kvm_memory_slot *memslot;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordtype">int</span> idx, bkt;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    idx = srcu_read_lock(&amp;kvm-&gt;srcu);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    mmap_read_lock(current-&gt;mm);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    write_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160; </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    slots = kvm_memslots(kvm);</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    kvm_for_each_memslot(memslot, bkt, slots)</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <a class="code" href="mmu_8c.html#a333a2def5727ab3a2ba5d13f21e2b5bb">stage2_unmap_memslot</a>(kvm, memslot);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    write_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    mmap_read_unlock(current-&gt;mm);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    srcu_read_unlock(&amp;kvm-&gt;srcu, idx);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a333a2def5727ab3a2ba5d13f21e2b5bb"><div class="ttname"><a href="mmu_8c.html#a333a2def5727ab3a2ba5d13f21e2b5bb">stage2_unmap_memslot</a></div><div class="ttdeci">static void stage2_unmap_memslot(struct kvm *kvm, struct kvm_memory_slot *memslot)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00943">mmu.c:943</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ac71af3662ba64cc112e0aa668743155a_cgraph.png" border="0" usemap="#ammu_8c_ac71af3662ba64cc112e0aa668743155a_cgraph" alt=""/></div>
<map name="ammu_8c_ac71af3662ba64cc112e0aa668743155a_cgraph" id="ammu_8c_ac71af3662ba64cc112e0aa668743155a_cgraph">
<area shape="rect" title=" " alt="" coords="5,291,152,317"/>
<area shape="rect" href="mmu_8c.html#a333a2def5727ab3a2ba5d13f21e2b5bb" title=" " alt="" coords="200,291,383,317"/>
<area shape="rect" href="mmu_8c.html#a43756116ea784c75fc9a88b4878667c6" title=" " alt="" coords="431,291,593,317"/>
<area shape="rect" href="mmu_8c.html#a56764314df54bd366f658572d48c7098" title=" " alt="" coords="641,291,817,317"/>
<area shape="rect" href="pgtable_8c.html#aa3d59ae8b16d53c8703fb5ef66ff9cd5" title=" " alt="" coords="865,182,1024,223"/>
<area shape="rect" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6" title=" " alt="" coords="868,320,1021,347"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1088,139,1233,165"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="1316,57,1469,98"/>
<area shape="rect" href="pgtable_8c.html#a2859617deff18c881bade8c3aa6ffbdc" title=" " alt="" coords="1554,275,1713,317"/>
<area shape="rect" href="pgtable_8c.html#a2dc4b408fc00f4cfa78894810a50194c" title=" " alt="" coords="1077,367,1245,393"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1317,139,1469,165"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1554,224,1713,251"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1559,123,1707,149"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1783,224,1939,251"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1794,275,1929,301"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="2007,249,2185,276"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1992,199,2200,225"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="2033,476,2159,503"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2037,341,2155,368"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="1550,5,1717,32"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="1550,57,1717,98"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="1779,39,1944,65"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="1783,89,1940,116"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="2021,89,2171,116"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="1798,359,1925,385"/>
<area shape="rect" href="pgtable_8c.html#a42620f6fca0390491a59340e88890864" title=" " alt="" coords="1574,341,1693,368"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1309,493,1476,520"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1307,291,1478,317"/>
<area shape="rect" href="pgtable_8c.html#a0f7a52e6df76c52f1c0c148ae06f65a1" title=" " alt="" coords="1305,240,1480,267"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="1536,173,1731,200"/>
<area shape="rect" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366" title=" " alt="" coords="1072,519,1249,545"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="1297,595,1488,621"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ac71af3662ba64cc112e0aa668743155a_icgraph.png" border="0" usemap="#ammu_8c_ac71af3662ba64cc112e0aa668743155a_icgraph" alt=""/></div>
<map name="ammu_8c_ac71af3662ba64cc112e0aa668743155a_icgraph" id="ammu_8c_ac71af3662ba64cc112e0aa668743155a_icgraph">
<area shape="rect" title=" " alt="" coords="591,13,737,39"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="384,5,543,47"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,13,336,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a4fd92073128280eb5aeb2254fa60cb77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fd92073128280eb5aeb2254fa60cb77">&#9670;&nbsp;</a></span>stage2_wp_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stage2_wp_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm_s2_mmu *&#160;</td>
          <td class="paramname"><em>mmu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="mmu_8c.html#a4fd92073128280eb5aeb2254fa60cb77">stage2_wp_range()</a> - write protect stage2 memory region range @mmu: The KVM stage-2 MMU pointer @addr: Start address of range @end: End address of range </p>

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01110">1110</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;{</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <a class="code" href="mmu_8c.html#a3b511994c3e3ccd15f989fc7dd2653bd">stage2_apply_range_resched</a>(mmu, addr, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, <a class="code" href="pgtable_8c.html#a60648bc84ec35aba9f0f80106ba70c0e">kvm_pgtable_stage2_wrprotect</a>);</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;}</div>
<div class="ttc" id="apgtable_8c_html_a60648bc84ec35aba9f0f80106ba70c0e"><div class="ttname"><a href="pgtable_8c.html#a60648bc84ec35aba9f0f80106ba70c0e">kvm_pgtable_stage2_wrprotect</a></div><div class="ttdeci">int kvm_pgtable_stage2_wrprotect(struct kvm_pgtable *pgt, u64 addr, u64 size)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01250">pgtable.c:1250</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a4fd92073128280eb5aeb2254fa60cb77_cgraph.png" border="0" usemap="#ammu_8c_a4fd92073128280eb5aeb2254fa60cb77_cgraph" alt=""/></div>
<map name="ammu_8c_a4fd92073128280eb5aeb2254fa60cb77_cgraph" id="ammu_8c_a4fd92073128280eb5aeb2254fa60cb77_cgraph">
<area shape="rect" title=" " alt="" coords="5,157,141,184"/>
<area shape="rect" href="pgtable_8c.html#a60648bc84ec35aba9f0f80106ba70c0e" title=" " alt="" coords="189,150,348,191"/>
<area shape="rect" href="pgtable_8c.html#a479db5e7d44bd0ef2092407a91bd04b3" title=" " alt="" coords="396,150,547,191"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="595,120,741,147"/>
<area shape="rect" href="pgtable_8c.html#ae8dfa2edb1072f647c283dd113a86ca0" title=" " alt="" coords="595,183,741,209"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="799,107,951,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1009,56,1168,83"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1015,107,1163,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1216,56,1372,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1227,107,1361,133"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1435,5,1613,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1420,56,1628,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1461,157,1587,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1465,107,1583,133"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="789,208,961,235"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="802,259,949,285"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a4fd92073128280eb5aeb2254fa60cb77_icgraph.png" border="0" usemap="#ammu_8c_a4fd92073128280eb5aeb2254fa60cb77_icgraph" alt=""/></div>
<map name="ammu_8c_a4fd92073128280eb5aeb2254fa60cb77_icgraph" id="ammu_8c_a4fd92073128280eb5aeb2254fa60cb77_icgraph">
<area shape="rect" title=" " alt="" coords="1741,42,1877,69"/>
<area shape="rect" href="mmu_8c.html#a035ec39ab60e2a3d382c272b15fc83a6" title=" " alt="" coords="1490,5,1669,47"/>
<area shape="rect" href="mmu_8c.html#a61aef4ee44be349558f529158640ae57" title=" " alt="" coords="1465,71,1693,98"/>
<area shape="rect" href="dirty__ring_8c.html#a68052369106191fbc506fdf4d64be449" title=" " alt="" coords="1237,13,1393,39"/>
<area shape="rect" href="dirty__ring_8c.html#a33f93cefad4ed59214fb8dbf36de7dd1" title=" " alt="" coords="975,13,1135,39"/>
<area shape="rect" href="kvm__main_8c.html#a91e959c20554917ba05e7feea69acc7c" title=" " alt="" coords="743,5,897,47"/>
<area shape="rect" href="mmu_8c.html#af7325960c06aa482e6f168f881d83069" title=" " alt="" coords="1212,64,1417,105"/>
<area shape="rect" href="kvm__main_8c.html#a05eed662dd45e4e4f7485e3158d95a3b" title=" " alt="" coords="945,71,1164,98"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="749,71,891,98"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,71,695,98"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,71,444,98"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,64,208,105"/>
</map>
</div>

</div>
</div>
<a id="a0635e0487ba31d99ba782cb5e43534ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0635e0487ba31d99ba782cb5e43534ef">&#9670;&nbsp;</a></span>topup_hyp_memcache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int topup_hyp_memcache </td>
          <td>(</td>
          <td class="paramtype">struct kvm_hyp_memcache *&#160;</td>
          <td class="paramname"><em>mc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>min_pages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01048">1048</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;{</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">if</span> (!is_protected_kvm_enabled())</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160; </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keywordflow">return</span> __topup_hyp_memcache(mc, min_pages, <a class="code" href="mmu_8c.html#aa02e57405b20691414428a41090844c6">hyp_mc_alloc_fn</a>,</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                    <a class="code" href="mmu_8c.html#a623efd55548e897162a46d8da0043070">kvm_host_pa</a>, NULL);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_a623efd55548e897162a46d8da0043070"><div class="ttname"><a href="mmu_8c.html#a623efd55548e897162a46d8da0043070">kvm_host_pa</a></div><div class="ttdeci">static phys_addr_t kvm_host_pa(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00263">mmu.c:263</a></div></div>
<div class="ttc" id="ammu_8c_html_aa02e57405b20691414428a41090844c6"><div class="ttname"><a href="mmu_8c.html#aa02e57405b20691414428a41090844c6">hyp_mc_alloc_fn</a></div><div class="ttdeci">static void * hyp_mc_alloc_fn(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01036">mmu.c:1036</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a0635e0487ba31d99ba782cb5e43534ef_cgraph.png" border="0" usemap="#ammu_8c_a0635e0487ba31d99ba782cb5e43534ef_cgraph" alt=""/></div>
<map name="ammu_8c_a0635e0487ba31d99ba782cb5e43534ef_cgraph" id="ammu_8c_a0635e0487ba31d99ba782cb5e43534ef_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,175,57"/>
<area shape="rect" href="mmu_8c.html#aa02e57405b20691414428a41090844c6" title=" " alt="" coords="223,5,353,32"/>
<area shape="rect" href="mmu_8c.html#a623efd55548e897162a46d8da0043070" title=" " alt="" coords="233,56,343,83"/>
</map>
</div>

</div>
</div>
<a id="a6a713dc5a6d09de79232b38705dd1896"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a713dc5a6d09de79232b38705dd1896">&#9670;&nbsp;</a></span>transparent_hugepage_adjust()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static long transparent_hugepage_adjust </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>memslot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>hva</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">kvm_pfn_t *&#160;</td>
          <td class="paramname"><em>pfnp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t *&#160;</td>
          <td class="paramname"><em>ipap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01284">1284</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;{</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    kvm_pfn_t pfn = *pfnp;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160; </div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment">     * Make sure the adjustment is done only for THP pages. Also make</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">     * sure that the HVA and IPA are sufficiently aligned and that the</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment">     * block map is contained within the memslot.</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="mmu_8c.html#ab90d07a850ec184a5284c06e0873d82d">fault_supports_stage2_huge_mapping</a>(memslot, hva, PMD_SIZE)) {</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <span class="keywordtype">int</span> sz = <a class="code" href="mmu_8c.html#af8650c6f853eb15b4e2e872e8ddbbeb2">get_user_mapping_size</a>(kvm, hva);</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160; </div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="keywordflow">if</span> (sz &lt; 0)</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            <span class="keywordflow">return</span> sz;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="keywordflow">if</span> (sz &lt; PMD_SIZE)</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="keywordflow">return</span> PAGE_SIZE;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160; </div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        *ipap &amp;= PMD_MASK;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        pfn &amp;= ~(PTRS_PER_PMD - 1);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        *pfnp = pfn;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160; </div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="keywordflow">return</span> PMD_SIZE;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160; </div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="comment">/* Use page mapping if we cannot use block mapping. */</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="keywordflow">return</span> PAGE_SIZE;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_ab90d07a850ec184a5284c06e0873d82d"><div class="ttname"><a href="mmu_8c.html#ab90d07a850ec184a5284c06e0873d82d">fault_supports_stage2_huge_mapping</a></div><div class="ttdeci">static bool fault_supports_stage2_huge_mapping(struct kvm_memory_slot *memslot, unsigned long hva, unsigned long map_size)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01214">mmu.c:1214</a></div></div>
<div class="ttc" id="ammu_8c_html_af8650c6f853eb15b4e2e872e8ddbbeb2"><div class="ttname"><a href="mmu_8c.html#af8650c6f853eb15b4e2e872e8ddbbeb2">get_user_mapping_size</a></div><div class="ttdeci">static int get_user_mapping_size(struct kvm *kvm, u64 addr)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00802">mmu.c:802</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a6a713dc5a6d09de79232b38705dd1896_cgraph.png" border="0" usemap="#ammu_8c_a6a713dc5a6d09de79232b38705dd1896_cgraph" alt=""/></div>
<map name="ammu_8c_a6a713dc5a6d09de79232b38705dd1896_cgraph" id="ammu_8c_a6a713dc5a6d09de79232b38705dd1896_cgraph">
<area shape="rect" title=" " alt="" coords="5,95,173,137"/>
<area shape="rect" href="mmu_8c.html#ab90d07a850ec184a5284c06e0873d82d" title=" " alt="" coords="225,66,392,107"/>
<area shape="rect" href="mmu_8c.html#af8650c6f853eb15b4e2e872e8ddbbeb2" title=" " alt="" coords="221,132,396,159"/>
<area shape="rect" href="pgtable_8c.html#af20a43d8934ae3cdc599bfa308f93531" title=" " alt="" coords="444,132,611,159"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="659,107,804,133"/>
<area shape="rect" href="pgtable_8c.html#a5cbdf9ac45fa98927c07779fecdef889" title=" " alt="" coords="683,157,780,184"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="852,107,1004,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1052,81,1211,108"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1057,132,1205,159"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1259,81,1415,108"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1269,132,1404,159"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1478,5,1655,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1463,56,1671,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1503,107,1630,133"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1507,157,1626,184"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a6a713dc5a6d09de79232b38705dd1896_icgraph.png" border="0" usemap="#ammu_8c_a6a713dc5a6d09de79232b38705dd1896_icgraph" alt=""/></div>
<map name="ammu_8c_a6a713dc5a6d09de79232b38705dd1896_icgraph" id="ammu_8c_a6a713dc5a6d09de79232b38705dd1896_icgraph">
<area shape="rect" title=" " alt="" coords="420,5,588,47"/>
<area shape="rect" href="mmu_8c.html#a3fa1785b4cbf3b2668c883a3c79fdeeb" title=" " alt="" coords="240,13,372,39"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,13,192,39"/>
</map>
</div>

</div>
</div>
<a id="a43756116ea784c75fc9a88b4878667c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43756116ea784c75fc9a88b4878667c6">&#9670;&nbsp;</a></span>unmap_stage2_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void unmap_stage2_range </td>
          <td>(</td>
          <td class="paramtype">struct kvm_s2_mmu *&#160;</td>
          <td class="paramname"><em>mmu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00331">331</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;{</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="mmu_8c.html#a56764314df54bd366f658572d48c7098">__unmap_stage2_range</a>(mmu, start, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a43756116ea784c75fc9a88b4878667c6_cgraph.png" border="0" usemap="#ammu_8c_a43756116ea784c75fc9a88b4878667c6_cgraph" alt=""/></div>
<map name="ammu_8c_a43756116ea784c75fc9a88b4878667c6_cgraph" id="ammu_8c_a43756116ea784c75fc9a88b4878667c6_cgraph">
<area shape="rect" title=" " alt="" coords="5,291,168,317"/>
<area shape="rect" href="mmu_8c.html#a56764314df54bd366f658572d48c7098" title=" " alt="" coords="216,291,392,317"/>
<area shape="rect" href="pgtable_8c.html#aa3d59ae8b16d53c8703fb5ef66ff9cd5" title=" " alt="" coords="440,182,599,223"/>
<area shape="rect" href="mmu_8c.html#a98bf34ceab6b426d1ac6d1a9e8f0b6e6" title=" " alt="" coords="443,320,596,347"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="663,139,808,165"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="891,57,1044,98"/>
<area shape="rect" href="pgtable_8c.html#a2859617deff18c881bade8c3aa6ffbdc" title=" " alt="" coords="1129,275,1287,317"/>
<area shape="rect" href="pgtable_8c.html#a2dc4b408fc00f4cfa78894810a50194c" title=" " alt="" coords="651,367,819,393"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="891,139,1043,165"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1129,224,1287,251"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1134,123,1282,149"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1358,224,1514,251"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1369,275,1503,301"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1582,249,1759,276"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1567,199,1775,225"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1607,476,1734,503"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1611,341,1730,368"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="1125,5,1291,32"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="1125,57,1291,98"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="1353,39,1519,65"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="1357,89,1515,116"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="1595,89,1746,116"/>
<area shape="rect" href="pgtable_8c.html#a384e9e59a45ff248ae5915118664c18a" title=" " alt="" coords="1373,359,1499,385"/>
<area shape="rect" href="pgtable_8c.html#a42620f6fca0390491a59340e88890864" title=" " alt="" coords="1149,341,1267,368"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="884,493,1051,520"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="882,291,1053,317"/>
<area shape="rect" href="pgtable_8c.html#a0f7a52e6df76c52f1c0c148ae06f65a1" title=" " alt="" coords="880,240,1055,267"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="1111,173,1305,200"/>
<area shape="rect" href="mmu_8c.html#a6f5d4fce669004cefa084be2a096c366" title=" " alt="" coords="647,519,824,545"/>
<area shape="rect" href="mmu_8c.html#a877e9a15c18a09d43fa73c90949caaa2" title=" " alt="" coords="872,595,1063,621"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a43756116ea784c75fc9a88b4878667c6_icgraph.png" border="0" usemap="#ammu_8c_a43756116ea784c75fc9a88b4878667c6_icgraph" alt=""/></div>
<map name="ammu_8c_a43756116ea784c75fc9a88b4878667c6_icgraph" id="ammu_8c_a43756116ea784c75fc9a88b4878667c6_icgraph">
<area shape="rect" title=" " alt="" coords="1416,42,1579,69"/>
<area shape="rect" href="mmu_8c.html#a58fe7b43995ae8c20c597e1bb9c4c007" title=" " alt="" coords="1186,5,1367,47"/>
<area shape="rect" href="mmu_8c.html#a333a2def5727ab3a2ba5d13f21e2b5bb" title=" " alt="" coords="1185,71,1368,98"/>
<area shape="rect" href="kvm__main_8c.html#aae203bcd73cff0002aeddd37bea71323" title=" " alt="" coords="949,13,1137,39"/>
<area shape="rect" href="kvm__main_8c.html#ac81a7d714d0668ccea6d0c2ddfd0fed5" title=" " alt="" coords="751,13,893,39"/>
<area shape="rect" href="kvm__main_8c.html#ac76f506181e49aa4800bb202e11cb2b3" title=" " alt="" coords="492,13,695,39"/>
<area shape="rect" href="kvm__main_8c.html#a1a839781d3be88d418abfb2b456663ab" title=" " alt="" coords="256,13,444,39"/>
<area shape="rect" href="kvm__main_8c.html#a4c8ff5a794a6a2e77e0cfc224568ef70" title=" " alt="" coords="5,5,208,47"/>
<area shape="rect" href="mmu_8c.html#ac71af3662ba64cc112e0aa668743155a" title=" " alt="" coords="970,71,1117,98"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="743,64,901,105"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="514,71,673,98"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="288,71,412,98"/>
</map>
</div>

</div>
</div>
<a id="ab784fb7eb70984bb7728e616c60ec1e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab784fb7eb70984bb7728e616c60ec1e2">&#9670;&nbsp;</a></span>unshare_pfn_hyp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unshare_pfn_hyp </td>
          <td>(</td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>pfn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00490">490</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;{</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keyword">struct </span>rb_node **node, *parent;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keyword">struct </span><a class="code" href="structhyp__shared__pfn.html">hyp_shared_pfn</a> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    mutex_lock(&amp;hyp_shared_pfns_lock);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keyword">this</span> = <a class="code" href="mmu_8c.html#ae872b392080198975a339e2351ec3abf">find_shared_pfn</a>(<a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a>, &amp;<a class="code" href="structhyp__shared__pfn.html#a95e3d06986e5a7e416e4d7d4d58c1450">node</a>, &amp;parent);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">if</span> (WARN_ON(!<span class="keyword">this</span>)) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        ret = -ENOENT;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">goto</span> unlock;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    this-&gt;<a class="code" href="structhyp__shared__pfn.html#a15a490e1c3b9afc73efb02af4398c82d">count</a>--;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">if</span> (this-&gt;<a class="code" href="structhyp__shared__pfn.html#a15a490e1c3b9afc73efb02af4398c82d">count</a>)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">goto</span> unlock;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    rb_erase(&amp;this-&gt;node, &amp;<a class="code" href="mmu_8c.html#a50c37f7656dc83a4d640ece2b0e36e7b">hyp_shared_pfns</a>);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    kfree(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    ret = kvm_call_hyp_nvhe(<a class="code" href="mem__protect_8h.html#a259c9aa4671e27b82908850ced15f83d">__pkvm_host_unshare_hyp</a>, <a class="code" href="structhyp__shared__pfn.html#a3694c21870a6cdf6efd3c7e07d6626ab">pfn</a>, 1);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;unlock:</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    mutex_unlock(&amp;hyp_shared_pfns_lock);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160; </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div>
<div class="ttc" id="amem__protect_8h_html_a259c9aa4671e27b82908850ced15f83d"><div class="ttname"><a href="mem__protect_8h.html#a259c9aa4671e27b82908850ced15f83d">__pkvm_host_unshare_hyp</a></div><div class="ttdeci">int __pkvm_host_unshare_hyp(u64 pfn)</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8c_source.html#l01119">mem_protect.c:1119</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ab784fb7eb70984bb7728e616c60ec1e2_cgraph.png" border="0" usemap="#ammu_8c_ab784fb7eb70984bb7728e616c60ec1e2_cgraph" alt=""/></div>
<map name="ammu_8c_ab784fb7eb70984bb7728e616c60ec1e2_cgraph" id="ammu_8c_ab784fb7eb70984bb7728e616c60ec1e2_cgraph">
<area shape="rect" title=" " alt="" coords="5,420,139,446"/>
<area shape="rect" href="mem__protect_8h.html#a259c9aa4671e27b82908850ced15f83d" title=" " alt="" coords="187,394,385,421"/>
<area shape="rect" href="mmu_8c.html#ae872b392080198975a339e2351ec3abf" title=" " alt="" coords="223,445,349,472"/>
<area shape="rect" href="mem__protect_8c.html#ab6a32e622ae646989f8a020ce5f60ca4" title=" " alt="" coords="475,293,572,320"/>
<area shape="rect" href="mem__protect_8c.html#aa70b12df63f9379efa7fe11ade510b7c" title=" " alt="" coords="441,394,605,421"/>
<area shape="rect" href="mem__protect_8c.html#a21f32ced99ed31332ac532029100e42d" title=" " alt="" coords="433,496,613,522"/>
<area shape="rect" href="mem__protect_8c.html#abbc50e372d72deb41a021219c35e3589" title=" " alt="" coords="443,344,603,370"/>
<area shape="rect" href="mem__protect_8c.html#a024de911d90c8e8d57cc96c87fecb4d3" title=" " alt="" coords="435,445,611,472"/>
<area shape="rect" href="mem__protect_8c.html#a77ec896d00d3c2ebd6669edf6bc94847" title=" " alt="" coords="671,220,782,246"/>
<area shape="rect" href="mem__protect_8c.html#aa930dbd95452ee88a3f91456675dca49" title=" " alt="" coords="667,306,786,333"/>
<area shape="rect" href="mem__protect_8c.html#aad9e9a7b5fa0635f39dc96649d2eed00" title=" " alt="" coords="845,165,1008,192"/>
<area shape="rect" href="mem__protect_8c.html#ad0fe4a77ba9585f7ad46c3d212e7559d" title=" " alt="" coords="840,220,1013,246"/>
<area shape="rect" href="mem__protect_8c.html#a2b41e87ab661559f9f860797a14c914e" title=" " alt="" coords="1070,154,1241,195"/>
<area shape="rect" href="mem__protect_8c.html#adc131fc52bbb4443366cfbe93eb87839" title=" " alt="" coords="1297,169,1496,196"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="1337,118,1457,145"/>
<area shape="rect" href="mem__protect_8c.html#add960b8fe1ef188df3090aa2102c620d" title=" " alt="" coords="1544,169,1707,196"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="1755,169,1949,196"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="2003,220,2148,246"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="2201,104,2353,130"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="1997,169,2153,196"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="2201,220,2353,246"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="2426,226,2585,253"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="2431,176,2579,202"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="2684,226,2840,253"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="2695,176,2829,202"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="2930,176,3107,202"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="2915,226,3123,253"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="2955,125,3082,152"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2959,277,3078,304"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="2419,28,2591,54"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="2401,104,2609,130"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="2689,24,2835,50"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="2950,24,3087,50"/>
<area shape="rect" href="pgtable_8c.html#a29a6724d2843672cf5db792f2beb968a" title=" " alt="" coords="2657,74,2867,101"/>
<area shape="rect" href="pgtable_8c.html#af16196aa505cacc0ca294719f9575ce4" title=" " alt="" coords="1757,220,1947,246"/>
<area shape="rect" href="pgtable_8c.html#a7eb05408bfb8ee8e00dc693bbd018aa9" title=" " alt="" coords="2688,277,2836,304"/>
<area shape="rect" href="pgtable_8c.html#a42620f6fca0390491a59340e88890864" title=" " alt="" coords="2959,328,3078,354"/>
<area shape="rect" href="mem__protect_8c.html#adb6b6680efb04e5e509ccf68629283f8" title=" " alt="" coords="844,306,1009,333"/>
<area shape="rect" href="mem__protect_8c.html#a29a8e46b3a5a7fdce3bf761585537d2d" title=" " alt="" coords="859,404,994,430"/>
<area shape="rect" href="mem__protect_8c.html#ab45dbaed102ffbf3ccda18c0cc20a6dc" title=" " alt="" coords="1061,299,1249,340"/>
<area shape="rect" href="mem__protect_8c.html#a3ea605c8779e3d79d674c81a6d64919c" title=" " alt="" coords="1305,321,1488,348"/>
<area shape="rect" href="mem__protect_8c.html#a39c30c3fbf244570912cbd38c6e5606a" title=" " alt="" coords="1318,270,1475,297"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="1315,372,1478,398"/>
<area shape="rect" href="mem__protect_8c.html#acef59d69975c27a7815896535bbb4e65" title=" " alt="" coords="1549,322,1702,363"/>
<area shape="rect" href="mem__protect_8c.html#a89057e6dfc7b241de73b439208bcf7d5" title=" " alt="" coords="1065,430,1245,471"/>
<area shape="rect" href="mem__protect_8c.html#a4ee4815f49f2d2a8397d1e2430193a3e" title=" " alt="" coords="1063,364,1247,406"/>
<area shape="rect" href="memory_8h.html#a3858889abb828afd54e20be3a55947d8" title=" " alt="" coords="1091,496,1219,522"/>
<area shape="rect" href="mem__protect_8c.html#a906b44af03f69892941d0b4e87d52fbd" title=" " alt="" coords="1320,422,1473,449"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="669,382,784,409"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="661,470,792,497"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_ab784fb7eb70984bb7728e616c60ec1e2_icgraph.png" border="0" usemap="#ammu_8c_ab784fb7eb70984bb7728e616c60ec1e2_icgraph" alt=""/></div>
<map name="ammu_8c_ab784fb7eb70984bb7728e616c60ec1e2_icgraph" id="ammu_8c_ab784fb7eb70984bb7728e616c60ec1e2_icgraph">
<area shape="rect" title=" " alt="" coords="2389,85,2523,112"/>
<area shape="rect" href="mmu_8c.html#abeed34d3f32ae7e76a83700117b7b92a" title=" " alt="" coords="2200,85,2341,112"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="799,85,969,112"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="1022,9,1165,36"/>
<area shape="rect" href="reset_8c.html#ae42f979a2e15b7e51c3e3dfc133cb473" title=" " alt="" coords="1708,121,1887,148"/>
<area shape="rect" href="fpsimd_8c.html#a4a413d27f1db48bf29f9bdb738ab0b94" title=" " alt="" coords="1949,161,2152,188"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="620,9,747,36"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="616,97,751,124"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,5,405,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="453,104,568,131"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,107,383,133"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,157,391,184"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,208,386,235"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,56,376,83"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,107,164,133"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1465,121,1645,148"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1245,161,1390,188"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1217,111,1417,137"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1017,136,1169,163"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="1693,176,1901,203"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="1466,194,1645,235"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="1255,212,1379,239"/>
</map>
</div>

</div>
</div>
<a id="a3fa1785b4cbf3b2668c883a3c79fdeeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fa1785b4cbf3b2668c883a3c79fdeeb">&#9670;&nbsp;</a></span>user_mem_abort()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int user_mem_abort </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>fault_ipa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_memory_slot *&#160;</td>
          <td class="paramname"><em>memslot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>hva</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>fault_is_perm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01377">1377</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;{</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="keywordtype">bool</span> write_fault, writable, force_pte = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordtype">bool</span> exec_fault, mte_allowed;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="keywordtype">bool</span> device = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> mmu_seq;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <span class="keyword">struct </span>kvm_mmu_memory_cache *memcache = &amp;vcpu-&gt;arch.mmu_page_cache;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    <span class="keyword">struct </span>vm_area_struct *vma;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="keywordtype">short</span> vma_shift;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    gfn_t gfn;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    kvm_pfn_t pfn;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordtype">bool</span> logging_active = <a class="code" href="mmu_8c.html#ae621c40a28e874f5d7bdb502c2dec724">memslot_is_logging</a>(memslot);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="keywordtype">long</span> vma_pagesize, fault_granule;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keyword">enum</span> kvm_pgtable_prot prot = KVM_PGTABLE_PROT_R;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="keyword">struct </span>kvm_pgtable *pgt;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keywordflow">if</span> (fault_is_perm)</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        fault_granule = kvm_vcpu_trap_get_perm_fault_granule(vcpu);</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    write_fault = kvm_is_write_fault(vcpu);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    exec_fault = kvm_vcpu_trap_is_exec_fault(vcpu);</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    VM_BUG_ON(write_fault &amp;&amp; exec_fault);</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160; </div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">if</span> (fault_is_perm &amp;&amp; !write_fault &amp;&amp; !exec_fault) {</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        kvm_err(<span class="stringliteral">&quot;Unexpected L2 read permission error\n&quot;</span>);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    }</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160; </div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">     * Permission faults just need to update the existing leaf entry,</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">     * and so normally don&#39;t require allocations from the memcache. The</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">     * only exception to this is when dirty logging is enabled at runtime</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">     * and a write fault needs to collapse a block entry into a table.</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="keywordflow">if</span> (!fault_is_perm || (logging_active &amp;&amp; write_fault)) {</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        ret = kvm_mmu_topup_memory_cache(memcache,</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                         kvm_mmu_cache_min_pages(vcpu-&gt;arch.hw_mmu));</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    }</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160; </div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment">     * Let&#39;s check if we will get back a huge page backed by hugetlbfs, or</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">     * get block mapping for device MMIO region.</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    mmap_read_lock(current-&gt;mm);</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    vma = vma_lookup(current-&gt;mm, hva);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="keywordflow">if</span> (unlikely(!vma)) {</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        kvm_err(<span class="stringliteral">&quot;Failed to find VMA for hva 0x%lx\n&quot;</span>, hva);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        mmap_read_unlock(current-&gt;mm);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    }</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160; </div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment">     * logging_active is guaranteed to never be true for VM_PFNMAP</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">     * memslots.</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keywordflow">if</span> (logging_active) {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        force_pte = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        vma_shift = PAGE_SHIFT;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        vma_shift = <a class="code" href="mmu_8c.html#a2478e510130e93368b79931c58135c1b">get_vma_page_shift</a>(vma, hva);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160; </div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordflow">switch</span> (vma_shift) {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="preprocessor">#ifndef __PAGETABLE_PMD_FOLDED</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordflow">case</span> PUD_SHIFT:</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="mmu_8c.html#ab90d07a850ec184a5284c06e0873d82d">fault_supports_stage2_huge_mapping</a>(memslot, hva, PUD_SIZE))</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        fallthrough;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordflow">case</span> CONT_PMD_SHIFT:</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        vma_shift = PMD_SHIFT;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        fallthrough;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">case</span> PMD_SHIFT:</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="mmu_8c.html#ab90d07a850ec184a5284c06e0873d82d">fault_supports_stage2_huge_mapping</a>(memslot, hva, PMD_SIZE))</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        fallthrough;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">case</span> CONT_PTE_SHIFT:</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        vma_shift = PAGE_SHIFT;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        force_pte = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        fallthrough;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="keywordflow">case</span> PAGE_SHIFT:</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        WARN_ONCE(1, <span class="stringliteral">&quot;Unknown vma_shift %d&quot;</span>, vma_shift);</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    }</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160; </div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    vma_pagesize = 1UL &lt;&lt; vma_shift;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">if</span> (vma_pagesize == PMD_SIZE || vma_pagesize == PUD_SIZE)</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        fault_ipa &amp;= ~(vma_pagesize - 1);</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160; </div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    gfn = fault_ipa &gt;&gt; PAGE_SHIFT;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    mte_allowed = <a class="code" href="mmu_8c.html#ad2c3caa2e6c80158e1818c521d188e45">kvm_vma_mte_allowed</a>(vma);</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="comment">/* Don&#39;t use the VMA after the unlock -- it may have vanished */</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    vma = NULL;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="comment">     * Read mmu_invalidate_seq so that KVM can detect if the results of</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="comment">     * vma_lookup() or __gfn_to_pfn_memslot() become stale prior to</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment">     * acquiring kvm-&gt;mmu_lock.</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">     * Rely on mmap_read_unlock() for an implicit smp_rmb(), which pairs</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="comment">     * with the smp_wmb() in kvm_mmu_invalidate_end().</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    mmu_seq = vcpu-&gt;kvm-&gt;mmu_invalidate_seq;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    mmap_read_unlock(current-&gt;mm);</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160; </div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    pfn = <a class="code" href="kvm__main_8c.html#a63ec3e18db03a212e6e84391b5025689">__gfn_to_pfn_memslot</a>(memslot, gfn, <span class="keyword">false</span>, <span class="keyword">false</span>, NULL,</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                   write_fault, &amp;writable, NULL);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">if</span> (pfn == KVM_PFN_ERR_HWPOISON) {</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <a class="code" href="mmu_8c.html#ab06707336ef5d30b56abbfd801d2f756">kvm_send_hwpoison_signal</a>(hva, vma_shift);</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    }</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="keywordflow">if</span> (is_error_noslot_pfn(pfn))</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="mmu_8c.html#a207285372ad7944209b485ecfc10ee0f">kvm_is_device_pfn</a>(pfn)) {</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment">         * If the page was identified as device early by looking at</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">         * the VMA flags, vma_pagesize is already representing the</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment">         * largest quantity we can map.  If instead it was mapped</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment">         * via gfn_to_pfn_prot(), vma_pagesize is set to PAGE_SIZE</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">         * and must not be upgraded.</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">         * In both cases, we don&#39;t let transparent_hugepage_adjust()</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">         * change things at the last minute.</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        device = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (logging_active &amp;&amp; !write_fault) {</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment">         * Only actually map the page as writable if this was a write</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">         * fault.</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        writable = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    }</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="keywordflow">if</span> (exec_fault &amp;&amp; device)</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        <span class="keywordflow">return</span> -ENOEXEC;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160; </div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    read_lock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    pgt = vcpu-&gt;arch.hw_mmu-&gt;pgt;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="keywordflow">if</span> (mmu_invalidate_retry(kvm, mmu_seq))</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160; </div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">     * If we are not forced to use page mapping, check if we are</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">     * backed by a THP and thus use block mapping if possible.</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">if</span> (vma_pagesize == PAGE_SIZE &amp;&amp; !(force_pte || device)) {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        <span class="keywordflow">if</span> (fault_is_perm &amp;&amp; fault_granule &gt; PAGE_SIZE)</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            vma_pagesize = fault_granule;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            vma_pagesize = <a class="code" href="mmu_8c.html#a6a713dc5a6d09de79232b38705dd1896">transparent_hugepage_adjust</a>(kvm, memslot,</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                                   hva, &amp;pfn,</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                                   &amp;fault_ipa);</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160; </div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <span class="keywordflow">if</span> (vma_pagesize &lt; 0) {</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            ret = vma_pagesize;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        }</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keywordflow">if</span> (!fault_is_perm &amp;&amp; !device &amp;&amp; kvm_has_mte(kvm)) {</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <span class="comment">/* Check the VMM hasn&#39;t introduced a new disallowed VMA */</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <span class="keywordflow">if</span> (mte_allowed) {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            <a class="code" href="mmu_8c.html#a44914d574274fbd2a9a2afb90649f15c">sanitise_mte_tags</a>(kvm, pfn, vma_pagesize);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            ret = -EFAULT;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        }</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    }</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160; </div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="keywordflow">if</span> (writable)</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        prot |= KVM_PGTABLE_PROT_W;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160; </div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="keywordflow">if</span> (exec_fault)</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        prot |= KVM_PGTABLE_PROT_X;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160; </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="keywordflow">if</span> (device)</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        prot |= KVM_PGTABLE_PROT_DEVICE;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cpus_have_final_cap(ARM64_HAS_CACHE_DIC))</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        prot |= KVM_PGTABLE_PROT_X;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160; </div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment">     * Under the premise of getting a FSC_PERM fault, we just need to relax</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment">     * permissions only if vma_pagesize equals fault_granule. Otherwise,</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment">     * kvm_pgtable_stage2_map() should be called to change block size.</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="keywordflow">if</span> (fault_is_perm &amp;&amp; vma_pagesize == fault_granule)</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        ret = <a class="code" href="pgtable_8c.html#a0b075f0350506df70d46e1744f9eb54b">kvm_pgtable_stage2_relax_perms</a>(pgt, fault_ipa, prot);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        ret = <a class="code" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084">kvm_pgtable_stage2_map</a>(pgt, fault_ipa, vma_pagesize,</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                         __pfn_to_phys(pfn), prot,</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                         memcache,</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                         KVM_PGTABLE_WALK_HANDLE_FAULT |</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                         KVM_PGTABLE_WALK_SHARED);</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160; </div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="comment">/* Mark the page dirty only if the fault is handled successfully */</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="keywordflow">if</span> (writable &amp;&amp; !ret) {</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        <a class="code" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873">kvm_set_pfn_dirty</a>(pfn);</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        <a class="code" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15">mark_page_dirty_in_slot</a>(kvm, memslot, gfn);</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    }</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160; </div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;out_unlock:</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    read_unlock(&amp;kvm-&gt;mmu_lock);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <a class="code" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2">kvm_release_pfn_clean</a>(pfn);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <span class="keywordflow">return</span> ret != -EAGAIN ? ret : 0;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_a3617d51882e6aba0abae53c0bf922873"><div class="ttname"><a href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873">kvm_set_pfn_dirty</a></div><div class="ttdeci">void kvm_set_pfn_dirty(kvm_pfn_t pfn)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03285">kvm_main.c:3285</a></div></div>
<div class="ttc" id="akvm__main_8c_html_a63ec3e18db03a212e6e84391b5025689"><div class="ttname"><a href="kvm__main_8c.html#a63ec3e18db03a212e6e84391b5025689">__gfn_to_pfn_memslot</a></div><div class="ttdeci">kvm_pfn_t __gfn_to_pfn_memslot(const struct kvm_memory_slot *slot, gfn_t gfn, bool atomic, bool interruptible, bool *async, bool write_fault, bool *writable, hva_t *hva)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03031">kvm_main.c:3031</a></div></div>
<div class="ttc" id="akvm__main_8c_html_ae4806d9a69b751639c175cb98e468f15"><div class="ttname"><a href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15">mark_page_dirty_in_slot</a></div><div class="ttdeci">void mark_page_dirty_in_slot(struct kvm *kvm, const struct kvm_memory_slot *memslot, gfn_t gfn)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03635">kvm_main.c:3635</a></div></div>
<div class="ttc" id="akvm__main_8c_html_af83e69473e2fe5bf6e452f3fc1f414d2"><div class="ttname"><a href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2">kvm_release_pfn_clean</a></div><div class="ttdeci">void kvm_release_pfn_clean(kvm_pfn_t pfn)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03241">kvm_main.c:3241</a></div></div>
<div class="ttc" id="ammu_8c_html_a207285372ad7944209b485ecfc10ee0f"><div class="ttname"><a href="mmu_8c.html#a207285372ad7944209b485ecfc10ee0f">kvm_is_device_pfn</a></div><div class="ttdeci">static bool kvm_is_device_pfn(unsigned long pfn)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00183">mmu.c:183</a></div></div>
<div class="ttc" id="ammu_8c_html_a2478e510130e93368b79931c58135c1b"><div class="ttname"><a href="mmu_8c.html#a2478e510130e93368b79931c58135c1b">get_vma_page_shift</a></div><div class="ttdeci">static int get_vma_page_shift(struct vm_area_struct *vma, unsigned long hva)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01315">mmu.c:1315</a></div></div>
<div class="ttc" id="ammu_8c_html_a44914d574274fbd2a9a2afb90649f15c"><div class="ttname"><a href="mmu_8c.html#a44914d574274fbd2a9a2afb90649f15c">sanitise_mte_tags</a></div><div class="ttdeci">static void sanitise_mte_tags(struct kvm *kvm, kvm_pfn_t pfn, unsigned long size)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01355">mmu.c:1355</a></div></div>
<div class="ttc" id="ammu_8c_html_a6a713dc5a6d09de79232b38705dd1896"><div class="ttname"><a href="mmu_8c.html#a6a713dc5a6d09de79232b38705dd1896">transparent_hugepage_adjust</a></div><div class="ttdeci">static long transparent_hugepage_adjust(struct kvm *kvm, struct kvm_memory_slot *memslot, unsigned long hva, kvm_pfn_t *pfnp, phys_addr_t *ipap)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01284">mmu.c:1284</a></div></div>
<div class="ttc" id="ammu_8c_html_ab06707336ef5d30b56abbfd801d2f756"><div class="ttname"><a href="mmu_8c.html#ab06707336ef5d30b56abbfd801d2f756">kvm_send_hwpoison_signal</a></div><div class="ttdeci">static void kvm_send_hwpoison_signal(unsigned long address, short lsb)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01209">mmu.c:1209</a></div></div>
<div class="ttc" id="ammu_8c_html_ae621c40a28e874f5d7bdb502c2dec724"><div class="ttname"><a href="mmu_8c.html#ae621c40a28e874f5d7bdb502c2dec724">memslot_is_logging</a></div><div class="ttdeci">static bool memslot_is_logging(struct kvm_memory_slot *memslot)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00158">mmu.c:158</a></div></div>
<div class="ttc" id="apgtable_8c_html_a0b075f0350506df70d46e1744f9eb54b"><div class="ttname"><a href="pgtable_8c.html#a0b075f0350506df70d46e1744f9eb54b">kvm_pgtable_stage2_relax_perms</a></div><div class="ttdeci">int kvm_pgtable_stage2_relax_perms(struct kvm_pgtable *pgt, u64 addr, enum kvm_pgtable_prot prot)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l01322">pgtable.c:1322</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a3fa1785b4cbf3b2668c883a3c79fdeeb_cgraph.png" border="0" usemap="#ammu_8c_a3fa1785b4cbf3b2668c883a3c79fdeeb_cgraph" alt=""/></div>
<map name="ammu_8c_a3fa1785b4cbf3b2668c883a3c79fdeeb_cgraph" id="ammu_8c_a3fa1785b4cbf3b2668c883a3c79fdeeb_cgraph">
<area shape="rect" title=" " alt="" coords="5,675,137,701"/>
<area shape="rect" href="kvm__main_8c.html#a63ec3e18db03a212e6e84391b5025689" title=" " alt="" coords="202,233,373,260"/>
<area shape="rect" href="mmu_8c.html#ab90d07a850ec184a5284c06e0873d82d" title=" " alt="" coords="447,462,614,503"/>
<area shape="rect" href="mmu_8c.html#a2478e510130e93368b79931c58135c1b" title=" " alt="" coords="211,704,364,731"/>
<area shape="rect" href="mmu_8c.html#a207285372ad7944209b485ecfc10ee0f" title=" " alt="" coords="214,755,361,781"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="190,587,385,613"/>
<area shape="rect" href="pgtable_8c.html#a0b075f0350506df70d46e1744f9eb54b" title=" " alt="" coords="208,638,367,679"/>
<area shape="rect" href="kvm__main_8c.html#af83e69473e2fe5bf6e452f3fc1f414d2" title=" " alt="" coords="199,360,375,387"/>
<area shape="rect" href="mmu_8c.html#ab06707336ef5d30b56abbfd801d2f756" title=" " alt="" coords="185,805,389,832"/>
<area shape="rect" href="kvm__main_8c.html#a3617d51882e6aba0abae53c0bf922873" title=" " alt="" coords="216,415,359,441"/>
<area shape="rect" href="mmu_8c.html#ad2c3caa2e6c80158e1818c521d188e45" title=" " alt="" coords="198,856,377,883"/>
<area shape="rect" href="kvm__main_8c.html#ae4806d9a69b751639c175cb98e468f15" title=" " alt="" coords="196,907,379,933"/>
<area shape="rect" href="mmu_8c.html#ae621c40a28e874f5d7bdb502c2dec724" title=" " alt="" coords="211,957,364,984"/>
<area shape="rect" href="mmu_8c.html#a44914d574274fbd2a9a2afb90649f15c" title=" " alt="" coords="217,1008,358,1035"/>
<area shape="rect" href="mmu_8c.html#a6a713dc5a6d09de79232b38705dd1896" title=" " alt="" coords="203,521,371,562"/>
<area shape="rect" href="kvm__main_8c.html#ab58025ccc253a102c64561fa61c2a514" title=" " alt="" coords="455,259,607,285"/>
<area shape="rect" href="kvm__main_8c.html#a77ec4b9140d69a05f3b4e7836cc03a96" title=" " alt="" coords="695,259,857,285"/>
<area shape="rect" href="kvm__main_8c.html#adfbe9f59cac426f2ff01ab4fcfd631a7" title=" " alt="" coords="483,132,578,159"/>
<area shape="rect" href="kvm__main_8c.html#a4a59cf5e8fcf022a130b66506ddbdc77" title=" " alt="" coords="675,5,877,32"/>
<area shape="rect" href="kvm__main_8c.html#a9d9d33bb03936e01cce8c52cb72a24ff" title=" " alt="" coords="713,56,839,83"/>
<area shape="rect" href="kvm__main_8c.html#a12a80251ed4dec412b9a26ff6d13081e" title=" " alt="" coords="693,107,859,133"/>
<area shape="rect" href="kvm__main_8c.html#a52726e260149cdcfe6c5b85b8e83abf6" title=" " alt="" coords="711,157,841,184"/>
<area shape="rect" href="kvm__main_8c.html#a362963e36fc694c87cd75cdba59b6f90" title=" " alt="" coords="722,208,830,235"/>
<area shape="rect" href="kvm__main_8c.html#a207e6d9e30c3b05564dfe7cef31934ff" title=" " alt="" coords="955,183,1087,209"/>
<area shape="rect" href="kvm__main_8c.html#a99f99281cc81d5cd69f5825ccb8793b4" title=" " alt="" coords="1163,247,1377,273"/>
<area shape="rect" href="kvm__main_8c.html#a6c7165822622ebbd29159771905bd317" title=" " alt="" coords="1425,247,1621,273"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="949,579,1094,605"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="455,680,607,707"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="453,629,609,656"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1194,579,1346,605"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1444,579,1603,605"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="690,629,862,656"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="672,680,880,707"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a6636768a2e5b23cf4191bc03cea18d09" title=" " alt="" coords="447,813,614,854"/>
<area shape="rect" href="pgtable_8c.html#a479db5e7d44bd0ef2092407a91bd04b3" title=" " alt="" coords="455,731,606,773"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="693,832,859,859"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="697,883,855,909"/>
<area shape="rect" href="pgtable_8c.html#ae8dfa2edb1072f647c283dd113a86ca0" title=" " alt="" coords="703,781,849,808"/>
<area shape="rect" href="kvm__main_8c.html#a6845d169e1c19786abe7719700b9f6b9" title=" " alt="" coords="437,360,624,387"/>
<area shape="rect" href="kvm__main_8c.html#a05228520c714138c61d76bfbc12c162c" title=" " alt="" coords="684,360,868,387"/>
<area shape="rect" href="kvm__main_8c.html#aefbc4e0cbda09938de01d0afb0c06d59" title=" " alt="" coords="928,385,1115,412"/>
<area shape="rect" href="kvm__main_8c.html#adb6ddc9dc8c5e447e04b1be97543f347" title=" " alt="" coords="453,411,608,437"/>
<area shape="rect" href="vgic-its_8c.html#ac1878b63f1f337e93cf186ebd4fffcc4" title=" " alt="" coords="445,930,617,971"/>
<area shape="rect" href="dirty__ring_8c.html#a81ebbf462440ed5392d6d3412a859ae7" title=" " alt="" coords="451,996,610,1023"/>
<area shape="rect" href="kvm__main_8c.html#ac5a3afd8e2d8d1139dc7711c4b9e07e3" title=" " alt="" coords="444,879,617,905"/>
<area shape="rect" href="dirty__ring_8c.html#ad6e626257c739b2ac3d397119a7cf798" title=" " alt="" coords="680,1047,872,1073"/>
<area shape="rect" href="dirty__ring_8c.html#a6fe5cd75b9bac6497e1ae7340f2a5f7b" title=" " alt="" coords="702,945,850,972"/>
<area shape="rect" href="dirty__ring_8c.html#a22c9a239acf3463a8599a21c0a756538" title=" " alt="" coords="687,996,865,1023"/>
<area shape="rect" href="mmu_8c.html#af8650c6f853eb15b4e2e872e8ddbbeb2" title=" " alt="" coords="443,528,618,555"/>
<area shape="rect" href="pgtable_8c.html#af20a43d8934ae3cdc599bfa308f93531" title=" " alt="" coords="693,528,859,555"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mmu_8c_a3fa1785b4cbf3b2668c883a3c79fdeeb_icgraph.png" border="0" usemap="#ammu_8c_a3fa1785b4cbf3b2668c883a3c79fdeeb_icgraph" alt=""/></div>
<map name="ammu_8c_a3fa1785b4cbf3b2668c883a3c79fdeeb_icgraph" id="ammu_8c_a3fa1785b4cbf3b2668c883a3c79fdeeb_icgraph">
<area shape="rect" title=" " alt="" coords="240,5,372,32"/>
<area shape="rect" href="mmu_8c.html#a2c7559bf16232daf5d3187255f1cb70e" title=" " alt="" coords="5,5,192,32"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="af6cad154e151b78389f796d53eab3e4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6cad154e151b78389f796d53eab3e4a">&#9670;&nbsp;</a></span>hyp_idmap_end</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long <a class="el" href="vgic_8c.html#a025fcc986fe35380110649829fd8b7ea">__ro_after_init</a> hyp_idmap_end</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00029">29</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
<a id="a2bc1b7b9ac3d075fa1fe50ad08a3a200"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bc1b7b9ac3d075fa1fe50ad08a3a200">&#9670;&nbsp;</a></span>hyp_idmap_start</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long <a class="el" href="vgic_8c.html#a025fcc986fe35380110649829fd8b7ea">__ro_after_init</a> hyp_idmap_start</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00028">28</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
<a id="a5d2511e33617fa741938a584dc513895"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d2511e33617fa741938a584dc513895">&#9670;&nbsp;</a></span>hyp_idmap_vector</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">phys_addr_t <a class="el" href="vgic_8c.html#a025fcc986fe35380110649829fd8b7ea">__ro_after_init</a> hyp_idmap_vector</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00030">30</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
<a id="a56796191d3fb3abd9372b422b9abd52b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56796191d3fb3abd9372b422b9abd52b">&#9670;&nbsp;</a></span>hyp_pgtable</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct kvm_pgtable* hyp_pgtable</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00025">25</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
<a id="a50c37f7656dc83a4d640ece2b0e36e7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50c37f7656dc83a4d640ece2b0e36e7b">&#9670;&nbsp;</a></span>hyp_shared_pfns</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct rb_root hyp_shared_pfns = RB_ROOT</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00436">436</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
<a id="a96b25c9a789e7df5d189d35f1ada4100"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96b25c9a789e7df5d189d35f1ada4100">&#9670;&nbsp;</a></span>io_map_base</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long <a class="el" href="vgic_8c.html#a025fcc986fe35380110649829fd8b7ea">__ro_after_init</a> io_map_base</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00032">32</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
<a id="a626ee9bc458a919c07c36ddd5af0fabe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a626ee9bc458a919c07c36ddd5af0fabe">&#9670;&nbsp;</a></span>kvm_hyp_mm_ops</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct kvm_pgtable_mm_ops kvm_hyp_mm_ops</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .zalloc_page        = <a class="code" href="mmu_8c.html#ab59f0fbc119723d99cf43ad72a22f70b">kvm_hyp_zalloc_page</a>,</div>
<div class="line">    .get_page       = <a class="code" href="mmu_8c.html#a6c597babff3bfa97bd093b9dd7484487">kvm_host_get_page</a>,</div>
<div class="line">    .put_page       = <a class="code" href="mmu_8c.html#af821b375f4c13aa4b873b5110fa3b503">kvm_host_put_page</a>,</div>
<div class="line">    .phys_to_virt       = <a class="code" href="mmu_8c.html#a2a7af09cc56dc8cd69de6c8d2acacd12">kvm_host_va</a>,</div>
<div class="line">    .virt_to_phys       = <a class="code" href="mmu_8c.html#a623efd55548e897162a46d8da0043070">kvm_host_pa</a>,</div>
<div class="line">}</div>
<div class="ttc" id="ammu_8c_html_a6c597babff3bfa97bd093b9dd7484487"><div class="ttname"><a href="mmu_8c.html#a6c597babff3bfa97bd093b9dd7484487">kvm_host_get_page</a></div><div class="ttdeci">static void kvm_host_get_page(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00239">mmu.c:239</a></div></div>
<div class="ttc" id="ammu_8c_html_ab59f0fbc119723d99cf43ad72a22f70b"><div class="ttname"><a href="mmu_8c.html#ab59f0fbc119723d99cf43ad72a22f70b">kvm_hyp_zalloc_page</a></div><div class="ttdeci">static void * kvm_hyp_zalloc_page(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l01845">mmu.c:1845</a></div></div>
<div class="ttc" id="ammu_8c_html_af821b375f4c13aa4b873b5110fa3b503"><div class="ttname"><a href="mmu_8c.html#af821b375f4c13aa4b873b5110fa3b503">kvm_host_put_page</a></div><div class="ttdeci">static void kvm_host_put_page(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00244">mmu.c:244</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l01845">1845</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
<a id="a76e73dbe0eaa8e135824fd27a72cac9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76e73dbe0eaa8e135824fd27a72cac9d">&#9670;&nbsp;</a></span>kvm_s2_mm_ops</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct kvm_pgtable_mm_ops kvm_s2_mm_ops</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .zalloc_page        = <a class="code" href="mmu_8c.html#a007ad372dce7c2fa90ca652d5ef7ac01">stage2_memcache_zalloc_page</a>,</div>
<div class="line">    .zalloc_pages_exact = <a class="code" href="mmu_8c.html#aaaa2b0d256c20dcfcfae2767ce907846">kvm_s2_zalloc_pages_exact</a>,</div>
<div class="line">    .free_pages_exact   = <a class="code" href="mmu_8c.html#ad02e9dab83b5eeee68e5e9f558344be7">kvm_s2_free_pages_exact</a>,</div>
<div class="line">    .free_unlinked_table    = <a class="code" href="mmu_8c.html#ae9ef59f6c6f5db240f93b35fb779255b">stage2_free_unlinked_table</a>,</div>
<div class="line">    .get_page       = <a class="code" href="mmu_8c.html#a6c597babff3bfa97bd093b9dd7484487">kvm_host_get_page</a>,</div>
<div class="line">    .put_page       = <a class="code" href="mmu_8c.html#aca0a36b009f5655a358bc4943d843cf1">kvm_s2_put_page</a>,</div>
<div class="line">    .page_count     = <a class="code" href="mmu_8c.html#a20ef7c89f7bdbdb317ac7ec7174fff5f">kvm_host_page_count</a>,</div>
<div class="line">    .phys_to_virt       = <a class="code" href="mmu_8c.html#a2a7af09cc56dc8cd69de6c8d2acacd12">kvm_host_va</a>,</div>
<div class="line">    .virt_to_phys       = <a class="code" href="mmu_8c.html#a623efd55548e897162a46d8da0043070">kvm_host_pa</a>,</div>
<div class="line">    .dcache_clean_inval_poc = <a class="code" href="mmu_8c.html#a7b75c96fdca4f9e2423274d19539732e">clean_dcache_guest_page</a>,</div>
<div class="line">    .icache_inval_pou   = <a class="code" href="mmu_8c.html#aaec0113601639e091ef92762b6dd8651">invalidate_icache_guest_page</a>,</div>
<div class="line">}</div>
<div class="ttc" id="ammu_8c_html_a007ad372dce7c2fa90ca652d5ef7ac01"><div class="ttname"><a href="mmu_8c.html#a007ad372dce7c2fa90ca652d5ef7ac01">stage2_memcache_zalloc_page</a></div><div class="ttdeci">static void * stage2_memcache_zalloc_page(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00188">mmu.c:188</a></div></div>
<div class="ttc" id="ammu_8c_html_a20ef7c89f7bdbdb317ac7ec7174fff5f"><div class="ttname"><a href="mmu_8c.html#a20ef7c89f7bdbdb317ac7ec7174fff5f">kvm_host_page_count</a></div><div class="ttdeci">static int kvm_host_page_count(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00258">mmu.c:258</a></div></div>
<div class="ttc" id="ammu_8c_html_a7b75c96fdca4f9e2423274d19539732e"><div class="ttname"><a href="mmu_8c.html#a7b75c96fdca4f9e2423274d19539732e">clean_dcache_guest_page</a></div><div class="ttdeci">static void clean_dcache_guest_page(void *va, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00273">mmu.c:273</a></div></div>
<div class="ttc" id="ammu_8c_html_aaaa2b0d256c20dcfcfae2767ce907846"><div class="ttname"><a href="mmu_8c.html#aaaa2b0d256c20dcfcfae2767ce907846">kvm_s2_zalloc_pages_exact</a></div><div class="ttdeci">static void * kvm_s2_zalloc_pages_exact(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00205">mmu.c:205</a></div></div>
<div class="ttc" id="ammu_8c_html_aaec0113601639e091ef92762b6dd8651"><div class="ttname"><a href="mmu_8c.html#aaec0113601639e091ef92762b6dd8651">invalidate_icache_guest_page</a></div><div class="ttdeci">static void invalidate_icache_guest_page(void *va, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00278">mmu.c:278</a></div></div>
<div class="ttc" id="ammu_8c_html_aca0a36b009f5655a358bc4943d843cf1"><div class="ttname"><a href="mmu_8c.html#aca0a36b009f5655a358bc4943d843cf1">kvm_s2_put_page</a></div><div class="ttdeci">static void kvm_s2_put_page(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00249">mmu.c:249</a></div></div>
<div class="ttc" id="ammu_8c_html_ad02e9dab83b5eeee68e5e9f558344be7"><div class="ttname"><a href="mmu_8c.html#ad02e9dab83b5eeee68e5e9f558344be7">kvm_s2_free_pages_exact</a></div><div class="ttdeci">static void kvm_s2_free_pages_exact(void *virt, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00214">mmu.c:214</a></div></div>
<div class="ttc" id="ammu_8c_html_ae9ef59f6c6f5db240f93b35fb779255b"><div class="ttname"><a href="mmu_8c.html#ae9ef59f6c6f5db240f93b35fb779255b">stage2_free_unlinked_table</a></div><div class="ttdeci">static void stage2_free_unlinked_table(void *addr, s8 level)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00231">mmu.c:231</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00214">214</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
<a id="af2893a9b1718938c86a28dc9ff1c199f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2893a9b1718938c86a28dc9ff1c199f">&#9670;&nbsp;</a></span>kvm_user_mm_ops</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct kvm_pgtable_mm_ops kvm_user_mm_ops</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    </div>
<div class="line">    .phys_to_virt       = <a class="code" href="mmu_8c.html#a2a7af09cc56dc8cd69de6c8d2acacd12">kvm_host_va</a>,</div>
<div class="line">}</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="mmu_8c_source.html#l00778">778</a> of file <a class="el" href="mmu_8c_source.html">mmu.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
