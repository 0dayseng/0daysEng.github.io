<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/arm64/kvm/fpsimd.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_67a9e021ce8db5d46236c6154ee454bc.html">arm64</a></li><li class="navelem"><a class="el" href="dir_42f87ef63ac4150166bf7887f68288e2.html">kvm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">fpsimd.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/irqflags.h&gt;</code><br />
<code>#include &lt;linux/sched.h&gt;</code><br />
<code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &lt;asm/fpsimd.h&gt;</code><br />
<code>#include &lt;asm/kvm_asm.h&gt;</code><br />
<code>#include &lt;asm/kvm_hyp.h&gt;</code><br />
<code>#include &lt;asm/kvm_mmu.h&gt;</code><br />
<code>#include &lt;asm/sysreg.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for fpsimd.c:</div>
<div class="dyncontent">
<div class="center"><img src="fpsimd_8c__incl.png" border="0" usemap="#aarch_2arm64_2kvm_2fpsimd_8c" alt=""/></div>
<map name="aarch_2arm64_2kvm_2fpsimd_8c" id="aarch_2arm64_2kvm_2fpsimd_8c">
<area shape="rect" title=" " alt="" coords="471,5,661,32"/>
<area shape="rect" title=" " alt="" coords="5,80,124,107"/>
<area shape="rect" title=" " alt="" coords="148,80,256,107"/>
<area shape="rect" title=" " alt="" coords="280,80,415,107"/>
<area shape="rect" title=" " alt="" coords="439,80,549,107"/>
<area shape="rect" title=" " alt="" coords="574,80,705,107"/>
<area shape="rect" title=" " alt="" coords="729,80,856,107"/>
<area shape="rect" title=" " alt="" coords="881,80,1017,107"/>
<area shape="rect" title=" " alt="" coords="1041,80,1150,107"/>
</map>
</div>
</div>
<p><a href="fpsimd_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4a413d27f1db48bf29f9bdb738ab0b94"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fpsimd_8c.html#a4a413d27f1db48bf29f9bdb738ab0b94">kvm_vcpu_unshare_task_fp</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a4a413d27f1db48bf29f9bdb738ab0b94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98014dcb0f6b0f9abc0cfc671b8b733c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c">kvm_arch_vcpu_run_map_fp</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a98014dcb0f6b0f9abc0cfc671b8b733c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d3b97095b4e6a0d7799fe50eb3fb762"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fpsimd_8c.html#a6d3b97095b4e6a0d7799fe50eb3fb762">kvm_arch_vcpu_load_fp</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a6d3b97095b4e6a0d7799fe50eb3fb762"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3e65e2c77e0312c9e387e95e1aa19df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fpsimd_8c.html#ac3e65e2c77e0312c9e387e95e1aa19df">kvm_arch_vcpu_ctxflush_fp</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ac3e65e2c77e0312c9e387e95e1aa19df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e9e5ec5e9dd551b9654ee063cab858e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fpsimd_8c.html#a1e9e5ec5e9dd551b9654ee063cab858e">kvm_arch_vcpu_ctxsync_fp</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a1e9e5ec5e9dd551b9654ee063cab858e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a315297a309db16c8cbbe1ab46c7413ba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fpsimd_8c.html#a315297a309db16c8cbbe1ab46c7413ba">kvm_arch_vcpu_put_fp</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a315297a309db16c8cbbe1ab46c7413ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac3e65e2c77e0312c9e387e95e1aa19df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3e65e2c77e0312c9e387e95e1aa19df">&#9670;&nbsp;</a></span>kvm_arch_vcpu_ctxflush_fp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_vcpu_ctxflush_fp </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fpsimd_8c_source.html#l00126">126</a> of file <a class="el" href="fpsimd_8c_source.html">fpsimd.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">if</span> (test_thread_flag(TIF_FOREIGN_FPSTATE))</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        vcpu-&gt;arch.fp_state = FP_STATE_FREE;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="fpsimd_8c_ac3e65e2c77e0312c9e387e95e1aa19df_icgraph.png" border="0" usemap="#afpsimd_8c_ac3e65e2c77e0312c9e387e95e1aa19df_icgraph" alt=""/></div>
<map name="afpsimd_8c_ac3e65e2c77e0312c9e387e95e1aa19df_icgraph" id="afpsimd_8c_ac3e65e2c77e0312c9e387e95e1aa19df_icgraph">
<area shape="rect" title=" " alt="" coords="412,5,615,32"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,5,364,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a1e9e5ec5e9dd551b9654ee063cab858e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e9e5ec5e9dd551b9654ee063cab858e">&#9670;&nbsp;</a></span>kvm_arch_vcpu_ctxsync_fp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_vcpu_ctxsync_fp </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fpsimd_8c_source.html#l00139">139</a> of file <a class="el" href="fpsimd_8c_source.html">fpsimd.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;{</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keyword">struct </span>cpu_fp_state fp_state;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    WARN_ON_ONCE(!irqs_disabled());</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span> (vcpu-&gt;arch.fp_state == FP_STATE_GUEST_OWNED) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">         * Currently we do not support SME guests so SVCR is</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">         * always 0 and we just need a variable to point to.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        fp_state.st = &amp;vcpu-&gt;arch.ctxt.fp_regs;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        fp_state.sve_state = vcpu-&gt;arch.sve_state;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        fp_state.sve_vl = vcpu-&gt;arch.sve_max_vl;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        fp_state.sme_state = NULL;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        fp_state.svcr = &amp;vcpu-&gt;arch.svcr;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        fp_state.fp_type = &amp;vcpu-&gt;arch.fp_type;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">if</span> (vcpu_has_sve(vcpu))</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            fp_state.to_save = FP_STATE_SVE;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            fp_state.to_save = FP_STATE_FPSIMD;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        fpsimd_bind_state_to_cpu(&amp;fp_state);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        clear_thread_flag(TIF_FOREIGN_FPSTATE);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="fpsimd_8c_a1e9e5ec5e9dd551b9654ee063cab858e_icgraph.png" border="0" usemap="#afpsimd_8c_a1e9e5ec5e9dd551b9654ee063cab858e_icgraph" alt=""/></div>
<map name="afpsimd_8c_a1e9e5ec5e9dd551b9654ee063cab858e_icgraph" id="afpsimd_8c_a1e9e5ec5e9dd551b9654ee063cab858e_icgraph">
<area shape="rect" title=" " alt="" coords="412,5,613,32"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,5,364,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a6d3b97095b4e6a0d7799fe50eb3fb762"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d3b97095b4e6a0d7799fe50eb3fb762">&#9670;&nbsp;</a></span>kvm_arch_vcpu_load_fp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_vcpu_load_fp </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fpsimd_8c_source.html#l00075">75</a> of file <a class="el" href="fpsimd_8c_source.html">fpsimd.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;{</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    BUG_ON(!current-&gt;mm);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">if</span> (!system_supports_fpsimd())</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    fpsimd_kvm_prepare();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">     * We will check TIF_FOREIGN_FPSTATE just before entering the</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">     * guest in kvm_arch_vcpu_ctxflush_fp() and override this to</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">     * FP_STATE_FREE if the flag set.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    vcpu-&gt;arch.fp_state = FP_STATE_HOST_OWNED;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    vcpu_clear_flag(vcpu, HOST_SVE_ENABLED);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (read_sysreg(cpacr_el1) &amp; CPACR_EL1_ZEN_EL0EN)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        vcpu_set_flag(vcpu, HOST_SVE_ENABLED);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> (system_supports_sme()) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        vcpu_clear_flag(vcpu, HOST_SME_ENABLED);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordflow">if</span> (read_sysreg(cpacr_el1) &amp; CPACR_EL1_SMEN_EL0EN)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            vcpu_set_flag(vcpu, HOST_SME_ENABLED);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">         * If PSTATE.SM is enabled then save any pending FP</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">         * state and disable PSTATE.SM. If we leave PSTATE.SM</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">         * enabled and the guest does not enable SME via</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">         * CPACR_EL1.SMEN then operations that should be valid</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">         * may generate SME traps from EL1 to EL1 which we</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">         * can&#39;t intercept and which would confuse the guest.</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">         * Do the same for PSTATE.ZA in the case where there</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">         * is state in the registers which has not already</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">         * been saved, this is very unlikely to happen.</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">if</span> (read_sysreg_s(SYS_SVCR) &amp; (SVCR_SM_MASK | SVCR_ZA_MASK)) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            vcpu-&gt;arch.fp_state = FP_STATE_FREE;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            fpsimd_save_and_flush_cpu_state();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="fpsimd_8c_a6d3b97095b4e6a0d7799fe50eb3fb762_icgraph.png" border="0" usemap="#afpsimd_8c_a6d3b97095b4e6a0d7799fe50eb3fb762_icgraph" alt=""/></div>
<map name="afpsimd_8c_a6d3b97095b4e6a0d7799fe50eb3fb762_icgraph" id="afpsimd_8c_a6d3b97095b4e6a0d7799fe50eb3fb762_icgraph">
<area shape="rect" title=" " alt="" coords="1469,237,1648,264"/>
<area shape="rect" href="arm_8c.html#aaa51abf3d06fdaa95794b27f273278fb" title=" " alt="" coords="1263,237,1421,264"/>
<area shape="rect" href="emulate-nested_8c.html#a1920c02a997dd9975bec0ee02f6ae2c4" title=" " alt="" coords="825,31,1021,57"/>
<area shape="rect" href="emulate-nested_8c.html#a1c3e31bd85e9c0590a018ada20a5e4bf" title=" " alt="" coords="1069,136,1215,163"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1077,237,1207,264"/>
<area shape="rect" href="kvm__main_8c.html#a31b6c41ce8eacbbdc56a276018989253" title=" " alt="" coords="1085,376,1199,403"/>
<area shape="rect" href="kvm__main_8c.html#a5dde35c5b74ce68a7dbb2f2006ce3e9e" title=" " alt="" coords="1098,300,1186,327"/>
<area shape="rect" href="handle__exit_8c.html#ae96aab7918301d55b908034db5855e3d" title=" " alt="" coords="617,5,751,32"/>
<area shape="rect" href="emulate-nested_8c.html#af5e2eb745d8ac6415fe941ebe754171d" title=" " alt="" coords="832,107,1015,133"/>
<area shape="rect" href="emulate-nested_8c.html#a5759b383dbf067b5e90235d5fd032ab5" title=" " alt="" coords="597,157,771,184"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="636,56,732,83"/>
<area shape="rect" href="handle__exit_8c.html#aeaf983f5c40202edc8b07a76603330cd" title=" " alt="" coords="637,107,731,133"/>
<area shape="rect" href="sys__regs_8c.html#a315e661b6f1cb224596267000909a1ac" title=" " alt="" coords="384,145,543,172"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="835,161,1011,188"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="603,208,765,235"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,263,336,289"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="843,313,1004,340"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="384,197,543,238"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,288,129,315"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="591,313,777,340"/>
<area shape="rect" href="kvm__main_8c.html#a2372c616bc55bc4cd3446660cb7322fc" title=" " alt="" coords="884,415,963,441"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="628,415,740,441"/>
</map>
</div>

</div>
</div>
<a id="a315297a309db16c8cbbe1ab46c7413ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a315297a309db16c8cbbe1ab46c7413ba">&#9670;&nbsp;</a></span>kvm_arch_vcpu_put_fp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_arch_vcpu_put_fp </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fpsimd_8c_source.html#l00175">175</a> of file <a class="el" href="fpsimd_8c_source.html">fpsimd.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;{</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    local_irq_save(flags);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">     * If we have VHE then the Hyp code will reset CPACR_EL1 to</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">     * the default value and we need to reenable SME.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (has_vhe() &amp;&amp; system_supports_sme()) {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">/* Also restore EL0 state seen on entry */</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">if</span> (vcpu_get_flag(vcpu, HOST_SME_ENABLED))</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            sysreg_clear_set(CPACR_EL1, 0,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                     CPACR_EL1_SMEN_EL0EN |</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                     CPACR_EL1_SMEN_EL1EN);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            sysreg_clear_set(CPACR_EL1,</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                     CPACR_EL1_SMEN_EL0EN,</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                     CPACR_EL1_SMEN_EL1EN);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        isb();</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (vcpu-&gt;arch.fp_state == FP_STATE_GUEST_OWNED) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span> (vcpu_has_sve(vcpu)) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            __vcpu_sys_reg(vcpu, ZCR_EL1) = read_sysreg_el1(SYS_ZCR);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="comment">/* Restore the VL that was saved when bound to the CPU */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keywordflow">if</span> (!has_vhe())</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                sve_cond_update_zcr_vq(vcpu_sve_max_vq(vcpu) - 1,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                               SYS_ZCR_EL1);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        fpsimd_save_and_flush_cpu_state();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (has_vhe() &amp;&amp; system_supports_sve()) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">         * The FPSIMD/SVE state in the CPU has not been touched, and we</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">         * have SVE (and VHE): CPACR_EL1 (alias CPTR_EL2) has been</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">         * reset by kvm_reset_cptr_el2() in the Hyp code, disabling SVE</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">         * for EL0.  To avoid spurious traps, restore the trap state</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">         * seen by kvm_arch_vcpu_load_fp():</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">if</span> (vcpu_get_flag(vcpu, HOST_SVE_ENABLED))</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            sysreg_clear_set(CPACR_EL1, 0, CPACR_EL1_ZEN_EL0EN);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            sysreg_clear_set(CPACR_EL1, CPACR_EL1_ZEN_EL0EN, 0);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    local_irq_restore(flags);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="fpsimd_8c_a315297a309db16c8cbbe1ab46c7413ba_icgraph.png" border="0" usemap="#afpsimd_8c_a315297a309db16c8cbbe1ab46c7413ba_icgraph" alt=""/></div>
<map name="afpsimd_8c_a315297a309db16c8cbbe1ab46c7413ba_icgraph" id="afpsimd_8c_a315297a309db16c8cbbe1ab46c7413ba_icgraph">
<area shape="rect" title=" " alt="" coords="1463,237,1635,264"/>
<area shape="rect" href="arm_8c.html#a9235365ce64f215b1e024f26d96537cc" title=" " alt="" coords="1263,237,1415,264"/>
<area shape="rect" href="emulate-nested_8c.html#a1920c02a997dd9975bec0ee02f6ae2c4" title=" " alt="" coords="825,31,1021,57"/>
<area shape="rect" href="emulate-nested_8c.html#a1c3e31bd85e9c0590a018ada20a5e4bf" title=" " alt="" coords="1069,136,1215,163"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1077,237,1207,264"/>
<area shape="rect" href="kvm__main_8c.html#a5f5097640155787fc088aa47b94da0a7" title=" " alt="" coords="1080,376,1204,403"/>
<area shape="rect" href="kvm__main_8c.html#a16e0f63dd5f0d556ed1c9c9999256f85" title=" " alt="" coords="1101,300,1183,327"/>
<area shape="rect" href="handle__exit_8c.html#ae96aab7918301d55b908034db5855e3d" title=" " alt="" coords="617,5,751,32"/>
<area shape="rect" href="emulate-nested_8c.html#af5e2eb745d8ac6415fe941ebe754171d" title=" " alt="" coords="832,107,1015,133"/>
<area shape="rect" href="emulate-nested_8c.html#a5759b383dbf067b5e90235d5fd032ab5" title=" " alt="" coords="597,157,771,184"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="636,56,732,83"/>
<area shape="rect" href="handle__exit_8c.html#aeaf983f5c40202edc8b07a76603330cd" title=" " alt="" coords="637,107,731,133"/>
<area shape="rect" href="sys__regs_8c.html#a315e661b6f1cb224596267000909a1ac" title=" " alt="" coords="384,145,543,172"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="835,161,1011,188"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="603,208,765,235"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,263,336,289"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="843,313,1004,340"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="384,197,543,238"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,288,129,315"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="591,313,777,340"/>
<area shape="rect" href="kvm__main_8c.html#a2372c616bc55bc4cd3446660cb7322fc" title=" " alt="" coords="884,415,963,441"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="628,415,740,441"/>
</map>
</div>

</div>
</div>
<a id="a98014dcb0f6b0f9abc0cfc671b8b733c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98014dcb0f6b0f9abc0cfc671b8b733c">&#9670;&nbsp;</a></span>kvm_arch_vcpu_run_map_fp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_arch_vcpu_run_map_fp </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fpsimd_8c_source.html#l00039">39</a> of file <a class="el" href="fpsimd_8c_source.html">fpsimd.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;{</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keyword">struct </span>user_fpsimd_state *fpsimd = &amp;current-&gt;thread.uw.fpsimd_state;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="fpsimd_8c.html#a4a413d27f1db48bf29f9bdb738ab0b94">kvm_vcpu_unshare_task_fp</a>(vcpu);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">/* Make sure the host task fpsimd state is visible to hyp: */</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    ret = <a class="code" href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d">kvm_share_hyp</a>(fpsimd, fpsimd + 1);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    vcpu-&gt;arch.host_fpsimd_state = kern_hyp_va(fpsimd);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">     * We need to keep current&#39;s task_struct pinned until its data has been</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">     * unshared with the hypervisor to make sure it is not re-used by the</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">     * kernel and donated to someone else while already shared -- see</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">     * kvm_vcpu_unshare_task_fp() for the matching put_task_struct().</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span> (is_protected_kvm_enabled()) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        get_task_struct(current);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        vcpu-&gt;arch.parent_task = current;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;}</div>
<div class="ttc" id="afpsimd_8c_html_a4a413d27f1db48bf29f9bdb738ab0b94"><div class="ttname"><a href="fpsimd_8c.html#a4a413d27f1db48bf29f9bdb738ab0b94">kvm_vcpu_unshare_task_fp</a></div><div class="ttdeci">void kvm_vcpu_unshare_task_fp(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="fpsimd_8c_source.html#l00017">fpsimd.c:17</a></div></div>
<div class="ttc" id="ammu_8c_html_a1b7a508d0431deb996e839b226bcda0d"><div class="ttname"><a href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d">kvm_share_hyp</a></div><div class="ttdeci">int kvm_share_hyp(void *from, void *to)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00516">mmu.c:516</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="fpsimd_8c_a98014dcb0f6b0f9abc0cfc671b8b733c_cgraph.png" border="0" usemap="#afpsimd_8c_a98014dcb0f6b0f9abc0cfc671b8b733c_cgraph" alt=""/></div>
<map name="afpsimd_8c_a98014dcb0f6b0f9abc0cfc671b8b733c_cgraph" id="afpsimd_8c_a98014dcb0f6b0f9abc0cfc671b8b733c_cgraph">
<area shape="rect" title=" " alt="" coords="5,248,213,275"/>
<area shape="rect" href="mmu_8c.html#a1b7a508d0431deb996e839b226bcda0d" title=" " alt="" coords="520,223,645,249"/>
<area shape="rect" href="fpsimd_8c.html#a4a413d27f1db48bf29f9bdb738ab0b94" title=" " alt="" coords="261,273,464,300"/>
<area shape="rect" href="mmu_8c.html#a2fae287f6a52db1bbfdcb7483ba623ca" title=" " alt="" coords="701,147,867,173"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="1161,169,1391,196"/>
<area shape="rect" href="mmu_8c.html#aa7729a167573cc14881088e0516f28d5" title=" " alt="" coords="725,324,843,351"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="925,71,1103,97"/>
<area shape="rect" href="mmu_8c.html#a5ba832c8135d5fbf5fed763356c0a2b7" title=" " alt="" coords="938,172,1090,199"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="2075,100,2249,127"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="2304,49,2436,76"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="2302,100,2438,127"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="2297,151,2443,177"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="2491,56,2680,83"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="2512,5,2659,32"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="2728,12,2957,39"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="2753,63,2932,89"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="2509,151,2661,177"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="2763,125,2922,152"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="2769,176,2917,203"/>
<area shape="rect" href="mem__protect_8h.html#a5386cf2bf4917b7abcc5fb60845688d9" title=" " alt="" coords="923,324,1105,351"/>
<area shape="rect" href="mmu_8c.html#ae872b392080198975a339e2351ec3abf" title=" " alt="" coords="951,375,1077,401"/>
<area shape="rect" href="mem__protect_8c.html#a6bfbb53a58e0b5b5533cfc11957f42c2" title=" " alt="" coords="1235,271,1317,297"/>
<area shape="rect" href="mem__protect_8c.html#aa70b12df63f9379efa7fe11ade510b7c" title=" " alt="" coords="1194,321,1358,348"/>
<area shape="rect" href="mem__protect_8c.html#a21f32ced99ed31332ac532029100e42d" title=" " alt="" coords="1186,473,1366,500"/>
<area shape="rect" href="mem__protect_8c.html#abbc50e372d72deb41a021219c35e3589" title=" " alt="" coords="1196,372,1356,399"/>
<area shape="rect" href="mem__protect_8c.html#a024de911d90c8e8d57cc96c87fecb4d3" title=" " alt="" coords="1188,423,1364,449"/>
<area shape="rect" href="mem__protect_8c.html#a813121259f4344cbf372cbf3d7f50588" title=" " alt="" coords="1457,199,1551,225"/>
<area shape="rect" href="mem__protect_8c.html#aaa8cef3120e457500b49a5de34545c24" title=" " alt="" coords="1453,336,1555,363"/>
<area shape="rect" href="mem__protect_8c.html#a6fc6b31d003170e866222dffa08ae092" title=" " alt="" coords="1631,199,1777,225"/>
<area shape="rect" href="mem__protect_8c.html#a635909c724738612986586327fa71a0b" title=" " alt="" coords="1625,148,1783,175"/>
<area shape="rect" href="mem__protect_8c.html#a2b41e87ab661559f9f860797a14c914e" title=" " alt="" coords="1847,239,2018,281"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="2102,217,2222,244"/>
<area shape="rect" href="mm_8h.html#a36a82f8cc52bf1bf431f904beddc6c18" title=" " alt="" coords="1843,122,2022,163"/>
<area shape="rect" href="mem__protect_8c.html#a5d4226b7d58b6d55f4d6d7195914f4c2" title=" " alt="" coords="1626,458,1782,499"/>
<area shape="rect" href="mem__protect_8c.html#a54456b5931c9badb4e3272081518a9c9" title=" " alt="" coords="1645,351,1763,377"/>
<area shape="rect" href="mem__protect_8c.html#ab45dbaed102ffbf3ccda18c0cc20a6dc" title=" " alt="" coords="1839,489,2027,530"/>
<area shape="rect" href="mem__protect_8c.html#a89057e6dfc7b241de73b439208bcf7d5" title=" " alt="" coords="1843,405,2023,446"/>
<area shape="rect" href="mem__protect_8c.html#a4ee4815f49f2d2a8397d1e2430193a3e" title=" " alt="" coords="1841,339,2025,381"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="1447,387,1561,413"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="1439,463,1569,489"/>
<area shape="rect" href="mmu_8c.html#abeed34d3f32ae7e76a83700117b7b92a" title=" " alt="" coords="512,273,653,300"/>
<area shape="rect" href="mmu_8c.html#ab784fb7eb70984bb7728e616c60ec1e2" title=" " alt="" coords="717,375,851,401"/>
<area shape="rect" href="mem__protect_8h.html#a259c9aa4671e27b82908850ced15f83d" title=" " alt="" coords="915,425,1113,452"/>
<area shape="rect" href="mem__protect_8c.html#ab6a32e622ae646989f8a020ce5f60ca4" title=" " alt="" coords="1227,524,1325,551"/>
<area shape="rect" href="mem__protect_8c.html#a77ec896d00d3c2ebd6669edf6bc94847" title=" " alt="" coords="1449,285,1559,312"/>
<area shape="rect" href="mem__protect_8c.html#aa930dbd95452ee88a3f91456675dca49" title=" " alt="" coords="1445,524,1563,551"/>
<area shape="rect" href="mem__protect_8c.html#aad9e9a7b5fa0635f39dc96649d2eed00" title=" " alt="" coords="1623,249,1785,276"/>
<area shape="rect" href="mem__protect_8c.html#ad0fe4a77ba9585f7ad46c3d212e7559d" title=" " alt="" coords="1617,300,1791,327"/>
<area shape="rect" href="mem__protect_8c.html#adb6b6680efb04e5e509ccf68629283f8" title=" " alt="" coords="1621,524,1787,551"/>
<area shape="rect" href="mem__protect_8c.html#a29a8e46b3a5a7fdce3bf761585537d2d" title=" " alt="" coords="1637,407,1771,433"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="fpsimd_8c_a98014dcb0f6b0f9abc0cfc671b8b733c_icgraph.png" border="0" usemap="#afpsimd_8c_a98014dcb0f6b0f9abc0cfc671b8b733c_icgraph" alt=""/></div>
<map name="afpsimd_8c_a98014dcb0f6b0f9abc0cfc671b8b733c_icgraph" id="afpsimd_8c_a98014dcb0f6b0f9abc0cfc671b8b733c_icgraph">
<area shape="rect" title=" " alt="" coords="404,13,612,39"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="177,5,356,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a4a413d27f1db48bf29f9bdb738ab0b94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a413d27f1db48bf29f9bdb738ab0b94">&#9670;&nbsp;</a></span>kvm_vcpu_unshare_task_fp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_vcpu_unshare_task_fp </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fpsimd_8c_source.html#l00017">17</a> of file <a class="el" href="fpsimd_8c_source.html">fpsimd.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;{</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="keyword">struct </span>task_struct *p = vcpu-&gt;arch.parent_task;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keyword">struct </span>user_fpsimd_state *fpsimd;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordflow">if</span> (!is_protected_kvm_enabled() || !p)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    fpsimd = &amp;p-&gt;thread.uw.fpsimd_state;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="mmu_8c.html#abeed34d3f32ae7e76a83700117b7b92a">kvm_unshare_hyp</a>(fpsimd, fpsimd + 1);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    put_task_struct(p);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;}</div>
<div class="ttc" id="ammu_8c_html_abeed34d3f32ae7e76a83700117b7b92a"><div class="ttname"><a href="mmu_8c.html#abeed34d3f32ae7e76a83700117b7b92a">kvm_unshare_hyp</a></div><div class="ttdeci">void kvm_unshare_hyp(void *from, void *to)</div><div class="ttdef"><b>Definition:</b> <a href="mmu_8c_source.html#l00548">mmu.c:548</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="fpsimd_8c_a4a413d27f1db48bf29f9bdb738ab0b94_cgraph.png" border="0" usemap="#afpsimd_8c_a4a413d27f1db48bf29f9bdb738ab0b94_cgraph" alt=""/></div>
<map name="afpsimd_8c_a4a413d27f1db48bf29f9bdb738ab0b94_cgraph" id="afpsimd_8c_a4a413d27f1db48bf29f9bdb738ab0b94_cgraph">
<area shape="rect" title=" " alt="" coords="5,344,208,371"/>
<area shape="rect" href="mmu_8c.html#abeed34d3f32ae7e76a83700117b7b92a" title=" " alt="" coords="256,344,397,371"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="445,319,675,345"/>
<area shape="rect" href="mmu_8c.html#ab784fb7eb70984bb7728e616c60ec1e2" title=" " alt="" coords="493,369,627,396"/>
<area shape="rect" href="mem__protect_8h.html#a259c9aa4671e27b82908850ced15f83d" title=" " alt="" coords="723,344,921,371"/>
<area shape="rect" href="mmu_8c.html#ae872b392080198975a339e2351ec3abf" title=" " alt="" coords="759,395,885,421"/>
<area shape="rect" href="mem__protect_8c.html#ab6a32e622ae646989f8a020ce5f60ca4" title=" " alt="" coords="1011,243,1108,269"/>
<area shape="rect" href="mem__protect_8c.html#aa70b12df63f9379efa7fe11ade510b7c" title=" " alt="" coords="977,344,1141,371"/>
<area shape="rect" href="mem__protect_8c.html#a21f32ced99ed31332ac532029100e42d" title=" " alt="" coords="969,445,1149,472"/>
<area shape="rect" href="mem__protect_8c.html#abbc50e372d72deb41a021219c35e3589" title=" " alt="" coords="979,293,1139,320"/>
<area shape="rect" href="mem__protect_8c.html#a024de911d90c8e8d57cc96c87fecb4d3" title=" " alt="" coords="971,395,1147,421"/>
<area shape="rect" href="mem__protect_8c.html#a77ec896d00d3c2ebd6669edf6bc94847" title=" " alt="" coords="1207,132,1318,159"/>
<area shape="rect" href="mem__protect_8c.html#aa930dbd95452ee88a3f91456675dca49" title=" " alt="" coords="1203,256,1322,283"/>
<area shape="rect" href="mem__protect_8c.html#aad9e9a7b5fa0635f39dc96649d2eed00" title=" " alt="" coords="1381,77,1544,104"/>
<area shape="rect" href="mem__protect_8c.html#ad0fe4a77ba9585f7ad46c3d212e7559d" title=" " alt="" coords="1376,132,1549,159"/>
<area shape="rect" href="mem__protect_8c.html#a2b41e87ab661559f9f860797a14c914e" title=" " alt="" coords="1606,66,1777,107"/>
<area shape="rect" href="mem__protect_8c.html#adc131fc52bbb4443366cfbe93eb87839" title=" " alt="" coords="1833,81,2032,108"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="1873,31,1993,57"/>
<area shape="rect" href="mem__protect_8c.html#add960b8fe1ef188df3090aa2102c620d" title=" " alt="" coords="2080,81,2243,108"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="2291,81,2485,108"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="2539,132,2684,159"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="2535,81,2687,108"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="2533,31,2689,57"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="2747,107,2899,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="2982,56,3141,83"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="2987,107,3135,133"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="3213,56,3369,83"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="3224,107,3359,133"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="3433,56,3610,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="3417,5,3625,32"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="3458,157,3585,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="3462,107,3581,133"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="2737,56,2909,83"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="2957,157,3165,184"/>
<area shape="rect" href="pgtable_8c.html#af16196aa505cacc0ca294719f9575ce4" title=" " alt="" coords="2293,132,2483,159"/>
<area shape="rect" href="pgtable_8c.html#a7eb05408bfb8ee8e00dc693bbd018aa9" title=" " alt="" coords="3217,208,3365,235"/>
<area shape="rect" href="pgtable_8c.html#a42620f6fca0390491a59340e88890864" title=" " alt="" coords="3462,208,3581,235"/>
<area shape="rect" href="mem__protect_8c.html#adb6b6680efb04e5e509ccf68629283f8" title=" " alt="" coords="1380,340,1545,367"/>
<area shape="rect" href="mem__protect_8c.html#a29a8e46b3a5a7fdce3bf761585537d2d" title=" " alt="" coords="1395,256,1530,283"/>
<area shape="rect" href="mem__protect_8c.html#ab45dbaed102ffbf3ccda18c0cc20a6dc" title=" " alt="" coords="1597,366,1785,407"/>
<area shape="rect" href="mem__protect_8c.html#a3ea605c8779e3d79d674c81a6d64919c" title=" " alt="" coords="1841,241,2024,268"/>
<area shape="rect" href="mem__protect_8c.html#a39c30c3fbf244570912cbd38c6e5606a" title=" " alt="" coords="1854,373,2011,400"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="1851,307,2014,333"/>
<area shape="rect" href="mem__protect_8c.html#acef59d69975c27a7815896535bbb4e65" title=" " alt="" coords="2085,234,2238,275"/>
<area shape="rect" href="mem__protect_8c.html#a89057e6dfc7b241de73b439208bcf7d5" title=" " alt="" coords="1601,249,1781,290"/>
<area shape="rect" href="mem__protect_8c.html#a4ee4815f49f2d2a8397d1e2430193a3e" title=" " alt="" coords="1599,183,1783,225"/>
<area shape="rect" href="memory_8h.html#a3858889abb828afd54e20be3a55947d8" title=" " alt="" coords="1627,315,1755,341"/>
<area shape="rect" href="mem__protect_8c.html#a906b44af03f69892941d0b4e87d52fbd" title=" " alt="" coords="1856,191,2009,217"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="1205,332,1320,359"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="1197,420,1328,447"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="fpsimd_8c_a4a413d27f1db48bf29f9bdb738ab0b94_icgraph.png" border="0" usemap="#afpsimd_8c_a4a413d27f1db48bf29f9bdb738ab0b94_icgraph" alt=""/></div>
<map name="afpsimd_8c_a4a413d27f1db48bf29f9bdb738ab0b94_icgraph" id="afpsimd_8c_a4a413d27f1db48bf29f9bdb738ab0b94_icgraph">
<area shape="rect" title=" " alt="" coords="1961,42,2164,69"/>
<area shape="rect" href="fpsimd_8c.html#a98014dcb0f6b0f9abc0cfc671b8b733c" title=" " alt="" coords="1705,15,1913,42"/>
<area shape="rect" href="reset_8c.html#ae42f979a2e15b7e51c3e3dfc133cb473" title=" " alt="" coords="1720,67,1899,94"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="1478,5,1657,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="1267,13,1391,39"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1477,71,1657,98"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1257,67,1402,94"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1229,118,1429,145"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1029,67,1181,94"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="811,67,981,94"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="453,30,580,57"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="628,93,763,119"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,17,405,43"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="459,93,574,119"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,67,383,94"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,118,391,145"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,169,386,195"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,219,376,246"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,67,164,94"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
