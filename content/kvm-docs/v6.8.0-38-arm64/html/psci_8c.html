<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/arm64/kvm/psci.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_67a9e021ce8db5d46236c6154ee454bc.html">arm64</a></li><li class="navelem"><a class="el" href="dir_42f87ef63ac4150166bf7887f68288e2.html">kvm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">psci.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/arm-smccc.h&gt;</code><br />
<code>#include &lt;linux/preempt.h&gt;</code><br />
<code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &lt;linux/uaccess.h&gt;</code><br />
<code>#include &lt;linux/wait.h&gt;</code><br />
<code>#include &lt;asm/cputype.h&gt;</code><br />
<code>#include &lt;asm/kvm_emulate.h&gt;</code><br />
<code>#include &lt;kvm/arm_psci.h&gt;</code><br />
<code>#include &lt;kvm/arm_hypercalls.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for psci.c:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c__incl.png" border="0" usemap="#aarch_2arm64_2kvm_2psci_8c" alt=""/></div>
<map name="aarch_2arm64_2kvm_2psci_8c" id="aarch_2arm64_2kvm_2psci_8c">
<area shape="rect" title=" " alt="" coords="593,5,763,32"/>
<area shape="rect" title=" " alt="" coords="5,80,148,107"/>
<area shape="rect" title=" " alt="" coords="173,80,298,107"/>
<area shape="rect" title=" " alt="" coords="323,80,457,107"/>
<area shape="rect" title=" " alt="" coords="482,80,605,107"/>
<area shape="rect" title=" " alt="" coords="629,80,727,107"/>
<area shape="rect" title=" " alt="" coords="752,80,871,107"/>
<area shape="rect" title=" " alt="" coords="895,80,1051,107"/>
<area shape="rect" title=" " alt="" coords="1075,80,1201,107"/>
<area shape="rect" title=" " alt="" coords="1225,80,1392,107"/>
</map>
</div>
</div>
<p><a href="psci_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aaf112f9f63f065f3256018232aec6574"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#aaf112f9f63f065f3256018232aec6574">AFFINITY_MASK</a>(level)&#160;&#160;&#160;~((0x1UL &lt;&lt; ((level) * MPIDR_LEVEL_BITS)) - 1)</td></tr>
<tr class="separator:aaf112f9f63f065f3256018232aec6574"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa30b461609a71770efab6a5045274e5e"><td class="memItemLeft" align="right" valign="top">static unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#aa30b461609a71770efab6a5045274e5e">psci_affinity_mask</a> (unsigned long affinity_level)</td></tr>
<tr class="separator:aa30b461609a71770efab6a5045274e5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe7d85200e79143f87dab785a204fb3a"><td class="memItemLeft" align="right" valign="top">static unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#abe7d85200e79143f87dab785a204fb3a">kvm_psci_vcpu_suspend</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:abe7d85200e79143f87dab785a204fb3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9f7ca89512ea60ace6ea961a60354a4"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4">kvm_psci_valid_affinity</a> (struct kvm_vcpu *vcpu, unsigned long affinity)</td></tr>
<tr class="separator:ac9f7ca89512ea60ace6ea961a60354a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a092eeee0e7b54c50ebc3d0cf66ea8ef5"><td class="memItemLeft" align="right" valign="top">static unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#a092eeee0e7b54c50ebc3d0cf66ea8ef5">kvm_psci_vcpu_on</a> (struct kvm_vcpu *source_vcpu)</td></tr>
<tr class="separator:a092eeee0e7b54c50ebc3d0cf66ea8ef5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd3d020adc6118dbd290a2770d897439"><td class="memItemLeft" align="right" valign="top">static unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#afd3d020adc6118dbd290a2770d897439">kvm_psci_vcpu_affinity_info</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:afd3d020adc6118dbd290a2770d897439"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44cba757038eb3abdf93db5dc6c7ae3e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e">kvm_prepare_system_event</a> (struct kvm_vcpu *vcpu, u32 type, u64 flags)</td></tr>
<tr class="separator:a44cba757038eb3abdf93db5dc6c7ae3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9119f27fea8a008787ddbc93e8b1bded"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#a9119f27fea8a008787ddbc93e8b1bded">kvm_psci_system_off</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a9119f27fea8a008787ddbc93e8b1bded"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8f7f33f1397e347a67599f67ac2f39c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#ad8f7f33f1397e347a67599f67ac2f39c">kvm_psci_system_reset</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ad8f7f33f1397e347a67599f67ac2f39c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a340319ef6e70b6396954990199f5dfd2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#a340319ef6e70b6396954990199f5dfd2">kvm_psci_system_reset2</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a340319ef6e70b6396954990199f5dfd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a203f6ca47f969e84b5ce50a61f08e9ae"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#a203f6ca47f969e84b5ce50a61f08e9ae">kvm_psci_system_suspend</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a203f6ca47f969e84b5ce50a61f08e9ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fe2f9e365c9a9948351f718015ce651"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#a6fe2f9e365c9a9948351f718015ce651">kvm_psci_narrow_to_32bit</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a6fe2f9e365c9a9948351f718015ce651"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b9f15ff62c952f20de3ed44aaf4edbc"><td class="memItemLeft" align="right" valign="top">static unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#a3b9f15ff62c952f20de3ed44aaf4edbc">kvm_psci_check_allowed_function</a> (struct kvm_vcpu *vcpu, u32 fn)</td></tr>
<tr class="separator:a3b9f15ff62c952f20de3ed44aaf4edbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7522f6e0d1805f44a3e932397de4582"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582">kvm_psci_0_2_call</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ac7522f6e0d1805f44a3e932397de4582"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f59d47a1b54f561b8c42f509798142e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e">kvm_psci_1_x_call</a> (struct kvm_vcpu *vcpu, u32 minor)</td></tr>
<tr class="separator:a8f59d47a1b54f561b8c42f509798142e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af18cf22560595f1da5e34ea244b0b51b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#af18cf22560595f1da5e34ea244b0b51b">kvm_psci_0_1_call</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:af18cf22560595f1da5e34ea244b0b51b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3daa8000eb9717dde07d817c306b052b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b">kvm_psci_call</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a3daa8000eb9717dde07d817c306b052b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aaf112f9f63f065f3256018232aec6574"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf112f9f63f065f3256018232aec6574">&#9670;&nbsp;</a></span>AFFINITY_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AFFINITY_MASK</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">level</td><td>)</td>
          <td>&#160;&#160;&#160;~((0x1UL &lt;&lt; ((level) * MPIDR_LEVEL_BITS)) - 1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00024">24</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a44cba757038eb3abdf93db5dc6c7ae3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44cba757038eb3abdf93db5dc6c7ae3e">&#9670;&nbsp;</a></span>kvm_prepare_system_event()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_prepare_system_event </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00164">164</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;{</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *tmp;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">     * The KVM ABI specifies that a system event exit may call KVM_RUN</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">     * again and may perform shutdown/reboot at a later time that when the</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">     * actual request is made.  Since we are implementing PSCI and a</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">     * caller of PSCI reboot and shutdown expects that the system shuts</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">     * down or reboots immediately, let&#39;s make sure that VCPUs are not run</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">     * after this call is handled and before the VCPUs have been</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">     * re-initialized.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    kvm_for_each_vcpu(i, tmp, vcpu-&gt;kvm) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        spin_lock(&amp;tmp-&gt;arch.mp_state_lock);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        WRITE_ONCE(tmp-&gt;arch.mp_state.mp_state, KVM_MP_STATE_STOPPED);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        spin_unlock(&amp;tmp-&gt;arch.mp_state_lock);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6">kvm_make_all_cpus_request</a>(vcpu-&gt;kvm, KVM_REQ_SLEEP);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    memset(&amp;vcpu-&gt;run-&gt;system_event, 0, <span class="keyword">sizeof</span>(vcpu-&gt;run-&gt;system_event));</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    vcpu-&gt;run-&gt;system_event.type = type;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    vcpu-&gt;run-&gt;system_event.ndata = 1;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    vcpu-&gt;run-&gt;system_event.data[0] = flags;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    vcpu-&gt;run-&gt;exit_reason = KVM_EXIT_SYSTEM_EVENT;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_abaa3f5ff00150487b52dd21c1617bab6"><div class="ttname"><a href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6">kvm_make_all_cpus_request</a></div><div class="ttdeci">bool kvm_make_all_cpus_request(struct kvm *kvm, unsigned int req)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l00340">kvm_main.c:340</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a44cba757038eb3abdf93db5dc6c7ae3e_cgraph.png" border="0" usemap="#apsci_8c_a44cba757038eb3abdf93db5dc6c7ae3e_cgraph" alt=""/></div>
<map name="apsci_8c_a44cba757038eb3abdf93db5dc6c7ae3e_cgraph" id="apsci_8c_a44cba757038eb3abdf93db5dc6c7ae3e_cgraph">
<area shape="rect" title=" " alt="" coords="5,23,168,65"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="216,31,427,57"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="475,23,685,65"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="744,5,911,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="733,56,921,83"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1018,5,1097,32"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="969,56,1145,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="981,107,1134,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a44cba757038eb3abdf93db5dc6c7ae3e_icgraph.png" border="0" usemap="#apsci_8c_a44cba757038eb3abdf93db5dc6c7ae3e_icgraph" alt=""/></div>
<map name="apsci_8c_a44cba757038eb3abdf93db5dc6c7ae3e_icgraph" id="apsci_8c_a44cba757038eb3abdf93db5dc6c7ae3e_icgraph">
<area shape="rect" title=" " alt="" coords="1203,49,1365,90"/>
<area shape="rect" href="psci_8c.html#a9119f27fea8a008787ddbc93e8b1bded" title=" " alt="" coords="984,5,1147,32"/>
<area shape="rect" href="psci_8c.html#ad8f7f33f1397e347a67599f67ac2f39c" title=" " alt="" coords="976,56,1155,83"/>
<area shape="rect" href="psci_8c.html#a340319ef6e70b6396954990199f5dfd2" title=" " alt="" coords="741,107,928,133"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="763,56,907,83"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,107,693,133"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,81,501,108"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,81,339,108"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,56,103,83"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,107,105,133"/>
</map>
</div>

</div>
</div>
<a id="af18cf22560595f1da5e34ea244b0b51b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af18cf22560595f1da5e34ea244b0b51b">&#9670;&nbsp;</a></span>kvm_psci_0_1_call()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_psci_0_1_call </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00403">403</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;{</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    u32 psci_fn = smccc_get_function(vcpu);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> val;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">switch</span> (psci_fn) {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">case</span> KVM_PSCI_FN_CPU_OFF:</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <a class="code" href="arm_8c.html#a8a5659b8fc302d5b435957306e3541b4">kvm_arm_vcpu_power_off</a>(vcpu);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        val = PSCI_RET_SUCCESS;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">case</span> KVM_PSCI_FN_CPU_ON:</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        val = <a class="code" href="psci_8c.html#a092eeee0e7b54c50ebc3d0cf66ea8ef5">kvm_psci_vcpu_on</a>(vcpu);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        val = PSCI_RET_NOT_SUPPORTED;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    smccc_set_retval(vcpu, val, 0, 0, 0);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div>
<div class="ttc" id="aarm_8c_html_a8a5659b8fc302d5b435957306e3541b4"><div class="ttname"><a href="arm_8c.html#a8a5659b8fc302d5b435957306e3541b4">kvm_arm_vcpu_power_off</a></div><div class="ttdeci">void kvm_arm_vcpu_power_off(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="arm_8c_source.html#l00494">arm.c:494</a></div></div>
<div class="ttc" id="apsci_8c_html_a092eeee0e7b54c50ebc3d0cf66ea8ef5"><div class="ttname"><a href="psci_8c.html#a092eeee0e7b54c50ebc3d0cf66ea8ef5">kvm_psci_vcpu_on</a></div><div class="ttdeci">static unsigned long kvm_psci_vcpu_on(struct kvm_vcpu *source_vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00060">psci.c:60</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_af18cf22560595f1da5e34ea244b0b51b_cgraph.png" border="0" usemap="#apsci_8c_af18cf22560595f1da5e34ea244b0b51b_cgraph" alt=""/></div>
<map name="apsci_8c_af18cf22560595f1da5e34ea244b0b51b_cgraph" id="apsci_8c_af18cf22560595f1da5e34ea244b0b51b_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,149,108"/>
<area shape="rect" href="arm_8c.html#a8a5659b8fc302d5b435957306e3541b4" title=" " alt="" coords="197,31,391,57"/>
<area shape="rect" href="psci_8c.html#a092eeee0e7b54c50ebc3d0cf66ea8ef5" title=" " alt="" coords="221,107,367,133"/>
<area shape="rect" href="arm_8c.html#afc3949baef2cd8a5749b2d0095959de1" title=" " alt="" coords="439,5,645,32"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="693,5,816,32"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="864,5,1072,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="891,56,1045,83"/>
<area shape="rect" href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a" title=" " alt="" coords="451,107,633,133"/>
<area shape="rect" href="arm_8c.html#a0be215e1642483c65818bd994b13a421" title=" " alt="" coords="465,157,619,184"/>
<area shape="rect" href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4" title=" " alt="" coords="454,208,630,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_af18cf22560595f1da5e34ea244b0b51b_icgraph.png" border="0" usemap="#apsci_8c_af18cf22560595f1da5e34ea244b0b51b_icgraph" alt=""/></div>
<map name="apsci_8c_af18cf22560595f1da5e34ea244b0b51b_icgraph" id="apsci_8c_af18cf22560595f1da5e34ea244b0b51b_icgraph">
<area shape="rect" title=" " alt="" coords="549,31,693,57"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="ac7522f6e0d1805f44a3e932397de4582"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7522f6e0d1805f44a3e932397de4582">&#9670;&nbsp;</a></span>kvm_psci_0_2_call()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_psci_0_2_call </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00240">240</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;{</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    u32 psci_fn = smccc_get_function(vcpu);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> val;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">int</span> ret = 1;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">switch</span> (psci_fn) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN_PSCI_VERSION:</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">         * Bits[31:16] = Major Version = 0</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">         * Bits[15:0] = Minor Version = 2</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        val = KVM_ARM_PSCI_0_2;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN_CPU_SUSPEND:</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN64_CPU_SUSPEND:</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        val = <a class="code" href="psci_8c.html#abe7d85200e79143f87dab785a204fb3a">kvm_psci_vcpu_suspend</a>(vcpu);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN_CPU_OFF:</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <a class="code" href="arm_8c.html#a8a5659b8fc302d5b435957306e3541b4">kvm_arm_vcpu_power_off</a>(vcpu);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        val = PSCI_RET_SUCCESS;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN_CPU_ON:</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <a class="code" href="psci_8c.html#a6fe2f9e365c9a9948351f718015ce651">kvm_psci_narrow_to_32bit</a>(vcpu);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        fallthrough;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN64_CPU_ON:</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        val = <a class="code" href="psci_8c.html#a092eeee0e7b54c50ebc3d0cf66ea8ef5">kvm_psci_vcpu_on</a>(vcpu);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN_AFFINITY_INFO:</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <a class="code" href="psci_8c.html#a6fe2f9e365c9a9948351f718015ce651">kvm_psci_narrow_to_32bit</a>(vcpu);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        fallthrough;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN64_AFFINITY_INFO:</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        val = <a class="code" href="psci_8c.html#afd3d020adc6118dbd290a2770d897439">kvm_psci_vcpu_affinity_info</a>(vcpu);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN_MIGRATE_INFO_TYPE:</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">         * Trusted OS is MP hence does not require migration</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">             * or</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">         * Trusted OS is not present</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        val = PSCI_0_2_TOS_MP;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN_SYSTEM_OFF:</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="psci_8c.html#a9119f27fea8a008787ddbc93e8b1bded">kvm_psci_system_off</a>(vcpu);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">         * We shouldn&#39;t be going back to guest VCPU after</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">         * receiving SYSTEM_OFF request.</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">         * If user space accidentally/deliberately resumes</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">         * guest VCPU after SYSTEM_OFF request then guest</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">         * VCPU should see internal failure from PSCI return</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">         * value. To achieve this, we preload r0 (or x0) with</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">         * PSCI return value INTERNAL_FAILURE.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        val = PSCI_RET_INTERNAL_FAILURE;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        ret = 0;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN_SYSTEM_RESET:</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <a class="code" href="psci_8c.html#ad8f7f33f1397e347a67599f67ac2f39c">kvm_psci_system_reset</a>(vcpu);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">         * Same reason as SYSTEM_OFF for preloading r0 (or x0)</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">         * with PSCI return value INTERNAL_FAILURE.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        val = PSCI_RET_INTERNAL_FAILURE;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        ret = 0;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        val = PSCI_RET_NOT_SUPPORTED;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    smccc_set_retval(vcpu, val, 0, 0, 0);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div>
<div class="ttc" id="apsci_8c_html_a6fe2f9e365c9a9948351f718015ce651"><div class="ttname"><a href="psci_8c.html#a6fe2f9e365c9a9948351f718015ce651">kvm_psci_narrow_to_32bit</a></div><div class="ttdeci">static void kvm_psci_narrow_to_32bit(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00217">psci.c:217</a></div></div>
<div class="ttc" id="apsci_8c_html_a9119f27fea8a008787ddbc93e8b1bded"><div class="ttname"><a href="psci_8c.html#a9119f27fea8a008787ddbc93e8b1bded">kvm_psci_system_off</a></div><div class="ttdeci">static void kvm_psci_system_off(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00192">psci.c:192</a></div></div>
<div class="ttc" id="apsci_8c_html_abe7d85200e79143f87dab785a204fb3a"><div class="ttname"><a href="psci_8c.html#abe7d85200e79143f87dab785a204fb3a">kvm_psci_vcpu_suspend</a></div><div class="ttdeci">static unsigned long kvm_psci_vcpu_suspend(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00034">psci.c:34</a></div></div>
<div class="ttc" id="apsci_8c_html_ad8f7f33f1397e347a67599f67ac2f39c"><div class="ttname"><a href="psci_8c.html#ad8f7f33f1397e347a67599f67ac2f39c">kvm_psci_system_reset</a></div><div class="ttdeci">static void kvm_psci_system_reset(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00197">psci.c:197</a></div></div>
<div class="ttc" id="apsci_8c_html_afd3d020adc6118dbd290a2770d897439"><div class="ttname"><a href="psci_8c.html#afd3d020adc6118dbd290a2770d897439">kvm_psci_vcpu_affinity_info</a></div><div class="ttdeci">static unsigned long kvm_psci_vcpu_affinity_info(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00121">psci.c:121</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_ac7522f6e0d1805f44a3e932397de4582_cgraph.png" border="0" usemap="#apsci_8c_ac7522f6e0d1805f44a3e932397de4582_cgraph" alt=""/></div>
<map name="apsci_8c_ac7522f6e0d1805f44a3e932397de4582_cgraph" id="apsci_8c_ac7522f6e0d1805f44a3e932397de4582_cgraph">
<area shape="rect" title=" " alt="" coords="5,259,149,285"/>
<area shape="rect" href="arm_8c.html#a8a5659b8fc302d5b435957306e3541b4" title=" " alt="" coords="197,92,391,119"/>
<area shape="rect" href="psci_8c.html#a6fe2f9e365c9a9948351f718015ce651" title=" " alt="" coords="216,411,372,453"/>
<area shape="rect" href="psci_8c.html#a9119f27fea8a008787ddbc93e8b1bded" title=" " alt="" coords="213,208,375,235"/>
<area shape="rect" href="psci_8c.html#ad8f7f33f1397e347a67599f67ac2f39c" title=" " alt="" coords="205,157,383,184"/>
<area shape="rect" href="psci_8c.html#afd3d020adc6118dbd290a2770d897439" title=" " alt="" coords="1211,335,1417,361"/>
<area shape="rect" href="psci_8c.html#a092eeee0e7b54c50ebc3d0cf66ea8ef5" title=" " alt="" coords="1241,259,1387,285"/>
<area shape="rect" href="psci_8c.html#abe7d85200e79143f87dab785a204fb3a" title=" " alt="" coords="203,360,385,387"/>
<area shape="rect" href="arm_8c.html#afc3949baef2cd8a5749b2d0095959de1" title=" " alt="" coords="439,77,645,104"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="737,56,860,83"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="953,5,1161,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1483,56,1636,83"/>
<area shape="rect" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e" title=" " alt="" coords="461,150,623,191"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="693,157,904,184"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="952,150,1163,191"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1231,157,1397,184"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1220,107,1408,133"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1520,157,1599,184"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1471,107,1647,133"/>
<area shape="rect" href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a" title=" " alt="" coords="1714,360,1895,387"/>
<area shape="rect" href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4" title=" " alt="" coords="1471,309,1647,336"/>
<area shape="rect" href="psci_8c.html#aa30b461609a71770efab6a5045274e5e" title=" " alt="" coords="1487,411,1631,437"/>
<area shape="rect" href="arm_8c.html#a0be215e1642483c65818bd994b13a421" title=" " alt="" coords="1482,259,1637,285"/>
<area shape="rect" href="arm_8c.html#a68df8c6f1b7134e9f23857f092d50056" title=" " alt="" coords="485,765,599,792"/>
<area shape="rect" href="kvm__main_8c.html#a7256a8615584a9ae83a46c071f6aa0e9" title=" " alt="" coords="738,613,859,640"/>
<area shape="rect" href="vgic_8c.html#a751661541b39c02532a54736db22a929" title=" " alt="" coords="717,765,880,792"/>
<area shape="rect" href="vgic-v4_8c.html#ac2966fbf90610bb8a0525cbd903f7477" title=" " alt="" coords="745,816,852,843"/>
<area shape="rect" href="vgic-v4_8c.html#aeafcb3e6b67ea32ed8e59d009252e565" title=" " alt="" coords="749,867,849,893"/>
<area shape="rect" href="kvm__main_8c.html#a1045a615093ccd8e87dcd6f6a0e03e9e" title=" " alt="" coords="988,563,1127,589"/>
<area shape="rect" href="kvm__main_8c.html#a8e18df0287ddedfd516454aeeb669807" title=" " alt="" coords="992,512,1123,539"/>
<area shape="rect" href="kvm__main_8c.html#a3de4d6991bdd1a714e8afa6a55136cdd" title=" " alt="" coords="1226,461,1402,488"/>
<area shape="rect" href="kvm__main_8c.html#afc3c9c56d305921c317259e18c9c8a59" title=" " alt="" coords="952,613,1163,640"/>
<area shape="rect" href="kvm__main_8c.html#a22600b8a76a84f58d97f1a465293e63c" title=" " alt="" coords="984,664,1131,691"/>
<area shape="rect" href="kvm__main_8c.html#aaa76576c021037e516218db81c147ca0" title=" " alt="" coords="973,715,1142,741"/>
<area shape="rect" href="arm_8c.html#aa48cc7e76c49933c4fb44eda2ecec1ab" title=" " alt="" coords="1221,512,1407,539"/>
<area shape="rect" href="arm_8c.html#a6416d8550a44ef31c85f11d80d6efcc2" title=" " alt="" coords="1213,563,1415,589"/>
<area shape="rect" href="arm_8c.html#ac412fb0d81a53e66d8ac4146e4202f92" title=" " alt="" coords="1465,461,1653,488"/>
<area shape="rect" href="arch__timer_8c.html#a78e23e83bece8c269268f3a263fbb114" title=" " alt="" coords="1474,513,1645,554"/>
<area shape="rect" href="vgic_8c.html#a3059bfcee1ad30f581150d06c07d68e8" title=" " alt="" coords="1701,461,1908,488"/>
<area shape="rect" href="vgic_8h.html#a1109d873011f89a4acb4fd461f9f0a45" title=" " alt="" coords="1983,485,2099,512"/>
<area shape="rect" href="vgic-mmio_8c.html#ad275c2ef6d5f7f0d79f101a7dd6dda3a" title=" " alt="" coords="1983,435,2100,461"/>
<area shape="rect" href="vgic-v2_8c.html#aa825011d5b7d02e6b8f6c21746a5af39" title=" " alt="" coords="2175,435,2315,461"/>
<area shape="rect" href="arch__timer_8c.html#ad210f5f7b0361777290f8b36f023a518" title=" " alt="" coords="1724,516,1885,543"/>
<area shape="rect" href="arch__timer_8c.html#a9d0120f96e99b20be8023dad5c6a7f0b" title=" " alt="" coords="1749,567,1860,593"/>
<area shape="rect" href="arch__timer_8c.html#a6c290bf8212ea1388cdb4a839eae7228" title=" " alt="" coords="1956,559,2127,601"/>
<area shape="rect" href="vgic-v2_8c.html#aa92110fc4f1e453fde0e8e720845854f" title=" " alt="" coords="983,765,1132,792"/>
<area shape="rect" href="vgic-v3_8c.html#aa3f97179d90d3ed6a8920d1c57496380" title=" " alt="" coords="983,816,1132,843"/>
<area shape="rect" href="vgic-v3-sr_8c.html#a4c7049da2b551848d3e39293c881f329" title=" " alt="" coords="1233,816,1395,843"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="960,867,1155,893"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="1263,867,1365,893"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_ac7522f6e0d1805f44a3e932397de4582_icgraph.png" border="0" usemap="#apsci_8c_ac7522f6e0d1805f44a3e932397de4582_icgraph" alt=""/></div>
<map name="apsci_8c_ac7522f6e0d1805f44a3e932397de4582_icgraph" id="apsci_8c_ac7522f6e0d1805f44a3e932397de4582_icgraph">
<area shape="rect" title=" " alt="" coords="741,31,885,57"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="a8f59d47a1b54f561b8c42f509798142e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f59d47a1b54f561b8c42f509798142e">&#9670;&nbsp;</a></span>kvm_psci_1_x_call()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_psci_1_x_call </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>minor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00315">315</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;{</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> val = PSCI_RET_NOT_SUPPORTED;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    u32 psci_fn = smccc_get_function(vcpu);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    u32 arg;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordtype">int</span> ret = 1;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">switch</span>(psci_fn) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">case</span> PSCI_0_2_FN_PSCI_VERSION:</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        val = minor == 0 ? KVM_ARM_PSCI_1_0 : KVM_ARM_PSCI_1_1;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">case</span> PSCI_1_0_FN_PSCI_FEATURES:</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        arg = smccc_get_arg1(vcpu);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        val = <a class="code" href="psci_8c.html#a3b9f15ff62c952f20de3ed44aaf4edbc">kvm_psci_check_allowed_function</a>(vcpu, arg);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">if</span> (val)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        val = PSCI_RET_NOT_SUPPORTED;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">switch</span>(arg) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN_PSCI_VERSION:</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN_CPU_SUSPEND:</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN64_CPU_SUSPEND:</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN_CPU_OFF:</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN_CPU_ON:</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN64_CPU_ON:</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN_AFFINITY_INFO:</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN64_AFFINITY_INFO:</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN_MIGRATE_INFO_TYPE:</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN_SYSTEM_OFF:</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">case</span> PSCI_0_2_FN_SYSTEM_RESET:</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">case</span> PSCI_1_0_FN_PSCI_FEATURES:</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordflow">case</span> ARM_SMCCC_VERSION_FUNC_ID:</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            val = 0;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">case</span> PSCI_1_0_FN_SYSTEM_SUSPEND:</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordflow">case</span> PSCI_1_0_FN64_SYSTEM_SUSPEND:</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="keywordflow">if</span> (test_bit(KVM_ARCH_FLAG_SYSTEM_SUSPEND_ENABLED, &amp;kvm-&gt;arch.flags))</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                val = 0;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">case</span> PSCI_1_1_FN_SYSTEM_RESET2:</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">case</span> PSCI_1_1_FN64_SYSTEM_RESET2:</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="keywordflow">if</span> (minor &gt;= 1)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                val = 0;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">case</span> PSCI_1_0_FN_SYSTEM_SUSPEND:</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="psci_8c.html#a6fe2f9e365c9a9948351f718015ce651">kvm_psci_narrow_to_32bit</a>(vcpu);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        fallthrough;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">case</span> PSCI_1_0_FN64_SYSTEM_SUSPEND:</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">         * Return directly to userspace without changing the vCPU&#39;s</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">         * registers. Userspace depends on reading the SMCCC parameters</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">         * to implement SYSTEM_SUSPEND.</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">if</span> (test_bit(KVM_ARCH_FLAG_SYSTEM_SUSPEND_ENABLED, &amp;kvm-&gt;arch.flags)) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <a class="code" href="psci_8c.html#a203f6ca47f969e84b5ce50a61f08e9ae">kvm_psci_system_suspend</a>(vcpu);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">case</span> PSCI_1_1_FN_SYSTEM_RESET2:</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <a class="code" href="psci_8c.html#a6fe2f9e365c9a9948351f718015ce651">kvm_psci_narrow_to_32bit</a>(vcpu);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        fallthrough;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">case</span> PSCI_1_1_FN64_SYSTEM_RESET2:</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">if</span> (minor &gt;= 1) {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            arg = smccc_get_arg1(vcpu);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="keywordflow">if</span> (arg &lt;= PSCI_1_1_RESET_TYPE_SYSTEM_WARM_RESET ||</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                arg &gt;= PSCI_1_1_RESET_TYPE_VENDOR_START) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                <a class="code" href="psci_8c.html#a340319ef6e70b6396954990199f5dfd2">kvm_psci_system_reset2</a>(vcpu);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                vcpu_set_reg(vcpu, 0, PSCI_RET_INTERNAL_FAILURE);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            val = PSCI_RET_INVALID_PARAMS;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582">kvm_psci_0_2_call</a>(vcpu);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    smccc_set_retval(vcpu, val, 0, 0, 0);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div>
<div class="ttc" id="apsci_8c_html_a203f6ca47f969e84b5ce50a61f08e9ae"><div class="ttname"><a href="psci_8c.html#a203f6ca47f969e84b5ce50a61f08e9ae">kvm_psci_system_suspend</a></div><div class="ttdeci">static void kvm_psci_system_suspend(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00208">psci.c:208</a></div></div>
<div class="ttc" id="apsci_8c_html_a340319ef6e70b6396954990199f5dfd2"><div class="ttname"><a href="psci_8c.html#a340319ef6e70b6396954990199f5dfd2">kvm_psci_system_reset2</a></div><div class="ttdeci">static void kvm_psci_system_reset2(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00202">psci.c:202</a></div></div>
<div class="ttc" id="apsci_8c_html_a3b9f15ff62c952f20de3ed44aaf4edbc"><div class="ttname"><a href="psci_8c.html#a3b9f15ff62c952f20de3ed44aaf4edbc">kvm_psci_check_allowed_function</a></div><div class="ttdeci">static unsigned long kvm_psci_check_allowed_function(struct kvm_vcpu *vcpu, u32 fn)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00229">psci.c:229</a></div></div>
<div class="ttc" id="apsci_8c_html_ac7522f6e0d1805f44a3e932397de4582"><div class="ttname"><a href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582">kvm_psci_0_2_call</a></div><div class="ttdeci">static int kvm_psci_0_2_call(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00240">psci.c:240</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a8f59d47a1b54f561b8c42f509798142e_cgraph.png" border="0" usemap="#apsci_8c_a8f59d47a1b54f561b8c42f509798142e_cgraph" alt=""/></div>
<map name="apsci_8c_a8f59d47a1b54f561b8c42f509798142e_cgraph" id="apsci_8c_a8f59d47a1b54f561b8c42f509798142e_cgraph">
<area shape="rect" title=" " alt="" coords="5,773,149,800"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="225,588,369,615"/>
<area shape="rect" href="psci_8c.html#a6fe2f9e365c9a9948351f718015ce651" title=" " alt="" coords="464,715,620,757"/>
<area shape="rect" href="psci_8c.html#a3b9f15ff62c952f20de3ed44aaf4edbc" title=" " alt="" coords="204,825,391,866"/>
<area shape="rect" href="psci_8c.html#a340319ef6e70b6396954990199f5dfd2" title=" " alt="" coords="204,773,391,800"/>
<area shape="rect" href="psci_8c.html#a203f6ca47f969e84b5ce50a61f08e9ae" title=" " alt="" coords="197,891,397,917"/>
<area shape="rect" href="arm_8c.html#a8a5659b8fc302d5b435957306e3541b4" title=" " alt="" coords="445,563,639,589"/>
<area shape="rect" href="psci_8c.html#a9119f27fea8a008787ddbc93e8b1bded" title=" " alt="" coords="461,613,623,640"/>
<area shape="rect" href="psci_8c.html#ad8f7f33f1397e347a67599f67ac2f39c" title=" " alt="" coords="453,664,631,691"/>
<area shape="rect" href="psci_8c.html#afd3d020adc6118dbd290a2770d897439" title=" " alt="" coords="1459,440,1665,467"/>
<area shape="rect" href="psci_8c.html#a092eeee0e7b54c50ebc3d0cf66ea8ef5" title=" " alt="" coords="1489,512,1635,539"/>
<area shape="rect" href="psci_8c.html#abe7d85200e79143f87dab785a204fb3a" title=" " alt="" coords="451,385,633,412"/>
<area shape="rect" href="arm_8c.html#afc3949baef2cd8a5749b2d0095959de1" title=" " alt="" coords="687,563,893,589"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="985,563,1108,589"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1201,613,1409,640"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1731,592,1884,619"/>
<area shape="rect" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e" title=" " alt="" coords="709,659,871,701"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="941,671,1152,697"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1200,665,1411,706"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1479,693,1645,720"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1468,643,1656,669"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1768,693,1847,720"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1719,643,1895,669"/>
<area shape="rect" href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a" title=" " alt="" coords="1962,339,2143,365"/>
<area shape="rect" href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4" title=" " alt="" coords="1719,440,1895,467"/>
<area shape="rect" href="psci_8c.html#aa30b461609a71770efab6a5045274e5e" title=" " alt="" coords="1735,389,1879,416"/>
<area shape="rect" href="arm_8c.html#a0be215e1642483c65818bd994b13a421" title=" " alt="" coords="1730,541,1885,568"/>
<area shape="rect" href="arm_8c.html#a68df8c6f1b7134e9f23857f092d50056" title=" " alt="" coords="733,360,847,387"/>
<area shape="rect" href="kvm__main_8c.html#a7256a8615584a9ae83a46c071f6aa0e9" title=" " alt="" coords="986,157,1107,184"/>
<area shape="rect" href="vgic_8c.html#a751661541b39c02532a54736db22a929" title=" " alt="" coords="965,309,1128,336"/>
<area shape="rect" href="vgic-v4_8c.html#ac2966fbf90610bb8a0525cbd903f7477" title=" " alt="" coords="993,360,1100,387"/>
<area shape="rect" href="vgic-v4_8c.html#aeafcb3e6b67ea32ed8e59d009252e565" title=" " alt="" coords="997,411,1097,437"/>
<area shape="rect" href="kvm__main_8c.html#a1045a615093ccd8e87dcd6f6a0e03e9e" title=" " alt="" coords="1236,259,1375,285"/>
<area shape="rect" href="kvm__main_8c.html#a8e18df0287ddedfd516454aeeb669807" title=" " alt="" coords="1240,208,1371,235"/>
<area shape="rect" href="kvm__main_8c.html#a3de4d6991bdd1a714e8afa6a55136cdd" title=" " alt="" coords="1474,157,1650,184"/>
<area shape="rect" href="kvm__main_8c.html#afc3c9c56d305921c317259e18c9c8a59" title=" " alt="" coords="1200,5,1411,32"/>
<area shape="rect" href="kvm__main_8c.html#a22600b8a76a84f58d97f1a465293e63c" title=" " alt="" coords="1232,107,1379,133"/>
<area shape="rect" href="kvm__main_8c.html#aaa76576c021037e516218db81c147ca0" title=" " alt="" coords="1221,157,1390,184"/>
<area shape="rect" href="arm_8c.html#aa48cc7e76c49933c4fb44eda2ecec1ab" title=" " alt="" coords="1469,259,1655,285"/>
<area shape="rect" href="arm_8c.html#a6416d8550a44ef31c85f11d80d6efcc2" title=" " alt="" coords="1461,208,1663,235"/>
<area shape="rect" href="arm_8c.html#ac412fb0d81a53e66d8ac4146e4202f92" title=" " alt="" coords="1713,273,1901,300"/>
<area shape="rect" href="arch__timer_8c.html#a78e23e83bece8c269268f3a263fbb114" title=" " alt="" coords="1722,150,1893,191"/>
<area shape="rect" href="vgic_8c.html#a3059bfcee1ad30f581150d06c07d68e8" title=" " alt="" coords="1949,273,2156,300"/>
<area shape="rect" href="arch__timer_8c.html#ad210f5f7b0361777290f8b36f023a518" title=" " alt="" coords="1972,132,2133,159"/>
<area shape="rect" href="arch__timer_8c.html#a9d0120f96e99b20be8023dad5c6a7f0b" title=" " alt="" coords="1997,183,2108,209"/>
<area shape="rect" href="vgic-v2_8c.html#aa92110fc4f1e453fde0e8e720845854f" title=" " alt="" coords="1231,360,1380,387"/>
<area shape="rect" href="vgic-v3_8c.html#aa3f97179d90d3ed6a8920d1c57496380" title=" " alt="" coords="1231,309,1380,336"/>
<area shape="rect" href="vgic-v3-sr_8c.html#a4c7049da2b551848d3e39293c881f329" title=" " alt="" coords="1481,309,1643,336"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="1208,411,1403,437"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="1511,389,1613,416"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a8f59d47a1b54f561b8c42f509798142e_icgraph.png" border="0" usemap="#apsci_8c_a8f59d47a1b54f561b8c42f509798142e_icgraph" alt=""/></div>
<map name="apsci_8c_a8f59d47a1b54f561b8c42f509798142e_icgraph" id="apsci_8c_a8f59d47a1b54f561b8c42f509798142e_icgraph">
<area shape="rect" title=" " alt="" coords="549,31,693,57"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="a3daa8000eb9717dde07d817c306b052b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3daa8000eb9717dde07d817c306b052b">&#9670;&nbsp;</a></span>kvm_psci_call()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_psci_call </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_psci_call - handle PSCI call if r0 value is in range @vcpu: Pointer to the VCPU struct</p>
<p>Handle PSCI calls from guests through traps from HVC instructions. The calling convention is similar to SMC calls to the secure world where the function number is placed in r0.</p>
<p>This function returns: &gt; 0 (success), 0 (success but exit to user space), and &lt; 0 (errors)</p>
<p>Errors: -EINVAL: Unrecognized PSCI function </p>

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00439">439</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;{</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    u32 psci_fn = smccc_get_function(vcpu);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordtype">int</span> version = kvm_psci_version(vcpu);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> val;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    val = <a class="code" href="psci_8c.html#a3b9f15ff62c952f20de3ed44aaf4edbc">kvm_psci_check_allowed_function</a>(vcpu, psci_fn);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span> (val) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        smccc_set_retval(vcpu, val, 0, 0, 0);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">switch</span> (version) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_PSCI_1_1:</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e">kvm_psci_1_x_call</a>(vcpu, 1);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_PSCI_1_0:</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e">kvm_psci_1_x_call</a>(vcpu, 0);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_PSCI_0_2:</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582">kvm_psci_0_2_call</a>(vcpu);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_PSCI_0_1:</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="psci_8c.html#af18cf22560595f1da5e34ea244b0b51b">kvm_psci_0_1_call</a>(vcpu);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        WARN_ONCE(1, <span class="stringliteral">&quot;Unknown PSCI version %d&quot;</span>, version);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        smccc_set_retval(vcpu, SMCCC_RET_NOT_SUPPORTED, 0, 0, 0);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div>
<div class="ttc" id="apsci_8c_html_a8f59d47a1b54f561b8c42f509798142e"><div class="ttname"><a href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e">kvm_psci_1_x_call</a></div><div class="ttdeci">static int kvm_psci_1_x_call(struct kvm_vcpu *vcpu, u32 minor)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00315">psci.c:315</a></div></div>
<div class="ttc" id="apsci_8c_html_af18cf22560595f1da5e34ea244b0b51b"><div class="ttname"><a href="psci_8c.html#af18cf22560595f1da5e34ea244b0b51b">kvm_psci_0_1_call</a></div><div class="ttdeci">static int kvm_psci_0_1_call(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00403">psci.c:403</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a3daa8000eb9717dde07d817c306b052b_cgraph.png" border="0" usemap="#apsci_8c_a3daa8000eb9717dde07d817c306b052b_cgraph" alt=""/></div>
<map name="apsci_8c_a3daa8000eb9717dde07d817c306b052b_cgraph" id="apsci_8c_a3daa8000eb9717dde07d817c306b052b_cgraph">
<area shape="rect" title=" " alt="" coords="5,436,120,463"/>
<area shape="rect" href="psci_8c.html#af18cf22560595f1da5e34ea244b0b51b" title=" " alt="" coords="388,220,532,247"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="388,372,532,399"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="168,461,312,488"/>
<area shape="rect" href="psci_8c.html#a3b9f15ff62c952f20de3ed44aaf4edbc" title=" " alt="" coords="367,575,553,617"/>
<area shape="rect" href="arm_8c.html#a8a5659b8fc302d5b435957306e3541b4" title=" " alt="" coords="615,169,808,196"/>
<area shape="rect" href="psci_8c.html#a092eeee0e7b54c50ebc3d0cf66ea8ef5" title=" " alt="" coords="639,220,784,247"/>
<area shape="rect" href="arm_8c.html#afc3949baef2cd8a5749b2d0095959de1" title=" " alt="" coords="863,56,1069,83"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1161,56,1284,83"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1377,5,1585,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1903,107,2056,133"/>
<area shape="rect" href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a" title=" " alt="" coords="2134,309,2315,336"/>
<area shape="rect" href="arm_8c.html#a0be215e1642483c65818bd994b13a421" title=" " alt="" coords="889,157,1043,184"/>
<area shape="rect" href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4" title=" " alt="" coords="878,259,1054,285"/>
<area shape="rect" href="psci_8c.html#a6fe2f9e365c9a9948351f718015ce651" title=" " alt="" coords="633,499,789,541"/>
<area shape="rect" href="psci_8c.html#a9119f27fea8a008787ddbc93e8b1bded" title=" " alt="" coords="630,347,793,373"/>
<area shape="rect" href="psci_8c.html#ad8f7f33f1397e347a67599f67ac2f39c" title=" " alt="" coords="622,397,801,424"/>
<area shape="rect" href="psci_8c.html#afd3d020adc6118dbd290a2770d897439" title=" " alt="" coords="608,296,815,323"/>
<area shape="rect" href="psci_8c.html#abe7d85200e79143f87dab785a204fb3a" title=" " alt="" coords="620,448,803,475"/>
<area shape="rect" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e" title=" " alt="" coords="885,411,1047,453"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="1117,393,1328,420"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="1376,361,1587,402"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="1653,411,1819,437"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="1642,360,1830,387"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1940,411,2019,437"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1891,360,2067,387"/>
<area shape="rect" href="psci_8c.html#aa30b461609a71770efab6a5045274e5e" title=" " alt="" coords="894,360,1038,387"/>
<area shape="rect" href="arm_8c.html#a68df8c6f1b7134e9f23857f092d50056" title=" " alt="" coords="909,512,1023,539"/>
<area shape="rect" href="kvm__main_8c.html#a7256a8615584a9ae83a46c071f6aa0e9" title=" " alt="" coords="1162,680,1283,707"/>
<area shape="rect" href="vgic_8c.html#a751661541b39c02532a54736db22a929" title=" " alt="" coords="1141,461,1304,488"/>
<area shape="rect" href="vgic-v4_8c.html#ac2966fbf90610bb8a0525cbd903f7477" title=" " alt="" coords="1169,512,1276,539"/>
<area shape="rect" href="vgic-v4_8c.html#aeafcb3e6b67ea32ed8e59d009252e565" title=" " alt="" coords="1173,563,1273,589"/>
<area shape="rect" href="kvm__main_8c.html#a1045a615093ccd8e87dcd6f6a0e03e9e" title=" " alt="" coords="1412,629,1551,656"/>
<area shape="rect" href="kvm__main_8c.html#a8e18df0287ddedfd516454aeeb669807" title=" " alt="" coords="1416,579,1547,605"/>
<area shape="rect" href="kvm__main_8c.html#a3de4d6991bdd1a714e8afa6a55136cdd" title=" " alt="" coords="1648,680,1824,707"/>
<area shape="rect" href="kvm__main_8c.html#afc3c9c56d305921c317259e18c9c8a59" title=" " alt="" coords="1376,731,1587,757"/>
<area shape="rect" href="kvm__main_8c.html#a22600b8a76a84f58d97f1a465293e63c" title=" " alt="" coords="1408,781,1555,808"/>
<area shape="rect" href="kvm__main_8c.html#aaa76576c021037e516218db81c147ca0" title=" " alt="" coords="1397,832,1566,859"/>
<area shape="rect" href="arm_8c.html#aa48cc7e76c49933c4fb44eda2ecec1ab" title=" " alt="" coords="1643,579,1829,605"/>
<area shape="rect" href="arm_8c.html#a6416d8550a44ef31c85f11d80d6efcc2" title=" " alt="" coords="1635,629,1837,656"/>
<area shape="rect" href="arm_8c.html#ac412fb0d81a53e66d8ac4146e4202f92" title=" " alt="" coords="1885,680,2073,707"/>
<area shape="rect" href="arch__timer_8c.html#a78e23e83bece8c269268f3a263fbb114" title=" " alt="" coords="1894,614,2065,655"/>
<area shape="rect" href="vgic_8c.html#a3059bfcee1ad30f581150d06c07d68e8" title=" " alt="" coords="2121,680,2328,707"/>
<area shape="rect" href="vgic-v2_8c.html#aa92110fc4f1e453fde0e8e720845854f" title=" " alt="" coords="1407,427,1556,453"/>
<area shape="rect" href="vgic-v3_8c.html#aa3f97179d90d3ed6a8920d1c57496380" title=" " alt="" coords="1407,477,1556,504"/>
<area shape="rect" href="vgic-v3-sr_8c.html#a4c7049da2b551848d3e39293c881f329" title=" " alt="" coords="1655,477,1817,504"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="1384,528,1579,555"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="1685,528,1787,555"/>
<area shape="rect" href="psci_8c.html#a340319ef6e70b6396954990199f5dfd2" title=" " alt="" coords="367,473,553,500"/>
<area shape="rect" href="psci_8c.html#a203f6ca47f969e84b5ce50a61f08e9ae" title=" " alt="" coords="360,524,560,551"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a3daa8000eb9717dde07d817c306b052b_icgraph.png" border="0" usemap="#apsci_8c_a3daa8000eb9717dde07d817c306b052b_icgraph" alt=""/></div>
<map name="apsci_8c_a3daa8000eb9717dde07d817c306b052b_icgraph" id="apsci_8c_a3daa8000eb9717dde07d817c306b052b_icgraph">
<area shape="rect" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="a3b9f15ff62c952f20de3ed44aaf4edbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b9f15ff62c952f20de3ed44aaf4edbc">&#9670;&nbsp;</a></span>kvm_psci_check_allowed_function()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned long kvm_psci_check_allowed_function </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>fn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00229">229</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;{</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">     * Prevent 32 bit guests from calling 64 bit PSCI functions.</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">if</span> ((fn &amp; PSCI_0_2_64BIT) &amp;&amp; vcpu_mode_is_32bit(vcpu))</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">return</span> PSCI_RET_NOT_SUPPORTED;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a3b9f15ff62c952f20de3ed44aaf4edbc_icgraph.png" border="0" usemap="#apsci_8c_a3b9f15ff62c952f20de3ed44aaf4edbc_icgraph" alt=""/></div>
<map name="apsci_8c_a3b9f15ff62c952f20de3ed44aaf4edbc_icgraph" id="apsci_8c_a3b9f15ff62c952f20de3ed44aaf4edbc_icgraph">
<area shape="rect" title=" " alt="" coords="741,23,928,65"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="a6fe2f9e365c9a9948351f718015ce651"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fe2f9e365c9a9948351f718015ce651">&#9670;&nbsp;</a></span>kvm_psci_narrow_to_32bit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_psci_narrow_to_32bit </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00217">217</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;{</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">     * Zero the input registers&#39; upper 32 bits. They will be fully</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">     * zeroed on exit, so we&#39;re fine changing them in place.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">for</span> (i = 1; i &lt; 4; i++)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        vcpu_set_reg(vcpu, i, lower_32_bits(vcpu_get_reg(vcpu, i)));</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a6fe2f9e365c9a9948351f718015ce651_icgraph.png" border="0" usemap="#apsci_8c_a6fe2f9e365c9a9948351f718015ce651_icgraph" alt=""/></div>
<map name="apsci_8c_a6fe2f9e365c9a9948351f718015ce651_icgraph" id="apsci_8c_a6fe2f9e365c9a9948351f718015ce651_icgraph">
<area shape="rect" title=" " alt="" coords="933,23,1089,65"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="741,56,885,83"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="a9119f27fea8a008787ddbc93e8b1bded"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9119f27fea8a008787ddbc93e8b1bded">&#9670;&nbsp;</a></span>kvm_psci_system_off()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_psci_system_off </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00192">192</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e">kvm_prepare_system_event</a>(vcpu, KVM_SYSTEM_EVENT_SHUTDOWN, 0);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
<div class="ttc" id="apsci_8c_html_a44cba757038eb3abdf93db5dc6c7ae3e"><div class="ttname"><a href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e">kvm_prepare_system_event</a></div><div class="ttdeci">static void kvm_prepare_system_event(struct kvm_vcpu *vcpu, u32 type, u64 flags)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00164">psci.c:164</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a9119f27fea8a008787ddbc93e8b1bded_cgraph.png" border="0" usemap="#apsci_8c_a9119f27fea8a008787ddbc93e8b1bded_cgraph" alt=""/></div>
<map name="apsci_8c_a9119f27fea8a008787ddbc93e8b1bded_cgraph" id="apsci_8c_a9119f27fea8a008787ddbc93e8b1bded_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,168,57"/>
<area shape="rect" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e" title=" " alt="" coords="216,23,379,65"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="427,31,637,57"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="685,23,896,65"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="955,5,1121,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="944,56,1132,83"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1229,5,1307,32"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1180,56,1356,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1191,107,1345,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a9119f27fea8a008787ddbc93e8b1bded_icgraph.png" border="0" usemap="#apsci_8c_a9119f27fea8a008787ddbc93e8b1bded_icgraph" alt=""/></div>
<map name="apsci_8c_a9119f27fea8a008787ddbc93e8b1bded_icgraph" id="apsci_8c_a9119f27fea8a008787ddbc93e8b1bded_icgraph">
<area shape="rect" title=" " alt="" coords="933,31,1096,57"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="741,31,885,57"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="ad8f7f33f1397e347a67599f67ac2f39c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8f7f33f1397e347a67599f67ac2f39c">&#9670;&nbsp;</a></span>kvm_psci_system_reset()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_psci_system_reset </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00197">197</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;{</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e">kvm_prepare_system_event</a>(vcpu, KVM_SYSTEM_EVENT_RESET, 0);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_ad8f7f33f1397e347a67599f67ac2f39c_cgraph.png" border="0" usemap="#apsci_8c_ad8f7f33f1397e347a67599f67ac2f39c_cgraph" alt=""/></div>
<map name="apsci_8c_ad8f7f33f1397e347a67599f67ac2f39c_cgraph" id="apsci_8c_ad8f7f33f1397e347a67599f67ac2f39c_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,184,57"/>
<area shape="rect" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e" title=" " alt="" coords="232,23,395,65"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="443,31,653,57"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="701,23,912,65"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="971,5,1137,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="960,56,1148,83"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1245,5,1323,32"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1196,56,1372,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1207,107,1361,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_ad8f7f33f1397e347a67599f67ac2f39c_icgraph.png" border="0" usemap="#apsci_8c_ad8f7f33f1397e347a67599f67ac2f39c_icgraph" alt=""/></div>
<map name="apsci_8c_ad8f7f33f1397e347a67599f67ac2f39c_icgraph" id="apsci_8c_ad8f7f33f1397e347a67599f67ac2f39c_icgraph">
<area shape="rect" title=" " alt="" coords="933,31,1112,57"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="741,31,885,57"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="a340319ef6e70b6396954990199f5dfd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a340319ef6e70b6396954990199f5dfd2">&#9670;&nbsp;</a></span>kvm_psci_system_reset2()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_psci_system_reset2 </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00202">202</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;{</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e">kvm_prepare_system_event</a>(vcpu, KVM_SYSTEM_EVENT_RESET,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                 KVM_SYSTEM_EVENT_RESET_FLAG_PSCI_RESET2);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a340319ef6e70b6396954990199f5dfd2_cgraph.png" border="0" usemap="#apsci_8c_a340319ef6e70b6396954990199f5dfd2_cgraph" alt=""/></div>
<map name="apsci_8c_a340319ef6e70b6396954990199f5dfd2_cgraph" id="apsci_8c_a340319ef6e70b6396954990199f5dfd2_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,192,57"/>
<area shape="rect" href="psci_8c.html#a44cba757038eb3abdf93db5dc6c7ae3e" title=" " alt="" coords="240,23,403,65"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="451,31,661,57"/>
<area shape="rect" href="kvm__main_8c.html#ac46e1a0e43c0784194a451a7e7394c02" title=" " alt="" coords="709,23,920,65"/>
<area shape="rect" href="kvm__main_8c.html#a56fa7dccf37545a9046522ded0354c7e" title=" " alt="" coords="979,5,1145,32"/>
<area shape="rect" href="kvm__main_8c.html#a90667c5619416298aea980ad51ec8525" title=" " alt="" coords="968,56,1156,83"/>
<area shape="rect" href="kvm__main_8c.html#a7682302871243c20a5dd16214655db15" title=" " alt="" coords="1253,5,1331,32"/>
<area shape="rect" href="kvm__main_8c.html#a9316cc70360fb39d920d5c76a2e41f35" title=" " alt="" coords="1204,56,1380,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1215,107,1369,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a340319ef6e70b6396954990199f5dfd2_icgraph.png" border="0" usemap="#apsci_8c_a340319ef6e70b6396954990199f5dfd2_icgraph" alt=""/></div>
<map name="apsci_8c_a340319ef6e70b6396954990199f5dfd2_icgraph" id="apsci_8c_a340319ef6e70b6396954990199f5dfd2_icgraph">
<area shape="rect" title=" " alt="" coords="741,31,928,57"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,31,693,57"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="a203f6ca47f969e84b5ce50a61f08e9ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a203f6ca47f969e84b5ce50a61f08e9ae">&#9670;&nbsp;</a></span>kvm_psci_system_suspend()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_psci_system_suspend </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00208">208</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;{</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keyword">struct </span>kvm_run *run = vcpu-&gt;run;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    memset(&amp;run-&gt;system_event, 0, <span class="keyword">sizeof</span>(vcpu-&gt;run-&gt;system_event));</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    run-&gt;system_event.type = KVM_SYSTEM_EVENT_SUSPEND;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    run-&gt;exit_reason = KVM_EXIT_SYSTEM_EVENT;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a203f6ca47f969e84b5ce50a61f08e9ae_icgraph.png" border="0" usemap="#apsci_8c_a203f6ca47f969e84b5ce50a61f08e9ae_icgraph" alt=""/></div>
<map name="apsci_8c_a203f6ca47f969e84b5ce50a61f08e9ae_icgraph" id="apsci_8c_a203f6ca47f969e84b5ce50a61f08e9ae_icgraph">
<area shape="rect" title=" " alt="" coords="741,31,941,57"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,31,693,57"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="ac9f7ca89512ea60ace6ea961a60354a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9f7ca89512ea60ace6ea961a60354a4">&#9670;&nbsp;</a></span>kvm_psci_valid_affinity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_psci_valid_affinity </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>affinity</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00054">54</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">return</span> !(affinity &amp; ~MPIDR_HWID_BITMASK);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_ac9f7ca89512ea60ace6ea961a60354a4_icgraph.png" border="0" usemap="#apsci_8c_ac9f7ca89512ea60ace6ea961a60354a4_icgraph" alt=""/></div>
<map name="apsci_8c_ac9f7ca89512ea60ace6ea961a60354a4_icgraph" id="apsci_8c_ac9f7ca89512ea60ace6ea961a60354a4_icgraph">
<area shape="rect" title=" " alt="" coords="1188,81,1364,108"/>
<area shape="rect" href="psci_8c.html#afd3d020adc6118dbd290a2770d897439" title=" " alt="" coords="933,56,1140,83"/>
<area shape="rect" href="psci_8c.html#a092eeee0e7b54c50ebc3d0cf66ea8ef5" title=" " alt="" coords="964,107,1109,133"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="741,56,885,83"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,56,501,83"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,56,339,83"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,31,103,57"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,81,105,108"/>
<area shape="rect" href="psci_8c.html#af18cf22560595f1da5e34ea244b0b51b" title=" " alt="" coords="549,107,693,133"/>
</map>
</div>

</div>
</div>
<a id="afd3d020adc6118dbd290a2770d897439"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd3d020adc6118dbd290a2770d897439">&#9670;&nbsp;</a></span>kvm_psci_vcpu_affinity_info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned long kvm_psci_vcpu_affinity_info </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00121">121</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">int</span> matching_cpus = 0;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i, mpidr;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> target_affinity;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> target_affinity_mask;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lowest_affinity_level;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *tmp;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    target_affinity = smccc_get_arg1(vcpu);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    lowest_affinity_level = smccc_get_arg2(vcpu);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4">kvm_psci_valid_affinity</a>(vcpu, target_affinity))</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">return</span> PSCI_RET_INVALID_PARAMS;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">/* Determine target affinity mask */</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    target_affinity_mask = <a class="code" href="psci_8c.html#aa30b461609a71770efab6a5045274e5e">psci_affinity_mask</a>(lowest_affinity_level);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">if</span> (!target_affinity_mask)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">return</span> PSCI_RET_INVALID_PARAMS;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">/* Ignore other bits of target affinity */</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    target_affinity &amp;= target_affinity_mask;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">     * If one or more VCPU matching target affinity are running</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">     * then ON else OFF</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    kvm_for_each_vcpu(i, tmp, kvm) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        mpidr = kvm_vcpu_get_mpidr_aff(tmp);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">if</span> ((mpidr &amp; target_affinity_mask) == target_affinity) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            matching_cpus++;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a">kvm_arm_vcpu_stopped</a>(tmp))</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                <span class="keywordflow">return</span> PSCI_0_2_AFFINITY_LEVEL_ON;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (!matching_cpus)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">return</span> PSCI_RET_INVALID_PARAMS;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">return</span> PSCI_0_2_AFFINITY_LEVEL_OFF;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div>
<div class="ttc" id="aarm_8c_html_a371c5c68ee659e4815a4af50d0161c8a"><div class="ttname"><a href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a">kvm_arm_vcpu_stopped</a></div><div class="ttdeci">bool kvm_arm_vcpu_stopped(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="arm_8c_source.html#l00501">arm.c:501</a></div></div>
<div class="ttc" id="apsci_8c_html_aa30b461609a71770efab6a5045274e5e"><div class="ttname"><a href="psci_8c.html#aa30b461609a71770efab6a5045274e5e">psci_affinity_mask</a></div><div class="ttdeci">static unsigned long psci_affinity_mask(unsigned long affinity_level)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00026">psci.c:26</a></div></div>
<div class="ttc" id="apsci_8c_html_ac9f7ca89512ea60ace6ea961a60354a4"><div class="ttname"><a href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4">kvm_psci_valid_affinity</a></div><div class="ttdeci">static bool kvm_psci_valid_affinity(struct kvm_vcpu *vcpu, unsigned long affinity)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00054">psci.c:54</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_afd3d020adc6118dbd290a2770d897439_cgraph.png" border="0" usemap="#apsci_8c_afd3d020adc6118dbd290a2770d897439_cgraph" alt=""/></div>
<map name="apsci_8c_afd3d020adc6118dbd290a2770d897439_cgraph" id="apsci_8c_afd3d020adc6118dbd290a2770d897439_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,212,83"/>
<area shape="rect" href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a" title=" " alt="" coords="260,5,441,32"/>
<area shape="rect" href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4" title=" " alt="" coords="263,56,439,83"/>
<area shape="rect" href="psci_8c.html#aa30b461609a71770efab6a5045274e5e" title=" " alt="" coords="279,107,423,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_afd3d020adc6118dbd290a2770d897439_icgraph.png" border="0" usemap="#apsci_8c_afd3d020adc6118dbd290a2770d897439_icgraph" alt=""/></div>
<map name="apsci_8c_afd3d020adc6118dbd290a2770d897439_icgraph" id="apsci_8c_afd3d020adc6118dbd290a2770d897439_icgraph">
<area shape="rect" title=" " alt="" coords="933,31,1140,57"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="741,31,885,57"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="a092eeee0e7b54c50ebc3d0cf66ea8ef5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a092eeee0e7b54c50ebc3d0cf66ea8ef5">&#9670;&nbsp;</a></span>kvm_psci_vcpu_on()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned long kvm_psci_vcpu_on </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>source_vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00060">60</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;{</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keyword">struct </span>vcpu_reset_state *reset_state;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keyword">struct </span>kvm *kvm = source_vcpu-&gt;kvm;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = NULL;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">int</span> ret = PSCI_RET_SUCCESS;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cpu_id;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    cpu_id = smccc_get_arg1(source_vcpu);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4">kvm_psci_valid_affinity</a>(source_vcpu, cpu_id))</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">return</span> PSCI_RET_INVALID_PARAMS;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    vcpu = <a class="code" href="arm_8c.html#a0be215e1642483c65818bd994b13a421">kvm_mpidr_to_vcpu</a>(kvm, cpu_id);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">     * Make sure the caller requested a valid CPU and that the CPU is</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">     * turned off.</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span> (!vcpu)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">return</span> PSCI_RET_INVALID_PARAMS;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    spin_lock(&amp;vcpu-&gt;arch.mp_state_lock);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a">kvm_arm_vcpu_stopped</a>(vcpu)) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">if</span> (kvm_psci_version(source_vcpu) != KVM_ARM_PSCI_0_1)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            ret = PSCI_RET_ALREADY_ON;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            ret = PSCI_RET_INVALID_PARAMS;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    reset_state = &amp;vcpu-&gt;arch.reset_state;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    reset_state-&gt;pc = smccc_get_arg2(source_vcpu);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">/* Propagate caller endianness */</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    reset_state-&gt;be = kvm_vcpu_is_be(source_vcpu);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">     * NOTE: We always update r0 (or x0) because for PSCI v0.1</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">     * the general purpose registers are undefined upon CPU_ON.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    reset_state-&gt;r0 = smccc_get_arg3(source_vcpu);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    reset_state-&gt;reset = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    kvm_make_request(KVM_REQ_VCPU_RESET, vcpu);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">     * Make sure the reset request is observed if the RUNNABLE mp_state is</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">     * observed.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    smp_wmb();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    WRITE_ONCE(vcpu-&gt;arch.mp_state.mp_state, KVM_MP_STATE_RUNNABLE);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5">kvm_vcpu_wake_up</a>(vcpu);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;out_unlock:</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    spin_unlock(&amp;vcpu-&gt;arch.mp_state_lock);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div>
<div class="ttc" id="aarm_8c_html_a0be215e1642483c65818bd994b13a421"><div class="ttname"><a href="arm_8c.html#a0be215e1642483c65818bd994b13a421">kvm_mpidr_to_vcpu</a></div><div class="ttdeci">struct kvm_vcpu * kvm_mpidr_to_vcpu(struct kvm *kvm, unsigned long mpidr)</div><div class="ttdef"><b>Definition:</b> <a href="arm_8c_source.html#l02460">arm.c:2460</a></div></div>
<div class="ttc" id="akvm__main_8c_html_ad9f0140eebcdef9a9ebae54431d2fba5"><div class="ttname"><a href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5">kvm_vcpu_wake_up</a></div><div class="ttdeci">bool kvm_vcpu_wake_up(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03915">kvm_main.c:3915</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a092eeee0e7b54c50ebc3d0cf66ea8ef5_cgraph.png" border="0" usemap="#apsci_8c_a092eeee0e7b54c50ebc3d0cf66ea8ef5_cgraph" alt=""/></div>
<map name="apsci_8c_a092eeee0e7b54c50ebc3d0cf66ea8ef5_cgraph" id="apsci_8c_a092eeee0e7b54c50ebc3d0cf66ea8ef5_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,151,108"/>
<area shape="rect" href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a" title=" " alt="" coords="199,5,380,32"/>
<area shape="rect" href="arm_8c.html#a0be215e1642483c65818bd994b13a421" title=" " alt="" coords="212,56,367,83"/>
<area shape="rect" href="psci_8c.html#ac9f7ca89512ea60ace6ea961a60354a4" title=" " alt="" coords="201,107,377,133"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="213,157,366,184"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_a092eeee0e7b54c50ebc3d0cf66ea8ef5_icgraph.png" border="0" usemap="#apsci_8c_a092eeee0e7b54c50ebc3d0cf66ea8ef5_icgraph" alt=""/></div>
<map name="apsci_8c_a092eeee0e7b54c50ebc3d0cf66ea8ef5_icgraph" id="apsci_8c_a092eeee0e7b54c50ebc3d0cf66ea8ef5_icgraph">
<area shape="rect" title=" " alt="" coords="933,31,1079,57"/>
<area shape="rect" href="psci_8c.html#af18cf22560595f1da5e34ea244b0b51b" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="741,56,885,83"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,56,501,83"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,56,339,83"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,31,103,57"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,81,105,108"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,107,693,133"/>
</map>
</div>

</div>
</div>
<a id="abe7d85200e79143f87dab785a204fb3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe7d85200e79143f87dab785a204fb3a">&#9670;&nbsp;</a></span>kvm_psci_vcpu_suspend()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned long kvm_psci_vcpu_suspend </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00034">34</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">     * NOTE: For simplicity, we make VCPU suspend emulation to be</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">     * same-as WFI (Wait-for-interrupt) emulation.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">     * This means for KVM the wakeup events are interrupts and</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">     * this is consistent with intended use of StateID as described</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">     * in section 5.4.1 of PSCI v0.2 specification (ARM DEN 0022A).</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">     * Further, we also treat power-down request to be same as</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">     * stand-by request as-per section 5.4.2 clause 3 of PSCI v0.2</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">     * specification (ARM DEN 0022A). This means all suspend states</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">     * for KVM will preserve the register state.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="arm_8c.html#a68df8c6f1b7134e9f23857f092d50056">kvm_vcpu_wfi</a>(vcpu);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">return</span> PSCI_RET_SUCCESS;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="ttc" id="aarm_8c_html_a68df8c6f1b7134e9f23857f092d50056"><div class="ttname"><a href="arm_8c.html#a68df8c6f1b7134e9f23857f092d50056">kvm_vcpu_wfi</a></div><div class="ttdeci">void kvm_vcpu_wfi(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="arm_8c_source.html#l00769">arm.c:769</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_abe7d85200e79143f87dab785a204fb3a_cgraph.png" border="0" usemap="#apsci_8c_abe7d85200e79143f87dab785a204fb3a_cgraph" alt=""/></div>
<map name="apsci_8c_abe7d85200e79143f87dab785a204fb3a_cgraph" id="apsci_8c_abe7d85200e79143f87dab785a204fb3a_cgraph">
<area shape="rect" title=" " alt="" coords="5,335,188,361"/>
<area shape="rect" href="arm_8c.html#a68df8c6f1b7134e9f23857f092d50056" title=" " alt="" coords="236,335,351,361"/>
<area shape="rect" href="kvm__main_8c.html#a7256a8615584a9ae83a46c071f6aa0e9" title=" " alt="" coords="419,157,541,184"/>
<area shape="rect" href="vgic_8c.html#a751661541b39c02532a54736db22a929" title=" " alt="" coords="399,309,561,336"/>
<area shape="rect" href="vgic-v4_8c.html#ac2966fbf90610bb8a0525cbd903f7477" title=" " alt="" coords="427,360,533,387"/>
<area shape="rect" href="vgic-v4_8c.html#aeafcb3e6b67ea32ed8e59d009252e565" title=" " alt="" coords="430,411,530,437"/>
<area shape="rect" href="kvm__main_8c.html#a1045a615093ccd8e87dcd6f6a0e03e9e" title=" " alt="" coords="645,5,784,32"/>
<area shape="rect" href="kvm__main_8c.html#a8e18df0287ddedfd516454aeeb669807" title=" " alt="" coords="649,56,780,83"/>
<area shape="rect" href="kvm__main_8c.html#a3de4d6991bdd1a714e8afa6a55136cdd" title=" " alt="" coords="881,107,1057,133"/>
<area shape="rect" href="kvm__main_8c.html#afc3c9c56d305921c317259e18c9c8a59" title=" " alt="" coords="609,157,820,184"/>
<area shape="rect" href="kvm__main_8c.html#a22600b8a76a84f58d97f1a465293e63c" title=" " alt="" coords="641,208,788,235"/>
<area shape="rect" href="kvm__main_8c.html#aaa76576c021037e516218db81c147ca0" title=" " alt="" coords="630,259,799,285"/>
<area shape="rect" href="arm_8c.html#aa48cc7e76c49933c4fb44eda2ecec1ab" title=" " alt="" coords="876,5,1063,32"/>
<area shape="rect" href="arm_8c.html#a6416d8550a44ef31c85f11d80d6efcc2" title=" " alt="" coords="868,56,1071,83"/>
<area shape="rect" href="arm_8c.html#ac412fb0d81a53e66d8ac4146e4202f92" title=" " alt="" coords="1119,77,1307,104"/>
<area shape="rect" href="arch__timer_8c.html#a78e23e83bece8c269268f3a263fbb114" title=" " alt="" coords="1127,129,1298,170"/>
<area shape="rect" href="arm_8c.html#a371c5c68ee659e4815a4af50d0161c8a" title=" " alt="" coords="1367,28,1549,55"/>
<area shape="rect" href="vgic_8c.html#a3059bfcee1ad30f581150d06c07d68e8" title=" " alt="" coords="1355,79,1561,105"/>
<area shape="rect" href="vgic_8h.html#a1109d873011f89a4acb4fd461f9f0a45" title=" " alt="" coords="1637,53,1753,80"/>
<area shape="rect" href="vgic-mmio_8c.html#ad275c2ef6d5f7f0d79f101a7dd6dda3a" title=" " alt="" coords="1636,104,1753,131"/>
<area shape="rect" href="vgic-v2_8c.html#aa825011d5b7d02e6b8f6c21746a5af39" title=" " alt="" coords="1841,60,1981,87"/>
<area shape="rect" href="vgic-v3_8c.html#a20f69ea757569fa58158ed4f097c1987" title=" " alt="" coords="1841,111,1981,137"/>
<area shape="rect" href="arch__timer_8c.html#ad210f5f7b0361777290f8b36f023a518" title=" " alt="" coords="1377,133,1539,160"/>
<area shape="rect" href="arch__timer_8c.html#a9d0120f96e99b20be8023dad5c6a7f0b" title=" " alt="" coords="1403,184,1513,211"/>
<area shape="rect" href="arch__timer_8c.html#a6c290bf8212ea1388cdb4a839eae7228" title=" " alt="" coords="1609,177,1780,218"/>
<area shape="rect" href="arch__timer_8c.html#ac9f7917175f1d6031a77dcbc82f9ee98" title=" " alt="" coords="1828,176,1995,203"/>
<area shape="rect" href="arch__timer_8c.html#a7f5f777b74b5c9ec6e13d4f7576d7f43" title=" " alt="" coords="1847,227,1976,253"/>
<area shape="rect" href="vgic-v2_8c.html#aa92110fc4f1e453fde0e8e720845854f" title=" " alt="" coords="640,309,789,336"/>
<area shape="rect" href="vgic-v3_8c.html#aa3f97179d90d3ed6a8920d1c57496380" title=" " alt="" coords="640,360,789,387"/>
<area shape="rect" href="vgic-v3-sr_8c.html#a4c7049da2b551848d3e39293c881f329" title=" " alt="" coords="888,360,1051,387"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="617,411,812,437"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="918,411,1021,437"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_abe7d85200e79143f87dab785a204fb3a_icgraph.png" border="0" usemap="#apsci_8c_abe7d85200e79143f87dab785a204fb3a_icgraph" alt=""/></div>
<map name="apsci_8c_abe7d85200e79143f87dab785a204fb3a_icgraph" id="apsci_8c_abe7d85200e79143f87dab785a204fb3a_icgraph">
<area shape="rect" title=" " alt="" coords="933,31,1116,57"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="741,31,885,57"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
<a id="aa30b461609a71770efab6a5045274e5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa30b461609a71770efab6a5045274e5e">&#9670;&nbsp;</a></span>psci_affinity_mask()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned long psci_affinity_mask </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>affinity_level</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="psci_8c_source.html#l00026">26</a> of file <a class="el" href="psci_8c_source.html">psci.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;{</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">if</span> (affinity_level &lt;= 3)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="keywordflow">return</span> MPIDR_HWID_BITMASK &amp; <a class="code" href="psci_8c.html#aaf112f9f63f065f3256018232aec6574">AFFINITY_MASK</a>(affinity_level);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;}</div>
<div class="ttc" id="apsci_8c_html_aaf112f9f63f065f3256018232aec6574"><div class="ttname"><a href="psci_8c.html#aaf112f9f63f065f3256018232aec6574">AFFINITY_MASK</a></div><div class="ttdeci">#define AFFINITY_MASK(level)</div><div class="ttdef"><b>Definition:</b> <a href="psci_8c_source.html#l00024">psci.c:24</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="psci_8c_aa30b461609a71770efab6a5045274e5e_icgraph.png" border="0" usemap="#apsci_8c_aa30b461609a71770efab6a5045274e5e_icgraph" alt=""/></div>
<map name="apsci_8c_aa30b461609a71770efab6a5045274e5e_icgraph" id="apsci_8c_aa30b461609a71770efab6a5045274e5e_icgraph">
<area shape="rect" title=" " alt="" coords="1188,31,1332,57"/>
<area shape="rect" href="psci_8c.html#afd3d020adc6118dbd290a2770d897439" title=" " alt="" coords="933,31,1140,57"/>
<area shape="rect" href="psci_8c.html#ac7522f6e0d1805f44a3e932397de4582" title=" " alt="" coords="741,31,885,57"/>
<area shape="rect" href="psci_8c.html#a8f59d47a1b54f561b8c42f509798142e" title=" " alt="" coords="549,5,693,32"/>
<area shape="rect" href="psci_8c.html#a3daa8000eb9717dde07d817c306b052b" title=" " alt="" coords="387,31,501,57"/>
<area shape="rect" href="hypercalls_8c.html#a62d0b161cae45d4a2f865203301f7ac4" title=" " alt="" coords="153,31,339,57"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="7,5,103,32"/>
<area shape="rect" href="handle__exit_8c.html#ad2545fb9f7329ef0604715b9af4a1746" title=" " alt="" coords="5,56,105,83"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
