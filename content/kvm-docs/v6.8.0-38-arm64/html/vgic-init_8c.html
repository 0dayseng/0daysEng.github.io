<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/arm64/kvm/vgic/vgic-init.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_67a9e021ce8db5d46236c6154ee454bc.html">arm64</a></li><li class="navelem"><a class="el" href="dir_42f87ef63ac4150166bf7887f68288e2.html">kvm</a></li><li class="navelem"><a class="el" href="dir_3eb4584ecab9fce570ac1ce102ccba9b.html">vgic</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">vgic-init.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/uaccess.h&gt;</code><br />
<code>#include &lt;linux/interrupt.h&gt;</code><br />
<code>#include &lt;linux/cpu.h&gt;</code><br />
<code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &lt;kvm/arm_vgic.h&gt;</code><br />
<code>#include &lt;asm/kvm_emulate.h&gt;</code><br />
<code>#include &lt;asm/kvm_mmu.h&gt;</code><br />
<code>#include &quot;<a class="el" href="vgic_8h_source.html">vgic.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for vgic-init.c:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c__incl.png" border="0" usemap="#aarch_2arm64_2kvm_2vgic_2vgic-init_8c" alt=""/></div>
<map name="aarch_2arm64_2kvm_2vgic_2vgic-init_8c" id="aarch_2arm64_2kvm_2vgic_2vgic-init_8c">
<area shape="rect" title=" " alt="" coords="487,5,647,47"/>
<area shape="rect" title=" " alt="" coords="5,95,128,121"/>
<area shape="rect" title=" " alt="" coords="153,95,279,121"/>
<area shape="rect" title=" " alt="" coords="304,95,397,121"/>
<area shape="rect" title=" " alt="" coords="422,95,557,121"/>
<area shape="rect" title=" " alt="" coords="581,95,707,121"/>
<area shape="rect" title=" " alt="" coords="731,95,887,121"/>
<area shape="rect" title=" " alt="" coords="857,177,993,203"/>
<area shape="rect" href="vgic_8h.html" title=" " alt="" coords="963,95,1024,121"/>
<area shape="rect" title=" " alt="" coords="1018,169,1174,211"/>
</map>
</div>
</div>
<p><a href="vgic-init_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab923d47040c4f3c9e6cae619d7abf78a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#ab923d47040c4f3c9e6cae619d7abf78a">kvm_vgic_early_init</a> (struct kvm *kvm)</td></tr>
<tr class="separator:ab923d47040c4f3c9e6cae619d7abf78a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ce1b5a14cd479b726e5451691380615"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a4ce1b5a14cd479b726e5451691380615">kvm_vgic_create</a> (struct kvm *kvm, u32 type)</td></tr>
<tr class="separator:a4ce1b5a14cd479b726e5451691380615"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f9be5cc88c88f6c0180c53b72818d3b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b">kvm_vgic_dist_init</a> (struct kvm *kvm, unsigned int nr_spis)</td></tr>
<tr class="separator:a0f9be5cc88c88f6c0180c53b72818d3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad052e8c724bfbb39c34281df23166a28"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#ad052e8c724bfbb39c34281df23166a28">kvm_vgic_vcpu_init</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ad052e8c724bfbb39c34281df23166a28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2eee0060a3bdcd2a9e8fe1451a3a3fc2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a2eee0060a3bdcd2a9e8fe1451a3a3fc2">kvm_vgic_vcpu_enable</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a2eee0060a3bdcd2a9e8fe1451a3a3fc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39a12fe5ed5534efda33bb215a320a57"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57">vgic_init</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a39a12fe5ed5534efda33bb215a320a57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a814da4f59c826266ad54a8b5aa870de6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a814da4f59c826266ad54a8b5aa870de6">kvm_vgic_dist_destroy</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a814da4f59c826266ad54a8b5aa870de6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1002af084b5fbafca1dab97541383180"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a1002af084b5fbafca1dab97541383180">__kvm_vgic_vcpu_destroy</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a1002af084b5fbafca1dab97541383180"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05d84155ac79f812932547367b4445e4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a05d84155ac79f812932547367b4445e4">kvm_vgic_vcpu_destroy</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a05d84155ac79f812932547367b4445e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af08e0c3b0309dbe4472ed185cd2b9e72"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#af08e0c3b0309dbe4472ed185cd2b9e72">kvm_vgic_destroy</a> (struct kvm *kvm)</td></tr>
<tr class="separator:af08e0c3b0309dbe4472ed185cd2b9e72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c860e1d043352d9a02f4780b58e5af6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a3c860e1d043352d9a02f4780b58e5af6">vgic_lazy_init</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a3c860e1d043352d9a02f4780b58e5af6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8411f235847aa56055a7a2fefce226c6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a8411f235847aa56055a7a2fefce226c6">kvm_vgic_map_resources</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a8411f235847aa56055a7a2fefce226c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a575388855c33993ba44e8e4bd2511fb6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a575388855c33993ba44e8e4bd2511fb6">kvm_vgic_cpu_up</a> (void)</td></tr>
<tr class="separator:a575388855c33993ba44e8e4bd2511fb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17cbfdbbcbf19c731724a5e5cb9583d8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a17cbfdbbcbf19c731724a5e5cb9583d8">kvm_vgic_cpu_down</a> (void)</td></tr>
<tr class="separator:a17cbfdbbcbf19c731724a5e5cb9583d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a489028c2499bdfbe87388b96a832b3ed"><td class="memItemLeft" align="right" valign="top">static irqreturn_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a489028c2499bdfbe87388b96a832b3ed">vgic_maintenance_handler</a> (int irq, void *data)</td></tr>
<tr class="separator:a489028c2499bdfbe87388b96a832b3ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad99fad0e2a61f21741f0277c7a84b8bc"><td class="memItemLeft" align="right" valign="top">void __init&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#ad99fad0e2a61f21741f0277c7a84b8bc">vgic_set_kvm_info</a> (const struct <a class="el" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a> *info)</td></tr>
<tr class="separator:ad99fad0e2a61f21741f0277c7a84b8bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefd1e0e9cd080919b043406251dfa0b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#aefd1e0e9cd080919b043406251dfa0b8">kvm_vgic_init_cpu_hardware</a> (void)</td></tr>
<tr class="separator:aefd1e0e9cd080919b043406251dfa0b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba3547aa220ca50b1eabca1a39c92943"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#aba3547aa220ca50b1eabca1a39c92943">kvm_vgic_hyp_init</a> (void)</td></tr>
<tr class="separator:aba3547aa220ca50b1eabca1a39c92943"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a7b7c49d17fa603aa8433b0d402f9efe1"><td class="memItemLeft" align="right" valign="top">static struct gic_kvm_info *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a></td></tr>
<tr class="separator:a7b7c49d17fa603aa8433b0d402f9efe1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a1002af084b5fbafca1dab97541383180"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1002af084b5fbafca1dab97541383180">&#9670;&nbsp;</a></span>__kvm_vgic_vcpu_destroy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __kvm_vgic_vcpu_destroy </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00371">371</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;{</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keyword">struct </span>vgic_cpu *vgic_cpu = &amp;vcpu-&gt;arch.vgic_cpu;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">     * Retire all pending LPIs on this vcpu anyway as we&#39;re</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">     * going to destroy it.</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <a class="code" href="vgic_8c.html#a573eb768a56ea0b73e234771e0013ffc">vgic_flush_pending_lpis</a>(vcpu);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    INIT_LIST_HEAD(&amp;vgic_cpu-&gt;ap_list_head);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (vcpu-&gt;kvm-&gt;arch.vgic.vgic_model == KVM_DEV_TYPE_ARM_VGIC_V3) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <a class="code" href="vgic-mmio-v3_8c.html#a4bfec769cd9fe2bddb14200a6147fccd">vgic_unregister_redist_iodev</a>(vcpu);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        vgic_cpu-&gt;rd_iodev.base_addr = <a class="code" href="vgic_8h.html#ac91699b3ab8faf4d5222d998fb64b033">VGIC_ADDR_UNDEF</a>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div>
<div class="ttc" id="avgic-mmio-v3_8c_html_a4bfec769cd9fe2bddb14200a6147fccd"><div class="ttname"><a href="vgic-mmio-v3_8c.html#a4bfec769cd9fe2bddb14200a6147fccd">vgic_unregister_redist_iodev</a></div><div class="ttdeci">void vgic_unregister_redist_iodev(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-mmio-v3_8c_source.html#l00805">vgic-mmio-v3.c:805</a></div></div>
<div class="ttc" id="avgic_8c_html_a573eb768a56ea0b73e234771e0013ffc"><div class="ttname"><a href="vgic_8c.html#a573eb768a56ea0b73e234771e0013ffc">vgic_flush_pending_lpis</a></div><div class="ttdeci">void vgic_flush_pending_lpis(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vgic_8c_source.html#l00152">vgic.c:152</a></div></div>
<div class="ttc" id="avgic_8h_html_ac91699b3ab8faf4d5222d998fb64b033"><div class="ttname"><a href="vgic_8h.html#ac91699b3ab8faf4d5222d998fb64b033">VGIC_ADDR_UNDEF</a></div><div class="ttdeci">#define VGIC_ADDR_UNDEF</div><div class="ttdef"><b>Definition:</b> <a href="vgic_8h_source.html#l00014">vgic.h:14</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a1002af084b5fbafca1dab97541383180_cgraph.png" border="0" usemap="#avgic-init_8c_a1002af084b5fbafca1dab97541383180_cgraph" alt=""/></div>
<map name="avgic-init_8c_a1002af084b5fbafca1dab97541383180_cgraph" id="avgic-init_8c_a1002af084b5fbafca1dab97541383180_cgraph">
<area shape="rect" title=" " alt="" coords="5,35,199,61"/>
<area shape="rect" href="vgic_8c.html#a573eb768a56ea0b73e234771e0013ffc" title=" " alt="" coords="247,5,423,32"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a4bfec769cd9fe2bddb14200a6147fccd" title=" " alt="" coords="251,57,418,98"/>
<area shape="rect" href="vgic_8c.html#ac055f2fa0d463d3d287ee975bb80a9c5" title=" " alt="" coords="522,5,623,32"/>
<area shape="rect" href="vgic_8c.html#affa1a20a5bd9d67dc546c1ccaace3406" title=" " alt="" coords="723,5,885,32"/>
<area shape="rect" href="vgic_8c.html#a7d513558f0ea4ecbc012c98b3522f797" title=" " alt="" coords="963,5,1091,32"/>
<area shape="rect" href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897" title=" " alt="" coords="471,64,675,91"/>
<area shape="rect" href="kvm__main_8c.html#a3089edf2c0e5790aab7e8ed723f34b5b" title=" " alt="" coords="726,56,882,83"/>
<area shape="rect" href="kvm__main_8c.html#aa6d7dea09a0b657f29e92f424e5d0633" title=" " alt="" coords="933,81,1120,108"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a1002af084b5fbafca1dab97541383180_icgraph.png" border="0" usemap="#avgic-init_8c_a1002af084b5fbafca1dab97541383180_icgraph" alt=""/></div>
<map name="avgic-init_8c_a1002af084b5fbafca1dab97541383180_icgraph" id="avgic-init_8c_a1002af084b5fbafca1dab97541383180_icgraph">
<area shape="rect" title=" " alt="" coords="1943,85,2136,112"/>
<area shape="rect" href="vgic-init_8c.html#af08e0c3b0309dbe4472ed185cd2b9e72" title=" " alt="" coords="1735,56,1876,83"/>
<area shape="rect" href="vgic-init_8c.html#a05d84155ac79f812932547367b4445e4" title=" " alt="" coords="1716,111,1895,137"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="811,56,981,83"/>
<area shape="rect" href="vgic-init_8c.html#a8411f235847aa56055a7a2fefce226c6" title=" " alt="" coords="1477,56,1668,83"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="453,19,580,45"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="628,81,763,108"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,5,405,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="459,81,574,108"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,56,383,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,107,391,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,157,386,184"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,208,376,235"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,56,164,83"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="1240,49,1419,90"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="1043,56,1167,83"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1483,115,1663,141"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1257,115,1402,141"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1229,165,1429,192"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1029,111,1181,137"/>
</map>
</div>

</div>
</div>
<a id="a17cbfdbbcbf19c731724a5e5cb9583d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17cbfdbbcbf19c731724a5e5cb9583d8">&#9670;&nbsp;</a></span>kvm_vgic_cpu_down()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_vgic_cpu_down </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00513">513</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;{</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    disable_percpu_irq(kvm_vgic_global_state.maint_irq);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a17cbfdbbcbf19c731724a5e5cb9583d8_icgraph.png" border="0" usemap="#avgic-init_8c_a17cbfdbbcbf19c731724a5e5cb9583d8_icgraph" alt=""/></div>
<map name="avgic-init_8c_a17cbfdbbcbf19c731724a5e5cb9583d8_icgraph" id="avgic-init_8c_a17cbfdbbcbf19c731724a5e5cb9583d8_icgraph">
<area shape="rect" title=" " alt="" coords="261,5,419,32"/>
<area shape="rect" href="arm_8c.html#ad6968510b101877130dc9494f5dc4d4b" title=" " alt="" coords="5,5,213,32"/>
</map>
</div>

</div>
</div>
<a id="a575388855c33993ba44e8e4bd2511fb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a575388855c33993ba44e8e4bd2511fb6">&#9670;&nbsp;</a></span>kvm_vgic_cpu_up()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_vgic_cpu_up </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00507">507</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;{</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    enable_percpu_irq(kvm_vgic_global_state.maint_irq, 0);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a575388855c33993ba44e8e4bd2511fb6_icgraph.png" border="0" usemap="#avgic-init_8c_a575388855c33993ba44e8e4bd2511fb6_icgraph" alt=""/></div>
<map name="avgic-init_8c_a575388855c33993ba44e8e4bd2511fb6_icgraph" id="avgic-init_8c_a575388855c33993ba44e8e4bd2511fb6_icgraph">
<area shape="rect" title=" " alt="" coords="259,5,397,32"/>
<area shape="rect" href="arm_8c.html#ac1582780a8801f86aa06da8b95cbcfe9" title=" " alt="" coords="5,5,211,32"/>
</map>
</div>

</div>
</div>
<a id="a4ce1b5a14cd479b726e5451691380615"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ce1b5a14cd479b726e5451691380615">&#9670;&nbsp;</a></span>kvm_vgic_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_vgic_create </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_vgic_create: triggered by the instantiation of the VGIC device by user space, either through the legacy KVM_CREATE_IRQCHIP ioctl (v2 only) or through the generic KVM_CREATE_DEVICE API ioctl. irqchip_in_kernel() tells you if this function succeeded or not. @kvm: kvm struct pointer @type: KVM_DEV_TYPE_ARM_VGIC_V[23] </p>

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00071">71</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;{</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">     * This function is also called by the KVM_CREATE_IRQCHIP handler,</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">     * which had no chance yet to check the availability of the GICv2</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">     * emulation. So check this here again. KVM_CREATE_DEVICE does</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">     * the proper checks already.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (type == KVM_DEV_TYPE_ARM_VGIC_V2 &amp;&amp;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        !kvm_vgic_global_state.can_emulate_gicv2)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">return</span> -ENODEV;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">/* Must be held to avoid race with vCPU creation */</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    lockdep_assert_held(&amp;kvm-&gt;lock);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    ret = -EBUSY;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="arm_8c.html#a02feef111fec875eb6382835eb2fb620">lock_all_vcpus</a>(kvm))</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">if</span> (irqchip_in_kernel(kvm)) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        ret = -EEXIST;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    kvm_for_each_vcpu(i, vcpu, kvm) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">if</span> (vcpu_has_run_once(vcpu))</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    ret = 0;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">if</span> (type == KVM_DEV_TYPE_ARM_VGIC_V2)</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        kvm-&gt;max_vcpus = VGIC_V2_MAX_CPUS;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        kvm-&gt;max_vcpus = VGIC_V3_MAX_CPUS;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">if</span> (atomic_read(&amp;kvm-&gt;online_vcpus) &gt; kvm-&gt;max_vcpus) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        ret = -E2BIG;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    kvm-&gt;arch.vgic.in_kernel = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    kvm-&gt;arch.vgic.vgic_model = type;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    kvm-&gt;arch.vgic.vgic_dist_base = <a class="code" href="vgic_8h.html#ac91699b3ab8faf4d5222d998fb64b033">VGIC_ADDR_UNDEF</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">if</span> (type == KVM_DEV_TYPE_ARM_VGIC_V2)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        kvm-&gt;arch.vgic.vgic_cpu_base = <a class="code" href="vgic_8h.html#ac91699b3ab8faf4d5222d998fb64b033">VGIC_ADDR_UNDEF</a>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        INIT_LIST_HEAD(&amp;kvm-&gt;arch.vgic.rd_regions);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;out_unlock:</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="arm_8c.html#a29e56a77bf87bcd1b20ed8a14d9b2778">unlock_all_vcpus</a>(kvm);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div>
<div class="ttc" id="aarm_8c_html_a02feef111fec875eb6382835eb2fb620"><div class="ttname"><a href="arm_8c.html#a02feef111fec875eb6382835eb2fb620">lock_all_vcpus</a></div><div class="ttdeci">bool lock_all_vcpus(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="arm_8c_source.html#l01773">arm.c:1773</a></div></div>
<div class="ttc" id="aarm_8c_html_a29e56a77bf87bcd1b20ed8a14d9b2778"><div class="ttname"><a href="arm_8c.html#a29e56a77bf87bcd1b20ed8a14d9b2778">unlock_all_vcpus</a></div><div class="ttdeci">void unlock_all_vcpus(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="arm_8c_source.html#l01765">arm.c:1765</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a4ce1b5a14cd479b726e5451691380615_cgraph.png" border="0" usemap="#avgic-init_8c_a4ce1b5a14cd479b726e5451691380615_cgraph" alt=""/></div>
<map name="avgic-init_8c_a4ce1b5a14cd479b726e5451691380615_cgraph" id="avgic-init_8c_a4ce1b5a14cd479b726e5451691380615_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,139,57"/>
<area shape="rect" href="arm_8c.html#a02feef111fec875eb6382835eb2fb620" title=" " alt="" coords="195,5,312,32"/>
<area shape="rect" href="arm_8c.html#a29e56a77bf87bcd1b20ed8a14d9b2778" title=" " alt="" coords="187,56,320,83"/>
<area shape="rect" href="arm_8c.html#ac85c173d1f7208735e68f95eec2aac14" title=" " alt="" coords="368,31,479,57"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a4ce1b5a14cd479b726e5451691380615_icgraph.png" border="0" usemap="#avgic-init_8c_a4ce1b5a14cd479b726e5451691380615_icgraph" alt=""/></div>
<map name="avgic-init_8c_a4ce1b5a14cd479b726e5451691380615_icgraph" id="avgic-init_8c_a4ce1b5a14cd479b726e5451691380615_icgraph">
<area shape="rect" title=" " alt="" coords="203,31,336,57"/>
<area shape="rect" href="arm_8c.html#a10224987f77e7370dd9f2b80352544ab" title=" " alt="" coords="5,5,155,32"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a4a03bcf8c61b3397194a8fba37f06f1c" title=" " alt="" coords="31,56,129,83"/>
</map>
</div>

</div>
</div>
<a id="af08e0c3b0309dbe4472ed185cd2b9e72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af08e0c3b0309dbe4472ed185cd2b9e72">&#9670;&nbsp;</a></span>kvm_vgic_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_vgic_destroy </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00397">397</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;{</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    mutex_lock(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="vgic-debug_8c.html#a09b8e6f769f95e9667a93dde826b0e1e">vgic_debug_destroy</a>(kvm);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    kvm_for_each_vcpu(i, vcpu, kvm)</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="vgic-init_8c.html#a1002af084b5fbafca1dab97541383180">__kvm_vgic_vcpu_destroy</a>(vcpu);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="vgic-init_8c.html#a814da4f59c826266ad54a8b5aa870de6">kvm_vgic_dist_destroy</a>(kvm);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    mutex_unlock(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;}</div>
<div class="ttc" id="avgic-debug_8c_html_a09b8e6f769f95e9667a93dde826b0e1e"><div class="ttname"><a href="vgic-debug_8c.html#a09b8e6f769f95e9667a93dde826b0e1e">vgic_debug_destroy</a></div><div class="ttdeci">void vgic_debug_destroy(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-debug_8c_source.html#l00278">vgic-debug.c:278</a></div></div>
<div class="ttc" id="avgic-init_8c_html_a1002af084b5fbafca1dab97541383180"><div class="ttname"><a href="vgic-init_8c.html#a1002af084b5fbafca1dab97541383180">__kvm_vgic_vcpu_destroy</a></div><div class="ttdeci">static void __kvm_vgic_vcpu_destroy(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-init_8c_source.html#l00371">vgic-init.c:371</a></div></div>
<div class="ttc" id="avgic-init_8c_html_a814da4f59c826266ad54a8b5aa870de6"><div class="ttname"><a href="vgic-init_8c.html#a814da4f59c826266ad54a8b5aa870de6">kvm_vgic_dist_destroy</a></div><div class="ttdeci">static void kvm_vgic_dist_destroy(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-init_8c_source.html#l00343">vgic-init.c:343</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_af08e0c3b0309dbe4472ed185cd2b9e72_cgraph.png" border="0" usemap="#avgic-init_8c_af08e0c3b0309dbe4472ed185cd2b9e72_cgraph" alt=""/></div>
<map name="avgic-init_8c_af08e0c3b0309dbe4472ed185cd2b9e72_cgraph" id="avgic-init_8c_af08e0c3b0309dbe4472ed185cd2b9e72_cgraph">
<area shape="rect" title=" " alt="" coords="5,214,147,241"/>
<area shape="rect" href="vgic-init_8c.html#a1002af084b5fbafca1dab97541383180" title=" " alt="" coords="195,71,388,98"/>
<area shape="rect" href="vgic-init_8c.html#a814da4f59c826266ad54a8b5aa870de6" title=" " alt="" coords="205,214,377,241"/>
<area shape="rect" href="vgic-debug_8c.html#a09b8e6f769f95e9667a93dde826b0e1e" title=" " alt="" coords="215,265,367,291"/>
<area shape="rect" href="vgic_8c.html#a573eb768a56ea0b73e234771e0013ffc" title=" " alt="" coords="445,71,621,98"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a4bfec769cd9fe2bddb14200a6147fccd" title=" " alt="" coords="450,5,617,47"/>
<area shape="rect" href="vgic_8c.html#ac055f2fa0d463d3d287ee975bb80a9c5" title=" " alt="" coords="730,142,831,169"/>
<area shape="rect" href="vgic_8c.html#affa1a20a5bd9d67dc546c1ccaace3406" title=" " alt="" coords="931,193,1093,219"/>
<area shape="rect" href="vgic_8c.html#a7d513558f0ea4ecbc012c98b3522f797" title=" " alt="" coords="1171,193,1299,219"/>
<area shape="rect" href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897" title=" " alt="" coords="679,13,883,39"/>
<area shape="rect" href="kvm__main_8c.html#a3089edf2c0e5790aab7e8ed723f34b5b" title=" " alt="" coords="934,38,1090,65"/>
<area shape="rect" href="kvm__main_8c.html#aa6d7dea09a0b657f29e92f424e5d0633" title=" " alt="" coords="1141,13,1328,39"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="729,265,832,291"/>
<area shape="rect" href="vgic-its_8c.html#a58207180090221f6c6529d3c4acad96b" title=" " alt="" coords="459,341,608,383"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="436,290,631,317"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#ac2164da472839a705dfb81d3a3c477c5" title=" " alt="" coords="459,123,608,164"/>
<area shape="rect" href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce" title=" " alt="" coords="463,189,603,215"/>
<area shape="rect" href="vgic-its_8c.html#a922a99eb2d73f90e4fcb4cf7c52f0518" title=" " alt="" coords="709,328,853,369"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_af08e0c3b0309dbe4472ed185cd2b9e72_icgraph.png" border="0" usemap="#avgic-init_8c_af08e0c3b0309dbe4472ed185cd2b9e72_icgraph" alt=""/></div>
<map name="avgic-init_8c_af08e0c3b0309dbe4472ed185cd2b9e72_icgraph" id="avgic-init_8c_af08e0c3b0309dbe4472ed185cd2b9e72_icgraph">
<area shape="rect" title=" " alt="" coords="1093,111,1235,137"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="865,81,1035,108"/>
<area shape="rect" href="vgic-init_8c.html#a8411f235847aa56055a7a2fefce226c6" title=" " alt="" coords="855,136,1045,163"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="453,29,580,56"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="650,81,785,108"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,5,405,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="459,84,574,111"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,56,383,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,107,391,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,157,386,184"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,208,376,235"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,56,164,83"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="628,133,807,174"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="455,140,579,167"/>
</map>
</div>

</div>
</div>
<a id="a814da4f59c826266ad54a8b5aa870de6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a814da4f59c826266ad54a8b5aa870de6">&#9670;&nbsp;</a></span>kvm_vgic_dist_destroy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_vgic_dist_destroy </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00343">343</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keyword">struct </span>vgic_dist *dist = &amp;kvm-&gt;arch.vgic;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keyword">struct </span>vgic_redist_region *rdreg, *next;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    dist-&gt;ready = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    dist-&gt;initialized = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    kfree(dist-&gt;spis);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    dist-&gt;spis = NULL;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    dist-&gt;nr_spis = 0;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    dist-&gt;vgic_dist_base = <a class="code" href="vgic_8h.html#ac91699b3ab8faf4d5222d998fb64b033">VGIC_ADDR_UNDEF</a>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (dist-&gt;vgic_model == KVM_DEV_TYPE_ARM_VGIC_V3) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        list_for_each_entry_safe(rdreg, next, &amp;dist-&gt;rd_regions, list)</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <a class="code" href="vgic-mmio-v3_8c.html#ac2164da472839a705dfb81d3a3c477c5">vgic_v3_free_redist_region</a>(rdreg);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        INIT_LIST_HEAD(&amp;dist-&gt;rd_regions);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        dist-&gt;vgic_cpu_base = <a class="code" href="vgic_8h.html#ac91699b3ab8faf4d5222d998fb64b033">VGIC_ADDR_UNDEF</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e">vgic_has_its</a>(kvm))</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <a class="code" href="vgic-its_8c.html#a58207180090221f6c6529d3c4acad96b">vgic_lpi_translation_cache_destroy</a>(kvm);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f">vgic_supports_direct_msis</a>(kvm))</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <a class="code" href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce">vgic_v4_teardown</a>(kvm);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;}</div>
<div class="ttc" id="avgic-its_8c_html_a58207180090221f6c6529d3c4acad96b"><div class="ttname"><a href="vgic-its_8c.html#a58207180090221f6c6529d3c4acad96b">vgic_lpi_translation_cache_destroy</a></div><div class="ttdeci">void vgic_lpi_translation_cache_destroy(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-its_8c_source.html#l01927">vgic-its.c:1927</a></div></div>
<div class="ttc" id="avgic-mmio-v3_8c_html_a47708b59ddd94e03880996def466067e"><div class="ttname"><a href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e">vgic_has_its</a></div><div class="ttdeci">bool vgic_has_its(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-mmio-v3_8c_source.html#l00041">vgic-mmio-v3.c:41</a></div></div>
<div class="ttc" id="avgic-mmio-v3_8c_html_a839b15883ba8f9de35a03ffce32fdf7f"><div class="ttname"><a href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f">vgic_supports_direct_msis</a></div><div class="ttdeci">bool vgic_supports_direct_msis(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-mmio-v3_8c_source.html#l00051">vgic-mmio-v3.c:51</a></div></div>
<div class="ttc" id="avgic-mmio-v3_8c_html_ac2164da472839a705dfb81d3a3c477c5"><div class="ttname"><a href="vgic-mmio-v3_8c.html#ac2164da472839a705dfb81d3a3c477c5">vgic_v3_free_redist_region</a></div><div class="ttdeci">void vgic_v3_free_redist_region(struct vgic_redist_region *rdreg)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-mmio-v3_8c_source.html#l00922">vgic-mmio-v3.c:922</a></div></div>
<div class="ttc" id="avgic-v4_8c_html_ac805e466fa8f454112c11904ef8d41ce"><div class="ttname"><a href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce">vgic_v4_teardown</a></div><div class="ttdeci">void vgic_v4_teardown(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v4_8c_source.html#l00315">vgic-v4.c:315</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a814da4f59c826266ad54a8b5aa870de6_cgraph.png" border="0" usemap="#avgic-init_8c_a814da4f59c826266ad54a8b5aa870de6_cgraph" alt=""/></div>
<map name="avgic-init_8c_a814da4f59c826266ad54a8b5aa870de6_cgraph" id="avgic-init_8c_a814da4f59c826266ad54a8b5aa870de6_cgraph">
<area shape="rect" title=" " alt="" coords="5,93,177,120"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="489,9,591,36"/>
<area shape="rect" href="vgic-its_8c.html#a58207180090221f6c6529d3c4acad96b" title=" " alt="" coords="248,86,397,127"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="225,35,420,61"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#ac2164da472839a705dfb81d3a3c477c5" title=" " alt="" coords="248,151,397,193"/>
<area shape="rect" href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce" title=" " alt="" coords="253,217,393,244"/>
<area shape="rect" href="vgic-its_8c.html#a922a99eb2d73f90e4fcb4cf7c52f0518" title=" " alt="" coords="468,86,612,127"/>
<area shape="rect" href="vgic_8c.html#affa1a20a5bd9d67dc546c1ccaace3406" title=" " alt="" coords="660,93,823,120"/>
<area shape="rect" href="vgic_8c.html#a7d513558f0ea4ecbc012c98b3522f797" title=" " alt="" coords="871,93,999,120"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a814da4f59c826266ad54a8b5aa870de6_icgraph.png" border="0" usemap="#avgic-init_8c_a814da4f59c826266ad54a8b5aa870de6_icgraph" alt=""/></div>
<map name="avgic-init_8c_a814da4f59c826266ad54a8b5aa870de6_icgraph" id="avgic-init_8c_a814da4f59c826266ad54a8b5aa870de6_icgraph">
<area shape="rect" title=" " alt="" coords="1283,111,1455,137"/>
<area shape="rect" href="vgic-init_8c.html#af08e0c3b0309dbe4472ed185cd2b9e72" title=" " alt="" coords="1093,111,1235,137"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="865,81,1035,108"/>
<area shape="rect" href="vgic-init_8c.html#a8411f235847aa56055a7a2fefce226c6" title=" " alt="" coords="855,136,1045,163"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="453,29,580,56"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="650,81,785,108"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,5,405,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="459,84,574,111"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,56,383,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,107,391,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,157,386,184"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,208,376,235"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,56,164,83"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="628,133,807,174"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="455,140,579,167"/>
</map>
</div>

</div>
</div>
<a id="a0f9be5cc88c88f6c0180c53b72818d3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f9be5cc88c88f6c0180c53b72818d3b">&#9670;&nbsp;</a></span>kvm_vgic_dist_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_vgic_dist_init </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nr_spis</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>kvm_vgic_dist_init: initialize the dist data structures @kvm: kvm struct pointer @nr_spis: number of spis, frozen by caller </p>

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00140">140</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keyword">struct </span>vgic_dist *dist = &amp;kvm-&gt;arch.vgic;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu0 = kvm_get_vcpu(kvm, 0);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    dist-&gt;spis = kcalloc(nr_spis, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> vgic_irq), GFP_KERNEL_ACCOUNT);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (!dist-&gt;spis)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">return</span>  -ENOMEM;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">     * In the following code we do not take the irq struct lock since</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">     * no other action on irq structs can happen while the VGIC is</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">     * not initialized yet:</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">     * If someone wants to inject an interrupt or does a MMIO access, we</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">     * require prior initialization in case of a virtual GICv3 or trigger</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">     * initialization when using a virtual GICv2.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; nr_spis; i++) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keyword">struct </span>vgic_irq *irq = &amp;dist-&gt;spis[i];</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        irq-&gt;intid = i + VGIC_NR_PRIVATE_IRQS;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        INIT_LIST_HEAD(&amp;irq-&gt;ap_list);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        raw_spin_lock_init(&amp;irq-&gt;irq_lock);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        irq-&gt;vcpu = NULL;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        irq-&gt;target_vcpu = vcpu0;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        kref_init(&amp;irq-&gt;refcount);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">switch</span> (dist-&gt;vgic_model) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">case</span> KVM_DEV_TYPE_ARM_VGIC_V2:</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            irq-&gt;targets = 0;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            irq-&gt;group = 0;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">case</span> KVM_DEV_TYPE_ARM_VGIC_V3:</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            irq-&gt;mpidr = 0;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            irq-&gt;group = 1;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            kfree(dist-&gt;spis);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            dist-&gt;spis = NULL;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a0f9be5cc88c88f6c0180c53b72818d3b_icgraph.png" border="0" usemap="#avgic-init_8c_a0f9be5cc88c88f6c0180c53b72818d3b_icgraph" alt=""/></div>
<map name="avgic-init_8c_a0f9be5cc88c88f6c0180c53b72818d3b_icgraph" id="avgic-init_8c_a0f9be5cc88c88f6c0180c53b72818d3b_icgraph">
<area shape="rect" title=" " alt="" coords="2821,492,2965,519"/>
<area shape="rect" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57" title=" " alt="" coords="2696,492,2773,519"/>
<area shape="rect" href="vgic-init_8c.html#a3c860e1d043352d9a02f4780b58e5af6" title=" " alt="" coords="2499,365,2609,392"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a6aadc4684bf7ca54e4a3d91f9e10310c" title=" " alt="" coords="2469,441,2639,468"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a78d5c53181a4adf55a58d8277fb751af" title=" " alt="" coords="2460,492,2648,519"/>
<area shape="rect" href="vgic-v2_8c.html#ac8de91a1f816dcd3b3edba1d074a1aca" title=" " alt="" coords="2465,593,2643,620"/>
<area shape="rect" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4" title=" " alt="" coords="2241,340,2393,367"/>
<area shape="rect" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4" title=" " alt="" coords="1086,411,1265,437"/>
<area shape="rect" href="arch__timer_8c.html#a5abc04b494763cd0814855753e56671f" title=" " alt="" coords="2004,213,2173,240"/>
<area shape="rect" href="arm_8c.html#a1cc94da0709805c40af7785f8c5811bf" title=" " alt="" coords="2004,163,2173,189"/>
<area shape="rect" href="vgic-irqfd_8c.html#aaba342a8b6308d37735bc46dbf9a6828" title=" " alt="" coords="2020,340,2157,367"/>
<area shape="rect" href="pmu-emul_8c.html#ab0f1f020b6774de3fb4ff4c8b4e45a5c" title=" " alt="" coords="845,411,1029,437"/>
<area shape="rect" href="pmu-emul_8c.html#ae6434d5e6ad74c608886c368e56d67bc" title=" " alt="" coords="846,360,1029,387"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="611,309,797,336"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,309,129,336"/>
<area shape="rect" href="arch__timer_8c.html#a7d59bcd17bdbce3017dbc041cd6e9629" title=" " alt="" coords="1763,239,1947,265"/>
<area shape="rect" href="arch__timer_8c.html#a1c4f03de391e27f5ba91d10b6dfab0bf" title=" " alt="" coords="1759,20,1951,47"/>
<area shape="rect" href="arch__timer_8c.html#a8fb06d125602c5b00fa9c213aa7e2520" title=" " alt="" coords="1772,71,1939,113"/>
<area shape="rect" href="arch__timer_8c.html#a11b9b6e6338bbec6085332661c934e91" title=" " alt="" coords="1321,184,1492,211"/>
<area shape="rect" href="arch__timer_8c.html#acea899fae895cedf39458ed51af3cb1a" title=" " alt="" coords="1796,137,1915,164"/>
<area shape="rect" href="arch__timer_8c.html#a7af96c32754607120bf365569aac71c0" title=" " alt="" coords="1764,289,1947,316"/>
<area shape="rect" href="arch__timer_8c.html#a27c9feb35e6d7126c054c3325fea59b0" title=" " alt="" coords="1547,249,1699,276"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="1343,259,1471,285"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="1119,259,1231,285"/>
<area shape="rect" href="arch__timer_8c.html#a4bf6ac76380146820b45b06feb3eab27" title=" " alt="" coords="1540,71,1707,97"/>
<area shape="rect" href="arm_8c.html#aaa51abf3d06fdaa95794b27f273278fb" title=" " alt="" coords="1327,75,1486,101"/>
<area shape="rect" href="emulate-nested_8c.html#a1920c02a997dd9975bec0ee02f6ae2c4" title=" " alt="" coords="1077,5,1273,32"/>
<area shape="rect" href="emulate-nested_8c.html#a1c3e31bd85e9c0590a018ada20a5e4bf" title=" " alt="" coords="1103,56,1248,83"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1111,157,1240,184"/>
<area shape="rect" href="kvm__main_8c.html#a31b6c41ce8eacbbdc56a276018989253" title=" " alt="" coords="1118,107,1233,133"/>
<area shape="rect" href="kvm__main_8c.html#a5dde35c5b74ce68a7dbb2f2006ce3e9e" title=" " alt="" coords="893,259,981,285"/>
<area shape="rect" href="handle__exit_8c.html#ae96aab7918301d55b908034db5855e3d" title=" " alt="" coords="870,5,1005,32"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="849,107,1025,133"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="623,99,785,125"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,157,336,184"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="857,208,1018,235"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="394,91,553,133"/>
<area shape="rect" href="arch__timer_8c.html#a0209ad4256c7a1fd5ea70b6abe030954" title=" " alt="" coords="1540,122,1707,163"/>
<area shape="rect" href="sys__regs_8c.html#a9457451d95fa776f653cff6c2a8d31f9" title=" " alt="" coords="1335,129,1478,156"/>
<area shape="rect" href="arch__timer_8c.html#a6ae73bff466fcdc60319f9726d53b571" title=" " alt="" coords="1541,305,1706,332"/>
<area shape="rect" href="vgic-irqfd_8c.html#ae7b7837b6e17bc60af3f4d81e9a4147e" title=" " alt="" coords="1755,340,1956,367"/>
<area shape="rect" href="vgic-irqfd_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1769,391,1941,417"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="1547,391,1699,417"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="1329,492,1484,519"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="1085,506,1266,547"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a37a5c9125b0504633553497ae8c7ce9c" title=" " alt="" coords="2252,441,2381,468"/>
<area shape="rect" href="vgic-kvm-device_8c.html#aee48777d58c65e5b91c0f85e2eae843e" title=" " alt="" coords="2252,391,2381,417"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a3bb10b83ef8325ecaa3671e9fe9c528c" title=" " alt="" coords="2251,492,2382,519"/>
<area shape="rect" href="vgic-init_8c.html#a8411f235847aa56055a7a2fefce226c6" title=" " alt="" coords="2221,593,2412,620"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="384,462,563,503"/>
</map>
</div>

</div>
</div>
<a id="ab923d47040c4f3c9e6cae619d7abf78a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab923d47040c4f3c9e6cae619d7abf78a">&#9670;&nbsp;</a></span>kvm_vgic_early_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_vgic_early_init </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="vgic-init_8c.html#ab923d47040c4f3c9e6cae619d7abf78a">kvm_vgic_early_init()</a> - Initialize static VGIC VCPU data structures @kvm: The VM whose VGIC districutor should be initialized</p>
<p>Only do initialization of static structures that don't require any allocation or sizing information from userspace. <a class="el" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57">vgic_init()</a> called <a class="el" href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b">kvm_vgic_dist_init()</a> which takes care of the rest. </p>

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00052">52</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;{</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keyword">struct </span>vgic_dist *dist = &amp;kvm-&gt;arch.vgic;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    INIT_LIST_HEAD(&amp;dist-&gt;lpi_list_head);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    INIT_LIST_HEAD(&amp;dist-&gt;lpi_translation_cache);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    raw_spin_lock_init(&amp;dist-&gt;lpi_list_lock);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_ab923d47040c4f3c9e6cae619d7abf78a_icgraph.png" border="0" usemap="#avgic-init_8c_ab923d47040c4f3c9e6cae619d7abf78a_icgraph" alt=""/></div>
<map name="avgic-init_8c_ab923d47040c4f3c9e6cae619d7abf78a_icgraph" id="avgic-init_8c_ab923d47040c4f3c9e6cae619d7abf78a_icgraph">
<area shape="rect" title=" " alt="" coords="612,5,765,32"/>
<area shape="rect" href="arm_8c.html#a78b266c18dac3b9edbea80941c96e2cd" title=" " alt="" coords="421,5,564,32"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="247,5,373,32"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="5,5,199,32"/>
</map>
</div>

</div>
</div>
<a id="aba3547aa220ca50b1eabca1a39c92943"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba3547aa220ca50b1eabca1a39c92943">&#9670;&nbsp;</a></span>kvm_vgic_hyp_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_vgic_hyp_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_vgic_hyp_init: populates the kvm_vgic_global_state variable according to the host GIC model. Accordingly calls either vgic_v2/v3_probe which registers the KVM_DEVICE that can be instantiated by a guest later on . </p>

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00564">564</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;{</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordtype">bool</span> has_mask;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>)</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordflow">return</span> -ENODEV;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    has_mask = !<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>-&gt;no_maint_irq_mask;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">if</span> (has_mask &amp;&amp; !<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>-&gt;maint_irq) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        kvm_err(<span class="stringliteral">&quot;No vgic maintenance irq\n&quot;</span>);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">return</span> -ENXIO;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">     * If we get one of these oddball non-GICs, taint the kernel,</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">     * as we have no idea of how they *really* behave.</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>-&gt;no_hw_deactivation) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        kvm_info(<span class="stringliteral">&quot;Non-architectural vgic, tainting kernel\n&quot;</span>);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        add_taint(TAINT_CPU_OUT_OF_SPEC, LOCKDEP_STILL_OK);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        kvm_vgic_global_state.no_hw_deactivation = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>-&gt;type) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">case</span> GIC_V2:</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        ret = <a class="code" href="vgic-v2_8c.html#aa3e64817232a1ce5658b7f3147f7f554">vgic_v2_probe</a>(<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">case</span> GIC_V3:</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        ret = <a class="code" href="vgic-v3_8c.html#ac418c84cff9542559c426a575c403136">vgic_v3_probe</a>(<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">if</span> (!ret) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            static_branch_enable(&amp;kvm_vgic_global_state.gicv3_cpuif);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            kvm_info(<span class="stringliteral">&quot;GIC system register CPU interface enabled\n&quot;</span>);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        ret = -ENODEV;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    kvm_vgic_global_state.maint_irq = <a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>-&gt;maint_irq;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    kfree(<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a> = NULL;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">if</span> (!has_mask &amp;&amp; !kvm_vgic_global_state.maint_irq)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    ret = request_percpu_irq(kvm_vgic_global_state.maint_irq,</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                 <a class="code" href="vgic-init_8c.html#a489028c2499bdfbe87388b96a832b3ed">vgic_maintenance_handler</a>,</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                 <span class="stringliteral">&quot;vgic&quot;</span>, <a class="code" href="kvm__main_8c.html#a1798daf88e30c60711caf936851d823f">kvm_get_running_vcpus</a>());</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        kvm_err(<span class="stringliteral">&quot;Cannot register interrupt %d\n&quot;</span>,</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            kvm_vgic_global_state.maint_irq);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    kvm_info(<span class="stringliteral">&quot;vgic interrupt IRQ%d\n&quot;</span>, kvm_vgic_global_state.maint_irq);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_a1798daf88e30c60711caf936851d823f"><div class="ttname"><a href="kvm__main_8c.html#a1798daf88e30c60711caf936851d823f">kvm_get_running_vcpus</a></div><div class="ttdeci">struct kvm_vcpu *__percpu * kvm_get_running_vcpus(void)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l06353">kvm_main.c:6353</a></div></div>
<div class="ttc" id="avgic-init_8c_html_a489028c2499bdfbe87388b96a832b3ed"><div class="ttname"><a href="vgic-init_8c.html#a489028c2499bdfbe87388b96a832b3ed">vgic_maintenance_handler</a></div><div class="ttdeci">static irqreturn_t vgic_maintenance_handler(int irq, void *data)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-init_8c_source.html#l00518">vgic-init.c:518</a></div></div>
<div class="ttc" id="avgic-init_8c_html_a7b7c49d17fa603aa8433b0d402f9efe1"><div class="ttname"><a href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a></div><div class="ttdeci">static struct gic_kvm_info * gic_kvm_info</div><div class="ttdef"><b>Definition:</b> <a href="vgic-init_8c_source.html#l00529">vgic-init.c:529</a></div></div>
<div class="ttc" id="avgic-v2_8c_html_aa3e64817232a1ce5658b7f3147f7f554"><div class="ttname"><a href="vgic-v2_8c.html#aa3e64817232a1ce5658b7f3147f7f554">vgic_v2_probe</a></div><div class="ttdeci">int vgic_v2_probe(const struct gic_kvm_info *info)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v2_8c_source.html#l00337">vgic-v2.c:337</a></div></div>
<div class="ttc" id="avgic-v3_8c_html_ac418c84cff9542559c426a575c403136"><div class="ttname"><a href="vgic-v3_8c.html#ac418c84cff9542559c426a575c403136">vgic_v3_probe</a></div><div class="ttdeci">int vgic_v3_probe(const struct gic_kvm_info *info)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v3_8c_source.html#l00632">vgic-v3.c:632</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_aba3547aa220ca50b1eabca1a39c92943_cgraph.png" border="0" usemap="#avgic-init_8c_aba3547aa220ca50b1eabca1a39c92943_cgraph" alt=""/></div>
<map name="avgic-init_8c_aba3547aa220ca50b1eabca1a39c92943_cgraph" id="avgic-init_8c_aba3547aa220ca50b1eabca1a39c92943_cgraph">
<area shape="rect" title=" " alt="" coords="5,164,149,191"/>
<area shape="rect" href="kvm__main_8c.html#a1798daf88e30c60711caf936851d823f" title=" " alt="" coords="206,88,386,115"/>
<area shape="rect" href="vgic-init_8c.html#a489028c2499bdfbe87388b96a832b3ed" title=" " alt="" coords="197,139,395,165"/>
<area shape="rect" href="vgic-v2_8c.html#aa3e64817232a1ce5658b7f3147f7f554" title=" " alt="" coords="238,189,354,216"/>
<area shape="rect" href="vgic-v3_8c.html#ac418c84cff9542559c426a575c403136" title=" " alt="" coords="238,265,354,292"/>
<area shape="rect" href="mmu_8c.html#af062326f5ca9b42e66721620681afc52" title=" " alt="" coords="453,132,637,159"/>
<area shape="rect" href="vgic-kvm-device_8c.html#aa01e5dcf80e608f64f5428d054d17a84" title=" " alt="" coords="449,189,641,216"/>
<area shape="rect" href="mmu_8c.html#ae887a1611ab69f37917bb0f05530e62d" title=" " alt="" coords="708,117,869,158"/>
<area shape="rect" href="mmu_8c.html#a528a37af3e2c56c76872b4113cff0877" title=" " alt="" coords="931,95,1109,121"/>
<area shape="rect" href="mmu_8c.html#af214df14aaaac0cc598374356bc3bc5b" title=" " alt="" coords="1157,44,1387,71"/>
<area shape="rect" href="mm_8h.html#ae155403ed30abe044479dec517afc378" title=" " alt="" coords="933,146,1107,187"/>
<area shape="rect" href="mmu_8c.html#a1a724954ee942f0f1223e75cd475c8e7" title=" " alt="" coords="940,237,1100,278"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="1435,95,1609,121"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="1673,44,1805,71"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="1671,95,1807,121"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1666,145,1811,172"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="1868,44,2057,71"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1889,95,2036,121"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="2105,5,2335,32"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="2131,56,2309,83"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="2387,5,2534,32"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1887,145,2039,172"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="2141,132,2299,159"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="2146,183,2294,209"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="2383,132,2539,159"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="2393,183,2528,209"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="2602,56,2779,83"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="2587,107,2795,133"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="2627,157,2754,184"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2631,208,2750,235"/>
<area shape="rect" href="mm_8c.html#a74d2915c3948e76518d945f16a1ede94" title=" " alt="" coords="1176,145,1368,172"/>
<area shape="rect" href="mm_8c.html#ac26a679af9d176b079755c60fa2e1ce1" title=" " alt="" coords="1197,197,1347,238"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="1465,196,1579,223"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="1457,145,1587,172"/>
<area shape="rect" href="mm_8c.html#aa76ffe9cd77a903ae9b6e5de1617f3a5" title=" " alt="" coords="1440,247,1604,289"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="1657,255,1820,281"/>
<area shape="rect" href="mmu_8c.html#a3d84d21823759c9e6d2cd3bbcc5b8f48" title=" " alt="" coords="1197,262,1347,303"/>
<area shape="rect" href="kvm__main_8c.html#a04cec4716182d98b08f008f317aaf698" title=" " alt="" coords="695,248,883,275"/>
<area shape="rect" href="vgic-its_8c.html#a50d09aacec778677eb4fb2c550a3bea4" title=" " alt="" coords="706,182,871,223"/>
<area shape="rect" href="vgic-v3-sr_8c.html#ab2ac0bafd09093cb3c702166b2615c31" title=" " alt="" coords="451,341,638,368"/>
<area shape="rect" href="arm_8c.html#ade8fdddf9949d1e1fcc2cea2dc5a7133" title=" " alt="" coords="483,392,606,419"/>
<area shape="rect" href="kvm__main_8c.html#a9a59affaa1c06f4ea56e33679ba52ae2" title=" " alt="" coords="443,240,647,267"/>
<area shape="rect" href="vgic-v3_8c.html#a723b88e9568c712a3b969224cda48a8c" title=" " alt="" coords="467,291,623,317"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_aba3547aa220ca50b1eabca1a39c92943_icgraph.png" border="0" usemap="#avgic-init_8c_aba3547aa220ca50b1eabca1a39c92943_icgraph" alt=""/></div>
<map name="avgic-init_8c_aba3547aa220ca50b1eabca1a39c92943_icgraph" id="avgic-init_8c_aba3547aa220ca50b1eabca1a39c92943_icgraph">
<area shape="rect" title=" " alt="" coords="341,5,485,32"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="165,5,293,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="aefd1e0e9cd080919b043406251dfa0b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefd1e0e9cd080919b043406251dfa0b8">&#9670;&nbsp;</a></span>kvm_vgic_init_cpu_hardware()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_vgic_init_cpu_hardware </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_vgic_init_cpu_hardware - initialize the GIC VE hardware</p>
<p>For a specific CPU, initialize the GIC VE hardware. </p>

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00544">544</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;{</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    BUG_ON(preemptible());</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">     * We want to make sure the list registers start out clear so that we</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">     * only have the program the used registers.</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> (kvm_vgic_global_state.type == VGIC_V2)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="vgic-v2_8c.html#a1e2191b7a20d4cf12614106efac5ced2">vgic_v2_init_lrs</a>();</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        kvm_call_hyp(<a class="code" href="vgic-v3-sr_8c.html#a412786aabffbbfab73264334c0a45f1d">__vgic_v3_init_lrs</a>);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;}</div>
<div class="ttc" id="avgic-v2_8c_html_a1e2191b7a20d4cf12614106efac5ced2"><div class="ttname"><a href="vgic-v2_8c.html#a1e2191b7a20d4cf12614106efac5ced2">vgic_v2_init_lrs</a></div><div class="ttdeci">void vgic_v2_init_lrs(void)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v2_8c_source.html#l00021">vgic-v2.c:21</a></div></div>
<div class="ttc" id="avgic-v3-sr_8c_html_a412786aabffbbfab73264334c0a45f1d"><div class="ttname"><a href="vgic-v3-sr_8c.html#a412786aabffbbfab73264334c0a45f1d">__vgic_v3_init_lrs</a></div><div class="ttdeci">void __vgic_v3_init_lrs(void)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v3-sr_8c_source.html#l00399">vgic-v3-sr.c:399</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_aefd1e0e9cd080919b043406251dfa0b8_cgraph.png" border="0" usemap="#avgic-init_8c_aefd1e0e9cd080919b043406251dfa0b8_cgraph" alt=""/></div>
<map name="avgic-init_8c_aefd1e0e9cd080919b043406251dfa0b8_cgraph" id="avgic-init_8c_aefd1e0e9cd080919b043406251dfa0b8_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,216,57"/>
<area shape="rect" href="vgic-v3-sr_8c.html#a412786aabffbbfab73264334c0a45f1d" title=" " alt="" coords="264,5,401,32"/>
<area shape="rect" href="vgic-v2_8c.html#a1e2191b7a20d4cf12614106efac5ced2" title=" " alt="" coords="271,56,394,83"/>
<area shape="rect" href="vgic-v3-sr_8c.html#a161e7bd7fc63e0a7fdb5fab98711d711" title=" " alt="" coords="453,5,574,32"/>
<area shape="rect" href="vgic-v2_8c.html#ad8c03dce2e41ca3c35de3897603bb9e0" title=" " alt="" coords="449,56,577,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_aefd1e0e9cd080919b043406251dfa0b8_icgraph.png" border="0" usemap="#avgic-init_8c_aefd1e0e9cd080919b043406251dfa0b8_icgraph" alt=""/></div>
<map name="avgic-init_8c_aefd1e0e9cd080919b043406251dfa0b8_icgraph" id="avgic-init_8c_aefd1e0e9cd080919b043406251dfa0b8_icgraph">
<area shape="rect" title=" " alt="" coords="1028,81,1239,108"/>
<area shape="rect" href="arm_8c.html#a451b50b80474a3cf090fcce753c8c642" title=" " alt="" coords="815,81,980,108"/>
<area shape="rect" href="arm_8c.html#a2dfd4facec6b758ea01c34f9789486d8" title=" " alt="" coords="649,56,767,83"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="653,107,763,133"/>
<area shape="rect" href="arm_8c.html#a0769d67e6376c5081aac75ea3783df2f" title=" " alt="" coords="458,56,562,83"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="204,5,332,32"/>
<area shape="rect" href="arm_8c.html#ac1582780a8801f86aa06da8b95cbcfe9" title=" " alt="" coords="165,56,371,83"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,56,117,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="419,107,601,133"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="209,107,327,133"/>
</map>
</div>

</div>
</div>
<a id="a8411f235847aa56055a7a2fefce226c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8411f235847aa56055a7a2fefce226c6">&#9670;&nbsp;</a></span>kvm_vgic_map_resources()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_vgic_map_resources </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Map the MMIO regions depending on the VGIC model exposed to the guest called on the first VCPU run. Also map the virtual CPU interface into the VM. v2 calls <a class="el" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57">vgic_init()</a> if not already done. v3 and derivatives return an error if the VGIC is not initialized. vgic_ready() returns true if this function has succeeded. @kvm: kvm struct pointer </p>

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00456">456</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;{</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keyword">struct </span>vgic_dist *dist = &amp;kvm-&gt;arch.vgic;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keyword">enum</span> vgic_type type;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    gpa_t dist_base;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">if</span> (likely(vgic_ready(kvm)))</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    mutex_lock(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    mutex_lock(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">if</span> (vgic_ready(kvm))</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">if</span> (!irqchip_in_kernel(kvm))</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> (dist-&gt;vgic_model == KVM_DEV_TYPE_ARM_VGIC_V2) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        ret = <a class="code" href="vgic-v2_8c.html#ac8de91a1f816dcd3b3edba1d074a1aca">vgic_v2_map_resources</a>(kvm);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        type = VGIC_V2;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        ret = <a class="code" href="vgic-v3_8c.html#a8c2e4753883533516b45a2bbf9dad1ce">vgic_v3_map_resources</a>(kvm);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        type = VGIC_V3;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    dist-&gt;ready = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    dist_base = dist-&gt;vgic_dist_base;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    ret = <a class="code" href="vgic-mmio_8c.html#a8911c23be28d228d12a6b010b8133524">vgic_register_dist_iodev</a>(kvm, dist_base, type);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        kvm_err(<span class="stringliteral">&quot;Unable to register VGIC dist MMIO regions\n&quot;</span>);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">goto</span> out_slots;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;out:</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    mutex_unlock(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;out_slots:</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    mutex_unlock(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <a class="code" href="vgic-init_8c.html#af08e0c3b0309dbe4472ed185cd2b9e72">kvm_vgic_destroy</a>(kvm);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;}</div>
<div class="ttc" id="avgic-init_8c_html_af08e0c3b0309dbe4472ed185cd2b9e72"><div class="ttname"><a href="vgic-init_8c.html#af08e0c3b0309dbe4472ed185cd2b9e72">kvm_vgic_destroy</a></div><div class="ttdeci">void kvm_vgic_destroy(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-init_8c_source.html#l00397">vgic-init.c:397</a></div></div>
<div class="ttc" id="avgic-mmio_8c_html_a8911c23be28d228d12a6b010b8133524"><div class="ttname"><a href="vgic-mmio_8c.html#a8911c23be28d228d12a6b010b8133524">vgic_register_dist_iodev</a></div><div class="ttdeci">int vgic_register_dist_iodev(struct kvm *kvm, gpa_t dist_base_address, enum vgic_type type)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-mmio_8c_source.html#l01080">vgic-mmio.c:1080</a></div></div>
<div class="ttc" id="avgic-v2_8c_html_ac8de91a1f816dcd3b3edba1d074a1aca"><div class="ttname"><a href="vgic-v2_8c.html#ac8de91a1f816dcd3b3edba1d074a1aca">vgic_v2_map_resources</a></div><div class="ttdeci">int vgic_v2_map_resources(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v2_8c_source.html#l00289">vgic-v2.c:289</a></div></div>
<div class="ttc" id="avgic-v3_8c_html_a8c2e4753883533516b45a2bbf9dad1ce"><div class="ttname"><a href="vgic-v3_8c.html#a8c2e4753883533516b45a2bbf9dad1ce">vgic_v3_map_resources</a></div><div class="ttdeci">int vgic_v3_map_resources(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v3_8c_source.html#l00538">vgic-v3.c:538</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a8411f235847aa56055a7a2fefce226c6_cgraph.png" border="0" usemap="#avgic-init_8c_a8411f235847aa56055a7a2fefce226c6_cgraph" alt=""/></div>
<map name="avgic-init_8c_a8411f235847aa56055a7a2fefce226c6_cgraph" id="avgic-init_8c_a8411f235847aa56055a7a2fefce226c6_cgraph">
<area shape="rect" title=" " alt="" coords="5,712,196,739"/>
<area shape="rect" href="vgic-init_8c.html#af08e0c3b0309dbe4472ed185cd2b9e72" title=" " alt="" coords="263,608,404,635"/>
<area shape="rect" href="vgic-mmio_8c.html#a8911c23be28d228d12a6b010b8133524" title=" " alt="" coords="265,1102,402,1143"/>
<area shape="rect" href="vgic-v2_8c.html#ac8de91a1f816dcd3b3edba1d074a1aca" title=" " alt="" coords="244,813,423,840"/>
<area shape="rect" href="vgic-v3_8c.html#a8c2e4753883533516b45a2bbf9dad1ce" title=" " alt="" coords="244,208,423,235"/>
<area shape="rect" href="vgic-init_8c.html#a1002af084b5fbafca1dab97541383180" title=" " alt="" coords="471,393,664,420"/>
<area shape="rect" href="vgic-init_8c.html#a814da4f59c826266ad54a8b5aa870de6" title=" " alt="" coords="481,583,653,609"/>
<area shape="rect" href="vgic-debug_8c.html#a09b8e6f769f95e9667a93dde826b0e1e" title=" " alt="" coords="491,633,643,660"/>
<area shape="rect" href="vgic_8c.html#a573eb768a56ea0b73e234771e0013ffc" title=" " alt="" coords="721,335,897,361"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a4bfec769cd9fe2bddb14200a6147fccd" title=" " alt="" coords="726,386,893,427"/>
<area shape="rect" href="vgic_8c.html#ac055f2fa0d463d3d287ee975bb80a9c5" title=" " alt="" coords="1009,284,1111,311"/>
<area shape="rect" href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897" title=" " alt="" coords="958,393,1162,420"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="1009,633,1111,660"/>
<area shape="rect" href="vgic-its_8c.html#a58207180090221f6c6529d3c4acad96b" title=" " alt="" coords="735,451,884,493"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="712,633,907,660"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#ac2164da472839a705dfb81d3a3c477c5" title=" " alt="" coords="735,517,884,558"/>
<area shape="rect" href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce" title=" " alt="" coords="990,895,1130,921"/>
<area shape="rect" href="vgic-its_8c.html#a922a99eb2d73f90e4fcb4cf7c52f0518" title=" " alt="" coords="988,451,1132,493"/>
<area shape="rect" href="kvm__main_8c.html#a0afe5ce3e9ff1105328b06ec985e3374" title=" " alt="" coords="473,1084,661,1111"/>
<area shape="rect" href="vgic-mmio-v2_8c.html#a99781f95ebe917fea2537d762dded6e9" title=" " alt="" coords="480,1135,655,1161"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#ab423a52c4f34cfe2d13a8da61cba66cb" title=" " alt="" coords="480,1185,655,1212"/>
<area shape="rect" href="kvm__main_8c.html#a75ccec7a81fef145fb3c3a3b5479a86f" title=" " alt="" coords="742,1172,877,1199"/>
<area shape="rect" href="mmu_8c.html#aceb0aaa6f23e8883c4fe0b6ef8001f04" title=" " alt="" coords="474,760,661,787"/>
<area shape="rect" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57" title=" " alt="" coords="529,865,606,892"/>
<area shape="rect" href="vgic-v2_8c.html#a264fb134741ac9d0b075dff21880d8f1" title=" " alt="" coords="490,916,645,943"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="712,735,907,761"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="987,684,1133,711"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="984,735,1136,761"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="982,785,1138,812"/>
<area shape="rect" href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b" title=" " alt="" coords="737,953,881,980"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="719,1106,900,1147"/>
<area shape="rect" href="vgic-init_8c.html#a2eee0060a3bdcd2a9e8fe1451a3a3fc2" title=" " alt="" coords="722,1055,897,1081"/>
<area shape="rect" href="vgic-debug_8c.html#a42534d23071b4f3c441c5f82f9e5c1ce" title=" " alt="" coords="747,836,871,863"/>
<area shape="rect" href="vgic-its_8c.html#afd97b5d03d2b30ae4481443cdea2e739" title=" " alt="" coords="735,887,884,929"/>
<area shape="rect" href="vgic-v4_8c.html#a802a906ad744a75b5af33bbd6b31237c" title=" " alt="" coords="759,1004,859,1031"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="983,1135,1137,1161"/>
<area shape="rect" href="vgic-v2_8c.html#a4e8ee3d5f7c8fadbf0a645df67a1c5a2" title=" " alt="" coords="999,1033,1121,1060"/>
<area shape="rect" href="vgic-v3_8c.html#abe9a2245dfa0d76d61c99b60f714a513" title=" " alt="" coords="999,1084,1121,1111"/>
<area shape="rect" href="vgic-v4_8c.html#af99c2f70dd91a57879b3a2f583e49a4a" title=" " alt="" coords="969,983,1151,1009"/>
<area shape="rect" href="vgic-v3_8c.html#a98c28ff2dc6b6965cef76e1be35233b1" title=" " alt="" coords="490,56,645,83"/>
<area shape="rect" href="vgic-v4_8c.html#a822de9f2b97fbc48164c88a7c0ac68f1" title=" " alt="" coords="477,208,657,235"/>
<area shape="rect" href="vgic-kvm-device_8c.html#af0cfcc44a93abc13df9a7e364c21cf32" title=" " alt="" coords="734,81,885,108"/>
<area shape="rect" href="vgic_8h.html#a01a6c3c40680e43017d7ba8ec7aadbac" title=" " alt="" coords="973,5,1147,32"/>
<area shape="rect" href="vgic-v3_8c.html#a8bd03445507515b9722165814955f6fa" title=" " alt="" coords="727,31,891,57"/>
<area shape="rect" href="arm_8c.html#a9cb9c824750594d8a51e8501bf5ad239" title=" " alt="" coords="730,132,889,159"/>
<area shape="rect" href="arm_8c.html#a19ccb22603ed9366d148065038f59de3" title=" " alt="" coords="718,183,901,209"/>
<area shape="rect" href="vgic-v4_8c.html#a84caa8431645d33bab1cc210aeb17801" title=" " alt="" coords="726,233,893,260"/>
<area shape="rect" href="vgic-v4_8c.html#aaa920282fd67f50873ceb0030afafc6a" title=" " alt="" coords="727,284,891,311"/>
<area shape="rect" href="kvm__main_8c.html#abaa3f5ff00150487b52dd21c1617bab6" title=" " alt="" coords="955,132,1165,159"/>
<area shape="rect" href="vgic_8c.html#a7f38a266ef3def3202e7e04aa40fd516" title=" " alt="" coords="1009,233,1111,260"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a8411f235847aa56055a7a2fefce226c6_icgraph.png" border="0" usemap="#avgic-init_8c_a8411f235847aa56055a7a2fefce226c6_icgraph" alt=""/></div>
<map name="avgic-init_8c_a8411f235847aa56055a7a2fefce226c6_icgraph" id="avgic-init_8c_a8411f235847aa56055a7a2fefce226c6_icgraph">
<area shape="rect" title=" " alt="" coords="404,13,595,39"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="177,5,356,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a05d84155ac79f812932547367b4445e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05d84155ac79f812932547367b4445e4">&#9670;&nbsp;</a></span>kvm_vgic_vcpu_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_vgic_vcpu_destroy </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00388">388</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;{</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    mutex_lock(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="vgic-init_8c.html#a1002af084b5fbafca1dab97541383180">__kvm_vgic_vcpu_destroy</a>(vcpu);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    mutex_unlock(&amp;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a05d84155ac79f812932547367b4445e4_cgraph.png" border="0" usemap="#avgic-init_8c_a05d84155ac79f812932547367b4445e4_cgraph" alt=""/></div>
<map name="avgic-init_8c_a05d84155ac79f812932547367b4445e4_cgraph" id="avgic-init_8c_a05d84155ac79f812932547367b4445e4_cgraph">
<area shape="rect" title=" " alt="" coords="5,35,184,61"/>
<area shape="rect" href="vgic-init_8c.html#a1002af084b5fbafca1dab97541383180" title=" " alt="" coords="232,35,425,61"/>
<area shape="rect" href="vgic_8c.html#a573eb768a56ea0b73e234771e0013ffc" title=" " alt="" coords="473,5,649,32"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a4bfec769cd9fe2bddb14200a6147fccd" title=" " alt="" coords="478,57,645,98"/>
<area shape="rect" href="vgic_8c.html#ac055f2fa0d463d3d287ee975bb80a9c5" title=" " alt="" coords="749,5,850,32"/>
<area shape="rect" href="vgic_8c.html#affa1a20a5bd9d67dc546c1ccaace3406" title=" " alt="" coords="949,5,1112,32"/>
<area shape="rect" href="vgic_8c.html#a7d513558f0ea4ecbc012c98b3522f797" title=" " alt="" coords="1189,5,1317,32"/>
<area shape="rect" href="kvm__main_8c.html#a103c02eb7ca545106f3130776c2a8897" title=" " alt="" coords="697,64,901,91"/>
<area shape="rect" href="kvm__main_8c.html#a3089edf2c0e5790aab7e8ed723f34b5b" title=" " alt="" coords="953,56,1109,83"/>
<area shape="rect" href="kvm__main_8c.html#aa6d7dea09a0b657f29e92f424e5d0633" title=" " alt="" coords="1160,81,1347,108"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a05d84155ac79f812932547367b4445e4_icgraph.png" border="0" usemap="#avgic-init_8c_a05d84155ac79f812932547367b4445e4_icgraph" alt=""/></div>
<map name="avgic-init_8c_a05d84155ac79f812932547367b4445e4_icgraph" id="avgic-init_8c_a05d84155ac79f812932547367b4445e4_icgraph">
<area shape="rect" title=" " alt="" coords="1705,79,1884,105"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1477,79,1657,105"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1257,53,1402,80"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1229,104,1429,131"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1029,53,1181,80"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="811,53,981,80"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="453,9,580,36"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="628,79,763,105"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,5,405,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="459,104,574,131"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,56,383,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,107,391,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,157,386,184"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,208,376,235"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,56,164,83"/>
</map>
</div>

</div>
</div>
<a id="a2eee0060a3bdcd2a9e8fe1451a3a3fc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2eee0060a3bdcd2a9e8fe1451a3a3fc2">&#9670;&nbsp;</a></span>kvm_vgic_vcpu_enable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_vgic_vcpu_enable </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00245">245</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;{</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span> (kvm_vgic_global_state.type == VGIC_V2)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="vgic-v2_8c.html#a4e8ee3d5f7c8fadbf0a645df67a1c5a2">vgic_v2_enable</a>(vcpu);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <a class="code" href="vgic-v3_8c.html#abe9a2245dfa0d76d61c99b60f714a513">vgic_v3_enable</a>(vcpu);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;}</div>
<div class="ttc" id="avgic-v2_8c_html_a4e8ee3d5f7c8fadbf0a645df67a1c5a2"><div class="ttname"><a href="vgic-v2_8c.html#a4e8ee3d5f7c8fadbf0a645df67a1c5a2">vgic_v2_enable</a></div><div class="ttdeci">void vgic_v2_enable(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v2_8c_source.html#l00260">vgic-v2.c:260</a></div></div>
<div class="ttc" id="avgic-v3_8c_html_abe9a2245dfa0d76d61c99b60f714a513"><div class="ttname"><a href="vgic-v3_8c.html#abe9a2245dfa0d76d61c99b60f714a513">vgic_v3_enable</a></div><div class="ttdeci">void vgic_v3_enable(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v3_8c_source.html#l00260">vgic-v3.c:260</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a2eee0060a3bdcd2a9e8fe1451a3a3fc2_cgraph.png" border="0" usemap="#avgic-init_8c_a2eee0060a3bdcd2a9e8fe1451a3a3fc2_cgraph" alt=""/></div>
<map name="avgic-init_8c_a2eee0060a3bdcd2a9e8fe1451a3a3fc2_cgraph" id="avgic-init_8c_a2eee0060a3bdcd2a9e8fe1451a3a3fc2_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,180,57"/>
<area shape="rect" href="vgic-v2_8c.html#a4e8ee3d5f7c8fadbf0a645df67a1c5a2" title=" " alt="" coords="228,5,351,32"/>
<area shape="rect" href="vgic-v3_8c.html#abe9a2245dfa0d76d61c99b60f714a513" title=" " alt="" coords="228,56,351,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a2eee0060a3bdcd2a9e8fe1451a3a3fc2_icgraph.png" border="0" usemap="#avgic-init_8c_a2eee0060a3bdcd2a9e8fe1451a3a3fc2_icgraph" alt=""/></div>
<map name="avgic-init_8c_a2eee0060a3bdcd2a9e8fe1451a3a3fc2_icgraph" id="avgic-init_8c_a2eee0060a3bdcd2a9e8fe1451a3a3fc2_icgraph">
<area shape="rect" title=" " alt="" coords="2821,492,2996,519"/>
<area shape="rect" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57" title=" " alt="" coords="2696,492,2773,519"/>
<area shape="rect" href="vgic-init_8c.html#a3c860e1d043352d9a02f4780b58e5af6" title=" " alt="" coords="2499,365,2609,392"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a6aadc4684bf7ca54e4a3d91f9e10310c" title=" " alt="" coords="2469,441,2639,468"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a78d5c53181a4adf55a58d8277fb751af" title=" " alt="" coords="2460,492,2648,519"/>
<area shape="rect" href="vgic-v2_8c.html#ac8de91a1f816dcd3b3edba1d074a1aca" title=" " alt="" coords="2465,593,2643,620"/>
<area shape="rect" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4" title=" " alt="" coords="2241,340,2393,367"/>
<area shape="rect" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4" title=" " alt="" coords="1086,411,1265,437"/>
<area shape="rect" href="arch__timer_8c.html#a5abc04b494763cd0814855753e56671f" title=" " alt="" coords="2004,213,2173,240"/>
<area shape="rect" href="arm_8c.html#a1cc94da0709805c40af7785f8c5811bf" title=" " alt="" coords="2004,163,2173,189"/>
<area shape="rect" href="vgic-irqfd_8c.html#aaba342a8b6308d37735bc46dbf9a6828" title=" " alt="" coords="2020,340,2157,367"/>
<area shape="rect" href="pmu-emul_8c.html#ab0f1f020b6774de3fb4ff4c8b4e45a5c" title=" " alt="" coords="845,411,1029,437"/>
<area shape="rect" href="pmu-emul_8c.html#ae6434d5e6ad74c608886c368e56d67bc" title=" " alt="" coords="846,360,1029,387"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="611,309,797,336"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,309,129,336"/>
<area shape="rect" href="arch__timer_8c.html#a7d59bcd17bdbce3017dbc041cd6e9629" title=" " alt="" coords="1763,239,1947,265"/>
<area shape="rect" href="arch__timer_8c.html#a1c4f03de391e27f5ba91d10b6dfab0bf" title=" " alt="" coords="1759,20,1951,47"/>
<area shape="rect" href="arch__timer_8c.html#a8fb06d125602c5b00fa9c213aa7e2520" title=" " alt="" coords="1772,71,1939,113"/>
<area shape="rect" href="arch__timer_8c.html#a11b9b6e6338bbec6085332661c934e91" title=" " alt="" coords="1321,184,1492,211"/>
<area shape="rect" href="arch__timer_8c.html#acea899fae895cedf39458ed51af3cb1a" title=" " alt="" coords="1796,137,1915,164"/>
<area shape="rect" href="arch__timer_8c.html#a7af96c32754607120bf365569aac71c0" title=" " alt="" coords="1764,289,1947,316"/>
<area shape="rect" href="arch__timer_8c.html#a27c9feb35e6d7126c054c3325fea59b0" title=" " alt="" coords="1547,249,1699,276"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="1343,259,1471,285"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="1119,259,1231,285"/>
<area shape="rect" href="arch__timer_8c.html#a4bf6ac76380146820b45b06feb3eab27" title=" " alt="" coords="1540,71,1707,97"/>
<area shape="rect" href="arm_8c.html#aaa51abf3d06fdaa95794b27f273278fb" title=" " alt="" coords="1327,75,1486,101"/>
<area shape="rect" href="emulate-nested_8c.html#a1920c02a997dd9975bec0ee02f6ae2c4" title=" " alt="" coords="1077,5,1273,32"/>
<area shape="rect" href="emulate-nested_8c.html#a1c3e31bd85e9c0590a018ada20a5e4bf" title=" " alt="" coords="1103,56,1248,83"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1111,157,1240,184"/>
<area shape="rect" href="kvm__main_8c.html#a31b6c41ce8eacbbdc56a276018989253" title=" " alt="" coords="1118,107,1233,133"/>
<area shape="rect" href="kvm__main_8c.html#a5dde35c5b74ce68a7dbb2f2006ce3e9e" title=" " alt="" coords="893,259,981,285"/>
<area shape="rect" href="handle__exit_8c.html#ae96aab7918301d55b908034db5855e3d" title=" " alt="" coords="870,5,1005,32"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="849,107,1025,133"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="623,99,785,125"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,157,336,184"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="857,208,1018,235"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="394,91,553,133"/>
<area shape="rect" href="arch__timer_8c.html#a0209ad4256c7a1fd5ea70b6abe030954" title=" " alt="" coords="1540,122,1707,163"/>
<area shape="rect" href="sys__regs_8c.html#a9457451d95fa776f653cff6c2a8d31f9" title=" " alt="" coords="1335,129,1478,156"/>
<area shape="rect" href="arch__timer_8c.html#a6ae73bff466fcdc60319f9726d53b571" title=" " alt="" coords="1541,305,1706,332"/>
<area shape="rect" href="vgic-irqfd_8c.html#ae7b7837b6e17bc60af3f4d81e9a4147e" title=" " alt="" coords="1755,340,1956,367"/>
<area shape="rect" href="vgic-irqfd_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1769,391,1941,417"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="1547,391,1699,417"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="1329,492,1484,519"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="1085,506,1266,547"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a37a5c9125b0504633553497ae8c7ce9c" title=" " alt="" coords="2252,441,2381,468"/>
<area shape="rect" href="vgic-kvm-device_8c.html#aee48777d58c65e5b91c0f85e2eae843e" title=" " alt="" coords="2252,391,2381,417"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a3bb10b83ef8325ecaa3671e9fe9c528c" title=" " alt="" coords="2251,492,2382,519"/>
<area shape="rect" href="vgic-init_8c.html#a8411f235847aa56055a7a2fefce226c6" title=" " alt="" coords="2221,593,2412,620"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="384,462,563,503"/>
</map>
</div>

</div>
</div>
<a id="ad052e8c724bfbb39c34281df23166a28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad052e8c724bfbb39c34281df23166a28">&#9670;&nbsp;</a></span>kvm_vgic_vcpu_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_vgic_vcpu_init </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="vgic-init_8c.html#ad052e8c724bfbb39c34281df23166a28">kvm_vgic_vcpu_init()</a> - Initialize static VGIC VCPU data structures and register VCPU-specific KVM iodevs</p>
<p>@vcpu: pointer to the VCPU being created and initialized</p>
<p>Only do initialization, but do not actually enable the VGIC CPU interface </p>

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00194">194</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;{</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keyword">struct </span>vgic_cpu *vgic_cpu = &amp;vcpu-&gt;arch.vgic_cpu;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keyword">struct </span>vgic_dist *dist = &amp;vcpu-&gt;kvm-&gt;arch.vgic;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    vgic_cpu-&gt;rd_iodev.base_addr = <a class="code" href="vgic_8h.html#ac91699b3ab8faf4d5222d998fb64b033">VGIC_ADDR_UNDEF</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    INIT_LIST_HEAD(&amp;vgic_cpu-&gt;ap_list_head);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    raw_spin_lock_init(&amp;vgic_cpu-&gt;ap_list_lock);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    atomic_set(&amp;vgic_cpu-&gt;vgic_v3.its_vpe.vlpi_count, 0);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">     * Enable and configure all SGIs to be edge-triggered and</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">     * configure all PPIs as level-triggered.</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; VGIC_NR_PRIVATE_IRQS; i++) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keyword">struct </span>vgic_irq *irq = &amp;vgic_cpu-&gt;private_irqs[i];</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        INIT_LIST_HEAD(&amp;irq-&gt;ap_list);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        raw_spin_lock_init(&amp;irq-&gt;irq_lock);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        irq-&gt;intid = i;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        irq-&gt;vcpu = NULL;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        irq-&gt;target_vcpu = vcpu;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        kref_init(&amp;irq-&gt;refcount);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="vgic_8h.html#a67cef97460e9a4080ae437e5a30113a7">vgic_irq_is_sgi</a>(i)) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="comment">/* SGIs */</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            irq-&gt;enabled = 1;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            irq-&gt;config = VGIC_CONFIG_EDGE;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="comment">/* PPIs */</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            irq-&gt;config = VGIC_CONFIG_LEVEL;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span> (!irqchip_in_kernel(vcpu-&gt;kvm))</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">     * If we are creating a VCPU with a GICv3 we must also register the</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">     * KVM io device for the redistributor that belongs to this VCPU.</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">if</span> (dist-&gt;vgic_model == KVM_DEV_TYPE_ARM_VGIC_V3) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        mutex_lock(&amp;vcpu-&gt;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        ret = <a class="code" href="vgic-mmio-v3_8c.html#a7c5d9bcbf29cb46bac8622d8bcc145b2">vgic_register_redist_iodev</a>(vcpu);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        mutex_unlock(&amp;vcpu-&gt;kvm-&gt;slots_lock);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;}</div>
<div class="ttc" id="avgic-mmio-v3_8c_html_a7c5d9bcbf29cb46bac8622d8bcc145b2"><div class="ttname"><a href="vgic-mmio-v3_8c.html#a7c5d9bcbf29cb46bac8622d8bcc145b2">vgic_register_redist_iodev</a></div><div class="ttdeci">int vgic_register_redist_iodev(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-mmio-v3_8c_source.html#l00746">vgic-mmio-v3.c:746</a></div></div>
<div class="ttc" id="avgic_8h_html_a67cef97460e9a4080ae437e5a30113a7"><div class="ttname"><a href="vgic_8h.html#a67cef97460e9a4080ae437e5a30113a7">vgic_irq_is_sgi</a></div><div class="ttdeci">#define vgic_irq_is_sgi(intid)</div><div class="ttdef"><b>Definition:</b> <a href="vgic_8h_source.html#l00021">vgic.h:21</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_ad052e8c724bfbb39c34281df23166a28_cgraph.png" border="0" usemap="#avgic-init_8c_ad052e8c724bfbb39c34281df23166a28_cgraph" alt=""/></div>
<map name="avgic-init_8c_ad052e8c724bfbb39c34281df23166a28_cgraph" id="avgic-init_8c_ad052e8c724bfbb39c34281df23166a28_cgraph">
<area shape="rect" title=" " alt="" coords="5,107,156,133"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a7c5d9bcbf29cb46bac8622d8bcc145b2" title=" " alt="" coords="204,99,355,141"/>
<area shape="rect" href="kvm__main_8c.html#a0afe5ce3e9ff1105328b06ec985e3374" title=" " alt="" coords="403,31,591,57"/>
<area shape="rect" href="vgic-v3_8c.html#a98c28ff2dc6b6965cef76e1be35233b1" title=" " alt="" coords="419,107,574,133"/>
<area shape="rect" href="vgic-v3_8c.html#a481ec0006dfd5a7ea125b9913de7ba47" title=" " alt="" coords="411,183,583,209"/>
<area shape="rect" href="kvm__main_8c.html#a75ccec7a81fef145fb3c3a3b5479a86f" title=" " alt="" coords="667,5,802,32"/>
<area shape="rect" href="vgic-kvm-device_8c.html#af0cfcc44a93abc13df9a7e364c21cf32" title=" " alt="" coords="659,56,810,83"/>
<area shape="rect" href="vgic_8h.html#a01a6c3c40680e43017d7ba8ec7aadbac" title=" " alt="" coords="879,132,1052,159"/>
<area shape="rect" href="vgic-v3_8c.html#a8bd03445507515b9722165814955f6fa" title=" " alt="" coords="653,157,817,184"/>
<area shape="rect" href="vgic_8h.html#ab5518fe56ac149d185ee8dc4f1cbedcb" title=" " alt="" coords="639,208,831,235"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_ad052e8c724bfbb39c34281df23166a28_icgraph.png" border="0" usemap="#avgic-init_8c_ad052e8c724bfbb39c34281df23166a28_icgraph" alt=""/></div>
<map name="avgic-init_8c_ad052e8c724bfbb39c34281df23166a28_icgraph" id="avgic-init_8c_ad052e8c724bfbb39c34281df23166a28_icgraph">
<area shape="rect" title=" " alt="" coords="473,5,624,32"/>
<area shape="rect" href="arm_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="253,5,425,32"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="5,5,205,32"/>
</map>
</div>

</div>
</div>
<a id="a39a12fe5ed5534efda33bb215a320a57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39a12fe5ed5534efda33bb215a320a57">&#9670;&nbsp;</a></span>vgic_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vgic_init </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00262">262</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;{</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keyword">struct </span>vgic_dist *dist = &amp;kvm-&gt;arch.vgic;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordtype">int</span> ret = 0, i;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> idx;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    lockdep_assert_held(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">if</span> (vgic_initialized(kvm))</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">/* Are we also in the middle of creating a VCPU? */</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> (kvm-&gt;created_vcpus != atomic_read(&amp;kvm-&gt;online_vcpus))</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">return</span> -EBUSY;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">/* freeze the number of spis */</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span> (!dist-&gt;nr_spis)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        dist-&gt;nr_spis = VGIC_NR_IRQS_LEGACY - VGIC_NR_PRIVATE_IRQS;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    ret = <a class="code" href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b">kvm_vgic_dist_init</a>(kvm, dist-&gt;nr_spis);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">/* Initialize groups on CPUs created before the VGIC type was known */</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    kvm_for_each_vcpu(idx, vcpu, kvm) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keyword">struct </span>vgic_cpu *vgic_cpu = &amp;vcpu-&gt;arch.vgic_cpu;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; VGIC_NR_PRIVATE_IRQS; i++) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="keyword">struct </span>vgic_irq *irq = &amp;vgic_cpu-&gt;private_irqs[i];</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">switch</span> (dist-&gt;vgic_model) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keywordflow">case</span> KVM_DEV_TYPE_ARM_VGIC_V3:</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                irq-&gt;group = 1;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                irq-&gt;mpidr = kvm_vcpu_get_mpidr_aff(vcpu);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keywordflow">case</span> KVM_DEV_TYPE_ARM_VGIC_V2:</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                irq-&gt;group = 0;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                irq-&gt;targets = 1U &lt;&lt; idx;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                ret = -EINVAL;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e">vgic_has_its</a>(kvm))</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <a class="code" href="vgic-its_8c.html#afd97b5d03d2b30ae4481443cdea2e739">vgic_lpi_translation_cache_init</a>(kvm);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">     * If we have GICv4.1 enabled, unconditionnaly request enable the</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">     * v4 support so that we get HW-accelerated vSGIs. Otherwise, only</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">     * enable it if we present a virtual ITS to the guest.</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f">vgic_supports_direct_msis</a>(kvm)) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        ret = <a class="code" href="vgic-v4_8c.html#a802a906ad744a75b5af33bbd6b31237c">vgic_v4_init</a>(kvm);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    kvm_for_each_vcpu(idx, vcpu, kvm)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <a class="code" href="vgic-init_8c.html#a2eee0060a3bdcd2a9e8fe1451a3a3fc2">kvm_vgic_vcpu_enable</a>(vcpu);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    ret = <a class="code" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71">kvm_vgic_setup_default_irq_routing</a>(kvm);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <a class="code" href="vgic-debug_8c.html#a42534d23071b4f3c441c5f82f9e5c1ce">vgic_debug_init</a>(kvm);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">     * If userspace didn&#39;t set the GIC implementation revision,</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">     * default to the latest and greatest. You know want it.</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span> (!dist-&gt;implementation_rev)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        dist-&gt;implementation_rev = KVM_VGIC_IMP_REV_LATEST;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    dist-&gt;initialized = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;out:</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
<div class="ttc" id="avgic-debug_8c_html_a42534d23071b4f3c441c5f82f9e5c1ce"><div class="ttname"><a href="vgic-debug_8c.html#a42534d23071b4f3c441c5f82f9e5c1ce">vgic_debug_init</a></div><div class="ttdeci">void vgic_debug_init(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-debug_8c_source.html#l00272">vgic-debug.c:272</a></div></div>
<div class="ttc" id="avgic-init_8c_html_a0f9be5cc88c88f6c0180c53b72818d3b"><div class="ttname"><a href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b">kvm_vgic_dist_init</a></div><div class="ttdeci">static int kvm_vgic_dist_init(struct kvm *kvm, unsigned int nr_spis)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-init_8c_source.html#l00140">vgic-init.c:140</a></div></div>
<div class="ttc" id="avgic-init_8c_html_a2eee0060a3bdcd2a9e8fe1451a3a3fc2"><div class="ttname"><a href="vgic-init_8c.html#a2eee0060a3bdcd2a9e8fe1451a3a3fc2">kvm_vgic_vcpu_enable</a></div><div class="ttdeci">static void kvm_vgic_vcpu_enable(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-init_8c_source.html#l00245">vgic-init.c:245</a></div></div>
<div class="ttc" id="avgic-irqfd_8c_html_ab5dcaa98f287aec5083bd60daf115d71"><div class="ttname"><a href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71">kvm_vgic_setup_default_irq_routing</a></div><div class="ttdeci">int kvm_vgic_setup_default_irq_routing(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-irqfd_8c_source.html#l00135">vgic-irqfd.c:135</a></div></div>
<div class="ttc" id="avgic-its_8c_html_afd97b5d03d2b30ae4481443cdea2e739"><div class="ttname"><a href="vgic-its_8c.html#afd97b5d03d2b30ae4481443cdea2e739">vgic_lpi_translation_cache_init</a></div><div class="ttdeci">void vgic_lpi_translation_cache_init(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-its_8c_source.html#l01903">vgic-its.c:1903</a></div></div>
<div class="ttc" id="avgic-v4_8c_html_a802a906ad744a75b5af33bbd6b31237c"><div class="ttname"><a href="vgic-v4_8c.html#a802a906ad744a75b5af33bbd6b31237c">vgic_v4_init</a></div><div class="ttdeci">int vgic_v4_init(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-v4_8c_source.html#l00239">vgic-v4.c:239</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a39a12fe5ed5534efda33bb215a320a57_cgraph.png" border="0" usemap="#avgic-init_8c_a39a12fe5ed5534efda33bb215a320a57_cgraph" alt=""/></div>
<map name="avgic-init_8c_a39a12fe5ed5534efda33bb215a320a57_cgraph" id="avgic-init_8c_a39a12fe5ed5534efda33bb215a320a57_cgraph">
<area shape="rect" title=" " alt="" coords="5,477,83,504"/>
<area shape="rect" href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b" title=" " alt="" coords="149,5,293,32"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="131,142,312,183"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="1728,157,1831,184"/>
<area shape="rect" href="vgic-init_8c.html#a2eee0060a3bdcd2a9e8fe1451a3a3fc2" title=" " alt="" coords="134,579,309,605"/>
<area shape="rect" href="vgic-debug_8c.html#a42534d23071b4f3c441c5f82f9e5c1ce" title=" " alt="" coords="159,629,283,656"/>
<area shape="rect" href="vgic-its_8c.html#afd97b5d03d2b30ae4481443cdea2e739" title=" " alt="" coords="147,681,296,722"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="804,56,999,83"/>
<area shape="rect" href="vgic-v4_8c.html#a802a906ad744a75b5af33bbd6b31237c" title=" " alt="" coords="171,528,271,555"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="374,149,529,176"/>
<area shape="rect" href="irqchip_8c.html#a5ae37186e6e6d1594767f83df8bab64a" title=" " alt="" coords="591,107,756,133"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="597,157,749,184"/>
<area shape="rect" href="vgic-irqfd_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="815,157,987,184"/>
<area shape="rect" href="vgic-irqfd_8c.html#affb5599a3efafc186b72e78e4b31e904" title=" " alt="" coords="1086,157,1195,184"/>
<area shape="rect" href="vgic-irqfd_8c.html#aaba342a8b6308d37735bc46dbf9a6828" title=" " alt="" coords="1072,319,1209,345"/>
<area shape="rect" href="vgic-irqfd_8c.html#a93415dbe2d5c7166c8f3f91be7c5d5da" title=" " alt="" coords="1283,107,1429,133"/>
<area shape="rect" href="vgic-its_8c.html#a53bf66e96dae9553e637fa69e8835365" title=" " alt="" coords="1283,284,1429,311"/>
<area shape="rect" href="vgic-its_8c.html#a352c8627ccf81a8154ae2275c7d50659" title=" " alt="" coords="1477,361,1645,402"/>
<area shape="rect" href="vgic-its_8c.html#ad62375be0591178764e98b79cd7217bf" title=" " alt="" coords="1485,309,1638,336"/>
<area shape="rect" href="vgic-its_8c.html#a94bbb30efc49ad5494a7f4b1410dbe01" title=" " alt="" coords="1500,259,1623,285"/>
<area shape="rect" href="vgic-its_8c.html#ab8e3bef933af0cc51b05259d801be26d" title=" " alt="" coords="1929,313,2092,340"/>
<area shape="rect" href="vgic_8c.html#ac055f2fa0d463d3d287ee975bb80a9c5" title=" " alt="" coords="1729,364,1830,391"/>
<area shape="rect" href="vgic_8c.html#a1e208ac24f54fa95ba74797758c5b84c" title=" " alt="" coords="1694,415,1865,441"/>
<area shape="rect" href="vgic-its_8c.html#aa5825fcbd841b62853870d25976d018b" title=" " alt="" coords="2172,263,2348,289"/>
<area shape="rect" href="vgic_8h.html#a43d39599f0fd2d973c5af8d6045e0f91" title=" " alt="" coords="2193,401,2327,428"/>
<area shape="rect" href="vgic_8c.html#affa1a20a5bd9d67dc546c1ccaace3406" title=" " alt="" coords="2179,325,2341,352"/>
<area shape="rect" href="vgic_8c.html#a7d513558f0ea4ecbc012c98b3522f797" title=" " alt="" coords="2412,325,2540,352"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1949,604,2072,631"/>
<area shape="rect" href="vgic_8c.html#a10a21280f37c620b743df86980f6d247" title=" " alt="" coords="1939,516,2082,543"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="2156,579,2364,605"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="2183,629,2337,656"/>
<area shape="rect" href="vgic_8h.html#a1109d873011f89a4acb4fd461f9f0a45" title=" " alt="" coords="2202,516,2318,543"/>
<area shape="rect" href="vgic-its_8c.html#a3fe23d687675cef46a95e36cf14d04e1" title=" " alt="" coords="1704,259,1855,285"/>
<area shape="rect" href="vgic-its_8c.html#a0fb230e293b92c9fb746ad7b97ac68d5" title=" " alt="" coords="1939,161,2082,188"/>
<area shape="rect" href="vgic-its_8c.html#ae32cde43818922d2ecf800a3de102b75" title=" " alt="" coords="1975,111,2046,137"/>
<area shape="rect" href="vgic-its_8c.html#ad9756268e1c22946f868e3255f916aa6" title=" " alt="" coords="1913,212,2108,239"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#aa37f9ed0ed7921675bc4167d4a9d9261" title=" " alt="" coords="1941,263,2080,289"/>
<area shape="rect" href="vgic-its_8c.html#aeb2ca1f1a8fef2826c3c7e466dad2cb7" title=" " alt="" coords="2201,111,2319,137"/>
<area shape="rect" href="kvm__main_8c.html#acb4d46ae6cc918253046320805f63a95" title=" " alt="" coords="1700,208,1859,235"/>
<area shape="rect" href="kvm__main_8c.html#a94bf2e0af8d9af8807a6a92ffb01cc1c" title=" " alt="" coords="1915,60,2106,87"/>
<area shape="rect" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4" title=" " alt="" coords="1485,427,1637,453"/>
<area shape="rect" href="vgic_8c.html#a7f38a266ef3def3202e7e04aa40fd516" title=" " alt="" coords="1729,465,1830,492"/>
<area shape="rect" href="vgic-init_8c.html#a3c860e1d043352d9a02f4780b58e5af6" title=" " alt="" coords="1724,567,1835,593"/>
<area shape="rect" href="vgic_8c.html#a19d9c44a40cc76ccbd25bd8e0ec38a08" title=" " alt="" coords="1693,516,1865,543"/>
<area shape="rect" href="vgic_8c.html#afeaf79de85450ed5fb52dbd7bd8c6617" title=" " alt="" coords="1961,465,2061,492"/>
<area shape="rect" href="vgic-v2_8c.html#a4e8ee3d5f7c8fadbf0a645df67a1c5a2" title=" " alt="" coords="390,629,513,656"/>
<area shape="rect" href="vgic-v3_8c.html#abe9a2245dfa0d76d61c99b60f714a513" title=" " alt="" coords="390,680,513,707"/>
<area shape="rect" href="vgic-v4_8c.html#af99c2f70dd91a57879b3a2f583e49a4a" title=" " alt="" coords="360,579,543,605"/>
<area shape="rect" href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce" title=" " alt="" coords="381,528,521,555"/>
<area shape="rect" href="vgic-v4_8c.html#ac22161596c9858cc700bab08c03fc422" title=" " alt="" coords="1047,600,1235,627"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a39a12fe5ed5534efda33bb215a320a57_icgraph.png" border="0" usemap="#avgic-init_8c_a39a12fe5ed5534efda33bb215a320a57_icgraph" alt=""/></div>
<map name="avgic-init_8c_a39a12fe5ed5534efda33bb215a320a57_icgraph" id="avgic-init_8c_a39a12fe5ed5534efda33bb215a320a57_icgraph">
<area shape="rect" title=" " alt="" coords="2693,308,2771,335"/>
<area shape="rect" href="vgic-init_8c.html#a3c860e1d043352d9a02f4780b58e5af6" title=" " alt="" coords="2496,257,2607,284"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a6aadc4684bf7ca54e4a3d91f9e10310c" title=" " alt="" coords="2466,409,2637,436"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a78d5c53181a4adf55a58d8277fb751af" title=" " alt="" coords="2457,359,2645,385"/>
<area shape="rect" href="vgic-v2_8c.html#ac8de91a1f816dcd3b3edba1d074a1aca" title=" " alt="" coords="2462,308,2641,335"/>
<area shape="rect" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4" title=" " alt="" coords="2238,257,2390,284"/>
<area shape="rect" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4" title=" " alt="" coords="1091,493,1269,520"/>
<area shape="rect" href="arch__timer_8c.html#a5abc04b494763cd0814855753e56671f" title=" " alt="" coords="2001,283,2171,309"/>
<area shape="rect" href="arm_8c.html#a1cc94da0709805c40af7785f8c5811bf" title=" " alt="" coords="2001,232,2171,259"/>
<area shape="rect" href="vgic-irqfd_8c.html#aaba342a8b6308d37735bc46dbf9a6828" title=" " alt="" coords="2017,93,2155,120"/>
<area shape="rect" href="pmu-emul_8c.html#ab0f1f020b6774de3fb4ff4c8b4e45a5c" title=" " alt="" coords="851,493,1035,520"/>
<area shape="rect" href="pmu-emul_8c.html#ae6434d5e6ad74c608886c368e56d67bc" title=" " alt="" coords="852,544,1035,571"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="611,443,797,469"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,443,129,469"/>
<area shape="rect" href="arch__timer_8c.html#a7d59bcd17bdbce3017dbc041cd6e9629" title=" " alt="" coords="1761,144,1945,171"/>
<area shape="rect" href="arch__timer_8c.html#a1c4f03de391e27f5ba91d10b6dfab0bf" title=" " alt="" coords="1757,371,1949,397"/>
<area shape="rect" href="arch__timer_8c.html#a8fb06d125602c5b00fa9c213aa7e2520" title=" " alt="" coords="1769,305,1936,346"/>
<area shape="rect" href="arch__timer_8c.html#a11b9b6e6338bbec6085332661c934e91" title=" " alt="" coords="1319,191,1489,217"/>
<area shape="rect" href="arch__timer_8c.html#acea899fae895cedf39458ed51af3cb1a" title=" " alt="" coords="1793,253,1912,280"/>
<area shape="rect" href="arch__timer_8c.html#a7af96c32754607120bf365569aac71c0" title=" " alt="" coords="1761,435,1944,461"/>
<area shape="rect" href="arch__timer_8c.html#a27c9feb35e6d7126c054c3325fea59b0" title=" " alt="" coords="1545,141,1697,168"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="1340,140,1468,167"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="1124,139,1236,165"/>
<area shape="rect" href="arch__timer_8c.html#a4bf6ac76380146820b45b06feb3eab27" title=" " alt="" coords="1537,312,1704,339"/>
<area shape="rect" href="arm_8c.html#aaa51abf3d06fdaa95794b27f273278fb" title=" " alt="" coords="1325,308,1483,335"/>
<area shape="rect" href="emulate-nested_8c.html#a1920c02a997dd9975bec0ee02f6ae2c4" title=" " alt="" coords="845,341,1041,368"/>
<area shape="rect" href="emulate-nested_8c.html#a1c3e31bd85e9c0590a018ada20a5e4bf" title=" " alt="" coords="1107,240,1253,267"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1115,189,1245,216"/>
<area shape="rect" href="kvm__main_8c.html#a31b6c41ce8eacbbdc56a276018989253" title=" " alt="" coords="1123,341,1237,368"/>
<area shape="rect" href="kvm__main_8c.html#a5dde35c5b74ce68a7dbb2f2006ce3e9e" title=" " alt="" coords="899,392,987,419"/>
<area shape="rect" href="handle__exit_8c.html#ae96aab7918301d55b908034db5855e3d" title=" " alt="" coords="637,316,771,343"/>
<area shape="rect" href="emulate-nested_8c.html#af5e2eb745d8ac6415fe941ebe754171d" title=" " alt="" coords="852,291,1035,317"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="855,139,1031,165"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="623,168,785,195"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,168,336,195"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="863,240,1024,267"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="394,161,553,202"/>
<area shape="rect" href="arch__timer_8c.html#a0209ad4256c7a1fd5ea70b6abe030954" title=" " alt="" coords="1537,246,1704,287"/>
<area shape="rect" href="sys__regs_8c.html#a9457451d95fa776f653cff6c2a8d31f9" title=" " alt="" coords="1333,253,1475,280"/>
<area shape="rect" href="arch__timer_8c.html#a6ae73bff466fcdc60319f9726d53b571" title=" " alt="" coords="1538,436,1703,463"/>
<area shape="rect" href="vgic-irqfd_8c.html#ae7b7837b6e17bc60af3f4d81e9a4147e" title=" " alt="" coords="1752,43,1953,69"/>
<area shape="rect" href="vgic-irqfd_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1767,93,1939,120"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="1545,79,1697,105"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="1327,68,1481,95"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="1089,22,1271,63"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a37a5c9125b0504633553497ae8c7ce9c" title=" " alt="" coords="2249,409,2379,436"/>
<area shape="rect" href="vgic-kvm-device_8c.html#aee48777d58c65e5b91c0f85e2eae843e" title=" " alt="" coords="2249,460,2379,487"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a3bb10b83ef8325ecaa3671e9fe9c528c" title=" " alt="" coords="2249,359,2379,385"/>
<area shape="rect" href="vgic-init_8c.html#a8411f235847aa56055a7a2fefce226c6" title=" " alt="" coords="2219,308,2409,335"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="384,541,563,582"/>
</map>
</div>

</div>
</div>
<a id="a3c860e1d043352d9a02f4780b58e5af6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c860e1d043352d9a02f4780b58e5af6">&#9670;&nbsp;</a></span>vgic_lazy_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vgic_lazy_init </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>vgic_lazy_init: Lazy init is only allowed if the GIC exposed to the guest is a GICv2. A GICv3 must be explicitly initialized by userspace using the KVM_DEV_ARM_VGIC_GRP_CTRL KVM_DEVICE group. @kvm: kvm struct pointer </p>

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00423">423</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;{</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">if</span> (unlikely(!vgic_initialized(kvm))) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">         * We only provide the automatic initialization of the VGIC</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">         * for the legacy case of a GICv2. Any other type must</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">         * be explicitly initialized once setup with the respective</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">         * KVM device call.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">if</span> (kvm-&gt;arch.vgic.vgic_model != KVM_DEV_TYPE_ARM_VGIC_V2)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keywordflow">return</span> -EBUSY;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        mutex_lock(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        ret = <a class="code" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57">vgic_init</a>(kvm);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        mutex_unlock(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;}</div>
<div class="ttc" id="avgic-init_8c_html_a39a12fe5ed5534efda33bb215a320a57"><div class="ttname"><a href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57">vgic_init</a></div><div class="ttdeci">int vgic_init(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="vgic-init_8c_source.html#l00262">vgic-init.c:262</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a3c860e1d043352d9a02f4780b58e5af6_cgraph.png" border="0" usemap="#avgic-init_8c_a3c860e1d043352d9a02f4780b58e5af6_cgraph" alt=""/></div>
<map name="avgic-init_8c_a3c860e1d043352d9a02f4780b58e5af6_cgraph" id="avgic-init_8c_a3c860e1d043352d9a02f4780b58e5af6_cgraph">
<area shape="rect" title=" " alt="" coords="5,313,116,340"/>
<area shape="rect" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57" title=" " alt="" coords="164,448,241,475"/>
<area shape="rect" href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b" title=" " alt="" coords="308,499,452,525"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="289,382,471,423"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="1887,448,1989,475"/>
<area shape="rect" href="vgic-init_8c.html#a2eee0060a3bdcd2a9e8fe1451a3a3fc2" title=" " alt="" coords="293,600,467,627"/>
<area shape="rect" href="vgic-debug_8c.html#a42534d23071b4f3c441c5f82f9e5c1ce" title=" " alt="" coords="318,651,442,677"/>
<area shape="rect" href="vgic-its_8c.html#afd97b5d03d2b30ae4481443cdea2e739" title=" " alt="" coords="305,317,455,358"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="963,524,1157,551"/>
<area shape="rect" href="vgic-v4_8c.html#a802a906ad744a75b5af33bbd6b31237c" title=" " alt="" coords="330,265,430,292"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="533,389,687,416"/>
<area shape="rect" href="irqchip_8c.html#a5ae37186e6e6d1594767f83df8bab64a" title=" " alt="" coords="749,393,915,420"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="756,343,908,369"/>
<area shape="rect" href="vgic-irqfd_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="974,343,1146,369"/>
<area shape="rect" href="vgic-irqfd_8c.html#affb5599a3efafc186b72e78e4b31e904" title=" " alt="" coords="1245,345,1354,372"/>
<area shape="rect" href="vgic-irqfd_8c.html#aaba342a8b6308d37735bc46dbf9a6828" title=" " alt="" coords="1231,267,1368,293"/>
<area shape="rect" href="vgic-irqfd_8c.html#a93415dbe2d5c7166c8f3f91be7c5d5da" title=" " alt="" coords="1441,347,1588,373"/>
<area shape="rect" href="vgic-its_8c.html#a53bf66e96dae9553e637fa69e8835365" title=" " alt="" coords="1441,296,1588,323"/>
<area shape="rect" href="vgic-its_8c.html#a352c8627ccf81a8154ae2275c7d50659" title=" " alt="" coords="1636,230,1804,271"/>
<area shape="rect" href="vgic-its_8c.html#ad62375be0591178764e98b79cd7217bf" title=" " alt="" coords="1643,296,1797,323"/>
<area shape="rect" href="vgic-its_8c.html#a94bbb30efc49ad5494a7f4b1410dbe01" title=" " alt="" coords="1659,347,1781,373"/>
<area shape="rect" href="vgic-its_8c.html#ab8e3bef933af0cc51b05259d801be26d" title=" " alt="" coords="2088,284,2251,311"/>
<area shape="rect" href="vgic_8c.html#ac055f2fa0d463d3d287ee975bb80a9c5" title=" " alt="" coords="1887,233,1989,260"/>
<area shape="rect" href="vgic_8c.html#a1e208ac24f54fa95ba74797758c5b84c" title=" " alt="" coords="1853,183,2023,209"/>
<area shape="rect" href="vgic-its_8c.html#aa5825fcbd841b62853870d25976d018b" title=" " alt="" coords="2331,360,2507,387"/>
<area shape="rect" href="vgic_8h.html#a43d39599f0fd2d973c5af8d6045e0f91" title=" " alt="" coords="2351,208,2486,235"/>
<area shape="rect" href="vgic_8c.html#affa1a20a5bd9d67dc546c1ccaace3406" title=" " alt="" coords="2337,284,2500,311"/>
<area shape="rect" href="vgic_8c.html#a7d513558f0ea4ecbc012c98b3522f797" title=" " alt="" coords="2571,284,2699,311"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="2108,31,2231,57"/>
<area shape="rect" href="vgic_8c.html#a10a21280f37c620b743df86980f6d247" title=" " alt="" coords="2098,132,2241,159"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="2315,56,2523,83"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="2342,5,2495,32"/>
<area shape="rect" href="vgic_8h.html#a1109d873011f89a4acb4fd461f9f0a45" title=" " alt="" coords="2361,132,2477,159"/>
<area shape="rect" href="vgic-its_8c.html#a3fe23d687675cef46a95e36cf14d04e1" title=" " alt="" coords="1863,347,2013,373"/>
<area shape="rect" href="vgic-its_8c.html#a0fb230e293b92c9fb746ad7b97ac68d5" title=" " alt="" coords="2098,487,2241,513"/>
<area shape="rect" href="vgic-its_8c.html#ae32cde43818922d2ecf800a3de102b75" title=" " alt="" coords="2134,436,2205,463"/>
<area shape="rect" href="vgic-its_8c.html#ad9756268e1c22946f868e3255f916aa6" title=" " alt="" coords="2072,385,2267,412"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#aa37f9ed0ed7921675bc4167d4a9d9261" title=" " alt="" coords="2100,335,2239,361"/>
<area shape="rect" href="vgic-its_8c.html#aeb2ca1f1a8fef2826c3c7e466dad2cb7" title=" " alt="" coords="2359,436,2478,463"/>
<area shape="rect" href="kvm__main_8c.html#acb4d46ae6cc918253046320805f63a95" title=" " alt="" coords="1859,397,2017,424"/>
<area shape="rect" href="kvm__main_8c.html#a94bf2e0af8d9af8807a6a92ffb01cc1c" title=" " alt="" coords="2074,537,2265,564"/>
<area shape="rect" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4" title=" " alt="" coords="1644,179,1796,205"/>
<area shape="rect" href="vgic_8c.html#a7f38a266ef3def3202e7e04aa40fd516" title=" " alt="" coords="1887,132,1989,159"/>
<area shape="rect" href="vgic_8c.html#a19d9c44a40cc76ccbd25bd8e0ec38a08" title=" " alt="" coords="1852,81,2024,108"/>
<area shape="rect" href="vgic_8c.html#afeaf79de85450ed5fb52dbd7bd8c6617" title=" " alt="" coords="2119,81,2219,108"/>
<area shape="rect" href="vgic-v2_8c.html#a4e8ee3d5f7c8fadbf0a645df67a1c5a2" title=" " alt="" coords="549,600,671,627"/>
<area shape="rect" href="vgic-v3_8c.html#abe9a2245dfa0d76d61c99b60f714a513" title=" " alt="" coords="549,651,671,677"/>
<area shape="rect" href="vgic-v4_8c.html#af99c2f70dd91a57879b3a2f583e49a4a" title=" " alt="" coords="519,229,701,256"/>
<area shape="rect" href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce" title=" " alt="" coords="540,280,680,307"/>
<area shape="rect" href="vgic-v4_8c.html#ac22161596c9858cc700bab08c03fc422" title=" " alt="" coords="1205,77,1393,104"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a3c860e1d043352d9a02f4780b58e5af6_icgraph.png" border="0" usemap="#avgic-init_8c_a3c860e1d043352d9a02f4780b58e5af6_icgraph" alt=""/></div>
<map name="avgic-init_8c_a3c860e1d043352d9a02f4780b58e5af6_icgraph" id="avgic-init_8c_a3c860e1d043352d9a02f4780b58e5af6_icgraph">
<area shape="rect" title=" " alt="" coords="2403,567,2513,593"/>
<area shape="rect" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4" title=" " alt="" coords="2203,487,2355,513"/>
<area shape="rect" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4" title=" " alt="" coords="1067,487,1246,513"/>
<area shape="rect" href="arch__timer_8c.html#a5abc04b494763cd0814855753e56671f" title=" " alt="" coords="1985,296,2155,323"/>
<area shape="rect" href="arm_8c.html#a1cc94da0709805c40af7785f8c5811bf" title=" " alt="" coords="1985,436,2155,463"/>
<area shape="rect" href="vgic-irqfd_8c.html#aaba342a8b6308d37735bc46dbf9a6828" title=" " alt="" coords="2001,537,2139,564"/>
<area shape="rect" href="pmu-emul_8c.html#ab0f1f020b6774de3fb4ff4c8b4e45a5c" title=" " alt="" coords="827,487,1011,513"/>
<area shape="rect" href="pmu-emul_8c.html#ae6434d5e6ad74c608886c368e56d67bc" title=" " alt="" coords="827,537,1010,564"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="591,411,778,437"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,263,129,289"/>
<area shape="rect" href="arch__timer_8c.html#a7d59bcd17bdbce3017dbc041cd6e9629" title=" " alt="" coords="1745,109,1929,136"/>
<area shape="rect" href="arch__timer_8c.html#a1c4f03de391e27f5ba91d10b6dfab0bf" title=" " alt="" coords="1741,355,1933,381"/>
<area shape="rect" href="arch__timer_8c.html#a8fb06d125602c5b00fa9c213aa7e2520" title=" " alt="" coords="1753,289,1920,330"/>
<area shape="rect" href="arch__timer_8c.html#a11b9b6e6338bbec6085332661c934e91" title=" " alt="" coords="1303,183,1473,209"/>
<area shape="rect" href="arch__timer_8c.html#acea899fae895cedf39458ed51af3cb1a" title=" " alt="" coords="1777,237,1896,264"/>
<area shape="rect" href="arch__timer_8c.html#a7af96c32754607120bf365569aac71c0" title=" " alt="" coords="1745,412,1928,439"/>
<area shape="rect" href="arch__timer_8c.html#a27c9feb35e6d7126c054c3325fea59b0" title=" " alt="" coords="1529,91,1681,117"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="1324,56,1452,83"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="629,5,741,32"/>
<area shape="rect" href="arch__timer_8c.html#a4bf6ac76380146820b45b06feb3eab27" title=" " alt="" coords="1521,296,1688,323"/>
<area shape="rect" href="arm_8c.html#aaa51abf3d06fdaa95794b27f273278fb" title=" " alt="" coords="1309,284,1467,311"/>
<area shape="rect" href="emulate-nested_8c.html#a1920c02a997dd9975bec0ee02f6ae2c4" title=" " alt="" coords="1059,284,1255,311"/>
<area shape="rect" href="emulate-nested_8c.html#a1c3e31bd85e9c0590a018ada20a5e4bf" title=" " alt="" coords="1084,233,1229,260"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1092,183,1221,209"/>
<area shape="rect" href="kvm__main_8c.html#a31b6c41ce8eacbbdc56a276018989253" title=" " alt="" coords="1099,81,1214,108"/>
<area shape="rect" href="kvm__main_8c.html#a5dde35c5b74ce68a7dbb2f2006ce3e9e" title=" " alt="" coords="1113,360,1201,387"/>
<area shape="rect" href="handle__exit_8c.html#ae96aab7918301d55b908034db5855e3d" title=" " alt="" coords="617,335,752,361"/>
<area shape="rect" href="emulate-nested_8c.html#af5e2eb745d8ac6415fe941ebe754171d" title=" " alt="" coords="827,233,1010,260"/>
<area shape="rect" href="emulate-nested_8c.html#a5759b383dbf067b5e90235d5fd032ab5" title=" " alt="" coords="598,183,771,209"/>
<area shape="rect" href="handle__exit_8c.html#a5c24d46393da9651d3133e2377fd7a69" title=" " alt="" coords="637,233,733,260"/>
<area shape="rect" href="handle__exit_8c.html#aeaf983f5c40202edc8b07a76603330cd" title=" " alt="" coords="637,284,732,311"/>
<area shape="rect" href="sys__regs_8c.html#a315e661b6f1cb224596267000909a1ac" title=" " alt="" coords="384,199,543,225"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="831,132,1007,159"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="603,132,766,159"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,140,336,167"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="838,335,999,361"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="384,133,543,174"/>
<area shape="rect" href="kvm__main_8c.html#a2372c616bc55bc4cd3446660cb7322fc" title=" " alt="" coords="879,31,958,57"/>
<area shape="rect" href="arch__timer_8c.html#a0209ad4256c7a1fd5ea70b6abe030954" title=" " alt="" coords="1521,230,1688,271"/>
<area shape="rect" href="sys__regs_8c.html#a9457451d95fa776f653cff6c2a8d31f9" title=" " alt="" coords="1317,233,1459,260"/>
<area shape="rect" href="arch__timer_8c.html#a6ae73bff466fcdc60319f9726d53b571" title=" " alt="" coords="1522,423,1687,449"/>
<area shape="rect" href="vgic-irqfd_8c.html#ae7b7837b6e17bc60af3f4d81e9a4147e" title=" " alt="" coords="1736,537,1937,564"/>
<area shape="rect" href="vgic-irqfd_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1751,588,1923,615"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="1529,587,1681,613"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="1311,585,1465,612"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="1066,577,1247,618"/>
<area shape="rect" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57" title=" " alt="" coords="880,613,957,640"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a6aadc4684bf7ca54e4a3d91f9e10310c" title=" " alt="" coords="599,664,770,691"/>
<area shape="rect" href="vgic-kvm-device_8c.html#a78d5c53181a4adf55a58d8277fb751af" title=" " alt="" coords="591,563,779,589"/>
<area shape="rect" href="vgic-v2_8c.html#ac8de91a1f816dcd3b3edba1d074a1aca" title=" " alt="" coords="595,613,774,640"/>
</map>
</div>

</div>
</div>
<a id="a489028c2499bdfbe87388b96a832b3ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a489028c2499bdfbe87388b96a832b3ed">&#9670;&nbsp;</a></span>vgic_maintenance_handler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static irqreturn_t vgic_maintenance_handler </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>irq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00518">518</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;{</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">     * We cannot rely on the vgic maintenance interrupt to be</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">     * delivered synchronously. This means we can only use it to</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">     * exit the VM, and we perform the handling of EOIed</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">     * interrupts on the exit path (see vgic_fold_lr_state).</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">return</span> IRQ_HANDLED;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="vgic-init_8c_a489028c2499bdfbe87388b96a832b3ed_icgraph.png" border="0" usemap="#avgic-init_8c_a489028c2499bdfbe87388b96a832b3ed_icgraph" alt=""/></div>
<map name="avgic-init_8c_a489028c2499bdfbe87388b96a832b3ed_icgraph" id="avgic-init_8c_a489028c2499bdfbe87388b96a832b3ed_icgraph">
<area shape="rect" title=" " alt="" coords="533,5,731,32"/>
<area shape="rect" href="vgic-init_8c.html#aba3547aa220ca50b1eabca1a39c92943" title=" " alt="" coords="341,5,485,32"/>
<area shape="rect" href="arm_8c.html#a040f9b021372ae855b2cc25a0c07da7a" title=" " alt="" coords="165,5,293,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="ad99fad0e2a61f21741f0277c7a84b8bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad99fad0e2a61f21741f0277c7a84b8bc">&#9670;&nbsp;</a></span>vgic_set_kvm_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __init vgic_set_kvm_info </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00531">531</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;{</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    BUG_ON(<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a> != NULL);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a> = kmalloc(<span class="keyword">sizeof</span>(*info), GFP_KERNEL);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a>)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        *<a class="code" href="vgic-init_8c.html#a7b7c49d17fa603aa8433b0d402f9efe1">gic_kvm_info</a> = *info;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a7b7c49d17fa603aa8433b0d402f9efe1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b7c49d17fa603aa8433b0d402f9efe1">&#9670;&nbsp;</a></span>gic_kvm_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct gic_kvm_info* gic_kvm_info</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="vgic-init_8c_source.html#l00529">529</a> of file <a class="el" href="vgic-init_8c_source.html">vgic-init.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
