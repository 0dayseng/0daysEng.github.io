<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/arm64/kvm/pmu-emul.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_67a9e021ce8db5d46236c6154ee454bc.html">arm64</a></li><li class="navelem"><a class="el" href="dir_42f87ef63ac4150166bf7887f68288e2.html">kvm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">pmu-emul.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/cpu.h&gt;</code><br />
<code>#include &lt;linux/kvm.h&gt;</code><br />
<code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &lt;linux/list.h&gt;</code><br />
<code>#include &lt;linux/perf_event.h&gt;</code><br />
<code>#include &lt;linux/perf/arm_pmu.h&gt;</code><br />
<code>#include &lt;linux/uaccess.h&gt;</code><br />
<code>#include &lt;asm/kvm_emulate.h&gt;</code><br />
<code>#include &lt;kvm/arm_pmu.h&gt;</code><br />
<code>#include &lt;kvm/arm_vgic.h&gt;</code><br />
<code>#include &lt;asm/arm_pmuv3.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for pmu-emul.c:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c__incl.png" border="0" usemap="#aarch_2arm64_2kvm_2pmu-emul_8c" alt=""/></div>
<map name="aarch_2arm64_2kvm_2pmu-emul_8c" id="aarch_2arm64_2kvm_2pmu-emul_8c">
<area shape="rect" title=" " alt="" coords="685,5,848,47"/>
<area shape="rect" title=" " alt="" coords="5,95,99,121"/>
<area shape="rect" title=" " alt="" coords="123,95,221,121"/>
<area shape="rect" title=" " alt="" coords="246,95,381,121"/>
<area shape="rect" title=" " alt="" coords="405,95,496,121"/>
<area shape="rect" title=" " alt="" coords="521,95,661,121"/>
<area shape="rect" title=" " alt="" coords="685,95,848,121"/>
<area shape="rect" title=" " alt="" coords="872,95,995,121"/>
<area shape="rect" title=" " alt="" coords="1019,95,1175,121"/>
<area shape="rect" title=" " alt="" coords="1199,95,1329,121"/>
<area shape="rect" title=" " alt="" coords="1353,95,1479,121"/>
<area shape="rect" title=" " alt="" coords="1504,95,1648,121"/>
</map>
</div>
</div>
<p><a href="pmu-emul_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:afd1f5e6ae6a77a28364c42e078c85c13"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#afd1f5e6ae6a77a28364c42e078c85c13">PERF_ATTR_CFG1_COUNTER_64BIT</a>&#160;&#160;&#160;BIT(0)</td></tr>
<tr class="separator:afd1f5e6ae6a77a28364c42e078c85c13"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a053032a3028a7ca39e4d416d6cd4969f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a053032a3028a7ca39e4d416d6cd4969f">DEFINE_STATIC_KEY_FALSE</a> (kvm_arm_pmu_available)</td></tr>
<tr class="separator:a053032a3028a7ca39e4d416d6cd4969f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10d620554e24019b80dbc66024a62138"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a10d620554e24019b80dbc66024a62138">LIST_HEAD</a> (arm_pmus)</td></tr>
<tr class="separator:a10d620554e24019b80dbc66024a62138"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbd0db74d2526801f1ab0333a998aba5"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#acbd0db74d2526801f1ab0333a998aba5">DEFINE_MUTEX</a> (arm_pmus_lock)</td></tr>
<tr class="separator:acbd0db74d2526801f1ab0333a998aba5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d8ed834b14cf4fb055173129b978fed"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed">kvm_pmu_create_perf_event</a> (struct kvm_pmc *pmc)</td></tr>
<tr class="separator:a0d8ed834b14cf4fb055173129b978fed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8b667a7c4c404322fa2f145e656b4a4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4">kvm_pmu_release_perf_event</a> (struct kvm_pmc *pmc)</td></tr>
<tr class="separator:aa8b667a7c4c404322fa2f145e656b4a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10ab89dbf42da547c48fc7a7ad9fc2f4"><td class="memItemLeft" align="right" valign="top">static struct kvm_vcpu *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a> (const struct kvm_pmc *pmc)</td></tr>
<tr class="separator:a10ab89dbf42da547c48fc7a7ad9fc2f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0e28bffa2a3c2ed1f5e6405b8284638"><td class="memItemLeft" align="right" valign="top">static struct kvm_pmc *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a> (struct kvm_vcpu *vcpu, int cnt_idx)</td></tr>
<tr class="separator:af0e28bffa2a3c2ed1f5e6405b8284638"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94af260df1767fa3e538518c9e6436ff"><td class="memItemLeft" align="right" valign="top">static u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff">__kvm_pmu_event_mask</a> (unsigned int pmuver)</td></tr>
<tr class="separator:a94af260df1767fa3e538518c9e6436ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d63c2f53e5548109d366a7e08be43ae"><td class="memItemLeft" align="right" valign="top">static u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae">kvm_pmu_event_mask</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a4d63c2f53e5548109d366a7e08be43ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c22f46a919c0c1d2de50384f7a33ed4"><td class="memItemLeft" align="right" valign="top">u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a1c22f46a919c0c1d2de50384f7a33ed4">kvm_pmu_evtyper_mask</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a1c22f46a919c0c1d2de50384f7a33ed4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25e7862bfe86692b32844810dbe3d6a3"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3">kvm_pmc_is_64bit</a> (struct kvm_pmc *pmc)</td></tr>
<tr class="separator:a25e7862bfe86692b32844810dbe3d6a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4262ee1559f306136fd3b9374f3ae9d3"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3">kvm_pmc_has_64bit_overflow</a> (struct kvm_pmc *pmc)</td></tr>
<tr class="separator:a4262ee1559f306136fd3b9374f3ae9d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07f848e7e5bf226439a5ee53c941eafc"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc">kvm_pmu_counter_can_chain</a> (struct kvm_pmc *pmc)</td></tr>
<tr class="separator:a07f848e7e5bf226439a5ee53c941eafc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a450695105665f1fe0e9d2db927315c5a"><td class="memItemLeft" align="right" valign="top">static u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a">counter_index_to_reg</a> (u64 idx)</td></tr>
<tr class="separator:a450695105665f1fe0e9d2db927315c5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a507cc0978c12a18465f8f5d3987db1f3"><td class="memItemLeft" align="right" valign="top">static u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3">counter_index_to_evtreg</a> (u64 idx)</td></tr>
<tr class="separator:a507cc0978c12a18465f8f5d3987db1f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb35ae097b8b697c84c55e519566fb6a"><td class="memItemLeft" align="right" valign="top">static u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a">kvm_pmu_get_pmc_value</a> (struct kvm_pmc *pmc)</td></tr>
<tr class="separator:acb35ae097b8b697c84c55e519566fb6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57b710f17cc1fc314f8f1e297bcb85f3"><td class="memItemLeft" align="right" valign="top">u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a57b710f17cc1fc314f8f1e297bcb85f3">kvm_pmu_get_counter_value</a> (struct kvm_vcpu *vcpu, u64 select_idx)</td></tr>
<tr class="separator:a57b710f17cc1fc314f8f1e297bcb85f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6347b7f1221bf9ecfeab143625e8391f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f">kvm_pmu_set_pmc_value</a> (struct kvm_pmc *pmc, u64 val, bool force)</td></tr>
<tr class="separator:a6347b7f1221bf9ecfeab143625e8391f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73de9042a2fa76e79cc6d9103b914b59"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59">kvm_pmu_set_counter_value</a> (struct kvm_vcpu *vcpu, u64 select_idx, u64 val)</td></tr>
<tr class="separator:a73de9042a2fa76e79cc6d9103b914b59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7d35d75d609bb5ca09226888f2bd096"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096">kvm_pmu_stop_counter</a> (struct kvm_pmc *pmc)</td></tr>
<tr class="separator:ab7d35d75d609bb5ca09226888f2bd096"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7975a55f74c880d2fc9a9b59573c9768"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a7975a55f74c880d2fc9a9b59573c9768">kvm_pmu_vcpu_init</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a7975a55f74c880d2fc9a9b59573c9768"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeda0ad1ae56bc4244298ae7e6c5363e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5">kvm_pmu_vcpu_reset</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aeda0ad1ae56bc4244298ae7e6c5363e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca66e6898e68588135dbba11916ef625"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#aca66e6898e68588135dbba11916ef625">kvm_pmu_vcpu_destroy</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:aca66e6898e68588135dbba11916ef625"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48da2aca99c9f2f7728c108ebfe1aab6"><td class="memItemLeft" align="right" valign="top">u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a48da2aca99c9f2f7728c108ebfe1aab6">kvm_pmu_valid_counter_mask</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a48da2aca99c9f2f7728c108ebfe1aab6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d7ab7f63f8cc0a899fb45ebfeb851d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6">kvm_pmu_enable_counter_mask</a> (struct kvm_vcpu *vcpu, u64 val)</td></tr>
<tr class="separator:a4d7ab7f63f8cc0a899fb45ebfeb851d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ad466b516d040694a5b25e1c9eef495"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a4ad466b516d040694a5b25e1c9eef495">kvm_pmu_disable_counter_mask</a> (struct kvm_vcpu *vcpu, u64 val)</td></tr>
<tr class="separator:a4ad466b516d040694a5b25e1c9eef495"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4115d1a923a4a0f28962cbd9dc0b2359"><td class="memItemLeft" align="right" valign="top">static u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359">kvm_pmu_overflow_status</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a4115d1a923a4a0f28962cbd9dc0b2359"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac79256eb94d7599687d3294cd40d10b4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4">kvm_pmu_update_state</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ac79256eb94d7599687d3294cd40d10b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5e5584456116fac1d12a69437d72afb"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ad5e5584456116fac1d12a69437d72afb">kvm_pmu_should_notify_user</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ad5e5584456116fac1d12a69437d72afb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac61ce96eac7250a65660c7405d72b820"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ac61ce96eac7250a65660c7405d72b820">kvm_pmu_update_run</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ac61ce96eac7250a65660c7405d72b820"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0f1f020b6774de3fb4ff4c8b4e45a5c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ab0f1f020b6774de3fb4ff4c8b4e45a5c">kvm_pmu_flush_hwstate</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ab0f1f020b6774de3fb4ff4c8b4e45a5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6434d5e6ad74c608886c368e56d67bc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ae6434d5e6ad74c608886c368e56d67bc">kvm_pmu_sync_hwstate</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:ae6434d5e6ad74c608886c368e56d67bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade8da4a2c2f5006e8e32495b934394e9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ade8da4a2c2f5006e8e32495b934394e9">kvm_pmu_perf_overflow_notify_vcpu</a> (struct irq_work *work)</td></tr>
<tr class="separator:ade8da4a2c2f5006e8e32495b934394e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1698d35e55cb9b3545159fbfae5121d2"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2">kvm_pmu_counter_increment</a> (struct kvm_vcpu *vcpu, unsigned long mask, u32 event)</td></tr>
<tr class="separator:a1698d35e55cb9b3545159fbfae5121d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f03e9b6af2651bb2bcc5471953076e6"><td class="memItemLeft" align="right" valign="top">static u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6">compute_period</a> (struct kvm_pmc *pmc, u64 counter)</td></tr>
<tr class="separator:a7f03e9b6af2651bb2bcc5471953076e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b6c636b23b4bafd5809116ae997c71d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d">kvm_pmu_perf_overflow</a> (struct perf_event *perf_event, struct perf_sample_data *data, struct pt_regs *regs)</td></tr>
<tr class="separator:a1b6c636b23b4bafd5809116ae997c71d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8e8d02257514c13e74129b61ecca713"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713">kvm_pmu_software_increment</a> (struct kvm_vcpu *vcpu, u64 val)</td></tr>
<tr class="separator:ad8e8d02257514c13e74129b61ecca713"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78f7241a751047d73f010db81b33a975"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975">kvm_pmu_handle_pmcr</a> (struct kvm_vcpu *vcpu, u64 val)</td></tr>
<tr class="separator:a78f7241a751047d73f010db81b33a975"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5c66bf309304f71e8b9450e35983307"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307">kvm_pmu_counter_is_enabled</a> (struct kvm_pmc *pmc)</td></tr>
<tr class="separator:ab5c66bf309304f71e8b9450e35983307"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22f1aab98d3f43c3b6d5a33d1886d474"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474">kvm_pmu_set_counter_event_type</a> (struct kvm_vcpu *vcpu, u64 data, u64 select_idx)</td></tr>
<tr class="separator:a22f1aab98d3f43c3b6d5a33d1886d474"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60191dd2c9f4c040a68c8b6f23042770"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a60191dd2c9f4c040a68c8b6f23042770">kvm_host_pmu_init</a> (struct arm_pmu *pmu)</td></tr>
<tr class="separator:a60191dd2c9f4c040a68c8b6f23042770"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdd3a41a3a4c8a15f32e2ec1ded508c8"><td class="memItemLeft" align="right" valign="top">static struct arm_pmu *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#afdd3a41a3a4c8a15f32e2ec1ded508c8">kvm_pmu_probe_armpmu</a> (void)</td></tr>
<tr class="separator:afdd3a41a3a4c8a15f32e2ec1ded508c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41e22daf5f994479987a6282d4b6a1b4"><td class="memItemLeft" align="right" valign="top">u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a41e22daf5f994479987a6282d4b6a1b4">kvm_pmu_get_pmceid</a> (struct kvm_vcpu *vcpu, bool pmceid1)</td></tr>
<tr class="separator:a41e22daf5f994479987a6282d4b6a1b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2adeb16260e5920e10beedc3e854c28c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c">kvm_vcpu_reload_pmu</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a2adeb16260e5920e10beedc3e854c28c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7970ca79e66e4d732bd3f8f1289edca3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a7970ca79e66e4d732bd3f8f1289edca3">kvm_arm_pmu_v3_enable</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a7970ca79e66e4d732bd3f8f1289edca3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a711e10b6fe664801230c4856c3840e90"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a711e10b6fe664801230c4856c3840e90">kvm_arm_pmu_v3_init</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:a711e10b6fe664801230c4856c3840e90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab359d7f45f28d7b79e0b41c50ff3c5ee"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ab359d7f45f28d7b79e0b41c50ff3c5ee">pmu_irq_is_valid</a> (struct kvm *kvm, int irq)</td></tr>
<tr class="separator:ab359d7f45f28d7b79e0b41c50ff3c5ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3af47a523e17d28ac178784b84bedcf8"><td class="memItemLeft" align="right" valign="top">u8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a3af47a523e17d28ac178784b84bedcf8">kvm_arm_pmu_get_max_counters</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a3af47a523e17d28ac178784b84bedcf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a683d33cc48e064242a3740f6751ee0c7"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a683d33cc48e064242a3740f6751ee0c7">kvm_arm_set_pmu</a> (struct kvm *kvm, struct arm_pmu *arm_pmu)</td></tr>
<tr class="separator:a683d33cc48e064242a3740f6751ee0c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8424eccc116fb85f08f8169acf66db22"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a8424eccc116fb85f08f8169acf66db22">kvm_arm_set_default_pmu</a> (struct kvm *kvm)</td></tr>
<tr class="separator:a8424eccc116fb85f08f8169acf66db22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3060deee250499476dcdd10fc77b1dc7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a3060deee250499476dcdd10fc77b1dc7">kvm_arm_pmu_v3_set_pmu</a> (struct kvm_vcpu *vcpu, int pmu_id)</td></tr>
<tr class="separator:a3060deee250499476dcdd10fc77b1dc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3085467d010c2e9c3abfcfbf086156a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#af3085467d010c2e9c3abfcfbf086156a">kvm_arm_pmu_v3_set_attr</a> (struct kvm_vcpu *vcpu, struct kvm_device_attr *attr)</td></tr>
<tr class="separator:af3085467d010c2e9c3abfcfbf086156a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0be872f4075e40d5012567baff4c497"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#ae0be872f4075e40d5012567baff4c497">kvm_arm_pmu_v3_get_attr</a> (struct kvm_vcpu *vcpu, struct kvm_device_attr *attr)</td></tr>
<tr class="separator:ae0be872f4075e40d5012567baff4c497"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add43e1459f77c9c642c734dde2e655dc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#add43e1459f77c9c642c734dde2e655dc">kvm_arm_pmu_v3_has_attr</a> (struct kvm_vcpu *vcpu, struct kvm_device_attr *attr)</td></tr>
<tr class="separator:add43e1459f77c9c642c734dde2e655dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a354060fe62ba5fb3f6f3967232f15ddf"><td class="memItemLeft" align="right" valign="top">u8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#a354060fe62ba5fb3f6f3967232f15ddf">kvm_arm_pmu_get_pmuver_limit</a> (void)</td></tr>
<tr class="separator:a354060fe62ba5fb3f6f3967232f15ddf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf428205295b3bc4fec2e00fb2c50fa6"><td class="memItemLeft" align="right" valign="top">u64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6">kvm_vcpu_read_pmcr</a> (struct kvm_vcpu *vcpu)</td></tr>
<tr class="separator:adf428205295b3bc4fec2e00fb2c50fa6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="afd1f5e6ae6a77a28364c42e078c85c13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd1f5e6ae6a77a28364c42e078c85c13">&#9670;&nbsp;</a></span>PERF_ATTR_CFG1_COUNTER_64BIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PERF_ATTR_CFG1_COUNTER_64BIT&#160;&#160;&#160;BIT(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00019">19</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a94af260df1767fa3e538518c9e6436ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94af260df1767fa3e538518c9e6436ff">&#9670;&nbsp;</a></span>__kvm_pmu_event_mask()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u32 __kvm_pmu_event_mask </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>pmuver</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00039">39</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;{</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">switch</span> (pmuver) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">case</span> ID_AA64DFR0_EL1_PMUVer_IMP:</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">return</span> GENMASK(9, 0);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">case</span> ID_AA64DFR0_EL1_PMUVer_V3P1:</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">case</span> ID_AA64DFR0_EL1_PMUVer_V3P4:</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">case</span> ID_AA64DFR0_EL1_PMUVer_V3P5:</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">case</span> ID_AA64DFR0_EL1_PMUVer_V3P7:</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordflow">return</span> GENMASK(15, 0);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">default</span>:        <span class="comment">/* Shouldn&#39;t be here, just for sanity */</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        WARN_ONCE(1, <span class="stringliteral">&quot;Unknown PMU version %d\n&quot;</span>, pmuver);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a94af260df1767fa3e538518c9e6436ff_icgraph.png" border="0" usemap="#apmu-emul_8c_a94af260df1767fa3e538518c9e6436ff_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a94af260df1767fa3e538518c9e6436ff_icgraph" id="apmu-emul_8c_a94af260df1767fa3e538518c9e6436ff_icgraph">
<area shape="rect" title=" " alt="" coords="2572,87,2760,113"/>
<area shape="rect" href="pmu-emul_8c.html#af3085467d010c2e9c3abfcfbf086156a" title=" " alt="" coords="2324,35,2524,61"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="2337,112,2511,139"/>
<area shape="rect" href="guest_8c.html#a932910ec1cc3b5a552da035d4d74a4eb" title=" " alt="" coords="2061,7,2275,33"/>
<area shape="rect" href="arm_8c.html#adcf63ac6c9c7383fcf0dcb2ce097afbe" title=" " alt="" coords="1811,5,1990,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="413,7,572,33"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,40,129,67"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2060,163,2276,189"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,147,1741,189"/>
<area shape="rect" href="pmu-emul_8c.html#a1c22f46a919c0c1d2de50384f7a33ed4" title=" " alt="" coords="2075,264,2261,291"/>
<area shape="rect" href="pmu-emul_8c.html#a41e22daf5f994479987a6282d4b6a1b4" title=" " alt="" coords="2083,61,2253,88"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1809,163,1992,189"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1789,213,2012,240"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,105,1525,132"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,257,1492,298"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,156,1503,183"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,55,1220,81"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,155,1021,181"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,155,761,181"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,103,795,129"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,77,573,104"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,65,364,92"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,273,1234,300"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,207,1240,249"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,215,1007,241"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1592,213,1723,240"/>
<area shape="rect" href="sys__regs_8c.html#a10fff169484fa7d65cb4adc93300aeca" title=" " alt="" coords="1834,315,1967,341"/>
<area shape="rect" href="sys__regs_8c.html#a6ce2c3fa2faafa46d088fb0b3081495b" title=" " alt="" coords="1840,61,1961,88"/>
</map>
</div>

</div>
</div>
<a id="a7f03e9b6af2651bb2bcc5471953076e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f03e9b6af2651bb2bcc5471953076e6">&#9670;&nbsp;</a></span>compute_period()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u64 compute_period </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>counter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00481">481</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;{</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    u64 val;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3">kvm_pmc_is_64bit</a>(pmc) &amp;&amp; <a class="code" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3">kvm_pmc_has_64bit_overflow</a>(pmc))</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        val = (-counter) &amp; GENMASK(63, 0);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        val = (-counter) &amp; GENMASK(31, 0);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">return</span> val;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a25e7862bfe86692b32844810dbe3d6a3"><div class="ttname"><a href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3">kvm_pmc_is_64bit</a></div><div class="ttdeci">static bool kvm_pmc_is_64bit(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00084">pmu-emul.c:84</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a4262ee1559f306136fd3b9374f3ae9d3"><div class="ttname"><a href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3">kvm_pmc_has_64bit_overflow</a></div><div class="ttdeci">static bool kvm_pmc_has_64bit_overflow(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00090">pmu-emul.c:90</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a7f03e9b6af2651bb2bcc5471953076e6_cgraph.png" border="0" usemap="#apmu-emul_8c_a7f03e9b6af2651bb2bcc5471953076e6_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a7f03e9b6af2651bb2bcc5471953076e6_cgraph" id="apmu-emul_8c_a7f03e9b6af2651bb2bcc5471953076e6_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,132,57"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="180,56,399,83"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="217,5,361,32"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="457,5,601,32"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="447,56,612,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a7f03e9b6af2651bb2bcc5471953076e6_icgraph.png" border="0" usemap="#apmu-emul_8c_a7f03e9b6af2651bb2bcc5471953076e6_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a7f03e9b6af2651bb2bcc5471953076e6_icgraph" id="apmu-emul_8c_a7f03e9b6af2651bb2bcc5471953076e6_icgraph">
<area shape="rect" title=" " alt="" coords="2020,107,2147,133"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,99,1741,141"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1789,132,1972,159"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,48,1525,75"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,99,1492,141"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,165,1503,192"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,5,1220,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,157,1021,184"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,132,761,159"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,183,795,209"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,183,573,209"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,183,364,209"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,183,129,209"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,209,1240,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,216,1007,243"/>
</map>
</div>

</div>
</div>
<a id="a507cc0978c12a18465f8f5d3987db1f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a507cc0978c12a18465f8f5d3987db1f3">&#9670;&nbsp;</a></span>counter_index_to_evtreg()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u32 counter_index_to_evtreg </td>
          <td>(</td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>idx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00109">109</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;{</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">return</span> (idx == ARMV8_PMU_CYCLE_IDX) ? PMCCFILTR_EL0 : PMEVTYPER0_EL0 + idx;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a507cc0978c12a18465f8f5d3987db1f3_icgraph.png" border="0" usemap="#apmu-emul_8c_a507cc0978c12a18465f8f5d3987db1f3_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a507cc0978c12a18465f8f5d3987db1f3_icgraph" id="apmu-emul_8c_a507cc0978c12a18465f8f5d3987db1f3_icgraph">
<area shape="rect" title=" " alt="" coords="2324,151,2507,178"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2060,101,2276,127"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,119,1741,160"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,195,1492,236"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1809,101,1992,127"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1789,50,2012,77"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,126,1525,153"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,71,1503,98"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,173,1220,199"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,71,1021,98"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,46,761,73"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,97,795,123"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,97,573,123"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,97,364,123"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,97,129,123"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,223,1234,250"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,5,1240,47"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,13,1007,39"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1592,50,1723,77"/>
</map>
</div>

</div>
</div>
<a id="a450695105665f1fe0e9d2db927315c5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a450695105665f1fe0e9d2db927315c5a">&#9670;&nbsp;</a></span>counter_index_to_reg()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u32 counter_index_to_reg </td>
          <td>(</td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>idx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00104">104</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;{</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span> (idx == ARMV8_PMU_CYCLE_IDX) ? PMCCNTR_EL0 : PMEVCNTR0_EL0 + idx;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a450695105665f1fe0e9d2db927315c5a_icgraph.png" border="0" usemap="#apmu-emul_8c_a450695105665f1fe0e9d2db927315c5a_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a450695105665f1fe0e9d2db927315c5a_icgraph" id="apmu-emul_8c_a450695105665f1fe0e9d2db927315c5a_icgraph">
<area shape="rect" title=" " alt="" coords="2324,204,2487,231"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2060,128,2276,155"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,273,1503,300"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="2071,179,2265,205"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="1811,229,1990,256"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1809,128,1992,155"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1789,7,2012,33"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,165,1741,206"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,173,1525,200"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,107,1492,149"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,157,1220,184"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,267,1021,293"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,220,761,247"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,271,795,297"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,321,573,348"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,321,364,348"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,347,129,373"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,259,1240,301"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,136,1007,163"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1592,5,1723,32"/>
<area shape="rect" href="pmu-emul_8c.html#a57b710f17cc1fc314f8f1e297bcb85f3" title=" " alt="" coords="1815,62,1986,103"/>
<area shape="rect" href="sys__regs_8c.html#a619f21eb31e46258fdc0f120f206521f" title=" " alt="" coords="1594,107,1721,133"/>
<area shape="rect" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5" title=" " alt="" coords="1575,231,1740,257"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1090,376,1219,403"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="844,423,1020,449"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="627,431,789,457"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="191,372,350,399"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="413,423,572,465"/>
</map>
</div>

</div>
</div>
<a id="acbd0db74d2526801f1ab0333a998aba5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbd0db74d2526801f1ab0333a998aba5">&#9670;&nbsp;</a></span>DEFINE_MUTEX()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static DEFINE_MUTEX </td>
          <td>(</td>
          <td class="paramtype">arm_pmus_lock&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a053032a3028a7ca39e4d416d6cd4969f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a053032a3028a7ca39e4d416d6cd4969f">&#9670;&nbsp;</a></span>DEFINE_STATIC_KEY_FALSE()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DEFINE_STATIC_KEY_FALSE </td>
          <td>(</td>
          <td class="paramtype">kvm_arm_pmu_available&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3af47a523e17d28ac178784b84bedcf8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3af47a523e17d28ac178784b84bedcf8">&#9670;&nbsp;</a></span>kvm_arm_pmu_get_max_counters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u8 kvm_arm_pmu_get_max_counters </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_arm_pmu_get_max_counters - Return the max number of PMU counters. @kvm: The kvm pointer </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00908">908</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;{</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keyword">struct </span>arm_pmu *arm_pmu = kvm-&gt;arch.arm_pmu;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">     * The arm_pmu-&gt;num_events considers the cycle counter as well.</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">     * Ignore that and return only the general-purpose counters.</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">return</span> arm_pmu-&gt;num_events - 1;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a3af47a523e17d28ac178784b84bedcf8_icgraph.png" border="0" usemap="#apmu-emul_8c_a3af47a523e17d28ac178784b84bedcf8_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a3af47a523e17d28ac178784b84bedcf8_icgraph" id="apmu-emul_8c_a3af47a523e17d28ac178784b84bedcf8_icgraph">
<area shape="rect" title=" " alt="" coords="1781,50,1965,91"/>
<area shape="rect" href="pmu-emul_8c.html#a683d33cc48e064242a3740f6751ee0c7" title=" " alt="" coords="1587,32,1733,59"/>
<area shape="rect" href="sys__regs_8c.html#a85dc626c2a0714eacf1a06af3daac7a9" title=" " alt="" coords="1619,83,1701,109"/>
<area shape="rect" href="pmu-emul_8c.html#a3060deee250499476dcdd10fc77b1dc7" title=" " alt="" coords="1332,7,1539,33"/>
<area shape="rect" href="pmu-emul_8c.html#a8424eccc116fb85f08f8169acf66db22" title=" " alt="" coords="1335,59,1535,85"/>
<area shape="rect" href="pmu-emul_8c.html#af3085467d010c2e9c3abfcfbf086156a" title=" " alt="" coords="1084,7,1284,33"/>
<area shape="rect" href="guest_8c.html#a932910ec1cc3b5a552da035d4d74a4eb" title=" " alt="" coords="821,7,1036,33"/>
<area shape="rect" href="arm_8c.html#adcf63ac6c9c7383fcf0dcb2ce097afbe" title=" " alt="" coords="384,5,563,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,35,336,61"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,35,129,61"/>
<area shape="rect" href="arm_8c.html#acfffff255f8ed7b351b46be1b986da50" title=" " alt="" coords="1118,63,1250,89"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="841,64,1017,91"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="611,64,773,91"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="394,57,553,98"/>
</map>
</div>

</div>
</div>
<a id="a354060fe62ba5fb3f6f3967232f15ddf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a354060fe62ba5fb3f6f3967232f15ddf">&#9670;&nbsp;</a></span>kvm_arm_pmu_get_pmuver_limit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u8 kvm_arm_pmu_get_pmuver_limit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l01121">1121</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;{</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    u64 tmp;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    tmp = read_sanitised_ftr_reg(SYS_ID_AA64DFR0_EL1);</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    tmp = cpuid_feature_cap_perfmon_field(tmp,</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                          ID_AA64DFR0_EL1_PMUVer_SHIFT,</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                          ID_AA64DFR0_EL1_PMUVer_V3P5);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keywordflow">return</span> FIELD_GET(ARM64_FEATURE_MASK(ID_AA64DFR0_EL1_PMUVer), tmp);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a354060fe62ba5fb3f6f3967232f15ddf_icgraph.png" border="0" usemap="#apmu-emul_8c_a354060fe62ba5fb3f6f3967232f15ddf_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a354060fe62ba5fb3f6f3967232f15ddf_icgraph" id="apmu-emul_8c_a354060fe62ba5fb3f6f3967232f15ddf_icgraph">
<area shape="rect" title=" " alt="" coords="1149,74,1355,115"/>
<area shape="rect" href="pmu-emul_8c.html#af3085467d010c2e9c3abfcfbf086156a" title=" " alt="" coords="887,5,1087,32"/>
<area shape="rect" href="pmu-emul_8c.html#a60191dd2c9f4c040a68c8b6f23042770" title=" " alt="" coords="912,56,1063,83"/>
<area shape="rect" href="sys__regs_8c.html#a7f1eccac4700642e9da4447265c2538a" title=" " alt="" coords="873,107,1101,133"/>
<area shape="rect" href="sys__regs_8c.html#acf43f9071314cb6cc7f0d9c9c866e98e" title=" " alt="" coords="889,157,1085,184"/>
<area shape="rect" href="guest_8c.html#a932910ec1cc3b5a552da035d4d74a4eb" title=" " alt="" coords="611,5,825,32"/>
<area shape="rect" href="arm_8c.html#adcf63ac6c9c7383fcf0dcb2ce097afbe" title=" " alt="" coords="384,5,563,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a7970ca79e66e4d732bd3f8f1289edca3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7970ca79e66e4d732bd3f8f1289edca3">&#9670;&nbsp;</a></span>kvm_arm_pmu_v3_enable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_arm_pmu_v3_enable </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00816">816</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;{</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span> (!vcpu-&gt;arch.pmu.created)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment">     * A valid interrupt configuration for the PMU is either to have a</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">     * properly configured interrupt number and using an in-kernel</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">     * irqchip, or to not have an in-kernel GIC and not set an IRQ.</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">if</span> (irqchip_in_kernel(vcpu-&gt;kvm)) {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordtype">int</span> irq = vcpu-&gt;arch.pmu.irq_num;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">         * If we are using an in-kernel vgic, at this point we know</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">         * the vgic will be initialized, so we can check the PMU irq</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">         * number against the dimensions of the vgic and make sure</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">         * it&#39;s valid.</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">if</span> (!irq_is_ppi(irq) &amp;&amp; !vgic_valid_spi(vcpu-&gt;kvm, irq))</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kvm_arm_pmu_irq_initialized(vcpu)) {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;           <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">/* One-off reload of the PMU on first run */</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    kvm_make_request(KVM_REQ_RELOAD_PMU, vcpu);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160; </div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a7970ca79e66e4d732bd3f8f1289edca3_icgraph.png" border="0" usemap="#apmu-emul_8c_a7970ca79e66e4d732bd3f8f1289edca3_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a7970ca79e66e4d732bd3f8f1289edca3_icgraph" id="apmu-emul_8c_a7970ca79e66e4d732bd3f8f1289edca3_icgraph">
<area shape="rect" title=" " alt="" coords="404,13,599,39"/>
<area shape="rect" href="arm_8c.html#a163f3db5fe1d973be2855f4a479a5c8c" title=" " alt="" coords="177,5,356,47"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="ae0be872f4075e40d5012567baff4c497"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0be872f4075e40d5012567baff4c497">&#9670;&nbsp;</a></span>kvm_arm_pmu_v3_get_attr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_arm_pmu_v3_get_attr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_device_attr *&#160;</td>
          <td class="paramname"><em>attr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l01083">1083</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;{</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">switch</span> (attr-&gt;attr) {</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_VCPU_PMU_V3_IRQ: {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <span class="keywordtype">int</span> __user *uaddr = (<span class="keywordtype">int</span> __user *)(<span class="keywordtype">long</span>)attr-&gt;addr;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="keywordtype">int</span> irq;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160; </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">if</span> (!irqchip_in_kernel(vcpu-&gt;kvm))</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            <span class="keywordflow">return</span> -ENODEV;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        <span class="keywordflow">if</span> (!kvm_arm_pmu_irq_initialized(vcpu))</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <span class="keywordflow">return</span> -ENXIO;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        irq = vcpu-&gt;arch.pmu.irq_num;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <span class="keywordflow">return</span> put_user(irq, uaddr);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160; </div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="keywordflow">return</span> -ENXIO;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ae0be872f4075e40d5012567baff4c497_icgraph.png" border="0" usemap="#apmu-emul_8c_ae0be872f4075e40d5012567baff4c497_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ae0be872f4075e40d5012567baff4c497_icgraph" id="apmu-emul_8c_ae0be872f4075e40d5012567baff4c497_icgraph">
<area shape="rect" title=" " alt="" coords="875,5,1076,32"/>
<area shape="rect" href="guest_8c.html#aa99fc533fb03ffbdc691ecf41ef0ee78" title=" " alt="" coords="612,5,827,32"/>
<area shape="rect" href="arm_8c.html#ac4516032589fef2e518e9ac17c4cc850" title=" " alt="" coords="384,5,564,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="add43e1459f77c9c642c734dde2e655dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add43e1459f77c9c642c734dde2e655dc">&#9670;&nbsp;</a></span>kvm_arm_pmu_v3_has_attr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_arm_pmu_v3_has_attr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_device_attr *&#160;</td>
          <td class="paramname"><em>attr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l01107">1107</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;{</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordflow">switch</span> (attr-&gt;attr) {</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_VCPU_PMU_V3_IRQ:</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_VCPU_PMU_V3_INIT:</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_VCPU_PMU_V3_FILTER:</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_VCPU_PMU_V3_SET_PMU:</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="keywordflow">if</span> (kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keywordflow">return</span> -ENXIO;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_add43e1459f77c9c642c734dde2e655dc_icgraph.png" border="0" usemap="#apmu-emul_8c_add43e1459f77c9c642c734dde2e655dc_icgraph" alt=""/></div>
<map name="apmu-emul_8c_add43e1459f77c9c642c734dde2e655dc_icgraph" id="apmu-emul_8c_add43e1459f77c9c642c734dde2e655dc_icgraph">
<area shape="rect" title=" " alt="" coords="880,5,1083,32"/>
<area shape="rect" href="guest_8c.html#a433aea1c6b1de56454d83bdfffea5244" title=" " alt="" coords="615,5,832,32"/>
<area shape="rect" href="arm_8c.html#a0c30ed81235d5fe106242b7be1863342" title=" " alt="" coords="384,5,567,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a711e10b6fe664801230c4856c3840e90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a711e10b6fe664801230c4856c3840e90">&#9670;&nbsp;</a></span>kvm_arm_pmu_v3_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_arm_pmu_v3_init </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00849">849</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;{</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordflow">if</span> (irqchip_in_kernel(vcpu-&gt;kvm)) {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">         * If using the PMU with an in-kernel virtual GIC</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">         * implementation, we require the GIC to be already</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">         * initialized when initializing the PMU.</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="keywordflow">if</span> (!vgic_initialized(vcpu-&gt;kvm))</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            <span class="keywordflow">return</span> -ENODEV;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160; </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="keywordflow">if</span> (!kvm_arm_pmu_irq_initialized(vcpu))</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="keywordflow">return</span> -ENXIO;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        ret = <a class="code" href="vgic_8c.html#a99527df04c2db316d7f8c1733c18d99e">kvm_vgic_set_owner</a>(vcpu, vcpu-&gt;arch.pmu.irq_num,</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                     &amp;vcpu-&gt;arch.pmu);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    }</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    init_irq_work(&amp;vcpu-&gt;arch.pmu.overflow_work,</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;              <a class="code" href="pmu-emul_8c.html#ade8da4a2c2f5006e8e32495b934394e9">kvm_pmu_perf_overflow_notify_vcpu</a>);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160; </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    vcpu-&gt;arch.pmu.created = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_ade8da4a2c2f5006e8e32495b934394e9"><div class="ttname"><a href="pmu-emul_8c.html#ade8da4a2c2f5006e8e32495b934394e9">kvm_pmu_perf_overflow_notify_vcpu</a></div><div class="ttdeci">static void kvm_pmu_perf_overflow_notify_vcpu(struct irq_work *work)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00427">pmu-emul.c:427</a></div></div>
<div class="ttc" id="avgic_8c_html_a99527df04c2db316d7f8c1733c18d99e"><div class="ttname"><a href="vgic_8c.html#a99527df04c2db316d7f8c1733c18d99e">kvm_vgic_set_owner</a></div><div class="ttdeci">int kvm_vgic_set_owner(struct kvm_vcpu *vcpu, unsigned int intid, void *owner)</div><div class="ttdef"><b>Definition:</b> <a href="vgic_8c_source.html#l00601">vgic.c:601</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a711e10b6fe664801230c4856c3840e90_cgraph.png" border="0" usemap="#apmu-emul_8c_a711e10b6fe664801230c4856c3840e90_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a711e10b6fe664801230c4856c3840e90_cgraph" id="apmu-emul_8c_a711e10b6fe664801230c4856c3840e90_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,176,108"/>
<area shape="rect" href="pmu-emul_8c.html#ade8da4a2c2f5006e8e32495b934394e9" title=" " alt="" coords="224,45,407,86"/>
<area shape="rect" href="vgic_8c.html#a99527df04c2db316d7f8c1733c18d99e" title=" " alt="" coords="236,111,395,137"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="455,52,577,79"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="625,5,833,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="653,56,806,83"/>
<area shape="rect" href="vgic_8c.html#a7f38a266ef3def3202e7e04aa40fd516" title=" " alt="" coords="465,111,567,137"/>
<area shape="rect" href="vgic_8c.html#afeaf79de85450ed5fb52dbd7bd8c6617" title=" " alt="" coords="679,111,779,137"/>
<area shape="rect" href="vgic_8h.html#a43d39599f0fd2d973c5af8d6045e0f91" title=" " alt="" coords="881,111,1016,137"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a711e10b6fe664801230c4856c3840e90_icgraph.png" border="0" usemap="#apmu-emul_8c_a711e10b6fe664801230c4856c3840e90_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a711e10b6fe664801230c4856c3840e90_icgraph" id="apmu-emul_8c_a711e10b6fe664801230c4856c3840e90_icgraph">
<area shape="rect" title=" " alt="" coords="1121,5,1292,32"/>
<area shape="rect" href="pmu-emul_8c.html#af3085467d010c2e9c3abfcfbf086156a" title=" " alt="" coords="873,5,1073,32"/>
<area shape="rect" href="guest_8c.html#a932910ec1cc3b5a552da035d4d74a4eb" title=" " alt="" coords="611,5,825,32"/>
<area shape="rect" href="arm_8c.html#adcf63ac6c9c7383fcf0dcb2ce097afbe" title=" " alt="" coords="384,5,563,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="af3085467d010c2e9c3abfcfbf086156a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3085467d010c2e9c3abfcfbf086156a">&#9670;&nbsp;</a></span>kvm_arm_pmu_v3_set_attr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_arm_pmu_v3_set_attr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kvm_device_attr *&#160;</td>
          <td class="paramname"><em>attr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00980">980</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;{</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    lockdep_assert_held(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160; </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keywordflow">return</span> -ENODEV;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">if</span> (vcpu-&gt;arch.pmu.created)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">return</span> -EBUSY;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">switch</span> (attr-&gt;attr) {</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_VCPU_PMU_V3_IRQ: {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <span class="keywordtype">int</span> __user *uaddr = (<span class="keywordtype">int</span> __user *)(<span class="keywordtype">long</span>)attr-&gt;addr;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <span class="keywordtype">int</span> irq;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="keywordflow">if</span> (!irqchip_in_kernel(kvm))</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordflow">if</span> (get_user(irq, uaddr))</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="comment">/* The PMU overflow interrupt can be a PPI or a valid SPI. */</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="keywordflow">if</span> (!(irq_is_ppi(irq) || irq_is_spi(irq)))</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160; </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="pmu-emul_8c.html#ab359d7f45f28d7b79e0b41c50ff3c5ee">pmu_irq_is_valid</a>(kvm, irq))</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">if</span> (kvm_arm_pmu_irq_initialized(vcpu))</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <span class="keywordflow">return</span> -EBUSY;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        kvm_debug(<span class="stringliteral">&quot;Set kvm ARM PMU irq: %d\n&quot;</span>, irq);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        vcpu-&gt;arch.pmu.irq_num = irq;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_VCPU_PMU_V3_FILTER: {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        u8 pmuver = <a class="code" href="pmu-emul_8c.html#a354060fe62ba5fb3f6f3967232f15ddf">kvm_arm_pmu_get_pmuver_limit</a>();</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="keyword">struct </span>kvm_pmu_event_filter __user *uaddr;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="keyword">struct </span>kvm_pmu_event_filter filter;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="keywordtype">int</span> nr_events;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">         * Allow userspace to specify an event filter for the entire</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">         * event range supported by PMUVer of the hardware, rather</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">         * than the guest&#39;s PMUVer for KVM backward compatibility.</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        nr_events = <a class="code" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff">__kvm_pmu_event_mask</a>(pmuver) + 1;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        uaddr = (<span class="keyword">struct </span>kvm_pmu_event_filter __user *)(<span class="keywordtype">long</span>)attr-&gt;addr;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <span class="keywordflow">if</span> (copy_from_user(&amp;filter, uaddr, <span class="keyword">sizeof</span>(filter)))</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <span class="keywordflow">if</span> (((u32)filter.base_event + filter.nevents) &gt; nr_events ||</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            (filter.action != KVM_PMU_EVENT_ALLOW &amp;&amp;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;             filter.action != KVM_PMU_EVENT_DENY))</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keywordflow">if</span> (kvm_vm_has_ran_once(kvm))</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            <span class="keywordflow">return</span> -EBUSY;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keywordflow">if</span> (!kvm-&gt;arch.pmu_filter) {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            kvm-&gt;arch.pmu_filter = bitmap_alloc(nr_events, GFP_KERNEL_ACCOUNT);</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <span class="keywordflow">if</span> (!kvm-&gt;arch.pmu_filter)</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">             * The default depends on the first applied filter.</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">             * If it allows events, the default is to deny.</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">             * Conversely, if the first filter denies a set of</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">             * events, the default is to allow.</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <span class="keywordflow">if</span> (filter.action == KVM_PMU_EVENT_ALLOW)</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                bitmap_zero(kvm-&gt;arch.pmu_filter, nr_events);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                bitmap_fill(kvm-&gt;arch.pmu_filter, nr_events);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="keywordflow">if</span> (filter.action == KVM_PMU_EVENT_ALLOW)</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;            bitmap_set(kvm-&gt;arch.pmu_filter, filter.base_event, filter.nevents);</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            bitmap_clear(kvm-&gt;arch.pmu_filter, filter.base_event, filter.nevents);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160; </div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_VCPU_PMU_V3_SET_PMU: {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <span class="keywordtype">int</span> __user *uaddr = (<span class="keywordtype">int</span> __user *)(<span class="keywordtype">long</span>)attr-&gt;addr;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keywordtype">int</span> pmu_id;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">if</span> (get_user(pmu_id, uaddr))</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="pmu-emul_8c.html#a3060deee250499476dcdd10fc77b1dc7">kvm_arm_pmu_v3_set_pmu</a>(vcpu, pmu_id);</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    }</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">case</span> KVM_ARM_VCPU_PMU_V3_INIT:</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="pmu-emul_8c.html#a711e10b6fe664801230c4856c3840e90">kvm_arm_pmu_v3_init</a>(vcpu);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">return</span> -ENXIO;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a3060deee250499476dcdd10fc77b1dc7"><div class="ttname"><a href="pmu-emul_8c.html#a3060deee250499476dcdd10fc77b1dc7">kvm_arm_pmu_v3_set_pmu</a></div><div class="ttdeci">static int kvm_arm_pmu_v3_set_pmu(struct kvm_vcpu *vcpu, int pmu_id)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00950">pmu-emul.c:950</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a354060fe62ba5fb3f6f3967232f15ddf"><div class="ttname"><a href="pmu-emul_8c.html#a354060fe62ba5fb3f6f3967232f15ddf">kvm_arm_pmu_get_pmuver_limit</a></div><div class="ttdeci">u8 kvm_arm_pmu_get_pmuver_limit(void)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l01121">pmu-emul.c:1121</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a711e10b6fe664801230c4856c3840e90"><div class="ttname"><a href="pmu-emul_8c.html#a711e10b6fe664801230c4856c3840e90">kvm_arm_pmu_v3_init</a></div><div class="ttdeci">static int kvm_arm_pmu_v3_init(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00849">pmu-emul.c:849</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a94af260df1767fa3e538518c9e6436ff"><div class="ttname"><a href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff">__kvm_pmu_event_mask</a></div><div class="ttdeci">static u32 __kvm_pmu_event_mask(unsigned int pmuver)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00039">pmu-emul.c:39</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_ab359d7f45f28d7b79e0b41c50ff3c5ee"><div class="ttname"><a href="pmu-emul_8c.html#ab359d7f45f28d7b79e0b41c50ff3c5ee">pmu_irq_is_valid</a></div><div class="ttdeci">static bool pmu_irq_is_valid(struct kvm *kvm, int irq)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00883">pmu-emul.c:883</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_af3085467d010c2e9c3abfcfbf086156a_cgraph.png" border="0" usemap="#apmu-emul_8c_af3085467d010c2e9c3abfcfbf086156a_cgraph" alt=""/></div>
<map name="apmu-emul_8c_af3085467d010c2e9c3abfcfbf086156a_cgraph" id="apmu-emul_8c_af3085467d010c2e9c3abfcfbf086156a_cgraph">
<area shape="rect" title=" " alt="" coords="5,123,205,149"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="263,5,451,32"/>
<area shape="rect" href="pmu-emul_8c.html#a354060fe62ba5fb3f6f3967232f15ddf" title=" " alt="" coords="254,57,459,98"/>
<area shape="rect" href="pmu-emul_8c.html#a711e10b6fe664801230c4856c3840e90" title=" " alt="" coords="271,123,442,149"/>
<area shape="rect" href="pmu-emul_8c.html#a3060deee250499476dcdd10fc77b1dc7" title=" " alt="" coords="253,173,460,200"/>
<area shape="rect" href="pmu-emul_8c.html#ab359d7f45f28d7b79e0b41c50ff3c5ee" title=" " alt="" coords="291,224,423,251"/>
<area shape="rect" href="pmu-emul_8c.html#ade8da4a2c2f5006e8e32495b934394e9" title=" " alt="" coords="508,57,691,98"/>
<area shape="rect" href="vgic_8c.html#a99527df04c2db316d7f8c1733c18d99e" title=" " alt="" coords="520,123,679,149"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="769,64,892,91"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="971,17,1179,44"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="998,68,1151,95"/>
<area shape="rect" href="vgic_8c.html#a7f38a266ef3def3202e7e04aa40fd516" title=" " alt="" coords="780,121,881,148"/>
<area shape="rect" href="vgic_8c.html#afeaf79de85450ed5fb52dbd7bd8c6617" title=" " alt="" coords="1025,121,1125,148"/>
<area shape="rect" href="vgic_8h.html#a43d39599f0fd2d973c5af8d6045e0f91" title=" " alt="" coords="1227,121,1361,148"/>
<area shape="rect" href="pmu-emul_8c.html#a683d33cc48e064242a3740f6751ee0c7" title=" " alt="" coords="526,177,673,204"/>
<area shape="rect" href="pmu-emul_8c.html#a3af47a523e17d28ac178784b84bedcf8" title=" " alt="" coords="739,173,923,214"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_af3085467d010c2e9c3abfcfbf086156a_icgraph.png" border="0" usemap="#apmu-emul_8c_af3085467d010c2e9c3abfcfbf086156a_icgraph" alt=""/></div>
<map name="apmu-emul_8c_af3085467d010c2e9c3abfcfbf086156a_icgraph" id="apmu-emul_8c_af3085467d010c2e9c3abfcfbf086156a_icgraph">
<area shape="rect" title=" " alt="" coords="873,5,1073,32"/>
<area shape="rect" href="guest_8c.html#a932910ec1cc3b5a552da035d4d74a4eb" title=" " alt="" coords="611,5,825,32"/>
<area shape="rect" href="arm_8c.html#adcf63ac6c9c7383fcf0dcb2ce097afbe" title=" " alt="" coords="384,5,563,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a3060deee250499476dcdd10fc77b1dc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3060deee250499476dcdd10fc77b1dc7">&#9670;&nbsp;</a></span>kvm_arm_pmu_v3_set_pmu()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kvm_arm_pmu_v3_set_pmu </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pmu_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00950">950</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;{</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keyword">struct </span>kvm *kvm = vcpu-&gt;kvm;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keyword">struct </span>arm_pmu_entry *entry;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keyword">struct </span>arm_pmu *arm_pmu;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordtype">int</span> ret = -ENXIO;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160; </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    lockdep_assert_held(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    mutex_lock(&amp;arm_pmus_lock);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    list_for_each_entry(entry, &amp;arm_pmus, entry) {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        arm_pmu = entry-&gt;arm_pmu;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="keywordflow">if</span> (arm_pmu-&gt;pmu.type == pmu_id) {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            <span class="keywordflow">if</span> (kvm_vm_has_ran_once(kvm) ||</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                (kvm-&gt;arch.pmu_filter &amp;&amp; kvm-&gt;arch.arm_pmu != arm_pmu)) {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                ret = -EBUSY;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;            }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <a class="code" href="pmu-emul_8c.html#a683d33cc48e064242a3740f6751ee0c7">kvm_arm_set_pmu</a>(kvm, arm_pmu);</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            cpumask_copy(kvm-&gt;arch.supported_cpus, &amp;arm_pmu-&gt;supported_cpus);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;            ret = 0;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    }</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    mutex_unlock(&amp;arm_pmus_lock);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a683d33cc48e064242a3740f6751ee0c7"><div class="ttname"><a href="pmu-emul_8c.html#a683d33cc48e064242a3740f6751ee0c7">kvm_arm_set_pmu</a></div><div class="ttdeci">static void kvm_arm_set_pmu(struct kvm *kvm, struct arm_pmu *arm_pmu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00919">pmu-emul.c:919</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a3060deee250499476dcdd10fc77b1dc7_cgraph.png" border="0" usemap="#apmu-emul_8c_a3060deee250499476dcdd10fc77b1dc7_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a3060deee250499476dcdd10fc77b1dc7_cgraph" id="apmu-emul_8c_a3060deee250499476dcdd10fc77b1dc7_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,212,39"/>
<area shape="rect" href="pmu-emul_8c.html#a683d33cc48e064242a3740f6751ee0c7" title=" " alt="" coords="260,13,407,39"/>
<area shape="rect" href="pmu-emul_8c.html#a3af47a523e17d28ac178784b84bedcf8" title=" " alt="" coords="455,5,639,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a3060deee250499476dcdd10fc77b1dc7_icgraph.png" border="0" usemap="#apmu-emul_8c_a3060deee250499476dcdd10fc77b1dc7_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a3060deee250499476dcdd10fc77b1dc7_icgraph" id="apmu-emul_8c_a3060deee250499476dcdd10fc77b1dc7_icgraph">
<area shape="rect" title=" " alt="" coords="1121,5,1328,32"/>
<area shape="rect" href="pmu-emul_8c.html#af3085467d010c2e9c3abfcfbf086156a" title=" " alt="" coords="873,5,1073,32"/>
<area shape="rect" href="guest_8c.html#a932910ec1cc3b5a552da035d4d74a4eb" title=" " alt="" coords="611,5,825,32"/>
<area shape="rect" href="arm_8c.html#adcf63ac6c9c7383fcf0dcb2ce097afbe" title=" " alt="" coords="384,5,563,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a8424eccc116fb85f08f8169acf66db22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8424eccc116fb85f08f8169acf66db22">&#9670;&nbsp;</a></span>kvm_arm_set_default_pmu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kvm_arm_set_default_pmu </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_arm_set_default_pmu - No PMU set, get the default one. @kvm: The kvm pointer</p>
<p>The observant among you will notice that the supported_cpus mask does not get updated for the default PMU even though it is quite possible the selected instance supports only a subset of cores in the system. This is intentional, and upholds the preexisting behavior on heterogeneous systems where vCPUs can be scheduled on any core but the guest counters could stop working. </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00939">939</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;{</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keyword">struct </span>arm_pmu *arm_pmu = <a class="code" href="pmu-emul_8c.html#afdd3a41a3a4c8a15f32e2ec1ded508c8">kvm_pmu_probe_armpmu</a>();</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">if</span> (!arm_pmu)</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <span class="keywordflow">return</span> -ENODEV;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <a class="code" href="pmu-emul_8c.html#a683d33cc48e064242a3740f6751ee0c7">kvm_arm_set_pmu</a>(kvm, arm_pmu);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_afdd3a41a3a4c8a15f32e2ec1ded508c8"><div class="ttname"><a href="pmu-emul_8c.html#afdd3a41a3a4c8a15f32e2ec1ded508c8">kvm_pmu_probe_armpmu</a></div><div class="ttdeci">static struct arm_pmu * kvm_pmu_probe_armpmu(void)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00720">pmu-emul.c:720</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a8424eccc116fb85f08f8169acf66db22_cgraph.png" border="0" usemap="#apmu-emul_8c_a8424eccc116fb85f08f8169acf66db22_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a8424eccc116fb85f08f8169acf66db22_cgraph" id="apmu-emul_8c_a8424eccc116fb85f08f8169acf66db22_cgraph">
<area shape="rect" title=" " alt="" coords="5,38,205,65"/>
<area shape="rect" href="pmu-emul_8c.html#a683d33cc48e064242a3740f6751ee0c7" title=" " alt="" coords="277,13,423,39"/>
<area shape="rect" href="pmu-emul_8c.html#afdd3a41a3a4c8a15f32e2ec1ded508c8" title=" " alt="" coords="253,63,447,90"/>
<area shape="rect" href="pmu-emul_8c.html#a3af47a523e17d28ac178784b84bedcf8" title=" " alt="" coords="495,5,679,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a8424eccc116fb85f08f8169acf66db22_icgraph.png" border="0" usemap="#apmu-emul_8c_a8424eccc116fb85f08f8169acf66db22_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a8424eccc116fb85f08f8169acf66db22_icgraph" id="apmu-emul_8c_a8424eccc116fb85f08f8169acf66db22_icgraph">
<area shape="rect" title=" " alt="" coords="1205,13,1405,39"/>
<area shape="rect" href="arm_8c.html#acfffff255f8ed7b351b46be1b986da50" title=" " alt="" coords="1025,13,1157,39"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="801,13,977,39"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="591,13,753,39"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="384,5,543,47"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,13,336,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a683d33cc48e064242a3740f6751ee0c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a683d33cc48e064242a3740f6751ee0c7">&#9670;&nbsp;</a></span>kvm_arm_set_pmu()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_arm_set_pmu </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct arm_pmu *&#160;</td>
          <td class="paramname"><em>arm_pmu</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00919">919</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;{</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    lockdep_assert_held(&amp;kvm-&gt;arch.config_lock);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160; </div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    kvm-&gt;arch.arm_pmu = arm_pmu;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    kvm-&gt;arch.pmcr_n = <a class="code" href="pmu-emul_8c.html#a3af47a523e17d28ac178784b84bedcf8">kvm_arm_pmu_get_max_counters</a>(kvm);</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a3af47a523e17d28ac178784b84bedcf8"><div class="ttname"><a href="pmu-emul_8c.html#a3af47a523e17d28ac178784b84bedcf8">kvm_arm_pmu_get_max_counters</a></div><div class="ttdeci">u8 kvm_arm_pmu_get_max_counters(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00908">pmu-emul.c:908</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a683d33cc48e064242a3740f6751ee0c7_cgraph.png" border="0" usemap="#apmu-emul_8c_a683d33cc48e064242a3740f6751ee0c7_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a683d33cc48e064242a3740f6751ee0c7_cgraph" id="apmu-emul_8c_a683d33cc48e064242a3740f6751ee0c7_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,152,39"/>
<area shape="rect" href="pmu-emul_8c.html#a3af47a523e17d28ac178784b84bedcf8" title=" " alt="" coords="200,5,384,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a683d33cc48e064242a3740f6751ee0c7_icgraph.png" border="0" usemap="#apmu-emul_8c_a683d33cc48e064242a3740f6751ee0c7_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a683d33cc48e064242a3740f6751ee0c7_icgraph" id="apmu-emul_8c_a683d33cc48e064242a3740f6751ee0c7_icgraph">
<area shape="rect" title=" " alt="" coords="1587,35,1733,61"/>
<area shape="rect" href="pmu-emul_8c.html#a3060deee250499476dcdd10fc77b1dc7" title=" " alt="" coords="1332,9,1539,36"/>
<area shape="rect" href="pmu-emul_8c.html#a8424eccc116fb85f08f8169acf66db22" title=" " alt="" coords="1335,60,1535,87"/>
<area shape="rect" href="pmu-emul_8c.html#af3085467d010c2e9c3abfcfbf086156a" title=" " alt="" coords="1084,9,1284,36"/>
<area shape="rect" href="guest_8c.html#a932910ec1cc3b5a552da035d4d74a4eb" title=" " alt="" coords="821,9,1036,36"/>
<area shape="rect" href="arm_8c.html#adcf63ac6c9c7383fcf0dcb2ce097afbe" title=" " alt="" coords="384,5,563,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,35,336,61"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,35,129,61"/>
<area shape="rect" href="arm_8c.html#acfffff255f8ed7b351b46be1b986da50" title=" " alt="" coords="1118,60,1250,87"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="841,60,1017,87"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="611,60,773,87"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="394,57,553,98"/>
</map>
</div>

</div>
</div>
<a id="a60191dd2c9f4c040a68c8b6f23042770"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60191dd2c9f4c040a68c8b6f23042770">&#9670;&nbsp;</a></span>kvm_host_pmu_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_host_pmu_init </td>
          <td>(</td>
          <td class="paramtype">struct arm_pmu *&#160;</td>
          <td class="paramname"><em>pmu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00693">693</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;{</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keyword">struct </span>arm_pmu_entry *entry;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">     * Check the sanitised PMU version for the system, as KVM does not</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">     * support implementations where PMUv3 exists on a subset of CPUs.</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (!pmuv3_implemented(<a class="code" href="pmu-emul_8c.html#a354060fe62ba5fb3f6f3967232f15ddf">kvm_arm_pmu_get_pmuver_limit</a>()))</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    mutex_lock(&amp;arm_pmus_lock);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    entry = kmalloc(<span class="keyword">sizeof</span>(*entry), GFP_KERNEL);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> (!entry)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">goto</span> out_unlock;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    entry-&gt;arm_pmu = pmu;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    list_add_tail(&amp;entry-&gt;entry, &amp;arm_pmus);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">if</span> (list_is_singular(&amp;arm_pmus))</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        static_branch_enable(&amp;kvm_arm_pmu_available);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;out_unlock:</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    mutex_unlock(&amp;arm_pmus_lock);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a60191dd2c9f4c040a68c8b6f23042770_cgraph.png" border="0" usemap="#apmu-emul_8c_a60191dd2c9f4c040a68c8b6f23042770_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a60191dd2c9f4c040a68c8b6f23042770_cgraph" id="apmu-emul_8c_a60191dd2c9f4c040a68c8b6f23042770_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,156,39"/>
<area shape="rect" href="pmu-emul_8c.html#a354060fe62ba5fb3f6f3967232f15ddf" title=" " alt="" coords="204,5,409,47"/>
</map>
</div>

</div>
</div>
<a id="a4262ee1559f306136fd3b9374f3ae9d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4262ee1559f306136fd3b9374f3ae9d3">&#9670;&nbsp;</a></span>kvm_pmc_has_64bit_overflow()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_pmc_has_64bit_overflow </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00090">90</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;{</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    u64 val = <a class="code" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6">kvm_vcpu_read_pmcr</a>(<a class="code" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a>(pmc));</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">return</span> (pmc-&gt;idx &lt; ARMV8_PMU_CYCLE_IDX &amp;&amp; (val &amp; ARMV8_PMU_PMCR_LP)) ||</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;           (pmc-&gt;idx == ARMV8_PMU_CYCLE_IDX &amp;&amp; (val &amp; ARMV8_PMU_PMCR_LC));</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a10ab89dbf42da547c48fc7a7ad9fc2f4"><div class="ttname"><a href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a></div><div class="ttdeci">static struct kvm_vcpu * kvm_pmc_to_vcpu(const struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00029">pmu-emul.c:29</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_adf428205295b3bc4fec2e00fb2c50fa6"><div class="ttname"><a href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6">kvm_vcpu_read_pmcr</a></div><div class="ttdeci">u64 kvm_vcpu_read_pmcr(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l01136">pmu-emul.c:1136</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4262ee1559f306136fd3b9374f3ae9d3_cgraph.png" border="0" usemap="#apmu-emul_8c_a4262ee1559f306136fd3b9374f3ae9d3_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a4262ee1559f306136fd3b9374f3ae9d3_cgraph" id="apmu-emul_8c_a4262ee1559f306136fd3b9374f3ae9d3_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,224,57"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="283,5,427,32"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="272,56,437,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4262ee1559f306136fd3b9374f3ae9d3_icgraph.png" border="0" usemap="#apmu-emul_8c_a4262ee1559f306136fd3b9374f3ae9d3_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a4262ee1559f306136fd3b9374f3ae9d3_icgraph" id="apmu-emul_8c_a4262ee1559f306136fd3b9374f3ae9d3_icgraph">
<area shape="rect" title=" " alt="" coords="2545,140,2764,167"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="2105,85,2231,112"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="2324,133,2497,174"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2060,187,2276,213"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,99,1741,141"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1809,136,1992,163"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,48,1525,75"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,99,1492,141"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,165,1503,192"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,5,1220,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,157,1021,184"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,132,761,159"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,183,795,209"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,183,573,209"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,183,364,209"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,183,129,209"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,209,1240,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,216,1007,243"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1789,187,2012,213"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1592,187,1723,213"/>
</map>
</div>

</div>
</div>
<a id="a25e7862bfe86692b32844810dbe3d6a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25e7862bfe86692b32844810dbe3d6a3">&#9670;&nbsp;</a></span>kvm_pmc_is_64bit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_pmc_is_64bit </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>kvm_pmc_is_64bit - determine if counter is 64bit @pmc: counter context </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00084">84</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span> (pmc-&gt;idx == ARMV8_PMU_CYCLE_IDX ||</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        kvm_pmu_is_3p5(<a class="code" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a>(pmc)));</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a25e7862bfe86692b32844810dbe3d6a3_cgraph.png" border="0" usemap="#apmu-emul_8c_a25e7862bfe86692b32844810dbe3d6a3_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a25e7862bfe86692b32844810dbe3d6a3_cgraph" id="apmu-emul_8c_a25e7862bfe86692b32844810dbe3d6a3_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,149,32"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="197,5,341,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a25e7862bfe86692b32844810dbe3d6a3_icgraph.png" border="0" usemap="#apmu-emul_8c_a25e7862bfe86692b32844810dbe3d6a3_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a25e7862bfe86692b32844810dbe3d6a3_icgraph" id="apmu-emul_8c_a25e7862bfe86692b32844810dbe3d6a3_icgraph">
<area shape="rect" title=" " alt="" coords="2324,136,2468,163"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="2105,111,2231,137"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,125,1741,166"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2060,60,2276,87"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="2071,237,2265,264"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1809,60,1992,87"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,107,1525,133"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,19,1492,61"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,157,1503,184"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,107,1220,133"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,159,1021,185"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,159,761,185"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,213,795,240"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,267,573,293"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,267,364,293"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,292,129,319"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,5,1234,32"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,209,1240,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,216,1007,243"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1789,9,2012,36"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1592,9,1723,36"/>
<area shape="rect" href="pmu-emul_8c.html#a57b710f17cc1fc314f8f1e297bcb85f3" title=" " alt="" coords="1815,314,1986,355"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="1811,263,1990,289"/>
<area shape="rect" href="sys__regs_8c.html#a619f21eb31e46258fdc0f120f206521f" title=" " alt="" coords="1594,376,1721,403"/>
<area shape="rect" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5" title=" " alt="" coords="1575,325,1740,352"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1090,325,1219,352"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="844,419,1020,445"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="627,376,789,403"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="191,317,350,344"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="413,369,572,410"/>
</map>
</div>

</div>
</div>
<a id="a10ab89dbf42da547c48fc7a7ad9fc2f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10ab89dbf42da547c48fc7a7ad9fc2f4">&#9670;&nbsp;</a></span>kvm_pmc_to_vcpu()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct kvm_vcpu* kvm_pmc_to_vcpu </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00029">29</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">return</span> container_of(pmc, <span class="keyword">struct</span> kvm_vcpu, arch.pmu.pmc[pmc-&gt;idx]);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a10ab89dbf42da547c48fc7a7ad9fc2f4_icgraph.png" border="0" usemap="#apmu-emul_8c_a10ab89dbf42da547c48fc7a7ad9fc2f4_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a10ab89dbf42da547c48fc7a7ad9fc2f4_icgraph" id="apmu-emul_8c_a10ab89dbf42da547c48fc7a7ad9fc2f4_icgraph">
<area shape="rect" title=" " alt="" coords="2812,351,2956,377"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="2545,245,2764,272"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,334,1741,375"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,467,1503,493"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1809,220,1992,247"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="2339,376,2483,403"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="2071,525,2265,552"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="1811,592,1990,619"/>
<area shape="rect" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307" title=" " alt="" coords="2574,41,2735,82"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="2105,272,2231,299"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="2324,209,2497,250"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2060,169,2276,196"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,361,1525,388"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,295,1492,337"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,357,1220,384"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,461,1021,488"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,461,761,488"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,513,795,540"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,568,573,595"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,579,364,605"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,625,129,652"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,303,1234,329"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,510,1240,551"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,517,1007,544"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1789,5,2012,32"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1592,5,1723,32"/>
<area shape="rect" href="pmu-emul_8c.html#a57b710f17cc1fc314f8f1e297bcb85f3" title=" " alt="" coords="1815,526,1986,567"/>
<area shape="rect" href="sys__regs_8c.html#a619f21eb31e46258fdc0f120f206521f" title=" " alt="" coords="1594,525,1721,552"/>
<area shape="rect" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5" title=" " alt="" coords="1575,627,1740,653"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1090,627,1219,653"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="844,619,1020,645"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="627,651,789,677"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="191,651,350,677"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="413,643,572,685"/>
</map>
</div>

</div>
</div>
<a id="a07f848e7e5bf226439a5ee53c941eafc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07f848e7e5bf226439a5ee53c941eafc">&#9670;&nbsp;</a></span>kvm_pmu_counter_can_chain()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_pmu_counter_can_chain </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00098">98</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;{</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">return</span> (!(pmc-&gt;idx &amp; 1) &amp;&amp; (pmc-&gt;idx + 1) &lt; ARMV8_PMU_CYCLE_IDX &amp;&amp;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        !<a class="code" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3">kvm_pmc_has_64bit_overflow</a>(pmc));</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a07f848e7e5bf226439a5ee53c941eafc_cgraph.png" border="0" usemap="#apmu-emul_8c_a07f848e7e5bf226439a5ee53c941eafc_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a07f848e7e5bf226439a5ee53c941eafc_cgraph" id="apmu-emul_8c_a07f848e7e5bf226439a5ee53c941eafc_cgraph">
<area shape="rect" title=" " alt="" coords="5,23,179,65"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="227,31,445,57"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="504,5,648,32"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="493,56,659,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a07f848e7e5bf226439a5ee53c941eafc_icgraph.png" border="0" usemap="#apmu-emul_8c_a07f848e7e5bf226439a5ee53c941eafc_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a07f848e7e5bf226439a5ee53c941eafc_icgraph" id="apmu-emul_8c_a07f848e7e5bf226439a5ee53c941eafc_icgraph">
<area shape="rect" title=" " alt="" coords="2324,127,2497,169"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2060,160,2276,187"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1809,109,1992,136"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1789,161,2012,188"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,99,1741,141"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,48,1525,75"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,99,1492,141"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,165,1503,192"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,5,1220,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,157,1021,184"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,132,761,159"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,183,795,209"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,183,573,209"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,183,364,209"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,183,129,209"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,209,1240,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,216,1007,243"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1592,165,1723,192"/>
</map>
</div>

</div>
</div>
<a id="a1698d35e55cb9b3545159fbfae5121d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1698d35e55cb9b3545159fbfae5121d2">&#9670;&nbsp;</a></span>kvm_pmu_counter_increment()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_pmu_counter_increment </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00440">440</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;{</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6">kvm_vcpu_read_pmcr</a>(vcpu) &amp; ARMV8_PMU_PMCR_E))</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">/* Weed out disabled counters */</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    mask &amp;= __vcpu_sys_reg(vcpu, PMCNTENSET_EL0);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    for_each_set_bit(i, &amp;mask, ARMV8_PMU_CYCLE_IDX) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keyword">struct </span>kvm_pmc *pmc = <a class="code" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a>(vcpu, i);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        u64 type, reg;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="comment">/* Filter on event type */</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        type = __vcpu_sys_reg(vcpu, <a class="code" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3">counter_index_to_evtreg</a>(i));</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        type &amp;= <a class="code" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae">kvm_pmu_event_mask</a>(vcpu-&gt;kvm);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">if</span> (type != event)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="comment">/* Increment this counter */</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        reg = __vcpu_sys_reg(vcpu, <a class="code" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a">counter_index_to_reg</a>(i)) + 1;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3">kvm_pmc_is_64bit</a>(pmc))</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            reg = lower_32_bits(reg);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        __vcpu_sys_reg(vcpu, <a class="code" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a">counter_index_to_reg</a>(i)) = reg;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="comment">/* No overflow? move on */</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3">kvm_pmc_has_64bit_overflow</a>(pmc) ? reg : lower_32_bits(reg))</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="comment">/* Mark overflow */</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        __vcpu_sys_reg(vcpu, PMOVSSET_EL0) |= BIT(i);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc">kvm_pmu_counter_can_chain</a>(pmc))</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <a class="code" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2">kvm_pmu_counter_increment</a>(vcpu, BIT(i + 1),</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                          ARMV8_PMUV3_PERFCTR_CHAIN);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a07f848e7e5bf226439a5ee53c941eafc"><div class="ttname"><a href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc">kvm_pmu_counter_can_chain</a></div><div class="ttdeci">static bool kvm_pmu_counter_can_chain(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00098">pmu-emul.c:98</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a1698d35e55cb9b3545159fbfae5121d2"><div class="ttname"><a href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2">kvm_pmu_counter_increment</a></div><div class="ttdeci">static void kvm_pmu_counter_increment(struct kvm_vcpu *vcpu, unsigned long mask, u32 event)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00440">pmu-emul.c:440</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a450695105665f1fe0e9d2db927315c5a"><div class="ttname"><a href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a">counter_index_to_reg</a></div><div class="ttdeci">static u32 counter_index_to_reg(u64 idx)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00104">pmu-emul.c:104</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a4d63c2f53e5548109d366a7e08be43ae"><div class="ttname"><a href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae">kvm_pmu_event_mask</a></div><div class="ttdeci">static u32 kvm_pmu_event_mask(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00055">pmu-emul.c:55</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a507cc0978c12a18465f8f5d3987db1f3"><div class="ttname"><a href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3">counter_index_to_evtreg</a></div><div class="ttdeci">static u32 counter_index_to_evtreg(u64 idx)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00109">pmu-emul.c:109</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_af0e28bffa2a3c2ed1f5e6405b8284638"><div class="ttname"><a href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a></div><div class="ttdeci">static struct kvm_pmc * kvm_vcpu_idx_to_pmc(struct kvm_vcpu *vcpu, int cnt_idx)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00034">pmu-emul.c:34</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a1698d35e55cb9b3545159fbfae5121d2_cgraph.png" border="0" usemap="#apmu-emul_8c_a1698d35e55cb9b3545159fbfae5121d2_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a1698d35e55cb9b3545159fbfae5121d2_cgraph" id="apmu-emul_8c_a1698d35e55cb9b3545159fbfae5121d2_cgraph">
<area shape="rect" title=" " alt="" coords="5,195,221,221"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="269,5,452,32"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="279,56,442,83"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="500,195,719,221"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="767,139,932,165"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="537,245,681,272"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="274,158,447,199"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="273,325,448,352"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="275,376,446,403"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="777,220,921,247"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="515,325,703,352"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a1698d35e55cb9b3545159fbfae5121d2_icgraph.png" border="0" usemap="#apmu-emul_8c_a1698d35e55cb9b3545159fbfae5121d2_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a1698d35e55cb9b3545159fbfae5121d2_icgraph" id="apmu-emul_8c_a1698d35e55cb9b3545159fbfae5121d2_icgraph">
<area shape="rect" title=" " alt="" coords="2060,136,2276,163"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1809,109,1992,136"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1789,161,2012,188"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,99,1741,141"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,48,1525,75"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,99,1492,141"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,165,1503,192"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,5,1220,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,157,1021,184"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,132,761,159"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,183,795,209"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,183,573,209"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,183,364,209"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,183,129,209"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,209,1240,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,216,1007,243"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1592,165,1723,192"/>
</map>
</div>

</div>
</div>
<a id="ab5c66bf309304f71e8b9450e35983307"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5c66bf309304f71e8b9450e35983307">&#9670;&nbsp;</a></span>kvm_pmu_counter_is_enabled()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool kvm_pmu_counter_is_enabled </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00585">585</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;{</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = <a class="code" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a>(pmc);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6">kvm_vcpu_read_pmcr</a>(vcpu) &amp; ARMV8_PMU_PMCR_E) &amp;&amp;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;           (__vcpu_sys_reg(vcpu, PMCNTENSET_EL0) &amp; BIT(pmc-&gt;idx));</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ab5c66bf309304f71e8b9450e35983307_cgraph.png" border="0" usemap="#apmu-emul_8c_ab5c66bf309304f71e8b9450e35983307_cgraph" alt=""/></div>
<map name="apmu-emul_8c_ab5c66bf309304f71e8b9450e35983307_cgraph" id="apmu-emul_8c_ab5c66bf309304f71e8b9450e35983307_cgraph">
<area shape="rect" title=" " alt="" coords="5,23,167,65"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="225,5,369,32"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="215,56,380,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ab5c66bf309304f71e8b9450e35983307_icgraph.png" border="0" usemap="#apmu-emul_8c_ab5c66bf309304f71e8b9450e35983307_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ab5c66bf309304f71e8b9450e35983307_icgraph" id="apmu-emul_8c_ab5c66bf309304f71e8b9450e35983307_icgraph">
<area shape="rect" title=" " alt="" coords="1789,99,1951,141"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,99,1741,141"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,48,1525,75"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,99,1492,141"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,165,1503,192"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,5,1220,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,157,1021,184"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,132,761,159"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,183,795,209"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,183,573,209"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,183,364,209"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,183,129,209"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,209,1240,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,216,1007,243"/>
</map>
</div>

</div>
</div>
<a id="a0d8ed834b14cf4fb055173129b978fed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d8ed834b14cf4fb055173129b978fed">&#9670;&nbsp;</a></span>kvm_pmu_create_perf_event()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_pmu_create_perf_event </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>kvm_pmu_create_perf_event - create a perf event for a counter @pmc: Counter context </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00596">596</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;{</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = <a class="code" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a>(pmc);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keyword">struct </span>arm_pmu *arm_pmu = vcpu-&gt;kvm-&gt;arch.arm_pmu;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keyword">struct </span>perf_event *event;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keyword">struct </span>perf_event_attr attr;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    u64 eventsel, reg, data;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordtype">bool</span> p, u, nsk, nsu;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    reg = <a class="code" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3">counter_index_to_evtreg</a>(pmc-&gt;idx);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    data = __vcpu_sys_reg(vcpu, reg);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096">kvm_pmu_stop_counter</a>(pmc);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">if</span> (pmc-&gt;idx == ARMV8_PMU_CYCLE_IDX)</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        eventsel = ARMV8_PMUV3_PERFCTR_CPU_CYCLES;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        eventsel = data &amp; <a class="code" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae">kvm_pmu_event_mask</a>(vcpu-&gt;kvm);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">     * Neither SW increment nor chained events need to be backed</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">     * by a perf event.</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span> (eventsel == ARMV8_PMUV3_PERFCTR_SW_INCR ||</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        eventsel == ARMV8_PMUV3_PERFCTR_CHAIN)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160; </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">     * If we have a filter in place and that the event isn&#39;t allowed, do</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">     * not install a perf event either.</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">if</span> (vcpu-&gt;kvm-&gt;arch.pmu_filter &amp;&amp;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        !test_bit(eventsel, vcpu-&gt;kvm-&gt;arch.pmu_filter))</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    p = data &amp; ARMV8_PMU_EXCLUDE_EL1;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    u = data &amp; ARMV8_PMU_EXCLUDE_EL0;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    nsk = data &amp; ARMV8_PMU_EXCLUDE_NS_EL1;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    nsu = data &amp; ARMV8_PMU_EXCLUDE_NS_EL0;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    memset(&amp;attr, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> perf_event_attr));</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    attr.type = arm_pmu-&gt;pmu.type;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    attr.size = <span class="keyword">sizeof</span>(attr);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    attr.pinned = 1;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    attr.disabled = !<a class="code" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307">kvm_pmu_counter_is_enabled</a>(pmc);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    attr.exclude_user = (u != nsu);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    attr.exclude_kernel = (p != nsk);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    attr.exclude_hv = 1; <span class="comment">/* Don&#39;t count EL2 events */</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    attr.exclude_host = 1; <span class="comment">/* Don&#39;t count host events */</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    attr.config = eventsel;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">     * If counting with a 64bit counter, advertise it to the perf</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">     * code, carefully dealing with the initial sample period</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">     * which also depends on the overflow.</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3">kvm_pmc_is_64bit</a>(pmc))</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        attr.config1 |= <a class="code" href="pmu-emul_8c.html#afd1f5e6ae6a77a28364c42e078c85c13">PERF_ATTR_CFG1_COUNTER_64BIT</a>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    attr.sample_period = <a class="code" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6">compute_period</a>(pmc, <a class="code" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a">kvm_pmu_get_pmc_value</a>(pmc));</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keyword">event</span> = perf_event_create_kernel_counter(&amp;attr, -1, current,</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                         <a class="code" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d">kvm_pmu_perf_overflow</a>, pmc);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">if</span> (IS_ERR(event)) {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        pr_err_once(<span class="stringliteral">&quot;kvm: pmu event creation failed %ld\n&quot;</span>,</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                PTR_ERR(event));</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    }</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    pmc-&gt;perf_event = event;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a1b6c636b23b4bafd5809116ae997c71d"><div class="ttname"><a href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d">kvm_pmu_perf_overflow</a></div><div class="ttdeci">static void kvm_pmu_perf_overflow(struct perf_event *perf_event, struct perf_sample_data *data, struct pt_regs *regs)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00496">pmu-emul.c:496</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a7f03e9b6af2651bb2bcc5471953076e6"><div class="ttname"><a href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6">compute_period</a></div><div class="ttdeci">static u64 compute_period(struct kvm_pmc *pmc, u64 counter)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00481">pmu-emul.c:481</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_ab5c66bf309304f71e8b9450e35983307"><div class="ttname"><a href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307">kvm_pmu_counter_is_enabled</a></div><div class="ttdeci">static bool kvm_pmu_counter_is_enabled(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00585">pmu-emul.c:585</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_ab7d35d75d609bb5ca09226888f2bd096"><div class="ttname"><a href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096">kvm_pmu_stop_counter</a></div><div class="ttdeci">static void kvm_pmu_stop_counter(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00209">pmu-emul.c:209</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_acb35ae097b8b697c84c55e519566fb6a"><div class="ttname"><a href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a">kvm_pmu_get_pmc_value</a></div><div class="ttdeci">static u64 kvm_pmu_get_pmc_value(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00114">pmu-emul.c:114</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_afd1f5e6ae6a77a28364c42e078c85c13"><div class="ttname"><a href="pmu-emul_8c.html#afd1f5e6ae6a77a28364c42e078c85c13">PERF_ATTR_CFG1_COUNTER_64BIT</a></div><div class="ttdeci">#define PERF_ATTR_CFG1_COUNTER_64BIT</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00019">pmu-emul.c:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a0d8ed834b14cf4fb055173129b978fed_cgraph.png" border="0" usemap="#apmu-emul_8c_a0d8ed834b14cf4fb055173129b978fed_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a0d8ed834b14cf4fb055173129b978fed_cgraph" id="apmu-emul_8c_a0d8ed834b14cf4fb055173129b978fed_cgraph">
<area shape="rect" title=" " alt="" coords="5,491,173,533"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="497,499,623,525"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="1249,600,1393,627"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="748,600,892,627"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="729,27,911,53"/>
<area shape="rect" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307" title=" " alt="" coords="1001,25,1162,66"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="733,77,907,104"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="463,600,657,627"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="221,397,404,424"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="223,651,402,677"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="972,339,1191,365"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="1239,192,1404,219"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="987,91,1175,117"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="739,651,901,677"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="733,331,907,373"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="452,280,668,307"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="983,153,1180,180"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="499,397,621,424"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="735,179,905,205"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="716,397,924,424"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="743,448,897,475"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="473,702,647,743"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a0d8ed834b14cf4fb055173129b978fed_icgraph.png" border="0" usemap="#apmu-emul_8c_a0d8ed834b14cf4fb055173129b978fed_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a0d8ed834b14cf4fb055173129b978fed_icgraph" id="apmu-emul_8c_a0d8ed834b14cf4fb055173129b978fed_icgraph">
<area shape="rect" title=" " alt="" coords="1573,99,1741,141"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,48,1525,75"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,99,1492,141"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,165,1503,192"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,5,1220,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,157,1021,184"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,132,761,159"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,183,795,209"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,183,573,209"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,183,364,209"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,183,129,209"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,209,1240,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,216,1007,243"/>
</map>
</div>

</div>
</div>
<a id="a4ad466b516d040694a5b25e1c9eef495"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ad466b516d040694a5b25e1c9eef495">&#9670;&nbsp;</a></span>kvm_pmu_disable_counter_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_disable_counter_mask </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_disable_counter_mask - disable selected PMU counters @vcpu: The vcpu pointer @val: the value guest writes to PMCNTENCLR register</p>
<p>Call perf_event_disable to stop counting the perf event </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00319">319</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;{</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu) || !val)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; ARMV8_PMU_MAX_COUNTERS; i++) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keyword">struct </span>kvm_pmc *pmc;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">if</span> (!(val &amp; BIT(i)))</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        pmc = <a class="code" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a>(vcpu, i);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">if</span> (pmc-&gt;perf_event)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            perf_event_disable(pmc-&gt;perf_event);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4ad466b516d040694a5b25e1c9eef495_cgraph.png" border="0" usemap="#apmu-emul_8c_a4ad466b516d040694a5b25e1c9eef495_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a4ad466b516d040694a5b25e1c9eef495_cgraph" id="apmu-emul_8c_a4ad466b516d040694a5b25e1c9eef495_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,245,32"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="293,5,464,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4ad466b516d040694a5b25e1c9eef495_icgraph.png" border="0" usemap="#apmu-emul_8c_a4ad466b516d040694a5b25e1c9eef495_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a4ad466b516d040694a5b25e1c9eef495_icgraph" id="apmu-emul_8c_a4ad466b516d040694a5b25e1c9eef495_icgraph">
<area shape="rect" title=" " alt="" coords="1069,31,1309,57"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="867,5,997,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,56,1021,83"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,31,761,57"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,81,795,108"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,81,573,108"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,81,364,108"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,81,129,108"/>
</map>
</div>

</div>
</div>
<a id="a4d7ab7f63f8cc0a899fb45ebfeb851d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d7ab7f63f8cc0a899fb45ebfeb851d6">&#9670;&nbsp;</a></span>kvm_pmu_enable_counter_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_enable_counter_mask </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_enable_counter_mask - enable selected PMU counters @vcpu: The vcpu pointer @val: the value guest writes to PMCNTENSET register</p>
<p>Call perf_event_enable to start counting the perf event </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00285">285</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6">kvm_vcpu_read_pmcr</a>(vcpu) &amp; ARMV8_PMU_PMCR_E) || !val)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; ARMV8_PMU_MAX_COUNTERS; i++) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keyword">struct </span>kvm_pmc *pmc;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">if</span> (!(val &amp; BIT(i)))</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        pmc = <a class="code" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a>(vcpu, i);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span> (!pmc-&gt;perf_event) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <a class="code" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed">kvm_pmu_create_perf_event</a>(pmc);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            perf_event_enable(pmc-&gt;perf_event);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordflow">if</span> (pmc-&gt;perf_event-&gt;state != PERF_EVENT_STATE_ACTIVE)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                kvm_debug(<span class="stringliteral">&quot;fail to enable perf event\n&quot;</span>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a0d8ed834b14cf4fb055173129b978fed"><div class="ttname"><a href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed">kvm_pmu_create_perf_event</a></div><div class="ttdeci">static void kvm_pmu_create_perf_event(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00596">pmu-emul.c:596</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4d7ab7f63f8cc0a899fb45ebfeb851d6_cgraph.png" border="0" usemap="#apmu-emul_8c_a4d7ab7f63f8cc0a899fb45ebfeb851d6_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a4d7ab7f63f8cc0a899fb45ebfeb851d6_cgraph" id="apmu-emul_8c_a4d7ab7f63f8cc0a899fb45ebfeb851d6_cgraph">
<area shape="rect" title=" " alt="" coords="5,511,243,537"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="291,503,459,545"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="1524,231,1689,257"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="1020,768,1191,795"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="782,460,909,487"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="1535,667,1679,693"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="1033,717,1177,744"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="1014,363,1197,389"/>
<area shape="rect" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307" title=" " alt="" coords="1286,165,1447,206"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="1018,565,1193,592"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="749,729,942,756"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="507,304,689,331"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="509,620,687,647"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="1257,464,1476,491"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="1273,565,1461,592"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="1024,616,1187,643"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="1019,297,1192,338"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="737,409,953,436"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="1268,231,1465,257"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="784,93,907,120"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1001,43,1209,69"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1029,93,1182,120"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="758,613,933,654"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4d7ab7f63f8cc0a899fb45ebfeb851d6_icgraph.png" border="0" usemap="#apmu-emul_8c_a4d7ab7f63f8cc0a899fb45ebfeb851d6_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a4d7ab7f63f8cc0a899fb45ebfeb851d6_icgraph" id="apmu-emul_8c_a4d7ab7f63f8cc0a899fb45ebfeb851d6_icgraph">
<area shape="rect" title=" " alt="" coords="1069,31,1307,57"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="867,5,997,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,56,1021,83"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,31,761,57"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,81,795,108"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,81,573,108"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,81,364,108"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,81,129,108"/>
</map>
</div>

</div>
</div>
<a id="a4d63c2f53e5548109d366a7e08be43ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d63c2f53e5548109d366a7e08be43ae">&#9670;&nbsp;</a></span>kvm_pmu_event_mask()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u32 kvm_pmu_event_mask </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00055">55</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    u64 dfr0 = IDREG(kvm, SYS_ID_AA64DFR0_EL1);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    u8 pmuver = SYS_FIELD_GET(ID_AA64DFR0_EL1, PMUVer, dfr0);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff">__kvm_pmu_event_mask</a>(pmuver);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4d63c2f53e5548109d366a7e08be43ae_cgraph.png" border="0" usemap="#apmu-emul_8c_a4d63c2f53e5548109d366a7e08be43ae_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a4d63c2f53e5548109d366a7e08be43ae_cgraph" id="apmu-emul_8c_a4d63c2f53e5548109d366a7e08be43ae_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,180,32"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="228,5,416,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4d63c2f53e5548109d366a7e08be43ae_icgraph.png" border="0" usemap="#apmu-emul_8c_a4d63c2f53e5548109d366a7e08be43ae_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a4d63c2f53e5548109d366a7e08be43ae_icgraph" id="apmu-emul_8c_a4d63c2f53e5548109d366a7e08be43ae_icgraph">
<area shape="rect" title=" " alt="" coords="2324,177,2499,203"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2060,101,2276,127"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,119,1741,160"/>
<area shape="rect" href="pmu-emul_8c.html#a1c22f46a919c0c1d2de50384f7a33ed4" title=" " alt="" coords="2075,202,2261,229"/>
<area shape="rect" href="pmu-emul_8c.html#a41e22daf5f994479987a6282d4b6a1b4" title=" " alt="" coords="2083,278,2253,305"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1809,101,1992,127"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1789,50,2012,77"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,126,1525,153"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,195,1492,236"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,71,1503,98"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,173,1220,199"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,71,1021,98"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,46,761,73"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,97,795,123"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,97,573,123"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,97,364,123"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,97,129,123"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,223,1234,250"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,5,1240,47"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,13,1007,39"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1592,50,1723,77"/>
<area shape="rect" href="sys__regs_8c.html#a10fff169484fa7d65cb4adc93300aeca" title=" " alt="" coords="1834,253,1967,279"/>
<area shape="rect" href="sys__regs_8c.html#a6ce2c3fa2faafa46d088fb0b3081495b" title=" " alt="" coords="1840,303,1961,330"/>
</map>
</div>

</div>
</div>
<a id="a1c22f46a919c0c1d2de50384f7a33ed4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c22f46a919c0c1d2de50384f7a33ed4">&#9670;&nbsp;</a></span>kvm_pmu_evtyper_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64 kvm_pmu_evtyper_mask </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00063">63</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    u64 mask = ARMV8_PMU_EXCLUDE_EL1 | ARMV8_PMU_EXCLUDE_EL0 |</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;           <a class="code" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae">kvm_pmu_event_mask</a>(kvm);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    u64 pfr0 = IDREG(kvm, SYS_ID_AA64PFR0_EL1);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (SYS_FIELD_GET(ID_AA64PFR0_EL1, EL2, pfr0))</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        mask |= ARMV8_PMU_INCLUDE_EL2;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> (SYS_FIELD_GET(ID_AA64PFR0_EL1, EL3, pfr0))</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        mask |= ARMV8_PMU_EXCLUDE_NS_EL0 |</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            ARMV8_PMU_EXCLUDE_NS_EL1 |</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            ARMV8_PMU_EXCLUDE_EL3;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">return</span> mask;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a1c22f46a919c0c1d2de50384f7a33ed4_cgraph.png" border="0" usemap="#apmu-emul_8c_a1c22f46a919c0c1d2de50384f7a33ed4_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a1c22f46a919c0c1d2de50384f7a33ed4_cgraph" id="apmu-emul_8c_a1c22f46a919c0c1d2de50384f7a33ed4_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,192,32"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="240,5,415,32"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="463,5,651,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a1c22f46a919c0c1d2de50384f7a33ed4_icgraph.png" border="0" usemap="#apmu-emul_8c_a1c22f46a919c0c1d2de50384f7a33ed4_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a1c22f46a919c0c1d2de50384f7a33ed4_icgraph" id="apmu-emul_8c_a1c22f46a919c0c1d2de50384f7a33ed4_icgraph">
<area shape="rect" title=" " alt="" coords="431,42,617,69"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="212,5,383,47"/>
<area shape="rect" href="sys__regs_8c.html#a10fff169484fa7d65cb4adc93300aeca" title=" " alt="" coords="231,71,364,98"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="5,13,164,39"/>
</map>
</div>

</div>
</div>
<a id="ab0f1f020b6774de3fb4ff4c8b4e45a5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0f1f020b6774de3fb4ff4c8b4e45a5c">&#9670;&nbsp;</a></span>kvm_pmu_flush_hwstate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_flush_hwstate </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_flush_hwstate - flush pmu state to cpu @vcpu: The vcpu pointer</p>
<p>Check if the PMU has overflowed while we were running in the host, and inject an interrupt if that was the case. </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00405">405</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;{</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4">kvm_pmu_update_state</a>(vcpu);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_ac79256eb94d7599687d3294cd40d10b4"><div class="ttname"><a href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4">kvm_pmu_update_state</a></div><div class="ttdeci">static void kvm_pmu_update_state(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00352">pmu-emul.c:352</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ab0f1f020b6774de3fb4ff4c8b4e45a5c_cgraph.png" border="0" usemap="#apmu-emul_8c_ab0f1f020b6774de3fb4ff4c8b4e45a5c_cgraph" alt=""/></div>
<map name="apmu-emul_8c_ab0f1f020b6774de3fb4ff4c8b4e45a5c_cgraph" id="apmu-emul_8c_ab0f1f020b6774de3fb4ff4c8b4e45a5c_cgraph">
<area shape="rect" title=" " alt="" coords="5,277,189,304"/>
<area shape="rect" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4" title=" " alt="" coords="237,277,416,304"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="464,176,661,203"/>
<area shape="rect" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4" title=" " alt="" coords="487,303,639,329"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="713,100,878,127"/>
<area shape="rect" href="vgic_8c.html#a7f38a266ef3def3202e7e04aa40fd516" title=" " alt="" coords="745,227,846,253"/>
<area shape="rect" href="vgic-init_8c.html#a3c860e1d043352d9a02f4780b58e5af6" title=" " alt="" coords="740,455,851,481"/>
<area shape="rect" href="vgic_8c.html#ac055f2fa0d463d3d287ee975bb80a9c5" title=" " alt="" coords="2652,404,2753,431"/>
<area shape="rect" href="vgic_8c.html#a1e208ac24f54fa95ba74797758c5b84c" title=" " alt="" coords="2617,201,2788,228"/>
<area shape="rect" href="vgic_8c.html#a19d9c44a40cc76ccbd25bd8e0ec38a08" title=" " alt="" coords="709,505,881,532"/>
<area shape="rect" href="vgic_8c.html#afeaf79de85450ed5fb52dbd7bd8c6617" title=" " alt="" coords="1775,201,1875,228"/>
<area shape="rect" href="vgic_8h.html#a43d39599f0fd2d973c5af8d6045e0f91" title=" " alt="" coords="2857,252,2991,279"/>
<area shape="rect" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57" title=" " alt="" coords="929,587,1007,613"/>
<area shape="rect" href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b" title=" " alt="" coords="1073,587,1217,613"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="1055,521,1236,562"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="2651,713,2754,740"/>
<area shape="rect" href="vgic-init_8c.html#a2eee0060a3bdcd2a9e8fe1451a3a3fc2" title=" " alt="" coords="1058,637,1233,664"/>
<area shape="rect" href="vgic-debug_8c.html#a42534d23071b4f3c441c5f82f9e5c1ce" title=" " alt="" coords="1083,688,1207,715"/>
<area shape="rect" href="vgic-its_8c.html#afd97b5d03d2b30ae4481443cdea2e739" title=" " alt="" coords="1071,455,1220,497"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="1728,789,1923,816"/>
<area shape="rect" href="vgic-v4_8c.html#a802a906ad744a75b5af33bbd6b31237c" title=" " alt="" coords="1095,353,1195,380"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="1298,404,1453,431"/>
<area shape="rect" href="irqchip_8c.html#a5ae37186e6e6d1594767f83df8bab64a" title=" " alt="" coords="1515,404,1680,431"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="1521,353,1673,380"/>
<area shape="rect" href="vgic-irqfd_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1739,353,1911,380"/>
<area shape="rect" href="vgic-irqfd_8c.html#affb5599a3efafc186b72e78e4b31e904" title=" " alt="" coords="2010,360,2119,387"/>
<area shape="rect" href="vgic-irqfd_8c.html#aaba342a8b6308d37735bc46dbf9a6828" title=" " alt="" coords="1996,305,2133,332"/>
<area shape="rect" href="vgic-irqfd_8c.html#a93415dbe2d5c7166c8f3f91be7c5d5da" title=" " alt="" coords="2207,361,2353,388"/>
<area shape="rect" href="vgic-its_8c.html#a53bf66e96dae9553e637fa69e8835365" title=" " alt="" coords="2207,311,2353,337"/>
<area shape="rect" href="vgic-its_8c.html#a352c8627ccf81a8154ae2275c7d50659" title=" " alt="" coords="2401,303,2569,345"/>
<area shape="rect" href="vgic-its_8c.html#ad62375be0591178764e98b79cd7217bf" title=" " alt="" coords="2409,201,2562,228"/>
<area shape="rect" href="vgic-its_8c.html#a94bbb30efc49ad5494a7f4b1410dbe01" title=" " alt="" coords="2424,539,2547,565"/>
<area shape="rect" href="vgic-its_8c.html#ab8e3bef933af0cc51b05259d801be26d" title=" " alt="" coords="2621,303,2784,329"/>
<area shape="rect" href="vgic-its_8c.html#aa5825fcbd841b62853870d25976d018b" title=" " alt="" coords="2836,303,3012,329"/>
<area shape="rect" href="vgic_8c.html#affa1a20a5bd9d67dc546c1ccaace3406" title=" " alt="" coords="2843,404,3005,431"/>
<area shape="rect" href="vgic_8c.html#a7d513558f0ea4ecbc012c98b3522f797" title=" " alt="" coords="3100,404,3228,431"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="2863,132,2985,159"/>
<area shape="rect" href="vgic_8c.html#a10a21280f37c620b743df86980f6d247" title=" " alt="" coords="2853,201,2995,228"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="3060,88,3268,115"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="3087,139,3241,165"/>
<area shape="rect" href="vgic_8h.html#a1109d873011f89a4acb4fd461f9f0a45" title=" " alt="" coords="3106,201,3222,228"/>
<area shape="rect" href="vgic-its_8c.html#a3fe23d687675cef46a95e36cf14d04e1" title=" " alt="" coords="2627,49,2778,76"/>
<area shape="rect" href="vgic-its_8c.html#a0fb230e293b92c9fb746ad7b97ac68d5" title=" " alt="" coords="2853,56,2995,83"/>
<area shape="rect" href="vgic-its_8c.html#ae32cde43818922d2ecf800a3de102b75" title=" " alt="" coords="2889,5,2959,32"/>
<area shape="rect" href="kvm__main_8c.html#acb4d46ae6cc918253046320805f63a95" title=" " alt="" coords="2623,539,2782,565"/>
<area shape="rect" href="vgic-v2_8c.html#a4e8ee3d5f7c8fadbf0a645df67a1c5a2" title=" " alt="" coords="1314,663,1437,689"/>
<area shape="rect" href="vgic-v3_8c.html#abe9a2245dfa0d76d61c99b60f714a513" title=" " alt="" coords="1314,612,1437,639"/>
<area shape="rect" href="vgic-v4_8c.html#af99c2f70dd91a57879b3a2f583e49a4a" title=" " alt="" coords="1284,252,1467,279"/>
<area shape="rect" href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce" title=" " alt="" coords="1305,353,1445,380"/>
<area shape="rect" href="vgic-v4_8c.html#ac22161596c9858cc700bab08c03fc422" title=" " alt="" coords="1971,252,2159,279"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ab0f1f020b6774de3fb4ff4c8b4e45a5c_icgraph.png" border="0" usemap="#apmu-emul_8c_ab0f1f020b6774de3fb4ff4c8b4e45a5c_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ab0f1f020b6774de3fb4ff4c8b4e45a5c_icgraph" id="apmu-emul_8c_ab0f1f020b6774de3fb4ff4c8b4e45a5c_icgraph">
<area shape="rect" title=" " alt="" coords="412,5,596,32"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,5,364,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a57b710f17cc1fc314f8f1e297bcb85f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57b710f17cc1fc314f8f1e297bcb85f3">&#9670;&nbsp;</a></span>kvm_pmu_get_counter_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64 kvm_pmu_get_counter_value </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>select_idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_get_counter_value - get PMU counter value @vcpu: The vcpu pointer @select_idx: The counter index </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00141">141</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a">kvm_pmu_get_pmc_value</a>(<a class="code" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a>(vcpu, select_idx));</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a57b710f17cc1fc314f8f1e297bcb85f3_cgraph.png" border="0" usemap="#apmu-emul_8c_a57b710f17cc1fc314f8f1e297bcb85f3_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a57b710f17cc1fc314f8f1e297bcb85f3_cgraph" id="apmu-emul_8c_a57b710f17cc1fc314f8f1e297bcb85f3_cgraph">
<area shape="rect" title=" " alt="" coords="5,74,176,115"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="224,56,417,83"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="235,107,406,133"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="465,5,628,32"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="475,56,619,83"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="676,81,820,108"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a57b710f17cc1fc314f8f1e297bcb85f3_icgraph.png" border="0" usemap="#apmu-emul_8c_a57b710f17cc1fc314f8f1e297bcb85f3_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a57b710f17cc1fc314f8f1e297bcb85f3_icgraph" id="apmu-emul_8c_a57b710f17cc1fc314f8f1e297bcb85f3_icgraph">
<area shape="rect" title=" " alt="" coords="204,23,375,65"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="5,5,156,32"/>
<area shape="rect" href="sys__regs_8c.html#a619f21eb31e46258fdc0f120f206521f" title=" " alt="" coords="17,56,144,83"/>
</map>
</div>

</div>
</div>
<a id="acb35ae097b8b697c84c55e519566fb6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb35ae097b8b697c84c55e519566fb6a">&#9670;&nbsp;</a></span>kvm_pmu_get_pmc_value()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u64 kvm_pmu_get_pmc_value </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00114">114</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;{</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = <a class="code" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a>(pmc);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    u64 counter, reg, enabled, running;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    reg = <a class="code" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a">counter_index_to_reg</a>(pmc-&gt;idx);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    counter = __vcpu_sys_reg(vcpu, reg);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">     * The real counter value is equal to the value of counter register plus</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">     * the value perf event counts.</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> (pmc-&gt;perf_event)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        counter += perf_event_read_value(pmc-&gt;perf_event, &amp;enabled,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                         &amp;running);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3">kvm_pmc_is_64bit</a>(pmc))</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        counter = lower_32_bits(counter);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">return</span> counter;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_acb35ae097b8b697c84c55e519566fb6a_cgraph.png" border="0" usemap="#apmu-emul_8c_acb35ae097b8b697c84c55e519566fb6a_cgraph" alt=""/></div>
<map name="apmu-emul_8c_acb35ae097b8b697c84c55e519566fb6a_cgraph" id="apmu-emul_8c_acb35ae097b8b697c84c55e519566fb6a_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,199,83"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="247,5,409,32"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="256,56,400,83"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="457,81,601,108"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_acb35ae097b8b697c84c55e519566fb6a_icgraph.png" border="0" usemap="#apmu-emul_8c_acb35ae097b8b697c84c55e519566fb6a_icgraph" alt=""/></div>
<map name="apmu-emul_8c_acb35ae097b8b697c84c55e519566fb6a_icgraph" id="apmu-emul_8c_acb35ae097b8b697c84c55e519566fb6a_icgraph">
<area shape="rect" title=" " alt="" coords="2016,187,2209,213"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,205,1741,246"/>
<area shape="rect" href="pmu-emul_8c.html#a57b710f17cc1fc314f8f1e297bcb85f3" title=" " alt="" coords="1793,49,1964,90"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="1789,237,1968,264"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,275,1525,301"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,133,1492,174"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,212,1503,239"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,275,1220,301"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,224,1021,251"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,199,761,225"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,249,795,276"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,300,573,327"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,311,364,337"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,357,129,384"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,158,1240,199"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,111,1007,137"/>
<area shape="rect" href="sys__regs_8c.html#a619f21eb31e46258fdc0f120f206521f" title=" " alt="" coords="1594,5,1721,32"/>
<area shape="rect" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5" title=" " alt="" coords="1575,304,1740,331"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1090,376,1219,403"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="844,351,1020,377"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="627,383,789,409"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="191,383,350,409"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="413,375,572,417"/>
</map>
</div>

</div>
</div>
<a id="a41e22daf5f994479987a6282d4b6a1b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41e22daf5f994479987a6282d4b6a1b4">&#9670;&nbsp;</a></span>kvm_pmu_get_pmceid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64 kvm_pmu_get_pmceid </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>pmceid1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00760">760</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;{</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *bmap = vcpu-&gt;kvm-&gt;arch.pmu_filter;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    u64 val, mask = 0;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a>, i, nr_events;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">if</span> (!pmceid1) {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        val = read_sysreg(pmceid0_el0);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="comment">/* always support CHAIN */</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        val |= BIT(ARMV8_PMUV3_PERFCTR_CHAIN);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> = 0;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        val = read_sysreg(pmceid1_el0);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">         * Don&#39;t advertise STALL_SLOT*, as PMMIR_EL0 is handled</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">         * as RAZ</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        val &amp;= ~(BIT_ULL(ARMV8_PMUV3_PERFCTR_STALL_SLOT - 32) |</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;             BIT_ULL(ARMV8_PMUV3_PERFCTR_STALL_SLOT_FRONTEND - 32) |</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;             BIT_ULL(ARMV8_PMUV3_PERFCTR_STALL_SLOT_BACKEND - 32));</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> = 32;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">if</span> (!bmap)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">return</span> val;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    nr_events = <a class="code" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae">kvm_pmu_event_mask</a>(vcpu-&gt;kvm) + 1;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; 32; i += 8) {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        u64 byte;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordtype">byte</span> = bitmap_get_value8(bmap, <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> + i);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        mask |= <span class="keywordtype">byte</span> &lt;&lt; i;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">if</span> (nr_events &gt;= (0x4000 + <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> + 32)) {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <span class="keywordtype">byte</span> = bitmap_get_value8(bmap, 0x4000 + <a class="code" href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a> + i);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            mask |= <span class="keywordtype">byte</span> &lt;&lt; (32 + i);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">return</span> val &amp; mask;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;}</div>
<div class="ttc" id="aearly__alloc_8c_html_a74f95eab64fb23344e30879684489f6f"><div class="ttname"><a href="early__alloc_8c.html#a74f95eab64fb23344e30879684489f6f">base</a></div><div class="ttdeci">static unsigned long base</div><div class="ttdef"><b>Definition:</b> <a href="early__alloc_8c_source.html#l00015">early_alloc.c:15</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a41e22daf5f994479987a6282d4b6a1b4_cgraph.png" border="0" usemap="#apmu-emul_8c_a41e22daf5f994479987a6282d4b6a1b4_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a41e22daf5f994479987a6282d4b6a1b4_cgraph" id="apmu-emul_8c_a41e22daf5f994479987a6282d4b6a1b4_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,176,32"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="224,5,399,32"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="447,5,635,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a41e22daf5f994479987a6282d4b6a1b4_icgraph.png" border="0" usemap="#apmu-emul_8c_a41e22daf5f994479987a6282d4b6a1b4_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a41e22daf5f994479987a6282d4b6a1b4_icgraph" id="apmu-emul_8c_a41e22daf5f994479987a6282d4b6a1b4_icgraph">
<area shape="rect" title=" " alt="" coords="175,5,345,32"/>
<area shape="rect" href="sys__regs_8c.html#a6ce2c3fa2faafa46d088fb0b3081495b" title=" " alt="" coords="5,5,127,32"/>
</map>
</div>

</div>
</div>
<a id="a78f7241a751047d73f010db81b33a975"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78f7241a751047d73f010db81b33a975">&#9670;&nbsp;</a></span>kvm_pmu_handle_pmcr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_handle_pmcr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_handle_pmcr - handle PMCR register @vcpu: The vcpu pointer @val: the value guest writes to PMCR register </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00551">551</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;{</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">/* Fixup PMCR_EL0 to reconcile the PMU version and the LP bit */</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">if</span> (!kvm_pmu_is_3p5(vcpu))</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        val &amp;= ~ARMV8_PMU_PMCR_LP;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">/* The reset bits don&#39;t indicate any state, and shouldn&#39;t be saved. */</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    __vcpu_sys_reg(vcpu, PMCR_EL0) = val &amp; ~(ARMV8_PMU_PMCR_C | ARMV8_PMU_PMCR_P);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">if</span> (val &amp; ARMV8_PMU_PMCR_E) {</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <a class="code" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6">kvm_pmu_enable_counter_mask</a>(vcpu,</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;               __vcpu_sys_reg(vcpu, PMCNTENSET_EL0));</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <a class="code" href="pmu-emul_8c.html#a4ad466b516d040694a5b25e1c9eef495">kvm_pmu_disable_counter_mask</a>(vcpu,</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;               __vcpu_sys_reg(vcpu, PMCNTENSET_EL0));</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">if</span> (val &amp; ARMV8_PMU_PMCR_C)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <a class="code" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59">kvm_pmu_set_counter_value</a>(vcpu, ARMV8_PMU_CYCLE_IDX, 0);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">if</span> (val &amp; ARMV8_PMU_PMCR_P) {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> mask = <a class="code" href="pmu-emul_8c.html#a48da2aca99c9f2f7728c108ebfe1aab6">kvm_pmu_valid_counter_mask</a>(vcpu);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        mask &amp;= ~BIT(ARMV8_PMU_CYCLE_IDX);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        for_each_set_bit(i, &amp;mask, 32)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <a class="code" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f">kvm_pmu_set_pmc_value</a>(<a class="code" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a>(vcpu, i), 0, true);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <a class="code" href="pmu_8c.html#a928d4df1b401e9b41f92dd2aa2744529">kvm_vcpu_pmu_restore_guest</a>(vcpu);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a48da2aca99c9f2f7728c108ebfe1aab6"><div class="ttname"><a href="pmu-emul_8c.html#a48da2aca99c9f2f7728c108ebfe1aab6">kvm_pmu_valid_counter_mask</a></div><div class="ttdeci">u64 kvm_pmu_valid_counter_mask(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00268">pmu-emul.c:268</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a4ad466b516d040694a5b25e1c9eef495"><div class="ttname"><a href="pmu-emul_8c.html#a4ad466b516d040694a5b25e1c9eef495">kvm_pmu_disable_counter_mask</a></div><div class="ttdeci">void kvm_pmu_disable_counter_mask(struct kvm_vcpu *vcpu, u64 val)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00319">pmu-emul.c:319</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a4d7ab7f63f8cc0a899fb45ebfeb851d6"><div class="ttname"><a href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6">kvm_pmu_enable_counter_mask</a></div><div class="ttdeci">void kvm_pmu_enable_counter_mask(struct kvm_vcpu *vcpu, u64 val)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00285">pmu-emul.c:285</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a6347b7f1221bf9ecfeab143625e8391f"><div class="ttname"><a href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f">kvm_pmu_set_pmc_value</a></div><div class="ttdeci">static void kvm_pmu_set_pmc_value(struct kvm_pmc *pmc, u64 val, bool force)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00149">pmu-emul.c:149</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a73de9042a2fa76e79cc6d9103b914b59"><div class="ttname"><a href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59">kvm_pmu_set_counter_value</a></div><div class="ttdeci">void kvm_pmu_set_counter_value(struct kvm_vcpu *vcpu, u64 select_idx, u64 val)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00182">pmu-emul.c:182</a></div></div>
<div class="ttc" id="apmu_8c_html_a928d4df1b401e9b41f92dd2aa2744529"><div class="ttname"><a href="pmu_8c.html#a928d4df1b401e9b41f92dd2aa2744529">kvm_vcpu_pmu_restore_guest</a></div><div class="ttdeci">void kvm_vcpu_pmu_restore_guest(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu_8c_source.html#l00176">pmu.c:176</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a78f7241a751047d73f010db81b33a975_cgraph.png" border="0" usemap="#apmu-emul_8c_a78f7241a751047d73f010db81b33a975_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a78f7241a751047d73f010db81b33a975_cgraph" id="apmu-emul_8c_a78f7241a751047d73f010db81b33a975_cgraph">
<area shape="rect" title=" " alt="" coords="5,171,184,197"/>
<area shape="rect" href="pmu-emul_8c.html#a4ad466b516d040694a5b25e1c9eef495" title=" " alt="" coords="1052,107,1292,133"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="1623,157,1793,184"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="505,251,743,277"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="259,163,430,205"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="528,959,720,985"/>
<area shape="rect" href="pmu-emul_8c.html#a48da2aca99c9f2f7728c108ebfe1aab6" title=" " alt="" coords="232,5,457,32"/>
<area shape="rect" href="pmu_8c.html#a928d4df1b401e9b41f92dd2aa2744529" title=" " alt="" coords="255,1279,434,1321"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="813,825,981,866"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="2127,475,2292,501"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="1385,781,1511,808"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="2137,908,2281,935"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="1636,883,1780,909"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="1617,461,1799,488"/>
<area shape="rect" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307" title=" " alt="" coords="1889,817,2050,858"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="1621,512,1795,539"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="1351,933,1545,960"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1081,672,1263,699"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="1083,984,1261,1011"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="1860,672,2079,699"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="1875,512,2063,539"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="1627,984,1789,1011"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="1621,665,1795,706"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="1340,613,1556,640"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="1871,385,2068,412"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1387,411,1509,437"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1604,411,1812,437"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1631,360,1785,387"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="1361,1137,1535,1178"/>
<area shape="rect" href="pmu_8c.html#abf97c7a6b0768cbe660dea1a404bc79b" title=" " alt="" coords="541,1261,707,1288"/>
<area shape="rect" href="pmu_8c.html#ad4ce451e7a40f149ed26e7ce8d9700d4" title=" " alt="" coords="521,1363,727,1389"/>
<area shape="rect" href="pmu_8c.html#a98e21a6fa41b3490e6b1356884b18d5f" title=" " alt="" coords="523,1312,725,1339"/>
<area shape="rect" href="pmu_8c.html#a4fbb4321f3ca694d651e668bb064aa48" title=" " alt="" coords="791,1305,1004,1346"/>
<area shape="rect" href="pmu_8c.html#a78259b4926a270689ce9846f2d661c5d" title=" " alt="" coords="815,1370,980,1411"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a78f7241a751047d73f010db81b33a975_icgraph.png" border="0" usemap="#apmu-emul_8c_a78f7241a751047d73f010db81b33a975_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a78f7241a751047d73f010db81b33a975_icgraph" id="apmu-emul_8c_a78f7241a751047d73f010db81b33a975_icgraph">
<area shape="rect" title=" " alt="" coords="843,31,1021,57"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,5,761,32"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,56,795,83"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,56,573,83"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,56,364,83"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,56,129,83"/>
</map>
</div>

</div>
</div>
<a id="a4115d1a923a4a0f28962cbd9dc0b2359"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4115d1a923a4a0f28962cbd9dc0b2359">&#9670;&nbsp;</a></span>kvm_pmu_overflow_status()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u64 kvm_pmu_overflow_status </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00339">339</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;{</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    u64 reg = 0;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6">kvm_vcpu_read_pmcr</a>(vcpu) &amp; ARMV8_PMU_PMCR_E)) {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        reg = __vcpu_sys_reg(vcpu, PMOVSSET_EL0);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        reg &amp;= __vcpu_sys_reg(vcpu, PMCNTENSET_EL0);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        reg &amp;= __vcpu_sys_reg(vcpu, PMINTENSET_EL1);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">return</span> reg;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4115d1a923a4a0f28962cbd9dc0b2359_cgraph.png" border="0" usemap="#apmu-emul_8c_a4115d1a923a4a0f28962cbd9dc0b2359_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a4115d1a923a4a0f28962cbd9dc0b2359_cgraph" id="apmu-emul_8c_a4115d1a923a4a0f28962cbd9dc0b2359_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,203,32"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="251,5,416,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a4115d1a923a4a0f28962cbd9dc0b2359_icgraph.png" border="0" usemap="#apmu-emul_8c_a4115d1a923a4a0f28962cbd9dc0b2359_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a4115d1a923a4a0f28962cbd9dc0b2359_icgraph" id="apmu-emul_8c_a4115d1a923a4a0f28962cbd9dc0b2359_icgraph">
<area shape="rect" title=" " alt="" coords="2048,249,2245,276"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1817,199,2000,225"/>
<area shape="rect" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4" title=" " alt="" coords="644,275,823,301"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1601,133,1769,174"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1316,52,1553,79"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1349,103,1520,145"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1339,169,1531,196"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1117,5,1248,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="871,157,1049,184"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="680,140,787,167"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="647,191,820,217"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="423,191,585,217"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,241,364,268"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,241,129,268"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1103,107,1262,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1097,209,1268,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="885,216,1035,243"/>
<area shape="rect" href="pmu-emul_8c.html#ab0f1f020b6774de3fb4ff4c8b4e45a5c" title=" " alt="" coords="412,241,596,268"/>
<area shape="rect" href="pmu-emul_8c.html#ae6434d5e6ad74c608886c368e56d67bc" title=" " alt="" coords="413,292,595,319"/>
</map>
</div>

</div>
</div>
<a id="a1b6c636b23b4bafd5809116ae997c71d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b6c636b23b4bafd5809116ae997c71d">&#9670;&nbsp;</a></span>kvm_pmu_perf_overflow()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_pmu_perf_overflow </td>
          <td>(</td>
          <td class="paramtype">struct perf_event *&#160;</td>
          <td class="paramname"><em>perf_event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct perf_sample_data *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct pt_regs *&#160;</td>
          <td class="paramname"><em>regs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>When the perf event overflows, set the overflow status and inform the vcpu. </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00496">496</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;{</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keyword">struct </span>kvm_pmc *pmc = perf_event-&gt;overflow_handler_context;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keyword">struct </span>arm_pmu *cpu_pmu = to_arm_pmu(perf_event-&gt;pmu);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = <a class="code" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a>(pmc);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordtype">int</span> idx = pmc-&gt;idx;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    u64 period;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    cpu_pmu-&gt;pmu.stop(perf_event, PERF_EF_UPDATE);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">     * Reset the sample period to the architectural limit,</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">     * i.e. the point where the counter overflows.</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    period = <a class="code" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6">compute_period</a>(pmc, local64_read(&amp;perf_event-&gt;count));</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    local64_set(&amp;perf_event-&gt;hw.period_left, 0);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    perf_event-&gt;attr.sample_period = period;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    perf_event-&gt;hw.sample_period = period;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    __vcpu_sys_reg(vcpu, PMOVSSET_EL0) |= BIT(idx);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc">kvm_pmu_counter_can_chain</a>(pmc))</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <a class="code" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2">kvm_pmu_counter_increment</a>(vcpu, BIT(idx + 1),</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                      ARMV8_PMUV3_PERFCTR_CHAIN);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359">kvm_pmu_overflow_status</a>(vcpu)) {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        kvm_make_request(KVM_REQ_IRQ_PENDING, vcpu);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordflow">if</span> (!in_nmi())</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <a class="code" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44">kvm_vcpu_kick</a>(vcpu);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            irq_work_queue(&amp;vcpu-&gt;arch.pmu.overflow_work);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    cpu_pmu-&gt;pmu.start(perf_event, PERF_EF_RELOAD);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;}</div>
<div class="ttc" id="akvm__main_8c_html_ac82f28c95da4a0cc137c5a37f08d1f44"><div class="ttname"><a href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44">kvm_vcpu_kick</a></div><div class="ttdeci">void kvm_vcpu_kick(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="kvm__main_8c_source.html#l03931">kvm_main.c:3931</a></div></div>
<div class="ttc" id="apmu-emul_8c_html_a4115d1a923a4a0f28962cbd9dc0b2359"><div class="ttname"><a href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359">kvm_pmu_overflow_status</a></div><div class="ttdeci">static u64 kvm_pmu_overflow_status(struct kvm_vcpu *vcpu)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00339">pmu-emul.c:339</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a1b6c636b23b4bafd5809116ae997c71d_cgraph.png" border="0" usemap="#apmu-emul_8c_a1b6c636b23b4bafd5809116ae997c71d_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a1b6c636b23b4bafd5809116ae997c71d_cgraph" id="apmu-emul_8c_a1b6c636b23b4bafd5809116ae997c71d_cgraph">
<area shape="rect" title=" " alt="" coords="5,198,188,224"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="281,84,407,111"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="1033,84,1177,111"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="517,136,691,177"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="236,252,452,279"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="767,480,964,507"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="283,556,405,583"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="756,143,975,170"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="532,84,676,111"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="1023,404,1188,431"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="513,455,695,482"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="523,252,685,279"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="517,303,691,330"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="519,354,689,380"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="771,303,959,330"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="500,607,708,634"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="527,556,681,583"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a1b6c636b23b4bafd5809116ae997c71d_icgraph.png" border="0" usemap="#apmu-emul_8c_a1b6c636b23b4bafd5809116ae997c71d_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a1b6c636b23b4bafd5809116ae997c71d_icgraph" id="apmu-emul_8c_a1b6c636b23b4bafd5809116ae997c71d_icgraph">
<area shape="rect" title=" " alt="" coords="1789,107,1972,133"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,99,1741,141"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,48,1525,75"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,99,1492,141"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,165,1503,192"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,5,1220,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,157,1021,184"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,132,761,159"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,183,795,209"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,183,573,209"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,183,364,209"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,183,129,209"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,209,1240,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,216,1007,243"/>
</map>
</div>

</div>
</div>
<a id="ade8da4a2c2f5006e8e32495b934394e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade8da4a2c2f5006e8e32495b934394e9">&#9670;&nbsp;</a></span>kvm_pmu_perf_overflow_notify_vcpu()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_pmu_perf_overflow_notify_vcpu </td>
          <td>(</td>
          <td class="paramtype">struct irq_work *&#160;</td>
          <td class="paramname"><em>work</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>When perf interrupt is an NMI, we cannot safely notify the vcpu corresponding to the event. This is why we need a callback to do it once outside of the NMI context. </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00427">427</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;{</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    vcpu = container_of(work, <span class="keyword">struct</span> kvm_vcpu, arch.pmu.overflow_work);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44">kvm_vcpu_kick</a>(vcpu);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ade8da4a2c2f5006e8e32495b934394e9_cgraph.png" border="0" usemap="#apmu-emul_8c_ade8da4a2c2f5006e8e32495b934394e9_cgraph" alt=""/></div>
<map name="apmu-emul_8c_ade8da4a2c2f5006e8e32495b934394e9_cgraph" id="apmu-emul_8c_ade8da4a2c2f5006e8e32495b934394e9_cgraph">
<area shape="rect" title=" " alt="" coords="5,23,188,65"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="236,31,359,57"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="407,5,615,32"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="434,56,587,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ade8da4a2c2f5006e8e32495b934394e9_icgraph.png" border="0" usemap="#apmu-emul_8c_ade8da4a2c2f5006e8e32495b934394e9_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ade8da4a2c2f5006e8e32495b934394e9_icgraph" id="apmu-emul_8c_ade8da4a2c2f5006e8e32495b934394e9_icgraph">
<area shape="rect" title=" " alt="" coords="1340,5,1523,47"/>
<area shape="rect" href="pmu-emul_8c.html#a711e10b6fe664801230c4856c3840e90" title=" " alt="" coords="1121,13,1292,39"/>
<area shape="rect" href="pmu-emul_8c.html#af3085467d010c2e9c3abfcfbf086156a" title=" " alt="" coords="873,13,1073,39"/>
<area shape="rect" href="guest_8c.html#a932910ec1cc3b5a552da035d4d74a4eb" title=" " alt="" coords="611,13,825,39"/>
<area shape="rect" href="arm_8c.html#adcf63ac6c9c7383fcf0dcb2ce097afbe" title=" " alt="" coords="384,13,563,39"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,13,336,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="afdd3a41a3a4c8a15f32e2ec1ded508c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdd3a41a3a4c8a15f32e2ec1ded508c8">&#9670;&nbsp;</a></span>kvm_pmu_probe_armpmu()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct arm_pmu* kvm_pmu_probe_armpmu </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00720">720</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;{</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keyword">struct </span>arm_pmu *tmp, *pmu = NULL;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keyword">struct </span>arm_pmu_entry *entry;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordtype">int</span> cpu;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    mutex_lock(&amp;arm_pmus_lock);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">     * It is safe to use a stale cpu to iterate the list of PMUs so long as</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">     * the same value is used for the entirety of the loop. Given this, and</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">     * the fact that no percpu data is used for the lookup there is no need</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">     * to disable preemption.</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">     * It is still necessary to get a valid cpu, though, to probe for the</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">     * default PMU instance as userspace is not required to specify a PMU</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">     * type. In order to uphold the preexisting behavior KVM selects the</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">     * PMU instance for the core during vcpu init. A dependent use</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">     * case would be a user with disdain of all things big.LITTLE that</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">     * affines the VMM to a particular cluster of cores.</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">     * In any case, userspace should just do the sane thing and use the UAPI</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">     * to select a PMU type directly. But, be wary of the baggage being</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">     * carried here.</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    cpu = raw_smp_processor_id();</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    list_for_each_entry(entry, &amp;arm_pmus, entry) {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        tmp = entry-&gt;arm_pmu;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160; </div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span> (cpumask_test_cpu(cpu, &amp;tmp-&gt;supported_cpus)) {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            pmu = tmp;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    mutex_unlock(&amp;arm_pmus_lock);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordflow">return</span> pmu;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_afdd3a41a3a4c8a15f32e2ec1ded508c8_icgraph.png" border="0" usemap="#apmu-emul_8c_afdd3a41a3a4c8a15f32e2ec1ded508c8_icgraph" alt=""/></div>
<map name="apmu-emul_8c_afdd3a41a3a4c8a15f32e2ec1ded508c8_icgraph" id="apmu-emul_8c_afdd3a41a3a4c8a15f32e2ec1ded508c8_icgraph">
<area shape="rect" title=" " alt="" coords="1453,13,1647,39"/>
<area shape="rect" href="pmu-emul_8c.html#a8424eccc116fb85f08f8169acf66db22" title=" " alt="" coords="1205,13,1405,39"/>
<area shape="rect" href="arm_8c.html#acfffff255f8ed7b351b46be1b986da50" title=" " alt="" coords="1025,13,1157,39"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="801,13,977,39"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="591,13,753,39"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="384,5,543,47"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,13,336,39"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="aa8b667a7c4c404322fa2f145e656b4a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8b667a7c4c404322fa2f145e656b4a4">&#9670;&nbsp;</a></span>kvm_pmu_release_perf_event()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_pmu_release_perf_event </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>kvm_pmu_release_perf_event - remove the perf event @pmc: The PMU counter pointer </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00194">194</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;{</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (pmc-&gt;perf_event) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        perf_event_disable(pmc-&gt;perf_event);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        perf_event_release_kernel(pmc-&gt;perf_event);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        pmc-&gt;perf_event = NULL;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_aa8b667a7c4c404322fa2f145e656b4a4_icgraph.png" border="0" usemap="#apmu-emul_8c_aa8b667a7c4c404322fa2f145e656b4a4_icgraph" alt=""/></div>
<map name="apmu-emul_8c_aa8b667a7c4c404322fa2f145e656b4a4_icgraph" id="apmu-emul_8c_aa8b667a7c4c404322fa2f145e656b4a4_icgraph">
<area shape="rect" title=" " alt="" coords="2072,216,2247,257"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1352,85,1544,111"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="1844,223,2023,250"/>
<area shape="rect" href="pmu-emul_8c.html#aca66e6898e68588135dbba11916ef625" title=" " alt="" coords="1843,274,2024,301"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="884,71,1063,98"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1111,5,1281,47"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="696,71,803,98"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="663,122,836,149"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="453,167,615,194"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="215,169,402,195"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="23,197,147,223"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="898,13,1049,39"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1621,172,1789,213"/>
<area shape="rect" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5" title=" " alt="" coords="1622,267,1787,294"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1329,157,1567,183"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1363,208,1533,249"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1131,173,1261,199"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1117,223,1275,250"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1131,274,1261,301"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="885,223,1061,250"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="668,226,831,253"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="229,223,388,250"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="455,219,613,260"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1615,350,1795,377"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1375,350,1521,377"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1348,401,1548,427"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1120,362,1272,389"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="888,375,1059,402"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="471,451,597,478"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="682,375,817,402"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,477,405,503"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="477,375,591,402"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,426,383,453"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,274,391,301"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,325,386,351"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,375,376,402"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,426,164,453"/>
</map>
</div>

</div>
</div>
<a id="a22f1aab98d3f43c3b6d5a33d1886d474"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22f1aab98d3f43c3b6d5a33d1886d474">&#9670;&nbsp;</a></span>kvm_pmu_set_counter_event_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_set_counter_event_type </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>select_idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_set_counter_event_type - set selected counter to monitor some event @vcpu: The vcpu pointer @data: The data guest writes to PMXEVTYPER_EL0 @select_idx: The number of selected counter</p>
<p>When OS accesses PMXEVTYPER_EL0, that means it wants to set a PMC to count an event with given hardware event number. Here we call perf_event API to emulate this action and create a kernel perf event for it. </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00678">678</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;{</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keyword">struct </span>kvm_pmc *pmc = <a class="code" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a>(vcpu, select_idx);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    u64 reg;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    reg = <a class="code" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3">counter_index_to_evtreg</a>(pmc-&gt;idx);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    __vcpu_sys_reg(vcpu, reg) = data &amp; <a class="code" href="pmu-emul_8c.html#a1c22f46a919c0c1d2de50384f7a33ed4">kvm_pmu_evtyper_mask</a>(vcpu-&gt;kvm);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed">kvm_pmu_create_perf_event</a>(pmc);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a1c22f46a919c0c1d2de50384f7a33ed4"><div class="ttname"><a href="pmu-emul_8c.html#a1c22f46a919c0c1d2de50384f7a33ed4">kvm_pmu_evtyper_mask</a></div><div class="ttdeci">u64 kvm_pmu_evtyper_mask(struct kvm *kvm)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00063">pmu-emul.c:63</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a22f1aab98d3f43c3b6d5a33d1886d474_cgraph.png" border="0" usemap="#apmu-emul_8c_a22f1aab98d3f43c3b6d5a33d1886d474_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a22f1aab98d3f43c3b6d5a33d1886d474_cgraph" id="apmu-emul_8c_a22f1aab98d3f43c3b6d5a33d1886d474_cgraph">
<area shape="rect" title=" " alt="" coords="5,259,176,301"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="966,5,1149,32"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="233,495,401,537"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="972,157,1143,184"/>
<area shape="rect" href="pmu-emul_8c.html#a1c22f46a919c0c1d2de50384f7a33ed4" title=" " alt="" coords="224,583,411,609"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="734,477,861,504"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="1487,579,1631,605"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="985,579,1129,605"/>
<area shape="rect" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307" title=" " alt="" coords="1238,243,1399,285"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="970,629,1145,656"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="701,680,894,707"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="459,376,641,403"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="461,739,639,765"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="1209,427,1428,453"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="1476,280,1641,307"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="1225,629,1413,656"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="976,731,1139,757"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="971,361,1144,402"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="689,376,905,403"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="1220,124,1417,151"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="736,208,859,235"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="953,208,1161,235"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="981,107,1134,133"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="710,731,885,773"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a22f1aab98d3f43c3b6d5a33d1886d474_icgraph.png" border="0" usemap="#apmu-emul_8c_a22f1aab98d3f43c3b6d5a33d1886d474_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a22f1aab98d3f43c3b6d5a33d1886d474_icgraph" id="apmu-emul_8c_a22f1aab98d3f43c3b6d5a33d1886d474_icgraph">
<area shape="rect" title=" " alt="" coords="212,5,383,47"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="5,13,164,39"/>
</map>
</div>

</div>
</div>
<a id="a73de9042a2fa76e79cc6d9103b914b59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73de9042a2fa76e79cc6d9103b914b59">&#9670;&nbsp;</a></span>kvm_pmu_set_counter_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_set_counter_value </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>select_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_set_counter_value - set PMU counter value @vcpu: The vcpu pointer @select_idx: The counter index @val: The counter value </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00182">182</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;{</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f">kvm_pmu_set_pmc_value</a>(<a class="code" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a>(vcpu, select_idx), val, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a73de9042a2fa76e79cc6d9103b914b59_cgraph.png" border="0" usemap="#apmu-emul_8c_a73de9042a2fa76e79cc6d9103b914b59_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a73de9042a2fa76e79cc6d9103b914b59_cgraph" id="apmu-emul_8c_a73de9042a2fa76e79cc6d9103b914b59_cgraph">
<area shape="rect" title=" " alt="" coords="5,457,176,498"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="224,882,416,908"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="1193,47,1364,74"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="1197,772,1360,799"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="1708,646,1852,672"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="464,588,632,629"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="931,874,1106,916"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="955,570,1082,596"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="1207,671,1351,698"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="1187,148,1370,175"/>
<area shape="rect" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307" title=" " alt="" coords="1459,250,1621,292"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="1191,367,1366,394"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="922,722,1115,748"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="680,456,863,483"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="682,772,861,799"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="1431,316,1649,343"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="1697,228,1863,255"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="1446,367,1634,394"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="1192,250,1365,292"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="911,316,1127,343"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="1441,123,1639,150"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="957,456,1080,483"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1175,468,1383,495"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1202,418,1355,444"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a73de9042a2fa76e79cc6d9103b914b59_icgraph.png" border="0" usemap="#apmu-emul_8c_a73de9042a2fa76e79cc6d9103b914b59_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a73de9042a2fa76e79cc6d9103b914b59_icgraph" id="apmu-emul_8c_a73de9042a2fa76e79cc6d9103b914b59_icgraph">
<area shape="rect" title=" " alt="" coords="1069,23,1240,65"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,5,1007,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,56,1021,83"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,31,761,57"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,81,795,108"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,81,573,108"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,81,364,108"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,81,129,108"/>
</map>
</div>

</div>
</div>
<a id="a6347b7f1221bf9ecfeab143625e8391f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6347b7f1221bf9ecfeab143625e8391f">&#9670;&nbsp;</a></span>kvm_pmu_set_pmc_value()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_pmu_set_pmc_value </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>force</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00149">149</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;{</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = <a class="code" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a>(pmc);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    u64 reg;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4">kvm_pmu_release_perf_event</a>(pmc);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    reg = <a class="code" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a">counter_index_to_reg</a>(pmc-&gt;idx);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (vcpu_mode_is_32bit(vcpu) &amp;&amp; pmc-&gt;idx != ARMV8_PMU_CYCLE_IDX &amp;&amp;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        !force) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">         * Even with PMUv3p5, AArch32 cannot write to the top</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">         * 32bit of the counters. The only possible course of</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">         * action is to use PMCR.P, which will reset them to</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">         * 0 (the only use of the &#39;force&#39; parameter).</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        val  = __vcpu_sys_reg(vcpu, reg) &amp; GENMASK(63, 32);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        val |= lower_32_bits(val);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    __vcpu_sys_reg(vcpu, reg) = val;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">/* Recreate the perf event to reflect the updated sample_period */</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed">kvm_pmu_create_perf_event</a>(pmc);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_aa8b667a7c4c404322fa2f145e656b4a4"><div class="ttname"><a href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4">kvm_pmu_release_perf_event</a></div><div class="ttdeci">static void kvm_pmu_release_perf_event(struct kvm_pmc *pmc)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00194">pmu-emul.c:194</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a6347b7f1221bf9ecfeab143625e8391f_cgraph.png" border="0" usemap="#apmu-emul_8c_a6347b7f1221bf9ecfeab143625e8391f_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a6347b7f1221bf9ecfeab143625e8391f_cgraph" id="apmu-emul_8c_a6347b7f1221bf9ecfeab143625e8391f_cgraph">
<area shape="rect" title=" " alt="" coords="5,772,197,799"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="979,722,1141,748"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="1489,595,1633,622"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="245,588,413,629"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="713,874,887,916"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="737,519,863,546"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="988,570,1132,596"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="969,468,1151,495"/>
<area shape="rect" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307" title=" " alt="" coords="1241,309,1402,350"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="973,671,1147,698"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="703,620,897,647"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="461,258,644,284"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="463,772,642,799"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="1212,426,1431,452"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="1479,287,1644,314"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="1227,671,1415,698"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="973,250,1147,292"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="692,418,908,444"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="1223,72,1420,99"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="739,98,861,124"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="975,418,1145,444"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="956,47,1164,74"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="983,98,1137,124"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a6347b7f1221bf9ecfeab143625e8391f_icgraph.png" border="0" usemap="#apmu-emul_8c_a6347b7f1221bf9ecfeab143625e8391f_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a6347b7f1221bf9ecfeab143625e8391f_icgraph" id="apmu-emul_8c_a6347b7f1221bf9ecfeab143625e8391f_icgraph">
<area shape="rect" title=" " alt="" coords="1288,56,1480,83"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,31,1021,57"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,78,1240,119"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,5,761,32"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,56,795,83"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,56,573,83"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,56,364,83"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,56,129,83"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,85,1007,112"/>
</map>
</div>

</div>
</div>
<a id="ad5e5584456116fac1d12a69437d72afb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5e5584456116fac1d12a69437d72afb">&#9670;&nbsp;</a></span>kvm_pmu_should_notify_user()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kvm_pmu_should_notify_user </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00373">373</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;{</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keyword">struct </span>kvm_pmu *pmu = &amp;vcpu-&gt;arch.pmu;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keyword">struct </span>kvm_sync_regs *sregs = &amp;vcpu-&gt;run-&gt;s.regs;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordtype">bool</span> run_level = sregs-&gt;device_irq_level &amp; KVM_ARM_DEV_PMU;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">if</span> (likely(irqchip_in_kernel(vcpu-&gt;kvm)))</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">return</span> pmu-&gt;irq_level != run_level;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ad5e5584456116fac1d12a69437d72afb_icgraph.png" border="0" usemap="#apmu-emul_8c_ad5e5584456116fac1d12a69437d72afb_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ad5e5584456116fac1d12a69437d72afb_icgraph" id="apmu-emul_8c_ad5e5584456116fac1d12a69437d72afb_icgraph">
<area shape="rect" title=" " alt="" coords="637,5,853,32"/>
<area shape="rect" href="arm_8c.html#a545524d72330cd45dae4f51a686943c0" title=" " alt="" coords="412,5,589,32"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,5,364,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="ad8e8d02257514c13e74129b61ecca713"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8e8d02257514c13e74129b61ecca713">&#9670;&nbsp;</a></span>kvm_pmu_software_increment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_software_increment </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_software_increment - do software increment @vcpu: The vcpu pointer @val: the value guest writes to PMSWINC register </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00541">541</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;{</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <a class="code" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2">kvm_pmu_counter_increment</a>(vcpu, val, ARMV8_PMUV3_PERFCTR_SW_INCR);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ad8e8d02257514c13e74129b61ecca713_cgraph.png" border="0" usemap="#apmu-emul_8c_ad8e8d02257514c13e74129b61ecca713_cgraph" alt=""/></div>
<map name="apmu-emul_8c_ad8e8d02257514c13e74129b61ecca713_cgraph" id="apmu-emul_8c_ad8e8d02257514c13e74129b61ecca713_cgraph">
<area shape="rect" title=" " alt="" coords="5,195,228,221"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="276,195,492,221"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="540,5,723,32"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="550,56,713,83"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="771,195,989,221"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="1037,139,1203,165"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="808,245,952,272"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="545,158,718,199"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="544,325,719,352"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="546,376,717,403"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="1048,220,1192,247"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="786,325,974,352"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ad8e8d02257514c13e74129b61ecca713_icgraph.png" border="0" usemap="#apmu-emul_8c_ad8e8d02257514c13e74129b61ecca713_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ad8e8d02257514c13e74129b61ecca713_icgraph" id="apmu-emul_8c_ad8e8d02257514c13e74129b61ecca713_icgraph">
<area shape="rect" title=" " alt="" coords="184,5,407,32"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="5,5,136,32"/>
</map>
</div>

</div>
</div>
<a id="ab7d35d75d609bb5ca09226888f2bd096"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7d35d75d609bb5ca09226888f2bd096">&#9670;&nbsp;</a></span>kvm_pmu_stop_counter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_pmu_stop_counter </td>
          <td>(</td>
          <td class="paramtype">struct kvm_pmc *&#160;</td>
          <td class="paramname"><em>pmc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>kvm_pmu_stop_counter - stop PMU counter @pmc: The PMU counter pointer</p>
<p>If this counter has been configured to monitor some event, release it here. </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00209">209</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;{</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu = <a class="code" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4">kvm_pmc_to_vcpu</a>(pmc);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    u64 reg, val;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">if</span> (!pmc-&gt;perf_event)</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    val = <a class="code" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a">kvm_pmu_get_pmc_value</a>(pmc);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    reg = <a class="code" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a">counter_index_to_reg</a>(pmc-&gt;idx);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    __vcpu_sys_reg(vcpu, reg) = val;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4">kvm_pmu_release_perf_event</a>(pmc);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ab7d35d75d609bb5ca09226888f2bd096_cgraph.png" border="0" usemap="#apmu-emul_8c_ab7d35d75d609bb5ca09226888f2bd096_cgraph" alt=""/></div>
<map name="apmu-emul_8c_ab7d35d75d609bb5ca09226888f2bd096_cgraph" id="apmu-emul_8c_ab7d35d75d609bb5ca09226888f2bd096_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,184,159"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="473,5,636,32"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="684,107,828,133"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="232,81,425,108"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="241,209,416,250"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="483,56,627,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ab7d35d75d609bb5ca09226888f2bd096_icgraph.png" border="0" usemap="#apmu-emul_8c_ab7d35d75d609bb5ca09226888f2bd096_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ab7d35d75d609bb5ca09226888f2bd096_icgraph" id="apmu-emul_8c_ab7d35d75d609bb5ca09226888f2bd096_icgraph">
<area shape="rect" title=" " alt="" coords="1789,188,1968,215"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1573,139,1741,181"/>
<area shape="rect" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5" title=" " alt="" coords="1575,217,1740,244"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1288,52,1525,79"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1321,103,1492,145"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1311,169,1503,196"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1089,5,1220,32"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="843,157,1021,184"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="655,157,761,184"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="621,208,795,235"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,259,573,285"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,269,364,296"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,316,129,343"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1075,107,1234,133"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1069,209,1240,250"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="857,208,1007,235"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1090,309,1219,336"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="844,309,1020,336"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="627,341,789,368"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="191,341,350,368"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="413,334,572,375"/>
</map>
</div>

</div>
</div>
<a id="ae6434d5e6ad74c608886c368e56d67bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6434d5e6ad74c608886c368e56d67bc">&#9670;&nbsp;</a></span>kvm_pmu_sync_hwstate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_sync_hwstate </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_sync_hwstate - sync pmu state from cpu @vcpu: The vcpu pointer</p>
<p>Check if the PMU has overflowed while we were running in the guest, and inject an interrupt if that was the case. </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00417">417</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;{</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4">kvm_pmu_update_state</a>(vcpu);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ae6434d5e6ad74c608886c368e56d67bc_cgraph.png" border="0" usemap="#apmu-emul_8c_ae6434d5e6ad74c608886c368e56d67bc_cgraph" alt=""/></div>
<map name="apmu-emul_8c_ae6434d5e6ad74c608886c368e56d67bc_cgraph" id="apmu-emul_8c_ae6434d5e6ad74c608886c368e56d67bc_cgraph">
<area shape="rect" title=" " alt="" coords="5,277,188,304"/>
<area shape="rect" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4" title=" " alt="" coords="236,277,415,304"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="463,176,660,203"/>
<area shape="rect" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4" title=" " alt="" coords="485,303,637,329"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="711,100,877,127"/>
<area shape="rect" href="vgic_8c.html#a7f38a266ef3def3202e7e04aa40fd516" title=" " alt="" coords="743,227,845,253"/>
<area shape="rect" href="vgic-init_8c.html#a3c860e1d043352d9a02f4780b58e5af6" title=" " alt="" coords="739,455,849,481"/>
<area shape="rect" href="vgic_8c.html#ac055f2fa0d463d3d287ee975bb80a9c5" title=" " alt="" coords="2651,404,2752,431"/>
<area shape="rect" href="vgic_8c.html#a1e208ac24f54fa95ba74797758c5b84c" title=" " alt="" coords="2616,201,2787,228"/>
<area shape="rect" href="vgic_8c.html#a19d9c44a40cc76ccbd25bd8e0ec38a08" title=" " alt="" coords="708,505,880,532"/>
<area shape="rect" href="vgic_8c.html#afeaf79de85450ed5fb52dbd7bd8c6617" title=" " alt="" coords="1774,201,1874,228"/>
<area shape="rect" href="vgic_8h.html#a43d39599f0fd2d973c5af8d6045e0f91" title=" " alt="" coords="2855,252,2990,279"/>
<area shape="rect" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57" title=" " alt="" coords="928,587,1005,613"/>
<area shape="rect" href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b" title=" " alt="" coords="1072,587,1216,613"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="1053,521,1235,562"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="2650,713,2753,740"/>
<area shape="rect" href="vgic-init_8c.html#a2eee0060a3bdcd2a9e8fe1451a3a3fc2" title=" " alt="" coords="1057,637,1231,664"/>
<area shape="rect" href="vgic-debug_8c.html#a42534d23071b4f3c441c5f82f9e5c1ce" title=" " alt="" coords="1082,688,1206,715"/>
<area shape="rect" href="vgic-its_8c.html#afd97b5d03d2b30ae4481443cdea2e739" title=" " alt="" coords="1069,455,1219,497"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="1727,789,1921,816"/>
<area shape="rect" href="vgic-v4_8c.html#a802a906ad744a75b5af33bbd6b31237c" title=" " alt="" coords="1094,353,1194,380"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="1297,404,1451,431"/>
<area shape="rect" href="irqchip_8c.html#a5ae37186e6e6d1594767f83df8bab64a" title=" " alt="" coords="1513,404,1679,431"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="1520,353,1672,380"/>
<area shape="rect" href="vgic-irqfd_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1738,353,1910,380"/>
<area shape="rect" href="vgic-irqfd_8c.html#affb5599a3efafc186b72e78e4b31e904" title=" " alt="" coords="2009,360,2118,387"/>
<area shape="rect" href="vgic-irqfd_8c.html#aaba342a8b6308d37735bc46dbf9a6828" title=" " alt="" coords="1995,305,2132,332"/>
<area shape="rect" href="vgic-irqfd_8c.html#a93415dbe2d5c7166c8f3f91be7c5d5da" title=" " alt="" coords="2205,361,2352,388"/>
<area shape="rect" href="vgic-its_8c.html#a53bf66e96dae9553e637fa69e8835365" title=" " alt="" coords="2205,311,2352,337"/>
<area shape="rect" href="vgic-its_8c.html#a352c8627ccf81a8154ae2275c7d50659" title=" " alt="" coords="2400,303,2568,345"/>
<area shape="rect" href="vgic-its_8c.html#ad62375be0591178764e98b79cd7217bf" title=" " alt="" coords="2407,201,2561,228"/>
<area shape="rect" href="vgic-its_8c.html#a94bbb30efc49ad5494a7f4b1410dbe01" title=" " alt="" coords="2423,539,2545,565"/>
<area shape="rect" href="vgic-its_8c.html#ab8e3bef933af0cc51b05259d801be26d" title=" " alt="" coords="2620,303,2783,329"/>
<area shape="rect" href="vgic-its_8c.html#aa5825fcbd841b62853870d25976d018b" title=" " alt="" coords="2835,303,3011,329"/>
<area shape="rect" href="vgic_8c.html#affa1a20a5bd9d67dc546c1ccaace3406" title=" " alt="" coords="2841,404,3004,431"/>
<area shape="rect" href="vgic_8c.html#a7d513558f0ea4ecbc012c98b3522f797" title=" " alt="" coords="3099,404,3227,431"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="2861,132,2984,159"/>
<area shape="rect" href="vgic_8c.html#a10a21280f37c620b743df86980f6d247" title=" " alt="" coords="2851,201,2994,228"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="3059,88,3267,115"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="3086,139,3239,165"/>
<area shape="rect" href="vgic_8h.html#a1109d873011f89a4acb4fd461f9f0a45" title=" " alt="" coords="3105,201,3221,228"/>
<area shape="rect" href="vgic-its_8c.html#a3fe23d687675cef46a95e36cf14d04e1" title=" " alt="" coords="2626,49,2777,76"/>
<area shape="rect" href="vgic-its_8c.html#a0fb230e293b92c9fb746ad7b97ac68d5" title=" " alt="" coords="2851,56,2994,83"/>
<area shape="rect" href="vgic-its_8c.html#ae32cde43818922d2ecf800a3de102b75" title=" " alt="" coords="2887,5,2958,32"/>
<area shape="rect" href="kvm__main_8c.html#acb4d46ae6cc918253046320805f63a95" title=" " alt="" coords="2622,539,2781,565"/>
<area shape="rect" href="vgic-v2_8c.html#a4e8ee3d5f7c8fadbf0a645df67a1c5a2" title=" " alt="" coords="1313,663,1435,689"/>
<area shape="rect" href="vgic-v3_8c.html#abe9a2245dfa0d76d61c99b60f714a513" title=" " alt="" coords="1313,612,1435,639"/>
<area shape="rect" href="vgic-v4_8c.html#af99c2f70dd91a57879b3a2f583e49a4a" title=" " alt="" coords="1283,252,1465,279"/>
<area shape="rect" href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce" title=" " alt="" coords="1304,353,1444,380"/>
<area shape="rect" href="vgic-v4_8c.html#ac22161596c9858cc700bab08c03fc422" title=" " alt="" coords="1969,252,2157,279"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ae6434d5e6ad74c608886c368e56d67bc_icgraph.png" border="0" usemap="#apmu-emul_8c_ae6434d5e6ad74c608886c368e56d67bc_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ae6434d5e6ad74c608886c368e56d67bc_icgraph" id="apmu-emul_8c_ae6434d5e6ad74c608886c368e56d67bc_icgraph">
<area shape="rect" title=" " alt="" coords="412,5,595,32"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,5,364,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="ac61ce96eac7250a65660c7405d72b820"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac61ce96eac7250a65660c7405d72b820">&#9670;&nbsp;</a></span>kvm_pmu_update_run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_update_run </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00388">388</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;{</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keyword">struct </span>kvm_sync_regs *regs = &amp;vcpu-&gt;run-&gt;s.regs;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">/* Populate the timer bitmap for user space */</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    regs-&gt;device_irq_level &amp;= ~KVM_ARM_DEV_PMU;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">if</span> (vcpu-&gt;arch.pmu.irq_level)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        regs-&gt;device_irq_level |= KVM_ARM_DEV_PMU;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ac61ce96eac7250a65660c7405d72b820_icgraph.png" border="0" usemap="#apmu-emul_8c_ac61ce96eac7250a65660c7405d72b820_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ac61ce96eac7250a65660c7405d72b820_icgraph" id="apmu-emul_8c_ac61ce96eac7250a65660c7405d72b820_icgraph">
<area shape="rect" title=" " alt="" coords="412,5,579,32"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,5,364,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="ac79256eb94d7599687d3294cd40d10b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac79256eb94d7599687d3294cd40d10b4">&#9670;&nbsp;</a></span>kvm_pmu_update_state()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kvm_pmu_update_state </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00352">352</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keyword">struct </span>kvm_pmu *pmu = &amp;vcpu-&gt;arch.pmu;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordtype">bool</span> overflow;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">if</span> (!kvm_vcpu_has_pmu(vcpu))</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    overflow = !!<a class="code" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359">kvm_pmu_overflow_status</a>(vcpu);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span> (pmu-&gt;irq_level == overflow)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    pmu-&gt;irq_level = overflow;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (likely(irqchip_in_kernel(vcpu-&gt;kvm))) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordtype">int</span> ret = <a class="code" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4">kvm_vgic_inject_irq</a>(vcpu-&gt;kvm, vcpu,</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                          pmu-&gt;irq_num, overflow, pmu);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        WARN_ON(ret);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div>
<div class="ttc" id="avgic_8c_html_a87038ce452e0054b853c10ccbbcc78a4"><div class="ttname"><a href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4">kvm_vgic_inject_irq</a></div><div class="ttdeci">int kvm_vgic_inject_irq(struct kvm *kvm, struct kvm_vcpu *vcpu, unsigned int intid, bool level, void *owner)</div><div class="ttdef"><b>Definition:</b> <a href="vgic_8c_source.html#l00439">vgic.c:439</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ac79256eb94d7599687d3294cd40d10b4_cgraph.png" border="0" usemap="#apmu-emul_8c_ac79256eb94d7599687d3294cd40d10b4_cgraph" alt=""/></div>
<map name="apmu-emul_8c_ac79256eb94d7599687d3294cd40d10b4_cgraph" id="apmu-emul_8c_ac79256eb94d7599687d3294cd40d10b4_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,184,159"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="232,56,429,83"/>
<area shape="rect" href="vgic_8c.html#a87038ce452e0054b853c10ccbbcc78a4" title=" " alt="" coords="255,157,407,184"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="481,5,646,32"/>
<area shape="rect" href="vgic_8c.html#a7f38a266ef3def3202e7e04aa40fd516" title=" " alt="" coords="513,157,614,184"/>
<area shape="rect" href="vgic-init_8c.html#a3c860e1d043352d9a02f4780b58e5af6" title=" " alt="" coords="508,385,619,412"/>
<area shape="rect" href="vgic_8c.html#ac055f2fa0d463d3d287ee975bb80a9c5" title=" " alt="" coords="2420,107,2521,133"/>
<area shape="rect" href="vgic_8c.html#a1e208ac24f54fa95ba74797758c5b84c" title=" " alt="" coords="2385,360,2556,387"/>
<area shape="rect" href="vgic_8c.html#a19d9c44a40cc76ccbd25bd8e0ec38a08" title=" " alt="" coords="477,56,649,83"/>
<area shape="rect" href="vgic_8c.html#afeaf79de85450ed5fb52dbd7bd8c6617" title=" " alt="" coords="1543,157,1643,184"/>
<area shape="rect" href="vgic_8h.html#a43d39599f0fd2d973c5af8d6045e0f91" title=" " alt="" coords="2883,309,3018,336"/>
<area shape="rect" href="vgic-init_8c.html#a39a12fe5ed5534efda33bb215a320a57" title=" " alt="" coords="697,469,775,496"/>
<area shape="rect" href="vgic-init_8c.html#a0f9be5cc88c88f6c0180c53b72818d3b" title=" " alt="" coords="841,637,985,664"/>
<area shape="rect" href="vgic-irqfd_8c.html#ab5dcaa98f287aec5083bd60daf115d71" title=" " alt="" coords="823,403,1004,445"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a47708b59ddd94e03880996def466067e" title=" " alt="" coords="2419,495,2522,521"/>
<area shape="rect" href="vgic-init_8c.html#a2eee0060a3bdcd2a9e8fe1451a3a3fc2" title=" " alt="" coords="826,352,1001,379"/>
<area shape="rect" href="vgic-debug_8c.html#a42534d23071b4f3c441c5f82f9e5c1ce" title=" " alt="" coords="851,469,975,496"/>
<area shape="rect" href="vgic-its_8c.html#afd97b5d03d2b30ae4481443cdea2e739" title=" " alt="" coords="839,521,988,562"/>
<area shape="rect" href="vgic-mmio-v3_8c.html#a839b15883ba8f9de35a03ffce32fdf7f" title=" " alt="" coords="1496,345,1691,372"/>
<area shape="rect" href="vgic-v4_8c.html#a802a906ad744a75b5af33bbd6b31237c" title=" " alt="" coords="863,688,963,715"/>
<area shape="rect" href="irqchip_8c.html#a2c54cf3c324c7d2b9190fffcf4a1f20a" title=" " alt="" coords="1066,469,1221,496"/>
<area shape="rect" href="irqchip_8c.html#a5ae37186e6e6d1594767f83df8bab64a" title=" " alt="" coords="1283,520,1448,547"/>
<area shape="rect" href="irqchip_8c.html#ab06caa34c3a7189a433815036dd3ebb3" title=" " alt="" coords="1289,469,1441,496"/>
<area shape="rect" href="vgic-irqfd_8c.html#aceb0f3f9718caf022b2ff6f982fee020" title=" " alt="" coords="1507,477,1679,504"/>
<area shape="rect" href="vgic-irqfd_8c.html#affb5599a3efafc186b72e78e4b31e904" title=" " alt="" coords="1778,477,1887,504"/>
<area shape="rect" href="vgic-irqfd_8c.html#aaba342a8b6308d37735bc46dbf9a6828" title=" " alt="" coords="1764,532,1901,559"/>
<area shape="rect" href="vgic-irqfd_8c.html#a93415dbe2d5c7166c8f3f91be7c5d5da" title=" " alt="" coords="1975,477,2121,504"/>
<area shape="rect" href="vgic-its_8c.html#a53bf66e96dae9553e637fa69e8835365" title=" " alt="" coords="1975,275,2121,301"/>
<area shape="rect" href="vgic-its_8c.html#a352c8627ccf81a8154ae2275c7d50659" title=" " alt="" coords="2169,209,2337,250"/>
<area shape="rect" href="vgic-its_8c.html#ad62375be0591178764e98b79cd7217bf" title=" " alt="" coords="2177,275,2330,301"/>
<area shape="rect" href="vgic-its_8c.html#a94bbb30efc49ad5494a7f4b1410dbe01" title=" " alt="" coords="2192,376,2315,403"/>
<area shape="rect" href="vgic-its_8c.html#ab8e3bef933af0cc51b05259d801be26d" title=" " alt="" coords="2620,360,2783,387"/>
<area shape="rect" href="vgic-its_8c.html#aa5825fcbd841b62853870d25976d018b" title=" " alt="" coords="2863,360,3039,387"/>
<area shape="rect" href="vgic_8c.html#affa1a20a5bd9d67dc546c1ccaace3406" title=" " alt="" coords="2869,183,3032,209"/>
<area shape="rect" href="vgic_8c.html#a7d513558f0ea4ecbc012c98b3522f797" title=" " alt="" coords="3103,183,3231,209"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="2640,589,2763,616"/>
<area shape="rect" href="vgic_8c.html#a10a21280f37c620b743df86980f6d247" title=" " alt="" coords="2630,461,2773,488"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="2847,615,3055,641"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="2874,564,3027,591"/>
<area shape="rect" href="vgic_8h.html#a1109d873011f89a4acb4fd461f9f0a45" title=" " alt="" coords="2893,461,3009,488"/>
<area shape="rect" href="vgic-its_8c.html#a3fe23d687675cef46a95e36cf14d04e1" title=" " alt="" coords="2395,259,2546,285"/>
<area shape="rect" href="vgic-its_8c.html#a0fb230e293b92c9fb746ad7b97ac68d5" title=" " alt="" coords="2630,259,2773,285"/>
<area shape="rect" href="vgic-its_8c.html#ae32cde43818922d2ecf800a3de102b75" title=" " alt="" coords="2666,208,2737,235"/>
<area shape="rect" href="vgic-its_8c.html#ad9756268e1c22946f868e3255f916aa6" title=" " alt="" coords="2604,309,2799,336"/>
<area shape="rect" href="kvm__main_8c.html#acb4d46ae6cc918253046320805f63a95" title=" " alt="" coords="2391,411,2550,437"/>
<area shape="rect" href="vgic-v2_8c.html#a4e8ee3d5f7c8fadbf0a645df67a1c5a2" title=" " alt="" coords="1082,403,1205,429"/>
<area shape="rect" href="vgic-v3_8c.html#abe9a2245dfa0d76d61c99b60f714a513" title=" " alt="" coords="1082,352,1205,379"/>
<area shape="rect" href="vgic-v4_8c.html#af99c2f70dd91a57879b3a2f583e49a4a" title=" " alt="" coords="1052,688,1235,715"/>
<area shape="rect" href="vgic-v4_8c.html#ac805e466fa8f454112c11904ef8d41ce" title=" " alt="" coords="1073,637,1213,664"/>
<area shape="rect" href="vgic-v4_8c.html#ac22161596c9858cc700bab08c03fc422" title=" " alt="" coords="1739,656,1927,683"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ac79256eb94d7599687d3294cd40d10b4_icgraph.png" border="0" usemap="#apmu-emul_8c_ac79256eb94d7599687d3294cd40d10b4_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ac79256eb94d7599687d3294cd40d10b4_icgraph" id="apmu-emul_8c_ac79256eb94d7599687d3294cd40d10b4_icgraph">
<area shape="rect" title=" " alt="" coords="644,31,823,57"/>
<area shape="rect" href="pmu-emul_8c.html#ab0f1f020b6774de3fb4ff4c8b4e45a5c" title=" " alt="" coords="412,5,596,32"/>
<area shape="rect" href="pmu-emul_8c.html#ae6434d5e6ad74c608886c368e56d67bc" title=" " alt="" coords="413,56,595,83"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,31,364,57"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,31,129,57"/>
</map>
</div>

</div>
</div>
<a id="a48da2aca99c9f2f7728c108ebfe1aab6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48da2aca99c9f2f7728c108ebfe1aab6">&#9670;&nbsp;</a></span>kvm_pmu_valid_counter_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64 kvm_pmu_valid_counter_mask </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00268">268</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;{</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    u64 val = FIELD_GET(ARMV8_PMU_PMCR_N, <a class="code" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6">kvm_vcpu_read_pmcr</a>(vcpu));</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span> (val == 0)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">return</span> BIT(ARMV8_PMU_CYCLE_IDX);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">return</span> GENMASK(val - 1, 0) | BIT(ARMV8_PMU_CYCLE_IDX);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a48da2aca99c9f2f7728c108ebfe1aab6_cgraph.png" border="0" usemap="#apmu-emul_8c_a48da2aca99c9f2f7728c108ebfe1aab6_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a48da2aca99c9f2f7728c108ebfe1aab6_cgraph" id="apmu-emul_8c_a48da2aca99c9f2f7728c108ebfe1aab6_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,231,32"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="279,5,444,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a48da2aca99c9f2f7728c108ebfe1aab6_icgraph.png" border="0" usemap="#apmu-emul_8c_a48da2aca99c9f2f7728c108ebfe1aab6_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a48da2aca99c9f2f7728c108ebfe1aab6_icgraph" id="apmu-emul_8c_a48da2aca99c9f2f7728c108ebfe1aab6_icgraph">
<area shape="rect" title=" " alt="" coords="1501,208,1727,235"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1299,5,1429,32"/>
<area shape="rect" href="sys__regs_8c.html#a28f5c65ab2f26c33ee8a6be17c79e15c" title=" " alt="" coords="1301,56,1427,83"/>
<area shape="rect" href="sys__regs_8c.html#a8de3a35de8563dfb8655da10034bc411" title=" " alt="" coords="1305,107,1423,133"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1299,157,1429,184"/>
<area shape="rect" href="sys__regs_8c.html#a1b1c2d475ae8718190fb063eb6e8b00a" title=" " alt="" coords="1318,208,1410,235"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="1275,259,1453,285"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="1053,309,1227,336"/>
<area shape="rect" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5" title=" " alt="" coords="1281,360,1447,387"/>
<area shape="rect" href="sys__regs_8c.html#a65d655135bd1275c47f0ae8999593875" title=" " alt="" coords="1319,411,1409,437"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="1087,259,1193,285"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="837,309,998,336"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="384,319,571,345"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,360,129,387"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1075,360,1205,387"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="829,360,1005,387"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="619,385,781,412"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,385,336,412"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="398,378,557,419"/>
</map>
</div>

</div>
</div>
<a id="aca66e6898e68588135dbba11916ef625"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca66e6898e68588135dbba11916ef625">&#9670;&nbsp;</a></span>kvm_pmu_vcpu_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_vcpu_destroy </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_vcpu_destroy - free perf event of PMU for cpu @vcpu: The vcpu pointer </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00259">259</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;{</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; ARMV8_PMU_MAX_COUNTERS; i++)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <a class="code" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4">kvm_pmu_release_perf_event</a>(<a class="code" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a>(vcpu, i));</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    irq_work_sync(&amp;vcpu-&gt;arch.pmu.overflow_work);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_aca66e6898e68588135dbba11916ef625_cgraph.png" border="0" usemap="#apmu-emul_8c_aca66e6898e68588135dbba11916ef625_cgraph" alt=""/></div>
<map name="apmu-emul_8c_aca66e6898e68588135dbba11916ef625_cgraph" id="apmu-emul_8c_aca66e6898e68588135dbba11916ef625_cgraph">
<area shape="rect" title=" " alt="" coords="5,42,187,69"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="235,5,409,47"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="237,71,407,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_aca66e6898e68588135dbba11916ef625_icgraph.png" border="0" usemap="#apmu-emul_8c_aca66e6898e68588135dbba11916ef625_icgraph" alt=""/></div>
<map name="apmu-emul_8c_aca66e6898e68588135dbba11916ef625_icgraph" id="apmu-emul_8c_aca66e6898e68588135dbba11916ef625_icgraph">
<area shape="rect" title=" " alt="" coords="1705,79,1887,105"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1477,79,1657,105"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1257,53,1402,80"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1229,104,1429,131"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1029,53,1181,80"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="811,53,981,80"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="453,9,580,36"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="628,79,763,105"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="212,5,405,32"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="459,104,574,131"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="234,56,383,83"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="226,107,391,133"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="231,157,386,184"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="241,208,376,235"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="5,56,164,83"/>
</map>
</div>

</div>
</div>
<a id="a7975a55f74c880d2fc9a9b59573c9768"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7975a55f74c880d2fc9a9b59573c9768">&#9670;&nbsp;</a></span>kvm_pmu_vcpu_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_vcpu_init </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_vcpu_init - assign pmu counter idx for cpu @vcpu: The vcpu pointer </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00231">231</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keyword">struct </span>kvm_pmu *pmu = &amp;vcpu-&gt;arch.pmu;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; ARMV8_PMU_MAX_COUNTERS; i++)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        pmu-&gt;pmc[i].idx = i;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a7975a55f74c880d2fc9a9b59573c9768_icgraph.png" border="0" usemap="#apmu-emul_8c_a7975a55f74c880d2fc9a9b59573c9768_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a7975a55f74c880d2fc9a9b59573c9768_icgraph" id="apmu-emul_8c_a7975a55f74c880d2fc9a9b59573c9768_icgraph">
<area shape="rect" title=" " alt="" coords="473,5,627,32"/>
<area shape="rect" href="arm_8c.html#ae2ebf37d8daf1a8b43a9823bae4ab32b" title=" " alt="" coords="253,5,425,32"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="5,5,205,32"/>
</map>
</div>

</div>
</div>
<a id="aeda0ad1ae56bc4244298ae7e6c5363e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeda0ad1ae56bc4244298ae7e6c5363e5">&#9670;&nbsp;</a></span>kvm_pmu_vcpu_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_pmu_vcpu_reset </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_pmu_vcpu_reset - reset pmu state for cpu @vcpu: The vcpu pointer </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00245">245</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;{</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> mask = <a class="code" href="pmu-emul_8c.html#a48da2aca99c9f2f7728c108ebfe1aab6">kvm_pmu_valid_counter_mask</a>(vcpu);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    for_each_set_bit(i, &amp;mask, 32)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096">kvm_pmu_stop_counter</a>(<a class="code" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638">kvm_vcpu_idx_to_pmc</a>(vcpu, i));</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_aeda0ad1ae56bc4244298ae7e6c5363e5_cgraph.png" border="0" usemap="#apmu-emul_8c_aeda0ad1ae56bc4244298ae7e6c5363e5_cgraph" alt=""/></div>
<map name="apmu-emul_8c_aeda0ad1ae56bc4244298ae7e6c5363e5_cgraph" id="apmu-emul_8c_aeda0ad1ae56bc4244298ae7e6c5363e5_cgraph">
<area shape="rect" title=" " alt="" coords="5,223,171,250"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="242,122,421,149"/>
<area shape="rect" href="pmu-emul_8c.html#a48da2aca99c9f2f7728c108ebfe1aab6" title=" " alt="" coords="219,223,444,250"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="246,274,417,301"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="733,46,896,73"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="944,147,1088,174"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="492,122,685,149"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="501,5,676,47"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="743,97,887,123"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="506,249,671,275"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_aeda0ad1ae56bc4244298ae7e6c5363e5_icgraph.png" border="0" usemap="#apmu-emul_8c_aeda0ad1ae56bc4244298ae7e6c5363e5_icgraph" alt=""/></div>
<map name="apmu-emul_8c_aeda0ad1ae56bc4244298ae7e6c5363e5_icgraph" id="apmu-emul_8c_aeda0ad1ae56bc4244298ae7e6c5363e5_icgraph">
<area shape="rect" title=" " alt="" coords="1231,81,1396,108"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1053,81,1183,108"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="829,5,1005,32"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="619,48,781,75"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,107,336,133"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="837,157,998,184"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="398,41,557,82"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,132,129,159"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="384,157,571,184"/>
</map>
</div>

</div>
</div>
<a id="af0e28bffa2a3c2ed1f5e6405b8284638"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0e28bffa2a3c2ed1f5e6405b8284638">&#9670;&nbsp;</a></span>kvm_vcpu_idx_to_pmc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct kvm_pmc* kvm_vcpu_idx_to_pmc </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cnt_idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00034">34</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">return</span> &amp;vcpu-&gt;arch.pmu.pmc[cnt_idx];</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_af0e28bffa2a3c2ed1f5e6405b8284638_icgraph.png" border="0" usemap="#apmu-emul_8c_af0e28bffa2a3c2ed1f5e6405b8284638_icgraph" alt=""/></div>
<map name="apmu-emul_8c_af0e28bffa2a3c2ed1f5e6405b8284638_icgraph" id="apmu-emul_8c_af0e28bffa2a3c2ed1f5e6405b8284638_icgraph">
<area shape="rect" title=" " alt="" coords="2391,264,2561,290"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2127,205,2343,232"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1321,129,1559,156"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="875,180,1053,206"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1355,315,1525,356"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1101,256,1272,298"/>
<area shape="rect" href="pmu-emul_8c.html#a4ad466b516d040694a5b25e1c9eef495" title=" " alt="" coords="1320,53,1560,80"/>
<area shape="rect" href="pmu-emul_8c.html#a57b710f17cc1fc314f8f1e297bcb85f3" title=" " alt="" coords="2149,366,2320,407"/>
<area shape="rect" href="pmu-emul_8c.html#aca66e6898e68588135dbba11916ef625" title=" " alt="" coords="2144,508,2325,534"/>
<area shape="rect" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5" title=" " alt="" coords="2152,440,2317,466"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1876,205,2059,232"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="1856,150,2079,177"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1624,198,1792,239"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1344,205,1536,232"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1121,104,1252,130"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="687,180,793,206"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="653,260,827,286"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="428,365,589,392"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,378,364,405"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,410,129,437"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1107,322,1266,349"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="889,289,1039,316"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1643,146,1773,173"/>
<area shape="rect" href="sys__regs_8c.html#a619f21eb31e46258fdc0f120f206521f" title=" " alt="" coords="1904,365,2031,392"/>
<area shape="rect" href="arm_8c.html#a25d188e4f0871968b9f428c79720a502" title=" " alt="" coords="1877,517,2057,544"/>
<area shape="rect" href="kvm__main_8c.html#a7218df747387e4034ab8442f187306b1" title=" " alt="" coords="1635,568,1781,594"/>
<area shape="rect" href="kvm__main_8c.html#ab8870469dadfadf9a204346c62016293" title=" " alt="" coords="1608,517,1808,544"/>
<area shape="rect" href="kvm__main_8c.html#a0fcd9f7671bee7debec1bc05dcd9557b" title=" " alt="" coords="1364,568,1516,594"/>
<area shape="rect" href="arm_8c.html#ad84dda268db5d48c48f3ef2f438c62a7" title=" " alt="" coords="1101,568,1272,594"/>
<area shape="rect" href="kvm__main_8c.html#a54b22e6be98d31db1a83e7993fbcf4bc" title=" " alt="" coords="677,568,803,594"/>
<area shape="rect" href="kvm__main_8c.html#afd922c538c448ab1248cdb9dccae9410" title=" " alt="" coords="897,618,1031,645"/>
<area shape="rect" href="kvm__main_8c.html#a955de4f2a1b3371438636eccab732b27" title=" " alt="" coords="412,568,605,594"/>
<area shape="rect" href="kvm__main_8c.html#a013962010b954d8597e5987fd27c8241" title=" " alt="" coords="683,644,797,670"/>
<area shape="rect" href="kvm__main_8c.html#a37fa7805021941c56fe174eae4c8c377" title=" " alt="" coords="434,618,583,645"/>
<area shape="rect" href="kvm__main_8c.html#af19040bdcea372f13eab66499d99201c" title=" " alt="" coords="426,669,591,696"/>
<area shape="rect" href="guest__memfd_8c.html#ad8912fbda61cdcb6d9e5a3c0f839e001" title=" " alt="" coords="431,720,586,746"/>
<area shape="rect" href="kvm__main_8c.html#af67afbdcee89641f21573ac643d8e693" title=" " alt="" coords="441,770,576,797"/>
<area shape="rect" href="kvm__main_8c.html#a87bcafdc42ee32aedb84df5e564f9872" title=" " alt="" coords="191,618,350,645"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1122,466,1251,493"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="876,466,1052,493"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="659,441,821,468"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="191,441,350,468"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="429,434,588,475"/>
</map>
</div>

</div>
</div>
<a id="adf428205295b3bc4fec2e00fb2c50fa6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf428205295b3bc4fec2e00fb2c50fa6">&#9670;&nbsp;</a></span>kvm_vcpu_read_pmcr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64 kvm_vcpu_read_pmcr </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>kvm_vcpu_read_pmcr - Read PMCR_EL0 register for the vCPU @vcpu: The vcpu pointer </p>

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l01136">1136</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;{</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    u64 pmcr = __vcpu_sys_reg(vcpu, PMCR_EL0);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="keywordflow">return</span> u64_replace_bits(pmcr, vcpu-&gt;kvm-&gt;arch.pmcr_n, ARMV8_PMU_PMCR_N);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_adf428205295b3bc4fec2e00fb2c50fa6_icgraph.png" border="0" usemap="#apmu-emul_8c_adf428205295b3bc4fec2e00fb2c50fa6_icgraph" alt=""/></div>
<map name="apmu-emul_8c_adf428205295b3bc4fec2e00fb2c50fa6_icgraph" id="apmu-emul_8c_adf428205295b3bc4fec2e00fb2c50fa6_icgraph">
<area shape="rect" title=" " alt="" coords="3047,251,3212,278"/>
<area shape="rect" href="sys__regs_8c.html#ae72951c06b3847653660caea2df30434" title=" " alt="" coords="887,82,993,109"/>
<area shape="rect" href="sys__regs_8c.html#ab7f4254c80f8d9a86cacdc232772ee1f" title=" " alt="" coords="2848,62,2931,89"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="2780,306,2999,333"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="1523,139,1760,166"/>
<area shape="rect" href="pmu-emul_8c.html#a2adeb16260e5920e10beedc3e854c28c" title=" " alt="" coords="853,569,1027,595"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="2295,282,2511,309"/>
<area shape="rect" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307" title=" " alt="" coords="2565,157,2726,199"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="2304,442,2501,469"/>
<area shape="rect" href="pmu-emul_8c.html#a48da2aca99c9f2f7728c108ebfe1aab6" title=" " alt="" coords="1529,631,1754,658"/>
<area shape="rect" href="sys__regs_8c.html#ad9997b5fac75ffbb762473aefcb99d6b" title=" " alt="" coords="1555,341,1728,367"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="2339,383,2466,410"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="2559,325,2732,367"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1808,245,1976,287"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="2044,333,2227,359"/>
<area shape="rect" href="pmu-emul_8c.html#a22f1aab98d3f43c3b6d5a33d1886d474" title=" " alt="" coords="1556,275,1727,316"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="1545,223,1737,250"/>
<area shape="rect" href="sys__regs_8c.html#a95ce985a39ee6e0e9274d873a271e235" title=" " alt="" coords="1324,173,1455,199"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="1077,191,1256,218"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="630,619,791,646"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="384,598,571,625"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,661,129,687"/>
<area shape="rect" href="sys__regs_8c.html#ae0260b12f95bb7f271037d3e4b18b22b" title=" " alt="" coords="1310,290,1469,317"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="1304,224,1475,265"/>
<area shape="rect" href="sys__regs_8c.html#a02a036e9adee46363c44fc787cd30cc4" title=" " alt="" coords="1091,271,1242,298"/>
<area shape="rect" href="pmu-emul_8c.html#ad8e8d02257514c13e74129b61ecca713" title=" " alt="" coords="2024,282,2247,309"/>
<area shape="rect" href="sys__regs_8c.html#a51b08d9bb2f9a5a87955b5554df3d8e2" title=" " alt="" coords="1324,442,1455,469"/>
<area shape="rect" href="pmu-emul_8c.html#ac79256eb94d7599687d3294cd40d10b4" title=" " alt="" coords="851,518,1029,545"/>
<area shape="rect" href="pmu-emul_8c.html#ab0f1f020b6774de3fb4ff4c8b4e45a5c" title=" " alt="" coords="619,518,803,545"/>
<area shape="rect" href="pmu-emul_8c.html#ae6434d5e6ad74c608886c368e56d67bc" title=" " alt="" coords="619,569,802,595"/>
<area shape="rect" href="sys__regs_8c.html#a28f5c65ab2f26c33ee8a6be17c79e15c" title=" " alt="" coords="1326,746,1453,773"/>
<area shape="rect" href="sys__regs_8c.html#a8de3a35de8563dfb8655da10034bc411" title=" " alt="" coords="1331,797,1448,823"/>
<area shape="rect" href="sys__regs_8c.html#a1b1c2d475ae8718190fb063eb6e8b00a" title=" " alt="" coords="1343,594,1435,621"/>
<area shape="rect" href="pmu-emul_8c.html#aeda0ad1ae56bc4244298ae7e6c5363e5" title=" " alt="" coords="1307,847,1472,874"/>
<area shape="rect" href="sys__regs_8c.html#a65d655135bd1275c47f0ae8999593875" title=" " alt="" coords="1344,645,1435,671"/>
<area shape="rect" href="reset_8c.html#a124698ccde953ff74d270ddd091fc3a9" title=" " alt="" coords="1102,746,1231,773"/>
<area shape="rect" href="arm_8c.html#ae1c5fe27678796057c4ea914a9a6897b" title=" " alt="" coords="852,791,1028,818"/>
<area shape="rect" href="arm_8c.html#a91790a6a024c83b103717f37a8f0f504" title=" " alt="" coords="629,745,792,771"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,686,336,713"/>
<area shape="rect" href="arm_8c.html#ad66c8d00e8adc8315c45170fa270304b" title=" " alt="" coords="398,737,557,779"/>
</map>
</div>

</div>
</div>
<a id="a2adeb16260e5920e10beedc3e854c28c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2adeb16260e5920e10beedc3e854c28c">&#9670;&nbsp;</a></span>kvm_vcpu_reload_pmu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kvm_vcpu_reload_pmu </td>
          <td>(</td>
          <td class="paramtype">struct kvm_vcpu *&#160;</td>
          <td class="paramname"><em>vcpu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00805">805</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;{</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    u64 mask = <a class="code" href="pmu-emul_8c.html#a48da2aca99c9f2f7728c108ebfe1aab6">kvm_pmu_valid_counter_mask</a>(vcpu);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160; </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <a class="code" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975">kvm_pmu_handle_pmcr</a>(vcpu, <a class="code" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6">kvm_vcpu_read_pmcr</a>(vcpu));</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    __vcpu_sys_reg(vcpu, PMOVSSET_EL0) &amp;= mask;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    __vcpu_sys_reg(vcpu, PMINTENSET_EL1) &amp;= mask;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    __vcpu_sys_reg(vcpu, PMCNTENSET_EL0) &amp;= mask;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;}</div>
<div class="ttc" id="apmu-emul_8c_html_a78f7241a751047d73f010db81b33a975"><div class="ttname"><a href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975">kvm_pmu_handle_pmcr</a></div><div class="ttdeci">void kvm_pmu_handle_pmcr(struct kvm_vcpu *vcpu, u64 val)</div><div class="ttdef"><b>Definition:</b> <a href="pmu-emul_8c_source.html#l00551">pmu-emul.c:551</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a2adeb16260e5920e10beedc3e854c28c_cgraph.png" border="0" usemap="#apmu-emul_8c_a2adeb16260e5920e10beedc3e854c28c_cgraph" alt=""/></div>
<map name="apmu-emul_8c_a2adeb16260e5920e10beedc3e854c28c_cgraph" id="apmu-emul_8c_a2adeb16260e5920e10beedc3e854c28c_cgraph">
<area shape="rect" title=" " alt="" coords="5,1334,179,1361"/>
<area shape="rect" href="pmu-emul_8c.html#a78f7241a751047d73f010db81b33a975" title=" " alt="" coords="227,1197,405,1223"/>
<area shape="rect" href="pmu-emul_8c.html#adf428205295b3bc4fec2e00fb2c50fa6" title=" " alt="" coords="2348,1085,2513,1111"/>
<area shape="rect" href="pmu-emul_8c.html#a48da2aca99c9f2f7728c108ebfe1aab6" title=" " alt="" coords="453,1334,679,1361"/>
<area shape="rect" href="pmu-emul_8c.html#a4ad466b516d040694a5b25e1c9eef495" title=" " alt="" coords="1273,1283,1513,1310"/>
<area shape="rect" href="pmu-emul_8c.html#af0e28bffa2a3c2ed1f5e6405b8284638" title=" " alt="" coords="1844,1131,2015,1158"/>
<area shape="rect" href="pmu-emul_8c.html#a4d7ab7f63f8cc0a899fb45ebfeb851d6" title=" " alt="" coords="727,1157,964,1183"/>
<area shape="rect" href="pmu-emul_8c.html#a73de9042a2fa76e79cc6d9103b914b59" title=" " alt="" coords="481,1073,651,1115"/>
<area shape="rect" href="pmu-emul_8c.html#a6347b7f1221bf9ecfeab143625e8391f" title=" " alt="" coords="749,423,941,450"/>
<area shape="rect" href="pmu_8c.html#a928d4df1b401e9b41f92dd2aa2744529" title=" " alt="" coords="477,81,655,123"/>
<area shape="rect" href="pmu-emul_8c.html#a0d8ed834b14cf4fb055173129b978fed" title=" " alt="" coords="1035,551,1203,592"/>
<area shape="rect" href="pmu-emul_8c.html#a7f03e9b6af2651bb2bcc5471953076e6" title=" " alt="" coords="1606,659,1733,686"/>
<area shape="rect" href="pmu-emul_8c.html#a10ab89dbf42da547c48fc7a7ad9fc2f4" title=" " alt="" coords="2359,482,2503,509"/>
<area shape="rect" href="pmu-emul_8c.html#a25e7862bfe86692b32844810dbe3d6a3" title=" " alt="" coords="1857,507,2001,534"/>
<area shape="rect" href="pmu-emul_8c.html#a507cc0978c12a18465f8f5d3987db1f3" title=" " alt="" coords="1838,558,2021,585"/>
<area shape="rect" href="pmu-emul_8c.html#ab5c66bf309304f71e8b9450e35983307" title=" " alt="" coords="2110,1019,2271,1060"/>
<area shape="rect" href="pmu-emul_8c.html#a4d63c2f53e5548109d366a7e08be43ae" title=" " alt="" coords="1842,609,2017,635"/>
<area shape="rect" href="pmu-emul_8c.html#acb35ae097b8b697c84c55e519566fb6a" title=" " alt="" coords="1573,457,1766,483"/>
<area shape="rect" href="pmu-emul_8c.html#a1b6c636b23b4bafd5809116ae997c71d" title=" " alt="" coords="1302,819,1485,846"/>
<area shape="rect" href="pmu-emul_8c.html#ab7d35d75d609bb5ca09226888f2bd096" title=" " alt="" coords="1304,406,1483,433"/>
<area shape="rect" href="pmu-emul_8c.html#a4262ee1559f306136fd3b9374f3ae9d3" title=" " alt="" coords="2081,710,2300,737"/>
<area shape="rect" href="pmu-emul_8c.html#a94af260df1767fa3e538518c9e6436ff" title=" " alt="" coords="2097,609,2285,635"/>
<area shape="rect" href="pmu-emul_8c.html#a450695105665f1fe0e9d2db927315c5a" title=" " alt="" coords="1848,406,2011,433"/>
<area shape="rect" href="pmu-emul_8c.html#a07f848e7e5bf226439a5ee53c941eafc" title=" " alt="" coords="1843,812,2016,853"/>
<area shape="rect" href="pmu-emul_8c.html#a1698d35e55cb9b3545159fbfae5121d2" title=" " alt="" coords="1561,710,1777,737"/>
<area shape="rect" href="pmu-emul_8c.html#a4115d1a923a4a0f28962cbd9dc0b2359" title=" " alt="" coords="2092,1085,2289,1111"/>
<area shape="rect" href="kvm__main_8c.html#ac82f28c95da4a0cc137c5a37f08d1f44" title=" " alt="" coords="1608,929,1731,955"/>
<area shape="rect" href="arm_8c.html#a42500cdc8706ebf4fa3ec21645530097" title=" " alt="" coords="1825,929,2033,955"/>
<area shape="rect" href="kvm__main_8c.html#ad9f0140eebcdef9a9ebae54431d2fba5" title=" " alt="" coords="1853,979,2006,1006"/>
<area shape="rect" href="pmu-emul_8c.html#aa8b667a7c4c404322fa2f145e656b4a4" title=" " alt="" coords="1582,289,1757,331"/>
<area shape="rect" href="pmu_8c.html#abf97c7a6b0768cbe660dea1a404bc79b" title=" " alt="" coords="762,63,929,90"/>
<area shape="rect" href="pmu_8c.html#ad4ce451e7a40f149ed26e7ce8d9700d4" title=" " alt="" coords="742,114,949,141"/>
<area shape="rect" href="pmu_8c.html#a98e21a6fa41b3490e6b1356884b18d5f" title=" " alt="" coords="744,13,947,39"/>
<area shape="rect" href="pmu_8c.html#a4fbb4321f3ca694d651e668bb064aa48" title=" " alt="" coords="1012,71,1225,112"/>
<area shape="rect" href="pmu_8c.html#a78259b4926a270689ce9846f2d661c5d" title=" " alt="" coords="1036,5,1201,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_a2adeb16260e5920e10beedc3e854c28c_icgraph.png" border="0" usemap="#apmu-emul_8c_a2adeb16260e5920e10beedc3e854c28c_icgraph" alt=""/></div>
<map name="apmu-emul_8c_a2adeb16260e5920e10beedc3e854c28c_icgraph" id="apmu-emul_8c_a2adeb16260e5920e10beedc3e854c28c_icgraph">
<area shape="rect" title=" " alt="" coords="621,5,795,32"/>
<area shape="rect" href="arm_8c.html#a05fa4e97677ca3190089071bfce82825" title=" " alt="" coords="412,5,573,32"/>
<area shape="rect" href="arm_8c.html#adbabb8b4e50c9c51eec6373fcbc833aa" title=" " alt="" coords="177,5,364,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a10d620554e24019b80dbc66024a62138"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10d620554e24019b80dbc66024a62138">&#9670;&nbsp;</a></span>LIST_HEAD()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static LIST_HEAD </td>
          <td>(</td>
          <td class="paramtype">arm_pmus&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ab359d7f45f28d7b79e0b41c50ff3c5ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab359d7f45f28d7b79e0b41c50ff3c5ee">&#9670;&nbsp;</a></span>pmu_irq_is_valid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool pmu_irq_is_valid </td>
          <td>(</td>
          <td class="paramtype">struct kvm *&#160;</td>
          <td class="paramname"><em>kvm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>irq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pmu-emul_8c_source.html#l00883">883</a> of file <a class="el" href="pmu-emul_8c_source.html">pmu-emul.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;{</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keyword">struct </span>kvm_vcpu *vcpu;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160; </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    kvm_for_each_vcpu(i, vcpu, kvm) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keywordflow">if</span> (!kvm_arm_pmu_irq_initialized(vcpu))</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160; </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordflow">if</span> (irq_is_ppi(irq)) {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            <span class="keywordflow">if</span> (vcpu-&gt;arch.pmu.irq_num != irq)</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            <span class="keywordflow">if</span> (vcpu-&gt;arch.pmu.irq_num == irq)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        }</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    }</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pmu-emul_8c_ab359d7f45f28d7b79e0b41c50ff3c5ee_icgraph.png" border="0" usemap="#apmu-emul_8c_ab359d7f45f28d7b79e0b41c50ff3c5ee_icgraph" alt=""/></div>
<map name="apmu-emul_8c_ab359d7f45f28d7b79e0b41c50ff3c5ee_icgraph" id="apmu-emul_8c_ab359d7f45f28d7b79e0b41c50ff3c5ee_icgraph">
<area shape="rect" title=" " alt="" coords="1121,5,1253,32"/>
<area shape="rect" href="pmu-emul_8c.html#af3085467d010c2e9c3abfcfbf086156a" title=" " alt="" coords="873,5,1073,32"/>
<area shape="rect" href="guest_8c.html#a932910ec1cc3b5a552da035d4d74a4eb" title=" " alt="" coords="611,5,825,32"/>
<area shape="rect" href="arm_8c.html#adcf63ac6c9c7383fcf0dcb2ce097afbe" title=" " alt="" coords="384,5,563,32"/>
<area shape="rect" href="arm_8c.html#ab4ac4d44dfa1ed8985130249d6a8385e" title=" " alt="" coords="177,5,336,32"/>
<area shape="rect" href="kvm__main_8c.html#a2f2d3734c4cf61a1f4f94e9d47c37d55" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
