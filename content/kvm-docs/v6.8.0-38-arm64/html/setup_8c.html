<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KVM: arch/arm64/kvm/hyp/nvhe/setup.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KVM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea9599923402ca8ab47fc3e495999dea.html">arch</a></li><li class="navelem"><a class="el" href="dir_67a9e021ce8db5d46236c6154ee454bc.html">arm64</a></li><li class="navelem"><a class="el" href="dir_42f87ef63ac4150166bf7887f68288e2.html">kvm</a></li><li class="navelem"><a class="el" href="dir_478c73b493f5da08054e18cfdaadae60.html">hyp</a></li><li class="navelem"><a class="el" href="dir_8c5482a8acebf1af3f04411f5a7a76ca.html">nvhe</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">setup.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/kvm_host.h&gt;</code><br />
<code>#include &lt;asm/kvm_hyp.h&gt;</code><br />
<code>#include &lt;asm/kvm_mmu.h&gt;</code><br />
<code>#include &lt;asm/kvm_pgtable.h&gt;</code><br />
<code>#include &lt;asm/kvm_pkvm.h&gt;</code><br />
<code>#include &lt;<a class="el" href="early__alloc_8h_source.html">nvhe/early_alloc.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="ffa_8h_source.html">nvhe/ffa.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="fixed__config_8h_source.html">nvhe/fixed_config.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="gfp_8h_source.html">nvhe/gfp.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="memory_8h_source.html">nvhe/memory.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="mem__protect_8h_source.html">nvhe/mem_protect.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="mm_8h_source.html">nvhe/mm.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="pkvm_8h_source.html">nvhe/pkvm.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="trap__handler_8h_source.html">nvhe/trap_handler.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for setup.c:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c__incl.png" border="0" usemap="#aarch_2arm64_2kvm_2hyp_2nvhe_2setup_8c" alt=""/></div>
<map name="aarch_2arm64_2kvm_2hyp_2nvhe_2setup_8c" id="aarch_2arm64_2kvm_2hyp_2nvhe_2setup_8c">
<area shape="rect" title=" " alt="" coords="753,5,911,47"/>
<area shape="rect" title=" " alt="" coords="43,169,178,196"/>
<area shape="rect" title=" " alt="" coords="202,169,329,196"/>
<area shape="rect" title=" " alt="" coords="299,393,435,420"/>
<area shape="rect" title=" " alt="" coords="749,169,899,196"/>
<area shape="rect" title=" " alt="" coords="567,244,705,271"/>
<area shape="rect" href="early__alloc_8h.html" title=" " alt="" coords="708,95,849,121"/>
<area shape="rect" href="ffa_8h.html" title=" " alt="" coords="1273,95,1359,121"/>
<area shape="rect" href="fixed__config_8h.html" title=" " alt="" coords="1600,95,1747,121"/>
<area shape="rect" href="gfp_8h.html" title=" " alt="" coords="828,244,919,271"/>
<area shape="rect" href="memory_8h.html" title=" " alt="" coords="945,319,1068,345"/>
<area shape="rect" href="mem__protect_8h.html" title=" " alt="" coords="377,95,535,121"/>
<area shape="rect" href="pkvm_8h.html" title=" " alt="" coords="617,169,724,196"/>
<area shape="rect" href="mm_8h.html" title=" " alt="" coords="1097,95,1193,121"/>
<area shape="rect" href="trap__handler_8h.html" title=" " alt="" coords="1411,95,1562,121"/>
<area shape="rect" title=" " alt="" coords="1479,169,1609,196"/>
<area shape="rect" title=" " alt="" coords="1633,169,1743,196"/>
<area shape="rect" title=" " alt="" coords="829,319,920,345"/>
<area shape="rect" href="spinlock_8h.html" title=" " alt="" coords="681,319,805,345"/>
<area shape="rect" title=" " alt="" coords="957,393,1056,420"/>
<area shape="rect" title=" " alt="" coords="1235,393,1341,420"/>
<area shape="rect" title=" " alt="" coords="538,393,675,420"/>
<area shape="rect" title=" " alt="" coords="700,393,785,420"/>
<area shape="rect" title=" " alt="" coords="810,393,923,420"/>
<area shape="rect" title=" " alt="" coords="404,169,492,196"/>
<area shape="rect" title=" " alt="" coords="1239,169,1353,196"/>
<area shape="rect" title=" " alt="" coords="1076,169,1215,196"/>
</map>
</div>
</div>
<p><a href="setup_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a38059e76cd84ec015fee14728c4ecc66"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#a38059e76cd84ec015fee14728c4ecc66">hyp_percpu_size</a></td></tr>
<tr class="separator:a38059e76cd84ec015fee14728c4ecc66"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab71edf26e64f51016ecd3eb9f8de4bc0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#ab71edf26e64f51016ecd3eb9f8de4bc0">divide_memory_pool</a> (void *virt, unsigned long <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)</td></tr>
<tr class="separator:ab71edf26e64f51016ecd3eb9f8de4bc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fc10c31100e5dadb1a7b4869768b06d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#a7fc10c31100e5dadb1a7b4869768b06d">recreate_hyp_mappings</a> (phys_addr_t phys, unsigned long <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, unsigned long *per_cpu_base, u32 hyp_va_bits)</td></tr>
<tr class="separator:a7fc10c31100e5dadb1a7b4869768b06d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb62b1c2320b044bcb13a34ff2eaf90f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#afb62b1c2320b044bcb13a34ff2eaf90f">update_nvhe_init_params</a> (void)</td></tr>
<tr class="separator:afb62b1c2320b044bcb13a34ff2eaf90f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a537df8751deae8c4d733400a572fcb7b"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#a537df8751deae8c4d733400a572fcb7b">hyp_zalloc_hyp_page</a> (void *arg)</td></tr>
<tr class="separator:a537df8751deae8c4d733400a572fcb7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a4ef9d03fe85971699c1d8fc76a1f71"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#a6a4ef9d03fe85971699c1d8fc76a1f71">hpool_get_page</a> (void *addr)</td></tr>
<tr class="separator:a6a4ef9d03fe85971699c1d8fc76a1f71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb9e403be9e9cc7aa1f4af5977ea7b0e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#aeb9e403be9e9cc7aa1f4af5977ea7b0e">hpool_put_page</a> (void *addr)</td></tr>
<tr class="separator:aeb9e403be9e9cc7aa1f4af5977ea7b0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac42b610a5489eb28a4ed9e1ee2e94b96"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#ac42b610a5489eb28a4ed9e1ee2e94b96">fix_host_ownership_walker</a> (const struct kvm_pgtable_visit_ctx *ctx, enum kvm_pgtable_walk_flags visit)</td></tr>
<tr class="separator:ac42b610a5489eb28a4ed9e1ee2e94b96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade7b3e3f939e9007130bc51bc666d685"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#ade7b3e3f939e9007130bc51bc666d685">fix_hyp_pgtable_refcnt_walker</a> (const struct kvm_pgtable_visit_ctx *ctx, enum kvm_pgtable_walk_flags visit)</td></tr>
<tr class="separator:ade7b3e3f939e9007130bc51bc666d685"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1c98c3ff82fd4b71d6af82925b37be0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#ae1c98c3ff82fd4b71d6af82925b37be0">fix_host_ownership</a> (void)</td></tr>
<tr class="separator:ae1c98c3ff82fd4b71d6af82925b37be0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c502a99f551b17a8b2b3b28eaf1012e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#a4c502a99f551b17a8b2b3b28eaf1012e">fix_hyp_pgtable_refcnt</a> (void)</td></tr>
<tr class="separator:a4c502a99f551b17a8b2b3b28eaf1012e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5bdfd8a9c40da5d8de013de4f049dbe"><td class="memItemLeft" align="right" valign="top">void __noreturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe">__pkvm_init_finalise</a> (void)</td></tr>
<tr class="separator:ab5bdfd8a9c40da5d8de013de4f049dbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69148fd8ebc6b8dd5f602c1dae42544d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d">__pkvm_init</a> (phys_addr_t phys, unsigned long <a class="el" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, unsigned long nr_cpus, unsigned long *per_cpu_base, u32 hyp_va_bits)</td></tr>
<tr class="separator:a69148fd8ebc6b8dd5f602c1dae42544d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa640ad613bd0b27b624e07ba8e802625"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#aa640ad613bd0b27b624e07ba8e802625">hyp_nr_cpus</a></td></tr>
<tr class="separator:aa640ad613bd0b27b624e07ba8e802625"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af67617d36b4054ea302dea413b0d5d0f"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#af67617d36b4054ea302dea413b0d5d0f">vmemmap_base</a></td></tr>
<tr class="separator:af67617d36b4054ea302dea413b0d5d0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec5cfc568b5c34b2ee8dd23207e78b37"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#aec5cfc568b5c34b2ee8dd23207e78b37">vm_table_base</a></td></tr>
<tr class="separator:aec5cfc568b5c34b2ee8dd23207e78b37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9581c85c450d45626e1b96511543cb0d"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#a9581c85c450d45626e1b96511543cb0d">hyp_pgt_base</a></td></tr>
<tr class="separator:a9581c85c450d45626e1b96511543cb0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43979e628bf4d2a656c80a8545f5693a"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#a43979e628bf4d2a656c80a8545f5693a">host_s2_pgt_base</a></td></tr>
<tr class="separator:a43979e628bf4d2a656c80a8545f5693a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9522cf5b940478dc2c960364ffd22a5b"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#a9522cf5b940478dc2c960364ffd22a5b">ffa_proxy_pages</a></td></tr>
<tr class="separator:a9522cf5b940478dc2c960364ffd22a5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfd7ac18936b66957dc1bff827214803"><td class="memItemLeft" align="right" valign="top">static struct kvm_pgtable_mm_ops&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#adfd7ac18936b66957dc1bff827214803">pkvm_pgtable_mm_ops</a></td></tr>
<tr class="separator:adfd7ac18936b66957dc1bff827214803"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5ae4a11629f572b49b691f8c68dd308"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structhyp__pool.html">hyp_pool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="setup_8c.html#ad5ae4a11629f572b49b691f8c68dd308">hpool</a></td></tr>
<tr class="separator:ad5ae4a11629f572b49b691f8c68dd308"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a38059e76cd84ec015fee14728c4ecc66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38059e76cd84ec015fee14728c4ecc66">&#9670;&nbsp;</a></span>hyp_percpu_size</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define hyp_percpu_size</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">             ((<span class="keywordtype">unsigned</span> long)__per_cpu_end - \</div>
<div class="line">             (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)__per_cpu_start)</div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00025">25</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a69148fd8ebc6b8dd5f602c1dae42544d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69148fd8ebc6b8dd5f602c1dae42544d">&#9670;&nbsp;</a></span>__pkvm_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __pkvm_init </td>
          <td>(</td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>phys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>nr_cpus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>per_cpu_base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>hyp_va_bits</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00314">314</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;{</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">struct </span>kvm_nvhe_init_params *params;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordtype">void</span> *virt = <a class="code" href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4">hyp_phys_to_virt</a>(phys);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    void (*fn)(phys_addr_t params_pa, <span class="keywordtype">void</span> *finalize_fn_va);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    BUG_ON(<a class="code" href="fixed__config_8h.html#a6e0463281416e208e60b3e44fb872259">kvm_check_pvm_sysreg_table</a>());</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">if</span> (!PAGE_ALIGNED(phys) || !PAGE_ALIGNED(<a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>))</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <a class="code" href="spinlock_8h.html#a749fd61a9e38132c5b89fb8ab5818e6e">hyp_spin_lock_init</a>(&amp;<a class="code" href="mm_8h.html#a4af0632ed35da546b03a75de7886984e">pkvm_pgd_lock</a>);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="setup_8c.html#aa640ad613bd0b27b624e07ba8e802625">hyp_nr_cpus</a> = nr_cpus;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    ret = <a class="code" href="setup_8c.html#ab71edf26e64f51016ecd3eb9f8de4bc0">divide_memory_pool</a>(virt, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    ret = <a class="code" href="setup_8c.html#a7fc10c31100e5dadb1a7b4869768b06d">recreate_hyp_mappings</a>(phys, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, per_cpu_base, hyp_va_bits);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="setup_8c.html#afb62b1c2320b044bcb13a34ff2eaf90f">update_nvhe_init_params</a>();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">/* Jump in the idmap page to switch to the new page-tables */</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    params = this_cpu_ptr(&amp;kvm_init_params);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    fn = (typeof(fn))__hyp_pa(__pkvm_init_switch_pgd);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    fn(__hyp_pa(params), <a class="code" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe">__pkvm_init_finalise</a>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    unreachable();</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div>
<div class="ttc" id="afixed__config_8h_html_a6e0463281416e208e60b3e44fb872259"><div class="ttname"><a href="fixed__config_8h.html#a6e0463281416e208e60b3e44fb872259">kvm_check_pvm_sysreg_table</a></div><div class="ttdeci">int kvm_check_pvm_sysreg_table(void)</div><div class="ttdef"><b>Definition:</b> <a href="hyp_2nvhe_2sys__regs_8c_source.html#l00456">sys_regs.c:456</a></div></div>
<div class="ttc" id="agen-hyprel_8c_html_a854352f53b148adc24983a58a1866d66"><div class="ttname"><a href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="gen-hyprel_8c_source.html#l00133">gen-hyprel.c:133</a></div></div>
<div class="ttc" id="amemory_8h_html_a14e874dea4f604e8102b20809cc5eae4"><div class="ttname"><a href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4">hyp_phys_to_virt</a></div><div class="ttdeci">static void * hyp_phys_to_virt(phys_addr_t phys)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00020">memory.h:20</a></div></div>
<div class="ttc" id="amm_8h_html_a4af0632ed35da546b03a75de7886984e"><div class="ttname"><a href="mm_8h.html#a4af0632ed35da546b03a75de7886984e">pkvm_pgd_lock</a></div><div class="ttdeci">hyp_spinlock_t pkvm_pgd_lock</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00022">mm.c:22</a></div></div>
<div class="ttc" id="asetup_8c_html_a7fc10c31100e5dadb1a7b4869768b06d"><div class="ttname"><a href="setup_8c.html#a7fc10c31100e5dadb1a7b4869768b06d">recreate_hyp_mappings</a></div><div class="ttdeci">static int recreate_hyp_mappings(phys_addr_t phys, unsigned long size, unsigned long *per_cpu_base, u32 hyp_va_bits)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00070">setup.c:70</a></div></div>
<div class="ttc" id="asetup_8c_html_aa640ad613bd0b27b624e07ba8e802625"><div class="ttname"><a href="setup_8c.html#aa640ad613bd0b27b624e07ba8e802625">hyp_nr_cpus</a></div><div class="ttdeci">unsigned long hyp_nr_cpus</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00023">setup.c:23</a></div></div>
<div class="ttc" id="asetup_8c_html_ab5bdfd8a9c40da5d8de013de4f049dbe"><div class="ttname"><a href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe">__pkvm_init_finalise</a></div><div class="ttdeci">void __noreturn __pkvm_init_finalise(void)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00258">setup.c:258</a></div></div>
<div class="ttc" id="asetup_8c_html_ab71edf26e64f51016ecd3eb9f8de4bc0"><div class="ttname"><a href="setup_8c.html#ab71edf26e64f51016ecd3eb9f8de4bc0">divide_memory_pool</a></div><div class="ttdeci">static int divide_memory_pool(void *virt, unsigned long size)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00036">setup.c:36</a></div></div>
<div class="ttc" id="asetup_8c_html_afb62b1c2320b044bcb13a34ff2eaf90f"><div class="ttname"><a href="setup_8c.html#afb62b1c2320b044bcb13a34ff2eaf90f">update_nvhe_init_params</a></div><div class="ttdeci">static void update_nvhe_init_params(void)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00146">setup.c:146</a></div></div>
<div class="ttc" id="aspinlock_8h_html_a749fd61a9e38132c5b89fb8ab5818e6e"><div class="ttname"><a href="spinlock_8h.html#a749fd61a9e38132c5b89fb8ab5818e6e">hyp_spin_lock_init</a></div><div class="ttdeci">#define hyp_spin_lock_init(l)</div><div class="ttdef"><b>Definition:</b> <a href="spinlock_8h_source.html#l00039">spinlock.h:39</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a69148fd8ebc6b8dd5f602c1dae42544d_cgraph.png" border="0" usemap="#asetup_8c_a69148fd8ebc6b8dd5f602c1dae42544d_cgraph" alt=""/></div>
<map name="asetup_8c_a69148fd8ebc6b8dd5f602c1dae42544d_cgraph" id="asetup_8c_a69148fd8ebc6b8dd5f602c1dae42544d_cgraph">
<area shape="rect" title=" " alt="" coords="5,1007,107,1033"/>
<area shape="rect" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe" title=" " alt="" coords="173,408,327,435"/>
<area shape="rect" href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4" title=" " alt="" coords="913,855,1047,881"/>
<area shape="rect" href="setup_8c.html#ab71edf26e64f51016ecd3eb9f8de4bc0" title=" " alt="" coords="411,981,570,1008"/>
<area shape="rect" href="fixed__config_8h.html#a6e0463281416e208e60b3e44fb872259" title=" " alt="" coords="159,1083,341,1125"/>
<area shape="rect" href="setup_8c.html#a7fc10c31100e5dadb1a7b4869768b06d" title=" " alt="" coords="401,1184,580,1211"/>
<area shape="rect" href="setup_8c.html#afb62b1c2320b044bcb13a34ff2eaf90f" title=" " alt="" coords="155,1149,345,1176"/>
<area shape="rect" href="psci-relay_8c.html#a54956c5a2f450182e430b933ba66b62a" title=" " alt="" coords="438,433,543,460"/>
<area shape="rect" href="setup_8c.html#ae1c98c3ff82fd4b71d6af82925b37be0" title=" " alt="" coords="417,599,564,625"/>
<area shape="rect" href="setup_8c.html#a4c502a99f551b17a8b2b3b28eaf1012e" title=" " alt="" coords="405,75,576,101"/>
<area shape="rect" href="setup_8c.html#a6a4ef9d03fe85971699c1d8fc76a1f71" title=" " alt="" coords="428,661,553,688"/>
<area shape="rect" href="setup_8c.html#aeb9e403be9e9cc7aa1f4af5977ea7b0e" title=" " alt="" coords="428,231,553,257"/>
<area shape="rect" href="mm_8h.html#aa3dbf53998921a0e0fb2393b01a023b7" title=" " alt="" coords="888,472,1072,499"/>
<area shape="rect" href="early__alloc_8h.html#a35cf61cfd369b37a67103d0699e03521" title=" " alt="" coords="419,789,563,830"/>
<area shape="rect" href="ffa_8h.html#a8b7ae0f7de35ed8334877adaddf77a82" title=" " alt="" coords="441,24,540,51"/>
<area shape="rect" href="memory_8h.html#a3858889abb828afd54e20be3a55947d8" title=" " alt="" coords="916,527,1044,553"/>
<area shape="rect" href="gfp_8h.html#a0861db7d9969f386a9a429f7554b8311" title=" " alt="" coords="925,180,1035,207"/>
<area shape="rect" href="memory_8h.html#aae436fb2b3f13c0954cde727104e80ac" title=" " alt="" coords="913,1133,1047,1160"/>
<area shape="rect" href="setup_8c.html#a537df8751deae8c4d733400a572fcb7b" title=" " alt="" coords="410,129,571,156"/>
<area shape="rect" href="mem__protect_8h.html#aeafa08d6dd380d52043b371b7d61e324" title=" " alt="" coords="393,484,588,511"/>
<area shape="rect" href="pkvm_8h.html#a465d3fd1802ee92a75147953f36f685e" title=" " alt="" coords="397,383,584,409"/>
<area shape="rect" href="setup_8c.html#ac42b610a5489eb28a4ed9e1ee2e94b96" title=" " alt="" coords="663,637,809,678"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1361,527,1507,553"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="920,724,1040,751"/>
<area shape="rect" href="setup_8c.html#ade7b3e3f939e9007130bc51bc666d685" title=" " alt="" coords="651,63,821,105"/>
<area shape="rect" href="gfp_8h.html#a39f58798b4af27a2b7bb3e29e9b3f653" title=" " alt="" coords="679,753,793,780"/>
<area shape="rect" href="gfp_8h.html#ac66c23236ea3da14d0a38962609014dc" title=" " alt="" coords="923,231,1037,257"/>
<area shape="rect" href="page__alloc_8c.html#a5694df4a91487fa16d3181670b7cddcf" title=" " alt="" coords="1155,219,1282,245"/>
<area shape="rect" href="mm_8c.html#a58b537349a016dc618408014a718f578" title=" " alt="" coords="1145,468,1292,495"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="1131,923,1306,949"/>
<area shape="rect" href="mm_8c.html#ac26a679af9d176b079755c60fa2e1ce1" title=" " alt="" coords="1143,519,1294,561"/>
<area shape="rect" href="memory_8h.html#af9e2f139c35baaaccb3e11cfe21cf182" title=" " alt="" coords="1124,155,1313,181"/>
<area shape="rect" href="gfp_8h.html#a7a740bb58e275f0307a86b02008f751a" title=" " alt="" coords="915,129,1045,156"/>
<area shape="rect" href="pgtable_8c.html#a9588301531fc2cca84ebf22bd7e9fd1f" title=" " alt="" coords="636,383,836,409"/>
<area shape="rect" href="mem__protect_8c.html#a3a2b99c48b336c546c922a21f20024ae" title=" " alt="" coords="641,433,831,460"/>
<area shape="rect" href="mem__protect_8c.html#ae4899ca9df86d12f84b9800fc22cfe9d" title=" " alt="" coords="667,484,805,511"/>
<area shape="rect" href="mem__protect_8c.html#a4d327c93bf5dc723c86aca304e5b794d" title=" " alt="" coords="671,535,801,561"/>
<area shape="rect" href="early__alloc_8h.html#a85026ed77b0c75bfdfe8d4c25c194025" title=" " alt="" coords="651,905,821,932"/>
<area shape="rect" href="early__alloc_8h.html#a9ab46cd46bbd575c63a620e9bdbde91d" title=" " alt="" coords="660,1057,812,1084"/>
<area shape="rect" href="early__alloc_8c.html#aaf6227e33188fee18fabd13935fa5594" title=" " alt="" coords="885,1083,1075,1109"/>
<area shape="rect" href="early__alloc_8c.html#a9e6a60c291357ae7f20b3859d04e7155" title=" " alt="" coords="899,981,1061,1008"/>
<area shape="rect" href="early__alloc_8c.html#abb8ed2647ee8cb79c6ee8a0ebcb52c94" title=" " alt="" coords="885,1032,1075,1059"/>
<area shape="rect" href="sys__regs_8h.html#ad36915b59f8e473861dcc95b0fb7655d" title=" " alt="" coords="437,1235,544,1261"/>
<area shape="rect" href="mm_8h.html#ad0a9079e39d4a5849b5a8df682356cb7" title=" " alt="" coords="655,1209,817,1236"/>
<area shape="rect" href="mm_8h.html#a738b3178d5dd1a8ecd9b50aeb05459c8" title=" " alt="" coords="665,1412,807,1439"/>
<area shape="rect" href="mm_8h.html#a91e77e89ea79e3c3b6fd869e045217aa" title=" " alt="" coords="667,1260,805,1287"/>
<area shape="rect" href="pgtable_8c.html#a9bf9cde257aa21bdb012231087127d17" title=" " alt="" coords="653,1311,819,1337"/>
<area shape="rect" href="mm_8h.html#aa462601367efc86bb5760f046d9a8d73" title=" " alt="" coords="647,1361,825,1388"/>
<area shape="rect" href="mm_8h.html#a3bf7d7d7d610b2fbbfc54f5adaf0a3df" title=" " alt="" coords="905,1361,1055,1388"/>
<area shape="rect" href="mm_8c.html#a74d2915c3948e76518d945f16a1ede94" title=" " alt="" coords="884,1209,1076,1236"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a69148fd8ebc6b8dd5f602c1dae42544d_icgraph.png" border="0" usemap="#asetup_8c_a69148fd8ebc6b8dd5f602c1dae42544d_icgraph" alt=""/></div>
<map name="asetup_8c_a69148fd8ebc6b8dd5f602c1dae42544d_icgraph" id="asetup_8c_a69148fd8ebc6b8dd5f602c1dae42544d_icgraph">
<area shape="rect" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="ab5bdfd8a9c40da5d8de013de4f049dbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5bdfd8a9c40da5d8de013de4f049dbe">&#9670;&nbsp;</a></span>__pkvm_init_finalise()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __noreturn __pkvm_init_finalise </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00258">258</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;{</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keyword">struct </span>kvm_host_data *host_data = this_cpu_ptr(&amp;kvm_host_data);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keyword">struct </span>kvm_cpu_context *host_ctxt = &amp;host_data-&gt;host_ctxt;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nr_pages, reserved_pages, pfn;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">/* Now that the vmemmap is backed, install the full-fledged allocator */</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    pfn = <a class="code" href="memory_8h.html#ae6f771ec6d256fcb464e36c64e3c78fb">hyp_virt_to_pfn</a>(<a class="code" href="setup_8c.html#a9581c85c450d45626e1b96511543cb0d">hyp_pgt_base</a>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    nr_pages = hyp_s1_pgtable_pages();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    reserved_pages = <a class="code" href="early__alloc_8h.html#a35cf61cfd369b37a67103d0699e03521">hyp_early_alloc_nr_used_pages</a>();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    ret = <a class="code" href="gfp_8h.html#a0861db7d9969f386a9a429f7554b8311">hyp_pool_init</a>(&amp;<a class="code" href="setup_8c.html#ad5ae4a11629f572b49b691f8c68dd308">hpool</a>, pfn, nr_pages, reserved_pages);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    ret = <a class="code" href="mem__protect_8h.html#aeafa08d6dd380d52043b371b7d61e324">kvm_host_prepare_stage2</a>(<a class="code" href="setup_8c.html#a43979e628bf4d2a656c80a8545f5693a">host_s2_pgt_base</a>);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="setup_8c.html#adfd7ac18936b66957dc1bff827214803">pkvm_pgtable_mm_ops</a> = (<span class="keyword">struct </span>kvm_pgtable_mm_ops) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        .zalloc_page = <a class="code" href="setup_8c.html#a537df8751deae8c4d733400a572fcb7b">hyp_zalloc_hyp_page</a>,</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        .phys_to_virt = <a class="code" href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4">hyp_phys_to_virt</a>,</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        .virt_to_phys = <a class="code" href="memory_8h.html#aae436fb2b3f13c0954cde727104e80ac">hyp_virt_to_phys</a>,</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        .get_page = <a class="code" href="setup_8c.html#a6a4ef9d03fe85971699c1d8fc76a1f71">hpool_get_page</a>,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        .put_page = <a class="code" href="setup_8c.html#aeb9e403be9e9cc7aa1f4af5977ea7b0e">hpool_put_page</a>,</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        .page_count = <a class="code" href="memory_8h.html#a3858889abb828afd54e20be3a55947d8">hyp_page_count</a>,</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    };</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="mm_8h.html#a7b9a521b68ca7bc0910bba447395a50e">pkvm_pgtable</a>.mm_ops = &amp;<a class="code" href="setup_8c.html#adfd7ac18936b66957dc1bff827214803">pkvm_pgtable_mm_ops</a>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    ret = <a class="code" href="setup_8c.html#ae1c98c3ff82fd4b71d6af82925b37be0">fix_host_ownership</a>();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    ret = <a class="code" href="setup_8c.html#a4c502a99f551b17a8b2b3b28eaf1012e">fix_hyp_pgtable_refcnt</a>();</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    ret = <a class="code" href="mm_8h.html#aa3dbf53998921a0e0fb2393b01a023b7">hyp_create_pcpu_fixmap</a>();</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    ret = <a class="code" href="ffa_8h.html#a8b7ae0f7de35ed8334877adaddf77a82">hyp_ffa_init</a>(<a class="code" href="setup_8c.html#a9522cf5b940478dc2c960364ffd22a5b">ffa_proxy_pages</a>);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keywordflow">goto</span> out;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="pkvm_8h.html#a465d3fd1802ee92a75147953f36f685e">pkvm_hyp_vm_table_init</a>(<a class="code" href="setup_8c.html#aec5cfc568b5c34b2ee8dd23207e78b37">vm_table_base</a>);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;out:</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">     * We tail-called to here from handle___pkvm_init() and will not return,</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">     * so make sure to propagate the return value to the host.</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <a class="code" href="trap__handler_8h.html#a67e54434c6d140080593adc53a870670">cpu_reg</a>(host_ctxt, 1) = ret;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="psci-relay_8c.html#a54956c5a2f450182e430b933ba66b62a">__host_enter</a>(host_ctxt);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div>
<div class="ttc" id="aearly__alloc_8h_html_a35cf61cfd369b37a67103d0699e03521"><div class="ttname"><a href="early__alloc_8h.html#a35cf61cfd369b37a67103d0699e03521">hyp_early_alloc_nr_used_pages</a></div><div class="ttdeci">unsigned long hyp_early_alloc_nr_used_pages(void)</div><div class="ttdef"><b>Definition:</b> <a href="early__alloc_8c_source.html#l00019">early_alloc.c:19</a></div></div>
<div class="ttc" id="affa_8h_html_a8b7ae0f7de35ed8334877adaddf77a82"><div class="ttname"><a href="ffa_8h.html#a8b7ae0f7de35ed8334877adaddf77a82">hyp_ffa_init</a></div><div class="ttdeci">int hyp_ffa_init(void *pages)</div><div class="ttdef"><b>Definition:</b> <a href="ffa_8c_source.html#l00700">ffa.c:700</a></div></div>
<div class="ttc" id="agfp_8h_html_a0861db7d9969f386a9a429f7554b8311"><div class="ttname"><a href="gfp_8h.html#a0861db7d9969f386a9a429f7554b8311">hyp_pool_init</a></div><div class="ttdeci">int hyp_pool_init(struct hyp_pool *pool, u64 pfn, unsigned int nr_pages, unsigned int reserved_pages)</div><div class="ttdef"><b>Definition:</b> <a href="page__alloc_8c_source.html#l00223">page_alloc.c:223</a></div></div>
<div class="ttc" id="amem__protect_8h_html_aeafa08d6dd380d52043b371b7d61e324"><div class="ttname"><a href="mem__protect_8h.html#aeafa08d6dd380d52043b371b7d61e324">kvm_host_prepare_stage2</a></div><div class="ttdeci">int kvm_host_prepare_stage2(void *pgt_pool_base)</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8c_source.html#l00138">mem_protect.c:138</a></div></div>
<div class="ttc" id="amemory_8h_html_a3858889abb828afd54e20be3a55947d8"><div class="ttname"><a href="memory_8h.html#a3858889abb828afd54e20be3a55947d8">hyp_page_count</a></div><div class="ttdeci">static int hyp_page_count(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00045">memory.h:45</a></div></div>
<div class="ttc" id="amemory_8h_html_aae436fb2b3f13c0954cde727104e80ac"><div class="ttname"><a href="memory_8h.html#aae436fb2b3f13c0954cde727104e80ac">hyp_virt_to_phys</a></div><div class="ttdeci">static phys_addr_t hyp_virt_to_phys(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00025">memory.h:25</a></div></div>
<div class="ttc" id="amemory_8h_html_ae6f771ec6d256fcb464e36c64e3c78fb"><div class="ttname"><a href="memory_8h.html#ae6f771ec6d256fcb464e36c64e3c78fb">hyp_virt_to_pfn</a></div><div class="ttdeci">#define hyp_virt_to_pfn(virt)</div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00034">memory.h:34</a></div></div>
<div class="ttc" id="amm_8h_html_a7b9a521b68ca7bc0910bba447395a50e"><div class="ttname"><a href="mm_8h.html#a7b9a521b68ca7bc0910bba447395a50e">pkvm_pgtable</a></div><div class="ttdeci">struct kvm_pgtable pkvm_pgtable</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00001">mm.c:21</a></div></div>
<div class="ttc" id="amm_8h_html_aa3dbf53998921a0e0fb2393b01a023b7"><div class="ttname"><a href="mm_8h.html#aa3dbf53998921a0e0fb2393b01a023b7">hyp_create_pcpu_fixmap</a></div><div class="ttdeci">int hyp_create_pcpu_fixmap(void)</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00305">mm.c:305</a></div></div>
<div class="ttc" id="apkvm_8h_html_a465d3fd1802ee92a75147953f36f685e"><div class="ttname"><a href="pkvm_8h.html#a465d3fd1802ee92a75147953f36f685e">pkvm_hyp_vm_table_init</a></div><div class="ttdeci">void pkvm_hyp_vm_table_init(void *tbl)</div><div class="ttdef"><b>Definition:</b> <a href="hyp_2nvhe_2pkvm_8c_source.html#l00244">pkvm.c:244</a></div></div>
<div class="ttc" id="apsci-relay_8c_html_a54956c5a2f450182e430b933ba66b62a"><div class="ttname"><a href="psci-relay_8c.html#a54956c5a2f450182e430b933ba66b62a">__host_enter</a></div><div class="ttdeci">void __noreturn __host_enter(struct kvm_cpu_context *host_ctxt)</div></div>
<div class="ttc" id="asetup_8c_html_a43979e628bf4d2a656c80a8545f5693a"><div class="ttname"><a href="setup_8c.html#a43979e628bf4d2a656c80a8545f5693a">host_s2_pgt_base</a></div><div class="ttdeci">static void * host_s2_pgt_base</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00031">setup.c:31</a></div></div>
<div class="ttc" id="asetup_8c_html_a4c502a99f551b17a8b2b3b28eaf1012e"><div class="ttname"><a href="setup_8c.html#a4c502a99f551b17a8b2b3b28eaf1012e">fix_hyp_pgtable_refcnt</a></div><div class="ttdeci">static int fix_hyp_pgtable_refcnt(void)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00246">setup.c:246</a></div></div>
<div class="ttc" id="asetup_8c_html_a537df8751deae8c4d733400a572fcb7b"><div class="ttname"><a href="setup_8c.html#a537df8751deae8c4d733400a572fcb7b">hyp_zalloc_hyp_page</a></div><div class="ttdeci">static void * hyp_zalloc_hyp_page(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00159">setup.c:159</a></div></div>
<div class="ttc" id="asetup_8c_html_a6a4ef9d03fe85971699c1d8fc76a1f71"><div class="ttname"><a href="setup_8c.html#a6a4ef9d03fe85971699c1d8fc76a1f71">hpool_get_page</a></div><div class="ttdeci">static void hpool_get_page(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00164">setup.c:164</a></div></div>
<div class="ttc" id="asetup_8c_html_a9522cf5b940478dc2c960364ffd22a5b"><div class="ttname"><a href="setup_8c.html#a9522cf5b940478dc2c960364ffd22a5b">ffa_proxy_pages</a></div><div class="ttdeci">static void * ffa_proxy_pages</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00032">setup.c:32</a></div></div>
<div class="ttc" id="asetup_8c_html_a9581c85c450d45626e1b96511543cb0d"><div class="ttname"><a href="setup_8c.html#a9581c85c450d45626e1b96511543cb0d">hyp_pgt_base</a></div><div class="ttdeci">static void * hyp_pgt_base</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00030">setup.c:30</a></div></div>
<div class="ttc" id="asetup_8c_html_ad5ae4a11629f572b49b691f8c68dd308"><div class="ttname"><a href="setup_8c.html#ad5ae4a11629f572b49b691f8c68dd308">hpool</a></div><div class="ttdeci">static struct hyp_pool hpool</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00032">setup.c:34</a></div></div>
<div class="ttc" id="asetup_8c_html_adfd7ac18936b66957dc1bff827214803"><div class="ttname"><a href="setup_8c.html#adfd7ac18936b66957dc1bff827214803">pkvm_pgtable_mm_ops</a></div><div class="ttdeci">static struct kvm_pgtable_mm_ops pkvm_pgtable_mm_ops</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00032">setup.c:33</a></div></div>
<div class="ttc" id="asetup_8c_html_ae1c98c3ff82fd4b71d6af82925b37be0"><div class="ttname"><a href="setup_8c.html#ae1c98c3ff82fd4b71d6af82925b37be0">fix_host_ownership</a></div><div class="ttdeci">static int fix_host_ownership(void)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00226">setup.c:226</a></div></div>
<div class="ttc" id="asetup_8c_html_aeb9e403be9e9cc7aa1f4af5977ea7b0e"><div class="ttname"><a href="setup_8c.html#aeb9e403be9e9cc7aa1f4af5977ea7b0e">hpool_put_page</a></div><div class="ttdeci">static void hpool_put_page(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00169">setup.c:169</a></div></div>
<div class="ttc" id="asetup_8c_html_aec5cfc568b5c34b2ee8dd23207e78b37"><div class="ttname"><a href="setup_8c.html#aec5cfc568b5c34b2ee8dd23207e78b37">vm_table_base</a></div><div class="ttdeci">static void * vm_table_base</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00029">setup.c:29</a></div></div>
<div class="ttc" id="atrap__handler_8h_html_a67e54434c6d140080593adc53a870670"><div class="ttname"><a href="trap__handler_8h.html#a67e54434c6d140080593adc53a870670">cpu_reg</a></div><div class="ttdeci">#define cpu_reg(ctxt, r)</div><div class="ttdef"><b>Definition:</b> <a href="trap__handler_8h_source.html#l00014">trap_handler.h:14</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_ab5bdfd8a9c40da5d8de013de4f049dbe_cgraph.png" border="0" usemap="#asetup_8c_ab5bdfd8a9c40da5d8de013de4f049dbe_cgraph" alt=""/></div>
<map name="asetup_8c_ab5bdfd8a9c40da5d8de013de4f049dbe_cgraph" id="asetup_8c_ab5bdfd8a9c40da5d8de013de4f049dbe_cgraph">
<area shape="rect" title=" " alt="" coords="5,645,160,672"/>
<area shape="rect" href="psci-relay_8c.html#a54956c5a2f450182e430b933ba66b62a" title=" " alt="" coords="253,76,358,103"/>
<area shape="rect" href="setup_8c.html#ae1c98c3ff82fd4b71d6af82925b37be0" title=" " alt="" coords="477,177,624,204"/>
<area shape="rect" href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4" title=" " alt="" coords="723,115,857,141"/>
<area shape="rect" href="setup_8c.html#a4c502a99f551b17a8b2b3b28eaf1012e" title=" " alt="" coords="220,287,391,313"/>
<area shape="rect" href="setup_8c.html#a6a4ef9d03fe85971699c1d8fc76a1f71" title=" " alt="" coords="243,587,368,613"/>
<area shape="rect" href="setup_8c.html#aeb9e403be9e9cc7aa1f4af5977ea7b0e" title=" " alt="" coords="243,536,368,563"/>
<area shape="rect" href="mm_8h.html#aa3dbf53998921a0e0fb2393b01a023b7" title=" " alt="" coords="213,433,397,460"/>
<area shape="rect" href="early__alloc_8h.html#a35cf61cfd369b37a67103d0699e03521" title=" " alt="" coords="233,638,377,679"/>
<area shape="rect" href="ffa_8h.html#a8b7ae0f7de35ed8334877adaddf77a82" title=" " alt="" coords="256,704,355,731"/>
<area shape="rect" href="memory_8h.html#a3858889abb828afd54e20be3a55947d8" title=" " alt="" coords="726,907,854,933"/>
<area shape="rect" href="gfp_8h.html#a0861db7d9969f386a9a429f7554b8311" title=" " alt="" coords="735,856,845,883"/>
<area shape="rect" href="memory_8h.html#aae436fb2b3f13c0954cde727104e80ac" title=" " alt="" coords="723,957,857,984"/>
<area shape="rect" href="setup_8c.html#a537df8751deae8c4d733400a572fcb7b" title=" " alt="" coords="225,755,386,781"/>
<area shape="rect" href="mem__protect_8h.html#aeafa08d6dd380d52043b371b7d61e324" title=" " alt="" coords="208,1008,403,1035"/>
<area shape="rect" href="pkvm_8h.html#a465d3fd1802ee92a75147953f36f685e" title=" " alt="" coords="212,1059,399,1085"/>
<area shape="rect" href="setup_8c.html#ac42b610a5489eb28a4ed9e1ee2e94b96" title=" " alt="" coords="717,166,863,207"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="717,232,863,259"/>
<area shape="rect" href="mem__protect_8h.html#a5a9a7674ad958802dbe250af049ee6b0" title=" " alt="" coords="963,5,1094,32"/>
<area shape="rect" href="mem__protect_8h.html#adc131fc52bbb4443366cfbe93eb87839" title=" " alt="" coords="929,56,1128,83"/>
<area shape="rect" href="mem__protect_8h.html#afb7f8781ecbfa50324009fac4a8a68a8" title=" " alt="" coords="941,107,1116,149"/>
<area shape="rect" href="pgtable_8c.html#ae7564def87f47c0c061a34b7d904e805" title=" " alt="" coords="929,173,1128,200"/>
<area shape="rect" href="mem__protect_8h.html#a09717d2d674301b5311a4edfa87dd8c5" title=" " alt="" coords="969,224,1089,251"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="969,275,1089,301"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="953,325,1105,352"/>
<area shape="rect" href="setup_8c.html#ade7b3e3f939e9007130bc51bc666d685" title=" " alt="" coords="465,279,636,321"/>
<area shape="rect" href="gfp_8h.html#a39f58798b4af27a2b7bb3e29e9b3f653" title=" " alt="" coords="494,599,607,625"/>
<area shape="rect" href="memory_8h.html#a52854ece4f50a52b454b91f1a144b189" title=" " alt="" coords="722,653,858,680"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="733,552,847,579"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="725,603,855,629"/>
<area shape="rect" href="gfp_8h.html#ac66c23236ea3da14d0a38962609014dc" title=" " alt="" coords="494,544,607,571"/>
<area shape="rect" href="page__alloc_8c.html#a5694df4a91487fa16d3181670b7cddcf" title=" " alt="" coords="965,640,1092,667"/>
<area shape="rect" href="page__alloc_8c.html#afd730f352c10816e50c6e37f9a10d31e" title=" " alt="" coords="1204,615,1351,641"/>
<area shape="rect" href="memory_8h.html#a0729ce83305c1a44375b6e907b864b9a" title=" " alt="" coords="1176,665,1379,692"/>
<area shape="rect" href="mm_8c.html#a58b537349a016dc618408014a718f578" title=" " alt="" coords="477,345,624,372"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="463,396,638,423"/>
<area shape="rect" href="mm_8c.html#ac26a679af9d176b079755c60fa2e1ce1" title=" " alt="" coords="475,465,626,506"/>
<area shape="rect" href="mm_8c.html#afbf35a76ec97bb72e203fc6bead3a15d" title=" " alt="" coords="699,283,881,309"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="724,333,856,360"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="722,384,858,411"/>
<area shape="rect" href="mm_8c.html#aa76ffe9cd77a903ae9b6e5de1617f3a5" title=" " alt="" coords="708,435,872,477"/>
<area shape="rect" href="memory_8h.html#af9e2f139c35baaaccb3e11cfe21cf182" title=" " alt="" coords="934,831,1123,857"/>
<area shape="rect" href="gfp_8h.html#a7a740bb58e275f0307a86b02008f751a" title=" " alt="" coords="485,729,616,756"/>
<area shape="rect" href="page__alloc_8c.html#a8ac88fa38a81f4de49d9e80665b1ffc0" title=" " alt="" coords="714,755,866,781"/>
<area shape="rect" href="page__alloc_8c.html#ab41323251ac55b72defe671d568dcce7" title=" " alt="" coords="733,704,847,731"/>
<area shape="rect" href="pgtable_8c.html#a9588301531fc2cca84ebf22bd7e9fd1f" title=" " alt="" coords="451,1109,651,1136"/>
<area shape="rect" href="mem__protect_8c.html#a3a2b99c48b336c546c922a21f20024ae" title=" " alt="" coords="455,1059,646,1085"/>
<area shape="rect" href="mem__protect_8c.html#ae4899ca9df86d12f84b9800fc22cfe9d" title=" " alt="" coords="481,1008,620,1035"/>
<area shape="rect" href="mem__protect_8c.html#a4d327c93bf5dc723c86aca304e5b794d" title=" " alt="" coords="486,856,615,883"/>
<area shape="rect" href="pgtable_8c.html#ab68001fdf94eab0c95183a0d99df3576" title=" " alt="" coords="726,1109,854,1136"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_ab5bdfd8a9c40da5d8de013de4f049dbe_icgraph.png" border="0" usemap="#asetup_8c_ab5bdfd8a9c40da5d8de013de4f049dbe_icgraph" alt=""/></div>
<map name="asetup_8c_ab5bdfd8a9c40da5d8de013de4f049dbe_icgraph" id="asetup_8c_ab5bdfd8a9c40da5d8de013de4f049dbe_icgraph">
<area shape="rect" title=" " alt="" coords="912,31,1067,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="ab71edf26e64f51016ecd3eb9f8de4bc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab71edf26e64f51016ecd3eb9f8de4bc0">&#9670;&nbsp;</a></span>divide_memory_pool()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int divide_memory_pool </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>virt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00036">36</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nr_pages;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="early__alloc_8h.html#a9ab46cd46bbd575c63a620e9bdbde91d">hyp_early_alloc_init</a>(virt, <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    nr_pages = hyp_vmemmap_pages(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structhyp__page.html">hyp_page</a>));</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="setup_8c.html#af67617d36b4054ea302dea413b0d5d0f">vmemmap_base</a> = <a class="code" href="early__alloc_8h.html#a85026ed77b0c75bfdfe8d4c25c194025">hyp_early_alloc_contig</a>(nr_pages);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="setup_8c.html#af67617d36b4054ea302dea413b0d5d0f">vmemmap_base</a>)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    nr_pages = hyp_vm_table_pages();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="setup_8c.html#aec5cfc568b5c34b2ee8dd23207e78b37">vm_table_base</a> = <a class="code" href="early__alloc_8h.html#a85026ed77b0c75bfdfe8d4c25c194025">hyp_early_alloc_contig</a>(nr_pages);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="setup_8c.html#aec5cfc568b5c34b2ee8dd23207e78b37">vm_table_base</a>)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    nr_pages = hyp_s1_pgtable_pages();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="setup_8c.html#a9581c85c450d45626e1b96511543cb0d">hyp_pgt_base</a> = <a class="code" href="early__alloc_8h.html#a85026ed77b0c75bfdfe8d4c25c194025">hyp_early_alloc_contig</a>(nr_pages);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="setup_8c.html#a9581c85c450d45626e1b96511543cb0d">hyp_pgt_base</a>)</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    nr_pages = host_s2_pgtable_pages();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="setup_8c.html#a43979e628bf4d2a656c80a8545f5693a">host_s2_pgt_base</a> = <a class="code" href="early__alloc_8h.html#a85026ed77b0c75bfdfe8d4c25c194025">hyp_early_alloc_contig</a>(nr_pages);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="setup_8c.html#a43979e628bf4d2a656c80a8545f5693a">host_s2_pgt_base</a>)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    nr_pages = hyp_ffa_proxy_pages();</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="setup_8c.html#a9522cf5b940478dc2c960364ffd22a5b">ffa_proxy_pages</a> = <a class="code" href="early__alloc_8h.html#a85026ed77b0c75bfdfe8d4c25c194025">hyp_early_alloc_contig</a>(nr_pages);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="setup_8c.html#a9522cf5b940478dc2c960364ffd22a5b">ffa_proxy_pages</a>)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div>
<div class="ttc" id="aearly__alloc_8h_html_a85026ed77b0c75bfdfe8d4c25c194025"><div class="ttname"><a href="early__alloc_8h.html#a85026ed77b0c75bfdfe8d4c25c194025">hyp_early_alloc_contig</a></div><div class="ttdeci">void * hyp_early_alloc_contig(unsigned int nr_pages)</div><div class="ttdef"><b>Definition:</b> <a href="early__alloc_8c_source.html#l00024">early_alloc.c:24</a></div></div>
<div class="ttc" id="aearly__alloc_8h_html_a9ab46cd46bbd575c63a620e9bdbde91d"><div class="ttname"><a href="early__alloc_8h.html#a9ab46cd46bbd575c63a620e9bdbde91d">hyp_early_alloc_init</a></div><div class="ttdeci">void hyp_early_alloc_init(void *virt, unsigned long size)</div><div class="ttdef"><b>Definition:</b> <a href="early__alloc_8c_source.html#l00049">early_alloc.c:49</a></div></div>
<div class="ttc" id="asetup_8c_html_af67617d36b4054ea302dea413b0d5d0f"><div class="ttname"><a href="setup_8c.html#af67617d36b4054ea302dea413b0d5d0f">vmemmap_base</a></div><div class="ttdeci">static void * vmemmap_base</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00028">setup.c:28</a></div></div>
<div class="ttc" id="astructhyp__page_html"><div class="ttname"><a href="structhyp__page.html">hyp_page</a></div><div class="ttdef"><b>Definition:</b> <a href="memory_8h_source.html#l00010">memory.h:10</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_ab71edf26e64f51016ecd3eb9f8de4bc0_cgraph.png" border="0" usemap="#asetup_8c_ab71edf26e64f51016ecd3eb9f8de4bc0_cgraph" alt=""/></div>
<map name="asetup_8c_ab71edf26e64f51016ecd3eb9f8de4bc0_cgraph" id="asetup_8c_ab71edf26e64f51016ecd3eb9f8de4bc0_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,164,108"/>
<area shape="rect" href="early__alloc_8h.html#a85026ed77b0c75bfdfe8d4c25c194025" title=" " alt="" coords="212,56,383,83"/>
<area shape="rect" href="early__alloc_8h.html#a9ab46cd46bbd575c63a620e9bdbde91d" title=" " alt="" coords="221,107,373,133"/>
<area shape="rect" href="early__alloc_8c.html#aaf6227e33188fee18fabd13935fa5594" title=" " alt="" coords="431,5,621,32"/>
<area shape="rect" href="early__alloc_8c.html#a9e6a60c291357ae7f20b3859d04e7155" title=" " alt="" coords="445,56,607,83"/>
<area shape="rect" href="early__alloc_8c.html#abb8ed2647ee8cb79c6ee8a0ebcb52c94" title=" " alt="" coords="431,107,621,133"/>
<area shape="rect" href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4" title=" " alt="" coords="459,157,593,184"/>
<area shape="rect" href="memory_8h.html#aae436fb2b3f13c0954cde727104e80ac" title=" " alt="" coords="459,208,593,235"/>
<area shape="rect" href="early__alloc_8c.html#a85026ed77b0c75bfdfe8d4c25c194025" title=" " alt="" coords="669,56,840,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_ab71edf26e64f51016ecd3eb9f8de4bc0_icgraph.png" border="0" usemap="#asetup_8c_ab71edf26e64f51016ecd3eb9f8de4bc0_icgraph" alt=""/></div>
<map name="asetup_8c_ab71edf26e64f51016ecd3eb9f8de4bc0_icgraph" id="asetup_8c_ab71edf26e64f51016ecd3eb9f8de4bc0_icgraph">
<area shape="rect" title=" " alt="" coords="912,31,1071,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="ae1c98c3ff82fd4b71d6af82925b37be0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1c98c3ff82fd4b71d6af82925b37be0">&#9670;&nbsp;</a></span>fix_host_ownership()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fix_host_ownership </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00226">226</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;{</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keyword">struct </span>kvm_pgtable_walker walker = {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        .cb = <a class="code" href="setup_8c.html#ac42b610a5489eb28a4ed9e1ee2e94b96">fix_host_ownership_walker</a>,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        .flags  = KVM_PGTABLE_WALK_LEAF,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    };</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordtype">int</span> i, ret;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mm_8c.html#ae067f6ae4aa2f9ac9e94557ee956ed60">hyp_memblock_nr</a>; i++) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keyword">struct </span>memblock_region *reg = &amp;<a class="code" href="mm_8c.html#a3759a453d726c98d06c38b34fdd9c8b4">hyp_memory</a>[i];</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        u64 start = (u64)<a class="code" href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4">hyp_phys_to_virt</a>(reg-&gt;base);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        ret = <a class="code" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281">kvm_pgtable_walk</a>(&amp;<a class="code" href="mm_8h.html#a7b9a521b68ca7bc0910bba447395a50e">pkvm_pgtable</a>, start, reg-&gt;size, &amp;walker);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div>
<div class="ttc" id="amm_8c_html_a3759a453d726c98d06c38b34fdd9c8b4"><div class="ttname"><a href="mm_8c.html#a3759a453d726c98d06c38b34fdd9c8b4">hyp_memory</a></div><div class="ttdeci">struct memblock_region hyp_memory[HYP_MEMBLOCK_REGIONS]</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00022">mm.c:24</a></div></div>
<div class="ttc" id="amm_8c_html_ae067f6ae4aa2f9ac9e94557ee956ed60"><div class="ttname"><a href="mm_8c.html#ae067f6ae4aa2f9ac9e94557ee956ed60">hyp_memblock_nr</a></div><div class="ttdeci">unsigned int hyp_memblock_nr</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00025">mm.c:25</a></div></div>
<div class="ttc" id="apgtable_8c_html_a2a6ed7242e033a1f32360cbe0e5c2281"><div class="ttname"><a href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281">kvm_pgtable_walk</a></div><div class="ttdeci">int kvm_pgtable_walk(struct kvm_pgtable *pgt, u64 addr, u64 size, struct kvm_pgtable_walker *walker)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l00324">pgtable.c:324</a></div></div>
<div class="ttc" id="asetup_8c_html_ac42b610a5489eb28a4ed9e1ee2e94b96"><div class="ttname"><a href="setup_8c.html#ac42b610a5489eb28a4ed9e1ee2e94b96">fix_host_ownership_walker</a></div><div class="ttdeci">static int fix_host_ownership_walker(const struct kvm_pgtable_visit_ctx *ctx, enum kvm_pgtable_walk_flags visit)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00174">setup.c:174</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_ae1c98c3ff82fd4b71d6af82925b37be0_cgraph.png" border="0" usemap="#asetup_8c_ae1c98c3ff82fd4b71d6af82925b37be0_cgraph" alt=""/></div>
<map name="asetup_8c_ae1c98c3ff82fd4b71d6af82925b37be0_cgraph" id="asetup_8c_ae1c98c3ff82fd4b71d6af82925b37be0_cgraph">
<area shape="rect" title=" " alt="" coords="5,761,152,788"/>
<area shape="rect" href="setup_8c.html#ac42b610a5489eb28a4ed9e1ee2e94b96" title=" " alt="" coords="200,602,347,643"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1112,728,1257,755"/>
<area shape="rect" href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4" title=" " alt="" coords="207,812,340,839"/>
<area shape="rect" href="mem__protect_8h.html#a5a9a7674ad958802dbe250af049ee6b0" title=" " alt="" coords="429,711,559,737"/>
<area shape="rect" href="mem__protect_8h.html#adc131fc52bbb4443366cfbe93eb87839" title=" " alt="" coords="395,508,593,535"/>
<area shape="rect" href="mem__protect_8h.html#afb7f8781ecbfa50324009fac4a8a68a8" title=" " alt="" coords="641,645,816,686"/>
<area shape="rect" href="pgtable_8c.html#ae7564def87f47c0c061a34b7d904e805" title=" " alt="" coords="395,559,593,585"/>
<area shape="rect" href="mem__protect_8h.html#a09717d2d674301b5311a4edfa87dd8c5" title=" " alt="" coords="434,609,554,636"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="434,457,554,484"/>
<area shape="rect" href="mem__protect_8c.html#a91c598dd9da44a2246e43eba3a938b52" title=" " alt="" coords="663,711,794,737"/>
<area shape="rect" href="mem__protect_8c.html#add960b8fe1ef188df3090aa2102c620d" title=" " alt="" coords="647,551,810,577"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="864,593,1059,620"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="1109,619,1261,645"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="1107,568,1263,595"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1339,804,1491,831"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1592,804,1751,831"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1597,855,1745,881"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1853,829,2009,856"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1864,779,1999,805"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="2113,855,2290,881"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="2097,804,2305,831"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="2138,728,2265,755"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2142,653,2261,680"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="1329,215,1501,241"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="1311,619,1519,645"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1598,113,1745,140"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="1863,72,2000,99"/>
<area shape="rect" href="pgtable_8c.html#a29a6724d2843672cf5db792f2beb968a" title=" " alt="" coords="1567,367,1776,393"/>
<area shape="rect" href="pgtable_8c.html#a1a55037404d4eed23e8e3d0a6dc28dd8" title=" " alt="" coords="1850,139,2013,165"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="2116,56,2287,83"/>
<area shape="rect" href="pgtable_8c.html#a283484eeb78592a5189093e5529e7f8e" title=" " alt="" coords="2121,5,2282,32"/>
<area shape="rect" href="pgtable_8c.html#adcfc585140832fbe68cdf3d3f0a918d4" title=" " alt="" coords="1850,494,2013,535"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1842,560,2021,587"/>
<area shape="rect" href="pgtable_8c.html#a5ab910dc5d47620683abb5d18fb4890f" title=" " alt="" coords="1824,189,2039,216"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="2388,415,2535,441"/>
<area shape="rect" href="pgtable_8c.html#a909c28888aa74e4a85ee0c267bb88cc9" title=" " alt="" coords="1850,611,2013,653"/>
<area shape="rect" href="pgtable_8c.html#ab5d02dcf05715a75e3b1a83f4225fa0a" title=" " alt="" coords="2088,415,2315,441"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1848,240,2015,267"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="1845,291,2017,317"/>
<area shape="rect" href="pgtable_8c.html#a66b14675b92b1a0daa11af2d44d48efe" title=" " alt="" coords="1835,443,2027,469"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="2087,511,2316,537"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="2364,220,2559,247"/>
<area shape="rect" href="pgtable_8c.html#a33fe30cf22af4661bf16b18bdfebc1d4" title=" " alt="" coords="2112,275,2291,317"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="2125,158,2278,199"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="2128,107,2275,133"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="2607,169,2772,196"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="2611,220,2768,247"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="2378,169,2545,196"/>
<area shape="rect" href="pgtable_8c.html#af94796027db211abf5c1e20911100320" title=" " alt="" coords="882,645,1041,686"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_ae1c98c3ff82fd4b71d6af82925b37be0_icgraph.png" border="0" usemap="#asetup_8c_ae1c98c3ff82fd4b71d6af82925b37be0_icgraph" alt=""/></div>
<map name="asetup_8c_ae1c98c3ff82fd4b71d6af82925b37be0_icgraph" id="asetup_8c_ae1c98c3ff82fd4b71d6af82925b37be0_icgraph">
<area shape="rect" title=" " alt="" coords="1115,31,1261,57"/>
<area shape="rect" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe" title=" " alt="" coords="912,31,1067,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="ac42b610a5489eb28a4ed9e1ee2e94b96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac42b610a5489eb28a4ed9e1ee2e94b96">&#9670;&nbsp;</a></span>fix_host_ownership_walker()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fix_host_ownership_walker </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_pgtable_visit_ctx *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum kvm_pgtable_walk_flags&#160;</td>
          <td class="paramname"><em>visit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00174">174</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;{</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keyword">enum</span> kvm_pgtable_prot prot;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keyword">enum</span> <a class="code" href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8ee">pkvm_page_state</a> state;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    phys_addr_t phys;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">if</span> (!kvm_pte_valid(ctx-&gt;old))</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (ctx-&gt;level != KVM_PGTABLE_LAST_LEVEL)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    phys = kvm_pte_to_phys(ctx-&gt;old);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="mem__protect_8h.html#a5a9a7674ad958802dbe250af049ee6b0">addr_is_memory</a>(phys))</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">     * Adjust the host stage-2 mappings to match the ownership attributes</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">     * configured in the hypervisor stage-1.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    state = <a class="code" href="mem__protect_8h.html#a09717d2d674301b5311a4edfa87dd8c5">pkvm_getstate</a>(<a class="code" href="pgtable_8c.html#ae7564def87f47c0c061a34b7d904e805">kvm_pgtable_hyp_pte_prot</a>(ctx-&gt;old));</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">switch</span> (state) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8eea0bbbb2e765899e5f69590eaa036e84a9">PKVM_PAGE_OWNED</a>:</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="mem__protect_8h.html#afb7f8781ecbfa50324009fac4a8a68a8">host_stage2_set_owner_locked</a>(phys, PAGE_SIZE, <a class="code" href="mem__protect_8h.html#acc66c682438b826d6b6b92bdc3462416ad66e69677c9c0ba36e17f09dcb973163">PKVM_ID_HYP</a>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8eea849a7c91998d9d2255d8fa9cf7b070ce">PKVM_PAGE_SHARED_OWNED</a>:</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        prot = <a class="code" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152">pkvm_mkstate</a>(PKVM_HOST_MEM_PROT, <a class="code" href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8eeae0084c7c33c77c36bbef6e7ce9d49073">PKVM_PAGE_SHARED_BORROWED</a>);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8eeae0084c7c33c77c36bbef6e7ce9d49073">PKVM_PAGE_SHARED_BORROWED</a>:</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        prot = <a class="code" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152">pkvm_mkstate</a>(PKVM_HOST_MEM_PROT, <a class="code" href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8eea849a7c91998d9d2255d8fa9cf7b070ce">PKVM_PAGE_SHARED_OWNED</a>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="mem__protect_8h.html#adc131fc52bbb4443366cfbe93eb87839">host_stage2_idmap_locked</a>(phys, PAGE_SIZE, prot);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;}</div>
<div class="ttc" id="amem__protect_8h_html_a09717d2d674301b5311a4edfa87dd8c5"><div class="ttname"><a href="mem__protect_8h.html#a09717d2d674301b5311a4edfa87dd8c5">pkvm_getstate</a></div><div class="ttdeci">static enum pkvm_page_state pkvm_getstate(enum kvm_pgtable_prot prot)</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8h_source.html#l00001">mem_protect.h:43</a></div></div>
<div class="ttc" id="amem__protect_8h_html_a2cf886e3d56ed4cd5ddb78944ac0a152"><div class="ttname"><a href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152">pkvm_mkstate</a></div><div class="ttdeci">static enum kvm_pgtable_prot pkvm_mkstate(enum kvm_pgtable_prot prot, enum pkvm_page_state state)</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8h_source.html#l00001">mem_protect.h:37</a></div></div>
<div class="ttc" id="amem__protect_8h_html_a5a9a7674ad958802dbe250af049ee6b0"><div class="ttname"><a href="mem__protect_8h.html#a5a9a7674ad958802dbe250af049ee6b0">addr_is_memory</a></div><div class="ttdeci">bool addr_is_memory(phys_addr_t phys)</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8c_source.html#l00378">mem_protect.c:378</a></div></div>
<div class="ttc" id="amem__protect_8h_html_acc66c682438b826d6b6b92bdc3462416ad66e69677c9c0ba36e17f09dcb973163"><div class="ttname"><a href="mem__protect_8h.html#acc66c682438b826d6b6b92bdc3462416ad66e69677c9c0ba36e17f09dcb973163">PKVM_ID_HYP</a></div><div class="ttdeci">@ PKVM_ID_HYP</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8h_source.html#l00059">mem_protect.h:59</a></div></div>
<div class="ttc" id="amem__protect_8h_html_adc131fc52bbb4443366cfbe93eb87839"><div class="ttname"><a href="mem__protect_8h.html#adc131fc52bbb4443366cfbe93eb87839">host_stage2_idmap_locked</a></div><div class="ttdeci">int host_stage2_idmap_locked(phys_addr_t addr, u64 size, enum kvm_pgtable_prot prot)</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8c_source.html#l00474">mem_protect.c:474</a></div></div>
<div class="ttc" id="amem__protect_8h_html_ae6773be949982e3a1162ceaef77bd8ee"><div class="ttname"><a href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8ee">pkvm_page_state</a></div><div class="ttdeci">pkvm_page_state</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8h_source.html#l00025">mem_protect.h:25</a></div></div>
<div class="ttc" id="amem__protect_8h_html_ae6773be949982e3a1162ceaef77bd8eea0bbbb2e765899e5f69590eaa036e84a9"><div class="ttname"><a href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8eea0bbbb2e765899e5f69590eaa036e84a9">PKVM_PAGE_OWNED</a></div><div class="ttdeci">@ PKVM_PAGE_OWNED</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8h_source.html#l00026">mem_protect.h:26</a></div></div>
<div class="ttc" id="amem__protect_8h_html_ae6773be949982e3a1162ceaef77bd8eea849a7c91998d9d2255d8fa9cf7b070ce"><div class="ttname"><a href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8eea849a7c91998d9d2255d8fa9cf7b070ce">PKVM_PAGE_SHARED_OWNED</a></div><div class="ttdeci">@ PKVM_PAGE_SHARED_OWNED</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8h_source.html#l00027">mem_protect.h:27</a></div></div>
<div class="ttc" id="amem__protect_8h_html_ae6773be949982e3a1162ceaef77bd8eeae0084c7c33c77c36bbef6e7ce9d49073"><div class="ttname"><a href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8eeae0084c7c33c77c36bbef6e7ce9d49073">PKVM_PAGE_SHARED_BORROWED</a></div><div class="ttdeci">@ PKVM_PAGE_SHARED_BORROWED</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8h_source.html#l00028">mem_protect.h:28</a></div></div>
<div class="ttc" id="amem__protect_8h_html_afb7f8781ecbfa50324009fac4a8a68a8"><div class="ttname"><a href="mem__protect_8h.html#afb7f8781ecbfa50324009fac4a8a68a8">host_stage2_set_owner_locked</a></div><div class="ttdeci">int host_stage2_set_owner_locked(phys_addr_t addr, u64 size, u8 owner_id)</div><div class="ttdef"><b>Definition:</b> <a href="mem__protect_8c_source.html#l00480">mem_protect.c:480</a></div></div>
<div class="ttc" id="apgtable_8c_html_ae7564def87f47c0c061a34b7d904e805"><div class="ttname"><a href="pgtable_8c.html#ae7564def87f47c0c061a34b7d904e805">kvm_pgtable_hyp_pte_prot</a></div><div class="ttdeci">enum kvm_pgtable_prot kvm_pgtable_hyp_pte_prot(kvm_pte_t pte)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l00389">pgtable.c:424</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_ac42b610a5489eb28a4ed9e1ee2e94b96_cgraph.png" border="0" usemap="#asetup_8c_ac42b610a5489eb28a4ed9e1ee2e94b96_cgraph" alt=""/></div>
<map name="asetup_8c_ac42b610a5489eb28a4ed9e1ee2e94b96_cgraph" id="asetup_8c_ac42b610a5489eb28a4ed9e1ee2e94b96_cgraph">
<area shape="rect" title=" " alt="" coords="5,781,152,822"/>
<area shape="rect" href="mem__protect_8h.html#a5a9a7674ad958802dbe250af049ee6b0" title=" " alt="" coords="234,661,365,688"/>
<area shape="rect" href="mem__protect_8h.html#adc131fc52bbb4443366cfbe93eb87839" title=" " alt="" coords="200,712,399,739"/>
<area shape="rect" href="mem__protect_8h.html#afb7f8781ecbfa50324009fac4a8a68a8" title=" " alt="" coords="447,763,621,805"/>
<area shape="rect" href="pgtable_8c.html#ae7564def87f47c0c061a34b7d904e805" title=" " alt="" coords="200,813,399,840"/>
<area shape="rect" href="mem__protect_8h.html#a09717d2d674301b5311a4edfa87dd8c5" title=" " alt="" coords="239,864,359,891"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="239,915,359,941"/>
<area shape="rect" href="mem__protect_8c.html#a91c598dd9da44a2246e43eba3a938b52" title=" " alt="" coords="469,661,599,688"/>
<area shape="rect" href="mem__protect_8c.html#add960b8fe1ef188df3090aa2102c620d" title=" " alt="" coords="453,712,615,739"/>
<area shape="rect" href="pgtable_8c.html#aa6720ffb7274162e966c1995acefe084" title=" " alt="" coords="669,712,864,739"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="917,771,1063,797"/>
<area shape="rect" href="pgtable_8c.html#a239db42e3530e785e70ec04460752a87" title=" " alt="" coords="914,716,1066,743"/>
<area shape="rect" href="pgtable_8c.html#a0368ee3109cb5510bb12fe6b56e0c7f5" title=" " alt="" coords="912,665,1068,692"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1144,901,1296,928"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1397,901,1556,928"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1403,952,1551,979"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1659,927,1815,953"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1669,876,1804,903"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1918,952,2095,979"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1903,901,2111,928"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1943,825,2070,852"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1947,760,2066,787"/>
<area shape="rect" href="pgtable_8c.html#a6207f0c3812f7b386a306b717eb3c230" title=" " alt="" coords="1134,349,1306,376"/>
<area shape="rect" href="pgtable_8c.html#ade0f482b0d10d9aeefa9814ae4a7cf4b" title=" " alt="" coords="1116,716,1324,743"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1403,299,1550,325"/>
<area shape="rect" href="pgtable_8c.html#a1035b9b6a856794b73334de7cbfb157b" title=" " alt="" coords="1668,236,1805,263"/>
<area shape="rect" href="pgtable_8c.html#a29a6724d2843672cf5db792f2beb968a" title=" " alt="" coords="1372,484,1581,511"/>
<area shape="rect" href="pgtable_8c.html#a1a55037404d4eed23e8e3d0a6dc28dd8" title=" " alt="" coords="1655,185,1818,212"/>
<area shape="rect" href="pgtable_8c.html#a59b91ffe6fadc53223e667c87148c43c" title=" " alt="" coords="1921,240,2092,267"/>
<area shape="rect" href="pgtable_8c.html#a283484eeb78592a5189093e5529e7f8e" title=" " alt="" coords="1926,291,2087,317"/>
<area shape="rect" href="pgtable_8c.html#adcfc585140832fbe68cdf3d3f0a918d4" title=" " alt="" coords="1655,287,1818,329"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1647,353,1826,380"/>
<area shape="rect" href="pgtable_8c.html#a5ab910dc5d47620683abb5d18fb4890f" title=" " alt="" coords="1629,404,1844,431"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="2193,571,2340,597"/>
<area shape="rect" href="pgtable_8c.html#a909c28888aa74e4a85ee0c267bb88cc9" title=" " alt="" coords="1655,709,1818,750"/>
<area shape="rect" href="pgtable_8c.html#ab5d02dcf05715a75e3b1a83f4225fa0a" title=" " alt="" coords="1893,571,2120,597"/>
<area shape="rect" href="pgtable_8c.html#ab8689d3ee63e3c9b4f7ce2d27ad083be" title=" " alt="" coords="1653,607,1820,633"/>
<area shape="rect" href="pgtable_8c.html#ad5d5b8e9bcf1629e1c1d47d84878c788" title=" " alt="" coords="1651,657,1823,684"/>
<area shape="rect" href="pgtable_8c.html#a66b14675b92b1a0daa11af2d44d48efe" title=" " alt="" coords="1641,505,1833,532"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1892,651,2121,677"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac33897c1b083e65f90d0a3a9d355fc52" title=" " alt="" coords="2169,123,2364,149"/>
<area shape="rect" href="pgtable_8c.html#a33fe30cf22af4661bf16b18bdfebc1d4" title=" " alt="" coords="1917,174,2096,215"/>
<area shape="rect" href="pgtable_8c.html#a77759de2d077ab75250bb7d8b457bc61" title=" " alt="" coords="1930,6,2083,47"/>
<area shape="rect" href="pgtable_8c.html#a76e9a48362f35bfd4db46925ad63ed7b" title=" " alt="" coords="1933,72,2080,99"/>
<area shape="rect" href="nvhe_2tlb_8c.html#ac4dc226b1ecb9bca38c3096eb27c4c1d" title=" " alt="" coords="2412,89,2577,116"/>
<area shape="rect" href="nvhe_2tlb_8c.html#afffa64d5f9de2ef7a026837a2b9a0629" title=" " alt="" coords="2416,39,2573,65"/>
<area shape="rect" href="mem__protect_8h.html#a30e07c8d8daaddaecfb787562883f88d" title=" " alt="" coords="2625,39,2776,65"/>
<area shape="rect" href="nvhe_2tlb_8c.html#acd12cf2005a2acf1ce92ff165096726a" title=" " alt="" coords="2183,5,2350,32"/>
<area shape="rect" href="nvhe_2tlb_8c.html#a1d684bdb35a20ebab1ec86d6868322f4" title=" " alt="" coords="2183,57,2350,98"/>
<area shape="rect" href="pgtable_8c.html#af94796027db211abf5c1e20911100320" title=" " alt="" coords="687,763,846,805"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_ac42b610a5489eb28a4ed9e1ee2e94b96_icgraph.png" border="0" usemap="#asetup_8c_ac42b610a5489eb28a4ed9e1ee2e94b96_icgraph" alt=""/></div>
<map name="asetup_8c_ac42b610a5489eb28a4ed9e1ee2e94b96_icgraph" id="asetup_8c_ac42b610a5489eb28a4ed9e1ee2e94b96_icgraph">
<area shape="rect" title=" " alt="" coords="1309,23,1456,65"/>
<area shape="rect" href="setup_8c.html#ae1c98c3ff82fd4b71d6af82925b37be0" title=" " alt="" coords="1115,31,1261,57"/>
<area shape="rect" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe" title=" " alt="" coords="912,31,1067,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="a4c502a99f551b17a8b2b3b28eaf1012e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c502a99f551b17a8b2b3b28eaf1012e">&#9670;&nbsp;</a></span>fix_hyp_pgtable_refcnt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fix_hyp_pgtable_refcnt </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00246">246</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;{</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keyword">struct </span>kvm_pgtable_walker walker = {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        .cb = <a class="code" href="setup_8c.html#ade7b3e3f939e9007130bc51bc666d685">fix_hyp_pgtable_refcnt_walker</a>,</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        .flags  = KVM_PGTABLE_WALK_LEAF | KVM_PGTABLE_WALK_TABLE_POST,</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        .arg    = <a class="code" href="mm_8h.html#a7b9a521b68ca7bc0910bba447395a50e">pkvm_pgtable</a>.mm_ops,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    };</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281">kvm_pgtable_walk</a>(&amp;<a class="code" href="mm_8h.html#a7b9a521b68ca7bc0910bba447395a50e">pkvm_pgtable</a>, 0, BIT(<a class="code" href="mm_8h.html#a7b9a521b68ca7bc0910bba447395a50e">pkvm_pgtable</a>.ia_bits),</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                &amp;walker);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div>
<div class="ttc" id="asetup_8c_html_ade7b3e3f939e9007130bc51bc666d685"><div class="ttname"><a href="setup_8c.html#ade7b3e3f939e9007130bc51bc666d685">fix_hyp_pgtable_refcnt_walker</a></div><div class="ttdeci">static int fix_hyp_pgtable_refcnt_walker(const struct kvm_pgtable_visit_ctx *ctx, enum kvm_pgtable_walk_flags visit)</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00212">setup.c:212</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a4c502a99f551b17a8b2b3b28eaf1012e_cgraph.png" border="0" usemap="#asetup_8c_a4c502a99f551b17a8b2b3b28eaf1012e_cgraph" alt=""/></div>
<map name="asetup_8c_a4c502a99f551b17a8b2b3b28eaf1012e_cgraph" id="asetup_8c_a4c502a99f551b17a8b2b3b28eaf1012e_cgraph">
<area shape="rect" title=" " alt="" coords="5,77,176,104"/>
<area shape="rect" href="setup_8c.html#ade7b3e3f939e9007130bc51bc666d685" title=" " alt="" coords="224,41,395,82"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="237,107,382,133"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="443,107,595,133"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="643,81,801,108"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="648,132,796,159"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="849,81,1005,108"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="860,132,995,159"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="1069,5,1246,32"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="1053,56,1261,83"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="1094,107,1221,133"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="1098,157,1217,184"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a4c502a99f551b17a8b2b3b28eaf1012e_icgraph.png" border="0" usemap="#asetup_8c_a4c502a99f551b17a8b2b3b28eaf1012e_icgraph" alt=""/></div>
<map name="asetup_8c_a4c502a99f551b17a8b2b3b28eaf1012e_icgraph" id="asetup_8c_a4c502a99f551b17a8b2b3b28eaf1012e_icgraph">
<area shape="rect" title=" " alt="" coords="1115,31,1285,57"/>
<area shape="rect" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe" title=" " alt="" coords="912,31,1067,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="ade7b3e3f939e9007130bc51bc666d685"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade7b3e3f939e9007130bc51bc666d685">&#9670;&nbsp;</a></span>fix_hyp_pgtable_refcnt_walker()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fix_hyp_pgtable_refcnt_walker </td>
          <td>(</td>
          <td class="paramtype">const struct kvm_pgtable_visit_ctx *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum kvm_pgtable_walk_flags&#160;</td>
          <td class="paramname"><em>visit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00212">212</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;{</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">     * Fix-up the refcount for the page-table pages as the early allocator</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">     * was unable to access the hyp_vmemmap and so the buddy allocator has</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">     * initialised the refcount to &#39;1&#39;.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">if</span> (kvm_pte_valid(ctx-&gt;old))</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        ctx-&gt;mm_ops-&gt;get_page(ctx-&gt;ptep);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_ade7b3e3f939e9007130bc51bc666d685_icgraph.png" border="0" usemap="#asetup_8c_ade7b3e3f939e9007130bc51bc666d685_icgraph" alt=""/></div>
<map name="asetup_8c_ade7b3e3f939e9007130bc51bc666d685_icgraph" id="asetup_8c_ade7b3e3f939e9007130bc51bc666d685_icgraph">
<area shape="rect" title=" " alt="" coords="1333,23,1504,65"/>
<area shape="rect" href="setup_8c.html#a4c502a99f551b17a8b2b3b28eaf1012e" title=" " alt="" coords="1115,31,1285,57"/>
<area shape="rect" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe" title=" " alt="" coords="912,31,1067,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="a6a4ef9d03fe85971699c1d8fc76a1f71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a4ef9d03fe85971699c1d8fc76a1f71">&#9670;&nbsp;</a></span>hpool_get_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void hpool_get_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00164">164</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;{</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="gfp_8h.html#a39f58798b4af27a2b7bb3e29e9b3f653">hyp_get_page</a>(&amp;<a class="code" href="setup_8c.html#ad5ae4a11629f572b49b691f8c68dd308">hpool</a>, addr);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div>
<div class="ttc" id="agfp_8h_html_a39f58798b4af27a2b7bb3e29e9b3f653"><div class="ttname"><a href="gfp_8h.html#a39f58798b4af27a2b7bb3e29e9b3f653">hyp_get_page</a></div><div class="ttdeci">void hyp_get_page(struct hyp_pool *pool, void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="page__alloc_8c_source.html#l00175">page_alloc.c:175</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a6a4ef9d03fe85971699c1d8fc76a1f71_cgraph.png" border="0" usemap="#asetup_8c_a6a4ef9d03fe85971699c1d8fc76a1f71_cgraph" alt=""/></div>
<map name="asetup_8c_a6a4ef9d03fe85971699c1d8fc76a1f71_cgraph" id="asetup_8c_a6a4ef9d03fe85971699c1d8fc76a1f71_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,131,83"/>
<area shape="rect" href="gfp_8h.html#a39f58798b4af27a2b7bb3e29e9b3f653" title=" " alt="" coords="179,56,292,83"/>
<area shape="rect" href="memory_8h.html#a52854ece4f50a52b454b91f1a144b189" title=" " alt="" coords="340,5,476,32"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="351,56,465,83"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="343,107,473,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a6a4ef9d03fe85971699c1d8fc76a1f71_icgraph.png" border="0" usemap="#asetup_8c_a6a4ef9d03fe85971699c1d8fc76a1f71_icgraph" alt=""/></div>
<map name="asetup_8c_a6a4ef9d03fe85971699c1d8fc76a1f71_icgraph" id="asetup_8c_a6a4ef9d03fe85971699c1d8fc76a1f71_icgraph">
<area shape="rect" title=" " alt="" coords="1115,31,1240,57"/>
<area shape="rect" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe" title=" " alt="" coords="912,31,1067,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="aeb9e403be9e9cc7aa1f4af5977ea7b0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb9e403be9e9cc7aa1f4af5977ea7b0e">&#9670;&nbsp;</a></span>hpool_put_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void hpool_put_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00169">169</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;{</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <a class="code" href="gfp_8h.html#ac66c23236ea3da14d0a38962609014dc">hyp_put_page</a>(&amp;<a class="code" href="setup_8c.html#ad5ae4a11629f572b49b691f8c68dd308">hpool</a>, addr);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div>
<div class="ttc" id="agfp_8h_html_ac66c23236ea3da14d0a38962609014dc"><div class="ttname"><a href="gfp_8h.html#ac66c23236ea3da14d0a38962609014dc">hyp_put_page</a></div><div class="ttdeci">void hyp_put_page(struct hyp_pool *pool, void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="page__alloc_8c_source.html#l00166">page_alloc.c:166</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_aeb9e403be9e9cc7aa1f4af5977ea7b0e_cgraph.png" border="0" usemap="#asetup_8c_aeb9e403be9e9cc7aa1f4af5977ea7b0e_cgraph" alt=""/></div>
<map name="asetup_8c_aeb9e403be9e9cc7aa1f4af5977ea7b0e_cgraph" id="asetup_8c_aeb9e403be9e9cc7aa1f4af5977ea7b0e_cgraph">
<area shape="rect" title=" " alt="" coords="5,151,131,177"/>
<area shape="rect" href="gfp_8h.html#ac66c23236ea3da14d0a38962609014dc" title=" " alt="" coords="179,151,292,177"/>
<area shape="rect" href="page__alloc_8c.html#a5694df4a91487fa16d3181670b7cddcf" title=" " alt="" coords="342,100,469,127"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="348,151,463,177"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="340,201,471,228"/>
<area shape="rect" href="page__alloc_8c.html#afd730f352c10816e50c6e37f9a10d31e" title=" " alt="" coords="547,69,693,96"/>
<area shape="rect" href="memory_8h.html#a0729ce83305c1a44375b6e907b864b9a" title=" " alt="" coords="519,132,721,159"/>
<area shape="rect" href="page__alloc_8c.html#ad72dbf501fa84beb612ed92ee3c98e76" title=" " alt="" coords="784,5,931,32"/>
<area shape="rect" href="page__alloc_8c.html#a02f9a2f04d282f7c4026c60bc2c8d81c" title=" " alt="" coords="791,56,923,83"/>
<area shape="rect" href="page__alloc_8c.html#ab55ed9a753f81792da659a3b165fefee" title=" " alt="" coords="769,107,945,133"/>
<area shape="rect" href="page__alloc_8c.html#ae518629a69c1b296e4ade7f9bd7041b8" title=" " alt="" coords="993,5,1161,32"/>
<area shape="rect" href="memory_8h.html#a3cc326fe973add2b2ea91f6b04dd8fde" title=" " alt="" coords="787,157,927,184"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_aeb9e403be9e9cc7aa1f4af5977ea7b0e_icgraph.png" border="0" usemap="#asetup_8c_aeb9e403be9e9cc7aa1f4af5977ea7b0e_icgraph" alt=""/></div>
<map name="asetup_8c_aeb9e403be9e9cc7aa1f4af5977ea7b0e_icgraph" id="asetup_8c_aeb9e403be9e9cc7aa1f4af5977ea7b0e_icgraph">
<area shape="rect" title=" " alt="" coords="1115,31,1240,57"/>
<area shape="rect" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe" title=" " alt="" coords="912,31,1067,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="a537df8751deae8c4d733400a572fcb7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a537df8751deae8c4d733400a572fcb7b">&#9670;&nbsp;</a></span>hyp_zalloc_hyp_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* hyp_zalloc_hyp_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00159">159</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;{</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="gfp_8h.html#a7a740bb58e275f0307a86b02008f751a">hyp_alloc_pages</a>(&amp;<a class="code" href="setup_8c.html#ad5ae4a11629f572b49b691f8c68dd308">hpool</a>, 0);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div>
<div class="ttc" id="agfp_8h_html_a7a740bb58e275f0307a86b02008f751a"><div class="ttname"><a href="gfp_8h.html#a7a740bb58e275f0307a86b02008f751a">hyp_alloc_pages</a></div><div class="ttdeci">void * hyp_alloc_pages(struct hyp_pool *pool, unsigned short order)</div><div class="ttdef"><b>Definition:</b> <a href="page__alloc_8c_source.html#l00198">page_alloc.c:198</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a537df8751deae8c4d733400a572fcb7b_cgraph.png" border="0" usemap="#asetup_8c_a537df8751deae8c4d733400a572fcb7b_cgraph" alt=""/></div>
<map name="asetup_8c_a537df8751deae8c4d733400a572fcb7b_cgraph" id="asetup_8c_a537df8751deae8c4d733400a572fcb7b_cgraph">
<area shape="rect" title=" " alt="" coords="5,157,167,184"/>
<area shape="rect" href="gfp_8h.html#a7a740bb58e275f0307a86b02008f751a" title=" " alt="" coords="215,157,345,184"/>
<area shape="rect" href="page__alloc_8c.html#a8ac88fa38a81f4de49d9e80665b1ffc0" title=" " alt="" coords="412,56,564,83"/>
<area shape="rect" href="memory_8h.html#af9e2f139c35baaaccb3e11cfe21cf182" title=" " alt="" coords="393,107,583,133"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="431,157,545,184"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="423,208,553,235"/>
<area shape="rect" href="page__alloc_8c.html#ab41323251ac55b72defe671d568dcce7" title=" " alt="" coords="431,259,545,285"/>
<area shape="rect" href="page__alloc_8c.html#ae518629a69c1b296e4ade7f9bd7041b8" title=" " alt="" coords="635,5,803,32"/>
<area shape="rect" href="page__alloc_8c.html#a02f9a2f04d282f7c4026c60bc2c8d81c" title=" " alt="" coords="653,56,785,83"/>
<area shape="rect" href="page__alloc_8c.html#ab55ed9a753f81792da659a3b165fefee" title=" " alt="" coords="631,107,807,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a537df8751deae8c4d733400a572fcb7b_icgraph.png" border="0" usemap="#asetup_8c_a537df8751deae8c4d733400a572fcb7b_icgraph" alt=""/></div>
<map name="asetup_8c_a537df8751deae8c4d733400a572fcb7b_icgraph" id="asetup_8c_a537df8751deae8c4d733400a572fcb7b_icgraph">
<area shape="rect" title=" " alt="" coords="1115,31,1276,57"/>
<area shape="rect" href="setup_8c.html#ab5bdfd8a9c40da5d8de013de4f049dbe" title=" " alt="" coords="912,31,1067,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="a7fc10c31100e5dadb1a7b4869768b06d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fc10c31100e5dadb1a7b4869768b06d">&#9670;&nbsp;</a></span>recreate_hyp_mappings()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int recreate_hyp_mappings </td>
          <td>(</td>
          <td class="paramtype">phys_addr_t&#160;</td>
          <td class="paramname"><em>phys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>per_cpu_base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>hyp_va_bits</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00070">70</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;{</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordtype">void</span> *start, *<a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, *virt = <a class="code" href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4">hyp_phys_to_virt</a>(phys);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> pgt_size = hyp_s1_pgtable_pages() &lt;&lt; PAGE_SHIFT;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keyword">enum</span> kvm_pgtable_prot prot;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">int</span> ret, i;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* Recreate the hyp page-table using the early page allocator */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="early__alloc_8h.html#a9ab46cd46bbd575c63a620e9bdbde91d">hyp_early_alloc_init</a>(<a class="code" href="setup_8c.html#a9581c85c450d45626e1b96511543cb0d">hyp_pgt_base</a>, pgt_size);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    ret = <a class="code" href="pgtable_8c.html#a9bf9cde257aa21bdb012231087127d17">kvm_pgtable_hyp_init</a>(&amp;<a class="code" href="mm_8h.html#a7b9a521b68ca7bc0910bba447395a50e">pkvm_pgtable</a>, hyp_va_bits,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                   &amp;<a class="code" href="early__alloc_8h.html#a00429354a2bf3db05cf67fa1ae21cc24">hyp_early_alloc_mm_ops</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    ret = <a class="code" href="mm_8h.html#a738b3178d5dd1a8ecd9b50aeb05459c8">hyp_create_idmap</a>(hyp_va_bits);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    ret = <a class="code" href="mm_8h.html#a91e77e89ea79e3c3b6fd869e045217aa">hyp_map_vectors</a>();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    ret = <a class="code" href="mm_8h.html#ad0a9079e39d4a5849b5a8df682356cb7">hyp_back_vmemmap</a>(<a class="code" href="memory_8h.html#aae436fb2b3f13c0954cde727104e80ac">hyp_virt_to_phys</a>(<a class="code" href="setup_8c.html#af67617d36b4054ea302dea413b0d5d0f">vmemmap_base</a>));</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    ret = <a class="code" href="mm_8h.html#aa462601367efc86bb5760f046d9a8d73">pkvm_create_mappings</a>(__hyp_text_start, __hyp_text_end, PAGE_HYP_EXEC);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    ret = <a class="code" href="mm_8h.html#aa462601367efc86bb5760f046d9a8d73">pkvm_create_mappings</a>(__hyp_rodata_start, __hyp_rodata_end, PAGE_HYP_RO);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    ret = <a class="code" href="mm_8h.html#aa462601367efc86bb5760f046d9a8d73">pkvm_create_mappings</a>(__hyp_bss_start, __hyp_bss_end, PAGE_HYP);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    ret = <a class="code" href="mm_8h.html#aa462601367efc86bb5760f046d9a8d73">pkvm_create_mappings</a>(virt, virt + <a class="code" href="gen-hyprel_8c.html#a854352f53b148adc24983a58a1866d66">size</a>, PAGE_HYP);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="setup_8c.html#aa640ad613bd0b27b624e07ba8e802625">hyp_nr_cpus</a>; i++) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keyword">struct </span>kvm_nvhe_init_params *params = per_cpu_ptr(&amp;kvm_init_params, i);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        start = (<span class="keywordtype">void</span> *)kern_hyp_va(per_cpu_base[i]);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a> = start + PAGE_ALIGN(<a class="code" href="setup_8c.html#a38059e76cd84ec015fee14728c4ecc66">hyp_percpu_size</a>);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        ret = <a class="code" href="mm_8h.html#aa462601367efc86bb5760f046d9a8d73">pkvm_create_mappings</a>(start, <a class="code" href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a>, PAGE_HYP);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        ret = <a class="code" href="mm_8h.html#a3bf7d7d7d610b2fbbfc54f5adaf0a3df">pkvm_create_stack</a>(params-&gt;stack_pa, &amp;params-&gt;stack_hyp_va);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">     * Map the host sections RO in the hypervisor, but transfer the</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">     * ownership from the host to the hypervisor itself to make sure they</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">     * can&#39;t be donated or shared with another entity.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">     * The ownership transition requires matching changes in the host</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">     * stage-2. This will be done later (see finalize_host_mappings()) once</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">     * the hyp_vmemmap is addressable.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    prot = <a class="code" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152">pkvm_mkstate</a>(PAGE_HYP_RO, <a class="code" href="mem__protect_8h.html#ae6773be949982e3a1162ceaef77bd8eea849a7c91998d9d2255d8fa9cf7b070ce">PKVM_PAGE_SHARED_OWNED</a>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    ret = <a class="code" href="mm_8h.html#aa462601367efc86bb5760f046d9a8d73">pkvm_create_mappings</a>(&amp;kvm_vgic_global_state,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                   &amp;kvm_vgic_global_state + 1, prot);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div>
<div class="ttc" id="aearly__alloc_8c_html_ac31c5196f50f192d5db1d85180b05aaf"><div class="ttname"><a href="early__alloc_8c.html#ac31c5196f50f192d5db1d85180b05aaf">end</a></div><div class="ttdeci">static unsigned long end</div><div class="ttdef"><b>Definition:</b> <a href="early__alloc_8c_source.html#l00016">early_alloc.c:16</a></div></div>
<div class="ttc" id="aearly__alloc_8h_html_a00429354a2bf3db05cf67fa1ae21cc24"><div class="ttname"><a href="early__alloc_8h.html#a00429354a2bf3db05cf67fa1ae21cc24">hyp_early_alloc_mm_ops</a></div><div class="ttdeci">struct kvm_pgtable_mm_ops hyp_early_alloc_mm_ops</div><div class="ttdef"><b>Definition:</b> <a href="early__alloc_8c_source.html#l00001">early_alloc.c:12</a></div></div>
<div class="ttc" id="amm_8h_html_a3bf7d7d7d610b2fbbfc54f5adaf0a3df"><div class="ttname"><a href="mm_8h.html#a3bf7d7d7d610b2fbbfc54f5adaf0a3df">pkvm_create_stack</a></div><div class="ttdeci">int pkvm_create_stack(phys_addr_t phys, unsigned long *haddr)</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00353">mm.c:353</a></div></div>
<div class="ttc" id="amm_8h_html_a738b3178d5dd1a8ecd9b50aeb05459c8"><div class="ttname"><a href="mm_8h.html#a738b3178d5dd1a8ecd9b50aeb05459c8">hyp_create_idmap</a></div><div class="ttdeci">int hyp_create_idmap(u32 hyp_va_bits)</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00328">mm.c:328</a></div></div>
<div class="ttc" id="amm_8h_html_a91e77e89ea79e3c3b6fd869e045217aa"><div class="ttname"><a href="mm_8h.html#a91e77e89ea79e3c3b6fd869e045217aa">hyp_map_vectors</a></div><div class="ttdeci">int hyp_map_vectors(void)</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00210">mm.c:210</a></div></div>
<div class="ttc" id="amm_8h_html_aa462601367efc86bb5760f046d9a8d73"><div class="ttname"><a href="mm_8h.html#aa462601367efc86bb5760f046d9a8d73">pkvm_create_mappings</a></div><div class="ttdeci">int pkvm_create_mappings(void *from, void *to, enum kvm_pgtable_prot prot)</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00138">mm.c:138</a></div></div>
<div class="ttc" id="amm_8h_html_ad0a9079e39d4a5849b5a8df682356cb7"><div class="ttname"><a href="mm_8h.html#ad0a9079e39d4a5849b5a8df682356cb7">hyp_back_vmemmap</a></div><div class="ttdeci">int hyp_back_vmemmap(phys_addr_t back)</div><div class="ttdef"><b>Definition:</b> <a href="mm_8c_source.html#l00149">mm.c:149</a></div></div>
<div class="ttc" id="apgtable_8c_html_a9bf9cde257aa21bdb012231087127d17"><div class="ttname"><a href="pgtable_8c.html#a9bf9cde257aa21bdb012231087127d17">kvm_pgtable_hyp_init</a></div><div class="ttdeci">int kvm_pgtable_hyp_init(struct kvm_pgtable *pgt, u32 va_bits, struct kvm_pgtable_mm_ops *mm_ops)</div><div class="ttdef"><b>Definition:</b> <a href="pgtable_8c_source.html#l00568">pgtable.c:568</a></div></div>
<div class="ttc" id="asetup_8c_html_a38059e76cd84ec015fee14728c4ecc66"><div class="ttname"><a href="setup_8c.html#a38059e76cd84ec015fee14728c4ecc66">hyp_percpu_size</a></div><div class="ttdeci">#define hyp_percpu_size</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00025">setup.c:25</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a7fc10c31100e5dadb1a7b4869768b06d_cgraph.png" border="0" usemap="#asetup_8c_a7fc10c31100e5dadb1a7b4869768b06d_cgraph" alt=""/></div>
<map name="asetup_8c_a7fc10c31100e5dadb1a7b4869768b06d_cgraph" id="asetup_8c_a7fc10c31100e5dadb1a7b4869768b06d_cgraph">
<area shape="rect" title=" " alt="" coords="5,366,184,393"/>
<area shape="rect" href="mm_8h.html#ad0a9079e39d4a5849b5a8df682356cb7" title=" " alt="" coords="240,290,403,317"/>
<area shape="rect" href="memory_8h.html#a14e874dea4f604e8102b20809cc5eae4" title=" " alt="" coords="487,391,621,418"/>
<area shape="rect" href="mm_8h.html#a738b3178d5dd1a8ecd9b50aeb05459c8" title=" " alt="" coords="483,274,625,301"/>
<area shape="rect" href="memory_8h.html#aae436fb2b3f13c0954cde727104e80ac" title=" " alt="" coords="727,411,860,438"/>
<area shape="rect" href="early__alloc_8h.html#a9ab46cd46bbd575c63a620e9bdbde91d" title=" " alt="" coords="245,467,397,494"/>
<area shape="rect" href="mm_8h.html#a91e77e89ea79e3c3b6fd869e045217aa" title=" " alt="" coords="253,109,390,135"/>
<area shape="rect" href="pgtable_8c.html#a9bf9cde257aa21bdb012231087127d17" title=" " alt="" coords="238,695,405,722"/>
<area shape="rect" href="mm_8h.html#aa462601367efc86bb5760f046d9a8d73" title=" " alt="" coords="232,206,411,233"/>
<area shape="rect" href="mm_8h.html#a3bf7d7d7d610b2fbbfc54f5adaf0a3df" title=" " alt="" coords="719,71,868,98"/>
<area shape="rect" href="mem__protect_8h.html#a2cf886e3d56ed4cd5ddb78944ac0a152" title=" " alt="" coords="261,746,381,773"/>
<area shape="rect" href="mm_8c.html#a74d2915c3948e76518d945f16a1ede94" title=" " alt="" coords="697,223,889,250"/>
<area shape="rect" href="spinlock_8h.html#ae942ff0e878cb0f4d55ddc4cc6275ec9" title=" " alt="" coords="967,122,1082,149"/>
<area shape="rect" href="spinlock_8h.html#a2c6e9db70599188dbe031e2ce8ec6b08" title=" " alt="" coords="959,173,1090,199"/>
<area shape="rect" href="pgtable_8c.html#ad1a61b3aa251ca1150e9359c5c31a173" title=" " alt="" coords="937,325,1112,351"/>
<area shape="rect" href="pgtable_8c.html#a06c1f113f067476605d118dffebef6a8" title=" " alt="" coords="1175,274,1307,301"/>
<area shape="rect" href="pgtable_8c.html#ab93223f59cefdfdd0abfb060e97f7b45" title=" " alt="" coords="1173,325,1309,351"/>
<area shape="rect" href="pgtable_8c.html#a2a6ed7242e033a1f32360cbe0e5c2281" title=" " alt="" coords="1169,375,1314,402"/>
<area shape="rect" href="pgtable_8c.html#ae28010caa0eb1b8a51d07679e9d08daa" title=" " alt="" coords="1371,262,1560,289"/>
<area shape="rect" href="pgtable_8c.html#acdca989573ec9ed02b9b43a7014140c8" title=" " alt="" coords="1392,313,1539,339"/>
<area shape="rect" href="pgtable_8c.html#ad78e3b5f65ff7e25e23a1fbb89e39a24" title=" " alt="" coords="1608,230,1837,257"/>
<area shape="rect" href="pgtable_8c.html#adec3d8cce63231d14b6d3d9e635abf8e" title=" " alt="" coords="1633,281,1812,307"/>
<area shape="rect" href="pgtable_8c.html#aa480a93c3d8dd6fd53b1105fd604766c" title=" " alt="" coords="1890,230,2037,257"/>
<area shape="rect" href="pgtable_8c.html#ac74b17e065ba3e68a10f28b594d21e40" title=" " alt="" coords="1389,375,1541,402"/>
<area shape="rect" href="pgtable_8c.html#a4819ac158aa1b43844c3a3b5e5a82ac3" title=" " alt="" coords="1643,357,1802,383"/>
<area shape="rect" href="pgtable_8c.html#af01e17f60125c9e093e082e70a43f362" title=" " alt="" coords="1649,407,1797,434"/>
<area shape="rect" href="pgtable_8c.html#a5aa0f5d1f7f2540fea515eb0b198caba" title=" " alt="" coords="1885,357,2041,383"/>
<area shape="rect" href="pgtable_8c.html#ac1a7f01d8f40491309c052bdea628e06" title=" " alt="" coords="1896,407,2031,434"/>
<area shape="rect" href="pgtable_8c.html#a98293d8aa53e4ee188e8dc42f3dc17e9" title=" " alt="" coords="2105,281,2282,307"/>
<area shape="rect" href="pgtable_8c.html#abfea9e86c1a7e719b3d9e35bb045d795" title=" " alt="" coords="2089,331,2297,358"/>
<area shape="rect" href="pgtable_8c.html#a2f4269267d0718905af8540821a6de3d" title=" " alt="" coords="2130,382,2257,409"/>
<area shape="rect" href="pgtable_8c.html#a6e3f339456d5a01daa47962cc12f080e" title=" " alt="" coords="2134,433,2253,459"/>
<area shape="rect" href="early__alloc_8c.html#aaf6227e33188fee18fabd13935fa5594" title=" " alt="" coords="459,493,649,519"/>
<area shape="rect" href="early__alloc_8c.html#a9e6a60c291357ae7f20b3859d04e7155" title=" " alt="" coords="473,543,635,570"/>
<area shape="rect" href="early__alloc_8c.html#abb8ed2647ee8cb79c6ee8a0ebcb52c94" title=" " alt="" coords="459,594,649,621"/>
<area shape="rect" href="early__alloc_8c.html#a85026ed77b0c75bfdfe8d4c25c194025" title=" " alt="" coords="708,543,879,570"/>
<area shape="rect" href="mm_8c.html#ae155403ed30abe044479dec517afc378" title=" " alt="" coords="467,56,641,97"/>
<area shape="rect" href="mm_8c.html#ac26a679af9d176b079755c60fa2e1ce1" title=" " alt="" coords="718,5,869,47"/>
<area shape="rect" href="mm_8c.html#aa76ffe9cd77a903ae9b6e5de1617f3a5" title=" " alt="" coords="943,56,1107,97"/>
<area shape="rect" href="spinlock_8h.html#ae92c9f4a09d239d6060880c35d12a48b" title=" " alt="" coords="1160,143,1323,170"/>
<area shape="rect" href="mm_8c.html#a36a82f8cc52bf1bf431f904beddc6c18" title=" " alt="" coords="465,325,643,367"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_a7fc10c31100e5dadb1a7b4869768b06d_icgraph.png" border="0" usemap="#asetup_8c_a7fc10c31100e5dadb1a7b4869768b06d_icgraph" alt=""/></div>
<map name="asetup_8c_a7fc10c31100e5dadb1a7b4869768b06d_icgraph" id="asetup_8c_a7fc10c31100e5dadb1a7b4869768b06d_icgraph">
<area shape="rect" title=" " alt="" coords="912,31,1091,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<a id="afb62b1c2320b044bcb13a34ff2eaf90f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb62b1c2320b044bcb13a34ff2eaf90f">&#9670;&nbsp;</a></span>update_nvhe_init_params()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void update_nvhe_init_params </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00146">146</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;{</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keyword">struct </span>kvm_nvhe_init_params *params;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="setup_8c.html#aa640ad613bd0b27b624e07ba8e802625">hyp_nr_cpus</a>; i++) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        params = per_cpu_ptr(&amp;kvm_init_params, i);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        params-&gt;pgd_pa = __hyp_pa(<a class="code" href="mm_8h.html#a7b9a521b68ca7bc0910bba447395a50e">pkvm_pgtable</a>.pgd);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        dcache_clean_inval_poc((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)params,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)params + <span class="keyword">sizeof</span>(*params));</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="setup_8c_afb62b1c2320b044bcb13a34ff2eaf90f_icgraph.png" border="0" usemap="#asetup_8c_afb62b1c2320b044bcb13a34ff2eaf90f_icgraph" alt=""/></div>
<map name="asetup_8c_afb62b1c2320b044bcb13a34ff2eaf90f_icgraph" id="asetup_8c_afb62b1c2320b044bcb13a34ff2eaf90f_icgraph">
<area shape="rect" title=" " alt="" coords="912,31,1103,57"/>
<area shape="rect" href="setup_8c.html#a69148fd8ebc6b8dd5f602c1dae42544d" title=" " alt="" coords="763,31,864,57"/>
<area shape="rect" href="arm_8c.html#a45a99f5a1905e2b85f69a767313abfd7" title=" " alt="" coords="583,5,694,32"/>
<area shape="rect" href="hyp-main_8c.html#a26b0350e219d42d5ea7f7df36d17d9e8" title=" " alt="" coords="563,56,715,83"/>
<area shape="rect" href="arm_8c.html#a3c73ef13f7491129779b02da5a9a7442" title=" " alt="" coords="332,5,515,32"/>
<area shape="rect" href="arm_8c.html#a289457d5cabd2e7e2cda634bc6277311" title=" " alt="" coords="165,5,284,32"/>
<area shape="rect" href="arm_8c.html#a625df4221f73b13d9f23aa818f60e547" title=" " alt="" coords="5,5,117,32"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a9522cf5b940478dc2c960364ffd22a5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9522cf5b940478dc2c960364ffd22a5b">&#9670;&nbsp;</a></span>ffa_proxy_pages</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void* ffa_proxy_pages</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00032">32</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>

</div>
</div>
<a id="a43979e628bf4d2a656c80a8545f5693a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43979e628bf4d2a656c80a8545f5693a">&#9670;&nbsp;</a></span>host_s2_pgt_base</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void* host_s2_pgt_base</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00031">31</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>

</div>
</div>
<a id="ad5ae4a11629f572b49b691f8c68dd308"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5ae4a11629f572b49b691f8c68dd308">&#9670;&nbsp;</a></span>hpool</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structhyp__pool.html">hyp_pool</a> hpool</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00032">32</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>

</div>
</div>
<a id="aa640ad613bd0b27b624e07ba8e802625"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa640ad613bd0b27b624e07ba8e802625">&#9670;&nbsp;</a></span>hyp_nr_cpus</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long hyp_nr_cpus</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00023">23</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>

</div>
</div>
<a id="a9581c85c450d45626e1b96511543cb0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9581c85c450d45626e1b96511543cb0d">&#9670;&nbsp;</a></span>hyp_pgt_base</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void* hyp_pgt_base</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00030">30</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>

</div>
</div>
<a id="adfd7ac18936b66957dc1bff827214803"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfd7ac18936b66957dc1bff827214803">&#9670;&nbsp;</a></span>pkvm_pgtable_mm_ops</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct kvm_pgtable_mm_ops pkvm_pgtable_mm_ops</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00032">32</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>

</div>
</div>
<a id="aec5cfc568b5c34b2ee8dd23207e78b37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec5cfc568b5c34b2ee8dd23207e78b37">&#9670;&nbsp;</a></span>vm_table_base</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void* vm_table_base</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00029">29</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>

</div>
</div>
<a id="af67617d36b4054ea302dea413b0d5d0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af67617d36b4054ea302dea413b0d5d0f">&#9670;&nbsp;</a></span>vmemmap_base</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void* vmemmap_base</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="setup_8c_source.html#l00028">28</a> of file <a class="el" href="setup_8c_source.html">setup.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
